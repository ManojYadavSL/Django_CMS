<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
cmsWebpackJsonp([6],{0:function(e,t,i){i(7),i(8);var r=i(2);window.CMS=r,r.PageTree=i(26)},12:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(1)],r=a,n="function"==typeof r?r.apply(t,s):r,!(void 0!==n&&(e.exports=n))}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(s){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(s){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return i!==!0||this.length?(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||i===!0)&&(n=a||!1),null!==n&&n!==t?!1:void 0}),null!==n&&n!==t?n:this):!1},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(t){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(i){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return e.target.tagName&&"input"===e.target.tagName.toLowerCase()?!0:void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget),i&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus());break;case 38:t.preventDefault(),i=this.get_prev_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0],i&&e(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:t.preventDefault(),i=this.get_next_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),i=this._firstChild(this.get_container_ul()[0]),i&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(s){return!1}},get_path:function(t,i,r){if(t=t.parents?t:this.get_node(t),!t||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&-1!==r.className.indexOf("jstree-node")?e(r):!1},get_parent:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.parent:!1},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):e&&e.length?e.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(t=this.get_node(t),!t)return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){r===!1?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){e=this.get_node(e),e&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){s=this._parse_model_from_html(e(i),d,_.parents.concat()),s&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&(i=i.d,"string"==typeof i&&(i=JSON.parse(i))),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do l="j"+_+"_"+ ++u;while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)i=v(a[r],o,f.parents.concat()),i&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(l){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),i.length?(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString()))):!0}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=d.hasClass("jstree-themeicon-hidden")?!1:d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do l="j"+this._id+"_"+ ++this._cnt;while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),h.a_attr["class"]&&(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do l="j"+this._id+"_"+ ++this._cnt;while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)t=this.redraw_node(s[i],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,
t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===a||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&n.icon!==!0||n.icon===!1)&&(n.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):r?r.call(this,e,!1):!1}):(r&&r.call(this,i,!1),!1)):!1},_open_to:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?this.is_closed(i)?!1:(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))):!1},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t})):!1},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t})):!1},is_hidden:function(e){return e=this.get_node(e),e.state.hidden===!0},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))):!1},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))):!1},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return e=this.get_node(e,!0),e&&e.length&&e.children(".jstree-hovered").length?(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)})):!1},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s})))):!1},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r})))):!1},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.selected:!1},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return e.isEmptyObject(i)?(i=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t,i){this._data.core.state=i===!0?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),t.state.opened===!0&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,"new":t.id,old:a}),!0},get_text:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.text:!1},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0):!1},get_json:function(t,i,r){if(t=this.get_node(t||e.jstree.root),!t)return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:i&&i.no_data?!1:e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),i=this.get_node(i),!i)return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,i.id,i.parents.concat()),!r)return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(a.functions[t]===!1||a.functions[t]===!0)?(a.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),a.functions[t]):o===!1||e.isFunction(o)&&o.call(this,t,i,r,s,n)===!1||o&&o[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return(m=this.copy_node(i,r,s,n,a,!1,d))?(g&&g.delete_node(i),m):!1;switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),j=!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i,!f)return!1;if(f.id===!0&&delete f.id,f=this._parse_model_from_json(f,m.id,m.parents.concat()),!f)return!1;for(_=this.get_node(f),i&&i.state&&i.state.loaded===!1&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="move_node",void this.trigger("cut",{node:t})):!1},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t})):!1},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return a!==!1&&n!==!1},paste:function(e,t){return e=this.get_node(e),e&&a&&a.match(/^(copy_node|move_node)$/)&&n?(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1)):!1},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return(t=this.get_node(t))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13===e.which?!1:void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),
a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})):!1},set_theme:function(t,i){if(!t)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(o=i.icon,i.icon=r===!0||null===r||r===t||""===r?!0:r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),r===!1?this.hide_icon(i):r===!0||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),o===!1&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),o===!1&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),o===!1&&this.show_icon(i)),!0):!1},get_icon:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.icon:!1},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(s=this.get_node(t,!0),t.icon=s.length?s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)n=o[a.children_d[r]],n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),n=this.get_node(a.parents[r],!0),n&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&l.original.state.undetermined===!0)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0),l&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||t.state[n?"selected":"checked"]===!0||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t})))):!1},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t})))):!1},this.activate_node=function(t,i){return e(i.target).hasClass("jstree-checkbox-disabled")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):this.is_disabled(t)?!1:(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):(t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.checked:!1)},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a,o;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(o=this.get_node(t),o&&o.state.loaded))for(s=0,n=o.children_d.length;n>s;s++)this._model.data[o.children_d[s]].state.checked&&(a=!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,o.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(i=this.get_node(i),!i||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return t=i.items[t],t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:i.reference,element:i.element}))&&t.action?t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}}):!1},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return r?(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(r._disabled===!0||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0),s&&(n+=s)),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0))):!0}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10?n:!1},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u,g=!0;switch(i.element&&i.element.length&&i.element.width(""),g){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth(),d<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20)),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();
t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(this.settings.dnd.is_draggable===!0||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if(e=i.redraw_node.apply(this,arguments),e&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if(C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"),C&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),f=f&&(w&&w.settings&&w.settings.dnd&&w.settings.dnd.check_while_dragging===!1||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})),!f){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),g===!0))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}),f);p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0),d&&d.settings.core.error.call(this,r));s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){o=e.vakata.dnd._get(),o&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(t===!0)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(n){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,s!==!1&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),d=this.get_node(t[a],!0),d&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)d=this.get_node(t[a],!0),d&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)d=this.get_node(t[l],!0),d&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(i===!1||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=c.ajax?c.ajax:!1,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&h!==!1)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n?n:e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&this.open_node(f[d],null,0)===!0&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments),t&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),r.fuzzy!==!1&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),y=e.lastIndexOf(t,d+h),-1!==y&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],0===i?p[o]=(p[o+1]<<1|1)&m:p[o]=(p[o+1]<<1|1)&m|((u[o+1]|u[o])<<1|1)|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},i===!0?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if(t=this.get_node(t),t&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(i){return!1}return t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl?!1:(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),t?(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0):!1)},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"default":{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types["default"])for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types["default"])s.types["default"].hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types["default"][a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,o[d[s]].icon===!0&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr["class"]=l[c].li_attr["class"]+" "+o[d[s]].li_attr["class"])}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr["class"]=l[c].a_attr["class"]+" "+o[d[s]].a_attr["class"])}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(l===!1)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(r.check.call(this,i,s,n,a,o)===!1)return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(e=this.get_node(e),!e)return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return t=this.get_node(t),t?i?e.extend({type:t.type},this.settings.types[t.type]):t.type:!1},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(d===!0||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon!==t?s[r].icon:!0),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr["class"]=(_[i.id].li_attr["class"]||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr["class"]=(_[i.id].a_attr["class"]||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr["class"]=s[r].li_attr[l]+" "+_[i.id].li_attr["class"],c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr["class"]=s[r].a_attr["class"]+" "+_[i.id].a_attr["class"],h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(r.check.call(this,t,i,s,n,a)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s),!s||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),
i=this.get_node(i),!i)return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)s=this.get_node(t.selected[i],!0),s&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(v){}}}})},21:function(e,t,i){var r,s,n;!function(a){s=[i(1),i(12)],r=a,n="function"==typeof r?r.apply(t,s):r,!(void 0!==n&&(e.exports=n))}(function(e){var t,i,r,s,n,a=/^\s*$/g,o=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,d=function(e){return(e||"").replace(o,"\\$&")},l="data-jstreegrid",c="_DATA_",h=24,_=!1,u="jsgrid_",g="_col",f=function(e,t){return e.find("div["+l+"='"+t+"']")},p=!1,m=null,v=0,j=0;s=/<\/?[^>]+>/gi,r=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||h,n.detach(),r.remove(),i._gridSettings.indent=a),a},n=function(e,t){var i,r=e.get_node(t),s=r.children;return i=!s||s.length<=0||!r.state.opened?t:n(e,s[s.length-1])},t=function(e,t){var i,s,n=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,s=n-i*r(e,t),n},i=function(e,t,i){var r,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];r="",a.title&&(a.title===c?r=i.get_text(t):t.attr(a.title)&&(r=t.attr(a.title))),r=r.replace(s,""),r&&n.attr("title",r)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(t,r){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},o=a.columns,d=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){d=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=d,this.rootid=s.attr("id");var l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var c=parseFloat(navigator.appVersion.split("MSIE")[1]);8>c&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(_||(_=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<o.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+d+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)f(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&f(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,f(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,f(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;f(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;f(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)f(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&f(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?f(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,l,c,h=this._gridSettings,_=h.columns||[],u=h.columnWidth,g=h.resizable||!1,f=h.isThemeroller,y=f?"themeroller":"regular",k=!1,x=this.gridparent,b=h.defaultConf,w=0,C=0,S=0;for(this.parent=x,i=0;i<_.length;i++)n=_[i].headerClass||"",a=_[i].columnClass||"",o=_[i].header||"",o&&(k=!0),s=_[i].width||u,C=f?7:10,"auto"!==s&&"string"!=typeof s&&(s-=C),d=0===i?3:0,r=this.midWrapper.children("div.jstree-grid-column-"+i),l=e("<div></div>").css(b).css({"margin-left":d}).addClass("jstree-grid-div-"+this.uniq+"-"+i+" "+(f?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+y+" "+n+" "+a).html(o),l.addClass((f?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+y),l.prependTo(r),S+=l.outerWidth(),c=e("<div class='jstree-grid-separator jstree-grid-separator-"+y+(f?" ui-widget-header":"")+(g?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(l),r.width(s),r.css("min-width",s),r.css("max-width",s);l.addClass((f?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+y),void 0===_[_.length-1].width&&(S-=s,r.css({width:"auto"}),l.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),k?h.header=t:e("div.jstree-grid-header").hide(),!this.bound&&g&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(p){for(o=m.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=m.parent().children("div.jstree-grid-column"),s=[],(isNaN(w)||0>w)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),p=!1,m=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:t===w},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(p){j=e.pageX;var t,i,r,s=j-v;0!==s&&(t=m.width(),i=parseFloat(m.css("width")),i||(i=m.innerWidth()),s=0>s?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(m.width(r),m.css("min-width",r),m.css("max-width",r),v=j))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return p=!0,v=t.pageX,m=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=0>i?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,s){return e=r.redraw_node.call(this,e,t,i,s),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),r.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)f(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,a=e(),o=t.children||[];for(n=0;n<o.length;n++)s=u+d(o[n])+g+i,r[s]&&t.state.opened&&(a=a.add(r[s]).add(this.getHoldingCells(this.get_node(o[n]),i,r)));return a},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){return 13===e.which?!1:void 0}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(t){var r,o,c,h,_,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L,H,z,M,W,K=this._gridSettings,q=K.treeClass,$=this,F=K.columns||[],U=K.isThemeroller,Y=this.element,X=this.rootid,J=U?"themeroller":"regular",B=this.get_node(t),V=K.columnWidth,R=K.defaultConf,G=function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}},Q=function(t,i,r,s,n){return function(t){K.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);$._edit(r,s,t.target)}}}))}},Z=function(e,t){return function(){t.hover_node(e)}},ee=function(e,t){return function(){t.dehover_node(e)}},te=this.midWrapper,ie=B.id,re=this.get_node(B.parent).children,se=e.inArray(ie,re),ne=this.holdingCells,ae=!1;if(r=e(t),j=r.children("a"),1===j.length){for(W=!B.state.opened,S=u+d(ie)+g,T="#"===B.parent?null:B.parent,j.addClass(q),i(j,r,$),y=j,h=0;h<F.length;h++)this.treecol!==h&&(L=F[h],M=te.children("div:eq("+h+")"),p=L.cellClass||"",m=L.wideCellClass||"",v=L.columnClass||"",M.addClass(v),_=void 0!==L.value&&null!==L.value?"function"==typeof L.value?L.value(B):null!==B.data&&void 0!==B.data&&void 0!==B.data[L.value]?B.data[L.value]:"":"","function"==typeof L.format&&(_=L.format(_)),L.images?(c=L.images[_]||L.images["default"],c&&(H="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">')):H=_,(void 0===H||null===H||a.test(H))&&(H="&nbsp;"),k=L.valueClass&&null!==B.data&&void 0!==B.data?B.data[L.valueClass]||"":"",k&&L.valueClassPrefix&&""!==L.valueClassPrefix&&(k=L.valueClassPrefix+k),x=L.wideValueClass&&null!==B.data&&void 0!==B.data?B.data[L.wideValueClass]||"":"",x&&L.wideValueClassPrefix&&""!==L.wideValueClassPrefix&&(x=L.wideValueClassPrefix+x),C=L.title&&null!==B.data&&void 0!==B.data?B.data[L.title]||"":"",C=C.replace(s,""),w=7,o=L.width||V,"auto"!==o&&(o=z||o-w),y=M.children("div#"+S+h),(!y||y.length<1)&&(y=e("<div></div>"),e("<span></span>").appendTo(y),y.attr("id",S+h),y.addClass(S),y.attr(l,ie)),O=0>=se?B.parent:n(this,re[se-1]),A=f(M,O),E=se>=re.length-1?"NULL":re[se+1],P=f(M,E),D=B.children&&B.children.length>0?B.children[0]:"NULL",I=f(M,D),N=f(M,T),T?(N&&N.length>0?(A&&A.length>0?y.insertAfter(A):I&&I.length>0?y.insertBefore(I):P&&P.length>0?y.insertBefore(P):y.insertAfter(N),ae=!0):ae=!1,ne[S+h]=y):(A&&A.length>0?y.insertAfter(A):I&&I.length>0?y.insertBefore(I):P&&P.length>0?y.insertBefore(P):y.appendTo(M),ae=!0),ae&&y.after(this.getHoldingCells(B,h,ne)),b=y.children("span"),b.addClass(p+" "+k).html(H),y=y.css(R).addClass("jstree-grid-cell jstree-grid-cell-root-"+X+" jstree-grid-cell-"+J+" "+m+" "+x+(U?" ui-state-default":"")).addClass("jstree-grid-col-"+h),y.click(G(Y,r,_,L,this)),y.on("contextmenu",Q(Y,r,_,L,this)),y.hover(Z(r,this),ee(r,this)),C&&b.attr("title",C));y.addClass("jstree-grid-cell-last"+(U?" ui-state-default":"")),void 0===F[F.length-1].width&&y.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},25:function(e,t,i){var r=i(1),s=i(3),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);return i.hasClass(this.options.openCls)?(t.removeClass(this.options.openCls),!1):(t.removeClass(this.options.openCls),i.addClass(this.options.openCls),void this._loadContent(i))},_loadContent:function(e){var t=e.data(),i=200;if(!t.lazyUrl||t.loaded)return!1;var s=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},i);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(s)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},26:function(e,t,i){var r=i(1);i(12),i(21);var s=i(3),n=i(2).API.Helpers,a=i(2).KEYS,o=i(25),d=i(27),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){var i=e._getDescendantsIds(t);[t].concat(i).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){var s=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey));s?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){var s=r(i.element),n=s.parent();n.removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){var i=e._getDescendantsIds(t);[t].concat(i).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);return i.parent().hasClass("active")?!1:void e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar"),u=200;_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},u),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t="undefined"==typeof e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";"undefined"!=typeof e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t="undefined"==typeof e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";"undefined"!=typeof e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);
t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"===e.id?!1:"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},27:function(e,t,i){var r=i(1),s=i(3),n=i(2).API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a}});
=======
=======
>>>>>>> 046b030... trimmed bundles
cmsWebpackJsonp([6],{0:function(e,t,i){i(7),i(8);var r=i(2);window.CMS=r,r.PageTree=i(29)},12:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(1)],r=a,n="function"==typeof r?r.apply(t,s):r,!(void 0!==n&&(e.exports=n))}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(s){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(s){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return i!==!0||this.length?(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||i===!0)&&(n=a||!1),null!==n&&n!==t?!1:void 0}),null!==n&&n!==t?n:this):!1},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(t){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(i){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return e.target.tagName&&"input"===e.target.tagName.toLowerCase()?!0:void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget),i&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus());break;case 38:t.preventDefault(),i=this.get_prev_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0],i&&e(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:t.preventDefault(),i=this.get_next_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),i=this._firstChild(this.get_container_ul()[0]),i&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(s){return!1}},get_path:function(t,i,r){if(t=t.parents?t:this.get_node(t),!t||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do r=this._nextSibling(r);while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return r?e(r):!1}if(!t||!t.length)return!1;if(i){r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);return r?e(r):!1}r=t[0];do r=this._previousSibling(r);while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return r=t[0].parentNode.parentNode,r&&r.className&&-1!==r.className.indexOf("jstree-node")?e(r):!1},get_parent:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.parent:!1},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):e&&e.length?e.children(".jstree-children").children(".jstree-node"):!1},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(t=this.get_node(t),!t)return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){r===!1?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){e=this.get_node(e),e&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){s=this._parse_model_from_html(e(i),d,_.parents.concat()),s&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&(i=i.d,"string"==typeof i&&(i=JSON.parse(i))),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do l="j"+_+"_"+ ++u;while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)i=v(a[r],o,f.parents.concat()),i&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&"undefined"!=typeof window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(l){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),i.length?(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString()))):!0}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=d.hasClass("jstree-themeicon-hidden")?!1:d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do l="j"+this._id+"_"+ ++this._cnt;while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr["class"]&&(h.li_attr["class"]=h.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),h.a_attr["class"]&&(h.a_attr["class"]=h.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon!==t?e.icon:!0,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&e.children===!0&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do l="j"+this._id+"_"+ ++this._cnt;while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"==typeof e&&e.icon!==t?e.icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&e.children===!0&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)t=this.redraw_node(s[i],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,
t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null,!(null===a||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&n.icon!==!0||n.icon===!1)&&(n.icon===!1?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):r?r.call(this,e,!1):!1}):(r&&r.call(this,i,!1),!1)):!1},_open_to:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?this.is_closed(i)?!1:(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))):!1},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t})):!1},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t})):!1},is_hidden:function(e){return e=this.get_node(e),e.state.hidden===!0},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t}))):!1},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t}))):!1},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return e=this.get_node(e,!0),e&&e.length&&e.children(".jstree-hovered").length?(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)})):!1},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s})))):!1},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r})))):!1},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.selected:!1},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return e.isEmptyObject(i)?(i=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(t,i){this._data.core.state=i===!0?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),t.state.opened===!0&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,"new":t.id,old:a}),!0},get_text:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.text:!1},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0):!1},get_json:function(t,i,r){if(t=this.get_node(t||e.jstree.root),!t)return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:i&&i.no_data?!1:e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),i=this.get_node(i),!i)return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,i.id,i.parents.concat()),!r)return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(a.functions[t]===!1||a.functions[t]===!0)?(a.functions[t]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),a.functions[t]):o===!1||e.isFunction(o)&&o.call(this,t,i,r,s,n)===!1||o&&o[t]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return(m=this.copy_node(i,r,s,n,a,!1,d))?(g&&g.delete_node(i),m):!1;switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(i=i&&i.id?i:this.get_node(i),!i||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d?d:this._model.data[i.id]?this:e.jstree.reference(i.id),j=!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i,!f)return!1;if(f.id===!0&&delete f.id,f=this._parse_model_from_json(f,m.id,m.parents.concat()),!f)return!1;for(_=this.get_node(f),i&&i.state&&i.state.loaded===!1&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="move_node",void this.trigger("cut",{node:t})):!1},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)i=this.get_node(t[r]),i&&i.id&&i.id!==e.jstree.root&&d.push(i);return d.length?(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t})):!1},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return a!==!1&&n!==!1},paste:function(e,t){return e=this.get_node(e),e&&a&&a.match(/^(copy_node|move_node)$/)&&n?(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1)):!1},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return(t=this.get_node(t))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13===e.which?!1:void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),
a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})):!1},set_theme:function(t,i){if(!t)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return i=this.get_node(i),i&&i.id!==e.jstree.root?(o=i.icon,i.icon=r===!0||null===r||r===t||""===r?!0:r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),r===!1?this.hide_icon(i):r===!0||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),o===!1&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),o===!1&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),o===!1&&this.show_icon(i)),!0):!1},get_icon:function(t){return t=this.get_node(t),t&&t.id!==e.jstree.root?t.icon:!1},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0):!1},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return t=this.get_node(t),t&&t!==e.jstree.root?(s=this.get_node(t,!0),t.icon=s.length?s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0):!1}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)n=o[a.children_d[r]],n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),n=this.get_node(a.parents[r],!0),n&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&l.original.state.undetermined===!0)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0),l&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||t.state[n?"selected":"checked"]===!0||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t})))):!1},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t})))):!1},this.activate_node=function(t,i){return e(i.target).hasClass("jstree-checkbox-disabled")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):this.is_disabled(t)?!1:(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return t=this.get_node(t),t&&t.id!==e.jstree.root?(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):(t=this.get_node(t),t&&t.id!==e.jstree.root?t.state.checked:!1)},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a,o;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(o=this.get_node(t),o&&o.state.loaded))for(s=0,n=o.children_d.length;n>s;s++)this._model.data[o.children_d[s]].state.checked&&(a=!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,o.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(i=this.get_node(i),!i||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return t=i.items[t],t&&(!t._disabled||e.isFunction(t._disabled)&&!t._disabled({item:t,reference:i.reference,element:i.element}))&&t.action?t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}}):!1},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return r?(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(r._disabled===!0||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0),s&&(n+=s)),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0))):!0}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10?n:!1},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u,g=!0;switch(i.element&&i.element.length&&i.element.width(""),g){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth(),d<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20)),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(this),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||e.vakata.context._execute(e(this).attr("rel"))===!1||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();
t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(this.settings.dnd.is_draggable===!0||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if(e=i.redraw_node.apply(this,arguments),e&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if(C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"),C&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),f=f&&(w&&w.settings&&w.settings.dnd&&w.settings.dnd.check_while_dragging===!1||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})),!f){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),g===!0))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}),f);p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0),d&&d.settings.core.error.call(this,r));s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){o=e.vakata.dnd._get(),o&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(t===!0)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(n){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,s!==!1&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),d=this.get_node(t[a],!0),d&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)d=this.get_node(t[a],!0),d&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)d=this.get_node(t[l],!0),d&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(i===!1||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=c.ajax?c.ajax:!1,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&h!==!1)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n?n:e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&this.open_node(f[d],null,0)===!0&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments),t&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),r.fuzzy!==!1&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),y=e.lastIndexOf(t,d+h),-1!==y&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],0===i?p[o]=(p[o+1]<<1|1)&m:p[o]=(p[o+1]<<1|1)&m|((u[o+1]|u[o])<<1|1)|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},i===!0?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if(t=this.get_node(t),t&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(i){return!1}return t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl?!1:(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),t?(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0):!1)},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"default":{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types["default"])for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types["default"])s.types["default"].hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types["default"][a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,o[d[s]].icon===!0&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr["class"]=l[c].li_attr["class"]+" "+o[d[s]].li_attr["class"])}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr["class"]=l[c].a_attr["class"]+" "+o[d[s]].a_attr["class"])}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(l===!1)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(r.check.call(this,i,s,n,a,o)===!1)return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:s&&s.id?s.id:!1,par:n&&n.id?n.id:!1})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(e=this.get_node(e),!e)return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return t=this.get_node(t),t?i?e.extend({type:t.type},this.settings.types[t.type]):t.type:!1},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(d===!0||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon!==t?s[r].icon:!0),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr["class"]=(_[i.id].li_attr["class"]||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr["class"]=(_[i.id].a_attr["class"]||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr["class"]=s[r].li_attr[l]+" "+_[i.id].li_attr["class"],c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr["class"]=s[r].a_attr["class"]+" "+_[i.id].a_attr["class"],h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(r.check.call(this,t,i,s,n,a)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s),!s||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:i&&i.id?i.id:!1,par:s&&s.id?s.id:!1})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),
i=this.get_node(i),!i)return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)s=this.get_node(t.selected[i],!0),s&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(v){}}}})},24:function(e,t,i){var r,s,n;!function(a){s=[i(1),i(12)],r=a,n="function"==typeof r?r.apply(t,s):r,!(void 0!==n&&(e.exports=n))}(function(e){var t,i,r,s,n,a=/^\s*$/g,o=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,d=function(e){return(e||"").replace(o,"\\$&")},l="data-jstreegrid",c="_DATA_",h=24,_=!1,u="jsgrid_",g="_col",f=function(e,t){return e.find("div["+l+"='"+t+"']")},p=!1,m=null,v=0,j=0;s=/<\/?[^>]+>/gi,r=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||h,n.detach(),r.remove(),i._gridSettings.indent=a),a},n=function(e,t){var i,r=e.get_node(t),s=r.children;return i=!s||s.length<=0||!r.state.opened?t:n(e,s[s.length-1])},t=function(e,t){var i,s,n=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,s=n-i*r(e,t),n},i=function(e,t,i){var r,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];r="",a.title&&(a.title===c?r=i.get_text(t):t.attr(a.title)&&(r=t.attr(a.title))),r=r.replace(s,""),r&&n.attr("title",r)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(t,r){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},o=a.columns,d=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){d=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=d,this.rootid=s.attr("id");var l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var c=parseFloat(navigator.appVersion.split("MSIE")[1]);8>c&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(_||(_=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<o.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+d+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)f(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&f(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,f(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,f(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;f(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;f(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)f(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&f(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?f(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,l,c,h=this._gridSettings,_=h.columns||[],u=h.columnWidth,g=h.resizable||!1,f=h.isThemeroller,y=f?"themeroller":"regular",k=!1,x=this.gridparent,b=h.defaultConf,w=0,C=0,S=0;for(this.parent=x,i=0;i<_.length;i++)n=_[i].headerClass||"",a=_[i].columnClass||"",o=_[i].header||"",o&&(k=!0),s=_[i].width||u,C=f?7:10,"auto"!==s&&"string"!=typeof s&&(s-=C),d=0===i?3:0,r=this.midWrapper.children("div.jstree-grid-column-"+i),l=e("<div></div>").css(b).css({"margin-left":d}).addClass("jstree-grid-div-"+this.uniq+"-"+i+" "+(f?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+y+" "+n+" "+a).html(o),l.addClass((f?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+y),l.prependTo(r),S+=l.outerWidth(),c=e("<div class='jstree-grid-separator jstree-grid-separator-"+y+(f?" ui-widget-header":"")+(g?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(l),r.width(s),r.css("min-width",s),r.css("max-width",s);l.addClass((f?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+y),void 0===_[_.length-1].width&&(S-=s,r.css({width:"auto"}),l.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),k?h.header=t:e("div.jstree-grid-header").hide(),!this.bound&&g&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(p){for(o=m.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=m.parent().children("div.jstree-grid-column"),s=[],(isNaN(w)||0>w)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),p=!1,m=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:t===w},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(p){j=e.pageX;var t,i,r,s=j-v;0!==s&&(t=m.width(),i=parseFloat(m.css("width")),i||(i=m.innerWidth()),s=0>s?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(m.width(r),m.css("min-width",r),m.css("max-width",r),v=j))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return p=!0,v=t.pageX,m=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=0>i?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,s){return e=r.redraw_node.call(this,e,t,i,s),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),r.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)f(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,a=e(),o=t.children||[];for(n=0;n<o.length;n++)s=u+d(o[n])+g+i,r[s]&&t.state.opened&&(a=a.add(r[s]).add(this.getHoldingCells(this.get_node(o[n]),i,r)));return a},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){return 13===e.which?!1:void 0}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(t){var r,o,c,h,_,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L,H,z,M,W,K=this._gridSettings,q=K.treeClass,$=this,F=K.columns||[],U=K.isThemeroller,Y=this.element,X=this.rootid,J=U?"themeroller":"regular",B=this.get_node(t),V=K.columnWidth,R=K.defaultConf,G=function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}},Q=function(t,i,r,s,n){return function(t){K.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);$._edit(r,s,t.target)}}}))}},Z=function(e,t){return function(){t.hover_node(e)}},ee=function(e,t){return function(){t.dehover_node(e)}},te=this.midWrapper,ie=B.id,re=this.get_node(B.parent).children,se=e.inArray(ie,re),ne=this.holdingCells,ae=!1;if(r=e(t),j=r.children("a"),1===j.length){for(W=!B.state.opened,S=u+d(ie)+g,T="#"===B.parent?null:B.parent,j.addClass(q),i(j,r,$),y=j,h=0;h<F.length;h++)this.treecol!==h&&(L=F[h],M=te.children("div:eq("+h+")"),p=L.cellClass||"",m=L.wideCellClass||"",v=L.columnClass||"",M.addClass(v),_=void 0!==L.value&&null!==L.value?"function"==typeof L.value?L.value(B):null!==B.data&&void 0!==B.data&&void 0!==B.data[L.value]?B.data[L.value]:"":"","function"==typeof L.format&&(_=L.format(_)),L.images?(c=L.images[_]||L.images["default"],c&&(H="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">')):H=_,(void 0===H||null===H||a.test(H))&&(H="&nbsp;"),k=L.valueClass&&null!==B.data&&void 0!==B.data?B.data[L.valueClass]||"":"",k&&L.valueClassPrefix&&""!==L.valueClassPrefix&&(k=L.valueClassPrefix+k),x=L.wideValueClass&&null!==B.data&&void 0!==B.data?B.data[L.wideValueClass]||"":"",x&&L.wideValueClassPrefix&&""!==L.wideValueClassPrefix&&(x=L.wideValueClassPrefix+x),C=L.title&&null!==B.data&&void 0!==B.data?B.data[L.title]||"":"",C=C.replace(s,""),w=7,o=L.width||V,"auto"!==o&&(o=z||o-w),y=M.children("div#"+S+h),(!y||y.length<1)&&(y=e("<div></div>"),e("<span></span>").appendTo(y),y.attr("id",S+h),y.addClass(S),y.attr(l,ie)),O=0>=se?B.parent:n(this,re[se-1]),A=f(M,O),E=se>=re.length-1?"NULL":re[se+1],P=f(M,E),D=B.children&&B.children.length>0?B.children[0]:"NULL",I=f(M,D),N=f(M,T),T?(N&&N.length>0?(A&&A.length>0?y.insertAfter(A):I&&I.length>0?y.insertBefore(I):P&&P.length>0?y.insertBefore(P):y.insertAfter(N),ae=!0):ae=!1,ne[S+h]=y):(A&&A.length>0?y.insertAfter(A):I&&I.length>0?y.insertBefore(I):P&&P.length>0?y.insertBefore(P):y.appendTo(M),ae=!0),ae&&y.after(this.getHoldingCells(B,h,ne)),b=y.children("span"),b.addClass(p+" "+k).html(H),y=y.css(R).addClass("jstree-grid-cell jstree-grid-cell-root-"+X+" jstree-grid-cell-"+J+" "+m+" "+x+(U?" ui-state-default":"")).addClass("jstree-grid-col-"+h),y.click(G(Y,r,_,L,this)),y.on("contextmenu",Q(Y,r,_,L,this)),y.hover(Z(r,this),ee(r,this)),C&&b.attr("title",C));y.addClass("jstree-grid-cell-last"+(U?" ui-state-default":"")),void 0===F[F.length-1].width&&y.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},28:function(e,t,i){var r=i(1),s=i(3),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);return i.hasClass(this.options.openCls)?(t.removeClass(this.options.openCls),!1):(t.removeClass(this.options.openCls),i.addClass(this.options.openCls),void this._loadContent(i))},_loadContent:function(e){var t=e.data(),i=200;if(!t.lazyUrl||t.loaded)return!1;var s=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},i);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(s)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},29:function(e,t,i){var r=i(1);i(12),i(24);var s=i(3),n=i(2).API.Helpers,a=i(2).KEYS,o=i(28),d=i(30),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){var i=e._getDescendantsIds(t);[t].concat(i).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){var s=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey));s?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){var s=r(i.element),n=s.parent();n.removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){var i=e._getDescendantsIds(t);[t].concat(i).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);return i.parent().hasClass("active")?!1:void e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar"),u=200;_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},u),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t="undefined"==typeof e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";"undefined"!=typeof e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t="undefined"==typeof e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";"undefined"!=typeof e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);
<<<<<<< HEAD
t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"===e.id?!1:"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},30:function(e,t,i){var r=i(1),s=i(3),n=i(2).API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a}});
>>>>>>> daacf92... stripped down bundles
=======
=======
>>>>>>> 344010a... adding, editing, removing in structureboard
cmsWebpackJsonp([2],[
/* 0 */
/***/ function(module, exports, __webpack_require__) {
=======
cmsWebpackJsonp([1],{
>>>>>>> bce127b... webpack setup

/***/ 105:
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*\n * https://github.com/deitch/jstree-grid\n *\n * This plugin handles adding a grid to a tree to display additional data\n *\n * Licensed under the MIT license:\n *   http://www.opensource.org/licenses/mit-license.php\n *\n * Works only with jstree version >= 3.0.0\n *\n * $Date: 2015-11-29 $\n * $Revision:  3.4.2 $\n *\n * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n * !!!                                                                         !!!\n * !!!   IMPORTANT it says 3.4.2 but it's actually 3.4.4, and it's modified!   !!!\n * !!!   line 646, same as: https://github.com/deitch/jstree-grid/pull/165     !!!\n * !!!                                                                         !!!\n * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n */\n\n/*jslint nomen:true */\n/*jshint unused:vars */\n/*global navigator, document, jQuery, define */\n\n/* AMD support added by jochenberger per https://github.com/deitch/jstree-grid/pull/49\n *\n */\n(function (factory) {\n    if (true) {\n        // AMD. Register as an anonymous module.\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0), __webpack_require__(85)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n}(function ($) {\n    var renderAWidth, renderATitle, getIndent, htmlstripre, findLastClosedNode, BLANKRE = /^\\s*$/g,\n        IDREGEX = /[\\\\:&!^|()\\[\\]<>@*'+~#\";,= \\/${}%]/g, escapeId = function (id) {\n            return (id||\"\").replace(IDREGEX,'\\\\$&');\n        }, NODE_DATA_ATTR = \"data-jstreegrid\",\n    SPECIAL_TITLE = \"_DATA_\", LEVELINDENT = 24, styled = false, GRIDCELLID_PREFIX = \"jsgrid_\",GRIDCELLID_POSTFIX = \"_col\",\n        findDataCell = function (from,id) {\n            return from.find(\"div[\"+NODE_DATA_ATTR+\"='\"+id+\"']\");\n        },\n        isClickedSep = false, toResize = null, oldMouseX = 0, newMouseX = 0;\n\n    /*jslint regexp:true */\n    htmlstripre = /<\\/?[^>]+>/gi;\n    /*jslint regexp:false */\n\n    getIndent = function(node,tree) {\n        var div, i, li, width;\n\n        // did we already save it for this tree?\n        tree._gridSettings = tree._gridSettings || {};\n        if (tree._gridSettings.indent > 0) {\n            width = tree._gridSettings.indent;\n        } else {\n            // create a new div on the DOM but not visible on the page\n            div = $(\"<div></div>\");\n            i = node.prev(\"i\");\n            li = i.parent();\n            // add to that div all of the classes on the tree root\n            div.addClass(tree.get_node(\"#\",true).attr(\"class\"));\n\n            // move the li to the temporary div root\n            li.appendTo(div);\n\n            // attach to the body quickly\n            div.appendTo($(\"body\"));\n\n            // get the width\n            width = i.width() || LEVELINDENT;\n\n            // detach the li from the new div and destroy the new div\n            li.detach();\n            div.remove();\n\n            // save it for the future\n            tree._gridSettings.indent = width;\n        }\n\n\n        return(width);\n\n    };\n\n    findLastClosedNode = function (tree,id) {\n        // first get our node\n        var ret, node = tree.get_node(id), children = node.children;\n        // is it closed?\n        if (!children || children.length <= 0 || !node.state.opened) {\n            ret = id;\n        } else {\n            ret = findLastClosedNode(tree,children[children.length-1]);\n        }\n        return(ret);\n    };\n\n    renderAWidth = function(node,tree) {\n        var depth, width,\n        fullWidth = parseInt(tree.settings.grid.columns[0].width,10) + parseInt(tree._gridSettings.treeWidthDiff,10);\n        // need to use a selector in jquery 1.4.4+\n        depth = tree.get_node(node).parents.length;\n        width = fullWidth - depth*getIndent(node,tree);\n        // the following line is no longer needed, since we are doing this inside a <td>\n        //a.css({\"vertical-align\": \"top\", \"overflow\":\"hidden\"});\n        return(fullWidth);\n    };\n    renderATitle = function(node,t,tree) {\n        var a = node.get(0).tagName.toLowerCase() === \"a\" ? node : node.children(\"a\"), title, col = tree.settings.grid.columns[0];\n        // get the title\n        title = \"\";\n        if (col.title) {\n            if (col.title === SPECIAL_TITLE) {\n                title = tree.get_text(t);\n            } else if (t.attr(col.title)) {\n                title = t.attr(col.title);\n            }\n        }\n        // strip out HTML\n        title = title.replace(htmlstripre, '');\n        if (title) {\n            a.attr(\"title\",title);\n        }\n    };\n\n    $.jstree.defaults.grid = {\n        width: 'auto'\n    };\n\n    $.jstree.plugins.grid = function(options,parent) {\n        this._initialize = function () {\n            if (!this._initialized) {\n                var s = this.settings.grid || {}, styles,    container = this.element, gridparent = container.parent(), i,\n                gs = this._gridSettings = {\n                    columns : s.columns || [],\n                    treeClass : \"jstree-grid-col-0\",\n                    context: s.contextmenu || false,\n                    columnWidth : s.columnWidth,\n                    defaultConf : {\"*display\":\"inline\",\"*+display\":\"inline\"},\n                    isThemeroller : !!this._data.themeroller,\n                    treeWidthDiff : 0,\n                    resizable : s.resizable,\n                    indent: 0\n                }, cols = gs.columns, treecol = 0;\n                // find which column our tree shuld go in\n                for (i=0;i<s.columns.length;i++) {\n                    if (s.columns[i].tree) {\n                        // save which column it was\n                        treecol = i;\n                        // do not check any others\n                        break;\n                    }\n                }\n                // set a unique ID for this table\n                this.uniq = Math.ceil(Math.random()*1000);\n                this.treecol = treecol;\n                this.rootid = container.attr(\"id\");\n\n                var msie = /msie/.test(navigator.userAgent.toLowerCase());\n                if (msie) {\n                    var version = parseFloat(navigator.appVersion.split(\"MSIE\")[1]);\n                    if (version < 8) {\n                        gs.defaultConf.display = \"inline\";\n                        gs.defaultConf.zoom = \"1\";\n                    }\n                }\n\n                // set up the classes we need\n                if (!styled) {\n                    styled = true;\n                    styles = [\n                        '.jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}',\n                        '.jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}',\n                        '.jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}',\n              '.jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}',\n                        '.jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}',\n                        '.jstree-grid-header-regular {background-color: #EBF3FD;}',\n                        '.jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}',\n                        '.jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}',\n                        '.jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}',\n                        '.jstree-grid-wrapper {width: 100%; overflow-x: auto;}',\n                        '.jstree-grid-midwrapper {display: table-row; overflow: visible;}',\n                        '.jstree-grid-width-auto {width:auto;display:block;}',\n                        '.jstree-grid-column {display: table-cell; overflow: hidden;}',\n                        '.jstree-grid-col-0 {width: 100%;}'\n                    ];\n\n                    $('<style type=\"text/css\">'+styles.join(\"\\n\")+'</style>').appendTo(\"head\");\n                }\n                this.gridWrapper = $(\"<div></div>\").addClass(\"jstree-grid-wrapper\").appendTo(gridparent);\n                this.midWrapper = $(\"<div></div>\").addClass(\"jstree-grid-midwrapper\").appendTo(this.gridWrapper);\n                // set the wrapper width\n                if (s.width) {\n                    this.gridWrapper.width(s.width);\n                }\n                // create the data columns\n                for (i=0;i<cols.length;i++) {\n                    // create the column\n                    $(\"<div></div>\").addClass(\"jstree-grid-column jstree-grid-column-\"+i+\" jstree-grid-column-root-\"+this.rootid).appendTo(this.midWrapper);\n                }\n                this.midWrapper.children(\"div:eq(\"+treecol+\")\").append(container);\n                container.addClass(\"jstree-grid-cell\");\n\n                this._initialized = true;\n            }\n        };\n        this.init = function (el,options) {\n            parent.init.call(this,el,options);\n            this._initialize();\n        };\n        this.bind = function () {\n            parent.bind.call(this);\n            this._initialize();\n            this.element\n            .on(\"move_node.jstree create_node.jstree clean_node.jstree change_node.jstree\", $.proxy(function (e, data) {\n                var target = this.get_node(data || \"#\",true);\n                this._prepare_grid(target);\n            }, this))\n            .on(\"delete_node.jstree\",$.proxy(function (e,data) {\n                if (data.node.id !== undefined) {\n                    var grid = this.gridWrapper, removeNodes = [data.node.id], i;\n                    // add children to remove list\n                    if (data.node && data.node.children_d) {\n                        removeNodes = removeNodes.concat(data.node.children_d);\n                    }\n                    for (i=0;i<removeNodes.length;i++) {\n                        findDataCell(grid,removeNodes[i]).remove();\n                    }\n                }\n            }, this))\n            .on(\"close_node.jstree\",$.proxy(function (e,data) {\n                this._hide_grid(data.node);\n            }, this))\n            .on(\"open_node.jstree\",$.proxy(function (e,data) {\n            }, this))\n            .on(\"load_node.jstree\",$.proxy(function (e,data) {\n            }, this))\n            .on(\"loaded.jstree\", $.proxy(function (e) {\n                this._prepare_headers();\n                this.element.trigger(\"loaded_grid.jstree\");\n                }, this))\n            .on(\"ready.jstree\",$.proxy(function (e,data) {\n                // find the line-height of the first known node\n                var anchorHeight = this.element.find(\"li a:first\").outerHeight();\n                $('<style type=\"text/css\">div.jstree-grid-cell-root-'+this.rootid+' {line-height: '+anchorHeight+'px}</style>').appendTo(\"head\");\n\n                // add container classes to the wrapper\n                this.gridWrapper.addClass(this.element.attr(\"class\"));\n\n            },this))\n            .on(\"move_node.jstree\",$.proxy(function(e,data){\n                var node = data.new_instance.element;\n                //renderAWidth(node,this);\n                // check all the children, because we could drag a tree over\n                node.find(\"li > a\").each($.proxy(function(i,elm){\n                    //renderAWidth($(elm),this);\n                },this));\n\n            },this))\n            .on(\"hover_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                if (this._hover_node !== null && this._hover_node !== undefined) {\n                    findDataCell(this.gridWrapper,this._hover_node).removeClass(\"jstree-hovered\");\n                }\n                this._hover_node = id;\n                findDataCell(this.gridWrapper,id).addClass(\"jstree-hovered\");\n            },this))\n            .on(\"dehover_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                this._hover_node = null;\n                findDataCell(this.gridWrapper,id).removeClass(\"jstree-hovered\");\n            },this))\n            .on(\"select_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                findDataCell(this.gridWrapper,id).addClass(\"jstree-clicked\");\n                this.get_node(selected.node.id,true).children(\"div.jstree-grid-cell\").addClass(\"jstree-clicked\");\n            },this))\n            .on(\"deselect_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                findDataCell(this.gridWrapper,id).removeClass(\"jstree-hovered\");\n            },this))\n            .on(\"deselect_all.jstree\",$.proxy(function(node,selected,event){\n                // get all of the ids that were unselected\n                var ids = selected.node || [], i;\n                for (i=0;i<ids.length;i++) {\n                    findDataCell(this.gridWrapper,ids[i]).removeClass(\"jstree-clicked\");\n                }\n            },this))\n            .on(\"search.jstree\", $.proxy(function (e, data) {\n                // search sometimes filters, so we need to hide all of the appropriate grid cells as well, and show only the matches\n                var grid = this.gridWrapper;\n                if(this._data.search.som) {\n                    if(data.nodes.length) {\n                        // hide all of the grid cells\n                        grid.find('div.jstree-grid-cell:not(:first)').hide();\n                        // show only those that match\n                        data.nodes.add(data.nodes.parentsUntil(\".jstree\")).filter(\".jstree-node\").each(function (i,node) {\n                            var id = node.id;\n                            if (id) {\n                                findDataCell(grid,id).show();\n                            }\n                        });\n                    }\n                }\n                return true;\n            }, this))\n            .on(\"clear_search.jstree\", $.proxy(function (e, data) {\n                // search has been cleared, so we need to show all rows\n                this.gridWrapper.find('div.jstree-grid-cell').show();\n                return true;\n            }, this))\n            ;\n            if (this._gridSettings.isThemeroller) {\n                this.element\n                    .on(\"select_node.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").addClass(\"ui-state-active\");\n                    },this))\n                    .on(\"deselect_node.jstree deselect_all.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").removeClass(\"ui-state-active\");\n                    },this))\n                    .on(\"hover_node.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").addClass(\"ui-state-hover\");\n                    },this))\n                    .on(\"dehover_node.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").removeClass(\"ui-state-hover\");\n                    },this));\n            }\n        };\n        // tear down the tree entirely\n        this.teardown = function() {\n            var gw = this.gridWrapper, container = this.element, gridparent = gw.parent();\n            container.detach();\n            gw.remove();\n            gridparent.append(container);\n            parent.teardown.call(this);\n        };\n        // clean the grid in case of redraw or refresh entire tree\n        this._clean_grid = function (target,id) {\n            var grid = this.gridWrapper;\n            if (target) {\n                findDataCell(grid,id).remove();\n            } else {\n                // get all of the `div` children in all of the `td` in dataRow except for :first (that is the tree itself) and remove\n                grid.find(\"div.jstree-grid-cell:not(:first)\").remove();\n            }\n        };\n        // prepare the headers\n        this._prepare_headers = function() {\n            var header, i, col, gs = this._gridSettings,cols = gs.columns || [], width, defaultWidth = gs.columnWidth, resizable = gs.resizable || false,\n            cl, ccl, val, margin, last, tr = gs.isThemeroller, classAdd = (tr?\"themeroller\":\"regular\"), puller,\n            hasHeaders = false, gridparent = this.gridparent,\n            conf = gs.defaultConf,\n            colNum = 0, borPadWidth = 0, totalWidth = 0;\n            // save the original parent so we can reparent on destroy\n            this.parent = gridparent;\n\n\n            // create the headers\n            for (i=0;i<cols.length;i++) {\n                //col = $(\"<col/>\");\n                //col.appendTo(colgroup);\n                cl = cols[i].headerClass || \"\";\n                ccl = cols[i].columnClass || \"\";\n                val = cols[i].header || \"\";\n                if (val) {hasHeaders = true;}\n                width = cols[i].width || defaultWidth;\n\n                // we only deal with borders if width is not auto and not percentages\n                borPadWidth = tr ? 1+6 : 2+8; // account for the borders and padding\n                if (width !== 'auto' && typeof(width) !== \"string\") {\n                    width -= borPadWidth;\n                }\n                margin = i === 0 ? 3 : 0;\n                col = this.midWrapper.children(\"div.jstree-grid-column-\"+i);\n                last = $(\"<div></div>\").css(conf).css({\"margin-left\": margin}).addClass(\"jstree-grid-div-\"+this.uniq+\"-\"+i+\" \"+(tr?\"ui-widget-header \":\"\")+\" jstree-grid-header jstree-grid-header-cell jstree-grid-header-\"+classAdd+\" \"+cl+\" \"+ccl).html(val);\n                last.addClass((tr?\"ui-widget-header \":\"\")+\"jstree-grid-header jstree-grid-header-\"+classAdd);\n                last.prependTo(col);\n                totalWidth += last.outerWidth();\n                puller = $(\"<div class='jstree-grid-separator jstree-grid-separator-\"+classAdd+(tr ? \" ui-widget-header\" : \"\")+(resizable? \" jstree-grid-resizable-separator\":\"\")+\"'>&nbsp;</div>\").appendTo(last);\n                col.width(width);\n                col.css(\"min-width\",width);\n                col.css(\"max-width\",width);\n            }\n\n            last.addClass((tr?\"ui-widget-header \":\"\")+\"jstree-grid-header jstree-grid-header-last jstree-grid-header-\"+classAdd);\n            // if there is no width given for the last column, do it via automatic\n            if (cols[cols.length-1].width === undefined) {\n                totalWidth -= width;\n                col.css({width:\"auto\"});\n                last.addClass(\"jstree-grid-width-auto\").next(\".jstree-grid-separator\").remove();\n            }\n            if (hasHeaders) {\n                // save the offset of the div from the body\n                //gs.divOffset = header.parent().offset().left;\n                gs.header = header;\n            } else {\n                $(\"div.jstree-grid-header\").hide();\n            }\n\n            if (!this.bound && resizable) {\n                this.bound = true;\n                $(document).mouseup(function () {\n                    var  i, ref, cols, widths, headers, w, currentTree;\n                    if (isClickedSep) {\n                        currentTree = toResize.closest(\".jstree-grid-wrapper\").find(\".jstree\");\n                        ref = $.jstree.reference(currentTree);\n                        cols = ref.settings.grid.columns;\n                        headers = toResize.parent().children(\"div.jstree-grid-column\");\n                        widths = [];\n                        if (isNaN(colNum) || colNum < 0) { ref._gridSettings.treeWidthDiff = currentTree.find(\"ins:eq(0)\").width() + currentTree.find(\"a:eq(0)\").width() - ref._gridSettings.columns[0].width; }\n                        isClickedSep = false;\n                        toResize = null;\n                        for (i=0;i<cols.length;i++) {\n                            w = parseFloat(headers[i].style.width);\n                            widths[i] = {w: w, r: i===colNum };\n                            ref._gridSettings.columns[i].width = w;\n                        }\n\n                        currentTree.trigger(\"resize_column.jstree-grid\", widths);\n                    }\n                }).mousemove(function (e) {\n                        if (isClickedSep) {\n                            newMouseX = e.pageX;\n                            var diff = newMouseX - oldMouseX,\n                            oldPrevHeaderInner,\n                            oldPrevColWidth, newPrevColWidth;\n\n                            if (diff !== 0){\n                                oldPrevHeaderInner = toResize.width();\n                                oldPrevColWidth = parseFloat(toResize.css(\"width\"));\n\n                                // handle a Chrome issue with columns set to auto\n                                // thanks to Brabus https://github.com/side-by-side\n                                if (!oldPrevColWidth) {oldPrevColWidth = toResize.innerWidth();}\n\n                                // make sure that diff cannot be beyond the left/right limits\n                                diff = diff < 0 ? Math.max(diff,-oldPrevHeaderInner) : diff;\n                                newPrevColWidth = (oldPrevColWidth+diff)+\"px\";\n\n                                // only do this if we are not shrinking past 0 on left - and limit it to that amount\n                                if (diff > 0 || oldPrevHeaderInner > 0) {\n                                    toResize.width(newPrevColWidth);\n                                    toResize.css(\"min-width\",newPrevColWidth);\n                                    toResize.css(\"max-width\",newPrevColWidth);\n                                    oldMouseX = newMouseX;\n                                }\n                            }\n                        }\n                    });\n                this.gridWrapper.on(\"selectstart\", \".jstree-grid-resizable-separator\", function () {\n                    return false;\n                }).on(\"mousedown\", \".jstree-grid-resizable-separator\", function (e) {\n                    isClickedSep = true;\n                    oldMouseX = e.pageX;\n                    toResize = $(this).closest(\"div.jstree-grid-column\");\n                    // the max rightmost position we will allow is the right-most of the wrapper minus a buffer (10)\n                    return false;\n                })\n                .on(\"dblclick\", \".jstree-grid-resizable-separator\", function (e) {\n                    var clickedSep = $(this), col = clickedSep.closest(\"div.jstree-grid-column\"),\n                    oldPrevColWidth = parseFloat(col.css(\"width\")), newWidth = 0, diff,\n                    oldPrevHeaderInner = col.width(), newPrevColWidth;\n\n\n                    //find largest width\n                    col.find(\".jstree-grid-cell\").each(function() {\n                        var item = $(this), width;\n                        item.css(\"position\", \"absolute\");\n                        item.css(\"width\", \"auto\");\n                        width = item.outerWidth();\n                        item.css(\"position\", \"relative\");\n\n                        if (width>newWidth) {\n                            newWidth = width;\n                        }\n                    });\n\n                    diff = newWidth-oldPrevColWidth;\n\n                    // make sure that diff cannot be beyond the left limits\n                    diff = diff < 0 ? Math.max(diff,-oldPrevHeaderInner) : diff;\n                    newPrevColWidth = (oldPrevColWidth+diff)+\"px\";\n\n                    col.width(newPrevColWidth);\n                    col.css(\"min-width\",newPrevColWidth);\n                    col.css(\"max-width\",newPrevColWidth);\n                });\n            }\n        };\n        /*\n         * Override redraw_node to correctly insert the grid\n         */\n        this.redraw_node = function(obj, deep, is_callback, force_render) {\n            // first allow the parent to redraw the node\n            obj = parent.redraw_node.call(this, obj, deep, is_callback, force_render);\n            // next prepare the grid\n            if(obj) {\n                this._prepare_grid(obj);\n            }\n            return obj;\n        };\n        this.refresh = function () {\n            this._clean_grid();\n            return parent.refresh.apply(this,arguments);\n        };\n        this._hide_grid = function (node) {\n            var children = node && node.children_d ? node.children_d : [], i;\n            // go through each column, remove all children with the correct ID name\n            for (i=0;i<children.length;i++) {\n                findDataCell(this.gridWrapper,children[i]).remove();\n            }\n        };\n        this.holdingCells = {};\n        this.getHoldingCells = function (obj,col,hc) {\n            var ret = $(), children = obj.children||[], child, i;\n            // run through each child, render it, and then render its children recursively\n            for (i=0;i<children.length;i++) {\n                child = GRIDCELLID_PREFIX+escapeId(children[i])+GRIDCELLID_POSTFIX+col;\n                if (hc[child] && obj.state.opened) {\n                    ret = ret.add(hc[child]).add(this.getHoldingCells(this.get_node(children[i]),col,hc));\n                    //delete hc[child];\n                }\n            }\n            return(ret);\n        };\n        /**\n         * put a grid cell in edit mode (input field to edit the data)\n         * @name edit(obj, col)\n         * @param  {mixed} obj\n         * @param  {obj} col definition\n         * @param  {element} cell element, either span or wrapping div\n         */\n        this._edit = function (obj, col, element) {\n            if(!obj) { return false; }\n            if (element) {\n                element = $(element);\n                if (element.prop(\"tagName\").toLowerCase() === \"div\") {\n                    element = element.children(\"span:first\");\n                }\n            } else {\n                // need to find the element - later\n                return false;\n            }\n            var rtl = this._data.core.rtl,\n                w  = this.element.width(),\n                t = obj.data[col.value],\n                h1 = $(\"<\"+\"div />\", { css : { \"position\" : \"absolute\", \"top\" : \"-200px\", \"left\" : (rtl ? \"0px\" : \"-1000px\"), \"visibility\" : \"hidden\" } }).appendTo(\"body\"),\n                h2 = $(\"<\"+\"input />\", {\n                        \"value\" : t,\n                        \"class\" : \"jstree-rename-input\",\n                        \"css\" : {\n                            \"padding\" : \"0\",\n                            \"border\" : \"1px solid silver\",\n                            \"box-sizing\" : \"border-box\",\n                            \"display\" : \"inline-block\",\n                            \"height\" : (this._data.core.li_height) + \"px\",\n                            \"lineHeight\" : (this._data.core.li_height) + \"px\",\n                            \"width\" : \"150px\" // will be set a bit further down\n                        },\n                        \"blur\" : $.proxy(function () {\n                            var v = h2.val();\n                            // save the value if changed\n                            if(v === \"\" || v === t) {\n                                v = t;\n                            } else {\n                                obj.data[col.value] = v;\n                                this.element.trigger('update_cell.jstree-grid',{node:obj, col:col.value, value:v, old:t});\n                                this._prepare_grid(this.get_node(obj,true));\n                            }\n                            h2.remove();\n                            element.show();\n                        }, this),\n                        \"keydown\" : function (event) {\n                            var key = event.which;\n                            if(key === 27) {\n                                this.value = t;\n                            }\n                            if(key === 27 || key === 13 || key === 37 || key === 38 || key === 39 || key === 40 || key === 32) {\n                                event.stopImmediatePropagation();\n                            }\n                            if(key === 27 || key === 13) {\n                                event.preventDefault();\n                                this.blur();\n                            }\n                        },\n                        \"click\" : function (e) { e.stopImmediatePropagation(); },\n                        \"mousedown\" : function (e) { e.stopImmediatePropagation(); },\n                        \"keyup\" : function (event) {\n                            h2.width(Math.min(h1.text(\"pW\" + this.value).width(),w));\n                        },\n                        \"keypress\" : function(event) {\n                            if(event.which === 13) { return false; }\n                        }\n                    }),\n                fn = {\n                        fontFamily        : element.css('fontFamily')        || '',\n                        fontSize        : element.css('fontSize')            || '',\n                        fontWeight        : element.css('fontWeight')        || '',\n                        fontStyle        : element.css('fontStyle')        || '',\n                        fontStretch        : element.css('fontStretch')        || '',\n                        fontVariant        : element.css('fontVariant')        || '',\n                        letterSpacing    : element.css('letterSpacing')    || '',\n                        wordSpacing        : element.css('wordSpacing')        || ''\n                };\n            element.hide();\n            element.parent().append(h2);\n            h2.css(fn).width(Math.min(h1.text(\"pW\" + h2[0].value).width(),w))[0].select();\n        };\n        this._prepare_grid = function (obj) {\n            var gs = this._gridSettings, c = gs.treeClass, _this = this, t, cols = gs.columns || [], width, tr = gs.isThemeroller,\n            tree = this.element, rootid = this.rootid,\n            classAdd = (tr?\"themeroller\":\"regular\"), img, objData = this.get_node(obj),\n            defaultWidth = gs.columnWidth, conf = gs.defaultConf, cellClickHandler = function (tree,node,val,col,t) {\n                return function(e) {\n                    //node = tree.find(\"#\"+node.attr(\"id\"));\n                    node.children(\".jstree-anchor\").trigger(\"click.jstree\",e);\n                    tree.trigger(\"select_cell.jstree-grid\", [{value: val,column: col.header,node: node,grid:$(this),sourceName: col.value}]);\n                };\n            }, cellRightClickHandler = function (tree,node,val,col,t) {\n                return function (e) {\n                    if (gs.context) {\n                        e.preventDefault();\n                        $.vakata.context.show(this,{ 'x' : e.pageX, 'y' : e.pageY },{\n                            \"edit\":{label:\"Edit\",\"action\": function (data) {\n                                var obj = t.get_node(node);\n                                _this._edit(obj,col,e.target);\n                            }}\n                        });\n                    }\n                };\n            },\n            hoverInHandler = function (node, jsTreeInstance) {\n                return function() { jsTreeInstance.hover_node(node); };\n            },\n            hoverOutHandler = function (node, jsTreeInstance) {\n                return function() { jsTreeInstance.dehover_node(node); };\n            },\n            i, val, cl, wcl, ccl, a, last, valClass, wideValClass, span, paddingleft, title, gridCellName, gridCellParentId, gridCellParent,\n            gridCellPrev, gridCellPrevId, gridCellNext, gridCellNextId, gridCellChild, gridCellChildId,\n            col, content, tmpWidth, mw = this.midWrapper, dataCell, lid = objData.id,\n            peers = this.get_node(objData.parent).children,\n            // find my position in the list of peers. \"peers\" is the list of everyone at my level under my parent, in order\n            pos = $.inArray(lid,peers),\n            hc = this.holdingCells, rendered = false, closed;\n            // get our column definition\n            t = $(obj);\n\n            // find the a children\n            a = t.children(\"a\");\n\n            if (a.length === 1) {\n                closed = !objData.state.opened;\n                gridCellName = GRIDCELLID_PREFIX+escapeId(lid)+GRIDCELLID_POSTFIX;\n                gridCellParentId = objData.parent === \"#\" ? null : objData.parent;\n                a.addClass(c);\n                //renderAWidth(a,_this);\n                renderATitle(a,t,_this);\n                last = a;\n                for (i=0;i<cols.length;i++) {\n                    if (this.treecol === i) {\n                        continue;\n                    }\n                    col = cols[i];\n                    dataCell = mw.children(\"div:eq(\"+i+\")\");\n                    // get the cellClass, the wideCellClass, and the columnClass\n                    cl = col.cellClass || \"\";\n                    wcl = col.wideCellClass || \"\";\n                    ccl = col.columnClass || \"\";\n\n                    // add a column class to the dataCell\n                    dataCell.addClass(ccl);\n\n\n                    // get the contents of the cell - value could be a string or a function\n                    if (col.value !== undefined && col.value !== null) {\n                        if (typeof(col.value) === \"function\") {\n                            val = col.value(objData);\n                        } else if (objData.data !== null && objData.data !== undefined && objData.data[col.value] !== undefined) {\n                            val = objData.data[col.value];\n                        } else {\n                            val = \"\";\n                        }\n                    } else {\n                        val = \"\";\n                    }\n\n                    if (typeof(col.format) === \"function\") {\n                        val = col.format(val);\n                    }\n\n                    // put images instead of text if needed\n                    if (col.images) {\n                    img = col.images[val] || col.images[\"default\"];\n                    if (img) {content = img[0] === \"*\" ? '<span class=\"'+img.substr(1)+'\"></span>' : '<img src=\"'+img+'\">';}\n                    } else { content = val; }\n\n                    // content cannot be blank, or it messes up heights\n                    if (content === undefined || content === null || BLANKRE.test(content)) {\n                        content = \"&nbsp;\";\n                    }\n\n                    // get the valueClass\n                    valClass = col.valueClass && objData.data !== null && objData.data !== undefined ? objData.data[col.valueClass] || \"\" : \"\";\n                    if (valClass && col.valueClassPrefix && col.valueClassPrefix !== \"\") {\n                        valClass = col.valueClassPrefix + valClass;\n                    }\n                    // get the wideValueClass\n                    wideValClass = col.wideValueClass && objData.data !== null && objData.data !== undefined ? objData.data[col.wideValueClass] || \"\" : \"\";\n                    if (wideValClass && col.wideValueClassPrefix && col.wideValueClassPrefix !== \"\") {\n                        wideValClass = col.wideValueClassPrefix + wideValClass;\n                    }\n                    // get the title\n                    title = col.title && objData.data !== null && objData.data !== undefined ? objData.data[col.title] || \"\" : \"\";\n                    // strip out HTML\n                    title = title.replace(htmlstripre, '');\n\n                    // get the width\n                    paddingleft = 7;\n                    width = col.width || defaultWidth;\n                    if (width !== 'auto') {\n                        width = tmpWidth || (width - paddingleft);\n                    }\n\n                    last = dataCell.children(\"div#\"+gridCellName+i);\n                    if (!last || last.length < 1) {\n                        last = $(\"<div></div>\");\n                        $(\"<span></span>\").appendTo(last);\n                        last.attr(\"id\",gridCellName+i);\n                        last.addClass(gridCellName);\n                        last.attr(NODE_DATA_ATTR,lid);\n\n                    }\n                    // we need to put it in the dataCell - after the parent, but the position matters\n                    // if we have no parent, then we are one of the root nodes, but still need to look at peers\n\n\n                    // if we are first, i.e. pos === 0, we go right after the parent;\n                    // if we are not first, and our previous peer (one before us) is closed, we go right after the previous peer cell\n                    // if we are not first, and our previous peer is opened, then we have to find its youngest & lowest closed child (incl. leaf)\n                    //\n                    // probably be much easier to go *before* our next one\n                    // but that one might not be drawn yet\n                    // here is the logic for jstree drawing:\n                    //   it draws peers from first to last or from last to first\n                    //   it draws children before a parent\n                    //\n                    // so I can rely on my *parent* not being drawn, but I cannot rely on my previous peer or my next peer being drawn\n\n                    // so we do the following:\n                    //   1- We are the first child: install after the parent\n                    //   2- Our previous peer is already drawn: install after the previous peer\n                    //   3- Our previous peer is not drawn, we have a child that is drawn: install right before our first child\n                    //   4- Our previous peer is not drawn, we have no child that is drawn, our next peer is drawn: install right before our next peer\n                    //   5- Our previous peer is not drawn, we have no child that is drawn, our next peer is not drawn: install right after parent\n                    gridCellPrevId = pos <=0 ? objData.parent : findLastClosedNode(this,peers[pos-1]);\n                    gridCellPrev = findDataCell(dataCell,gridCellPrevId);\n                    gridCellNextId = pos >= peers.length-1 ? \"NULL\" : peers[pos+1];\n                    gridCellNext = findDataCell(dataCell,gridCellNextId);\n                    gridCellChildId = objData.children && objData.children.length > 0 ? objData.children[0] : \"NULL\";\n                    gridCellChild = findDataCell(dataCell,gridCellChildId);\n                    gridCellParent = findDataCell(dataCell,gridCellParentId);\n\n\n                    // if our parent is already drawn, then we put this in the right order under our parent\n                    if (gridCellParentId) {\n                        if (gridCellParent && gridCellParent.length > 0) {\n                            if (gridCellPrev && gridCellPrev.length > 0) {\n                                last.insertAfter(gridCellPrev);\n                            } else if (gridCellChild && gridCellChild.length > 0) {\n                                last.insertBefore(gridCellChild);\n                            } else if (gridCellNext && gridCellNext.length > 0) {\n                                last.insertBefore(gridCellNext);\n                            } else {\n                                last.insertAfter(gridCellParent);\n                            }\n                            rendered = true;\n                        } else {\n                            rendered = false;\n                        }\n                        // always put it in the holding cells, and then sort when the parent comes in, in case parent is (re)drawn later\n                        hc[gridCellName+i] = last;\n                    } else {\n                        if (gridCellPrev && gridCellPrev.length > 0) {\n                            last.insertAfter(gridCellPrev);\n                        } else if (gridCellChild && gridCellChild.length > 0) {\n                            last.insertBefore(gridCellChild);\n                        } else if (gridCellNext && gridCellNext.length > 0) {\n                            last.insertBefore(gridCellNext);\n                        } else {\n                            last.appendTo(dataCell);\n                        }\n                        rendered = true;\n                    }\n                    // do we have any children waiting for this cell? walk down through the children/grandchildren/etc tree\n                    if (rendered) {\n                        last.after(this.getHoldingCells(objData,i,hc));\n                    }\n                    // need to make the height of this match the line height of the tree. How?\n                    span = last.children(\"span\");\n\n                    // create a span inside the div, so we can control what happens in the whole div versus inside just the text/background\n                    span.addClass(cl+\" \"+valClass).html(content);\n                    last = last.css(conf).addClass(\"jstree-grid-cell jstree-grid-cell-root-\"+rootid+\" jstree-grid-cell-\"+classAdd+\" \"+wcl+ \" \" + wideValClass + (tr?\" ui-state-default\":\"\")).addClass(\"jstree-grid-col-\"+i);\n                    // add click handler for clicking inside a grid cell\n                    last.click(cellClickHandler(tree,t,val,col,this));\n                    last.on(\"contextmenu\",cellRightClickHandler(tree,t,val,col,this));\n                    last.hover(hoverInHandler(t, this), hoverOutHandler(t, this));\n\n                    if (title) {\n                        span.attr(\"title\",title);\n                    }\n\n                }\n                last.addClass(\"jstree-grid-cell-last\"+(tr?\" ui-state-default\":\"\"));\n                // if there is no width given for the last column, do it via automatic\n                if (cols[cols.length-1].width === undefined) {\n                    last.addClass(\"jstree-grid-width-auto\").next(\".jstree-grid-separator\").remove();\n                }\n            }\n            this.element.css({'overflow-y':'auto !important'});\n        };\n        // clean up holding cells\n        this.holdingCells = {};\n\n        // need to do alternating background colors or borders\n    };\n}));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vY21zL3N0YXRpYy9jbXMvanMvbGlicy9qc3RyZWUvanN0cmVlLmdyaWQubWluLmpzPzY3NzAiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9kZWl0Y2gvanN0cmVlLWdyaWRcbiAqXG4gKiBUaGlzIHBsdWdpbiBoYW5kbGVzIGFkZGluZyBhIGdyaWQgdG8gYSB0cmVlIHRvIGRpc3BsYXkgYWRkaXRpb25hbCBkYXRhXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlOlxuICogICBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICpcbiAqIFdvcmtzIG9ubHkgd2l0aCBqc3RyZWUgdmVyc2lvbiA+PSAzLjAuMFxuICpcbiAqICREYXRlOiAyMDE1LTExLTI5ICRcbiAqICRSZXZpc2lvbjogIDMuNC4yICRcbiAqXG4gKiAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhXG4gKiAhISEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISEhXG4gKiAhISEgICBJTVBPUlRBTlQgaXQgc2F5cyAzLjQuMiBidXQgaXQncyBhY3R1YWxseSAzLjQuNCwgYW5kIGl0J3MgbW9kaWZpZWQhICAgISEhXG4gKiAhISEgICBsaW5lIDY0Niwgc2FtZSBhczogaHR0cHM6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZC9wdWxsLzE2NSAgICAgISEhXG4gKiAhISEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISEhXG4gKiAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhXG4gKi9cblxuLypqc2xpbnQgbm9tZW46dHJ1ZSAqL1xuLypqc2hpbnQgdW51c2VkOnZhcnMgKi9cbi8qZ2xvYmFsIG5hdmlnYXRvciwgZG9jdW1lbnQsIGpRdWVyeSwgZGVmaW5lICovXG5cbi8qIEFNRCBzdXBwb3J0IGFkZGVkIGJ5IGpvY2hlbmJlcmdlciBwZXIgaHR0cHM6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZC9wdWxsLzQ5XG4gKlxuICovXG4oZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5JywgJ2pzdHJlZSddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHNcbiAgICAgICAgZmFjdG9yeShqUXVlcnkpO1xuICAgIH1cbn0oZnVuY3Rpb24gKCQpIHtcbiAgICB2YXIgcmVuZGVyQVdpZHRoLCByZW5kZXJBVGl0bGUsIGdldEluZGVudCwgaHRtbHN0cmlwcmUsIGZpbmRMYXN0Q2xvc2VkTm9kZSwgQkxBTktSRSA9IC9eXFxzKiQvZyxcbiAgICAgICAgSURSRUdFWCA9IC9bXFxcXDomIV58KClcXFtcXF08PkAqJyt+I1wiOyw9IFxcLyR7fSVdL2csIGVzY2FwZUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gKGlkfHxcIlwiKS5yZXBsYWNlKElEUkVHRVgsJ1xcXFwkJicpO1xuICAgICAgICB9LCBOT0RFX0RBVEFfQVRUUiA9IFwiZGF0YS1qc3RyZWVncmlkXCIsXG4gICAgU1BFQ0lBTF9USVRMRSA9IFwiX0RBVEFfXCIsIExFVkVMSU5ERU5UID0gMjQsIHN0eWxlZCA9IGZhbHNlLCBHUklEQ0VMTElEX1BSRUZJWCA9IFwianNncmlkX1wiLEdSSURDRUxMSURfUE9TVEZJWCA9IFwiX2NvbFwiLFxuICAgICAgICBmaW5kRGF0YUNlbGwgPSBmdW5jdGlvbiAoZnJvbSxpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZyb20uZmluZChcImRpdltcIitOT0RFX0RBVEFfQVRUUitcIj0nXCIraWQrXCInXVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXNDbGlja2VkU2VwID0gZmFsc2UsIHRvUmVzaXplID0gbnVsbCwgb2xkTW91c2VYID0gMCwgbmV3TW91c2VYID0gMDtcblxuICAgIC8qanNsaW50IHJlZ2V4cDp0cnVlICovXG4gICAgaHRtbHN0cmlwcmUgPSAvPFxcLz9bXj5dKz4vZ2k7XG4gICAgLypqc2xpbnQgcmVnZXhwOmZhbHNlICovXG5cbiAgICBnZXRJbmRlbnQgPSBmdW5jdGlvbihub2RlLHRyZWUpIHtcbiAgICAgICAgdmFyIGRpdiwgaSwgbGksIHdpZHRoO1xuXG4gICAgICAgIC8vIGRpZCB3ZSBhbHJlYWR5IHNhdmUgaXQgZm9yIHRoaXMgdHJlZT9cbiAgICAgICAgdHJlZS5fZ3JpZFNldHRpbmdzID0gdHJlZS5fZ3JpZFNldHRpbmdzIHx8IHt9O1xuICAgICAgICBpZiAodHJlZS5fZ3JpZFNldHRpbmdzLmluZGVudCA+IDApIHtcbiAgICAgICAgICAgIHdpZHRoID0gdHJlZS5fZ3JpZFNldHRpbmdzLmluZGVudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBkaXYgb24gdGhlIERPTSBidXQgbm90IHZpc2libGUgb24gdGhlIHBhZ2VcbiAgICAgICAgICAgIGRpdiA9ICQoXCI8ZGl2PjwvZGl2PlwiKTtcbiAgICAgICAgICAgIGkgPSBub2RlLnByZXYoXCJpXCIpO1xuICAgICAgICAgICAgbGkgPSBpLnBhcmVudCgpO1xuICAgICAgICAgICAgLy8gYWRkIHRvIHRoYXQgZGl2IGFsbCBvZiB0aGUgY2xhc3NlcyBvbiB0aGUgdHJlZSByb290XG4gICAgICAgICAgICBkaXYuYWRkQ2xhc3ModHJlZS5nZXRfbm9kZShcIiNcIix0cnVlKS5hdHRyKFwiY2xhc3NcIikpO1xuXG4gICAgICAgICAgICAvLyBtb3ZlIHRoZSBsaSB0byB0aGUgdGVtcG9yYXJ5IGRpdiByb290XG4gICAgICAgICAgICBsaS5hcHBlbmRUbyhkaXYpO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggdG8gdGhlIGJvZHkgcXVpY2tseVxuICAgICAgICAgICAgZGl2LmFwcGVuZFRvKCQoXCJib2R5XCIpKTtcblxuICAgICAgICAgICAgLy8gZ2V0IHRoZSB3aWR0aFxuICAgICAgICAgICAgd2lkdGggPSBpLndpZHRoKCkgfHwgTEVWRUxJTkRFTlQ7XG5cbiAgICAgICAgICAgIC8vIGRldGFjaCB0aGUgbGkgZnJvbSB0aGUgbmV3IGRpdiBhbmQgZGVzdHJveSB0aGUgbmV3IGRpdlxuICAgICAgICAgICAgbGkuZGV0YWNoKCk7XG4gICAgICAgICAgICBkaXYucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIHNhdmUgaXQgZm9yIHRoZSBmdXR1cmVcbiAgICAgICAgICAgIHRyZWUuX2dyaWRTZXR0aW5ncy5pbmRlbnQgPSB3aWR0aDtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmV0dXJuKHdpZHRoKTtcblxuICAgIH07XG5cbiAgICBmaW5kTGFzdENsb3NlZE5vZGUgPSBmdW5jdGlvbiAodHJlZSxpZCkge1xuICAgICAgICAvLyBmaXJzdCBnZXQgb3VyIG5vZGVcbiAgICAgICAgdmFyIHJldCwgbm9kZSA9IHRyZWUuZ2V0X25vZGUoaWQpLCBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47XG4gICAgICAgIC8vIGlzIGl0IGNsb3NlZD9cbiAgICAgICAgaWYgKCFjaGlsZHJlbiB8fCBjaGlsZHJlbi5sZW5ndGggPD0gMCB8fCAhbm9kZS5zdGF0ZS5vcGVuZWQpIHtcbiAgICAgICAgICAgIHJldCA9IGlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0ID0gZmluZExhc3RDbG9zZWROb2RlKHRyZWUsY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoLTFdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ocmV0KTtcbiAgICB9O1xuXG4gICAgcmVuZGVyQVdpZHRoID0gZnVuY3Rpb24obm9kZSx0cmVlKSB7XG4gICAgICAgIHZhciBkZXB0aCwgd2lkdGgsXG4gICAgICAgIGZ1bGxXaWR0aCA9IHBhcnNlSW50KHRyZWUuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zWzBdLndpZHRoLDEwKSArIHBhcnNlSW50KHRyZWUuX2dyaWRTZXR0aW5ncy50cmVlV2lkdGhEaWZmLDEwKTtcbiAgICAgICAgLy8gbmVlZCB0byB1c2UgYSBzZWxlY3RvciBpbiBqcXVlcnkgMS40LjQrXG4gICAgICAgIGRlcHRoID0gdHJlZS5nZXRfbm9kZShub2RlKS5wYXJlbnRzLmxlbmd0aDtcbiAgICAgICAgd2lkdGggPSBmdWxsV2lkdGggLSBkZXB0aCpnZXRJbmRlbnQobm9kZSx0cmVlKTtcbiAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBsaW5lIGlzIG5vIGxvbmdlciBuZWVkZWQsIHNpbmNlIHdlIGFyZSBkb2luZyB0aGlzIGluc2lkZSBhIDx0ZD5cbiAgICAgICAgLy9hLmNzcyh7XCJ2ZXJ0aWNhbC1hbGlnblwiOiBcInRvcFwiLCBcIm92ZXJmbG93XCI6XCJoaWRkZW5cIn0pO1xuICAgICAgICByZXR1cm4oZnVsbFdpZHRoKTtcbiAgICB9O1xuICAgIHJlbmRlckFUaXRsZSA9IGZ1bmN0aW9uKG5vZGUsdCx0cmVlKSB7XG4gICAgICAgIHZhciBhID0gbm9kZS5nZXQoMCkudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImFcIiA/IG5vZGUgOiBub2RlLmNoaWxkcmVuKFwiYVwiKSwgdGl0bGUsIGNvbCA9IHRyZWUuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zWzBdO1xuICAgICAgICAvLyBnZXQgdGhlIHRpdGxlXG4gICAgICAgIHRpdGxlID0gXCJcIjtcbiAgICAgICAgaWYgKGNvbC50aXRsZSkge1xuICAgICAgICAgICAgaWYgKGNvbC50aXRsZSA9PT0gU1BFQ0lBTF9USVRMRSkge1xuICAgICAgICAgICAgICAgIHRpdGxlID0gdHJlZS5nZXRfdGV4dCh0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodC5hdHRyKGNvbC50aXRsZSkpIHtcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHQuYXR0cihjb2wudGl0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHN0cmlwIG91dCBIVE1MXG4gICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZShodG1sc3RyaXByZSwgJycpO1xuICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgIGEuYXR0cihcInRpdGxlXCIsdGl0bGUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuanN0cmVlLmRlZmF1bHRzLmdyaWQgPSB7XG4gICAgICAgIHdpZHRoOiAnYXV0bydcbiAgICB9O1xuXG4gICAgJC5qc3RyZWUucGx1Z2lucy5ncmlkID0gZnVuY3Rpb24ob3B0aW9ucyxwYXJlbnQpIHtcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IHRoaXMuc2V0dGluZ3MuZ3JpZCB8fCB7fSwgc3R5bGVzLCAgICBjb250YWluZXIgPSB0aGlzLmVsZW1lbnQsIGdyaWRwYXJlbnQgPSBjb250YWluZXIucGFyZW50KCksIGksXG4gICAgICAgICAgICAgICAgZ3MgPSB0aGlzLl9ncmlkU2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnMgOiBzLmNvbHVtbnMgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgIHRyZWVDbGFzcyA6IFwianN0cmVlLWdyaWQtY29sLTBcIixcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogcy5jb250ZXh0bWVudSB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uV2lkdGggOiBzLmNvbHVtbldpZHRoLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZiA6IHtcIipkaXNwbGF5XCI6XCJpbmxpbmVcIixcIiorZGlzcGxheVwiOlwiaW5saW5lXCJ9LFxuICAgICAgICAgICAgICAgICAgICBpc1RoZW1lcm9sbGVyIDogISF0aGlzLl9kYXRhLnRoZW1lcm9sbGVyLFxuICAgICAgICAgICAgICAgICAgICB0cmVlV2lkdGhEaWZmIDogMCxcbiAgICAgICAgICAgICAgICAgICAgcmVzaXphYmxlIDogcy5yZXNpemFibGUsXG4gICAgICAgICAgICAgICAgICAgIGluZGVudDogMFxuICAgICAgICAgICAgICAgIH0sIGNvbHMgPSBncy5jb2x1bW5zLCB0cmVlY29sID0gMDtcbiAgICAgICAgICAgICAgICAvLyBmaW5kIHdoaWNoIGNvbHVtbiBvdXIgdHJlZSBzaHVsZCBnbyBpblxuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8cy5jb2x1bW5zLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHMuY29sdW1uc1tpXS50cmVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHdoaWNoIGNvbHVtbiBpdCB3YXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVjb2wgPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90IGNoZWNrIGFueSBvdGhlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHNldCBhIHVuaXF1ZSBJRCBmb3IgdGhpcyB0YWJsZVxuICAgICAgICAgICAgICAgIHRoaXMudW5pcSA9IE1hdGguY2VpbChNYXRoLnJhbmRvbSgpKjEwMDApO1xuICAgICAgICAgICAgICAgIHRoaXMudHJlZWNvbCA9IHRyZWVjb2w7XG4gICAgICAgICAgICAgICAgdGhpcy5yb290aWQgPSBjb250YWluZXIuYXR0cihcImlkXCIpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1zaWUgPSAvbXNpZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgICAgIGlmIChtc2llKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gcGFyc2VGbG9hdChuYXZpZ2F0b3IuYXBwVmVyc2lvbi5zcGxpdChcIk1TSUVcIilbMV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmVyc2lvbiA8IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdzLmRlZmF1bHRDb25mLmRpc3BsYXkgPSBcImlubGluZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3MuZGVmYXVsdENvbmYuem9vbSA9IFwiMVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gc2V0IHVwIHRoZSBjbGFzc2VzIHdlIG5lZWRcbiAgICAgICAgICAgICAgICBpZiAoIXN0eWxlZCkge1xuICAgICAgICAgICAgICAgICAgICBzdHlsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzdHlsZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWNlbGwge3ZlcnRpY2FsLWFsaWduOiB0b3A7IG92ZXJmbG93OmhpZGRlbjttYXJnaW4tbGVmdDowO3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOiAxMDAlO3BhZGRpbmctbGVmdDo3cHg7d2hpdGUtc3BhY2U6IG5vd3JhcDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtY2VsbCBzcGFuIHttYXJnaW4tcmlnaHQ6MHB4O21hcmdpbi1yaWdodDowcHg7KmRpc3BsYXk6aW5saW5lOyorZGlzcGxheTppbmxpbmU7d2hpdGUtc3BhY2U6IG5vd3JhcDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtc2VwYXJhdG9yIHtwb3NpdGlvbjpyZWxhdGl2ZTsgaGVpZ2h0OjI0cHg7IGZsb2F0OnJpZ2h0O21hcmdpbi1sZWZ0OiAtMnB4OyBib3JkZXItd2lkdGg6IDAgMnB4IDAgMDsgKmRpc3BsYXk6aW5saW5lOyAqK2Rpc3BsYXk6aW5saW5lOyBtYXJnaW4tcmlnaHQ6MHB4O3dpZHRoOjBweDt9JyxcbiAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1oZWFkZXItY2VsbCB7b3ZlcmZsb3c6IGhpZGRlbjsgd2hpdGUtc3BhY2U6IG5vd3JhcDtwYWRkaW5nOiAxcHggM3B4IDJweCA1cHg7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWhlYWRlci10aGVtZXJvbGxlciB7Ym9yZGVyOiAwOyBwYWRkaW5nOiAxcHggM3B4O30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1oZWFkZXItcmVndWxhciB7YmFja2dyb3VuZC1jb2xvcjogI0VCRjNGRDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvciB7Y3Vyc29yOiBjb2wtcmVzaXplOyB3aWR0aDogMnB4O30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1zZXBhcmF0b3ItcmVndWxhciB7Ym9yZGVyLWNvbG9yOiAjZDBkMGQwOyBib3JkZXItc3R5bGU6IHNvbGlkO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jZWxsLXRoZW1lcm9sbGVyIHtib3JkZXI6IG5vbmUgIWltcG9ydGFudDsgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQgIWltcG9ydGFudDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtd3JhcHBlciB7d2lkdGg6IDEwMCU7IG92ZXJmbG93LXg6IGF1dG87fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLW1pZHdyYXBwZXIge2Rpc3BsYXk6IHRhYmxlLXJvdzsgb3ZlcmZsb3c6IHZpc2libGU7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLXdpZHRoLWF1dG8ge3dpZHRoOmF1dG87ZGlzcGxheTpibG9jazt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtY29sdW1uIHtkaXNwbGF5OiB0YWJsZS1jZWxsOyBvdmVyZmxvdzogaGlkZGVuO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jb2wtMCB7d2lkdGg6IDEwMCU7fSdcbiAgICAgICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgICAgICAkKCc8c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+JytzdHlsZXMuam9pbihcIlxcblwiKSsnPC9zdHlsZT4nKS5hcHBlbmRUbyhcImhlYWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIgPSAkKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmFwcGVuZFRvKGdyaWRwYXJlbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMubWlkV3JhcHBlciA9ICQoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLW1pZHdyYXBwZXJcIikuYXBwZW5kVG8odGhpcy5ncmlkV3JhcHBlcik7XG4gICAgICAgICAgICAgICAgLy8gc2V0IHRoZSB3cmFwcGVyIHdpZHRoXG4gICAgICAgICAgICAgICAgaWYgKHMud2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci53aWR0aChzLndpZHRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBkYXRhIGNvbHVtbnNcbiAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPGNvbHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGNvbHVtblxuICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jb2x1bW4ganN0cmVlLWdyaWQtY29sdW1uLVwiK2krXCIganN0cmVlLWdyaWQtY29sdW1uLXJvb3QtXCIrdGhpcy5yb290aWQpLmFwcGVuZFRvKHRoaXMubWlkV3JhcHBlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubWlkV3JhcHBlci5jaGlsZHJlbihcImRpdjplcShcIit0cmVlY29sK1wiKVwiKS5hcHBlbmQoY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jZWxsXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbiAoZWwsb3B0aW9ucykge1xuICAgICAgICAgICAgcGFyZW50LmluaXQuY2FsbCh0aGlzLGVsLG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJpbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwYXJlbnQuYmluZC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAub24oXCJtb3ZlX25vZGUuanN0cmVlIGNyZWF0ZV9ub2RlLmpzdHJlZSBjbGVhbl9ub2RlLmpzdHJlZSBjaGFuZ2Vfbm9kZS5qc3RyZWVcIiwgJC5wcm94eShmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldF9ub2RlKGRhdGEgfHwgXCIjXCIsdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkKHRhcmdldCk7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImRlbGV0ZV9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLm5vZGUuaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZFdyYXBwZXIsIHJlbW92ZU5vZGVzID0gW2RhdGEubm9kZS5pZF0sIGk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjaGlsZHJlbiB0byByZW1vdmUgbGlzdFxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5ub2RlICYmIGRhdGEubm9kZS5jaGlsZHJlbl9kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVOb2RlcyA9IHJlbW92ZU5vZGVzLmNvbmNhdChkYXRhLm5vZGUuY2hpbGRyZW5fZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTxyZW1vdmVOb2Rlcy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwoZ3JpZCxyZW1vdmVOb2Rlc1tpXSkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImNsb3NlX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGlkZV9ncmlkKGRhdGEubm9kZSk7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcIm9wZW5fbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uIChlLGRhdGEpIHtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwibG9hZF9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgfSwgdGhpcykpXG4gICAgICAgICAgICAub24oXCJsb2FkZWQuanN0cmVlXCIsICQucHJveHkoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlX2hlYWRlcnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcihcImxvYWRlZF9ncmlkLmpzdHJlZVwiKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcInJlYWR5LmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIGxpbmUtaGVpZ2h0IG9mIHRoZSBmaXJzdCBrbm93biBub2RlXG4gICAgICAgICAgICAgICAgdmFyIGFuY2hvckhlaWdodCA9IHRoaXMuZWxlbWVudC5maW5kKFwibGkgYTpmaXJzdFwiKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgICQoJzxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj5kaXYuanN0cmVlLWdyaWQtY2VsbC1yb290LScrdGhpcy5yb290aWQrJyB7bGluZS1oZWlnaHQ6ICcrYW5jaG9ySGVpZ2h0KydweH08L3N0eWxlPicpLmFwcGVuZFRvKFwiaGVhZFwiKTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCBjb250YWluZXIgY2xhc3NlcyB0byB0aGUgd3JhcHBlclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50LmF0dHIoXCJjbGFzc1wiKSk7XG5cbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJtb3ZlX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihlLGRhdGEpe1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gZGF0YS5uZXdfaW5zdGFuY2UuZWxlbWVudDtcbiAgICAgICAgICAgICAgICAvL3JlbmRlckFXaWR0aChub2RlLHRoaXMpO1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGFsbCB0aGUgY2hpbGRyZW4sIGJlY2F1c2Ugd2UgY291bGQgZHJhZyBhIHRyZWUgb3ZlclxuICAgICAgICAgICAgICAgIG5vZGUuZmluZChcImxpID4gYVwiKS5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSxlbG0pe1xuICAgICAgICAgICAgICAgICAgICAvL3JlbmRlckFXaWR0aCgkKGVsbSksdGhpcyk7XG4gICAgICAgICAgICAgICAgfSx0aGlzKSk7XG5cbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc2VsZWN0ZWQubm9kZS5pZDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faG92ZXJfbm9kZSAhPT0gbnVsbCAmJiB0aGlzLl9ob3Zlcl9ub2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsdGhpcy5faG92ZXJfbm9kZSkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5faG92ZXJfbm9kZSA9IGlkO1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGlkKS5hZGRDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpO1xuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImRlaG92ZXJfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKG5vZGUsc2VsZWN0ZWQsZXZlbnQpe1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHNlbGVjdGVkLm5vZGUuaWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5faG92ZXJfbm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwic2VsZWN0X25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihub2RlLHNlbGVjdGVkLGV2ZW50KXtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBzZWxlY3RlZC5ub2RlLmlkO1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGlkKS5hZGRDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0X25vZGUoc2VsZWN0ZWQubm9kZS5pZCx0cnVlKS5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jZWxsXCIpLmFkZENsYXNzKFwianN0cmVlLWNsaWNrZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVzZWxlY3Rfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKG5vZGUsc2VsZWN0ZWQsZXZlbnQpe1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHNlbGVjdGVkLm5vZGUuaWQ7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVzZWxlY3RfYWxsLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IGFsbCBvZiB0aGUgaWRzIHRoYXQgd2VyZSB1bnNlbGVjdGVkXG4gICAgICAgICAgICAgICAgdmFyIGlkcyA9IHNlbGVjdGVkLm5vZGUgfHwgW10sIGk7XG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTxpZHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixpZHNbaV0pLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcInNlYXJjaC5qc3RyZWVcIiwgJC5wcm94eShmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIHNlYXJjaCBzb21ldGltZXMgZmlsdGVycywgc28gd2UgbmVlZCB0byBoaWRlIGFsbCBvZiB0aGUgYXBwcm9wcmlhdGUgZ3JpZCBjZWxscyBhcyB3ZWxsLCBhbmQgc2hvdyBvbmx5IHRoZSBtYXRjaGVzXG4gICAgICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRXcmFwcGVyO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuX2RhdGEuc2VhcmNoLnNvbSkge1xuICAgICAgICAgICAgICAgICAgICBpZihkYXRhLm5vZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgb2YgdGhlIGdyaWQgY2VsbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWQuZmluZCgnZGl2LmpzdHJlZS1ncmlkLWNlbGw6bm90KDpmaXJzdCknKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IG9ubHkgdGhvc2UgdGhhdCBtYXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5ub2Rlcy5hZGQoZGF0YS5ub2Rlcy5wYXJlbnRzVW50aWwoXCIuanN0cmVlXCIpKS5maWx0ZXIoXCIuanN0cmVlLW5vZGVcIikuZWFjaChmdW5jdGlvbiAoaSxub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gbm9kZS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKGdyaWQsaWQpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiY2xlYXJfc2VhcmNoLmpzdHJlZVwiLCAkLnByb3h5KGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gc2VhcmNoIGhhcyBiZWVuIGNsZWFyZWQsIHNvIHdlIG5lZWQgdG8gc2hvdyBhbGwgcm93c1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIuZmluZCgnZGl2LmpzdHJlZS1ncmlkLWNlbGwnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmICh0aGlzLl9ncmlkU2V0dGluZ3MuaXNUaGVtZXJvbGxlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJkZXNlbGVjdF9ub2RlLmpzdHJlZSBkZXNlbGVjdF9hbGwuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihlLGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yc2x0Lm9iai5jaGlsZHJlbihcImFcIikubmV4dEFsbChcImRpdlwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiaG92ZXJfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImRlaG92ZXJfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sdGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyB0ZWFyIGRvd24gdGhlIHRyZWUgZW50aXJlbHlcbiAgICAgICAgdGhpcy50ZWFyZG93biA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGd3ID0gdGhpcy5ncmlkV3JhcHBlciwgY29udGFpbmVyID0gdGhpcy5lbGVtZW50LCBncmlkcGFyZW50ID0gZ3cucGFyZW50KCk7XG4gICAgICAgICAgICBjb250YWluZXIuZGV0YWNoKCk7XG4gICAgICAgICAgICBndy5yZW1vdmUoKTtcbiAgICAgICAgICAgIGdyaWRwYXJlbnQuYXBwZW5kKGNvbnRhaW5lcik7XG4gICAgICAgICAgICBwYXJlbnQudGVhcmRvd24uY2FsbCh0aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gY2xlYW4gdGhlIGdyaWQgaW4gY2FzZSBvZiByZWRyYXcgb3IgcmVmcmVzaCBlbnRpcmUgdHJlZVxuICAgICAgICB0aGlzLl9jbGVhbl9ncmlkID0gZnVuY3Rpb24gKHRhcmdldCxpZCkge1xuICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRXcmFwcGVyO1xuICAgICAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbChncmlkLGlkKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IGFsbCBvZiB0aGUgYGRpdmAgY2hpbGRyZW4gaW4gYWxsIG9mIHRoZSBgdGRgIGluIGRhdGFSb3cgZXhjZXB0IGZvciA6Zmlyc3QgKHRoYXQgaXMgdGhlIHRyZWUgaXRzZWxmKSBhbmQgcmVtb3ZlXG4gICAgICAgICAgICAgICAgZ3JpZC5maW5kKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGw6bm90KDpmaXJzdClcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIHByZXBhcmUgdGhlIGhlYWRlcnNcbiAgICAgICAgdGhpcy5fcHJlcGFyZV9oZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVyLCBpLCBjb2wsIGdzID0gdGhpcy5fZ3JpZFNldHRpbmdzLGNvbHMgPSBncy5jb2x1bW5zIHx8IFtdLCB3aWR0aCwgZGVmYXVsdFdpZHRoID0gZ3MuY29sdW1uV2lkdGgsIHJlc2l6YWJsZSA9IGdzLnJlc2l6YWJsZSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGNsLCBjY2wsIHZhbCwgbWFyZ2luLCBsYXN0LCB0ciA9IGdzLmlzVGhlbWVyb2xsZXIsIGNsYXNzQWRkID0gKHRyP1widGhlbWVyb2xsZXJcIjpcInJlZ3VsYXJcIiksIHB1bGxlcixcbiAgICAgICAgICAgIGhhc0hlYWRlcnMgPSBmYWxzZSwgZ3JpZHBhcmVudCA9IHRoaXMuZ3JpZHBhcmVudCxcbiAgICAgICAgICAgIGNvbmYgPSBncy5kZWZhdWx0Q29uZixcbiAgICAgICAgICAgIGNvbE51bSA9IDAsIGJvclBhZFdpZHRoID0gMCwgdG90YWxXaWR0aCA9IDA7XG4gICAgICAgICAgICAvLyBzYXZlIHRoZSBvcmlnaW5hbCBwYXJlbnQgc28gd2UgY2FuIHJlcGFyZW50IG9uIGRlc3Ryb3lcbiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gZ3JpZHBhcmVudDtcblxuXG4gICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGhlYWRlcnNcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgLy9jb2wgPSAkKFwiPGNvbC8+XCIpO1xuICAgICAgICAgICAgICAgIC8vY29sLmFwcGVuZFRvKGNvbGdyb3VwKTtcbiAgICAgICAgICAgICAgICBjbCA9IGNvbHNbaV0uaGVhZGVyQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBjY2wgPSBjb2xzW2ldLmNvbHVtbkNsYXNzIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgdmFsID0gY29sc1tpXS5oZWFkZXIgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAodmFsKSB7aGFzSGVhZGVycyA9IHRydWU7fVxuICAgICAgICAgICAgICAgIHdpZHRoID0gY29sc1tpXS53aWR0aCB8fCBkZWZhdWx0V2lkdGg7XG5cbiAgICAgICAgICAgICAgICAvLyB3ZSBvbmx5IGRlYWwgd2l0aCBib3JkZXJzIGlmIHdpZHRoIGlzIG5vdCBhdXRvIGFuZCBub3QgcGVyY2VudGFnZXNcbiAgICAgICAgICAgICAgICBib3JQYWRXaWR0aCA9IHRyID8gMSs2IDogMis4OyAvLyBhY2NvdW50IGZvciB0aGUgYm9yZGVycyBhbmQgcGFkZGluZ1xuICAgICAgICAgICAgICAgIGlmICh3aWR0aCAhPT0gJ2F1dG8nICYmIHR5cGVvZih3aWR0aCkgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggLT0gYm9yUGFkV2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1hcmdpbiA9IGkgPT09IDAgPyAzIDogMDtcbiAgICAgICAgICAgICAgICBjb2wgPSB0aGlzLm1pZFdyYXBwZXIuY2hpbGRyZW4oXCJkaXYuanN0cmVlLWdyaWQtY29sdW1uLVwiK2kpO1xuICAgICAgICAgICAgICAgIGxhc3QgPSAkKFwiPGRpdj48L2Rpdj5cIikuY3NzKGNvbmYpLmNzcyh7XCJtYXJnaW4tbGVmdFwiOiBtYXJnaW59KS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWRpdi1cIit0aGlzLnVuaXErXCItXCIraStcIiBcIisodHI/XCJ1aS13aWRnZXQtaGVhZGVyIFwiOlwiXCIpK1wiIGpzdHJlZS1ncmlkLWhlYWRlciBqc3RyZWUtZ3JpZC1oZWFkZXItY2VsbCBqc3RyZWUtZ3JpZC1oZWFkZXItXCIrY2xhc3NBZGQrXCIgXCIrY2wrXCIgXCIrY2NsKS5odG1sKHZhbCk7XG4gICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcygodHI/XCJ1aS13aWRnZXQtaGVhZGVyIFwiOlwiXCIpK1wianN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1cIitjbGFzc0FkZCk7XG4gICAgICAgICAgICAgICAgbGFzdC5wcmVwZW5kVG8oY29sKTtcbiAgICAgICAgICAgICAgICB0b3RhbFdpZHRoICs9IGxhc3Qub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgIHB1bGxlciA9ICQoXCI8ZGl2IGNsYXNzPSdqc3RyZWUtZ3JpZC1zZXBhcmF0b3IganN0cmVlLWdyaWQtc2VwYXJhdG9yLVwiK2NsYXNzQWRkKyh0ciA/IFwiIHVpLXdpZGdldC1oZWFkZXJcIiA6IFwiXCIpKyhyZXNpemFibGU/IFwiIGpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIjpcIlwiKStcIic+Jm5ic3A7PC9kaXY+XCIpLmFwcGVuZFRvKGxhc3QpO1xuICAgICAgICAgICAgICAgIGNvbC53aWR0aCh3aWR0aCk7XG4gICAgICAgICAgICAgICAgY29sLmNzcyhcIm1pbi13aWR0aFwiLHdpZHRoKTtcbiAgICAgICAgICAgICAgICBjb2wuY3NzKFwibWF4LXdpZHRoXCIsd2lkdGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsYXN0LmFkZENsYXNzKCh0cj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCJqc3RyZWUtZ3JpZC1oZWFkZXIganN0cmVlLWdyaWQtaGVhZGVyLWxhc3QganN0cmVlLWdyaWQtaGVhZGVyLVwiK2NsYXNzQWRkKTtcbiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdpZHRoIGdpdmVuIGZvciB0aGUgbGFzdCBjb2x1bW4sIGRvIGl0IHZpYSBhdXRvbWF0aWNcbiAgICAgICAgICAgIGlmIChjb2xzW2NvbHMubGVuZ3RoLTFdLndpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0b3RhbFdpZHRoIC09IHdpZHRoO1xuICAgICAgICAgICAgICAgIGNvbC5jc3Moe3dpZHRoOlwiYXV0b1wifSk7XG4gICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdpZHRoLWF1dG9cIikubmV4dChcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3JcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGFzSGVhZGVycykge1xuICAgICAgICAgICAgICAgIC8vIHNhdmUgdGhlIG9mZnNldCBvZiB0aGUgZGl2IGZyb20gdGhlIGJvZHlcbiAgICAgICAgICAgICAgICAvL2dzLmRpdk9mZnNldCA9IGhlYWRlci5wYXJlbnQoKS5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgICAgICAgIGdzLmhlYWRlciA9IGhlYWRlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcImRpdi5qc3RyZWUtZ3JpZC1oZWFkZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuYm91bmQgJiYgcmVzaXphYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAgaSwgcmVmLCBjb2xzLCB3aWR0aHMsIGhlYWRlcnMsIHcsIGN1cnJlbnRUcmVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbGlja2VkU2VwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VHJlZSA9IHRvUmVzaXplLmNsb3Nlc3QoXCIuanN0cmVlLWdyaWQtd3JhcHBlclwiKS5maW5kKFwiLmpzdHJlZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9ICQuanN0cmVlLnJlZmVyZW5jZShjdXJyZW50VHJlZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xzID0gcmVmLnNldHRpbmdzLmdyaWQuY29sdW1ucztcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB0b1Jlc2l6ZS5wYXJlbnQoKS5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihjb2xOdW0pIHx8IGNvbE51bSA8IDApIHsgcmVmLl9ncmlkU2V0dGluZ3MudHJlZVdpZHRoRGlmZiA9IGN1cnJlbnRUcmVlLmZpbmQoXCJpbnM6ZXEoMClcIikud2lkdGgoKSArIGN1cnJlbnRUcmVlLmZpbmQoXCJhOmVxKDApXCIpLndpZHRoKCkgLSByZWYuX2dyaWRTZXR0aW5ncy5jb2x1bW5zWzBdLndpZHRoOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0NsaWNrZWRTZXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVzaXplID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHBhcnNlRmxvYXQoaGVhZGVyc1tpXS5zdHlsZS53aWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGhzW2ldID0ge3c6IHcsIHI6IGk9PT1jb2xOdW0gfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYuX2dyaWRTZXR0aW5ncy5jb2x1bW5zW2ldLndpZHRoID0gdztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFRyZWUudHJpZ2dlcihcInJlc2l6ZV9jb2x1bW4uanN0cmVlLWdyaWRcIiwgd2lkdGhzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLm1vdXNlbW92ZShmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2xpY2tlZFNlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld01vdXNlWCA9IGUucGFnZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmYgPSBuZXdNb3VzZVggLSBvbGRNb3VzZVgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkUHJldkhlYWRlcklubmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByZXZDb2xXaWR0aCwgbmV3UHJldkNvbFdpZHRoO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgIT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmV2SGVhZGVySW5uZXIgPSB0b1Jlc2l6ZS53aWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmV2Q29sV2lkdGggPSBwYXJzZUZsb2F0KHRvUmVzaXplLmNzcyhcIndpZHRoXCIpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgYSBDaHJvbWUgaXNzdWUgd2l0aCBjb2x1bW5zIHNldCB0byBhdXRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoYW5rcyB0byBCcmFidXMgaHR0cHM6Ly9naXRodWIuY29tL3NpZGUtYnktc2lkZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9sZFByZXZDb2xXaWR0aCkge29sZFByZXZDb2xXaWR0aCA9IHRvUmVzaXplLmlubmVyV2lkdGgoKTt9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgZGlmZiBjYW5ub3QgYmUgYmV5b25kIHRoZSBsZWZ0L3JpZ2h0IGxpbWl0c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmID0gZGlmZiA8IDAgPyBNYXRoLm1heChkaWZmLC1vbGRQcmV2SGVhZGVySW5uZXIpIDogZGlmZjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UHJldkNvbFdpZHRoID0gKG9sZFByZXZDb2xXaWR0aCtkaWZmKStcInB4XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25seSBkbyB0aGlzIGlmIHdlIGFyZSBub3Qgc2hyaW5raW5nIHBhc3QgMCBvbiBsZWZ0IC0gYW5kIGxpbWl0IGl0IHRvIHRoYXQgYW1vdW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWZmID4gMCB8fCBvbGRQcmV2SGVhZGVySW5uZXIgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Jlc2l6ZS53aWR0aChuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUuY3NzKFwibWluLXdpZHRoXCIsbmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVzaXplLmNzcyhcIm1heC13aWR0aFwiLG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRNb3VzZVggPSBuZXdNb3VzZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIub24oXCJzZWxlY3RzdGFydFwiLCBcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pLm9uKFwibW91c2Vkb3duXCIsIFwiLmpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNDbGlja2VkU2VwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgb2xkTW91c2VYID0gZS5wYWdlWDtcbiAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUgPSAkKHRoaXMpLmNsb3Nlc3QoXCJkaXYuanN0cmVlLWdyaWQtY29sdW1uXCIpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbWF4IHJpZ2h0bW9zdCBwb3NpdGlvbiB3ZSB3aWxsIGFsbG93IGlzIHRoZSByaWdodC1tb3N0IG9mIHRoZSB3cmFwcGVyIG1pbnVzIGEgYnVmZmVyICgxMClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwiZGJsY2xpY2tcIiwgXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2tlZFNlcCA9ICQodGhpcyksIGNvbCA9IGNsaWNrZWRTZXAuY2xvc2VzdChcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIiksXG4gICAgICAgICAgICAgICAgICAgIG9sZFByZXZDb2xXaWR0aCA9IHBhcnNlRmxvYXQoY29sLmNzcyhcIndpZHRoXCIpKSwgbmV3V2lkdGggPSAwLCBkaWZmLFxuICAgICAgICAgICAgICAgICAgICBvbGRQcmV2SGVhZGVySW5uZXIgPSBjb2wud2lkdGgoKSwgbmV3UHJldkNvbFdpZHRoO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy9maW5kIGxhcmdlc3Qgd2lkdGhcbiAgICAgICAgICAgICAgICAgICAgY29sLmZpbmQoXCIuanN0cmVlLWdyaWQtY2VsbFwiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLCB3aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3NzKFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3NzKFwid2lkdGhcIiwgXCJhdXRvXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBpdGVtLm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3NzKFwicG9zaXRpb25cIiwgXCJyZWxhdGl2ZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpZHRoPm5ld1dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3V2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IG5ld1dpZHRoLW9sZFByZXZDb2xXaWR0aDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBkaWZmIGNhbm5vdCBiZSBiZXlvbmQgdGhlIGxlZnQgbGltaXRzXG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSBkaWZmIDwgMCA/IE1hdGgubWF4KGRpZmYsLW9sZFByZXZIZWFkZXJJbm5lcikgOiBkaWZmO1xuICAgICAgICAgICAgICAgICAgICBuZXdQcmV2Q29sV2lkdGggPSAob2xkUHJldkNvbFdpZHRoK2RpZmYpK1wicHhcIjtcblxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGgobmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNzcyhcIm1pbi13aWR0aFwiLG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbC5jc3MoXCJtYXgtd2lkdGhcIixuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKlxuICAgICAgICAgKiBPdmVycmlkZSByZWRyYXdfbm9kZSB0byBjb3JyZWN0bHkgaW5zZXJ0IHRoZSBncmlkXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlZHJhd19ub2RlID0gZnVuY3Rpb24ob2JqLCBkZWVwLCBpc19jYWxsYmFjaywgZm9yY2VfcmVuZGVyKSB7XG4gICAgICAgICAgICAvLyBmaXJzdCBhbGxvdyB0aGUgcGFyZW50IHRvIHJlZHJhdyB0aGUgbm9kZVxuICAgICAgICAgICAgb2JqID0gcGFyZW50LnJlZHJhd19ub2RlLmNhbGwodGhpcywgb2JqLCBkZWVwLCBpc19jYWxsYmFjaywgZm9yY2VfcmVuZGVyKTtcbiAgICAgICAgICAgIC8vIG5leHQgcHJlcGFyZSB0aGUgZ3JpZFxuICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhbl9ncmlkKCk7XG4gICAgICAgICAgICByZXR1cm4gcGFyZW50LnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9oaWRlX2dyaWQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZSAmJiBub2RlLmNoaWxkcmVuX2QgPyBub2RlLmNoaWxkcmVuX2QgOiBbXSwgaTtcbiAgICAgICAgICAgIC8vIGdvIHRocm91Z2ggZWFjaCBjb2x1bW4sIHJlbW92ZSBhbGwgY2hpbGRyZW4gd2l0aCB0aGUgY29ycmVjdCBJRCBuYW1lXG4gICAgICAgICAgICBmb3IgKGk9MDtpPGNoaWxkcmVuLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixjaGlsZHJlbltpXSkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaG9sZGluZ0NlbGxzID0ge307XG4gICAgICAgIHRoaXMuZ2V0SG9sZGluZ0NlbGxzID0gZnVuY3Rpb24gKG9iaixjb2wsaGMpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSAkKCksIGNoaWxkcmVuID0gb2JqLmNoaWxkcmVufHxbXSwgY2hpbGQsIGk7XG4gICAgICAgICAgICAvLyBydW4gdGhyb3VnaCBlYWNoIGNoaWxkLCByZW5kZXIgaXQsIGFuZCB0aGVuIHJlbmRlciBpdHMgY2hpbGRyZW4gcmVjdXJzaXZlbHlcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y2hpbGRyZW4ubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIGNoaWxkID0gR1JJRENFTExJRF9QUkVGSVgrZXNjYXBlSWQoY2hpbGRyZW5baV0pK0dSSURDRUxMSURfUE9TVEZJWCtjb2w7XG4gICAgICAgICAgICAgICAgaWYgKGhjW2NoaWxkXSAmJiBvYmouc3RhdGUub3BlbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCA9IHJldC5hZGQoaGNbY2hpbGRdKS5hZGQodGhpcy5nZXRIb2xkaW5nQ2VsbHModGhpcy5nZXRfbm9kZShjaGlsZHJlbltpXSksY29sLGhjKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vZGVsZXRlIGhjW2NoaWxkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ocmV0KTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHB1dCBhIGdyaWQgY2VsbCBpbiBlZGl0IG1vZGUgKGlucHV0IGZpZWxkIHRvIGVkaXQgdGhlIGRhdGEpXG4gICAgICAgICAqIEBuYW1lIGVkaXQob2JqLCBjb2wpXG4gICAgICAgICAqIEBwYXJhbSAge21peGVkfSBvYmpcbiAgICAgICAgICogQHBhcmFtICB7b2JqfSBjb2wgZGVmaW5pdGlvblxuICAgICAgICAgKiBAcGFyYW0gIHtlbGVtZW50fSBjZWxsIGVsZW1lbnQsIGVpdGhlciBzcGFuIG9yIHdyYXBwaW5nIGRpdlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fZWRpdCA9IGZ1bmN0aW9uIChvYmosIGNvbCwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYoIW9iaikgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucHJvcChcInRhZ05hbWVcIikudG9Mb3dlckNhc2UoKSA9PT0gXCJkaXZcIikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5jaGlsZHJlbihcInNwYW46Zmlyc3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBuZWVkIHRvIGZpbmQgdGhlIGVsZW1lbnQgLSBsYXRlclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBydGwgPSB0aGlzLl9kYXRhLmNvcmUucnRsLFxuICAgICAgICAgICAgICAgIHcgID0gdGhpcy5lbGVtZW50LndpZHRoKCksXG4gICAgICAgICAgICAgICAgdCA9IG9iai5kYXRhW2NvbC52YWx1ZV0sXG4gICAgICAgICAgICAgICAgaDEgPSAkKFwiPFwiK1wiZGl2IC8+XCIsIHsgY3NzIDogeyBcInBvc2l0aW9uXCIgOiBcImFic29sdXRlXCIsIFwidG9wXCIgOiBcIi0yMDBweFwiLCBcImxlZnRcIiA6IChydGwgPyBcIjBweFwiIDogXCItMTAwMHB4XCIpLCBcInZpc2liaWxpdHlcIiA6IFwiaGlkZGVuXCIgfSB9KS5hcHBlbmRUbyhcImJvZHlcIiksXG4gICAgICAgICAgICAgICAgaDIgPSAkKFwiPFwiK1wiaW5wdXQgLz5cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiIDogdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIiA6IFwianN0cmVlLXJlbmFtZS1pbnB1dFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjc3NcIiA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhZGRpbmdcIiA6IFwiMFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYm9yZGVyXCIgOiBcIjFweCBzb2xpZCBzaWx2ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJveC1zaXppbmdcIiA6IFwiYm9yZGVyLWJveFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGlzcGxheVwiIDogXCJpbmxpbmUtYmxvY2tcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhlaWdodFwiIDogKHRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpICsgXCJweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGluZUhlaWdodFwiIDogKHRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpICsgXCJweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2lkdGhcIiA6IFwiMTUwcHhcIiAvLyB3aWxsIGJlIHNldCBhIGJpdCBmdXJ0aGVyIGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImJsdXJcIiA6ICQucHJveHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gaDIudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgdmFsdWUgaWYgY2hhbmdlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHYgPT09IFwiXCIgfHwgdiA9PT0gdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVtjb2wudmFsdWVdID0gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoJ3VwZGF0ZV9jZWxsLmpzdHJlZS1ncmlkJyx7bm9kZTpvYmosIGNvbDpjb2wudmFsdWUsIHZhbHVlOnYsIG9sZDp0fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXBhcmVfZ3JpZCh0aGlzLmdldF9ub2RlKG9iaix0cnVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBcImtleWRvd25cIiA6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldmVudC53aGljaDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09IDI3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09IDI3IHx8IGtleSA9PT0gMTMgfHwga2V5ID09PSAzNyB8fCBrZXkgPT09IDM4IHx8IGtleSA9PT0gMzkgfHwga2V5ID09PSA0MCB8fCBrZXkgPT09IDMyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09IDI3IHx8IGtleSA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xpY2tcIiA6IGZ1bmN0aW9uIChlKSB7IGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm1vdXNlZG93blwiIDogZnVuY3Rpb24gKGUpIHsgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwia2V5dXBcIiA6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgyLndpZHRoKE1hdGgubWluKGgxLnRleHQoXCJwV1wiICsgdGhpcy52YWx1ZSkud2lkdGgoKSx3KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJrZXlwcmVzc1wiIDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihldmVudC53aGljaCA9PT0gMTMpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZuID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9udEZhbWlseSAgICAgICAgOiBlbGVtZW50LmNzcygnZm9udEZhbWlseScpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250U2l6ZScpICAgICAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0ICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250V2VpZ2h0JykgICAgICAgIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFN0eWxlICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250U3R5bGUnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250U3RyZXRjaCAgICAgICAgOiBlbGVtZW50LmNzcygnZm9udFN0cmV0Y2gnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250VmFyaWFudCAgICAgICAgOiBlbGVtZW50LmNzcygnZm9udFZhcmlhbnQnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nICAgIDogZWxlbWVudC5jc3MoJ2xldHRlclNwYWNpbmcnKSAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRTcGFjaW5nICAgICAgICA6IGVsZW1lbnQuY3NzKCd3b3JkU3BhY2luZycpICAgICAgICB8fCAnJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBlbGVtZW50LmhpZGUoKTtcbiAgICAgICAgICAgIGVsZW1lbnQucGFyZW50KCkuYXBwZW5kKGgyKTtcbiAgICAgICAgICAgIGgyLmNzcyhmbikud2lkdGgoTWF0aC5taW4oaDEudGV4dChcInBXXCIgKyBoMlswXS52YWx1ZSkud2lkdGgoKSx3KSlbMF0uc2VsZWN0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3ByZXBhcmVfZ3JpZCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHZhciBncyA9IHRoaXMuX2dyaWRTZXR0aW5ncywgYyA9IGdzLnRyZWVDbGFzcywgX3RoaXMgPSB0aGlzLCB0LCBjb2xzID0gZ3MuY29sdW1ucyB8fCBbXSwgd2lkdGgsIHRyID0gZ3MuaXNUaGVtZXJvbGxlcixcbiAgICAgICAgICAgIHRyZWUgPSB0aGlzLmVsZW1lbnQsIHJvb3RpZCA9IHRoaXMucm9vdGlkLFxuICAgICAgICAgICAgY2xhc3NBZGQgPSAodHI/XCJ0aGVtZXJvbGxlclwiOlwicmVndWxhclwiKSwgaW1nLCBvYmpEYXRhID0gdGhpcy5nZXRfbm9kZShvYmopLFxuICAgICAgICAgICAgZGVmYXVsdFdpZHRoID0gZ3MuY29sdW1uV2lkdGgsIGNvbmYgPSBncy5kZWZhdWx0Q29uZiwgY2VsbENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICh0cmVlLG5vZGUsdmFsLGNvbCx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9ub2RlID0gdHJlZS5maW5kKFwiI1wiK25vZGUuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnRyaWdnZXIoXCJjbGljay5qc3RyZWVcIixlKTtcbiAgICAgICAgICAgICAgICAgICAgdHJlZS50cmlnZ2VyKFwic2VsZWN0X2NlbGwuanN0cmVlLWdyaWRcIiwgW3t2YWx1ZTogdmFsLGNvbHVtbjogY29sLmhlYWRlcixub2RlOiBub2RlLGdyaWQ6JCh0aGlzKSxzb3VyY2VOYW1lOiBjb2wudmFsdWV9XSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sIGNlbGxSaWdodENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICh0cmVlLG5vZGUsdmFsLGNvbCx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChncy5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLnZha2F0YS5jb250ZXh0LnNob3codGhpcyx7ICd4JyA6IGUucGFnZVgsICd5JyA6IGUucGFnZVkgfSx7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlZGl0XCI6e2xhYmVsOlwiRWRpdFwiLFwiYWN0aW9uXCI6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB0LmdldF9ub2RlKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZWRpdChvYmosY29sLGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvdmVySW5IYW5kbGVyID0gZnVuY3Rpb24gKG5vZGUsIGpzVHJlZUluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyBqc1RyZWVJbnN0YW5jZS5ob3Zlcl9ub2RlKG5vZGUpOyB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvdmVyT3V0SGFuZGxlciA9IGZ1bmN0aW9uIChub2RlLCBqc1RyZWVJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsganNUcmVlSW5zdGFuY2UuZGVob3Zlcl9ub2RlKG5vZGUpOyB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGksIHZhbCwgY2wsIHdjbCwgY2NsLCBhLCBsYXN0LCB2YWxDbGFzcywgd2lkZVZhbENsYXNzLCBzcGFuLCBwYWRkaW5nbGVmdCwgdGl0bGUsIGdyaWRDZWxsTmFtZSwgZ3JpZENlbGxQYXJlbnRJZCwgZ3JpZENlbGxQYXJlbnQsXG4gICAgICAgICAgICBncmlkQ2VsbFByZXYsIGdyaWRDZWxsUHJldklkLCBncmlkQ2VsbE5leHQsIGdyaWRDZWxsTmV4dElkLCBncmlkQ2VsbENoaWxkLCBncmlkQ2VsbENoaWxkSWQsXG4gICAgICAgICAgICBjb2wsIGNvbnRlbnQsIHRtcFdpZHRoLCBtdyA9IHRoaXMubWlkV3JhcHBlciwgZGF0YUNlbGwsIGxpZCA9IG9iakRhdGEuaWQsXG4gICAgICAgICAgICBwZWVycyA9IHRoaXMuZ2V0X25vZGUob2JqRGF0YS5wYXJlbnQpLmNoaWxkcmVuLFxuICAgICAgICAgICAgLy8gZmluZCBteSBwb3NpdGlvbiBpbiB0aGUgbGlzdCBvZiBwZWVycy4gXCJwZWVyc1wiIGlzIHRoZSBsaXN0IG9mIGV2ZXJ5b25lIGF0IG15IGxldmVsIHVuZGVyIG15IHBhcmVudCwgaW4gb3JkZXJcbiAgICAgICAgICAgIHBvcyA9ICQuaW5BcnJheShsaWQscGVlcnMpLFxuICAgICAgICAgICAgaGMgPSB0aGlzLmhvbGRpbmdDZWxscywgcmVuZGVyZWQgPSBmYWxzZSwgY2xvc2VkO1xuICAgICAgICAgICAgLy8gZ2V0IG91ciBjb2x1bW4gZGVmaW5pdGlvblxuICAgICAgICAgICAgdCA9ICQob2JqKTtcblxuICAgICAgICAgICAgLy8gZmluZCB0aGUgYSBjaGlsZHJlblxuICAgICAgICAgICAgYSA9IHQuY2hpbGRyZW4oXCJhXCIpO1xuXG4gICAgICAgICAgICBpZiAoYS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjbG9zZWQgPSAhb2JqRGF0YS5zdGF0ZS5vcGVuZWQ7XG4gICAgICAgICAgICAgICAgZ3JpZENlbGxOYW1lID0gR1JJRENFTExJRF9QUkVGSVgrZXNjYXBlSWQobGlkKStHUklEQ0VMTElEX1BPU1RGSVg7XG4gICAgICAgICAgICAgICAgZ3JpZENlbGxQYXJlbnRJZCA9IG9iakRhdGEucGFyZW50ID09PSBcIiNcIiA/IG51bGwgOiBvYmpEYXRhLnBhcmVudDtcbiAgICAgICAgICAgICAgICBhLmFkZENsYXNzKGMpO1xuICAgICAgICAgICAgICAgIC8vcmVuZGVyQVdpZHRoKGEsX3RoaXMpO1xuICAgICAgICAgICAgICAgIHJlbmRlckFUaXRsZShhLHQsX3RoaXMpO1xuICAgICAgICAgICAgICAgIGxhc3QgPSBhO1xuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyZWVjb2wgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbCA9IGNvbHNbaV07XG4gICAgICAgICAgICAgICAgICAgIGRhdGFDZWxsID0gbXcuY2hpbGRyZW4oXCJkaXY6ZXEoXCIraStcIilcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgY2VsbENsYXNzLCB0aGUgd2lkZUNlbGxDbGFzcywgYW5kIHRoZSBjb2x1bW5DbGFzc1xuICAgICAgICAgICAgICAgICAgICBjbCA9IGNvbC5jZWxsQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgd2NsID0gY29sLndpZGVDZWxsQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgY2NsID0gY29sLmNvbHVtbkNsYXNzIHx8IFwiXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgY29sdW1uIGNsYXNzIHRvIHRoZSBkYXRhQ2VsbFxuICAgICAgICAgICAgICAgICAgICBkYXRhQ2VsbC5hZGRDbGFzcyhjY2wpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBjb250ZW50cyBvZiB0aGUgY2VsbCAtIHZhbHVlIGNvdWxkIGJlIGEgc3RyaW5nIG9yIGEgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIGNvbC52YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihjb2wudmFsdWUpID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBjb2wudmFsdWUob2JqRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iakRhdGEuZGF0YSAhPT0gbnVsbCAmJiBvYmpEYXRhLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBvYmpEYXRhLmRhdGFbY29sLnZhbHVlXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gb2JqRGF0YS5kYXRhW2NvbC52YWx1ZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihjb2wuZm9ybWF0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBjb2wuZm9ybWF0KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBwdXQgaW1hZ2VzIGluc3RlYWQgb2YgdGV4dCBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC5pbWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaW1nID0gY29sLmltYWdlc1t2YWxdIHx8IGNvbC5pbWFnZXNbXCJkZWZhdWx0XCJdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW1nKSB7Y29udGVudCA9IGltZ1swXSA9PT0gXCIqXCIgPyAnPHNwYW4gY2xhc3M9XCInK2ltZy5zdWJzdHIoMSkrJ1wiPjwvc3Bhbj4nIDogJzxpbWcgc3JjPVwiJytpbWcrJ1wiPic7fVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyBjb250ZW50ID0gdmFsOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGVudCBjYW5ub3QgYmUgYmxhbmssIG9yIGl0IG1lc3NlcyB1cCBoZWlnaHRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50ID09PSB1bmRlZmluZWQgfHwgY29udGVudCA9PT0gbnVsbCB8fCBCTEFOS1JFLnRlc3QoY29udGVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBcIiZuYnNwO1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB2YWx1ZUNsYXNzXG4gICAgICAgICAgICAgICAgICAgIHZhbENsYXNzID0gY29sLnZhbHVlQ2xhc3MgJiYgb2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkID8gb2JqRGF0YS5kYXRhW2NvbC52YWx1ZUNsYXNzXSB8fCBcIlwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbENsYXNzICYmIGNvbC52YWx1ZUNsYXNzUHJlZml4ICYmIGNvbC52YWx1ZUNsYXNzUHJlZml4ICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxDbGFzcyA9IGNvbC52YWx1ZUNsYXNzUHJlZml4ICsgdmFsQ2xhc3M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB3aWRlVmFsdWVDbGFzc1xuICAgICAgICAgICAgICAgICAgICB3aWRlVmFsQ2xhc3MgPSBjb2wud2lkZVZhbHVlQ2xhc3MgJiYgb2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkID8gb2JqRGF0YS5kYXRhW2NvbC53aWRlVmFsdWVDbGFzc10gfHwgXCJcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWRlVmFsQ2xhc3MgJiYgY29sLndpZGVWYWx1ZUNsYXNzUHJlZml4ICYmIGNvbC53aWRlVmFsdWVDbGFzc1ByZWZpeCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkZVZhbENsYXNzID0gY29sLndpZGVWYWx1ZUNsYXNzUHJlZml4ICsgd2lkZVZhbENsYXNzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgdGl0bGVcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSBjb2wudGl0bGUgJiYgb2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkID8gb2JqRGF0YS5kYXRhW2NvbC50aXRsZV0gfHwgXCJcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0cmlwIG91dCBIVE1MXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZShodG1sc3RyaXByZSwgJycpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgd2lkdGhcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZ2xlZnQgPSA3O1xuICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGNvbC53aWR0aCB8fCBkZWZhdWx0V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWR0aCAhPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHRtcFdpZHRoIHx8ICh3aWR0aCAtIHBhZGRpbmdsZWZ0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBkYXRhQ2VsbC5jaGlsZHJlbihcImRpdiNcIitncmlkQ2VsbE5hbWUraSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbGFzdCB8fCBsYXN0Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgPSAkKFwiPGRpdj48L2Rpdj5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiPHNwYW4+PC9zcGFuPlwiKS5hcHBlbmRUbyhsYXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuYXR0cihcImlkXCIsZ3JpZENlbGxOYW1lK2kpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhncmlkQ2VsbE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hdHRyKE5PREVfREFUQV9BVFRSLGxpZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHB1dCBpdCBpbiB0aGUgZGF0YUNlbGwgLSBhZnRlciB0aGUgcGFyZW50LCBidXQgdGhlIHBvc2l0aW9uIG1hdHRlcnNcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBubyBwYXJlbnQsIHRoZW4gd2UgYXJlIG9uZSBvZiB0aGUgcm9vdCBub2RlcywgYnV0IHN0aWxsIG5lZWQgdG8gbG9vayBhdCBwZWVyc1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGZpcnN0LCBpLmUuIHBvcyA9PT0gMCwgd2UgZ28gcmlnaHQgYWZ0ZXIgdGhlIHBhcmVudDtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIG5vdCBmaXJzdCwgYW5kIG91ciBwcmV2aW91cyBwZWVyIChvbmUgYmVmb3JlIHVzKSBpcyBjbG9zZWQsIHdlIGdvIHJpZ2h0IGFmdGVyIHRoZSBwcmV2aW91cyBwZWVyIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIG5vdCBmaXJzdCwgYW5kIG91ciBwcmV2aW91cyBwZWVyIGlzIG9wZW5lZCwgdGhlbiB3ZSBoYXZlIHRvIGZpbmQgaXRzIHlvdW5nZXN0ICYgbG93ZXN0IGNsb3NlZCBjaGlsZCAoaW5jbC4gbGVhZilcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgLy8gcHJvYmFibHkgYmUgbXVjaCBlYXNpZXIgdG8gZ28gKmJlZm9yZSogb3VyIG5leHQgb25lXG4gICAgICAgICAgICAgICAgICAgIC8vIGJ1dCB0aGF0IG9uZSBtaWdodCBub3QgYmUgZHJhd24geWV0XG4gICAgICAgICAgICAgICAgICAgIC8vIGhlcmUgaXMgdGhlIGxvZ2ljIGZvciBqc3RyZWUgZHJhd2luZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gICBpdCBkcmF3cyBwZWVycyBmcm9tIGZpcnN0IHRvIGxhc3Qgb3IgZnJvbSBsYXN0IHRvIGZpcnN0XG4gICAgICAgICAgICAgICAgICAgIC8vICAgaXQgZHJhd3MgY2hpbGRyZW4gYmVmb3JlIGEgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIEkgY2FuIHJlbHkgb24gbXkgKnBhcmVudCogbm90IGJlaW5nIGRyYXduLCBidXQgSSBjYW5ub3QgcmVseSBvbiBteSBwcmV2aW91cyBwZWVyIG9yIG15IG5leHQgcGVlciBiZWluZyBkcmF3blxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGRvIHRoZSBmb2xsb3dpbmc6XG4gICAgICAgICAgICAgICAgICAgIC8vICAgMS0gV2UgYXJlIHRoZSBmaXJzdCBjaGlsZDogaW5zdGFsbCBhZnRlciB0aGUgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIC8vICAgMi0gT3VyIHByZXZpb3VzIHBlZXIgaXMgYWxyZWFkeSBkcmF3bjogaW5zdGFsbCBhZnRlciB0aGUgcHJldmlvdXMgcGVlclxuICAgICAgICAgICAgICAgICAgICAvLyAgIDMtIE91ciBwcmV2aW91cyBwZWVyIGlzIG5vdCBkcmF3biwgd2UgaGF2ZSBhIGNoaWxkIHRoYXQgaXMgZHJhd246IGluc3RhbGwgcmlnaHQgYmVmb3JlIG91ciBmaXJzdCBjaGlsZFxuICAgICAgICAgICAgICAgICAgICAvLyAgIDQtIE91ciBwcmV2aW91cyBwZWVyIGlzIG5vdCBkcmF3biwgd2UgaGF2ZSBubyBjaGlsZCB0aGF0IGlzIGRyYXduLCBvdXIgbmV4dCBwZWVyIGlzIGRyYXduOiBpbnN0YWxsIHJpZ2h0IGJlZm9yZSBvdXIgbmV4dCBwZWVyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgNS0gT3VyIHByZXZpb3VzIHBlZXIgaXMgbm90IGRyYXduLCB3ZSBoYXZlIG5vIGNoaWxkIHRoYXQgaXMgZHJhd24sIG91ciBuZXh0IHBlZXIgaXMgbm90IGRyYXduOiBpbnN0YWxsIHJpZ2h0IGFmdGVyIHBhcmVudFxuICAgICAgICAgICAgICAgICAgICBncmlkQ2VsbFByZXZJZCA9IHBvcyA8PTAgPyBvYmpEYXRhLnBhcmVudCA6IGZpbmRMYXN0Q2xvc2VkTm9kZSh0aGlzLHBlZXJzW3Bvcy0xXSk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsUHJldiA9IGZpbmREYXRhQ2VsbChkYXRhQ2VsbCxncmlkQ2VsbFByZXZJZCk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsTmV4dElkID0gcG9zID49IHBlZXJzLmxlbmd0aC0xID8gXCJOVUxMXCIgOiBwZWVyc1twb3MrMV07XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsTmV4dCA9IGZpbmREYXRhQ2VsbChkYXRhQ2VsbCxncmlkQ2VsbE5leHRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsQ2hpbGRJZCA9IG9iakRhdGEuY2hpbGRyZW4gJiYgb2JqRGF0YS5jaGlsZHJlbi5sZW5ndGggPiAwID8gb2JqRGF0YS5jaGlsZHJlblswXSA6IFwiTlVMTFwiO1xuICAgICAgICAgICAgICAgICAgICBncmlkQ2VsbENoaWxkID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsQ2hpbGRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsUGFyZW50ID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsUGFyZW50SWQpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgb3VyIHBhcmVudCBpcyBhbHJlYWR5IGRyYXduLCB0aGVuIHdlIHB1dCB0aGlzIGluIHRoZSByaWdodCBvcmRlciB1bmRlciBvdXIgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFBhcmVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZENlbGxQYXJlbnQgJiYgZ3JpZENlbGxQYXJlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFByZXYgJiYgZ3JpZENlbGxQcmV2Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRBZnRlcihncmlkQ2VsbFByZXYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ3JpZENlbGxDaGlsZCAmJiBncmlkQ2VsbENoaWxkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChncmlkQ2VsbE5leHQgJiYgZ3JpZENlbGxOZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxOZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEFmdGVyKGdyaWRDZWxsUGFyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWx3YXlzIHB1dCBpdCBpbiB0aGUgaG9sZGluZyBjZWxscywgYW5kIHRoZW4gc29ydCB3aGVuIHRoZSBwYXJlbnQgY29tZXMgaW4sIGluIGNhc2UgcGFyZW50IGlzIChyZSlkcmF3biBsYXRlclxuICAgICAgICAgICAgICAgICAgICAgICAgaGNbZ3JpZENlbGxOYW1lK2ldID0gbGFzdDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFByZXYgJiYgZ3JpZENlbGxQcmV2Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEFmdGVyKGdyaWRDZWxsUHJldik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRDZWxsQ2hpbGQgJiYgZ3JpZENlbGxDaGlsZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRDZWxsTmV4dCAmJiBncmlkQ2VsbE5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuaW5zZXJ0QmVmb3JlKGdyaWRDZWxsTmV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuYXBwZW5kVG8oZGF0YUNlbGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIHdlIGhhdmUgYW55IGNoaWxkcmVuIHdhaXRpbmcgZm9yIHRoaXMgY2VsbD8gd2FsayBkb3duIHRocm91Z2ggdGhlIGNoaWxkcmVuL2dyYW5kY2hpbGRyZW4vZXRjIHRyZWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LmFmdGVyKHRoaXMuZ2V0SG9sZGluZ0NlbGxzKG9iakRhdGEsaSxoYykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gbWFrZSB0aGUgaGVpZ2h0IG9mIHRoaXMgbWF0Y2ggdGhlIGxpbmUgaGVpZ2h0IG9mIHRoZSB0cmVlLiBIb3c/XG4gICAgICAgICAgICAgICAgICAgIHNwYW4gPSBsYXN0LmNoaWxkcmVuKFwic3BhblwiKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBzcGFuIGluc2lkZSB0aGUgZGl2LCBzbyB3ZSBjYW4gY29udHJvbCB3aGF0IGhhcHBlbnMgaW4gdGhlIHdob2xlIGRpdiB2ZXJzdXMgaW5zaWRlIGp1c3QgdGhlIHRleHQvYmFja2dyb3VuZFxuICAgICAgICAgICAgICAgICAgICBzcGFuLmFkZENsYXNzKGNsK1wiIFwiK3ZhbENsYXNzKS5odG1sKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0ID0gbGFzdC5jc3MoY29uZikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jZWxsIGpzdHJlZS1ncmlkLWNlbGwtcm9vdC1cIityb290aWQrXCIganN0cmVlLWdyaWQtY2VsbC1cIitjbGFzc0FkZCtcIiBcIit3Y2wrIFwiIFwiICsgd2lkZVZhbENsYXNzICsgKHRyP1wiIHVpLXN0YXRlLWRlZmF1bHRcIjpcIlwiKSkuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jb2wtXCIraSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjbGljayBoYW5kbGVyIGZvciBjbGlja2luZyBpbnNpZGUgYSBncmlkIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5jbGljayhjZWxsQ2xpY2tIYW5kbGVyKHRyZWUsdCx2YWwsY29sLHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5vbihcImNvbnRleHRtZW51XCIsY2VsbFJpZ2h0Q2xpY2tIYW5kbGVyKHRyZWUsdCx2YWwsY29sLHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5ob3Zlcihob3ZlckluSGFuZGxlcih0LCB0aGlzKSwgaG92ZXJPdXRIYW5kbGVyKHQsIHRoaXMpKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uYXR0cihcInRpdGxlXCIsdGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGwtbGFzdFwiKyh0cj9cIiB1aS1zdGF0ZS1kZWZhdWx0XCI6XCJcIikpO1xuICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdpZHRoIGdpdmVuIGZvciB0aGUgbGFzdCBjb2x1bW4sIGRvIGl0IHZpYSBhdXRvbWF0aWNcbiAgICAgICAgICAgICAgICBpZiAoY29sc1tjb2xzLmxlbmd0aC0xXS53aWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC13aWR0aC1hdXRvXCIpLm5leHQoXCIuanN0cmVlLWdyaWQtc2VwYXJhdG9yXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3MoeydvdmVyZmxvdy15JzonYXV0byAhaW1wb3J0YW50J30pO1xuICAgICAgICB9O1xuICAgICAgICAvLyBjbGVhbiB1cCBob2xkaW5nIGNlbGxzXG4gICAgICAgIHRoaXMuaG9sZGluZ0NlbGxzID0ge307XG5cbiAgICAgICAgLy8gbmVlZCB0byBkbyBhbHRlcm5hdGluZyBiYWNrZ3JvdW5kIGNvbG9ycyBvciBib3JkZXJzXG4gICAgfTtcbn0pKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY21zL3N0YXRpYy9jbXMvanMvbGlicy9qc3RyZWUvanN0cmVlLmdyaWQubWluLmpzXG4vLyBtb2R1bGUgaWQgPSAxMDVcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");
=======
cmsWebpackJsonp([1],{

/***/ 102:
/***/ (function(module, exports, __webpack_require__) {

eval("/*\n * Copyright https://github.com/divio/django-cms\n */\n\nvar $ = __webpack_require__(0);\n\n__webpack_require__(86);\n__webpack_require__(108);\n\nvar Class = __webpack_require__(4);\nvar Helpers = __webpack_require__(1).default.API.Helpers;\nvar KEYS = __webpack_require__(1).default.KEYS;\nvar PageTreeDropdowns = __webpack_require__(112);\nvar PageTreeStickyHeader = __webpack_require__(113);\n\n/**\n                                                                    * The pagetree is loaded via `/admin/cms/page` and has a custom admin\n                                                                    * templates stored within `templates/admin/cms/page/tree`.\n                                                                    *\n                                                                    * @class PageTree\n                                                                    * @namespace CMS\n                                                                    */\nvar PageTree = new Class({\n    options: {\n        pasteSelector: '.js-cms-tree-item-paste' },\n\n    // TODO add mechanics to set the home page\n    initialize: function initialize(options) {\n        // options are loaded from the pagetree html node\n        var opts = $('.js-cms-pagetree').data('json');\n\n        this.options = $.extend(true, {}, this.options, opts, options);\n\n        // states and events\n        this.click = 'click.cms.pagetree';\n        this.clipboard = {\n            id: null,\n            origin: null,\n            type: '' };\n\n        this.successTimer = 1000;\n\n        // elements\n        this._setupUI();\n        this._events();\n\n        // cancel if pagetree is not available\n        if (!$.isEmptyObject(opts)) {\n            this._setup();\n        }\n    },\n\n    /**\n        * Stores all jQuery references within `this.ui`.\n        *\n        * @method _setupUI\n        * @private\n        */\n    _setupUI: function _setupUI() {\n        var pagetree = $('.cms-pagetree');\n\n        this.ui = {\n            container: pagetree,\n            document: $(document),\n            tree: pagetree.find('.js-cms-pagetree'),\n            dialog: $('.js-cms-tree-dialog'),\n            siteForm: $('.js-cms-pagetree-site-form') };\n\n    },\n\n    /**\n        * Setting up the jstree and the related columns.\n        *\n        * @method _setup\n        * @private\n        */\n    _setup: function _setup() {\n        var that = this;\n        var columns = [];\n        var obj = {\n            language: this.options.lang.code,\n            openNodes: [] };\n\n        var data = false;\n\n        // make sure that ajax request send the csrf token\n        Helpers.csrf(this.options.csrf);\n\n        // setup column headings\n        // eslint-disable-next-line no-shadow\n        $.each(this.options.columns, function (index, obj) {\n            if (obj.key === '') {\n                // the first row is already populated, to avoid overwrites\n                // just leave the \"key\" param empty\n                columns.push({\n                    header: obj.title,\n                    width: obj.width || '1%',\n                    wideCellClass: obj.cls });\n\n            } else {\n                columns.push({\n                    header: obj.title,\n                    value: function value(node) {\n                        // it needs to have the \"colde\" format and not \"col-de\"\n                        // as jstree will convert \"col-de\" to \"colde\"\n                        // also we strip dashes, in case language code contains it\n                        // e.g. zh-hans, zh-cn etc\n                        if (node.data) {\n                            return node.data['col' + obj.key.replace('-', '')];\n                        }\n\n                        return '';\n                    },\n                    width: obj.width || '1%',\n                    wideCellClass: obj.cls });\n\n            }\n        });\n\n        // prepare data\n        if (!this.options.filtered) {\n            data = {\n                url: this.options.urls.tree,\n                cache: false,\n                data: function data(node) {\n                    // '#' is rendered if its the root node, there we only\n                    // care about `obj.openNodes`, in the following case\n                    // we are requesting a specific node\n                    if (node.id === '#') {\n                        obj.pageId = null;\n                    } else {\n                        obj.pageId = that._storeNodeId(node.data.id);\n                    }\n\n                    // we need to store the opened items inside the localstorage\n                    // as we have to load the pagetree with the previous opened\n                    // state\n                    obj.openNodes = that._getStoredNodeIds();\n\n                    // we need to set the site id to get the correct tree\n                    obj.site = that.options.site;\n\n                    return obj;\n                } };\n\n        }\n\n        // bind options to the jstree instance\n        this.ui.tree.jstree({\n            core: {\n                // disable open/close animations\n                animation: 0,\n                // core setting to allow actions\n                // eslint-disable-next-line max-params\n                check_callback: function check_callback(operation, node, node_parent, node_position, more) {\n                    if ((operation === 'move_node' || operation === 'copy_node') && more && more.pos) {\n                        if (more.pos === 'i') {\n                            $('#jstree-marker').addClass('jstree-marker-child');\n                        } else {\n                            $('#jstree-marker').removeClass('jstree-marker-child');\n                        }\n                    }\n\n                    return that._hasPermission(node_parent, 'add');\n                },\n                // https://www.jstree.com/api/#/?f=$.jstree.defaults.core.data\n                data: data,\n                // strings used within jstree that are called using `get_string`\n                strings: {\n                    'Loading ...': this.options.lang.loading,\n                    'New node': this.options.lang.newNode,\n                    'nodes': this.options.lang.nodes },\n\n                error: function error(_error) {\n                    // ignore warnings about dragging parent into child\n                    var errorData = JSON.parse(_error.data);\n\n                    if (_error.error === 'check' && errorData && errorData.chk === 'move_node') {\n                        return;\n                    }\n                    that.showError(_error.reason);\n                },\n                themes: {\n                    name: 'django-cms' },\n\n                // disable the multi selection of nodes for now\n                multiple: false },\n\n            // activate drag and drop plugin\n            plugins: ['dnd', 'search', 'grid'],\n            // https://www.jstree.com/api/#/?f=$.jstree.defaults.dnd\n            dnd: {\n                inside_pos: 'last',\n                // disable the multi selection of nodes for now\n                drag_selection: false,\n                // disable dragging if filtered\n                is_draggable: function is_draggable(nodes) {\n                    return that._hasPermission(nodes[0], 'move') && !that.options.filtered;\n                },\n                large_drop_target: true,\n                copy: true },\n\n            // https://github.com/deitch/jstree-grid\n            grid: {\n                // columns are provided from base.html options\n                width: '100%',\n                columns: columns } });\n\n\n\n    },\n\n    /**\n        * Sets up all the event handlers, such as opening and moving.\n        *\n        * @method _events\n        * @private\n        */\n    _events: function _events() {\n        var that = this;\n\n        // set events for the nodeId updates\n        this.ui.tree.on('after_close.jstree', function (e, el) {\n            that._removeNodeId(el.node.data.id);\n        });\n\n        this.ui.tree.on('after_open.jstree', function (e, el) {\n            that._storeNodeId(el.node.data.id);\n\n            // `after_open` event can be triggered when pasting\n            // is in progress (meaning we are pasting into a leaf node\n            // in this case we do not need to update helpers state\n            if (this.clipboard && !this.clipboard.isPasting) {\n                that._updatePasteHelpersState();\n            }\n        });\n\n        this.ui.document.on('keydown.pagetree.alt-mode', function (e) {\n            if (e.keyCode === KEYS.SHIFT) {\n                that.ui.container.addClass('cms-pagetree-alt-mode');\n            }\n        });\n\n        this.ui.document.on('keyup.pagetree.alt-mode', function (e) {\n            if (e.keyCode === KEYS.SHIFT) {\n                that.ui.container.removeClass('cms-pagetree-alt-mode');\n            }\n        });\n\n        this.ui.document.on('dnd_start.vakata', function (e, data) {\n            var element = $(data.element);\n            var node = element.parent();\n\n            that._dropdowns.closeAllDropdowns();\n\n            node.addClass('jstree-is-dragging');\n            data.data.nodes.forEach(function (nodeId) {\n                var descendantIds = that._getDescendantsIds(nodeId);\n\n                [nodeId].concat(descendantIds).forEach(function (id) {\n                    $('.jsgrid_' + id + '_col').addClass('jstree-is-dragging');\n                });\n            });\n\n            if (!node.hasClass('jstree-leaf')) {\n                data.helper.addClass('is-stacked');\n            }\n        });\n\n        var isCopyClassAdded = false;\n\n        this.ui.document.on('dnd_move.vakata', function (e, data) {\n            var isMovingCopy = data.data.origin && (\n            data.data.origin.settings.dnd.always_copy ||\n            data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey));\n\n\n            if (isMovingCopy) {\n                if (!isCopyClassAdded) {\n                    $('.jstree-is-dragging').addClass('jstree-is-dragging-copy');\n                    isCopyClassAdded = true;\n                }\n            } else if (isCopyClassAdded) {\n                $('.jstree-is-dragging').removeClass('jstree-is-dragging-copy');\n                isCopyClassAdded = false;\n            }\n        });\n\n        this.ui.document.on('dnd_stop.vakata', function (e, data) {\n            var element = $(data.element);\n            var node = element.parent();\n\n            node.removeClass('jstree-is-dragging jstree-is-dragging-copy');\n            data.data.nodes.forEach(function (nodeId) {\n                var descendantIds = that._getDescendantsIds(nodeId);\n\n                [nodeId].concat(descendantIds).forEach(function (id) {\n                    $('.jsgrid_' + id + '_col').removeClass('jstree-is-dragging jstree-is-dragging-copy');\n                });\n            });\n        });\n\n        // store moved position node\n        this.ui.tree.on('move_node.jstree copy_node.jstree', function (e, obj) {\n            if (!that.clipboard.type && e.type !== 'copy_node' || that.clipboard.type === 'cut') {\n                that._moveNode(that._getNodePosition(obj)).done(function () {\n                    var instance = that.ui.tree.jstree(true);\n\n                    instance._hide_grid(instance.get_node(obj.parent));\n                    if (obj.parent === '#') {\n                        instance.refresh();\n                    } else {\n                        // have to refresh parent, because refresh only\n                        // refreshes children of the node, never the node itself\n                        instance.refresh_node(obj.parent);\n                    }\n                });\n            } else {\n                that._copyNode(obj);\n            }\n            // we need to open the parent node if we trigger an element\n            // if not already opened\n            that.ui.tree.jstree('open_node', obj.parent);\n        });\n\n        // set event for cut and paste\n        this.ui.container.on(this.click, '.js-cms-tree-item-cut', function (e) {\n            e.preventDefault();\n            that._cutOrCopy({ type: 'cut', element: $(this) });\n        });\n\n        // set event for cut and paste\n        this.ui.container.on(this.click, '.js-cms-tree-item-copy', function (e) {\n            e.preventDefault();\n            that._cutOrCopy({ type: 'copy', element: $(this) });\n        });\n\n        // attach events to paste\n        this.ui.container.on(this.click, this.options.pasteSelector, function (e) {\n            e.preventDefault();\n            if ($(this).hasClass('cms-pagetree-dropdown-item-disabled')) {\n                return;\n            }\n            that._paste(e);\n        });\n\n        // advanced settings link handling\n        this.ui.container.on(this.click, '.js-cms-tree-advanced-settings', function (e) {\n            if (e.shiftKey) {\n                e.preventDefault();\n                var link = $(this);\n\n                if (link.data('url')) {\n                    window.location.href = link.data('url');\n                }\n            }\n        });\n\n        // add events for error reload (messagelist)\n        this.ui.document.on(this.click, '.messagelist .cms-tree-reload', function (e) {\n            e.preventDefault();\n            that._reloadHelper();\n        });\n\n        // propagate the sites dropdown \"li > a\" entries to the hidden sites form\n        this.ui.container.find('.js-cms-pagetree-site-trigger').on(this.click, function (e) {\n            e.preventDefault();\n            var el = $(this);\n\n            // prevent if parent is active\n            if (el.parent().hasClass('active')) {\n                return false;\n            }\n            that.ui.siteForm.find('select').\n            val(el.data().id).end().submit();\n        });\n\n        // additional event handlers\n        this._setupDropdowns();\n        this._setupSearch();\n\n        // make sure ajax post requests are working\n        this._setAjaxPost('.js-cms-tree-item-menu a');\n        this._setAjaxPost('.js-cms-tree-lang-trigger');\n\n        this._setupPageView();\n        that._setupStickyHeader();\n    },\n\n    /**\n        * Helper to process the cut and copy events.\n        *\n        * @method _cutOrCopy\n        * @param {Object} [obj]\n        * @param {Number} [obj.type] either 'cut' or 'copy'\n        * @param {Number} [obj.element] originated trigger element\n        * @private\n        * @returns {Boolean|void}\n        */\n    _cutOrCopy: function _cutOrCopy(obj) {\n        // prevent actions if you try to copy a page with an apphook\n        if (obj.type === 'copy' && obj.element.data().apphook) {\n            this.showError(this.options.lang.apphook);\n            return false;\n        }\n\n        var jsTreeId = this._getNodeId(obj.element.closest('.jstree-grid-cell'));\n\n        // resets if we click again\n        if (this.clipboard.type === obj.type && jsTreeId === this.clipboard.id) {\n            this.clipboard.type = null;\n            this.clipboard.id = null;\n            this.clipboard.origin = null;\n            this._disablePaste();\n        } else {\n            this.clipboard.origin = obj.element;\n            this.clipboard.type = obj.type;\n            this.clipboard.id = jsTreeId;\n            this._updatePasteHelpersState();\n        }\n    },\n\n    /**\n        * Helper to process the paste event.\n        *\n        * @method _paste\n        * @param {$.Event} event click event\n        * @private\n        */\n    _paste: function _paste(event) {\n        // hide helpers after we picked one\n        this._disablePaste();\n\n        var copyFromId = this._getNodeId(this.clipboard.origin);\n        var copyToId = this._getNodeId($(event.currentTarget));\n\n        if (this.clipboard.type === 'cut') {\n            this.ui.tree.jstree('cut', copyFromId);\n        } else {\n            this.ui.tree.jstree('copy', copyFromId);\n        }\n\n        this.clipboard.isPasting = true;\n        this.ui.tree.jstree('paste', copyToId, 'last');\n        this.clipboard.id = null;\n        this.clipboard.type = null;\n        this.clipboard.origin = null;\n        this.clipboard.isPasting = false;\n    },\n\n    /**\n        * Retreives a list of nodes from local storage.\n        *\n        * @method _getStoredNodeIds\n        * @private\n        * @returns {Array} list of ids\n        */\n    _getStoredNodeIds: function _getStoredNodeIds() {\n        return CMS.settings.pagetree || [];\n    },\n\n    /**\n        * Stores a node in local storage.\n        *\n        * @method _storeNodeId\n        * @private\n        * @param {String} id to be stored\n        * @returns {String} id that has been stored\n        */\n    _storeNodeId: function _storeNodeId(id) {\n        var number = id;\n        var storage = this._getStoredNodeIds();\n\n        // store value only if it isn't there yet\n        if (storage.indexOf(number) === -1) {\n            storage.push(number);\n        }\n\n        CMS.settings.pagetree = storage;\n        Helpers.setSettings(CMS.settings);\n\n        return number;\n    },\n\n    /**\n        * Removes a node in local storage.\n        *\n        * @method _removeNodeId\n        * @private\n        * @param {String} id to be stored\n        * @returns {String} id that has been removed\n        */\n    _removeNodeId: function _removeNodeId(id) {\n        var number = id;\n        var storage = this._getStoredNodeIds();\n        var index = storage.indexOf(number);\n\n        // remove given id from storage\n        if (index !== -1) {\n            storage.splice(index, 1);\n        }\n\n        CMS.settings.pagetree = storage;\n        Helpers.setSettings(CMS.settings);\n\n        return number;\n    },\n\n    /**\n        * Moves a node after drag & drop.\n        *\n        * @method _moveNode\n        * @param {Object} [obj]\n        * @param {Number} [obj.id] current element id for url matching\n        * @param {Number} [obj.target] target sibling or parent\n        * @param {Number} [obj.position] either `left`, `right` or `last-child`\n        * @returns {$.Deferred} ajax request object\n        * @private\n        */\n    _moveNode: function _moveNode(obj) {\n        var that = this;\n\n        obj.site = that.options.site;\n\n        return $.ajax({\n            method: 'post',\n            url: that.options.urls.move.replace('{id}', obj.id),\n            data: obj }).\n        done(function () {\n            that._showSuccess(obj.id);\n        }).fail(function (error) {\n            that.showError(error.statusText);\n        });\n    },\n\n    /**\n        * Copies a node into the selected node.\n        *\n        * @method _copyNode\n        * @param {Object} obj page obj\n        * @private\n        */\n    _copyNode: function _copyNode(obj) {\n        var that = this;\n        var node = that._getNodePosition(obj);\n        var data = {\n            site: this.options.site,\n            // we need to refer to the original item here, as the copied\n            // node will have no data attributes stored at it (not a clone)\n            id: obj.original.data.id,\n            position: node.position };\n\n\n        // if there is no target provided, the node lands in root\n        if (node.target) {\n            data.target = node.target;\n        }\n\n        if (that.options.permission) {\n            // we need to load a dialog first, to check if permissions should\n            // be copied or not\n            $.ajax({\n                method: 'post',\n                url: that.options.urls.copyPermission.replace('{id}', data.id),\n                data: data\n                // the dialog is loaded via the ajax respons originating from\n                // `templates/admin/cms/page/tree/copy_premissions.html`\n            }).done(function (dialog) {\n                that.ui.dialog.append(dialog);\n            }).fail(function (error) {\n                that.showError(error.statusText);\n            });\n\n            // attach events to the permission dialog\n            this.ui.dialog.off(this.click, '.cancel').on(this.click, '.cancel', function (e) {\n                e.preventDefault();\n                // remove just copied node\n                that.ui.tree.jstree('delete_node', obj.node.id);\n                $('.js-cms-dialog').remove();\n                $('.js-cms-dialog-dimmer').remove();\n            }).off(this.click, '.submit').on(this.click, '.submit', function (e) {\n                e.preventDefault();\n                var submitButton = $(this);\n                var formData = submitButton.closest('form').serialize().split('&');\n\n                submitButton.prop('disabled', true);\n\n                // loop through form data and attach to obj\n                for (var i = 0; i < formData.length; i++) {\n                    data[formData[i].split('=')[0]] = formData[i].split('=')[1];\n                }\n\n                that._saveCopiedNode(data);\n            });\n        } else {\n            this._saveCopiedNode(data);\n        }\n    },\n\n    /**\n        * Sends the request to copy a node.\n        *\n        * @method _saveCopiedNode\n        * @private\n        * @param {Object} data node position information\n        * @returns {$.Deferred}\n        */\n    _saveCopiedNode: function _saveCopiedNode(data) {\n        var that = this;\n\n        // send the real ajax request for copying the plugin\n        return $.ajax({\n            method: 'post',\n            url: that.options.urls.copy.replace('{id}', data.id),\n            data: data }).\n        done(function () {\n            that._reloadHelper();\n        }).fail(function (error) {\n            that.showError(error.statusText);\n        });\n    },\n\n    /**\n        * Returns element from any sub nodes.\n        *\n        * @method _getElement\n        * @private\n        * @param {jQuery} el jQuery node form where to search\n        * @returns {String} jsTree node element id\n        */\n    _getNodeId: function _getNodeId(el) {\n        var cls = el.closest('.jstree-grid-cell').attr('class');\n\n        // if it's not a cell, assume it's the root node\n        return cls ? cls.replace(/.*jsgrid_(.+?)_col.*/, '$1') : '#';\n    },\n\n    /**\n        * Gets the new node position after moving.\n        *\n        * @method _getNodePosition\n        * @private\n        * @param {Object} obj jstree move object\n        * @returns {Object} evaluated object with params\n        */\n    _getNodePosition: function _getNodePosition(obj) {\n        var data = {};\n        var node = this.ui.tree.jstree('get_node', obj.node.parent);\n\n        data.position = obj.position;\n\n        // jstree indicates no parent with `#`, in this case we do not\n        // need to set the target attribute at all\n        if (obj.parent !== '#') {\n            data.target = node.data.id;\n        }\n\n        // some functions like copy create a new element with a new id,\n        // in this case we need to set `data.id` manually\n        if (obj.node && obj.node.data) {\n            data.id = obj.node.data.id;\n        }\n\n        return data;\n    },\n\n    /**\n        * Sets up general tooltips that can have a list of links or content.\n        *\n        * @method _setupDropdowns\n        * @private\n        */\n    _setupDropdowns: function _setupDropdowns() {\n        this._dropdowns = new PageTreeDropdowns({\n            container: this.ui.container });\n\n    },\n\n    /**\n        * Handles page view click. Usual use case is that after you click\n        * on view page in the pagetree - sideframe is no longer needed,\n        * so we close it.\n        *\n        * @method _setupPageView\n        * @private\n        */\n    _setupPageView: function _setupPageView() {\n        var win = Helpers._getWindow();\n        var parent = win.parent ? win.parent : win;\n\n        this.ui.container.on(this.click, '.js-cms-pagetree-page-view', function () {\n            parent.CMS.API.Helpers.setSettings($.extend(true, {}, CMS.settings, {\n                sideframe: {\n                    url: null,\n                    hidden: true } }));\n\n\n        });\n    },\n\n    /**\n        * @method _setupStickyHeader\n        * @private\n        */\n    _setupStickyHeader: function _setupStickyHeader() {\n        var that = this;\n\n        that.ui.tree.on('ready.jstree', function () {\n            that.header = new PageTreeStickyHeader({\n                container: that.ui.container });\n\n        });\n    },\n\n    /**\n        * Triggers the links `href` as ajax post request.\n        *\n        * @method _setAjaxPost\n        * @private\n        * @param {jQuery} trigger jQuery link target\n        */\n    _setAjaxPost: function _setAjaxPost(trigger) {\n        var that = this;\n\n        this.ui.container.on(this.click, trigger, function (e) {\n            e.preventDefault();\n            $.ajax({\n                method: 'post',\n                url: $(this).attr('href') }).\n            done(function () {\n                if (window.self === window.top) {\n                    // simply reload the page\n                    that._reloadHelper();\n                } else {\n                    // if we're in the sideframe we have to actually\n                    // check if we are publishing a page we're currently in\n                    // because if the slug did change we would need to\n                    // redirect to that new slug\n                    // Problem here is that in case of the apphooked page\n                    // the model and pk are empty and reloadBrowser doesn't really\n                    // do anything - so here we specifically force the data\n                    // to be the data about the page and not the model\n                    var parent = window.parent ? window.parent : window;\n                    var data = {\n                        // FIXME shouldn't be hardcoded\n                        model: 'cms.page',\n                        pk: parent.CMS.config.request.page_id };\n\n\n                    Helpers.reloadBrowser('REFRESH_PAGE', false, true, data);\n                }\n            }).fail(function (error) {\n                that.showError(error.statusText);\n            });\n        });\n    },\n\n    /**\n        * Sets events for the search on the header.\n        *\n        * @method _setupSearch\n        * @private\n        */\n    _setupSearch: function _setupSearch() {\n        var that = this;\n        var click = this.click + '.search';\n\n        var filterActive = false;\n        var filterTrigger = this.ui.container.find('.js-cms-pagetree-header-filter-trigger');\n        var filterContainer = this.ui.container.find('.js-cms-pagetree-header-filter-container');\n        var filterClose = filterContainer.find('.js-cms-pagetree-header-search-close');\n        var filterClass = 'cms-pagetree-header-filter-active';\n        var pageTreeHeader = $('.cms-pagetree-header');\n\n        var visibleForm = this.ui.container.find('.js-cms-pagetree-header-search');\n        var hiddenForm = this.ui.container.find('.js-cms-pagetree-header-search-copy form');\n\n        var searchContainer = this.ui.container.find('.cms-pagetree-header-filter');\n        var searchField = searchContainer.find('#field-searchbar');\n        var timeout = 200;\n\n        // add active class when focusing the search field\n        searchField.on('focus', function (e) {\n            e.stopImmediatePropagation();\n            pageTreeHeader.addClass(filterClass);\n        });\n        searchField.on('blur', function (e) {\n            e.stopImmediatePropagation();\n            // timeout is required to prevent the search field from jumping\n            // between enlarging and shrinking\n            setTimeout(function () {\n                if (!filterActive) {\n                    pageTreeHeader.removeClass(filterClass);\n                }\n            }, timeout);\n            that.ui.document.off(click);\n        });\n\n        // shows/hides filter box\n        filterTrigger.add(filterClose).on(click, function (e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (filterActive) {\n                filterContainer.hide();\n                pageTreeHeader.removeClass(filterClass);\n                that.ui.document.off(click);\n                filterActive = false;\n            } else {\n                filterContainer.show();\n                pageTreeHeader.addClass(filterClass);\n                that.ui.document.on(click, function () {\n                    filterActive = true;\n                    filterTrigger.trigger(click);\n                });\n                filterActive = true;\n            }\n        });\n\n        // prevent closing when on filter container\n        filterContainer.on('click', function (e) {\n            e.stopImmediatePropagation();\n        });\n\n        // add hidden fields to the form to maintain filter params\n        visibleForm.append(hiddenForm.find('input[type=\"hidden\"]'));\n    },\n\n    /**\n        * Shows paste helpers.\n        *\n        * @method _enablePaste\n        * @param {String} [selector=this.options.pasteSelector] jquery selector\n        * @private\n        */\n    _enablePaste: function _enablePaste(selector) {\n        var sel = typeof selector === 'undefined' ?\n        this.options.pasteSelector :\n        selector + ' ' + this.options.pasteSelector;\n        var dropdownSel = '.js-cms-pagetree-actions-dropdown';\n\n        if (typeof selector !== 'undefined') {\n            dropdownSel = selector + ' .js-cms-pagetree-actions-dropdown';\n        }\n\n        // helpers are generated on the fly, so we need to reference\n        // them every single time\n        $(sel).removeClass('cms-pagetree-dropdown-item-disabled');\n\n        var data = {};\n\n        if (this.clipboard.type === 'cut') {\n            data.has_cut = true;\n        } else {\n            data.has_copy = true;\n        }\n        // not loaded actions dropdown have to be updated as well\n        $(dropdownSel).data('lazyUrlData', data);\n    },\n\n    /**\n        * Hides paste helpers.\n        *\n        * @method _disablePaste\n        * @param {String} [selector=this.options.pasteSelector] jquery selector\n        * @private\n        */\n    _disablePaste: function _disablePaste(selector) {\n        var sel = typeof selector === 'undefined' ?\n        this.options.pasteSelector :\n        selector + ' ' + this.options.pasteSelector;\n        var dropdownSel = '.js-cms-pagetree-actions-dropdown';\n\n        if (typeof selector !== 'undefined') {\n            dropdownSel = selector + ' .js-cms-pagetree-actions-dropdown';\n        }\n\n\n        // helpers are generated on the fly, so we need to reference\n        // them every single time\n        $(sel).addClass('cms-pagetree-dropdown-item-disabled');\n\n        // not loaded actions dropdown have to be updated as well\n        $(dropdownSel).removeData('lazyUrlData');\n    },\n\n    /**\n        * Updates the current state of the helpers after `after_open.jstree`\n        * or `_cutOrCopy` is triggered.\n        *\n        * @method _updatePasteHelpersState\n        * @private\n        */\n    _updatePasteHelpersState: function _updatePasteHelpersState() {\n        var that = this;\n\n        if (this.clipboard.type && this.clipboard.id) {\n            this._enablePaste();\n        }\n\n        // hide cut element and it's descendants' paste helpers if it is visible\n        if (this.clipboard.type === 'cut' && this.clipboard.origin) {\n            var descendantIds = this._getDescendantsIds(this.clipboard.id);\n            var nodes = [this.clipboard.id];\n\n            if (descendantIds && descendantIds.length) {\n                nodes = nodes.concat(descendantIds);\n            }\n\n            nodes.forEach(function (id) {\n                that._disablePaste('.jsgrid_' + id + '_col');\n            });\n        }\n    },\n\n    /**\n        * Shows success message on node after successful action.\n        *\n        * @method _showSuccess\n        * @param {Number} id id of the element to add the success class\n        * @private\n        */\n    _showSuccess: function _showSuccess(id) {\n        var element = this.ui.tree.find('li[data-id=\"' + id + '\"]');\n\n        element.addClass('cms-tree-node-success');\n        setTimeout(function () {\n            element.removeClass('cms-tree-node-success');\n        }, this.successTimer);\n        // hide elements\n        this._disablePaste();\n        this.clipboard.id = null;\n    },\n\n    /**\n        * Checks if we should reload the iframe or entire window. For this we\n        * need to skip `CMS.API.Helpers.reloadBrowser();`.\n        *\n        * @method _reloadHelper\n        * @private\n        */\n    _reloadHelper: function _reloadHelper() {\n        if (window.self === window.top) {\n            Helpers.reloadBrowser();\n        } else {\n            window.location.reload();\n        }\n    },\n\n    /**\n        * Displays an error within the django UI.\n        *\n        * @method showError\n        * @param {String} message string message to display\n        */\n    showError: function showError(message) {\n        var messages = $('.messagelist');\n        var breadcrumb = $('.breadcrumbs');\n        var reload = this.options.lang.reload;\n        var tpl = '' +\n        '<ul class=\"messagelist\">' +\n        '   <li class=\"error\">' +\n        '       {msg} ' +\n        '       <a href=\"#reload\" class=\"cms-tree-reload\"> ' + reload + ' </a>' +\n        '   </li>' +\n        '</ul>';\n        var msg = tpl.replace('{msg}', '<strong>' + this.options.lang.error + '</strong> ' + message);\n\n        if (messages.length) {\n            messages.replaceWith(msg);\n        } else {\n            breadcrumb.after(msg);\n        }\n    },\n\n    /**\n        * @method _getDescendantsIds\n        * @private\n        * @param {String} nodeId jstree id of the node, e.g. j1_3\n        * @returns {String[]} array of ids\n        */\n    _getDescendantsIds: function _getDescendantsIds(nodeId) {\n        return this.ui.tree.jstree(true).get_node(nodeId).children_d;\n    },\n\n    /**\n        * @method _hasPermision\n        * @private\n        * @param {Object} node jstree node\n        * @param {String} permission move / add\n        * @returns {Boolean}\n        */\n    _hasPermission: function _hasPermision(node, permission) {\n        if (node.id === '#' && permission === 'add') {\n            return this.options.hasAddRootPermission;\n        } else if (node.id === '#') {\n            return false;\n        }\n\n        return node.li_attr['data-' + permission + '-permission'] === 'true';\n    } });\n\n\n// shorthand for jQuery(document).ready();\n$(function () {\n    // load cms settings beforehand\n    // have to set toolbar to \"expanded\" by default\n    // otherwise initialization will be incorrect when you\n    // go first to pages and then to normal page\n    window.CMS.config = {\n        settings: {\n            toolbar: 'expanded' },\n\n        urls: {\n            settings: $('.js-cms-pagetree').data('settings-url') } };\n\n\n    window.CMS.settings = Helpers.getSettings();\n    // autoload the pagetree\n    new PageTree();\n});\n\nmodule.exports = PageTree;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLmpzPzgwODEiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbnZhciAkID0gcmVxdWlyZSgnanF1ZXJ5Jyk7XG5cbnJlcXVpcmUoJ2pzdHJlZScpO1xucmVxdWlyZSgnLi4vbGlicy9qc3RyZWUvanN0cmVlLmdyaWQubWluJyk7XG5cbnZhciBDbGFzcyA9IHJlcXVpcmUoJ2NsYXNzanMnKTtcbnZhciBIZWxwZXJzID0gcmVxdWlyZSgnLi9jbXMuYmFzZScpLmRlZmF1bHQuQVBJLkhlbHBlcnM7XG52YXIgS0VZUyA9IHJlcXVpcmUoJy4vY21zLmJhc2UnKS5kZWZhdWx0LktFWVM7XG52YXIgUGFnZVRyZWVEcm9wZG93bnMgPSByZXF1aXJlKCcuL2Ntcy5wYWdldHJlZS5kcm9wZG93bicpO1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gcmVxdWlyZSgnLi9jbXMucGFnZXRyZWUuc3RpY2t5aGVhZGVyJyk7XG5cbi8qKlxuICogVGhlIHBhZ2V0cmVlIGlzIGxvYWRlZCB2aWEgYC9hZG1pbi9jbXMvcGFnZWAgYW5kIGhhcyBhIGN1c3RvbSBhZG1pblxuICogdGVtcGxhdGVzIHN0b3JlZCB3aXRoaW4gYHRlbXBsYXRlcy9hZG1pbi9jbXMvcGFnZS90cmVlYC5cbiAqXG4gKiBAY2xhc3MgUGFnZVRyZWVcbiAqIEBuYW1lc3BhY2UgQ01TXG4gKi9cbnZhciBQYWdlVHJlZSA9IG5ldyBDbGFzcyh7XG4gICAgb3B0aW9uczoge1xuICAgICAgICBwYXN0ZVNlbGVjdG9yOiAnLmpzLWNtcy10cmVlLWl0ZW0tcGFzdGUnXG4gICAgfSxcbiAgICAvLyBUT0RPIGFkZCBtZWNoYW5pY3MgdG8gc2V0IHRoZSBob21lIHBhZ2VcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgLy8gb3B0aW9ucyBhcmUgbG9hZGVkIGZyb20gdGhlIHBhZ2V0cmVlIGh0bWwgbm9kZVxuICAgICAgICB2YXIgb3B0cyA9ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdqc29uJyk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0cywgb3B0aW9ucyk7XG5cbiAgICAgICAgLy8gc3RhdGVzIGFuZCBldmVudHNcbiAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMucGFnZXRyZWUnO1xuICAgICAgICB0aGlzLmNsaXBib2FyZCA9IHtcbiAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgb3JpZ2luOiBudWxsLFxuICAgICAgICAgICAgdHlwZTogJydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdWNjZXNzVGltZXIgPSAxMDAwO1xuXG4gICAgICAgIC8vIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuX3NldHVwVUkoKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzKCk7XG5cbiAgICAgICAgLy8gY2FuY2VsIGlmIHBhZ2V0cmVlIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3Qob3B0cykpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldHVwKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU3RvcmVzIGFsbCBqUXVlcnkgcmVmZXJlbmNlcyB3aXRoaW4gYHRoaXMudWlgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICB2YXIgcGFnZXRyZWUgPSAkKCcuY21zLXBhZ2V0cmVlJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogcGFnZXRyZWUsXG4gICAgICAgICAgICBkb2N1bWVudDogJChkb2N1bWVudCksXG4gICAgICAgICAgICB0cmVlOiBwYWdldHJlZS5maW5kKCcuanMtY21zLXBhZ2V0cmVlJyksXG4gICAgICAgICAgICBkaWFsb2c6ICQoJy5qcy1jbXMtdHJlZS1kaWFsb2cnKSxcbiAgICAgICAgICAgIHNpdGVGb3JtOiAkKCcuanMtY21zLXBhZ2V0cmVlLXNpdGUtZm9ybScpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldHRpbmcgdXAgdGhlIGpzdHJlZSBhbmQgdGhlIHJlbGF0ZWQgY29sdW1ucy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXA6IGZ1bmN0aW9uIF9zZXR1cCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgY29sdW1ucyA9IFtdO1xuICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMub3B0aW9ucy5sYW5nLmNvZGUsXG4gICAgICAgICAgICBvcGVuTm9kZXM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHZhciBkYXRhID0gZmFsc2U7XG5cbiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgYWpheCByZXF1ZXN0IHNlbmQgdGhlIGNzcmYgdG9rZW5cbiAgICAgICAgSGVscGVycy5jc3JmKHRoaXMub3B0aW9ucy5jc3JmKTtcblxuICAgICAgICAvLyBzZXR1cCBjb2x1bW4gaGVhZGluZ3NcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNoYWRvd1xuICAgICAgICAkLmVhY2godGhpcy5vcHRpb25zLmNvbHVtbnMsIGZ1bmN0aW9uIChpbmRleCwgb2JqKSB7XG4gICAgICAgICAgICBpZiAob2JqLmtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGUgZmlyc3Qgcm93IGlzIGFscmVhZHkgcG9wdWxhdGVkLCB0byBhdm9pZCBvdmVyd3JpdGVzXG4gICAgICAgICAgICAgICAgLy8ganVzdCBsZWF2ZSB0aGUgXCJrZXlcIiBwYXJhbSBlbXB0eVxuICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcjogb2JqLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogb2JqLndpZHRoIHx8ICcxJScsXG4gICAgICAgICAgICAgICAgICAgIHdpZGVDZWxsQ2xhc3M6IG9iai5jbHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBvYmoudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgbmVlZHMgdG8gaGF2ZSB0aGUgXCJjb2xkZVwiIGZvcm1hdCBhbmQgbm90IFwiY29sLWRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIGpzdHJlZSB3aWxsIGNvbnZlcnQgXCJjb2wtZGVcIiB0byBcImNvbGRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsc28gd2Ugc3RyaXAgZGFzaGVzLCBpbiBjYXNlIGxhbmd1YWdlIGNvZGUgY29udGFpbnMgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGUuZy4gemgtaGFucywgemgtY24gZXRjXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZGF0YVsnY29sJyArIG9iai5rZXkucmVwbGFjZSgnLScsICcnKV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG9iai53aWR0aCB8fCAnMSUnLFxuICAgICAgICAgICAgICAgICAgICB3aWRlQ2VsbENsYXNzOiBvYmouY2xzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHByZXBhcmUgZGF0YVxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5maWx0ZXJlZCkge1xuICAgICAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMub3B0aW9ucy51cmxzLnRyZWUsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICcjJyBpcyByZW5kZXJlZCBpZiBpdHMgdGhlIHJvb3Qgbm9kZSwgdGhlcmUgd2Ugb25seVxuICAgICAgICAgICAgICAgICAgICAvLyBjYXJlIGFib3V0IGBvYmoub3Blbk5vZGVzYCwgaW4gdGhlIGZvbGxvd2luZyBjYXNlXG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIGFyZSByZXF1ZXN0aW5nIGEgc3BlY2lmaWMgbm9kZVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucGFnZUlkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdlSWQgPSB0aGF0Ll9zdG9yZU5vZGVJZChub2RlLmRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzdG9yZSB0aGUgb3BlbmVkIGl0ZW1zIGluc2lkZSB0aGUgbG9jYWxzdG9yYWdlXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzIHdlIGhhdmUgdG8gbG9hZCB0aGUgcGFnZXRyZWUgd2l0aCB0aGUgcHJldmlvdXMgb3BlbmVkXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcGVuTm9kZXMgPSB0aGF0Ll9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzZXQgdGhlIHNpdGUgaWQgdG8gZ2V0IHRoZSBjb3JyZWN0IHRyZWVcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNpdGUgPSB0aGF0Lm9wdGlvbnMuc2l0ZTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBiaW5kIG9wdGlvbnMgdG8gdGhlIGpzdHJlZSBpbnN0YW5jZVxuICAgICAgICB0aGlzLnVpLnRyZWUuanN0cmVlKHtcbiAgICAgICAgICAgIGNvcmU6IHtcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIG9wZW4vY2xvc2UgYW5pbWF0aW9uc1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMCxcbiAgICAgICAgICAgICAgICAvLyBjb3JlIHNldHRpbmcgdG8gYWxsb3cgYWN0aW9uc1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgICAgICAgICAgICAgY2hlY2tfY2FsbGJhY2s6IGZ1bmN0aW9uIChvcGVyYXRpb24sIG5vZGUsIG5vZGVfcGFyZW50LCBub2RlX3Bvc2l0aW9uLCBtb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0aW9uID09PSAnbW92ZV9ub2RlJyB8fCBvcGVyYXRpb24gPT09ICdjb3B5X25vZGUnKSAmJiBtb3JlICYmIG1vcmUucG9zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9yZS5wb3MgPT09ICdpJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNqc3RyZWUtbWFya2VyJykuYWRkQ2xhc3MoJ2pzdHJlZS1tYXJrZXItY2hpbGQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2pzdHJlZS1tYXJrZXInKS5yZW1vdmVDbGFzcygnanN0cmVlLW1hcmtlci1jaGlsZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2hhc1Blcm1pc3Npb24obm9kZV9wYXJlbnQsICdhZGQnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LmpzdHJlZS5jb20vYXBpLyMvP2Y9JC5qc3RyZWUuZGVmYXVsdHMuY29yZS5kYXRhXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAvLyBzdHJpbmdzIHVzZWQgd2l0aGluIGpzdHJlZSB0aGF0IGFyZSBjYWxsZWQgdXNpbmcgYGdldF9zdHJpbmdgXG4gICAgICAgICAgICAgICAgc3RyaW5nczoge1xuICAgICAgICAgICAgICAgICAgICAnTG9hZGluZyAuLi4nOiB0aGlzLm9wdGlvbnMubGFuZy5sb2FkaW5nLFxuICAgICAgICAgICAgICAgICAgICAnTmV3IG5vZGUnOiB0aGlzLm9wdGlvbnMubGFuZy5uZXdOb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbm9kZXMnOiB0aGlzLm9wdGlvbnMubGFuZy5ub2Rlc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgd2FybmluZ3MgYWJvdXQgZHJhZ2dpbmcgcGFyZW50IGludG8gY2hpbGRcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yRGF0YSA9IEpTT04ucGFyc2UoZXJyb3IuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmVycm9yID09PSAnY2hlY2snICYmIGVycm9yRGF0YSAmJiBlcnJvckRhdGEuY2hrID09PSAnbW92ZV9ub2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnJlYXNvbik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGVtZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2RqYW5nby1jbXMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIHRoZSBtdWx0aSBzZWxlY3Rpb24gb2Ygbm9kZXMgZm9yIG5vd1xuICAgICAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGFjdGl2YXRlIGRyYWcgYW5kIGRyb3AgcGx1Z2luXG4gICAgICAgICAgICBwbHVnaW5zOiBbJ2RuZCcsICdzZWFyY2gnLCAnZ3JpZCddLFxuICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cuanN0cmVlLmNvbS9hcGkvIy8/Zj0kLmpzdHJlZS5kZWZhdWx0cy5kbmRcbiAgICAgICAgICAgIGRuZDoge1xuICAgICAgICAgICAgICAgIGluc2lkZV9wb3M6ICdsYXN0JyxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIHRoZSBtdWx0aSBzZWxlY3Rpb24gb2Ygbm9kZXMgZm9yIG5vd1xuICAgICAgICAgICAgICAgIGRyYWdfc2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIGRyYWdnaW5nIGlmIGZpbHRlcmVkXG4gICAgICAgICAgICAgICAgaXNfZHJhZ2dhYmxlOiBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2hhc1Blcm1pc3Npb24obm9kZXNbMF0sICdtb3ZlJykgJiYgIXRoYXQub3B0aW9ucy5maWx0ZXJlZDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhcmdlX2Ryb3BfdGFyZ2V0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvcHk6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkXG4gICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgLy8gY29sdW1ucyBhcmUgcHJvdmlkZWQgZnJvbSBiYXNlLmh0bWwgb3B0aW9uc1xuICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgY29sdW1uczogY29sdW1uc1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMsIHN1Y2ggYXMgb3BlbmluZyBhbmQgbW92aW5nLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gc2V0IGV2ZW50cyBmb3IgdGhlIG5vZGVJZCB1cGRhdGVzXG4gICAgICAgIHRoaXMudWkudHJlZS5vbignYWZ0ZXJfY2xvc2UuanN0cmVlJywgZnVuY3Rpb24gKGUsIGVsKSB7XG4gICAgICAgICAgICB0aGF0Ll9yZW1vdmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdhZnRlcl9vcGVuLmpzdHJlZScsIGZ1bmN0aW9uIChlLCBlbCkge1xuICAgICAgICAgICAgdGhhdC5fc3RvcmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcblxuICAgICAgICAgICAgLy8gYGFmdGVyX29wZW5gIGV2ZW50IGNhbiBiZSB0cmlnZ2VyZWQgd2hlbiBwYXN0aW5nXG4gICAgICAgICAgICAvLyBpcyBpbiBwcm9ncmVzcyAobWVhbmluZyB3ZSBhcmUgcGFzdGluZyBpbnRvIGEgbGVhZiBub2RlXG4gICAgICAgICAgICAvLyBpbiB0aGlzIGNhc2Ugd2UgZG8gbm90IG5lZWQgdG8gdXBkYXRlIGhlbHBlcnMgc3RhdGVcbiAgICAgICAgICAgIGlmICh0aGlzLmNsaXBib2FyZCAmJiAhdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5kb2N1bWVudC5vbigna2V5ZG93bi5wYWdldHJlZS5hbHQtbW9kZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLRVlTLlNISUZUKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5jb250YWluZXIuYWRkQ2xhc3MoJ2Ntcy1wYWdldHJlZS1hbHQtbW9kZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdrZXl1cC5wYWdldHJlZS5hbHQtbW9kZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLRVlTLlNISUZUKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5jb250YWluZXIucmVtb3ZlQ2xhc3MoJ2Ntcy1wYWdldHJlZS1hbHQtbW9kZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfc3RhcnQudmFrYXRhJywgZnVuY3Rpb24gKGUsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChkYXRhLmVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIG5vZGUgPSBlbGVtZW50LnBhcmVudCgpO1xuXG4gICAgICAgICAgICB0aGF0Ll9kcm9wZG93bnMuY2xvc2VBbGxEcm9wZG93bnMoKTtcblxuICAgICAgICAgICAgbm9kZS5hZGRDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICBkYXRhLmRhdGEubm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlc2NlbmRhbnRJZHMgPSB0aGF0Ll9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpO1xuXG4gICAgICAgICAgICAgICAgW25vZGVJZF0uY29uY2F0KGRlc2NlbmRhbnRJZHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5qc2dyaWRfJyArIGlkICsgJ19jb2wnKS5hZGRDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFub2RlLmhhc0NsYXNzKCdqc3RyZWUtbGVhZicpKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5oZWxwZXIuYWRkQ2xhc3MoJ2lzLXN0YWNrZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGlzQ29weUNsYXNzQWRkZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfbW92ZS52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGlzTW92aW5nQ29weSA9IGRhdGEuZGF0YS5vcmlnaW4gJiYgKFxuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5IHx8XG4gICAgICAgICAgICAgICAgICAgIChkYXRhLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5ICYmIChkYXRhLmV2ZW50Lm1ldGFLZXkgfHwgZGF0YS5ldmVudC5jdHJsS2V5KSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChpc01vdmluZ0NvcHkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzQ29weUNsYXNzQWRkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmpzdHJlZS1pcy1kcmFnZ2luZycpLmFkZENsYXNzKCdqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgICAgICAgICBpc0NvcHlDbGFzc0FkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29weUNsYXNzQWRkZWQpIHtcbiAgICAgICAgICAgICAgICAkKCcuanN0cmVlLWlzLWRyYWdnaW5nJykucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZy1jb3B5Jyk7XG4gICAgICAgICAgICAgICAgaXNDb3B5Q2xhc3NBZGRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfc3RvcC52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGRhdGEuZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgbm9kZSA9IGVsZW1lbnQucGFyZW50KCk7XG5cbiAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZyBqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgZGF0YS5kYXRhLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkZXNjZW5kYW50SWRzID0gdGhhdC5fZ2V0RGVzY2VuZGFudHNJZHMobm9kZUlkKTtcblxuICAgICAgICAgICAgICAgIFtub2RlSWRdLmNvbmNhdChkZXNjZW5kYW50SWRzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuanNncmlkXycgKyBpZCArICdfY29sJykucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZyBqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHN0b3JlIG1vdmVkIHBvc2l0aW9uIG5vZGVcbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgb2JqKSB7XG4gICAgICAgICAgICBpZiAoIXRoYXQuY2xpcGJvYXJkLnR5cGUgJiYgZS50eXBlICE9PSAnY29weV9ub2RlJyB8fCB0aGF0LmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgICAgIHRoYXQuX21vdmVOb2RlKHRoYXQuX2dldE5vZGVQb3NpdGlvbihvYmopKS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhhdC51aS50cmVlLmpzdHJlZSh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5faGlkZV9ncmlkKGluc3RhbmNlLmdldF9ub2RlKG9iai5wYXJlbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5wYXJlbnQgPT09ICcjJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSB0byByZWZyZXNoIHBhcmVudCwgYmVjYXVzZSByZWZyZXNoIG9ubHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnJlc2hlcyBjaGlsZHJlbiBvZiB0aGUgbm9kZSwgbmV2ZXIgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoX25vZGUob2JqLnBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fY29weU5vZGUob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gb3BlbiB0aGUgcGFyZW50IG5vZGUgaWYgd2UgdHJpZ2dlciBhbiBlbGVtZW50XG4gICAgICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBvcGVuZWRcbiAgICAgICAgICAgIHRoYXQudWkudHJlZS5qc3RyZWUoJ29wZW5fbm9kZScsIG9iai5wYXJlbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgZXZlbnQgZm9yIGN1dCBhbmQgcGFzdGVcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1pdGVtLWN1dCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGF0Ll9jdXRPckNvcHkoeyB0eXBlOiAnY3V0JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc2V0IGV2ZW50IGZvciBjdXQgYW5kIHBhc3RlXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssICcuanMtY21zLXRyZWUtaXRlbS1jb3B5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoYXQuX2N1dE9yQ29weSh7IHR5cGU6ICdjb3B5JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byBwYXN0ZVxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvciwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdjbXMtcGFnZXRyZWUtZHJvcGRvd24taXRlbS1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhhdC5fcGFzdGUoZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkdmFuY2VkIHNldHRpbmdzIGxpbmsgaGFuZGxpbmdcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1hZHZhbmNlZC1zZXR0aW5ncycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgbGluayA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAobGluay5kYXRhKCd1cmwnKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGxpbmsuZGF0YSgndXJsJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhZGQgZXZlbnRzIGZvciBlcnJvciByZWxvYWQgKG1lc3NhZ2VsaXN0KVxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKHRoaXMuY2xpY2ssICcubWVzc2FnZWxpc3QgLmNtcy10cmVlLXJlbG9hZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJvcGFnYXRlIHRoZSBzaXRlcyBkcm9wZG93biBcImxpID4gYVwiIGVudHJpZXMgdG8gdGhlIGhpZGRlbiBzaXRlcyBmb3JtXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtc2l0ZS10cmlnZ2VyJykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgIC8vIHByZXZlbnQgaWYgcGFyZW50IGlzIGFjdGl2ZVxuICAgICAgICAgICAgaWYgKGVsLnBhcmVudCgpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoYXQudWkuc2l0ZUZvcm0uZmluZCgnc2VsZWN0JylcbiAgICAgICAgICAgICAgICAudmFsKGVsLmRhdGEoKS5pZCkuZW5kKCkuc3VibWl0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZGl0aW9uYWwgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgdGhpcy5fc2V0dXBEcm9wZG93bnMoKTtcbiAgICAgICAgdGhpcy5fc2V0dXBTZWFyY2goKTtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgYWpheCBwb3N0IHJlcXVlc3RzIGFyZSB3b3JraW5nXG4gICAgICAgIHRoaXMuX3NldEFqYXhQb3N0KCcuanMtY21zLXRyZWUtaXRlbS1tZW51IGEnKTtcbiAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1sYW5nLXRyaWdnZXInKTtcblxuICAgICAgICB0aGlzLl9zZXR1cFBhZ2VWaWV3KCk7XG4gICAgICAgIHRoYXQuX3NldHVwU3RpY2t5SGVhZGVyKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhlbHBlciB0byBwcm9jZXNzIHRoZSBjdXQgYW5kIGNvcHkgZXZlbnRzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfY3V0T3JDb3B5XG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmpdXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvYmoudHlwZV0gZWl0aGVyICdjdXQnIG9yICdjb3B5J1xuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLmVsZW1lbnRdIG9yaWdpbmF0ZWQgdHJpZ2dlciBlbGVtZW50XG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbnx2b2lkfVxuICAgICAqL1xuICAgIF9jdXRPckNvcHk6IGZ1bmN0aW9uIF9jdXRPckNvcHkob2JqKSB7XG4gICAgICAgIC8vIHByZXZlbnQgYWN0aW9ucyBpZiB5b3UgdHJ5IHRvIGNvcHkgYSBwYWdlIHdpdGggYW4gYXBwaG9va1xuICAgICAgICBpZiAob2JqLnR5cGUgPT09ICdjb3B5JyAmJiBvYmouZWxlbWVudC5kYXRhKCkuYXBwaG9vaykge1xuICAgICAgICAgICAgdGhpcy5zaG93RXJyb3IodGhpcy5vcHRpb25zLmxhbmcuYXBwaG9vayk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIganNUcmVlSWQgPSB0aGlzLl9nZXROb2RlSWQob2JqLmVsZW1lbnQuY2xvc2VzdCgnLmpzdHJlZS1ncmlkLWNlbGwnKSk7XG5cbiAgICAgICAgLy8gcmVzZXRzIGlmIHdlIGNsaWNrIGFnYWluXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSBvYmoudHlwZSAmJiBqc1RyZWVJZCA9PT0gdGhpcy5jbGlwYm9hcmQuaWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2xpcGJvYXJkLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQuaWQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gb2JqLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC50eXBlID0gb2JqLnR5cGU7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IGpzVHJlZUlkO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgdG8gcHJvY2VzcyB0aGUgcGFzdGUgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9wYXN0ZVxuICAgICAqIEBwYXJhbSB7JC5FdmVudH0gZXZlbnQgY2xpY2sgZXZlbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXN0ZTogZnVuY3Rpb24gX3Bhc3RlKGV2ZW50KSB7XG4gICAgICAgIC8vIGhpZGUgaGVscGVycyBhZnRlciB3ZSBwaWNrZWQgb25lXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuXG4gICAgICAgIHZhciBjb3B5RnJvbUlkID0gdGhpcy5fZ2V0Tm9kZUlkKHRoaXMuY2xpcGJvYXJkLm9yaWdpbik7XG4gICAgICAgIHZhciBjb3B5VG9JZCA9IHRoaXMuX2dldE5vZGVJZCgkKGV2ZW50LmN1cnJlbnRUYXJnZXQpKTtcblxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSA9PT0gJ2N1dCcpIHtcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoJ2N1dCcsIGNvcHlGcm9tSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgnY29weScsIGNvcHlGcm9tSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgncGFzdGUnLCBjb3B5VG9JZCwgJ2xhc3QnKTtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaWQgPSBudWxsO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC50eXBlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJldHJlaXZlcyBhIGxpc3Qgb2Ygbm9kZXMgZnJvbSBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0U3RvcmVkTm9kZUlkc1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge0FycmF5fSBsaXN0IG9mIGlkc1xuICAgICAqL1xuICAgIF9nZXRTdG9yZWROb2RlSWRzOiBmdW5jdGlvbiBfZ2V0U3RvcmVkTm9kZUlkcygpIHtcbiAgICAgICAgcmV0dXJuIENNUy5zZXR0aW5ncy5wYWdldHJlZSB8fCBbXTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU3RvcmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc3RvcmVOb2RlSWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZCB0byBiZSBzdG9yZWRcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBpZCB0aGF0IGhhcyBiZWVuIHN0b3JlZFxuICAgICAqL1xuICAgIF9zdG9yZU5vZGVJZDogZnVuY3Rpb24gX3N0b3JlTm9kZUlkKGlkKSB7XG4gICAgICAgIHZhciBudW1iZXIgPSBpZDtcbiAgICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLl9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgLy8gc3RvcmUgdmFsdWUgb25seSBpZiBpdCBpc24ndCB0aGVyZSB5ZXRcbiAgICAgICAgaWYgKHN0b3JhZ2UuaW5kZXhPZihudW1iZXIpID09PSAtMSkge1xuICAgICAgICAgICAgc3RvcmFnZS5wdXNoKG51bWJlcik7XG4gICAgICAgIH1cblxuICAgICAgICBDTVMuc2V0dGluZ3MucGFnZXRyZWUgPSBzdG9yYWdlO1xuICAgICAgICBIZWxwZXJzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG5cbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIG5vZGUgaW4gbG9jYWwgc3RvcmFnZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3JlbW92ZU5vZGVJZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIHRvIGJlIHN0b3JlZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGlkIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZFxuICAgICAqL1xuICAgIF9yZW1vdmVOb2RlSWQ6IGZ1bmN0aW9uIF9yZW1vdmVOb2RlSWQoaWQpIHtcbiAgICAgICAgdmFyIG51bWJlciA9IGlkO1xuICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuX2dldFN0b3JlZE5vZGVJZHMoKTtcbiAgICAgICAgdmFyIGluZGV4ID0gc3RvcmFnZS5pbmRleE9mKG51bWJlcik7XG5cbiAgICAgICAgLy8gcmVtb3ZlIGdpdmVuIGlkIGZyb20gc3RvcmFnZVxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBzdG9yYWdlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBDTVMuc2V0dGluZ3MucGFnZXRyZWUgPSBzdG9yYWdlO1xuICAgICAgICBIZWxwZXJzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG5cbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTW92ZXMgYSBub2RlIGFmdGVyIGRyYWcgJiBkcm9wLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfbW92ZU5vZGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29ial1cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai5pZF0gY3VycmVudCBlbGVtZW50IGlkIGZvciB1cmwgbWF0Y2hpbmdcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai50YXJnZXRdIHRhcmdldCBzaWJsaW5nIG9yIHBhcmVudFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLnBvc2l0aW9uXSBlaXRoZXIgYGxlZnRgLCBgcmlnaHRgIG9yIGBsYXN0LWNoaWxkYFxuICAgICAqIEByZXR1cm5zIHskLkRlZmVycmVkfSBhamF4IHJlcXVlc3Qgb2JqZWN0XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbW92ZU5vZGU6IGZ1bmN0aW9uIF9tb3ZlTm9kZShvYmopIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIG9iai5zaXRlID0gdGhhdC5vcHRpb25zLnNpdGU7XG5cbiAgICAgICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMubW92ZS5yZXBsYWNlKCd7aWR9Jywgb2JqLmlkKSxcbiAgICAgICAgICAgIGRhdGE6IG9ialxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuX3Nob3dTdWNjZXNzKG9iai5pZCk7XG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvcGllcyBhIG5vZGUgaW50byB0aGUgc2VsZWN0ZWQgbm9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2NvcHlOb2RlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBwYWdlIG9ialxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NvcHlOb2RlOiBmdW5jdGlvbiBfY29weU5vZGUob2JqKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIG5vZGUgPSB0aGF0Ll9nZXROb2RlUG9zaXRpb24ob2JqKTtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICBzaXRlOiB0aGlzLm9wdGlvbnMuc2l0ZSxcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVmZXIgdG8gdGhlIG9yaWdpbmFsIGl0ZW0gaGVyZSwgYXMgdGhlIGNvcGllZFxuICAgICAgICAgICAgLy8gbm9kZSB3aWxsIGhhdmUgbm8gZGF0YSBhdHRyaWJ1dGVzIHN0b3JlZCBhdCBpdCAobm90IGEgY2xvbmUpXG4gICAgICAgICAgICBpZDogb2JqLm9yaWdpbmFsLmRhdGEuaWQsXG4gICAgICAgICAgICBwb3NpdGlvbjogbm9kZS5wb3NpdGlvblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRhcmdldCBwcm92aWRlZCwgdGhlIG5vZGUgbGFuZHMgaW4gcm9vdFxuICAgICAgICBpZiAobm9kZS50YXJnZXQpIHtcbiAgICAgICAgICAgIGRhdGEudGFyZ2V0ID0gbm9kZS50YXJnZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhhdC5vcHRpb25zLnBlcm1pc3Npb24pIHtcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gbG9hZCBhIGRpYWxvZyBmaXJzdCwgdG8gY2hlY2sgaWYgcGVybWlzc2lvbnMgc2hvdWxkXG4gICAgICAgICAgICAvLyBiZSBjb3BpZWQgb3Igbm90XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMuY29weVBlcm1pc3Npb24ucmVwbGFjZSgne2lkfScsIGRhdGEuaWQpLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIC8vIHRoZSBkaWFsb2cgaXMgbG9hZGVkIHZpYSB0aGUgYWpheCByZXNwb25zIG9yaWdpbmF0aW5nIGZyb21cbiAgICAgICAgICAgIC8vIGB0ZW1wbGF0ZXMvYWRtaW4vY21zL3BhZ2UvdHJlZS9jb3B5X3ByZW1pc3Npb25zLmh0bWxgXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChkaWFsb2cpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRpYWxvZy5hcHBlbmQoZGlhbG9nKTtcbiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byB0aGUgcGVybWlzc2lvbiBkaWFsb2dcbiAgICAgICAgICAgIHRoaXMudWkuZGlhbG9nLm9mZih0aGlzLmNsaWNrLCAnLmNhbmNlbCcpLm9uKHRoaXMuY2xpY2ssICcuY2FuY2VsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGp1c3QgY29waWVkIG5vZGVcbiAgICAgICAgICAgICAgICB0aGF0LnVpLnRyZWUuanN0cmVlKCdkZWxldGVfbm9kZScsIG9iai5ub2RlLmlkKTtcbiAgICAgICAgICAgICAgICAkKCcuanMtY21zLWRpYWxvZycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1jbXMtZGlhbG9nLWRpbW1lcicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSkub2ZmKHRoaXMuY2xpY2ssICcuc3VibWl0Jykub24odGhpcy5jbGljaywgJy5zdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VibWl0QnV0dG9uID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBzdWJtaXRCdXR0b24uY2xvc2VzdCgnZm9ybScpLnNlcmlhbGl6ZSgpLnNwbGl0KCcmJyk7XG5cbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24ucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBmb3JtIGRhdGEgYW5kIGF0dGFjaCB0byBvYmpcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1EYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZm9ybURhdGFbaV0uc3BsaXQoJz0nKVswXV0gPSBmb3JtRGF0YVtpXS5zcGxpdCgnPScpWzFdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX3NhdmVDb3BpZWROb2RlKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9zYXZlQ29waWVkTm9kZShkYXRhKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZW5kcyB0aGUgcmVxdWVzdCB0byBjb3B5IGEgbm9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NhdmVDb3BpZWROb2RlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBub2RlIHBvc2l0aW9uIGluZm9ybWF0aW9uXG4gICAgICogQHJldHVybnMgeyQuRGVmZXJyZWR9XG4gICAgICovXG4gICAgX3NhdmVDb3BpZWROb2RlOiBmdW5jdGlvbiBfc2F2ZUNvcGllZE5vZGUoZGF0YSkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gc2VuZCB0aGUgcmVhbCBhamF4IHJlcXVlc3QgZm9yIGNvcHlpbmcgdGhlIHBsdWdpblxuICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgdXJsOiB0aGF0Lm9wdGlvbnMudXJscy5jb3B5LnJlcGxhY2UoJ3tpZH0nLCBkYXRhLmlkKSxcbiAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBlbGVtZW50IGZyb20gYW55IHN1YiBub2Rlcy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2dldEVsZW1lbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCBqUXVlcnkgbm9kZSBmb3JtIHdoZXJlIHRvIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGpzVHJlZSBub2RlIGVsZW1lbnQgaWRcbiAgICAgKi9cbiAgICBfZ2V0Tm9kZUlkOiBmdW5jdGlvbiBfZ2V0Tm9kZUlkKGVsKSB7XG4gICAgICAgIHZhciBjbHMgPSBlbC5jbG9zZXN0KCcuanN0cmVlLWdyaWQtY2VsbCcpLmF0dHIoJ2NsYXNzJyk7XG5cbiAgICAgICAgLy8gaWYgaXQncyBub3QgYSBjZWxsLCBhc3N1bWUgaXQncyB0aGUgcm9vdCBub2RlXG4gICAgICAgIHJldHVybiBjbHMgPyBjbHMucmVwbGFjZSgvLipqc2dyaWRfKC4rPylfY29sLiovLCAnJDEnKSA6ICcjJztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgbmV3IG5vZGUgcG9zaXRpb24gYWZ0ZXIgbW92aW5nLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0Tm9kZVBvc2l0aW9uXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIGpzdHJlZSBtb3ZlIG9iamVjdFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IGV2YWx1YXRlZCBvYmplY3Qgd2l0aCBwYXJhbXNcbiAgICAgKi9cbiAgICBfZ2V0Tm9kZVBvc2l0aW9uOiBmdW5jdGlvbiBfZ2V0Tm9kZVBvc2l0aW9uKG9iaikge1xuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMudWkudHJlZS5qc3RyZWUoJ2dldF9ub2RlJywgb2JqLm5vZGUucGFyZW50KTtcblxuICAgICAgICBkYXRhLnBvc2l0aW9uID0gb2JqLnBvc2l0aW9uO1xuXG4gICAgICAgIC8vIGpzdHJlZSBpbmRpY2F0ZXMgbm8gcGFyZW50IHdpdGggYCNgLCBpbiB0aGlzIGNhc2Ugd2UgZG8gbm90XG4gICAgICAgIC8vIG5lZWQgdG8gc2V0IHRoZSB0YXJnZXQgYXR0cmlidXRlIGF0IGFsbFxuICAgICAgICBpZiAob2JqLnBhcmVudCAhPT0gJyMnKSB7XG4gICAgICAgICAgICBkYXRhLnRhcmdldCA9IG5vZGUuZGF0YS5pZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWUgZnVuY3Rpb25zIGxpa2UgY29weSBjcmVhdGUgYSBuZXcgZWxlbWVudCB3aXRoIGEgbmV3IGlkLFxuICAgICAgICAvLyBpbiB0aGlzIGNhc2Ugd2UgbmVlZCB0byBzZXQgYGRhdGEuaWRgIG1hbnVhbGx5XG4gICAgICAgIGlmIChvYmoubm9kZSAmJiBvYmoubm9kZS5kYXRhKSB7XG4gICAgICAgICAgICBkYXRhLmlkID0gb2JqLm5vZGUuZGF0YS5pZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGdlbmVyYWwgdG9vbHRpcHMgdGhhdCBjYW4gaGF2ZSBhIGxpc3Qgb2YgbGlua3Mgb3IgY29udGVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwRHJvcGRvd25zXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBEcm9wZG93bnM6IGZ1bmN0aW9uIF9zZXR1cERyb3Bkb3ducygpIHtcbiAgICAgICAgdGhpcy5fZHJvcGRvd25zID0gbmV3IFBhZ2VUcmVlRHJvcGRvd25zKHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy51aS5jb250YWluZXJcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgcGFnZSB2aWV3IGNsaWNrLiBVc3VhbCB1c2UgY2FzZSBpcyB0aGF0IGFmdGVyIHlvdSBjbGlja1xuICAgICAqIG9uIHZpZXcgcGFnZSBpbiB0aGUgcGFnZXRyZWUgLSBzaWRlZnJhbWUgaXMgbm8gbG9uZ2VyIG5lZWRlZCxcbiAgICAgKiBzbyB3ZSBjbG9zZSBpdC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwUGFnZVZpZXdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFBhZ2VWaWV3OiBmdW5jdGlvbiBfc2V0dXBQYWdlVmlldygpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuICAgICAgICB2YXIgcGFyZW50ID0gd2luLnBhcmVudCA/IHdpbi5wYXJlbnQgOiB3aW47XG5cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtcGFnZXRyZWUtcGFnZS12aWV3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcGFyZW50LkNNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncygkLmV4dGVuZCh0cnVlLCB7fSwgQ01TLnNldHRpbmdzLCB7XG4gICAgICAgICAgICAgICAgc2lkZWZyYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc2V0dXBTdGlja3lIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFN0aWNreUhlYWRlcjogZnVuY3Rpb24gX3NldHVwU3RpY2t5SGVhZGVyKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC51aS50cmVlLm9uKCdyZWFkeS5qc3RyZWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LmhlYWRlciA9IG5ldyBQYWdlVHJlZVN0aWNreUhlYWRlcih7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiB0aGF0LnVpLmNvbnRhaW5lclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VycyB0aGUgbGlua3MgYGhyZWZgIGFzIGFqYXggcG9zdCByZXF1ZXN0LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0QWpheFBvc3RcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSB0cmlnZ2VyIGpRdWVyeSBsaW5rIHRhcmdldFxuICAgICAqL1xuICAgIF9zZXRBamF4UG9zdDogZnVuY3Rpb24gX3NldEFqYXhQb3N0KHRyaWdnZXIpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogJCh0aGlzKS5hdHRyKCdocmVmJylcbiAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2VsZiA9PT0gd2luZG93LnRvcCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzaW1wbHkgcmVsb2FkIHRoZSBwYWdlXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGluIHRoZSBzaWRlZnJhbWUgd2UgaGF2ZSB0byBhY3R1YWxseVxuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgcHVibGlzaGluZyBhIHBhZ2Ugd2UncmUgY3VycmVudGx5IGluXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgaWYgdGhlIHNsdWcgZGlkIGNoYW5nZSB3ZSB3b3VsZCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIHRoYXQgbmV3IHNsdWdcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJvYmxlbSBoZXJlIGlzIHRoYXQgaW4gY2FzZSBvZiB0aGUgYXBwaG9va2VkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1vZGVsIGFuZCBwayBhcmUgZW1wdHkgYW5kIHJlbG9hZEJyb3dzZXIgZG9lc24ndCByZWFsbHlcbiAgICAgICAgICAgICAgICAgICAgLy8gZG8gYW55dGhpbmcgLSBzbyBoZXJlIHdlIHNwZWNpZmljYWxseSBmb3JjZSB0aGUgZGF0YVxuICAgICAgICAgICAgICAgICAgICAvLyB0byBiZSB0aGUgZGF0YSBhYm91dCB0aGUgcGFnZSBhbmQgbm90IHRoZSBtb2RlbFxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gd2luZG93LnBhcmVudCA/IHdpbmRvdy5wYXJlbnQgOiB3aW5kb3c7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRklYTUUgc2hvdWxkbid0IGJlIGhhcmRjb2RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICdjbXMucGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwazogcGFyZW50LkNNUy5jb25maWcucmVxdWVzdC5wYWdlX2lkXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgSGVscGVycy5yZWxvYWRCcm93c2VyKCdSRUZSRVNIX1BBR0UnLCBmYWxzZSwgdHJ1ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0cyBldmVudHMgZm9yIHRoZSBzZWFyY2ggb24gdGhlIGhlYWRlci5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwU2VhcmNoXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBTZWFyY2g6IGZ1bmN0aW9uIF9zZXR1cFNlYXJjaCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgY2xpY2sgPSB0aGlzLmNsaWNrICsgJy5zZWFyY2gnO1xuXG4gICAgICAgIHZhciBmaWx0ZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZpbHRlclRyaWdnZXIgPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1maWx0ZXItdHJpZ2dlcicpO1xuICAgICAgICB2YXIgZmlsdGVyQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyLWNvbnRhaW5lcicpO1xuICAgICAgICB2YXIgZmlsdGVyQ2xvc2UgPSBmaWx0ZXJDb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoLWNsb3NlJyk7XG4gICAgICAgIHZhciBmaWx0ZXJDbGFzcyA9ICdjbXMtcGFnZXRyZWUtaGVhZGVyLWZpbHRlci1hY3RpdmUnO1xuICAgICAgICB2YXIgcGFnZVRyZWVIZWFkZXIgPSAkKCcuY21zLXBhZ2V0cmVlLWhlYWRlcicpO1xuXG4gICAgICAgIHZhciB2aXNpYmxlRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaCcpO1xuICAgICAgICB2YXIgaGlkZGVuRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaC1jb3B5IGZvcm0nKTtcblxuICAgICAgICB2YXIgc2VhcmNoQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyJyk7XG4gICAgICAgIHZhciBzZWFyY2hGaWVsZCA9IHNlYXJjaENvbnRhaW5lci5maW5kKCcjZmllbGQtc2VhcmNoYmFyJyk7XG4gICAgICAgIHZhciB0aW1lb3V0ID0gMjAwO1xuXG4gICAgICAgIC8vIGFkZCBhY3RpdmUgY2xhc3Mgd2hlbiBmb2N1c2luZyB0aGUgc2VhcmNoIGZpZWxkXG4gICAgICAgIHNlYXJjaEZpZWxkLm9uKCdmb2N1cycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIuYWRkQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VhcmNoRmllbGQub24oJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgaXMgcmVxdWlyZWQgdG8gcHJldmVudCB0aGUgc2VhcmNoIGZpZWxkIGZyb20ganVtcGluZ1xuICAgICAgICAgICAgLy8gYmV0d2VlbiBlbmxhcmdpbmcgYW5kIHNocmlua2luZ1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIucmVtb3ZlQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYoY2xpY2spO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzaG93cy9oaWRlcyBmaWx0ZXIgYm94XG4gICAgICAgIGZpbHRlclRyaWdnZXIuYWRkKGZpbHRlckNsb3NlKS5vbihjbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpZiAoZmlsdGVyQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyQ29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBwYWdlVHJlZUhlYWRlci5yZW1vdmVDbGFzcyhmaWx0ZXJDbGFzcyk7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYoY2xpY2spO1xuICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJDb250YWluZXIuc2hvdygpO1xuICAgICAgICAgICAgICAgIHBhZ2VUcmVlSGVhZGVyLmFkZENsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9uKGNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclRyaWdnZXIudHJpZ2dlcihjbGljayk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZmlsdGVyQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJldmVudCBjbG9zaW5nIHdoZW4gb24gZmlsdGVyIGNvbnRhaW5lclxuICAgICAgICBmaWx0ZXJDb250YWluZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZCBoaWRkZW4gZmllbGRzIHRvIHRoZSBmb3JtIHRvIG1haW50YWluIGZpbHRlciBwYXJhbXNcbiAgICAgICAgdmlzaWJsZUZvcm0uYXBwZW5kKGhpZGRlbkZvcm0uZmluZCgnaW5wdXRbdHlwZT1cImhpZGRlblwiXScpKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvd3MgcGFzdGUgaGVscGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2VuYWJsZVBhc3RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWxlY3Rvcj10aGlzLm9wdGlvbnMucGFzdGVTZWxlY3Rvcl0ganF1ZXJ5IHNlbGVjdG9yXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZW5hYmxlUGFzdGU6IGZ1bmN0aW9uIF9lbmFibGVQYXN0ZShzZWxlY3Rvcikge1xuICAgICAgICB2YXIgc2VsID0gdHlwZW9mIHNlbGVjdG9yID09PSAndW5kZWZpbmVkJyA/XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvciA6XG4gICAgICAgICAgICBzZWxlY3RvciArICcgJyArIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yO1xuICAgICAgICB2YXIgZHJvcGRvd25TZWwgPSAnLmpzLWNtcy1wYWdldHJlZS1hY3Rpb25zLWRyb3Bkb3duJztcblxuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgZHJvcGRvd25TZWwgPSBzZWxlY3RvciArICcgLmpzLWNtcy1wYWdldHJlZS1hY3Rpb25zLWRyb3Bkb3duJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhlbHBlcnMgYXJlIGdlbmVyYXRlZCBvbiB0aGUgZmx5LCBzbyB3ZSBuZWVkIHRvIHJlZmVyZW5jZVxuICAgICAgICAvLyB0aGVtIGV2ZXJ5IHNpbmdsZSB0aW1lXG4gICAgICAgICQoc2VsKS5yZW1vdmVDbGFzcygnY21zLXBhZ2V0cmVlLWRyb3Bkb3duLWl0ZW0tZGlzYWJsZWQnKTtcblxuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgZGF0YS5oYXNfY3V0ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGEuaGFzX2NvcHkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vdCBsb2FkZWQgYWN0aW9ucyBkcm9wZG93biBoYXZlIHRvIGJlIHVwZGF0ZWQgYXMgd2VsbFxuICAgICAgICAkKGRyb3Bkb3duU2VsKS5kYXRhKCdsYXp5VXJsRGF0YScsIGRhdGEpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaWRlcyBwYXN0ZSBoZWxwZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZGlzYWJsZVBhc3RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWxlY3Rvcj10aGlzLm9wdGlvbnMucGFzdGVTZWxlY3Rvcl0ganF1ZXJ5IHNlbGVjdG9yXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZGlzYWJsZVBhc3RlOiBmdW5jdGlvbiBfZGlzYWJsZVBhc3RlKHNlbGVjdG9yKSB7XG4gICAgICAgIHZhciBzZWwgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICd1bmRlZmluZWQnID9cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yIDpcbiAgICAgICAgICAgIHNlbGVjdG9yICsgJyAnICsgdGhpcy5vcHRpb25zLnBhc3RlU2VsZWN0b3I7XG4gICAgICAgIHZhciBkcm9wZG93blNlbCA9ICcuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBkcm9wZG93blNlbCA9IHNlbGVjdG9yICsgJyAuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyBoZWxwZXJzIGFyZSBnZW5lcmF0ZWQgb24gdGhlIGZseSwgc28gd2UgbmVlZCB0byByZWZlcmVuY2VcbiAgICAgICAgLy8gdGhlbSBldmVyeSBzaW5nbGUgdGltZVxuICAgICAgICAkKHNlbCkuYWRkQ2xhc3MoJ2Ntcy1wYWdldHJlZS1kcm9wZG93bi1pdGVtLWRpc2FibGVkJyk7XG5cbiAgICAgICAgLy8gbm90IGxvYWRlZCBhY3Rpb25zIGRyb3Bkb3duIGhhdmUgdG8gYmUgdXBkYXRlZCBhcyB3ZWxsXG4gICAgICAgICQoZHJvcGRvd25TZWwpLnJlbW92ZURhdGEoJ2xhenlVcmxEYXRhJyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGhlbHBlcnMgYWZ0ZXIgYGFmdGVyX29wZW4uanN0cmVlYFxuICAgICAqIG9yIGBfY3V0T3JDb3B5YCBpcyB0cmlnZ2VyZWQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF91cGRhdGVQYXN0ZUhlbHBlcnNTdGF0ZVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3VwZGF0ZVBhc3RlSGVscGVyc1N0YXRlOiBmdW5jdGlvbiBfdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSAmJiB0aGlzLmNsaXBib2FyZC5pZCkge1xuICAgICAgICAgICAgdGhpcy5fZW5hYmxlUGFzdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhpZGUgY3V0IGVsZW1lbnQgYW5kIGl0J3MgZGVzY2VuZGFudHMnIHBhc3RlIGhlbHBlcnMgaWYgaXQgaXMgdmlzaWJsZVxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSA9PT0gJ2N1dCcgJiYgdGhpcy5jbGlwYm9hcmQub3JpZ2luKSB7XG4gICAgICAgICAgICB2YXIgZGVzY2VuZGFudElkcyA9IHRoaXMuX2dldERlc2NlbmRhbnRzSWRzKHRoaXMuY2xpcGJvYXJkLmlkKTtcbiAgICAgICAgICAgIHZhciBub2RlcyA9IFt0aGlzLmNsaXBib2FyZC5pZF07XG5cbiAgICAgICAgICAgIGlmIChkZXNjZW5kYW50SWRzICYmIGRlc2NlbmRhbnRJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbm9kZXMgPSBub2Rlcy5jb25jYXQoZGVzY2VuZGFudElkcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fZGlzYWJsZVBhc3RlKCcuanNncmlkXycgKyBpZCArICdfY29sJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93cyBzdWNjZXNzIG1lc3NhZ2Ugb24gbm9kZSBhZnRlciBzdWNjZXNzZnVsIGFjdGlvbi5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3Nob3dTdWNjZXNzXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIGlkIG9mIHRoZSBlbGVtZW50IHRvIGFkZCB0aGUgc3VjY2VzcyBjbGFzc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3Nob3dTdWNjZXNzOiBmdW5jdGlvbiBfc2hvd1N1Y2Nlc3MoaWQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnVpLnRyZWUuZmluZCgnbGlbZGF0YS1pZD1cIicgKyBpZCArICdcIl0nKTtcblxuICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgfSwgdGhpcy5zdWNjZXNzVGltZXIpO1xuICAgICAgICAvLyBoaWRlIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB3ZSBzaG91bGQgcmVsb2FkIHRoZSBpZnJhbWUgb3IgZW50aXJlIHdpbmRvdy4gRm9yIHRoaXMgd2VcbiAgICAgKiBuZWVkIHRvIHNraXAgYENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7YC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3JlbG9hZEhlbHBlclxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlbG9hZEhlbHBlcjogZnVuY3Rpb24gX3JlbG9hZEhlbHBlcigpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5zZWxmID09PSB3aW5kb3cudG9wKSB7XG4gICAgICAgICAgICBIZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5cyBhbiBlcnJvciB3aXRoaW4gdGhlIGRqYW5nbyBVSS5cbiAgICAgKlxuICAgICAqIEBtZXRob2Qgc2hvd0Vycm9yXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2Ugc3RyaW5nIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAqL1xuICAgIHNob3dFcnJvcjogZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2VzID0gJCgnLm1lc3NhZ2VsaXN0Jyk7XG4gICAgICAgIHZhciBicmVhZGNydW1iID0gJCgnLmJyZWFkY3J1bWJzJyk7XG4gICAgICAgIHZhciByZWxvYWQgPSB0aGlzLm9wdGlvbnMubGFuZy5yZWxvYWQ7XG4gICAgICAgIHZhciB0cGwgPSAnJyArXG4gICAgICAgICAgICAnPHVsIGNsYXNzPVwibWVzc2FnZWxpc3RcIj4nICtcbiAgICAgICAgICAgICcgICA8bGkgY2xhc3M9XCJlcnJvclwiPicgK1xuICAgICAgICAgICAgJyAgICAgICB7bXNnfSAnICtcbiAgICAgICAgICAgICcgICAgICAgPGEgaHJlZj1cIiNyZWxvYWRcIiBjbGFzcz1cImNtcy10cmVlLXJlbG9hZFwiPiAnICsgcmVsb2FkICsgJyA8L2E+JyArXG4gICAgICAgICAgICAnICAgPC9saT4nICtcbiAgICAgICAgICAgICc8L3VsPic7XG4gICAgICAgIHZhciBtc2cgPSB0cGwucmVwbGFjZSgne21zZ30nLCAnPHN0cm9uZz4nICsgdGhpcy5vcHRpb25zLmxhbmcuZXJyb3IgKyAnPC9zdHJvbmc+ICcgKyBtZXNzYWdlKTtcblxuICAgICAgICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBtZXNzYWdlcy5yZXBsYWNlV2l0aChtc2cpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnJlYWRjcnVtYi5hZnRlcihtc2cpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2dldERlc2NlbmRhbnRzSWRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkIGpzdHJlZSBpZCBvZiB0aGUgbm9kZSwgZS5nLiBqMV8zXG4gICAgICogQHJldHVybnMge1N0cmluZ1tdfSBhcnJheSBvZiBpZHNcbiAgICAgKi9cbiAgICBfZ2V0RGVzY2VuZGFudHNJZHM6IGZ1bmN0aW9uIF9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudWkudHJlZS5qc3RyZWUodHJ1ZSkuZ2V0X25vZGUobm9kZUlkKS5jaGlsZHJlbl9kO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9oYXNQZXJtaXNpb25cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlIGpzdHJlZSBub2RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBlcm1pc3Npb24gbW92ZSAvIGFkZFxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAqL1xuICAgIF9oYXNQZXJtaXNzaW9uOiBmdW5jdGlvbiBfaGFzUGVybWlzaW9uKG5vZGUsIHBlcm1pc3Npb24pIHtcbiAgICAgICAgaWYgKG5vZGUuaWQgPT09ICcjJyAmJiBwZXJtaXNzaW9uID09PSAnYWRkJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5oYXNBZGRSb290UGVybWlzc2lvbjtcbiAgICAgICAgfSBlbHNlIGlmIChub2RlLmlkID09PSAnIycpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub2RlLmxpX2F0dHJbJ2RhdGEtJyArIHBlcm1pc3Npb24gKyAnLXBlcm1pc3Npb24nXSA9PT0gJ3RydWUnO1xuICAgIH1cbn0pO1xuXG4vLyBzaG9ydGhhbmQgZm9yIGpRdWVyeShkb2N1bWVudCkucmVhZHkoKTtcbiQoZnVuY3Rpb24gKCkge1xuICAgIC8vIGxvYWQgY21zIHNldHRpbmdzIGJlZm9yZWhhbmRcbiAgICAvLyBoYXZlIHRvIHNldCB0b29sYmFyIHRvIFwiZXhwYW5kZWRcIiBieSBkZWZhdWx0XG4gICAgLy8gb3RoZXJ3aXNlIGluaXRpYWxpemF0aW9uIHdpbGwgYmUgaW5jb3JyZWN0IHdoZW4geW91XG4gICAgLy8gZ28gZmlyc3QgdG8gcGFnZXMgYW5kIHRoZW4gdG8gbm9ybWFsIHBhZ2VcbiAgICB3aW5kb3cuQ01TLmNvbmZpZyA9IHtcbiAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHRvb2xiYXI6ICdleHBhbmRlZCdcbiAgICAgICAgfSxcbiAgICAgICAgdXJsczoge1xuICAgICAgICAgICAgc2V0dGluZ3M6ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdzZXR0aW5ncy11cmwnKVxuICAgICAgICB9XG4gICAgfTtcbiAgICB3aW5kb3cuQ01TLnNldHRpbmdzID0gSGVscGVycy5nZXRTZXR0aW5ncygpO1xuICAgIC8vIGF1dG9sb2FkIHRoZSBwYWdldHJlZVxuICAgIG5ldyBQYWdlVHJlZSgpO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFnZVRyZWU7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gY21zL3N0YXRpYy9jbXMvanMvbW9kdWxlcy9jbXMucGFnZXRyZWUuanMiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");
>>>>>>> 88e39eb... lodash, refactoring

/***/ }),

/***/ 108:
/***/ (function(module, exports, __webpack_require__) {

<<<<<<< HEAD
eval("// polyfills\n__webpack_require__(18);\n__webpack_require__(19);\n\nvar CMS = __webpack_require__(1).default;\n\nwindow.CMS = CMS;\n\nCMS.PageTree = __webpack_require__(99).default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL2FkbWluLnBhZ2V0cmVlLmpzPzhiMWQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcG9seWZpbGxzXG5yZXF1aXJlKCcuL3BvbHlmaWxscy9mdW5jdGlvbi5wcm90b3R5cGUuYmluZC5qcycpO1xucmVxdWlyZSgnLi9saWJzL3BlcCcpO1xuXG52YXIgQ01TID0gcmVxdWlyZSgnLi9tb2R1bGVzL2Ntcy5iYXNlJykuZGVmYXVsdDtcblxud2luZG93LkNNUyA9IENNUztcblxuQ01TLlBhZ2VUcmVlID0gcmVxdWlyZSgnLi9tb2R1bGVzL2Ntcy5wYWdldHJlZScpLmRlZmF1bHQ7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gY21zL3N0YXRpYy9jbXMvanMvYWRtaW4ucGFnZXRyZWUuanMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ 109:
/***/ (function(module, exports, __webpack_require__) {

eval("var $ = __webpack_require__(0);\nvar Class = __webpack_require__(4);\n\n/**\n                                 * Dropdowns in the pagetree.\n                                 * Have to be delegated, since pagetree nodes can be\n                                 * lazy loaded.\n                                 *\n                                 * @class PageTreeDropdowns\n                                 * @namespace CMS\n                                 */\nvar PageTreeDropdowns = new Class({\n    options: {\n        dropdownSelector: '.js-cms-pagetree-dropdown',\n        triggerSelector: '.js-cms-pagetree-dropdown-trigger',\n        menuSelector: '.js-cms-pagetree-dropdown-menu',\n        openCls: 'cms-pagetree-dropdown-menu-open' },\n\n\n    initialize: function initialize(options) {\n        this.options = $.extend(true, {}, this.options, options);\n        this.click = 'click.cms.pagetree.dropdown';\n\n        this._setupUI();\n        this._events();\n    },\n\n    /**\n        * @method _setupUI\n        * @private\n        */\n    _setupUI: function _setupUI() {\n        this.ui = {\n            container: this.options.container,\n            document: $(document) };\n\n    },\n\n    /**\n        * Event handlers.\n        *\n        * @method _events\n        * @private\n        */\n    _events: function _events() {\n        var that = this;\n\n        // attach event to the trigger\n        this.ui.container.on(this.click, this.options.triggerSelector, function (e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n\n            that._toggleDropdown(this);\n        });\n\n        // stop propagation on the element\n        this.ui.container.on(this.click, that.options.menuSelector, function (e) {\n            e.stopImmediatePropagation();\n        });\n\n        this.ui.container.on(this.click, that.options.menuSelector + ' a', function () {\n            that.closeAllDropdowns();\n        });\n\n        this.ui.document.on(this.click, function () {\n            that.closeAllDropdowns();\n        });\n    },\n\n    /**\n        * @method _toggleDropdown\n        * @param {jQuery} trigger trigger clicked\n        * @private\n        * @returns {Boolean|void}\n        */\n    _toggleDropdown: function _toggleDropdown(trigger) {\n        var dropdowns = $(this.options.dropdownSelector);\n        var dropdown = $(trigger).closest(this.options.dropdownSelector);\n\n        // cancel if opened tooltip is triggered again\n        if (dropdown.hasClass(this.options.openCls)) {\n            dropdowns.removeClass(this.options.openCls);\n            return false;\n        }\n\n        // otherwise show the dropdown\n        dropdowns.removeClass(this.options.openCls);\n        dropdown.addClass(this.options.openCls);\n\n        this._loadContent(dropdown);\n    },\n\n    /**\n        * @method _loadContent\n        * @private\n        * @param {jQuery} dropdown\n        * @returns {Boolean|$.Deferred} false if not lazy or already loaded or promise\n        */\n    _loadContent: function _loadContent(dropdown) {\n        var data = dropdown.data();\n        var LOADER_SHOW_TIMEOUT = 200;\n\n        if (!data.lazyUrl || data.loaded) {\n            return false;\n        }\n\n        var loaderTimeout = setTimeout(function () {\n            dropdown.find('.js-cms-pagetree-dropdown-loader').addClass('cms-loader');\n        }, LOADER_SHOW_TIMEOUT);\n\n        $.ajax({\n            url: data.lazyUrl,\n            data: data.lazyUrlData }).\n        done(function (response) {\n            dropdown.find('.js-cms-pagetree-dropdown-menu').html(response);\n            dropdown.data('loaded', true);\n            clearTimeout(loaderTimeout);\n        });\n    },\n\n    /**\n        * @method closeAllDropdowns\n        * @public\n        */\n    closeAllDropdowns: function closeAllDropdowns() {\n        $(this.options.dropdownSelector).removeClass(this.options.openCls);\n    } });\n\n\nmodule.exports = PageTreeDropdowns;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLmRyb3Bkb3duLmpzPzI1ODAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICQgPSByZXF1aXJlKCdqcXVlcnknKTtcbnZhciBDbGFzcyA9IHJlcXVpcmUoJ2NsYXNzanMnKTtcblxuLyoqXG4gKiBEcm9wZG93bnMgaW4gdGhlIHBhZ2V0cmVlLlxuICogSGF2ZSB0byBiZSBkZWxlZ2F0ZWQsIHNpbmNlIHBhZ2V0cmVlIG5vZGVzIGNhbiBiZVxuICogbGF6eSBsb2FkZWQuXG4gKlxuICogQGNsYXNzIFBhZ2VUcmVlRHJvcGRvd25zXG4gKiBAbmFtZXNwYWNlIENNU1xuICovXG52YXIgUGFnZVRyZWVEcm9wZG93bnMgPSBuZXcgQ2xhc3Moe1xuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgZHJvcGRvd25TZWxlY3RvcjogJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24nLFxuICAgICAgICB0cmlnZ2VyU2VsZWN0b3I6ICcuanMtY21zLXBhZ2V0cmVlLWRyb3Bkb3duLXRyaWdnZXInLFxuICAgICAgICBtZW51U2VsZWN0b3I6ICcuanMtY21zLXBhZ2V0cmVlLWRyb3Bkb3duLW1lbnUnLFxuICAgICAgICBvcGVuQ2xzOiAnY21zLXBhZ2V0cmVlLWRyb3Bkb3duLW1lbnUtb3BlbidcbiAgICB9LFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmNsaWNrID0gJ2NsaWNrLmNtcy5wYWdldHJlZS5kcm9wZG93bic7XG5cbiAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICB0aGlzLl9ldmVudHMoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICB0aGlzLnVpID0ge1xuICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLm9wdGlvbnMuY29udGFpbmVyLFxuICAgICAgICAgICAgZG9jdW1lbnQ6ICQoZG9jdW1lbnQpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEV2ZW50IGhhbmRsZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gYXR0YWNoIGV2ZW50IHRvIHRoZSB0cmlnZ2VyXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRoaXMub3B0aW9ucy50cmlnZ2VyU2VsZWN0b3IsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICB0aGF0Ll90b2dnbGVEcm9wZG93bih0aGlzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc3RvcCBwcm9wYWdhdGlvbiBvbiB0aGUgZWxlbWVudFxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGF0Lm9wdGlvbnMubWVudVNlbGVjdG9yLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgdGhhdC5vcHRpb25zLm1lbnVTZWxlY3RvciArICcgYScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuY2xvc2VBbGxEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5kb2N1bWVudC5vbih0aGlzLmNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LmNsb3NlQWxsRHJvcGRvd25zKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF90b2dnbGVEcm9wZG93blxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSB0cmlnZ2VyIHRyaWdnZXIgY2xpY2tlZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge0Jvb2xlYW58dm9pZH1cbiAgICAgKi9cbiAgICBfdG9nZ2xlRHJvcGRvd246IGZ1bmN0aW9uIF90b2dnbGVEcm9wZG93bih0cmlnZ2VyKSB7XG4gICAgICAgIHZhciBkcm9wZG93bnMgPSAkKHRoaXMub3B0aW9ucy5kcm9wZG93blNlbGVjdG9yKTtcbiAgICAgICAgdmFyIGRyb3Bkb3duID0gJCh0cmlnZ2VyKS5jbG9zZXN0KHRoaXMub3B0aW9ucy5kcm9wZG93blNlbGVjdG9yKTtcblxuICAgICAgICAvLyBjYW5jZWwgaWYgb3BlbmVkIHRvb2x0aXAgaXMgdHJpZ2dlcmVkIGFnYWluXG4gICAgICAgIGlmIChkcm9wZG93bi5oYXNDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscykpIHtcbiAgICAgICAgICAgIGRyb3Bkb3ducy5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBvdGhlcndpc2Ugc2hvdyB0aGUgZHJvcGRvd25cbiAgICAgICAgZHJvcGRvd25zLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5vcGVuQ2xzKTtcbiAgICAgICAgZHJvcGRvd24uYWRkQ2xhc3ModGhpcy5vcHRpb25zLm9wZW5DbHMpO1xuXG4gICAgICAgIHRoaXMuX2xvYWRDb250ZW50KGRyb3Bkb3duKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfbG9hZENvbnRlbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBkcm9wZG93blxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufCQuRGVmZXJyZWR9IGZhbHNlIGlmIG5vdCBsYXp5IG9yIGFscmVhZHkgbG9hZGVkIG9yIHByb21pc2VcbiAgICAgKi9cbiAgICBfbG9hZENvbnRlbnQ6IGZ1bmN0aW9uIF9sb2FkQ29udGVudChkcm9wZG93bikge1xuICAgICAgICB2YXIgZGF0YSA9IGRyb3Bkb3duLmRhdGEoKTtcbiAgICAgICAgdmFyIExPQURFUl9TSE9XX1RJTUVPVVQgPSAyMDA7XG5cbiAgICAgICAgaWYgKCFkYXRhLmxhenlVcmwgfHwgZGF0YS5sb2FkZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsb2FkZXJUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWRyb3Bkb3duLWxvYWRlcicpLmFkZENsYXNzKCdjbXMtbG9hZGVyJyk7XG4gICAgICAgIH0sIExPQURFUl9TSE9XX1RJTUVPVVQpO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IGRhdGEubGF6eVVybCxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEubGF6eVVybERhdGFcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGRyb3Bkb3duLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tbWVudScpLmh0bWwocmVzcG9uc2UpO1xuICAgICAgICAgICAgZHJvcGRvd24uZGF0YSgnbG9hZGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobG9hZGVyVGltZW91dCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNsb3NlQWxsRHJvcGRvd25zXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIGNsb3NlQWxsRHJvcGRvd25zOiBmdW5jdGlvbiBjbG9zZUFsbERyb3Bkb3ducygpIHtcbiAgICAgICAgJCh0aGlzLm9wdGlvbnMuZHJvcGRvd25TZWxlY3RvcikucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLm9wZW5DbHMpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhZ2VUcmVlRHJvcGRvd25zO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGNtcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLmRyb3Bkb3duLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ 110:
/***/ (function(module, exports, __webpack_require__) {

eval("/*\n * Copyright https://github.com/divio/django-cms\n */\n\nvar $ = __webpack_require__(0);\nvar Class = __webpack_require__(4);\nvar Helpers = __webpack_require__(1).default.API.Helpers;\n\n/**\n                                                          * Sticky language headers in pagetree\n                                                          *\n                                                          * @class PageTreeStickyHeader\n                                                          * @namespace CMS\n                                                          */\nvar PageTreeStickyHeader = new Class({\n    initialize: function initialize(options) {\n        var that = this;\n\n        that.options = $.extend(true, {}, that.options, options);\n        that.resize = 'resize.cms.pagetree.header';\n        that.scroll = 'scroll.cms.pagetree.header';\n        that.areClonesInDOM = false;\n\n        that._setupUI();\n        that._saveSizes();\n        that._events();\n    },\n\n    /**\n        * @method _setupUI\n        * @private\n        */\n    _setupUI: function _setupUI() {\n        var container = this.options.container;\n        var headers = container.find('.jstree-grid-header');\n\n        this.ui = {\n            container: container,\n            window: $(window),\n            headers: headers,\n            columns: container.find('.jstree-grid-column').toArray().map(function (el) {\n                return $(el);\n            }),\n            clones: headers.clone().toArray().map(function (el) {\n                return $(el);\n            }) };\n\n\n    },\n\n    /**\n        * Determines positions/sizes of elements\n        *\n        * @method _saveSizes\n        * @private\n        */\n    _saveSizes: function _saveSizes() {\n        this.headersTopOffset = this.ui.headers.offset().top;\n        this.toolbarHeight = 0;\n        if (this._isInSideframe()) {\n            this.toolbarHeight = CMS.API.Helpers._getWindow().parent.CMS.$('.cms-toolbar').height();\n            var debug = Helpers._getWindow().parent.CMS.$('.cms-debug-bar');\n\n            if (debug.length) {\n                this.toolbarHeight += debug.outerHeight();\n            }\n        } else {\n            this.toolbarHeight = $('#branding').height();\n        }\n    },\n\n    /**\n        * @method _isInSideframe\n        * @returns {Boolean} are we in sideframe?\n        * @private\n        */\n    _isInSideframe: function _isInSideframe() {\n        var win = Helpers._getWindow();\n\n        if (win && win.parent && win.parent !== win) {\n            return true;\n        }\n\n        return false;\n    },\n\n    /**\n        * Event handlers.\n        *\n        * @method _events\n        * @private\n        */\n    _events: function _events() {\n        this.ui.window.on(\n        [this.resize, this.scroll].join(' '),\n        this._handleResizeOrScroll.bind(this));\n\n    },\n\n    /**\n        * @method _handleResizeOrScroll\n        * @private\n        */\n    _handleResizeOrScroll: function _handleResizeOrScroll() {\n        var that = this;\n        var scrollTop = that.ui.window.scrollTop();\n        var scrollLeft = that.ui.window.scrollLeft();\n\n        if (that._shouldStick(scrollTop)) {\n            that._stickHeader(scrollTop, scrollLeft);\n        } else {\n            that._unstickHeader();\n        }\n    },\n\n    /**\n        * @method _shouldStick\n        * @param {Number} scrollTop position in pixels\n        * @returns {Boolean} should headers stick\n        * @private\n        */\n    _shouldStick: function _shouldStick(scrollTop) {\n        return scrollTop + this.toolbarHeight >= this.headersTopOffset;\n    },\n\n    /**\n        * @method _stickHeader\n        * @param {Number} scrollTop top\n        * @param {Number} scrollLeft left\n        * @private\n        */\n    _stickHeader: function _stickHeader(scrollTop, scrollLeft) {\n        var that = this;\n\n        that._insertClones();\n\n        that.ui.headers.each(function (index) {\n            var el = $(this);\n\n            var width = that.ui.clones[index].css('width');\n            var offset = that.ui.clones[index].offset().left;\n\n            el.css({\n                width: width,\n                left: offset - scrollLeft });\n\n        });\n\n        that.ui.headers.addClass('jstree-grid-header-fixed').css({\n            top: that.toolbarHeight });\n\n    },\n\n    /**\n        * @method _unstickHeader\n        * @private\n        */\n    _unstickHeader: function _unstickHeader() {\n        var that = this;\n\n        that._detachClones();\n\n        that.ui.headers.removeClass('jstree-grid-header-fixed').css({\n            top: 0,\n            width: 'auto',\n            left: 'auto' });\n\n    },\n\n    /**\n        * Inserts clones of headers so when header becomes sticky the\n        * pagetree doesn't jump. Only does it once and sets the flag.\n        *\n        * @method _insertClones\n        * @private\n        */\n    _insertClones: function _insertClones() {\n        var that = this;\n\n        if (!that.areClonesInDOM) {\n            that.ui.columns.forEach(function (el, index) {\n                el.prepend(that.ui.clones[index]);\n            });\n            that.areClonesInDOM = true;\n        }\n\n    },\n\n    /**\n        * Detaches the clones of headers so then headers \"unsticks\"\n        * the pagetree doesn't jump. Relies on the flag.\n        *\n        * @method _detachClones\n        * @private\n        */\n    _detachClones: function _detachClones() {\n        var that = this;\n\n        if (that.areClonesInDOM) {\n            that.ui.clones.forEach(function (el) {\n                el.detach();\n            });\n            that.areClonesInDOM = false;\n        }\n    } });\n\n\n\nmodule.exports = PageTreeStickyHeader;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEwLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLnN0aWNreWhlYWRlci5qcz85YTI3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG52YXIgJCA9IHJlcXVpcmUoJ2pxdWVyeScpO1xudmFyIENsYXNzID0gcmVxdWlyZSgnY2xhc3NqcycpO1xudmFyIEhlbHBlcnMgPSByZXF1aXJlKCcuL2Ntcy5iYXNlJykuZGVmYXVsdC5BUEkuSGVscGVycztcblxuLyoqXG4gKiBTdGlja3kgbGFuZ3VhZ2UgaGVhZGVycyBpbiBwYWdldHJlZVxuICpcbiAqIEBjbGFzcyBQYWdlVHJlZVN0aWNreUhlYWRlclxuICogQG5hbWVzcGFjZSBDTVNcbiAqL1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gbmV3IENsYXNzKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGF0Lm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB0aGF0LnJlc2l6ZSA9ICdyZXNpemUuY21zLnBhZ2V0cmVlLmhlYWRlcic7XG4gICAgICAgIHRoYXQuc2Nyb2xsID0gJ3Njcm9sbC5jbXMucGFnZXRyZWUuaGVhZGVyJztcbiAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IGZhbHNlO1xuXG4gICAgICAgIHRoYXQuX3NldHVwVUkoKTtcbiAgICAgICAgdGhhdC5fc2F2ZVNpemVzKCk7XG4gICAgICAgIHRoYXQuX2V2ZW50cygpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGNvbnRhaW5lci5maW5kKCcuanN0cmVlLWdyaWQtaGVhZGVyJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgd2luZG93OiAkKHdpbmRvdyksXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgY29sdW1uczogY29udGFpbmVyLmZpbmQoJy5qc3RyZWUtZ3JpZC1jb2x1bW4nKS50b0FycmF5KCkubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKGVsKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2xvbmVzOiBoZWFkZXJzLmNsb25lKCkudG9BcnJheSgpLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJChlbCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgcG9zaXRpb25zL3NpemVzIG9mIGVsZW1lbnRzXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zYXZlU2l6ZXNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zYXZlU2l6ZXM6IGZ1bmN0aW9uIF9zYXZlU2l6ZXMoKSB7XG4gICAgICAgIHRoaXMuaGVhZGVyc1RvcE9mZnNldCA9IHRoaXMudWkuaGVhZGVycy5vZmZzZXQoKS50b3A7XG4gICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IDA7XG4gICAgICAgIGlmICh0aGlzLl9pc0luU2lkZWZyYW1lKCkpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IENNUy5BUEkuSGVscGVycy5fZ2V0V2luZG93KCkucGFyZW50LkNNUy4kKCcuY21zLXRvb2xiYXInKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIHZhciBkZWJ1ZyA9IEhlbHBlcnMuX2dldFdpbmRvdygpLnBhcmVudC5DTVMuJCgnLmNtcy1kZWJ1Zy1iYXInKTtcblxuICAgICAgICAgICAgaWYgKGRlYnVnLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCArPSBkZWJ1Zy5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b29sYmFySGVpZ2h0ID0gJCgnI2JyYW5kaW5nJykuaGVpZ2h0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfaXNJblNpZGVmcmFtZVxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBhcmUgd2UgaW4gc2lkZWZyYW1lP1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2lzSW5TaWRlZnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuXG4gICAgICAgIGlmICh3aW4gJiYgd2luLnBhcmVudCAmJiB3aW4ucGFyZW50ICE9PSB3aW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFdmVudCBoYW5kbGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgdGhpcy51aS53aW5kb3cub24oXG4gICAgICAgICAgICBbdGhpcy5yZXNpemUsIHRoaXMuc2Nyb2xsXS5qb2luKCcgJyksXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVSZXNpemVPclNjcm9sbC5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2hhbmRsZVJlc2l6ZU9yU2Nyb2xsXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaGFuZGxlUmVzaXplT3JTY3JvbGw6IGZ1bmN0aW9uIF9oYW5kbGVSZXNpemVPclNjcm9sbCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2Nyb2xsVG9wID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsVG9wKCk7XG4gICAgICAgIHZhciBzY3JvbGxMZWZ0ID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsTGVmdCgpO1xuXG4gICAgICAgIGlmICh0aGF0Ll9zaG91bGRTdGljayhzY3JvbGxUb3ApKSB7XG4gICAgICAgICAgICB0aGF0Ll9zdGlja0hlYWRlcihzY3JvbGxUb3AsIHNjcm9sbExlZnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhhdC5fdW5zdGlja0hlYWRlcigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Nob3VsZFN0aWNrXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcCBwb3NpdGlvbiBpbiBwaXhlbHNcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gc2hvdWxkIGhlYWRlcnMgc3RpY2tcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zaG91bGRTdGljazogZnVuY3Rpb24gKHNjcm9sbFRvcCkge1xuICAgICAgICByZXR1cm4gc2Nyb2xsVG9wICsgdGhpcy50b29sYmFySGVpZ2h0ID49IHRoaXMuaGVhZGVyc1RvcE9mZnNldDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc3RpY2tIZWFkZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2Nyb2xsVG9wIHRvcFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzY3JvbGxMZWZ0IGxlZnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zdGlja0hlYWRlcjogZnVuY3Rpb24gX3N0aWNrSGVhZGVyKHNjcm9sbFRvcCwgc2Nyb2xsTGVmdCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC5faW5zZXJ0Q2xvbmVzKCk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB0aGF0LnVpLmNsb25lc1tpbmRleF0uY3NzKCd3aWR0aCcpO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoYXQudWkuY2xvbmVzW2luZGV4XS5vZmZzZXQoKS5sZWZ0O1xuXG4gICAgICAgICAgICBlbC5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBvZmZzZXQgLSBzY3JvbGxMZWZ0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmFkZENsYXNzKCdqc3RyZWUtZ3JpZC1oZWFkZXItZml4ZWQnKS5jc3Moe1xuICAgICAgICAgICAgdG9wOiB0aGF0LnRvb2xiYXJIZWlnaHRcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Vuc3RpY2tIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91bnN0aWNrSGVhZGVyOiBmdW5jdGlvbiBfdW5zdGlja0hlYWRlcigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQuX2RldGFjaENsb25lcygpO1xuXG4gICAgICAgIHRoYXQudWkuaGVhZGVycy5yZW1vdmVDbGFzcygnanN0cmVlLWdyaWQtaGVhZGVyLWZpeGVkJykuY3NzKHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICBsZWZ0OiAnYXV0bydcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluc2VydHMgY2xvbmVzIG9mIGhlYWRlcnMgc28gd2hlbiBoZWFkZXIgYmVjb21lcyBzdGlja3kgdGhlXG4gICAgICogcGFnZXRyZWUgZG9lc24ndCBqdW1wLiBPbmx5IGRvZXMgaXQgb25jZSBhbmQgc2V0cyB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2luc2VydENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luc2VydENsb25lczogZnVuY3Rpb24gX2luc2VydENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhhdC5hcmVDbG9uZXNJbkRPTSkge1xuICAgICAgICAgICAgdGhhdC51aS5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGVsLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIGVsLnByZXBlbmQodGhhdC51aS5jbG9uZXNbaW5kZXhdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXRhY2hlcyB0aGUgY2xvbmVzIG9mIGhlYWRlcnMgc28gdGhlbiBoZWFkZXJzIFwidW5zdGlja3NcIlxuICAgICAqIHRoZSBwYWdldHJlZSBkb2Vzbid0IGp1bXAuIFJlbGllcyBvbiB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2RldGFjaENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2RldGFjaENsb25lczogZnVuY3Rpb24gX2RldGFjaENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0aGF0LmFyZUNsb25lc0luRE9NKSB7XG4gICAgICAgICAgICB0aGF0LnVpLmNsb25lcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIGVsLmRldGFjaCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGF0LmFyZUNsb25lc0luRE9NID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhZ2VUcmVlU3RpY2t5SGVhZGVyO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGNtcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLnN0aWNreWhlYWRlci5qcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ 85:
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!\n * THIS FILE HAS BEEN MANUALLY PATCHED TO ALLOW COPYING INTO SELF/CHILDREN\n * https://github.com/FinalAngel/jstree\n */\n/*! jsTree - v3.3.0 - 2016-04-25 - (MIT) */\n!function(a){\"use strict\"; true?!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0)], __WEBPACK_AMD_DEFINE_FACTORY__ = (a),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)):\"undefined\"!=typeof module&&module.exports?module.exports=a(require(\"jquery\")):a(jQuery)}(function(a,b){\"use strict\";if(!a.jstree){var c=0,d=!1,e=!1,f=!1,g=[],h=a(\"script:last\").attr(\"src\"),i=window.document,j=i.createElement(\"LI\"),k,l;j.setAttribute(\"role\",\"treeitem\"),k=i.createElement(\"I\"),k.className=\"jstree-icon jstree-ocl\",k.setAttribute(\"role\",\"presentation\"),j.appendChild(k),k=i.createElement(\"A\"),k.className=\"jstree-anchor\",k.setAttribute(\"href\",\"#\"),k.setAttribute(\"tabindex\",\"-1\"),l=i.createElement(\"I\"),l.className=\"jstree-icon jstree-themeicon\",l.setAttribute(\"role\",\"presentation\"),k.appendChild(l),j.appendChild(k),k=l=null,a.jstree={version:\"{{VERSION}}\",defaults:{plugins:[]},plugins:{},path:h&&-1!==h.indexOf(\"/\")?h.replace(/\\/[^\\/]+$/,\"\"):\"\",idregex:/[\\\\:&!^|()\\[\\]<>@*'+~#\";.,=\\- \\/${}%?`]/g,root:\"#\"},a.jstree.create=function(b,d){var e=new a.jstree.core(++c),f=d;return d=a.extend(!0,{},a.jstree.defaults,d),f&&f.plugins&&(d.plugins=f.plugins),a.each(d.plugins,function(a,b){\"core\"!==a&&(e=e.plugin(b,d[b]))}),a(b).data(\"jstree\",e),e.init(b,d),e},a.jstree.destroy=function(){a(\".jstree:jstree\").jstree(\"destroy\"),a(i).off(\".jstree\")},a.jstree.core=function(a){this._id=a,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},a.jstree.reference=function(b){var c=null,d=null;if(!b||!b.id||b.tagName&&b.nodeType||(b=b.id),!d||!d.length)try{d=a(b)}catch(e){}if(!d||!d.length)try{d=a(\"#\"+b.replace(a.jstree.idregex,\"\\\\$&\"))}catch(e){}return d&&d.length&&(d=d.closest(\".jstree\")).length&&(d=d.data(\"jstree\"))?c=d:a(\".jstree\").each(function(){var d=a(this).data(\"jstree\");return d&&d._model.data[b]?(c=d,!1):void 0}),c},a.fn.jstree=function(c){var d=\"string\"==typeof c,e=Array.prototype.slice.call(arguments,1),f=null;return c!==!0||this.length?(this.each(function(){var g=a.jstree.reference(this),h=d&&g?g[c]:null;return f=d&&h?h.apply(g,e):null,g||d||c!==b&&!a.isPlainObject(c)||a.jstree.create(this,c),(g&&!d||c===!0)&&(f=g||!1),null!==f&&f!==b?!1:void 0}),null!==f&&f!==b?f:this):!1},a.expr[\":\"].jstree=a.expr.createPseudo(function(c){return function(c){return a(c).hasClass(\"jstree\")&&a(c).data(\"jstree\")!==b}}),a.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:a.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},a.jstree.core.prototype={plugin:function(b,c){var d=a.jstree.plugins[b];return d?(this._data[b]={},d.prototype=this,new d(c,this)):this},init:function(b,c){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=a(b).addClass(\"jstree jstree-\"+this._id),this.settings=c,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl=\"rtl\"===this.element.css(\"direction\"),this.element[this._data.core.rtl?\"addClass\":\"removeClass\"](\"jstree-rtl\"),this.element.attr(\"role\",\"tree\"),this.settings.core.multiple&&this.element.attr(\"aria-multiselectable\",!0),this.element.attr(\"tabindex\")||this.element.attr(\"tabindex\",\"0\"),this.bind(),this.trigger(\"init\"),this._data.core.original_container_html=this.element.find(\" > ul > li\").clone(!0),this._data.core.original_container_html.find(\"li\").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\\s+$/.test(this.nodeValue))}).remove(),this.element.html(\"<ul class='jstree-container-ul jstree-children' role='group'><li id='j\"+this._id+\"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>\"+this.get_string(\"Loading ...\")+\"</a></li></ul>\"),this.element.attr(\"aria-activedescendant\",\"j\"+this._id+\"_loading\"),this._data.core.li_height=this.get_container_ul().children(\"li\").first().height()||24,this.trigger(\"loading\"),this.load_node(a.jstree.root)},destroy:function(a){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass(\"jstree\").removeData(\"jstree\").find(\"[class^='jstree']\").addBack().attr(\"class\",function(){return this.className.replace(/jstree[^ ]*|$/gi,\"\")}),this.element=null},bind:function(){var b=\"\",c=null,d=0;this.element.on(\"dblclick.jstree\",function(a){if(a.target.tagName&&\"input\"===a.target.tagName.toLowerCase())return!0;if(i.selection&&i.selection.empty)i.selection.empty();else if(window.getSelection){var b=window.getSelection();try{b.removeAllRanges(),b.collapse()}catch(c){}}}).on(\"mousedown.jstree\",a.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),d=+new Date)},this)).on(\"mousedown.jstree\",\".jstree-ocl\",function(a){a.preventDefault()}).on(\"click.jstree\",\".jstree-ocl\",a.proxy(function(a){this.toggle_node(a.target)},this)).on(\"dblclick.jstree\",\".jstree-anchor\",a.proxy(function(a){return a.target.tagName&&\"input\"===a.target.tagName.toLowerCase()?!0:void(this.settings.core.dblclick_toggle&&this.toggle_node(a.target))},this)).on(\"click.jstree\",\".jstree-anchor\",a.proxy(function(b){b.preventDefault(),b.currentTarget!==i.activeElement&&a(b.currentTarget).focus(),this.activate_node(b.currentTarget,b)},this)).on(\"keydown.jstree\",\".jstree-anchor\",a.proxy(function(b){if(b.target.tagName&&\"input\"===b.target.tagName.toLowerCase())return!0;if(32!==b.which&&13!==b.which&&(b.shiftKey||b.ctrlKey||b.altKey||b.metaKey))return!0;var c=null;switch(this._data.core.rtl&&(37===b.which?b.which=39:39===b.which&&(b.which=37)),b.which){case 32:b.ctrlKey&&(b.type=\"click\",a(b.currentTarget).trigger(b));break;case 13:b.type=\"click\",a(b.currentTarget).trigger(b);break;case 37:b.preventDefault(),this.is_open(b.currentTarget)?this.close_node(b.currentTarget):(c=this.get_parent(b.currentTarget),c&&c.id!==a.jstree.root&&this.get_node(c,!0).children(\".jstree-anchor\").focus());break;case 38:b.preventDefault(),c=this.get_prev_dom(b.currentTarget),c&&c.length&&c.children(\".jstree-anchor\").focus();break;case 39:b.preventDefault(),this.is_closed(b.currentTarget)?this.open_node(b.currentTarget,function(a){this.get_node(a,!0).children(\".jstree-anchor\").focus()}):this.is_open(b.currentTarget)&&(c=this.get_node(b.currentTarget,!0).children(\".jstree-children\")[0],c&&a(this._firstChild(c)).children(\".jstree-anchor\").focus());break;case 40:b.preventDefault(),c=this.get_next_dom(b.currentTarget),c&&c.length&&c.children(\".jstree-anchor\").focus();break;case 106:this.open_all();break;case 36:b.preventDefault(),c=this._firstChild(this.get_container_ul()[0]),c&&a(c).children(\".jstree-anchor\").filter(\":visible\").focus();break;case 35:b.preventDefault(),this.element.find(\".jstree-anchor\").filter(\":visible\").last().focus();break;case 113:b.preventDefault(),this.edit(b.currentTarget)}},this)).on(\"load_node.jstree\",a.proxy(function(b,c){c.status&&(c.node.id!==a.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr(\"aria-activedescendant\",this._firstChild(this.get_container_ul()[0]).id),this.trigger(\"loaded\")),this._data.core.ready||setTimeout(a.proxy(function(){if(this.element&&!this.get_container_ul().find(\".jstree-loading\").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var b=[],c,d;for(c=0,d=this._data.core.selected.length;d>c;c++)b=b.concat(this._model.data[this._data.core.selected[c]].parents);for(b=a.vakata.array_unique(b),c=0,d=b.length;d>c;c++)this.open_node(b[c],!1,0)}this.trigger(\"changed\",{action:\"ready\",selected:this._data.core.selected})}this.trigger(\"ready\")}},this),0))},this)).on(\"keypress.jstree\",a.proxy(function(d){if(d.target.tagName&&\"input\"===d.target.tagName.toLowerCase())return!0;c&&clearTimeout(c),c=setTimeout(function(){b=\"\"},500);var e=String.fromCharCode(d.which).toLowerCase(),f=this.element.find(\".jstree-anchor\").filter(\":visible\"),g=f.index(i.activeElement)||0,h=!1;if(b+=e,b.length>1){if(f.slice(g).each(a.proxy(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g).each(a.proxy(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).focus(),h=!0,!1):void 0},this)),h)return}if(new RegExp(\"^\"+e.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g,\"\\\\$&\")+\"+$\").test(b)){if(f.slice(g+1).each(a.proxy(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g+1).each(a.proxy(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).focus(),h=!0,!1):void 0},this)),h)return}},this)).on(\"init.jstree\",a.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots,this._data.core.themes.stripes=a.stripes,this._data.core.themes.icons=a.icons,this.set_theme(a.name||\"default\",a.url),this.set_theme_variant(a.variant)},this)).on(\"loading.jstree\",a.proxy(function(){this[this._data.core.themes.dots?\"show_dots\":\"hide_dots\"](),this[this._data.core.themes.icons?\"show_icons\":\"hide_icons\"](),this[this._data.core.themes.stripes?\"show_stripes\":\"hide_stripes\"]()},this)).on(\"blur.jstree\",\".jstree-anchor\",a.proxy(function(b){this._data.core.focused=null,a(b.currentTarget).filter(\".jstree-hovered\").mouseleave(),this.element.attr(\"tabindex\",\"0\")},this)).on(\"focus.jstree\",\".jstree-anchor\",a.proxy(function(b){var c=this.get_node(b.currentTarget);c&&c.id&&(this._data.core.focused=c.id),this.element.find(\".jstree-hovered\").not(b.currentTarget).mouseleave(),a(b.currentTarget).mouseenter(),this.element.attr(\"tabindex\",\"-1\")},this)).on(\"focus.jstree\",a.proxy(function(){if(+new Date-d>500&&!this._data.core.focused){d=0;var a=this.get_node(this.element.attr(\"aria-activedescendant\"),!0);a&&a.find(\"> .jstree-anchor\").focus()}},this)).on(\"mouseenter.jstree\",\".jstree-anchor\",a.proxy(function(a){this.hover_node(a.currentTarget)},this)).on(\"mouseleave.jstree\",\".jstree-anchor\",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(\".jstree\"),a(i).off(\".jstree-\"+this._id)},trigger:function(a,b){b||(b={}),b.instance=this,this.element.triggerHandler(a.replace(\".jstree\",\"\")+\".jstree\",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(\".jstree-children\").first()},get_string:function(b){var c=this.settings.core.strings;return a.isFunction(c)?c.call(this,b):c&&c[b]?c[b]:b},_firstChild:function(a){a=a?a.firstChild:null;while(null!==a&&1!==a.nodeType)a=a.nextSibling;return a},_nextSibling:function(a){a=a?a.nextSibling:null;while(null!==a&&1!==a.nodeType)a=a.nextSibling;return a},_previousSibling:function(a){a=a?a.previousSibling:null;while(null!==a&&1!==a.nodeType)a=a.previousSibling;return a},get_node:function(b,c){b&&b.id&&(b=b.id);var d;try{if(this._model.data[b])b=this._model.data[b];else if(\"string\"==typeof b&&this._model.data[b.replace(/^#/,\"\")])b=this._model.data[b.replace(/^#/,\"\")];else if(\"string\"==typeof b&&(d=a(\"#\"+b.replace(a.jstree.idregex,\"\\\\$&\"),this.element)).length&&this._model.data[d.closest(\".jstree-node\").attr(\"id\")])b=this._model.data[d.closest(\".jstree-node\").attr(\"id\")];else if((d=a(b,this.element)).length&&this._model.data[d.closest(\".jstree-node\").attr(\"id\")])b=this._model.data[d.closest(\".jstree-node\").attr(\"id\")];else{if(!(d=a(b,this.element)).length||!d.hasClass(\"jstree\"))return!1;b=this._model.data[a.jstree.root]}return c&&(b=b.id===a.jstree.root?this.element:a(\"#\"+b.id.replace(a.jstree.idregex,\"\\\\$&\"),this.element)),b}catch(e){return!1}},get_path:function(b,c,d){if(b=b.parents?b:this.get_node(b),!b||b.id===a.jstree.root||!b.parents)return!1;var e,f,g=[];for(g.push(d?b.id:b.text),e=0,f=b.parents.length;f>e;e++)g.push(d?b.parents[e]:this.get_text(b.parents[e]));return g=g.reverse().slice(1),c?g.join(c):g},get_next_dom:function(b,c){var d;if(b=this.get_node(b,!0),b[0]===this.element[0]){d=this._firstChild(this.get_container_ul()[0]);while(d&&0===d.offsetHeight)d=this._nextSibling(d);return d?a(d):!1}if(!b||!b.length)return!1;if(c){d=b[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return d?a(d):!1}if(b.hasClass(\"jstree-open\")){d=this._firstChild(b.children(\".jstree-children\")[0]);while(d&&0===d.offsetHeight)d=this._nextSibling(d);if(null!==d)return a(d)}d=b[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return null!==d?a(d):b.parentsUntil(\".jstree\",\".jstree-node\").nextAll(\".jstree-node:visible\").first()},get_prev_dom:function(b,c){var d;if(b=this.get_node(b,!0),b[0]===this.element[0]){d=this.get_container_ul()[0].lastChild;while(d&&0===d.offsetHeight)d=this._previousSibling(d);return d?a(d):!1}if(!b||!b.length)return!1;if(c){d=b[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);return d?a(d):!1}d=b[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);if(null!==d){b=a(d);while(b.hasClass(\"jstree-open\"))b=b.children(\".jstree-children\").first().children(\".jstree-node:visible:last\");return b}return d=b[0].parentNode.parentNode,d&&d.className&&-1!==d.className.indexOf(\"jstree-node\")?a(d):!1},get_parent:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.parent:!1},get_children_dom:function(a){return a=this.get_node(a,!0),a[0]===this.element[0]?this.get_container_ul().children(\".jstree-node\"):a&&a.length?a.children(\".jstree-children\").children(\".jstree-node\"):!1},is_parent:function(a){return a=this.get_node(a),a&&(a.state.loaded===!1||a.children.length>0)},is_loaded:function(a){return a=this.get_node(a),a&&a.state.loaded},is_loading:function(a){return a=this.get_node(a),a&&a.state&&a.state.loading},is_open:function(a){return a=this.get_node(a),a&&a.state.opened},is_closed:function(a){return a=this.get_node(a),a&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(b,c){var d,e,f,g,h;if(a.isArray(b))return this._load_nodes(b.slice(),c),!0;if(b=this.get_node(b),!b)return c&&c.call(this,b,!1),!1;if(b.state.loaded){for(b.state.loaded=!1,f=0,g=b.parents.length;g>f;f++)this._model.data[b.parents[f]].children_d=a.vakata.array_filter(this._model.data[b.parents[f]].children_d,function(c){return-1===a.inArray(c,b.children_d)});for(d=0,e=b.children_d.length;e>d;d++)this._model.data[b.children_d[d]].state.selected&&(h=!0),delete this._model.data[b.children_d[d]];h&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(c){return-1===a.inArray(c,b.children_d)})),b.children=[],b.children_d=[],h&&this.trigger(\"changed\",{action:\"load_node\",node:b,selected:this._data.core.selected})}return b.state.failed=!1,b.state.loading=!0,this.get_node(b,!0).addClass(\"jstree-loading\").attr(\"aria-busy\",!0),this._load_node(b,a.proxy(function(a){b=this._model.data[b.id],b.state.loading=!1,b.state.loaded=a,b.state.failed=!b.state.loaded;var d=this.get_node(b,!0),e=0,f=0,g=this._model.data,h=!1;for(e=0,f=b.children.length;f>e;e++)if(g[b.children[e]]&&!g[b.children[e]].state.hidden){h=!0;break}b.state.loaded&&d&&d.length&&(d.removeClass(\"jstree-closed jstree-open jstree-leaf\"),h?\"#\"!==b.id&&d.addClass(b.state.opened?\"jstree-open\":\"jstree-closed\"):d.addClass(\"jstree-leaf\")),d.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1),this.trigger(\"load_node\",{node:b,status:a}),c&&c.call(this,b,a)},this)),!0},_load_nodes:function(a,b,c,d){var e=!0,f=function(){this._load_nodes(a,b,!0)},g=this._model.data,h,i,j=[];for(h=0,i=a.length;i>h;h++)g[a[h]]&&(!g[a[h]].state.loaded&&!g[a[h]].state.failed||!c&&d)&&(this.is_loading(a[h])||this.load_node(a[h],f),e=!1);if(e){for(h=0,i=a.length;i>h;h++)g[a[h]]&&g[a[h]].state.loaded&&j.push(a[h]);b&&!b.done&&(b.call(this,j),b.done=!0)}},load_all:function(b,c){if(b||(b=a.jstree.root),b=this.get_node(b),!b)return!1;var d=[],e=this._model.data,f=e[b.id].children_d,g,h;for(b.state&&!b.state.loaded&&d.push(b.id),g=0,h=f.length;h>g;g++)e[f[g]]&&e[f[g]].state&&!e[f[g]].state.loaded&&d.push(f[g]);d.length?this._load_nodes(d,function(){this.load_all(b,c)}):(c&&c.call(this,b),this.trigger(\"load_all\",{node:b}))},_load_node:function(b,c){var d=this.settings.core.data,e;return d?a.isFunction(d)?d.call(this,b,a.proxy(function(d){d===!1?c.call(this,!1):this[\"string\"==typeof d?\"_append_html_data\":\"_append_json_data\"](b,\"string\"==typeof d?a(a.parseHTML(d)).filter(function(){return 3!==this.nodeType}):d,function(a){c.call(this,a)})},this)):\"object\"==typeof d?d.url?(d=a.extend(!0,{},d),a.isFunction(d.url)&&(d.url=d.url.call(this,b)),a.isFunction(d.data)&&(d.data=d.data.call(this,b)),a.ajax(d).done(a.proxy(function(d,e,f){var g=f.getResponseHeader(\"Content-Type\");return g&&-1!==g.indexOf(\"json\")||\"object\"==typeof d?this._append_json_data(b,d,function(a){c.call(this,a)}):g&&-1!==g.indexOf(\"html\")||\"string\"==typeof d?this._append_html_data(b,a(a.parseHTML(d)).filter(function(){return 3!==this.nodeType}),function(a){c.call(this,a)}):(this._data.core.last_error={error:\"ajax\",plugin:\"core\",id:\"core_04\",reason:\"Could not load node\",data:JSON.stringify({id:b.id,xhr:f})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))},this)).fail(a.proxy(function(a){c.call(this,!1),this._data.core.last_error={error:\"ajax\",plugin:\"core\",id:\"core_04\",reason:\"Could not load node\",data:JSON.stringify({id:b.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(e=a.isArray(d)||a.isPlainObject(d)?JSON.parse(JSON.stringify(d)):d,b.id===a.jstree.root?this._append_json_data(b,e,function(a){c.call(this,a)}):(this._data.core.last_error={error:\"nodata\",plugin:\"core\",id:\"core_05\",reason:\"Could not load node\",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))):\"string\"==typeof d?b.id===a.jstree.root?this._append_html_data(b,a(a.parseHTML(d)).filter(function(){return 3!==this.nodeType}),function(a){c.call(this,a)}):(this._data.core.last_error={error:\"nodata\",plugin:\"core\",id:\"core_06\",reason:\"Could not load node\",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1)):c.call(this,!1):b.id===a.jstree.root?this._append_html_data(b,this._data.core.original_container_html.clone(!0),function(a){c.call(this,a)}):c.call(this,!1)},_node_changed:function(a){a=this.get_node(a),a&&this._model.changed.push(a.id)},_append_html_data:function(b,c,d){b=this.get_node(b),b.children=[],b.children_d=[];var e=c.is(\"ul\")?c.children():c,f=b.id,g=[],h=[],i=this._model.data,j=i[f],k=this._data.core.selected.length,l,m,n;for(e.each(a.proxy(function(b,c){l=this._parse_model_from_html(a(c),f,j.parents.concat()),l&&(g.push(l),h.push(l),i[l].children_d.length&&(h=h.concat(i[l].children_d)))},this)),j.children=g,j.children_d=h,m=0,n=j.parents.length;n>m;m++)i[j.parents[m]].children_d=i[j.parents[m]].children_d.concat(h);this.trigger(\"model\",{nodes:h,parent:f}),f!==a.jstree.root?(this._node_changed(f),this.redraw()):(this.get_container_ul().children(\".jstree-initial-node\").remove(),this.redraw(!0)),this._data.core.selected.length!==k&&this.trigger(\"changed\",{action:\"model\",selected:this._data.core.selected}),d.call(this,!0)},_append_json_data:function(b,c,d,e){if(null!==this.element){b=this.get_node(b),b.children=[],b.children_d=[],c.d&&(c=c.d,\"string\"==typeof c&&(c=JSON.parse(c))),a.isArray(c)||(c=[c]);var f=null,g={df:this._model.default_state,dat:c,par:b.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},h=function(a,b){a.data&&(a=a.data);var c=a.dat,d=a.par,e=[],f=[],g=[],h=a.df,i=a.t_id,j=a.t_cnt,k=a.m,l=k[d],m=a.sel,n,o,p,q,r=function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=a.id.toString(),f,i,j,l,m={id:e,text:a.text||\"\",icon:a.icon!==b?a.icon:!0,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(f in h)h.hasOwnProperty(f)&&(m.state[f]=h[f]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(m.icon=a.data.jstree.icon),m.icon!==b&&null!==m.icon&&\"\"!==m.icon||(m.icon=!0),a&&a.data&&(m.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(m.state[f]=a.data.jstree[f]);if(a&&\"object\"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(m.state[f]=a.state[f]);if(a&&\"object\"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(m.li_attr[f]=a.li_attr[f]);if(m.li_attr.id||(m.li_attr.id=e),a&&\"object\"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(m.a_attr[f]=a.a_attr[f]);for(a&&a.children&&a.children===!0&&(m.state.loaded=!1,m.children=[],m.children_d=[]),k[m.id]=m,f=0,i=m.children.length;i>f;f++)j=r(k[m.children[f]],m.id,d),l=k[j],m.children_d.push(j),l.children_d.length&&(m.children_d=m.children_d.concat(l.children_d));return delete a.data,delete a.children,k[m.id].original=a,m.state.selected&&g.push(m.id),m.id},s=function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=!1,f,l,m,n,o;do e=\"j\"+i+\"_\"+ ++j;while(k[e]);o={id:!1,text:\"string\"==typeof a?a:\"\",icon:\"object\"==typeof a&&a.icon!==b?a.icon:!0,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(f in h)h.hasOwnProperty(f)&&(o.state[f]=h[f]);if(a&&a.id&&(o.id=a.id.toString()),a&&a.text&&(o.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(o.icon=a.data.jstree.icon),o.icon!==b&&null!==o.icon&&\"\"!==o.icon||(o.icon=!0),a&&a.data&&(o.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(o.state[f]=a.data.jstree[f]);if(a&&\"object\"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(o.state[f]=a.state[f]);if(a&&\"object\"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(o.li_attr[f]=a.li_attr[f]);if(o.li_attr.id&&!o.id&&(o.id=o.li_attr.id.toString()),o.id||(o.id=e),o.li_attr.id||(o.li_attr.id=o.id),a&&\"object\"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(o.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,l=a.children.length;l>f;f++)m=s(a.children[f],o.id,d),n=k[m],o.children.push(m),n.children_d.length&&(o.children_d=o.children_d.concat(n.children_d));o.children_d=o.children_d.concat(o.children)}return a&&a.children&&a.children===!0&&(o.state.loaded=!1,o.children=[],o.children_d=[]),delete a.data,delete a.children,o.original=a,k[o.id]=o,o.state.selected&&g.push(o.id),o.id};if(c.length&&c[0].id!==b&&c[0].parent!==b){for(o=0,p=c.length;p>o;o++)c[o].children||(c[o].children=[]),k[c[o].id.toString()]=c[o];for(o=0,p=c.length;p>o;o++)k[c[o].parent.toString()].children.push(c[o].id.toString()),l.children_d.push(c[o].id.toString());for(o=0,p=l.children.length;p>o;o++)n=r(k[l.children[o]],d,l.parents.concat()),f.push(n),k[n].children_d.length&&(f=f.concat(k[n].children_d));for(o=0,p=l.parents.length;p>o;o++)k[l.parents[o]].children_d=k[l.parents[o]].children_d.concat(f);q={cnt:j,mod:k,sel:m,par:d,dpc:f,add:g}}else{for(o=0,p=c.length;p>o;o++)n=s(c[o],d,l.parents.concat()),n&&(e.push(n),f.push(n),k[n].children_d.length&&(f=f.concat(k[n].children_d)));for(l.children=e,l.children_d=f,o=0,p=l.parents.length;p>o;o++)k[l.parents[o]].children_d=k[l.parents[o]].children_d.concat(f);q={cnt:j,mod:k,sel:m,par:d,dpc:f,add:g}}return\"undefined\"!=typeof window&&\"undefined\"!=typeof window.document?q:void postMessage(q)},i=function(b,c){if(null!==this.element){this._cnt=b.cnt;var e,f=this._model.data;for(e in f)f.hasOwnProperty(e)&&f[e].state&&f[e].state.loading&&b.mod[e]&&(b.mod[e].state.loading=!0);if(this._model.data=b.mod,c){var g,h=b.add,i=b.sel,j=this._data.core.selected.slice();if(f=this._model.data,i.length!==j.length||a.vakata.array_unique(i.concat(j)).length!==i.length){for(e=0,g=i.length;g>e;e++)-1===a.inArray(i[e],h)&&-1===a.inArray(i[e],j)&&(f[i[e]].state.selected=!1);for(e=0,g=j.length;g>e;e++)-1===a.inArray(j[e],i)&&(f[j[e]].state.selected=!0)}}b.add.length&&(this._data.core.selected=this._data.core.selected.concat(b.add)),this.trigger(\"model\",{nodes:b.dpc,parent:b.par}),b.par!==a.jstree.root?(this._node_changed(b.par),this.redraw()):this.redraw(!0),b.add.length&&this.trigger(\"changed\",{action:\"model\",selected:this._data.core.selected}),d.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob([\"self.onmessage = \"+h.toString()],{type:\"text/javascript\"}))),!this._data.core.working||e?(this._data.core.working=!0,f=new window.Worker(this._wrk),f.onmessage=a.proxy(function(a){i.call(this,a.data,!0);try{f.terminate(),f=null}catch(b){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),g.par?f.postMessage(g):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([b,c,d,!0])}catch(j){i.call(this,h(g),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else i.call(this,h(g),!1)}},_parse_model_from_html:function(c,d,e){e=e?[].concat(e):[],d&&e.unshift(d);var f,g,h=this._model.data,i={id:!1,text:!1,icon:!0,parent:d,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1},j,k,l;for(j in this._model.default_state)this._model.default_state.hasOwnProperty(j)&&(i.state[j]=this._model.default_state[j]);if(k=a.vakata.attributes(c,!0),a.each(k,function(b,c){return c=a.trim(c),c.length?(i.li_attr[b]=c,void(\"id\"===b&&(i.id=c.toString()))):!0}),k=c.children(\"a\").first(),k.length&&(k=a.vakata.attributes(k,!0),a.each(k,function(b,c){c=a.trim(c),c.length&&(i.a_attr[b]=c)})),k=c.children(\"a\").first().length?c.children(\"a\").first().clone():c.clone(),k.children(\"ins, i, ul\").remove(),k=k.html(),k=a(\"<div />\").html(k),i.text=this.settings.core.force_text?k.text():k.html(),k=c.data(),i.data=k?a.extend(!0,{},k):null,i.state.opened=c.hasClass(\"jstree-open\"),i.state.selected=c.children(\"a\").hasClass(\"jstree-clicked\"),i.state.disabled=c.children(\"a\").hasClass(\"jstree-disabled\"),i.data&&i.data.jstree)for(j in i.data.jstree)i.data.jstree.hasOwnProperty(j)&&(i.state[j]=i.data.jstree[j]);k=c.children(\"a\").children(\".jstree-themeicon\"),k.length&&(i.icon=k.hasClass(\"jstree-themeicon-hidden\")?!1:k.attr(\"rel\")),i.state.icon!==b&&(i.icon=i.state.icon),i.icon!==b&&null!==i.icon&&\"\"!==i.icon||(i.icon=!0),k=c.children(\"ul\").children(\"li\");do l=\"j\"+this._id+\"_\"+ ++this._cnt;while(h[l]);return i.id=i.li_attr.id?i.li_attr.id.toString():l,k.length?(k.each(a.proxy(function(b,c){f=this._parse_model_from_html(a(c),i.id,e),g=this._model.data[f],i.children.push(f),g.children_d.length&&(i.children_d=i.children_d.concat(g.children_d))},this)),i.children_d=i.children_d.concat(i.children)):c.hasClass(\"jstree-closed\")&&(i.state.loaded=!1),i.li_attr[\"class\"]&&(i.li_attr[\"class\"]=i.li_attr[\"class\"].replace(\"jstree-closed\",\"\").replace(\"jstree-open\",\"\")),i.a_attr[\"class\"]&&(i.a_attr[\"class\"]=i.a_attr[\"class\"].replace(\"jstree-clicked\",\"\").replace(\"jstree-disabled\",\"\")),h[i.id]=i,i.state.selected&&this._data.core.selected.push(i.id),i.id},_parse_model_from_flat_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=a.id.toString(),f=this._model.data,g=this._model.default_state,h,i,j,k,l={id:e,text:a.text||\"\",icon:a.icon!==b?a.icon:!0,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(h in g)g.hasOwnProperty(h)&&(l.state[h]=g[h]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),l.icon!==b&&null!==l.icon&&\"\"!==l.icon||(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&(l.state[h]=a.data.jstree[h]);if(a&&\"object\"==typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(l.state[h]=a.state[h]);if(a&&\"object\"==typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(l.li_attr[h]=a.li_attr[h]);if(l.li_attr.id||(l.li_attr.id=e),a&&\"object\"==typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(l.a_attr[h]=a.a_attr[h]);for(a&&a.children&&a.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),f[l.id]=l,h=0,i=l.children.length;i>h;h++)j=this._parse_model_from_flat_json(f[l.children[h]],l.id,d),k=f[j],l.children_d.push(j),k.children_d.length&&(l.children_d=l.children_d.concat(k.children_d));return delete a.data,delete a.children,f[l.id].original=a,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=!1,f,g,h,i,j=this._model.data,k=this._model.default_state,l;do e=\"j\"+this._id+\"_\"+ ++this._cnt;while(j[e]);l={id:!1,text:\"string\"==typeof a?a:\"\",icon:\"object\"==typeof a&&a.icon!==b?a.icon:!0,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(f in k)k.hasOwnProperty(f)&&(l.state[f]=k[f]);if(a&&a.id&&(l.id=a.id.toString()),a&&a.text&&(l.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),l.icon!==b&&null!==l.icon&&\"\"!==l.icon||(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(l.state[f]=a.data.jstree[f]);if(a&&\"object\"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(l.state[f]=a.state[f]);if(a&&\"object\"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(l.li_attr[f]=a.li_attr[f]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=e),l.li_attr.id||(l.li_attr.id=l.id),a&&\"object\"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(l.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,g=a.children.length;g>f;f++)h=this._parse_model_from_json(a.children[f],l.id,d),i=j[h],l.children.push(h),i.children_d.length&&(l.children_d=l.children_d.concat(i.children_d));l.children_d=l.children_d.concat(l.children)}return a&&a.children&&a.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete a.data,delete a.children,l.original=a,j[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var b=this._model.force_full_redraw?this._model.data[a.jstree.root].children.concat([]):this._model.changed.concat([]),c=i.createElement(\"UL\"),d,e,f,g=this._data.core.focused;for(e=0,f=b.length;f>e;e++)d=this.redraw_node(b[e],!0,this._model.force_full_redraw),d&&this._model.force_full_redraw&&c.appendChild(d);this._model.force_full_redraw&&(c.className=this.get_container_ul()[0].className,c.setAttribute(\"role\",\"group\"),this.element.empty().append(c)),null!==g&&(d=this.get_node(g,!0),d&&d.length&&d.children(\".jstree-anchor\")[0]!==i.activeElement?d.children(\".jstree-anchor\").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger(\"redraw\",{nodes:b})},redraw:function(a){a&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(b){var c=this.get_node(b),d=!1,e=!1,f=!1,g=i;if(!c)return!1;if(c.id===a.jstree.root)return this.redraw(!0);if(b=this.get_node(b,!0),!b||!b.length)return!1;if(b.children(\".jstree-children\").remove(),b=b[0],c.children.length&&c.state.loaded){for(f=g.createElement(\"UL\"),f.setAttribute(\"role\",\"group\"),f.className=\"jstree-children\",d=0,e=c.children.length;e>d;d++)f.appendChild(this.redraw_node(c.children[d],!0,!0));b.appendChild(f)}},redraw_node:function(b,c,d,e){var f=this.get_node(b),g=!1,h=!1,k=!1,l=!1,m=!1,n=!1,o=\"\",p=i,q=this._model.data,r=!1,s=!1,t=null,u=0,v=0,w=!1,x=!1;if(!f)return!1;if(f.id===a.jstree.root)return this.redraw(!0);if(c=c||0===f.children.length,b=i.querySelector?this.element[0].querySelector(\"#\"+(-1!==\"0123456789\".indexOf(f.id[0])?\"\\\\3\"+f.id[0]+\" \"+f.id.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):f.id.replace(a.jstree.idregex,\"\\\\$&\"))):i.getElementById(f.id))b=a(b),\nd||(g=b.parent().parent()[0],g===this.element[0]&&(g=null),h=b.index()),c||!f.children.length||b.children(\".jstree-children\").length||(c=!0),c||(k=b.children(\".jstree-children\")[0]),r=b.children(\".jstree-anchor\")[0]===i.activeElement,b.remove();else if(c=!0,!d){if(g=f.parent!==a.jstree.root?a(\"#\"+f.parent.replace(a.jstree.idregex,\"\\\\$&\"),this.element)[0]:null,!(null===g||g&&q[f.parent].state.opened))return!1;h=a.inArray(f.id,null===g?q[a.jstree.root].children:q[f.parent].children)}b=j.cloneNode(!0),o=\"jstree-node \";for(l in f.li_attr)if(f.li_attr.hasOwnProperty(l)){if(\"id\"===l)continue;\"class\"!==l?b.setAttribute(l,f.li_attr[l]):o+=f.li_attr[l]}for(f.a_attr.id||(f.a_attr.id=f.id+\"_anchor\"),b.setAttribute(\"aria-selected\",!!f.state.selected),b.setAttribute(\"aria-level\",f.parents.length),b.setAttribute(\"aria-labelledby\",f.a_attr.id),f.state.disabled&&b.setAttribute(\"aria-disabled\",!0),l=0,m=f.children.length;m>l;l++)if(!q[f.children[l]].state.hidden){w=!0;break}if(null!==f.parent&&q[f.parent]&&!f.state.hidden&&(l=a.inArray(f.id,q[f.parent].children),x=f.id,-1!==l))for(l++,m=q[f.parent].children.length;m>l;l++)if(q[q[f.parent].children[l]].state.hidden||(x=q[f.parent].children[l]),x!==f.id)break;f.state.hidden&&(o+=\" jstree-hidden\"),f.state.loaded&&!w?o+=\" jstree-leaf\":(o+=f.state.opened&&f.state.loaded?\" jstree-open\":\" jstree-closed\",b.setAttribute(\"aria-expanded\",f.state.opened&&f.state.loaded)),x===f.id&&(o+=\" jstree-last\"),b.id=f.id,b.className=o,o=(f.state.selected?\" jstree-clicked\":\"\")+(f.state.disabled?\" jstree-disabled\":\"\");for(m in f.a_attr)if(f.a_attr.hasOwnProperty(m)){if(\"href\"===m&&\"#\"===f.a_attr[m])continue;\"class\"!==m?b.childNodes[1].setAttribute(m,f.a_attr[m]):o+=\" \"+f.a_attr[m]}if(o.length&&(b.childNodes[1].className=\"jstree-anchor \"+o),(f.icon&&f.icon!==!0||f.icon===!1)&&(f.icon===!1?b.childNodes[1].childNodes[0].className+=\" jstree-themeicon-hidden\":-1===f.icon.indexOf(\"/\")&&-1===f.icon.indexOf(\".\")?b.childNodes[1].childNodes[0].className+=\" \"+f.icon+\" jstree-themeicon-custom\":(b.childNodes[1].childNodes[0].style.backgroundImage='url(\"'+f.icon+'\")',b.childNodes[1].childNodes[0].style.backgroundPosition=\"center center\",b.childNodes[1].childNodes[0].style.backgroundSize=\"auto\",b.childNodes[1].childNodes[0].className+=\" jstree-themeicon-custom\")),this.settings.core.force_text?b.childNodes[1].appendChild(p.createTextNode(f.text)):b.childNodes[1].innerHTML+=f.text,c&&f.children.length&&(f.state.opened||e)&&f.state.loaded){for(n=p.createElement(\"UL\"),n.setAttribute(\"role\",\"group\"),n.className=\"jstree-children\",l=0,m=f.children.length;m>l;l++)n.appendChild(this.redraw_node(f.children[l],c,!0));b.appendChild(n)}if(k&&b.appendChild(k),!d){for(g||(g=this.element[0]),l=0,m=g.childNodes.length;m>l;l++)if(g.childNodes[l]&&g.childNodes[l].className&&-1!==g.childNodes[l].className.indexOf(\"jstree-children\")){t=g.childNodes[l];break}t||(t=p.createElement(\"UL\"),t.setAttribute(\"role\",\"group\"),t.className=\"jstree-children\",g.appendChild(t)),g=t,h<g.childNodes.length?g.insertBefore(b,g.childNodes[h]):g.appendChild(b),r&&(u=this.element[0].scrollTop,v=this.element[0].scrollLeft,b.childNodes[1].focus(),this.element[0].scrollTop=u,this.element[0].scrollLeft=v)}return f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(a.proxy(function(){this.open_node(f.id,!1,0)},this),0)),b},open_node:function(c,d,e){var f,g,h,i;if(a.isArray(c)){for(c=c.slice(),f=0,g=c.length;g>f;f++)this.open_node(c[f],d,e);return!0}return c=this.get_node(c),c&&c.id!==a.jstree.root?(e=e===b?this.settings.core.animation:e,this.is_closed(c)?this.is_loaded(c)?(h=this.get_node(c,!0),i=this,h.length&&(e&&h.children(\".jstree-children\").length&&h.children(\".jstree-children\").stop(!0,!0),c.children.length&&!this._firstChild(h.children(\".jstree-children\")[0])&&this.draw_children(c),e?(this.trigger(\"before_open\",{node:c}),h.children(\".jstree-children\").css(\"display\",\"none\").end().removeClass(\"jstree-closed\").addClass(\"jstree-open\").attr(\"aria-expanded\",!0).children(\".jstree-children\").stop(!0,!0).slideDown(e,function(){this.style.display=\"\",i.trigger(\"after_open\",{node:c})})):(this.trigger(\"before_open\",{node:c}),h[0].className=h[0].className.replace(\"jstree-closed\",\"jstree-open\"),h[0].setAttribute(\"aria-expanded\",!0))),c.state.opened=!0,d&&d.call(this,c,!0),h.length||this.trigger(\"before_open\",{node:c}),this.trigger(\"open_node\",{node:c}),e&&h.length||this.trigger(\"after_open\",{node:c}),!0):this.is_loading(c)?setTimeout(a.proxy(function(){this.open_node(c,d,e)},this),500):void this.load_node(c,function(a,b){return b?this.open_node(a,d,e):d?d.call(this,a,!1):!1}):(d&&d.call(this,c,!1),!1)):!1},_open_to:function(b){if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;var c,d,e=b.parents;for(c=0,d=e.length;d>c;c+=1)c!==a.jstree.root&&this.open_node(e[c],!1,0);return a(\"#\"+b.id.replace(a.jstree.idregex,\"\\\\$&\"),this.element)},close_node:function(c,d){var e,f,g,h;if(a.isArray(c)){for(c=c.slice(),e=0,f=c.length;f>e;e++)this.close_node(c[e],d);return!0}return c=this.get_node(c),c&&c.id!==a.jstree.root?this.is_closed(c)?!1:(d=d===b?this.settings.core.animation:d,g=this,h=this.get_node(c,!0),c.state.opened=!1,this.trigger(\"close_node\",{node:c}),void(h.length?d?h.children(\".jstree-children\").attr(\"style\",\"display:block !important\").end().removeClass(\"jstree-open\").addClass(\"jstree-closed\").attr(\"aria-expanded\",!1).children(\".jstree-children\").stop(!0,!0).slideUp(d,function(){this.style.display=\"\",h.children(\".jstree-children\").remove(),g.trigger(\"after_close\",{node:c})}):(h[0].className=h[0].className.replace(\"jstree-open\",\"jstree-closed\"),h.attr(\"aria-expanded\",!1).children(\".jstree-children\").remove(),this.trigger(\"after_close\",{node:c})):this.trigger(\"after_close\",{node:c}))):!1},toggle_node:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.toggle_node(b[c]);return!0}return this.is_closed(b)?this.open_node(b):this.is_open(b)?this.close_node(b):void 0},open_all:function(b,c,d){if(b||(b=a.jstree.root),b=this.get_node(b),!b)return!1;var e=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0),f,g,h;if(!e.length){for(f=0,g=b.children_d.length;g>f;f++)this.is_closed(this._model.data[b.children_d[f]])&&(this._model.data[b.children_d[f]].state.opened=!0);return this.trigger(\"open_all\",{node:b})}d=d||e,h=this,e=this.is_closed(b)?e.find(\".jstree-closed\").addBack():e.find(\".jstree-closed\"),e.each(function(){h.open_node(this,function(a,b){b&&this.is_parent(a)&&this.open_all(a,c,d)},c||0)}),0===d.find(\".jstree-closed\").length&&this.trigger(\"open_all\",{node:this.get_node(d)})},close_all:function(b,c){if(b||(b=a.jstree.root),b=this.get_node(b),!b)return!1;var d=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0),e=this,f,g;for(d.length&&(d=this.is_open(b)?d.find(\".jstree-open\").addBack():d.find(\".jstree-open\"),a(d.get().reverse()).each(function(){e.close_node(this,c||0)})),f=0,g=b.children_d.length;g>f;f++)this._model.data[b.children_d[f]].state.opened=!1;this.trigger(\"close_all\",{node:b})},is_disabled:function(a){return a=this.get_node(a),a&&a.state&&a.state.disabled},enable_node:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.enable_node(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(b.state.disabled=!1,this.get_node(b,!0).children(\".jstree-anchor\").removeClass(\"jstree-disabled\").attr(\"aria-disabled\",!1),void this.trigger(\"enable_node\",{node:b})):!1},disable_node:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.disable_node(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(b.state.disabled=!0,this.get_node(b,!0).children(\".jstree-anchor\").addClass(\"jstree-disabled\").attr(\"aria-disabled\",!0),void this.trigger(\"disable_node\",{node:b})):!1},is_hidden:function(a){return a=this.get_node(a),a.state.hidden===!0},hide_node:function(b,c){var d,e;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.hide_node(b[d],!0);return c||this.redraw(),!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?void(b.state.hidden||(b.state.hidden=!0,this._node_changed(b.parent),c||this.redraw(),this.trigger(\"hide_node\",{node:b}))):!1},show_node:function(b,c){var d,e;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.show_node(b[d],!0);return c||this.redraw(),!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?void(b.state.hidden&&(b.state.hidden=!1,this._node_changed(b.parent),c||this.redraw(),this.trigger(\"show_node\",{node:b}))):!1},hide_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&!d[c].state.hidden&&(d[c].state.hidden=!0,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger(\"hide_all\",{nodes:e}),e},show_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&d[c].state.hidden&&(d[c].state.hidden=!1,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger(\"show_all\",{nodes:e}),e},activate_node:function(a,c){if(this.is_disabled(a))return!1;if(c&&\"object\"==typeof c||(c={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==b?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&(!c.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(c.shiftKey){var d=this.get_node(a).id,e=this._data.core.last_clicked.id,f=this.get_node(this._data.core.last_clicked.parent).children,g=!1,h,i;for(h=0,i=f.length;i>h;h+=1)f[h]===d&&(g=!g),f[h]===e&&(g=!g),this.is_disabled(f[h])||!g&&f[h]!==d&&f[h]!==e?this.deselect_node(f[h],!0,c):this.is_hidden(f[h])||this.select_node(f[h],!0,!1,c);this.trigger(\"changed\",{action:\"select_node\",node:this.get_node(a),selected:this._data.core.selected,event:c})}else this.is_selected(a)?this.deselect_node(a,!1,c):this.select_node(a,!1,!1,c);else!this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,c):(this.deselect_all(!0),this.select_node(a,!1,!1,c),this._data.core.last_clicked=this.get_node(a));this.trigger(\"activate_node\",{node:this.get_node(a),event:c})},hover_node:function(a){if(a=this.get_node(a,!0),!a||!a.length||a.children(\".jstree-hovered\").length)return!1;var b=this.element.find(\".jstree-hovered\"),c=this.element;b&&b.length&&this.dehover_node(b),a.children(\".jstree-anchor\").addClass(\"jstree-hovered\"),this.trigger(\"hover_node\",{node:this.get_node(a)}),setTimeout(function(){c.attr(\"aria-activedescendant\",a[0].id)},0)},dehover_node:function(a){return a=this.get_node(a,!0),a&&a.length&&a.children(\".jstree-hovered\").length?(a.children(\".jstree-anchor\").removeClass(\"jstree-hovered\"),void this.trigger(\"dehover_node\",{node:this.get_node(a)})):!1},select_node:function(b,c,d,e){var f,g,h,i;if(a.isArray(b)){for(b=b.slice(),g=0,h=b.length;h>g;g++)this.select_node(b[g],c,d,e);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(f=this.get_node(b,!0),void(b.state.selected||(b.state.selected=!0,this._data.core.selected.push(b.id),d||(f=this._open_to(b)),f&&f.length&&f.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(\"jstree-clicked\"),this.trigger(\"select_node\",{node:b,selected:this._data.core.selected,event:e}),c||this.trigger(\"changed\",{action:\"select_node\",node:b,selected:this._data.core.selected,event:e})))):!1},deselect_node:function(b,c,d){var e,f,g;if(a.isArray(b)){for(b=b.slice(),e=0,f=b.length;f>e;e++)this.deselect_node(b[e],c,d);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(g=this.get_node(b,!0),void(b.state.selected&&(b.state.selected=!1,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,b.id),g.length&&g.attr(\"aria-selected\",!1).children(\".jstree-anchor\").removeClass(\"jstree-clicked\"),this.trigger(\"deselect_node\",{node:b,selected:this._data.core.selected,event:d}),c||this.trigger(\"changed\",{action:\"deselect_node\",node:b,selected:this._data.core.selected,event:d})))):!1},select_all:function(b){var c=this._data.core.selected.concat([]),d,e;for(this._data.core.selected=this._model.data[a.jstree.root].children_d.concat(),d=0,e=this._data.core.selected.length;e>d;d++)this._model.data[this._data.core.selected[d]]&&(this._model.data[this._data.core.selected[d]].state.selected=!0);this.redraw(!0),this.trigger(\"select_all\",{selected:this._data.core.selected}),b||this.trigger(\"changed\",{action:\"select_all\",selected:this._data.core.selected,old_selection:c})},deselect_all:function(a){var b=this._data.core.selected.concat([]),c,d;for(c=0,d=this._data.core.selected.length;d>c;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[],this.element.find(\".jstree-clicked\").removeClass(\"jstree-clicked\").parent().attr(\"aria-selected\",!1),this.trigger(\"deselect_all\",{selected:this._data.core.selected,node:b}),a||this.trigger(\"changed\",{action:\"deselect_all\",selected:this._data.core.selected,old_selection:b})},is_selected:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.state.selected:!1},get_selected:function(b){return b?a.map(this._data.core.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(b){var c=this.get_selected(!0),d={},e,f,g,h;for(e=0,f=c.length;f>e;e++)d[c[e].id]=c[e];for(e=0,f=c.length;f>e;e++)for(g=0,h=c[e].children_d.length;h>g;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];c=[];for(e in d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,a.proxy(function(a){return this.get_node(a)},this)):c},get_bottom_selected:function(b){var c=this.get_selected(!0),d=[],e,f;for(e=0,f=c.length;f>e;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,a.proxy(function(a){return this.get_node(a)},this)):d},get_state:function(){var b={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},c;for(c in this._model.data)this._model.data.hasOwnProperty(c)&&c!==a.jstree.root&&(this._model.data[c].state.opened&&b.core.open.push(c),this._model.data[c].state.selected&&b.core.selected.push(c));return b},set_state:function(c,d){if(c){if(c.core){var e,f,g,h,i;if(c.core.open)return a.isArray(c.core.open)&&c.core.open.length?this._load_nodes(c.core.open,function(a){this.open_node(a,!1,0),delete c.core.open,this.set_state(c,d)},!0):(delete c.core.open,this.set_state(c,d)),!1;if(c.core.scroll)return c.core.scroll&&c.core.scroll.left!==b&&this.element.scrollLeft(c.core.scroll.left),c.core.scroll&&c.core.scroll.top!==b&&this.element.scrollTop(c.core.scroll.top),delete c.core.scroll,this.set_state(c,d),!1;if(c.core.selected)return h=this,this.deselect_all(),a.each(c.core.selected,function(a,b){h.select_node(b,!1,!0)}),delete c.core.selected,this.set_state(c,d),!1;for(i in c)c.hasOwnProperty(i)&&\"core\"!==i&&-1===a.inArray(i,this.settings.plugins)&&delete c[i];if(a.isEmptyObject(c.core))return delete c.core,this.set_state(c,d),!1}return a.isEmptyObject(c)?(c=null,d&&d.call(this),this.trigger(\"set_state\"),!1):!0}return!1},refresh:function(b,c){this._data.core.state=c===!0?{}:this.get_state(),c&&a.isFunction(c)&&(this._data.core.state=c.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var d=this.get_container_ul()[0].className;b||(this.element.html(\"<ul class='\"+d+\"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j\"+this._id+\"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>\"+this.get_string(\"Loading ...\")+\"</a></li></ul>\"),this.element.attr(\"aria-activedescendant\",\"j\"+this._id+\"_loading\")),this.load_node(a.jstree.root,function(b,c){c&&(this.get_container_ul()[0].className=d,this._firstChild(this.get_container_ul()[0])&&this.element.attr(\"aria-activedescendant\",this._firstChild(this.get_container_ul()[0]).id),this.set_state(a.extend(!0,{},this._data.core.state),function(){this.trigger(\"refresh\")})),this._data.core.state=null})},refresh_node:function(b){if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;var c=[],d=[],e=this._data.core.selected.concat([]);d.push(b.id),b.state.opened===!0&&c.push(b.id),this.get_node(b,!0).find(\".jstree-open\").each(function(){d.push(this.id),c.push(this.id)}),this._load_nodes(d,a.proxy(function(a){this.open_node(c,!1,0),this.select_node(e),this.trigger(\"refresh_node\",{node:b,nodes:a})},this),!1,!0)},set_id:function(b,c){if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;var d,e,f=this._model.data,g=b.id;for(c=c.toString(),f[b.parent].children[a.inArray(b.id,f[b.parent].children)]=c,d=0,e=b.parents.length;e>d;d++)f[b.parents[d]].children_d[a.inArray(b.id,f[b.parents[d]].children_d)]=c;for(d=0,e=b.children.length;e>d;d++)f[b.children[d]].parent=c;for(d=0,e=b.children_d.length;e>d;d++)f[b.children_d[d]].parents[a.inArray(b.id,f[b.children_d[d]].parents)]=c;return d=a.inArray(b.id,this._data.core.selected),-1!==d&&(this._data.core.selected[d]=c),d=this.get_node(b.id,!0),d&&(d.attr(\"id\",c),this.element.attr(\"aria-activedescendant\")===b.id&&this.element.attr(\"aria-activedescendant\",c)),delete f[b.id],b.id=c,b.li_attr.id=c,f[c]=b,this.trigger(\"set_id\",{node:b,\"new\":b.id,old:g}),!0},get_text:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.text:!1},set_text:function(b,c){var d,e;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.set_text(b[d],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(b.text=c,this.get_node(b,!0).length&&this.redraw_node(b.id),this.trigger(\"set_text\",{obj:b,text:c}),!0):!1},get_json:function(b,c,d){if(b=this.get_node(b||a.jstree.root),!b)return!1;c&&c.flat&&!d&&(d=[]);var e={id:b.id,text:b.text,icon:this.get_icon(b),li_attr:a.extend(!0,{},b.li_attr),a_attr:a.extend(!0,{},b.a_attr),state:{},data:c&&c.no_data?!1:a.extend(!0,{},b.data)},f,g;if(c&&c.flat?e.parent=b.parent:e.children=[],!c||!c.no_state)for(f in b.state)b.state.hasOwnProperty(f)&&(e.state[f]=b.state[f]);if(c&&c.no_id&&(delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id),c&&c.flat&&b.id!==a.jstree.root&&d.push(e),!c||!c.no_children)for(f=0,g=b.children.length;g>f;f++)c&&c.flat?this.get_json(b.children[f],c,d):e.children.push(this.get_json(b.children[f],c));return c&&c.flat?d:b.id===a.jstree.root?e.children:e},create_node:function(c,d,e,f,g){if(null===c&&(c=a.jstree.root),c=this.get_node(c),!c)return!1;if(e=e===b?\"last\":e,!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(c))return this.load_node(c,function(){this.create_node(c,d,e,f,!0)});d||(d={text:this.get_string(\"New node\")}),\"string\"==typeof d&&(d={text:d}),d.text===b&&(d.text=this.get_string(\"New node\"));var h,i,j,k;switch(c.id===a.jstree.root&&(\"before\"===e&&(e=\"first\"),\"after\"===e&&(e=\"last\")),e){case\"before\":h=this.get_node(c.parent),e=a.inArray(c.id,h.children),c=h;break;case\"after\":h=this.get_node(c.parent),e=a.inArray(c.id,h.children)+1,c=h;break;case\"inside\":case\"first\":e=0;break;case\"last\":e=c.children.length;break;default:e||(e=0)}if(e>c.children.length&&(e=c.children.length),d.id||(d.id=!0),!this.check(\"create_node\",d,c,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(d.id===!0&&delete d.id,d=this._parse_model_from_json(d,c.id,c.parents.concat()),!d)return!1;for(h=this.get_node(d),i=[],i.push(d),i=i.concat(h.children_d),this.trigger(\"model\",{nodes:i,parent:c.id}),c.children_d=c.children_d.concat(i),j=0,k=c.parents.length;k>j;j++)this._model.data[c.parents[j]].children_d=this._model.data[c.parents[j]].children_d.concat(i);for(d=h,h=[],j=0,k=c.children.length;k>j;j++)h[j>=e?j+1:j]=c.children[j];return h[e]=d.id,c.children=h,this.redraw_node(c,!0),f&&f.call(this,this.get_node(d)),this.trigger(\"create_node\",{node:this.get_node(d),parent:c.id,position:e}),d.id},rename_node:function(b,c){var d,e,f;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.rename_node(b[d],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(f=b.text,this.check(\"rename_node\",b,this.get_parent(b),c)?(this.set_text(b,c),this.trigger(\"rename_node\",{node:b,text:c,old:f}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(b){var c,d,e,f,g,h,i,j,k,l,m,n;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.delete_node(b[c]);return!0}if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;if(e=this.get_node(b.parent),f=a.inArray(b.id,e.children),l=!1,!this.check(\"delete_node\",b,e,f))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==f&&(e.children=a.vakata.array_remove(e.children,f)),g=b.children_d.concat([]),g.push(b.id),h=0,i=b.parents.length;i>h;h++)this._model.data[b.parents[h]].children_d=a.vakata.array_filter(this._model.data[b.parents[h]].children_d,function(b){return-1===a.inArray(b,g)});for(j=0,k=g.length;k>j;j++)if(this._model.data[g[j]].state.selected){l=!0;break}for(l&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(b){return-1===a.inArray(b,g)})),this.trigger(\"delete_node\",{node:b,parent:e.id}),l&&this.trigger(\"changed\",{action:\"delete_node\",node:b,selected:this._data.core.selected,parent:e.id}),j=0,k=g.length;k>j;j++)delete this._model.data[g[j]];return-1!==a.inArray(this._data.core.focused,g)&&(this._data.core.focused=null,m=this.element[0].scrollTop,n=this.element[0].scrollLeft,e.id===a.jstree.root?this._model.data[a.jstree.root].children[0]&&this.get_node(this._model.data[a.jstree.root].children[0],!0).children(\".jstree-anchor\").focus():this.get_node(e,!0).children(\".jstree-anchor\").focus(),this.element[0].scrollTop=m,this.element[0].scrollLeft=n),this.redraw_node(e,!0),!0},check:function(b,c,d,e,f){c=c&&c.id?c:this.get_node(c),d=d&&d.id?d:this.get_node(d);var g=b.match(/^move_node|copy_node|create_node$/i)?d:c,h=this.settings.core.check_callback;return\"move_node\"!==b||f&&f.is_multi||c.id!==d.id&&(\"move_node\"!==b||a.inArray(c.id,d.children)!==e)&&-1===a.inArray(d.id,c.children_d)?(g&&g.data&&(g=g.data),g&&g.functions&&(g.functions[b]===!1||g.functions[b]===!0)?(g.functions[b]===!1&&(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_02\",reason:\"Node data prevents function: \"+b,data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})}),g.functions[b]):h===!1||a.isFunction(h)&&h.call(this,b,c,d,e,f)===!1||h&&h[b]===!1?(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_03\",reason:\"User config for core.check_callback prevents function: \"+b,data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1):!0):(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_01\",reason:\"Moving parent inside child\",data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(c,d,e,f,!0,!1,i)});if(a.isArray(c)){if(1!==c.length){for(j=0,k=c.length;k>j;j++)(r=this.move_node(c[j],d,e,f,g,!1,i))&&(d=r,e=\"after\");return this.redraw(),!0}c=c[0]}if(c=c&&c.id?c:this.get_node(c),!c||c.id===a.jstree.root)return!1;if(l=(c.parent||a.jstree.root).toString(),n=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,o=i?i:this._model.data[c.id]?this:a.jstree.reference(c.id),p=!o||!o._id||this._id!==o._id,m=o&&o._id&&l&&o._model.data[l]&&o._model.data[l].children?a.inArray(c.id,o._model.data[l].children):-1,o&&o._id&&(c=o._model.data[c.id]),p)return(r=this.copy_node(c,d,e,f,g,!1,i))?(o&&o.delete_node(c),r):!1;switch(d.id===a.jstree.root&&(\"before\"===e&&(e=\"first\"),\"after\"===e&&(e=\"last\")),e){case\"before\":e=a.inArray(d.id,n.children);break;case\"after\":e=a.inArray(d.id,n.children)+1;break;case\"inside\":case\"first\":e=0;break;case\"last\":e=n.children.length;break;default:e||(e=0)}if(e>n.children.length&&(e=n.children.length),!this.check(\"move_node\",c,n,e,{core:!0,origin:i,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(c.parent===n.id){for(q=n.children.concat(),r=a.inArray(c.id,q),-1!==r&&(q=a.vakata.array_remove(q,r),e>r&&e--),r=[],s=0,t=q.length;t>s;s++)r[s>=e?s+1:s]=q[s];r[e]=c.id,n.children=r,this._node_changed(n.id),this.redraw(n.id===a.jstree.root)}else{for(r=c.children_d.concat(),r.push(c.id),s=0,t=c.parents.length;t>s;s++){for(q=[],w=o._model.data[c.parents[s]].children_d,u=0,v=w.length;v>u;u++)-1===a.inArray(w[u],r)&&q.push(w[u]);o._model.data[c.parents[s]].children_d=q}for(o._model.data[l].children=a.vakata.array_remove_item(o._model.data[l].children,c.id),s=0,t=n.parents.length;t>s;s++)this._model.data[n.parents[s]].children_d=this._model.data[n.parents[s]].children_d.concat(r);for(q=[],s=0,t=n.children.length;t>s;s++)q[s>=e?s+1:s]=n.children[s];for(q[e]=c.id,n.children=q,n.children_d.push(c.id),n.children_d=n.children_d.concat(c.children_d),c.parent=n.id,r=n.parents.concat(),r.unshift(n.id),w=c.parents.length,c.parents=r,r=r.concat(),s=0,t=c.children_d.length;t>s;s++)this._model.data[c.children_d[s]].parents=this._model.data[c.children_d[s]].parents.slice(0,-1*w),Array.prototype.push.apply(this._model.data[c.children_d[s]].parents,r);l!==a.jstree.root&&n.id!==a.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(n.id)),h||this.redraw()}return f&&f.call(this,c,n,e),this.trigger(\"move_node\",{node:c,parent:n.id,position:e,old_parent:l,old_position:m,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id,old_instance:o,new_instance:this}),c.id},copy_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(c,d,e,f,!0,!1,i)});if(a.isArray(c)){if(1!==c.length){for(j=0,k=c.length;k>j;j++)(m=this.copy_node(c[j],d,e,f,g,!0,i))&&(d=m,e=\"after\");return this.redraw(),!0}c=c[0]}if(c=c&&c.id?c:this.get_node(c),!c||c.id===a.jstree.root)return!1;switch(q=(c.parent||a.jstree.root).toString(),r=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,s=i?i:this._model.data[c.id]?this:a.jstree.reference(c.id),t=!s||!s._id||this._id!==s._id,s&&s._id&&(c=s._model.data[c.id]),d.id===a.jstree.root&&(\"before\"===e&&(e=\"first\"),\"after\"===e&&(e=\"last\")),e){case\"before\":e=a.inArray(d.id,r.children);break;case\"after\":e=a.inArray(d.id,r.children)+1;break;case\"inside\":case\"first\":e=0;break;case\"last\":e=r.children.length;break;default:e||(e=0)}if(e>r.children.length&&(e=r.children.length),!this.check(\"copy_node\",c,r,e,{core:!0,origin:i,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(p=s?s.get_json(c,{no_id:!0,no_data:!0,no_state:!0}):c,!p)return!1;if(p.id===!0&&delete p.id,p=this._parse_model_from_json(p,r.id,r.parents.concat()),!p)return!1;for(m=this.get_node(p),c&&c.state&&c.state.loaded===!1&&(m.state.loaded=!1),l=[],l.push(p),l=l.concat(m.children_d),this.trigger(\"model\",{nodes:l,parent:r.id}),n=0,o=r.parents.length;o>n;n++)this._model.data[r.parents[n]].children_d=this._model.data[r.parents[n]].children_d.concat(l);for(l=[],n=0,o=r.children.length;o>n;n++)l[n>=e?n+1:n]=r.children[n];return l[e]=m.id,r.children=l,r.children_d.push(m.id),r.children_d=r.children_d.concat(m.children_d),r.id===a.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(r.id),h||this.redraw(r.id===a.jstree.root),f&&f.call(this,m,r,e),this.trigger(\"copy_node\",{node:m,original:c,parent:r.id,position:e,old_parent:q,old_position:s&&s._id&&q&&s._model.data[q]&&s._model.data[q].children?a.inArray(c.id,s._model.data[q].children):-1,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id,old_instance:s,new_instance:this}),m.id},cut:function(b){if(b||(b=this._data.core.selected.concat()),a.isArray(b)||(b=[b]),!b.length)return!1;var c=[],g,h,i;for(h=0,i=b.length;i>h;h++)g=this.get_node(b[h]),g&&g.id&&g.id!==a.jstree.root&&c.push(g);return c.length?(d=c,f=this,e=\"move_node\",void this.trigger(\"cut\",{node:b})):!1},copy:function(b){if(b||(b=this._data.core.selected.concat()),a.isArray(b)||(b=[b]),!b.length)return!1;var c=[],g,h,i;for(h=0,i=b.length;i>h;h++)g=this.get_node(b[h]),g&&g.id&&g.id!==a.jstree.root&&c.push(g);return c.length?(d=c,f=this,e=\"copy_node\",void this.trigger(\"copy\",{node:b})):!1},get_buffer:function(){return{mode:e,node:d,inst:f}},can_paste:function(){return e!==!1&&d!==!1},paste:function(a,b){return a=this.get_node(a),a&&e&&e.match(/^(copy_node|move_node)$/)&&d?(this[e](d,a,b,!1,!1,!1,f)&&this.trigger(\"paste\",{parent:a.id,node:d,mode:e}),d=!1,e=!1,void(f=!1)):!1},clear_buffer:function(){d=!1,e=!1,f=!1,this.trigger(\"clear_buffer\")},edit:function(b,c,d){var e,f,g,h,j,k,l,m,n,o=!1;return(b=this.get_node(b))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_07\",reason:\"Could not edit node because of check_callback\"},this.settings.core.error.call(this,this._data.core.last_error),!1):(n=b,c=\"string\"==typeof c?c:b.text,this.set_text(b,\"\"),b=this._open_to(b),n.text=c,e=this._data.core.rtl,f=this.element.width(),this._data.core.focused=n.id,g=b.children(\".jstree-anchor\").focus(),h=a(\"<span>\"),j=c,k=a(\"<div />\",{css:{position:\"absolute\",top:\"-200px\",left:e?\"0px\":\"-1000px\",visibility:\"hidden\"}}).appendTo(\"body\"),l=a(\"<input />\",{value:j,\"class\":\"jstree-rename-input\",css:{padding:\"0\",border:\"1px solid silver\",\"box-sizing\":\"border-box\",display:\"inline-block\",height:this._data.core.li_height+\"px\",lineHeight:this._data.core.li_height+\"px\",width:\"150px\"},blur:a.proxy(function(c){c.stopImmediatePropagation(),c.preventDefault();var e=h.children(\".jstree-rename-input\"),f=e.val(),i=this.settings.core.force_text,m;\"\"===f&&(f=j),k.remove(),h.replaceWith(g),h.remove(),j=i?j:a(\"<div></div>\").append(a.parseHTML(j)).html(),this.set_text(b,j),m=!!this.rename_node(b,i?a(\"<div></div>\").text(f).text():a(\"<div></div>\").append(a.parseHTML(f)).html()),m||this.set_text(b,j),this._data.core.focused=n.id,setTimeout(a.proxy(function(){var a=this.get_node(n.id,!0);a.length&&(this._data.core.focused=n.id,a.children(\".jstree-anchor\").focus())},this),0),d&&d.call(this,n,m,o),l=null},this),keydown:function(a){var b=a.which;27===b&&(o=!0,this.value=j),27!==b&&13!==b&&37!==b&&38!==b&&39!==b&&40!==b&&32!==b||a.stopImmediatePropagation(),27!==b&&13!==b||(a.preventDefault(),this.blur())},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(k.text(\"pW\"+this.value).width(),f))},keypress:function(a){return 13===a.which?!1:void 0}}),m={fontFamily:g.css(\"fontFamily\")||\"\",fontSize:g.css(\"fontSize\")||\"\",fontWeight:g.css(\"fontWeight\")||\"\",fontStyle:g.css(\"fontStyle\")||\"\",fontStretch:g.css(\"fontStretch\")||\"\",fontVariant:g.css(\"fontVariant\")||\"\",letterSpacing:g.css(\"letterSpacing\")||\"\",wordSpacing:g.css(\"wordSpacing\")||\"\"},h.attr(\"class\",g.attr(\"class\")).append(g.contents().clone()).append(l),g.replaceWith(h),k.css(m),l.css(m).width(Math.min(k.text(\"pW\"+l[0].value).width(),f))[0].select(),void a(i).one(\"mousedown.jstree touchstart.jstree dnd_start.vakata\",function(b){\nl&&b.target!==l&&a(l).blur()})):!1},set_theme:function(b,c){if(!b)return!1;if(c===!0){var d=this.settings.core.themes.dir;d||(d=a.jstree.path+\"/themes\"),c=d+\"/\"+b+\"/style.css\"}c&&-1===a.inArray(c,g)&&(a(\"head\").append('<link rel=\"stylesheet\" href=\"'+c+'\" type=\"text/css\" />'),g.push(c)),this._data.core.themes.name&&this.element.removeClass(\"jstree-\"+this._data.core.themes.name),this._data.core.themes.name=b,this.element.addClass(\"jstree-\"+b),this.element[this.settings.core.themes.responsive?\"addClass\":\"removeClass\"](\"jstree-\"+b+\"-responsive\"),this.trigger(\"set_theme\",{theme:b})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass(\"jstree-\"+this._data.core.themes.name+\"-\"+this._data.core.themes.variant),this._data.core.themes.variant=a,a&&this.element.addClass(\"jstree-\"+this._data.core.themes.name+\"-\"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass(\"jstree-striped\")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass(\"jstree-striped\")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass(\"jstree-no-dots\")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass(\"jstree-no-dots\")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass(\"jstree-no-icons\")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass(\"jstree-no-icons\")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(c,d){var e,f,g,h;if(a.isArray(c)){for(c=c.slice(),e=0,f=c.length;f>e;e++)this.set_icon(c[e],d);return!0}return c=this.get_node(c),c&&c.id!==a.jstree.root?(h=c.icon,c.icon=d===!0||null===d||d===b||\"\"===d?!0:d,g=this.get_node(c,!0).children(\".jstree-anchor\").children(\".jstree-themeicon\"),d===!1?this.hide_icon(c):d===!0||null===d||d===b||\"\"===d?(g.removeClass(\"jstree-themeicon-custom \"+h).css(\"background\",\"\").removeAttr(\"rel\"),h===!1&&this.show_icon(c)):-1===d.indexOf(\"/\")&&-1===d.indexOf(\".\")?(g.removeClass(h).css(\"background\",\"\"),g.addClass(d+\" jstree-themeicon-custom\").attr(\"rel\",d),h===!1&&this.show_icon(c)):(g.removeClass(h).css(\"background\",\"\"),g.addClass(\"jstree-themeicon-custom\").css(\"background\",\"url('\"+d+\"') center center no-repeat\").attr(\"rel\",d),h===!1&&this.show_icon(c)),!0):!1},get_icon:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.icon:!1},hide_icon:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.hide_icon(b[c]);return!0}return b=this.get_node(b),b&&b!==a.jstree.root?(b.icon=!1,this.get_node(b,!0).children(\".jstree-anchor\").children(\".jstree-themeicon\").addClass(\"jstree-themeicon-hidden\"),!0):!1},show_icon:function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.show_icon(b[c]);return!0}return b=this.get_node(b),b&&b!==a.jstree.root?(e=this.get_node(b,!0),b.icon=e.length?e.children(\".jstree-anchor\").children(\".jstree-themeicon\").attr(\"rel\"):!0,b.icon||(b.icon=!0),e.children(\".jstree-anchor\").children(\".jstree-themeicon\").removeClass(\"jstree-themeicon-hidden\"),!0):!1}},a.vakata={},a.vakata.attributes=function(b,c){b=a(b)[0];var d=c?{}:[];return b&&b.attributes&&a.each(b.attributes,function(b,e){-1===a.inArray(e.name.toLowerCase(),[\"style\",\"contenteditable\",\"hasfocus\",\"tabindex\"])&&null!==e.value&&\"\"!==a.trim(e.value)&&(c?d[e.name]=e.value:d.push(e.name))}),d},a.vakata.array_unique=function(a){var c=[],d,e,f,g={};for(d=0,f=a.length;f>d;d++)g[a[d]]===b&&(c.push(a[d]),g[a[d]]=!0);return c},a.vakata.array_remove=function(a,b){return a.splice(b,1),a},a.vakata.array_remove_item=function(b,c){var d=a.inArray(c,b);return-1!==d?a.vakata.array_remove(b,d):b},a.vakata.array_filter=function(a,b,c,d,e){if(a.filter)return a.filter(b,c);d=[];for(e in a)~~e+\"\"==e+\"\"&&e>=0&&b.call(c,a[e],+e,a)&&d.push(a[e]);return d},a.jstree.plugins.changed=function(a,b){var c=[];this.trigger=function(a,d){var e,f;if(d||(d={}),\"changed\"===a.replace(\".jstree\",\"\")){d.changed={selected:[],deselected:[]};var g={};for(e=0,f=c.length;f>e;e++)g[c[e]]=1;for(e=0,f=d.selected.length;f>e;e++)g[d.selected[e]]?g[d.selected[e]]=2:d.changed.selected.push(d.selected[e]);for(e=0,f=c.length;f>e;e++)1===g[c[e]]&&d.changed.deselected.push(c[e]);c=d.selected.slice()}b.trigger.call(this,a,d)},this.refresh=function(a,d){return c=[],b.refresh.apply(this,arguments)}};var m=i.createElement(\"I\");m.className=\"jstree-icon jstree-checkbox\",m.setAttribute(\"role\",\"presentation\"),a.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:\"\",tie_selection:!0},a.jstree.plugins.checkbox=function(c,d){this.bind=function(){d.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade=\"up+down+undetermined\"),this.element.on(\"init.jstree\",a.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass(\"jstree-checkbox-no-clicked\"),this.settings.checkbox.tie_selection&&this.element.addClass(\"jstree-checkbox-selection\")},this)).on(\"loading.jstree\",a.proxy(function(){this[this._data.checkbox.visible?\"show_checkboxes\":\"hide_checkboxes\"]()},this)),-1!==this.settings.checkbox.cascade.indexOf(\"undetermined\")&&this.element.on(\"changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree\",a.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on(\"model.jstree\",a.proxy(function(a,b){var c=this._model.data,d=c[b.parent],e=b.nodes,f,g;for(f=0,g=e.length;g>f;f++)c[e[f]].state.checked=c[e[f]].state.checked||c[e[f]].original&&c[e[f]].original.state&&c[e[f]].original.state.checked,c[e[f]].state.checked&&this._data.checkbox.selected.push(e[f])},this)),-1===this.settings.checkbox.cascade.indexOf(\"up\")&&-1===this.settings.checkbox.cascade.indexOf(\"down\")||this.element.on(\"model.jstree\",a.proxy(function(b,c){var d=this._model.data,e=d[c.parent],f=c.nodes,g=[],h,i,j,k,l,m,n=this.settings.checkbox.cascade,o=this.settings.checkbox.tie_selection;if(-1!==n.indexOf(\"down\"))if(e.state[o?\"selected\":\"checked\"]){for(i=0,j=f.length;j>i;i++)d[f[i]].state[o?\"selected\":\"checked\"]=!0;this._data[o?\"core\":\"checkbox\"].selected=this._data[o?\"core\":\"checkbox\"].selected.concat(f)}else for(i=0,j=f.length;j>i;i++)if(d[f[i]].state[o?\"selected\":\"checked\"]){for(k=0,l=d[f[i]].children_d.length;l>k;k++)d[d[f[i]].children_d[k]].state[o?\"selected\":\"checked\"]=!0;this._data[o?\"core\":\"checkbox\"].selected=this._data[o?\"core\":\"checkbox\"].selected.concat(d[f[i]].children_d)}if(-1!==n.indexOf(\"up\")){for(i=0,j=e.children_d.length;j>i;i++)d[e.children_d[i]].children.length||g.push(d[e.children_d[i]].parent);for(g=a.vakata.array_unique(g),k=0,l=g.length;l>k;k++){e=d[g[k]];while(e&&e.id!==a.jstree.root){for(h=0,i=0,j=e.children.length;j>i;i++)h+=d[e.children[i]].state[o?\"selected\":\"checked\"];if(h!==j)break;e.state[o?\"selected\":\"checked\"]=!0,this._data[o?\"core\":\"checkbox\"].selected.push(e.id),m=this.get_node(e,!0),m&&m.length&&m.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(o?\"jstree-clicked\":\"jstree-checked\"),e=this.get_node(e.parent)}}}this._data[o?\"core\":\"checkbox\"].selected=a.vakata.array_unique(this._data[o?\"core\":\"checkbox\"].selected)},this)).on(this.settings.checkbox.tie_selection?\"select_node.jstree\":\"check_node.jstree\",a.proxy(function(b,c){var d=c.node,e=this._model.data,f=this.get_node(d.parent),g=this.get_node(d,!0),h,i,j,k,l=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection,n={},o=this._data[m?\"core\":\"checkbox\"].selected;for(h=0,i=o.length;i>h;h++)n[o[h]]=!0;if(-1!==l.indexOf(\"down\"))for(h=0,i=d.children_d.length;i>h;h++)n[d.children_d[h]]=!0,k=e[d.children_d[h]],k.state[m?\"selected\":\"checked\"]=!0,k&&k.original&&k.original.state&&k.original.state.undetermined&&(k.original.state.undetermined=!1);if(-1!==l.indexOf(\"up\"))while(f&&f.id!==a.jstree.root){for(j=0,h=0,i=f.children.length;i>h;h++)j+=e[f.children[h]].state[m?\"selected\":\"checked\"];if(j!==i)break;f.state[m?\"selected\":\"checked\"]=!0,n[f.id]=!0,k=this.get_node(f,!0),k&&k.length&&k.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\"),f=this.get_node(f.parent)}o=[];for(h in n)n.hasOwnProperty(h)&&o.push(h);this._data[m?\"core\":\"checkbox\"].selected=o,-1!==l.indexOf(\"down\")&&g.length&&g.find(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\").parent().attr(\"aria-selected\",!0)},this)).on(this.settings.checkbox.tie_selection?\"deselect_all.jstree\":\"uncheck_all.jstree\",a.proxy(function(b,c){var d=this.get_node(a.jstree.root),e=this._model.data,f,g,h;for(f=0,g=d.children_d.length;g>f;f++)h=e[d.children_d[f]],h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?\"deselect_node.jstree\":\"uncheck_node.jstree\",a.proxy(function(b,c){var d=c.node,e=this.get_node(d,!0),f,g,h,i=this.settings.checkbox.cascade,j=this.settings.checkbox.tie_selection,k=this._data[j?\"core\":\"checkbox\"].selected,l={};if(d&&d.original&&d.original.state&&d.original.state.undetermined&&(d.original.state.undetermined=!1),-1!==i.indexOf(\"down\"))for(f=0,g=d.children_d.length;g>f;f++)h=this._model.data[d.children_d[f]],h.state[j?\"selected\":\"checked\"]=!1,h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1);if(-1!==i.indexOf(\"up\"))for(f=0,g=d.parents.length;g>f;f++)h=this._model.data[d.parents[f]],h.state[j?\"selected\":\"checked\"]=!1,h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1),h=this.get_node(d.parents[f],!0),h&&h.length&&h.attr(\"aria-selected\",!1).children(\".jstree-anchor\").removeClass(j?\"jstree-clicked\":\"jstree-checked\");for(l={},f=0,g=k.length;g>f;f++)-1!==i.indexOf(\"down\")&&-1!==a.inArray(k[f],d.children_d)||-1!==i.indexOf(\"up\")&&-1!==a.inArray(k[f],d.parents)||(l[k[f]]=!0);k=[];for(f in l)l.hasOwnProperty(f)&&k.push(f);this._data[j?\"core\":\"checkbox\"].selected=k,-1!==i.indexOf(\"down\")&&e.length&&e.find(\".jstree-anchor\").removeClass(j?\"jstree-clicked\":\"jstree-checked\").parent().attr(\"aria-selected\",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf(\"up\")&&this.element.on(\"delete_node.jstree\",a.proxy(function(b,c){var d=this.get_node(c.parent),e=this._model.data,f,g,h,i,j=this.settings.checkbox.tie_selection;while(d&&d.id!==a.jstree.root&&!d.state[j?\"selected\":\"checked\"]){for(h=0,f=0,g=d.children.length;g>f;f++)h+=e[d.children[f]].state[j?\"selected\":\"checked\"];if(!(g>0&&h===g))break;d.state[j?\"selected\":\"checked\"]=!0,this._data[j?\"core\":\"checkbox\"].selected.push(d.id),i=this.get_node(d,!0),i&&i.length&&i.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(j?\"jstree-clicked\":\"jstree-checked\"),d=this.get_node(d.parent)}},this)).on(\"move_node.jstree\",a.proxy(function(b,c){var d=c.is_multi,e=c.old_parent,f=this.get_node(c.parent),g=this._model.data,h,i,j,k,l,m=this.settings.checkbox.tie_selection;if(!d){h=this.get_node(e);while(h&&h.id!==a.jstree.root&&!h.state[m?\"selected\":\"checked\"]){for(i=0,j=0,k=h.children.length;k>j;j++)i+=g[h.children[j]].state[m?\"selected\":\"checked\"];if(!(k>0&&i===k))break;h.state[m?\"selected\":\"checked\"]=!0,this._data[m?\"core\":\"checkbox\"].selected.push(h.id),l=this.get_node(h,!0),l&&l.length&&l.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\"),h=this.get_node(h.parent)}}h=f;while(h&&h.id!==a.jstree.root){for(i=0,j=0,k=h.children.length;k>j;j++)i+=g[h.children[j]].state[m?\"selected\":\"checked\"];if(i===k)h.state[m?\"selected\":\"checked\"]||(h.state[m?\"selected\":\"checked\"]=!0,this._data[m?\"core\":\"checkbox\"].selected.push(h.id),l=this.get_node(h,!0),l&&l.length&&l.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\"));else{if(!h.state[m?\"selected\":\"checked\"])break;h.state[m?\"selected\":\"checked\"]=!1,this._data[m?\"core\":\"checkbox\"].selected=a.vakata.array_remove_item(this._data[m?\"core\":\"checkbox\"].selected,h.id),l=this.get_node(h,!0),l&&l.length&&l.attr(\"aria-selected\",!1).children(\".jstree-anchor\").removeClass(m?\"jstree-clicked\":\"jstree-checked\")}h=this.get_node(h.parent)}},this))},this._undetermined=function(){if(null!==this.element){var c,d,e,f,g={},h=this._model.data,i=this.settings.checkbox.tie_selection,j=this._data[i?\"core\":\"checkbox\"].selected,k=[],l=this;for(c=0,d=j.length;d>c;c++)if(h[j[c]]&&h[j[c]].parents)for(e=0,f=h[j[c]].parents.length;f>e;e++){if(g[h[j[c]].parents[e]]!==b)break;h[j[c]].parents[e]!==a.jstree.root&&(g[h[j[c]].parents[e]]=!0,k.push(h[j[c]].parents[e]))}for(this.element.find(\".jstree-closed\").not(\":has(.jstree-children)\").each(function(){var i=l.get_node(this),j;if(i.state.loaded){for(c=0,d=i.children_d.length;d>c;c++)if(j=h[i.children_d[c]],!j.state.loaded&&j.original&&j.original.state&&j.original.state.undetermined&&j.original.state.undetermined===!0)for(g[j.id]===b&&j.id!==a.jstree.root&&(g[j.id]=!0,k.push(j.id)),e=0,f=j.parents.length;f>e;e++)g[j.parents[e]]===b&&j.parents[e]!==a.jstree.root&&(g[j.parents[e]]=!0,k.push(j.parents[e]))}else if(i.original&&i.original.state&&i.original.state.undetermined&&i.original.state.undetermined===!0)for(g[i.id]===b&&i.id!==a.jstree.root&&(g[i.id]=!0,k.push(i.id)),e=0,f=i.parents.length;f>e;e++)g[i.parents[e]]===b&&i.parents[e]!==a.jstree.root&&(g[i.parents[e]]=!0,k.push(i.parents[e]))}),this.element.find(\".jstree-undetermined\").removeClass(\"jstree-undetermined\"),c=0,d=k.length;d>c;c++)h[k[c]].state[i?\"selected\":\"checked\"]||(j=this.get_node(k[c],!0),j&&j.length&&j.children(\".jstree-anchor\").children(\".jstree-checkbox\").addClass(\"jstree-undetermined\"))}},this.redraw_node=function(b,c,e,f){if(b=d.redraw_node.apply(this,arguments)){var g,h,i=null,j=null;for(g=0,h=b.childNodes.length;h>g;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf(\"jstree-anchor\")){i=b.childNodes[g];break}i&&(!this.settings.checkbox.tie_selection&&this._model.data[b.id].state.checked&&(i.className+=\" jstree-checked\"),j=m.cloneNode(!1),this._model.data[b.id].state.checkbox_disabled&&(j.className+=\" jstree-checkbox-disabled\"),i.insertBefore(j,i.childNodes[0]))}return e||-1===this.settings.checkbox.cascade.indexOf(\"undetermined\")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)),b},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass(\"jstree-no-checkboxes\")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass(\"jstree-no-checkboxes\")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(b){b=this.get_node(b);var c=this.settings.checkbox.cascade,d,e,f=this.settings.checkbox.tie_selection,g=this._data[f?\"core\":\"checkbox\"].selected,h=this._model.data;if(!b||b.state[f?\"selected\":\"checked\"]===!0||-1===c.indexOf(\"undetermined\")||-1===c.indexOf(\"down\")&&-1===c.indexOf(\"up\"))return!1;if(!b.state.loaded&&b.original.state.undetermined===!0)return!0;for(d=0,e=b.children_d.length;e>d;d++)if(-1!==a.inArray(b.children_d[d],g)||!h[b.children_d[d]].state.loaded&&h[b.children_d[d]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.disable_checkbox(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(e=this.get_node(b,!0),void(b.state.checkbox_disabled||(b.state.checkbox_disabled=!0,e&&e.length&&e.children(\".jstree-anchor\").children(\".jstree-checkbox\").addClass(\"jstree-checkbox-disabled\"),this.trigger(\"disable_checkbox\",{node:b})))):!1},this.enable_checkbox=function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.enable_checkbox(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(e=this.get_node(b,!0),void(b.state.checkbox_disabled&&(b.state.checkbox_disabled=!1,e&&e.length&&e.children(\".jstree-anchor\").children(\".jstree-checkbox\").removeClass(\"jstree-checkbox-disabled\"),this.trigger(\"enable_checkbox\",{node:b})))):!1},this.activate_node=function(b,c){return a(c.target).hasClass(\"jstree-checkbox-disabled\")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||a(c.target).hasClass(\"jstree-checkbox\"))&&(c.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!a(c.target).hasClass(\"jstree-checkbox\")?d.activate_node.call(this,b,c):this.is_disabled(b)?!1:(this.is_checked(b)?this.uncheck_node(b,c):this.check_node(b,c),void this.trigger(\"activate_node\",{node:this.get_node(b)})))},this.check_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.select_node(b,!1,!0,c);var d,e,f,g;if(a.isArray(b)){for(b=b.slice(),e=0,f=b.length;f>e;e++)this.check_node(b[e],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(d=this.get_node(b,!0),void(b.state.checked||(b.state.checked=!0,this._data.checkbox.selected.push(b.id),d&&d.length&&d.children(\".jstree-anchor\").addClass(\"jstree-checked\"),this.trigger(\"check_node\",{node:b,selected:this._data.checkbox.selected,event:c})))):!1},this.uncheck_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.deselect_node(b,!1,c);var d,e,f;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.uncheck_node(b[d],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(f=this.get_node(b,!0),void(b.state.checked&&(b.state.checked=!1,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,b.id),f.length&&f.children(\".jstree-anchor\").removeClass(\"jstree-checked\"),this.trigger(\"uncheck_node\",{node:b,selected:this._data.checkbox.selected,event:c})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var b=this._data.checkbox.selected.concat([]),c,d;for(this._data.checkbox.selected=this._model.data[a.jstree.root].children_d.concat(),c=0,d=this._data.checkbox.selected.length;d>c;c++)this._model.data[this._data.checkbox.selected[c]]&&(this._model.data[this._data.checkbox.selected[c]].state.checked=!0);this.redraw(!0),this.trigger(\"check_all\",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var a=this._data.checkbox.selected.concat([]),b,c;for(b=0,c=this._data.checkbox.selected.length;c>b;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(\".jstree-checked\").removeClass(\"jstree-checked\"),this.trigger(\"uncheck_all\",{selected:this._data.checkbox.selected,node:a})},this.is_checked=function(b){return this.settings.checkbox.tie_selection?this.is_selected(b):(b=this.get_node(b),b&&b.id!==a.jstree.root?b.state.checked:!1)},this.get_checked=function(b){return this.settings.checkbox.tie_selection?this.get_selected(b):b?a.map(this._data.checkbox.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected},this.get_top_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_top_selected(b);var c=this.get_checked(!0),d={},e,f,g,h;for(e=0,f=c.length;f>e;e++)d[c[e].id]=c[e];for(e=0,f=c.length;f>e;e++)for(g=0,h=c[e].children_d.length;h>g;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];c=[];for(e in d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,a.proxy(function(a){return this.get_node(a)},this)):c},this.get_bottom_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(b);var c=this.get_checked(!0),d=[],e,f;for(e=0,f=c.length;f>e;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,a.proxy(function(a){return this.get_node(a)},this)):d},this.load_node=function(b,c){var e,f,g,h,i,j;if(!a.isArray(b)&&!this.settings.checkbox.tie_selection&&(j=this.get_node(b),j&&j.state.loaded))for(e=0,f=j.children_d.length;f>e;e++)this._model.data[j.children_d[e]].state.checked&&(i=!0,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,j.children_d[e]));return d.load_node.apply(this,arguments)},this.get_state=function(){var a=d.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?a:(a.checkbox=this._data.checkbox.selected.slice(),a)},this.set_state=function(b,c){var e=d.set_state.apply(this,arguments);if(e&&b.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var f=this;a.each(b.checkbox,function(a,b){f.check_node(b)})}return delete b.checkbox,this.set_state(b,c),!1}return e},this.refresh=function(a,b){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),d.refresh.apply(this,arguments)}},a.jstree.defaults.conditionalselect=function(){return!0},a.jstree.plugins.conditionalselect=function(a,b){this.activate_node=function(a,c){this.settings.conditionalselect.call(this,this.get_node(a),c)&&b.activate_node.call(this,a,c)}},a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(b,c){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:\"Create\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.create_node(d,{},\"last\",function(a){setTimeout(function(){c.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:\"Rename\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.edit(d)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:\"Delete\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.delete_node(c.get_selected()):c.delete_node(d)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:\"Edit\",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:\"Cut\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.cut(c.get_top_selected()):c.cut(d)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:\"Copy\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.copy(c.get_top_selected()):c.copy(d)}},paste:{separator_before:!1,icon:!1,_disabled:function(b){return!a.jstree.reference(b.reference).can_paste()},separator_after:!1,label:\"Paste\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.paste(d)}}}}}}},a.jstree.plugins.contextmenu=function(c,d){this.bind=function(){d.bind.call(this);var b=0,c=null,e,f;this.element.on(\"contextmenu.jstree\",\".jstree-anchor\",a.proxy(function(a,d){a.preventDefault(),b=a.ctrlKey?+new Date:0,(d||c)&&(b=+new Date+1e4),c&&clearTimeout(c),this.is_loading(a.currentTarget)||this.show_contextmenu(a.currentTarget,a.pageX,a.pageY,a)},this)).on(\"click.jstree\",\".jstree-anchor\",a.proxy(function(c){this._data.contextmenu.visible&&(!b||+new Date-b>250)&&a.vakata.context.hide(),b=0},this)).on(\"touchstart.jstree\",\".jstree-anchor\",function(b){b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(e=b.pageX,f=b.pageY,c=setTimeout(function(){a(b.currentTarget).trigger(\"contextmenu\",!0)},750))}).on(\"touchmove.vakata.jstree\",function(a){c&&a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(Math.abs(e-a.pageX)>50||Math.abs(f-a.pageY)>50)&&clearTimeout(c)}).on(\"touchend.vakata.jstree\",function(a){c&&clearTimeout(c)}),a(i).on(\"context_hide.vakata.jstree\",a.proxy(function(a,b){this._data.contextmenu.visible=!1,b.reference.removeClass(\"jstree-context\")},this))},this.teardown=function(){this._data.contextmenu.visible&&a.vakata.context.hide(),d.teardown.call(this)},this.show_contextmenu=function(c,d,e,f){if(c=this.get_node(c),!c||c.id===a.jstree.root)return!1;var g=this.settings.contextmenu,h=this.get_node(c,!0),i=h.children(\".jstree-anchor\"),j=!1,k=!1;(g.show_at_node||d===b||e===b)&&(j=i.offset(),d=j.left,e=j.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(c)&&this.activate_node(c,f),k=g.items,a.isFunction(k)&&(k=k.call(this,c,a.proxy(function(a){this._show_contextmenu(c,d,e,a)},this))),a.isPlainObject(k)&&this._show_contextmenu(c,d,e,k)},this._show_contextmenu=function(b,c,d,e){var f=this.get_node(b,!0),g=f.children(\".jstree-anchor\");a(i).one(\"context_show.vakata.jstree\",a.proxy(function(b,c){var d=\"jstree-contextmenu jstree-\"+this.get_theme()+\"-contextmenu\";a(c.element).addClass(d),g.addClass(\"jstree-context\")},this)),this._data.contextmenu.visible=!0,a.vakata.context.show(g,{x:c,y:d},e),this.trigger(\"show_contextmenu\",{node:b,x:c,y:d})}},function(a){var b=!1,c={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:\"\",is_visible:!1};a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(i).triggerHandler(\"context_\"+b+\".vakata\",{reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}})},_execute:function(b){return b=c.items[b],b&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:c.reference,element:c.element}))&&b.action?b.action.call(null,{item:b,reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}}):!1},_parse:function(b,d){if(!b)return!1;d||(c.html=\"\",c.items=[]);var e=\"\",f=!1,g;return d&&(e+=\"<ul>\"),a.each(b,function(b,d){return d?(c.items.push(d),!f&&d.separator_before&&(e+=\"<li class='vakata-context-separator'><a href='#' \"+(a.vakata.context.settings.icons?\"\":'style=\"margin-left:0px;\"')+\">&#160;</a></li>\"),f=!1,e+=\"<li class='\"+(d._class||\"\")+(d._disabled===!0||a.isFunction(d._disabled)&&d._disabled({item:d,reference:c.reference,element:c.element})?\" vakata-contextmenu-disabled \":\"\")+\"' \"+(d.shortcut?\" data-shortcut='\"+d.shortcut+\"' \":\"\")+\">\",e+=\"<a href='#' rel='\"+(c.items.length-1)+\"'>\",a.vakata.context.settings.icons&&(e+=\"<i \",d.icon&&(e+=-1!==d.icon.indexOf(\"/\")||-1!==d.icon.indexOf(\".\")?\" style='background:url(\\\"\"+d.icon+\"\\\") center center no-repeat' \":\" class='\"+d.icon+\"' \"),e+=\"></i><span class='vakata-contextmenu-sep'>&#160;</span>\"),e+=(a.isFunction(d.label)?d.label({item:b,reference:c.reference,element:c.element}):d.label)+(d.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+d.shortcut+'\">'+(d.shortcut_label||\"\")+\"</span>\":\"\")+\"</a>\",d.submenu&&(g=a.vakata.context._parse(d.submenu,!0),g&&(e+=g)),e+=\"</li>\",void(d.separator_after&&(e+=\"<li class='vakata-context-separator'><a href='#' \"+(a.vakata.context.settings.icons?\"\":'style=\"margin-left:0px;\"')+\">&#160;</a></li>\",f=!0))):!0}),e=e.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\"),d&&(e+=\"</ul>\"),d||(c.html=e,a.vakata.context._trigger(\"parse\")),e.length>10?e:!1},_show_submenu:function(c){if(c=a(c),c.length&&c.children(\"ul\").length){var d=c.children(\"ul\"),e=c.offset().left,f=e+c.outerWidth(),g=c.offset().top,h=d.width(),i=d.height(),j=a(window).width()+a(window).scrollLeft(),k=a(window).height()+a(window).scrollTop();b?c[f-(h+10+c.outerWidth())<0?\"addClass\":\"removeClass\"](\"vakata-context-left\"):c[f+h>j&&e>j-f?\"addClass\":\"removeClass\"](\"vakata-context-right\"),g+i+10>k&&d.css(\"bottom\",\"-1px\"),c.hasClass(\"vakata-context-right\")?h>e&&d.css(\"margin-right\",e-h):h>j-f&&d.css(\"margin-left\",j-f-h),d.show()}},show:function(d,e,f){var g,h,i,j,k,l,m,n,o=!0;switch(c.element&&c.element.length&&c.element.width(\"\"),o){case!e&&!d:return!1;case!!e&&!!d:c.reference=d,c.position_x=e.x,c.position_y=e.y;break;case!e&&!!d:c.reference=d,g=d.offset(),c.position_x=g.left+d.outerHeight(),c.position_y=g.top;break;case!!e&&!d:c.position_x=e.x,c.position_y=e.y}d&&!f&&a(d).data(\"vakata_contextmenu\")&&(f=a(d).data(\"vakata_contextmenu\")),a.vakata.context._parse(f)&&c.element.html(c.html),c.items.length&&(c.element.appendTo(\"body\"),h=c.element,i=c.position_x,j=c.position_y,k=h.width(),l=h.height(),m=a(window).width()+a(window).scrollLeft(),n=a(window).height()+a(window).scrollTop(),b&&(i-=h.outerWidth()-a(d).outerWidth(),i<a(window).scrollLeft()+20&&(i=a(window).scrollLeft()+20)),i+k+20>m&&(i=m-(k+20)),j+l+20>n&&(j=n-(l+20)),c.element.css({left:i,top:j}).show().find(\"a\").first().focus().parent().addClass(\"vakata-context-hover\"),c.is_visible=!0,a.vakata.context._trigger(\"show\"))},hide:function(){c.is_visible&&(c.element.hide().find(\"ul\").hide().end().find(\":focus\").blur().end().detach(),c.is_visible=!1,a.vakata.context._trigger(\"hide\"))}},a(function(){b=\"rtl\"===a(\"body\").css(\"direction\");var d=!1;c.element=a(\"<ul class='vakata-context'></ul>\"),c.element.on(\"mouseenter\",\"li\",function(b){b.stopImmediatePropagation(),a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.element.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end(),a(this).siblings().find(\"ul\").hide().end().end().parentsUntil(\".vakata-context\",\"li\").addBack().addClass(\"vakata-context-hover\"),a.vakata.context._show_submenu(this))}).on(\"mouseleave\",\"li\",function(b){a.contains(this,b.relatedTarget)||a(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\")}).on(\"mouseleave\",function(b){a(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\"),a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(b){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on(\"click\",\"a\",function(b){b.preventDefault(),a(this).blur().parent().hasClass(\"vakata-context-disabled\")||a.vakata.context._execute(a(this).attr(\"rel\"))===!1||a.vakata.context.hide()}).on(\"keydown\",\"a\",function(b){var d=null;switch(b.which){case 13:case 32:b.type=\"mouseup\",b.preventDefault(),a(b.currentTarget).trigger(b);break;case 37:c.is_visible&&(c.element.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:c.is_visible&&(d=c.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first(),d.length||(d=c.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last()),d.addClass(\"vakata-context-hover\").children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:c.is_visible&&(c.element.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:c.is_visible&&(d=c.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first(),d.length||(d=c.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first()),d.addClass(\"vakata-context-hover\").children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on(\"keydown\",function(a){a.preventDefault();var b=c.element.find(\".vakata-contextmenu-shortcut-\"+a.which).parent();b.parent().not(\".vakata-context-disabled\")&&b.click()}),a(i).on(\"mousedown.vakata.jstree\",function(b){c.is_visible&&!a.contains(c.element[0],b.target)&&a.vakata.context.hide();\n}).on(\"context_show.vakata.jstree\",function(a,d){c.element.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\"),b&&c.element.addClass(\"vakata-context-rtl\").css(\"direction\",\"rtl\"),c.element.find(\"ul\").hide().end()})})}(a),a.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var n,o;a.jstree.plugins.dnd=function(b,c){this.init=function(a,b){c.init.call(this,a,b),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&\"draggable\"in i.createElement(\"span\")},this.bind=function(){c.bind.call(this),this.element.on(this.settings.dnd.use_html5?\"dragstart.jstree\":\"mousedown.jstree touchstart.jstree\",this.settings.dnd.large_drag_target?\".jstree-node\":\".jstree-anchor\",a.proxy(function(b){if(this.settings.dnd.large_drag_target&&a(b.target).closest(\".jstree-node\")[0]!==b.currentTarget)return!0;if(\"touchstart\"===b.type&&(!this.settings.dnd.touch||\"selected\"===this.settings.dnd.touch&&!a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").hasClass(\"jstree-clicked\")))return!0;var c=this.get_node(b.target),d=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,e=d>1?d+\" \"+this.get_string(\"nodes\"):this.get_text(b.currentTarget);if(this.settings.core.force_text&&(e=a.vakata.html.escape(e)),c&&c.id&&c.id!==a.jstree.root&&(1===b.which||\"touchstart\"===b.type||\"dragstart\"===b.type)&&(this.settings.dnd.is_draggable===!0||a.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,d>1?this.get_top_selected(!0):[c],b))){if(n={jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:d>1?this.get_top_selected():[c.id]},o=b.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger(\"mousedown.jstree\"),a.vakata.dnd.start(b,n,'<div id=\"jstree-dnd\" class=\"jstree-'+this.get_theme()+\" jstree-\"+this.get_theme()+\"-\"+this.get_theme_variant()+\" \"+(this.settings.core.themes.responsive?\" jstree-dnd-responsive\":\"\")+'\"><i class=\"jstree-icon jstree-er\"></i>'+e+'<ins class=\"jstree-copy\" style=\"display:none;\">+</ins></div>');a.vakata.dnd._trigger(\"start\",b,{helper:a(),element:o,data:n})}},this)),this.settings.dnd.use_html5&&this.element.on(\"dragover.jstree\",function(b){return b.preventDefault(),a.vakata.dnd._trigger(\"move\",b,{helper:a(),element:o,data:n}),!1}).on(\"drop.jstree\",a.proxy(function(b){return b.preventDefault(),a.vakata.dnd._trigger(\"stop\",b,{helper:a(),element:o,data:n}),!1},this))},this.redraw_node=function(a,b,d,e){if(a=c.redraw_node.apply(this,arguments),a&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)a.setAttribute(\"draggable\",!0);else{var f,g,h=null;for(f=0,g=a.childNodes.length;g>f;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf(\"jstree-anchor\")){h=a.childNodes[f];break}h&&h.setAttribute(\"draggable\",!0)}return a}},a(function(){var c=!1,d=!1,e=!1,f=!1,g=a('<div id=\"jstree-marker\">&#160;</div>').hide();a(i).on(\"dnd_start.vakata.jstree\",function(a,b){c=!1,e=!1,b&&b.data&&b.data.jstree&&g.appendTo(\"body\")}).on(\"dnd_move.vakata.jstree\",function(h,i){if(f&&(i.event&&\"dragover\"===i.event.type&&i.event.target===e.target||clearTimeout(f)),i&&i.data&&i.data.jstree&&(!i.event.target.id||\"jstree-marker\"!==i.event.target.id)){e=i.event;var j=a.jstree.reference(i.event.target),k=!1,l=!1,m=!1,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(j&&j._data&&j._data.dnd)if(g.attr(\"class\",\"jstree-\"+j.get_theme()+(j.settings.core.themes.responsive?\" jstree-dnd-responsive\":\"\")),C=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey)),i.helper.children().attr(\"class\",\"jstree-\"+j.get_theme()+\" jstree-\"+j.get_theme()+\"-\"+j.get_theme_variant()+\" \"+(j.settings.core.themes.responsive?\" jstree-dnd-responsive\":\"\")).find(\".jstree-copy\").first()[C?\"show\":\"hide\"](),i.event.target!==j.element[0]&&i.event.target!==j.get_container_ul()[0]||0!==j.get_container_ul().children().length){if(k=j.settings.dnd.large_drop_target?a(i.event.target).closest(\".jstree-node\").children(\".jstree-anchor\"):a(i.event.target).closest(\".jstree-anchor\"),k&&k.length&&k.parent().is(\".jstree-closed, .jstree-open, .jstree-leaf\")&&(l=k.offset(),m=(i.event.pageY!==b?i.event.pageY:i.event.originalEvent.pageY)-l.top,q=k.outerHeight(),t=q/3>m?[\"b\",\"i\",\"a\"]:m>q-q/3?[\"a\",\"i\",\"b\"]:m>q/2?[\"i\",\"a\",\"b\"]:[\"i\",\"b\",\"a\"],a.each(t,function(b,e){switch(e){case\"b\":o=l.left-6,p=l.top,r=j.get_parent(k),s=k.parent().index();break;case\"i\":A=j.settings.dnd.inside_pos,B=j.get_node(k.parent()),o=l.left-2,p=l.top+q/2+1,r=B.id,s=\"first\"===A?0:\"last\"===A?B.children.length:Math.min(A,B.children.length);break;case\"a\":o=l.left-6,p=l.top+q,r=j.get_parent(k),s=k.parent().index()+1}for(u=!0,v=0,w=i.data.nodes.length;w>v;v++)if(x=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?\"copy_node\":\"move_node\",y=s,\"move_node\"===x&&\"a\"===e&&i.data.origin&&i.data.origin===j&&r===j.get_parent(i.data.nodes[v])&&(z=j.get_node(r),y>a.inArray(i.data.nodes[v],z.children)&&(y-=1)),u=u&&(j&&j.settings&&j.settings.dnd&&j.settings.dnd.check_while_dragging===!1||j.check(x,i.data.origin&&i.data.origin!==j?i.data.origin.get_node(i.data.nodes[v]):i.data.nodes[v],r,y,{dnd:!0,ref:j.get_node(k.parent()),pos:e,origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==j,is_foreign:!i.data.origin})),!u){j&&j.last_error&&(d=j.last_error());break}return\"i\"===e&&k.parent().is(\".jstree-closed\")&&j.settings.dnd.open_timeout&&(f=setTimeout(function(a,b){return function(){a.open_node(b)}}(j,k),j.settings.dnd.open_timeout)),u?(c={ins:j,par:r,pos:\"i\"!==e||\"last\"!==A||0!==s||j.is_loaded(B)?s:\"last\"},g.css({left:o+\"px\",top:p+\"px\"}).show(),i.helper.find(\".jstree-icon\").first().removeClass(\"jstree-er\").addClass(\"jstree-ok\"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=C?\"copy\":\"move\"),d={},t=!0,!1):void 0}),t===!0))return}else{for(u=!0,v=0,w=i.data.nodes.length;w>v;v++)if(u=u&&j.check(i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?\"copy_node\":\"move_node\",i.data.origin&&i.data.origin!==j?i.data.origin.get_node(i.data.nodes[v]):i.data.nodes[v],a.jstree.root,\"last\",{dnd:!0,ref:j.get_node(a.jstree.root),pos:\"i\",origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==j,is_foreign:!i.data.origin}),!u)break;if(u)return c={ins:j,par:a.jstree.root,pos:\"last\"},g.hide(),i.helper.find(\".jstree-icon\").first().removeClass(\"jstree-er\").addClass(\"jstree-ok\"),void(i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=C?\"copy\":\"move\"))}c=!1,i.helper.find(\".jstree-icon\").removeClass(\"jstree-ok\").addClass(\"jstree-er\"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=\"none\"),g.hide()}}).on(\"dnd_scroll.vakata.jstree\",function(a,b){b&&b.data&&b.data.jstree&&(g.hide(),c=!1,e=!1,b.helper.find(\".jstree-icon\").first().removeClass(\"jstree-ok\").addClass(\"jstree-er\"))}).on(\"dnd_stop.vakata.jstree\",function(b,h){if(f&&clearTimeout(f),h&&h.data&&h.data.jstree){g.hide().detach();var i,j,k=[];if(c){for(i=0,j=h.data.nodes.length;j>i;i++)k[i]=h.data.origin?h.data.origin.get_node(h.data.nodes[i]):h.data.nodes[i];c.ins[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?\"copy_node\":\"move_node\"](k,c.par,c.pos,!1,!1,!1,h.data.origin)}else i=a(h.event.target).closest(\".jstree\"),i.length&&d&&d.error&&\"check\"===d.error&&(i=i.jstree(!0),i&&i.settings.core.error.call(this,d));e=!1,c=!1}}).on(\"keyup.jstree keydown.jstree\",function(b,h){h=a.vakata.dnd._get(),h&&h.data&&h.data.jstree&&(\"keyup\"===b.type&&27===b.which?(f&&clearTimeout(f),c=!1,d=!1,e=!1,f=!1,g.hide().detach(),a.vakata.dnd._clean()):(h.helper.find(\".jstree-copy\").first()[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(b.metaKey||b.ctrlKey))?\"show\":\"hide\"](),e&&(e.metaKey=b.metaKey,e.ctrlKey=b.ctrlKey,a.vakata.dnd._trigger(\"move\",e))))})}),function(a){a.vakata.html={div:a(\"<div />\"),escape:function(b){return a.vakata.html.div.text(b).html()},strip:function(b){return a.vakata.html.div.empty().append(a.parseHTML(b)).text()}};var c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(c,d,e){e===b&&(e=a.vakata.dnd._get()),e.event=d,a(i).triggerHandler(\"dnd_\"+c+\".vakata\",e)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},a(i).off(\"mousemove.vakata.jstree touchmove.vakata.jstree\",a.vakata.dnd.drag),a(i).off(\"mouseup.vakata.jstree touchend.vakata.jstree\",a.vakata.dnd.stop)},_scroll:function(b){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t)return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1;if(!c.scroll_i)return c.scroll_i=setInterval(a.vakata.dnd._scroll,100),!1;if(b===!0)return!1;var d=c.scroll_e.scrollTop(),e=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(d+c.scroll_t*a.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(e+c.scroll_l*a.vakata.dnd.settings.scroll_speed),d===c.scroll_e.scrollTop()&&e===c.scroll_e.scrollLeft()||a.vakata.dnd._trigger(\"scroll\",c.scroll_e)},start:function(b,d,e){\"touchstart\"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&a.vakata.dnd.stop({});try{b.currentTarget.unselectable=\"on\",b.currentTarget.onselectstart=function(){return!1},b.currentTarget.style&&(b.currentTarget.style.touchAction=\"none\",b.currentTarget.style.msTouchAction=\"none\",b.currentTarget.style.MozUserSelect=\"none\")}catch(f){}return c.init_x=b.pageX,c.init_y=b.pageY,c.data=d,c.is_down=!0,c.element=b.currentTarget,c.target=b.target,c.is_touch=\"touchstart\"===b.type,e!==!1&&(c.helper=a(\"<div id='vakata-dnd'></div>\").html(e).css({display:\"block\",margin:\"0\",padding:\"0\",position:\"absolute\",top:\"-2000px\",lineHeight:\"16px\",zIndex:\"10000\"})),a(i).on(\"mousemove.vakata.jstree touchmove.vakata.jstree\",a.vakata.dnd.drag),a(i).on(\"mouseup.vakata.jstree touchend.vakata.jstree\",a.vakata.dnd.stop),!1},drag:function(b){if(\"touchmove\"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(b.pageX-c.init_x)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-c.init_y)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)))return;c.helper&&(c.helper.appendTo(\"body\"),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,a.vakata.dnd._trigger(\"start\",b)}var d=!1,e=!1,f=!1,g=!1,h=!1,j=!1,k=!1,l=!1,m=!1,n=!1;return c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,a(a(b.target).parentsUntil(\"body\").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css(\"overflow\"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var d=a(this),e=d.offset();return this.scrollHeight>this.offsetHeight&&(e.top+d.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),b.pageY-e.top<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(e.left+d.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),b.pageX-e.left<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=a(this),!1):void 0}),c.scroll_e||(d=a(i),e=a(window),f=d.height(),g=e.height(),h=d.width(),j=e.width(),k=d.scrollTop(),l=d.scrollLeft(),f>g&&b.pageY-k<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),f>g&&g-(b.pageY-k)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),h>j&&b.pageX-l<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),h>j&&j-(b.pageX-l)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=d)),c.scroll_e&&a.vakata.dnd._scroll(!0),c.helper&&(m=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),n=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),f&&m+25>f&&(m=f-50),h&&n+c.helper_w>h&&(n=h-(c.helper_w+2)),c.helper.css({left:n+\"px\",top:m+\"px\"})),a.vakata.dnd._trigger(\"move\",b),!1}},stop:function(b){if(\"touchend\"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag)a.vakata.dnd._trigger(\"stop\",b);else if(\"touchend\"===b.type&&b.target===c.target){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one(\"click\",function(){d&&clearTimeout(d)})}return a.vakata.dnd._clean(),!1}}}(a),a.jstree.defaults.massload=null,a.jstree.plugins.massload=function(b,c){this.init=function(a,b){this._data.massload={},c.init.call(this,a,b)},this._load_nodes=function(b,d,e,f){var g=this.settings.massload,h=JSON.stringify(b),i=[],j=this._model.data,k,l,m;if(!e){for(k=0,l=b.length;l>k;k++)j[b[k]]&&(j[b[k]].state.loaded||j[b[k]].state.failed)&&!f||(i.push(b[k]),m=this.get_node(b[k],!0),m&&m.length&&m.addClass(\"jstree-loading\").attr(\"aria-busy\",!0));if(this._data.massload={},i.length){if(a.isFunction(g))return g.call(this,i,a.proxy(function(a){var g,h;if(a)for(g in a)a.hasOwnProperty(g)&&(this._data.massload[g]=a[g]);for(g=0,h=b.length;h>g;g++)m=this.get_node(b[g],!0),m&&m.length&&m.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1);c._load_nodes.call(this,b,d,e,f)},this));if(\"object\"==typeof g&&g&&g.url)return g=a.extend(!0,{},g),a.isFunction(g.url)&&(g.url=g.url.call(this,i)),a.isFunction(g.data)&&(g.data=g.data.call(this,i)),a.ajax(g).done(a.proxy(function(a,g,h){var i,j;if(a)for(i in a)a.hasOwnProperty(i)&&(this._data.massload[i]=a[i]);for(i=0,j=b.length;j>i;i++)m=this.get_node(b[i],!0),m&&m.length&&m.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1);c._load_nodes.call(this,b,d,e,f)},this)).fail(a.proxy(function(a){c._load_nodes.call(this,b,d,e,f)},this))}}return c._load_nodes.call(this,b,d,e,f)},this._load_node=function(b,d){var e=this._data.massload[b.id],f=null,g;return e?(f=this[\"string\"==typeof e?\"_append_html_data\":\"_append_json_data\"](b,\"string\"==typeof e?a(a.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(a){d.call(this,a)}),g=this.get_node(b.id,!0),g&&g.length&&g.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1),delete this._data.massload[b.id],f):c._load_node.call(this,b,d)}},a.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},a.jstree.plugins.search=function(c,d){this.bind=function(){d.bind.call(this),this._data.search.str=\"\",this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on(\"search.jstree\",a.proxy(function(b,c){if(this._data.search.som&&c.res.length){var d=this._model.data,e,f,g=[],h,i;for(e=0,f=c.res.length;f>e;e++)if(d[c.res[e]]&&!d[c.res[e]].state.hidden&&(g.push(c.res[e]),g=g.concat(d[c.res[e]].parents),this._data.search.smc))for(h=0,i=d[c.res[e]].children_d.length;i>h;h++)d[d[c.res[e]].children_d[h]]&&!d[d[c.res[e]].children_d[h]].state.hidden&&g.push(d[c.res[e]].children_d[h]);g=a.vakata.array_remove_item(a.vakata.array_unique(g),a.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(g,!0),this.redraw(!0)}},this)).on(\"clear_search.jstree\",a.proxy(function(a,b){this._data.search.som&&b.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(c,d,e,f,g,h){if(c===!1||\"\"===a.trim(c.toString()))return this.clear_search();f=this.get_node(f),f=f&&f.id?f.id:null,c=c.toString();var i=this.settings.search,j=i.ajax?i.ajax:!1,k=this._model.data,l=null,m=[],n=[],o,p;if(this._data.search.res.length&&!g&&this.clear_search(),e===b&&(e=i.show_only_matches),h===b&&(h=i.show_only_matches_children),!d&&j!==!1)return a.isFunction(j)?j.call(this,c,a.proxy(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.isArray(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g)})},this),f):(j=a.extend({},j),j.data||(j.data={}),j.data.str=c,f&&(j.data.inside=f),a.ajax(j).fail(a.proxy(function(){this._data.core.last_error={error:\"ajax\",plugin:\"search\",id:\"search_01\",reason:\"Could not load search parents\",data:JSON.stringify(j)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(a.proxy(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.isArray(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g)})},this)));if(g||(this._data.search.str=c,this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=e,this._data.search.smc=h),l=new a.vakata.search(c,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),a.each(k[f?f:a.jstree.root].children_d,function(a,b){var d=k[b];d.text&&!d.state.hidden&&(!i.search_leaves_only||d.state.loaded&&0===d.children.length)&&(i.search_callback&&i.search_callback.call(this,c,d)||!i.search_callback&&l.search(d.text).isMatch)&&(m.push(b),n=n.concat(d.parents))}),m.length){for(n=a.vakata.array_unique(n),o=0,p=n.length;p>o;o++)n[o]!==a.jstree.root&&k[n[o]]&&this.open_node(n[o],null,0)===!0&&this._data.search.opn.push(n[o]);g?(this._data.search.dom=this._data.search.dom.add(a(this.element[0].querySelectorAll(\"#\"+a.map(m,function(b){return-1!==\"0123456789\".indexOf(b[0])?\"\\\\3\"+b[0]+\" \"+b.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):b.replace(a.jstree.idregex,\"\\\\$&\")}).join(\", #\")))),this._data.search.res=a.vakata.array_unique(this._data.search.res.concat(m))):(this._data.search.dom=a(this.element[0].querySelectorAll(\"#\"+a.map(m,function(b){return-1!==\"0123456789\".indexOf(b[0])?\"\\\\3\"+b[0]+\" \"+b.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):b.replace(a.jstree.idregex,\"\\\\$&\")}).join(\", #\"))),this._data.search.res=m),this._data.search.dom.children(\".jstree-anchor\").addClass(\"jstree-search\")}this.trigger(\"search\",{nodes:this._data.search.dom,str:c,res:this._data.search.res,show_only_matches:e})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger(\"clear_search\",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=a(this.element[0].querySelectorAll(\"#\"+a.map(this._data.search.res,function(b){return-1!==\"0123456789\".indexOf(b[0])?\"\\\\3\"+b[0]+\" \"+b.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):b.replace(a.jstree.idregex,\"\\\\$&\")}).join(\", #\"))),this._data.search.dom.children(\".jstree-anchor\").removeClass(\"jstree-search\")),this._data.search.str=\"\",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=a()},this.redraw_node=function(b,c,e,f){if(b=d.redraw_node.apply(this,arguments),b&&-1!==a.inArray(b.id,this._data.search.res)){var g,h,i=null;for(g=0,h=b.childNodes.length;h>g;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf(\"jstree-anchor\")){i=b.childNodes[g];break}i&&(i.className+=\" jstree-search\")}return b}},function(a){a.vakata.search=function(b,c,d){d=d||{},d=a.extend({},a.vakata.search.defaults,d),d.fuzzy!==!1&&(d.fuzzy=!0),b=d.caseSensitive?b:b.toLowerCase();var e=d.location,f=d.distance,g=d.threshold,h=b.length,i,j,k,l;return h>32&&(d.fuzzy=!1),d.fuzzy&&(i=1<<h-1,j=function(){var a={},c=0;for(c=0;h>c;c++)a[b.charAt(c)]=0;for(c=0;h>c;c++)a[b.charAt(c)]|=1<<h-c-1;return a}(),k=function(a,b){var c=a/h,d=Math.abs(e-b);return f?c+d/f:d?1:c}),l=function(a){if(a=d.caseSensitive?a:a.toLowerCase(),b===a||-1!==a.indexOf(b))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var c,f,l=a.length,m=g,n=a.indexOf(b,e),o,p,q=h+l,r,s,t,u,v,w=1,x=[];for(-1!==n&&(m=Math.min(k(0,n),m),n=a.lastIndexOf(b,e+h),-1!==n&&(m=Math.min(k(0,n),m))),n=-1,c=0;h>c;c++){o=0,p=q;while(p>o)k(c,e+p)<=m?o=p:q=p,p=Math.floor((q-o)/2+o);for(q=p,s=Math.max(1,e-p+1),t=Math.min(e+p,l)+h,u=new Array(t+2),u[t+1]=(1<<c)-1,f=t;f>=s;f--)if(v=j[a.charAt(f-1)],0===c?u[f]=(u[f+1]<<1|1)&v:u[f]=(u[f+1]<<1|1)&v|((r[f+1]|r[f])<<1|1)|r[f+1],u[f]&i&&(w=k(c,f-1),m>=w)){if(m=w,n=f-1,x.push(n),!(n>e))break;s=Math.max(1,2*e-n)}if(k(c+1,e)>m)break;r=u}return{isMatch:n>=0,score:w}},c===!0?{search:l}:l(c)},a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(a),a.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},a.jstree.plugins.sort=function(b,c){this.bind=function(){c.bind.call(this),this.element.on(\"model.jstree\",a.proxy(function(a,b){this.sort(b.parent,!0)},this)).on(\"rename_node.jstree create_node.jstree\",a.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1),this.redraw_node(b.parent||b.node.parent,!0)},this)).on(\"move_node.jstree copy_node.jstree\",a.proxy(function(a,b){this.sort(b.parent,!1),this.redraw_node(b.parent,!0)},this))},this.sort=function(b,c){var d,e;if(b=this.get_node(b),b&&b.children&&b.children.length&&(b.children.sort(a.proxy(this.settings.sort,this)),c))for(d=0,e=b.children_d.length;e>d;d++)this.sort(b.children_d[d],!1)}};var p=!1;a.jstree.defaults.state={key:\"jstree\",events:\"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree\",ttl:!1,filter:!1},a.jstree.plugins.state=function(b,c){this.bind=function(){c.bind.call(this);var b=a.proxy(function(){this.element.on(this.settings.state.events,a.proxy(function(){p&&clearTimeout(p),p=setTimeout(a.proxy(function(){this.save_state()},this),100)},this)),this.trigger(\"state_ready\")},this);this.element.on(\"ready.jstree\",a.proxy(function(a,c){this.element.one(\"restore_state.jstree\",b),this.restore_state()||b()},this))},this.save_state=function(){var b={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};a.vakata.storage.set(this.settings.state.key,JSON.stringify(b))},this.restore_state=function(){var b=a.vakata.storage.get(this.settings.state.key);if(b)try{b=JSON.parse(b)}catch(c){return!1}return b&&b.ttl&&b.sec&&+new Date-b.sec>b.ttl?!1:(b&&b.state&&(b=b.state),b&&a.isFunction(this.settings.state.filter)&&(b=this.settings.state.filter.call(this,b)),b?(this.element.one(\"set_state.jstree\",function(c,d){d.instance.trigger(\"restore_state\",{state:a.extend(!0,{},b)})}),this.set_state(b),!0):!1)},this.clear_state=function(){return a.vakata.storage.del(this.settings.state.key)}},function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}}(a),a.jstree.defaults.types={\"default\":{}},a.jstree.defaults.types[a.jstree.root]={},a.jstree.plugins.types=function(c,d){this.init=function(c,e){var f,g;if(e&&e.types&&e.types[\"default\"])for(f in e.types)if(\"default\"!==f&&f!==a.jstree.root&&e.types.hasOwnProperty(f))for(g in e.types[\"default\"])e.types[\"default\"].hasOwnProperty(g)&&e.types[f][g]===b&&(e.types[f][g]=e.types[\"default\"][g]);d.init.call(this,c,e),this._model.data[a.jstree.root].type=a.jstree.root},this.refresh=function(b,c){d.refresh.call(this,b,c),this._model.data[a.jstree.root].type=a.jstree.root},this.bind=function(){this.element.on(\"model.jstree\",a.proxy(function(c,d){var e=this._model.data,f=d.nodes,g=this.settings.types,h,i,j=\"default\",k;for(h=0,i=f.length;i>h;h++){if(j=\"default\",e[f[h]].original&&e[f[h]].original.type&&g[e[f[h]].original.type]&&(j=e[f[h]].original.type),e[f[h]].data&&e[f[h]].data.jstree&&e[f[h]].data.jstree.type&&g[e[f[h]].data.jstree.type]&&(j=e[f[h]].data.jstree.type),e[f[h]].type=j,e[f[h]].icon===!0&&g[j].icon!==b&&(e[f[h]].icon=g[j].icon),g[j].li_attr!==b&&\"object\"==typeof g[j].li_attr)for(k in g[j].li_attr)if(g[j].li_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[f[h]].li_attr[k]===b?e[f[h]].li_attr[k]=g[j].li_attr[k]:\"class\"===k&&(e[f[h]].li_attr[\"class\"]=g[j].li_attr[\"class\"]+\" \"+e[f[h]].li_attr[\"class\"])}if(g[j].a_attr!==b&&\"object\"==typeof g[j].a_attr)for(k in g[j].a_attr)if(g[j].a_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[f[h]].a_attr[k]===b?e[f[h]].a_attr[k]=g[j].a_attr[k]:\"href\"===k&&\"#\"===e[f[h]].a_attr[k]?e[f[h]].a_attr.href=g[j].a_attr.href:\"class\"===k&&(e[f[h]].a_attr[\"class\"]=g[j].a_attr[\"class\"]+\" \"+e[f[h]].a_attr[\"class\"])}}e[a.jstree.root].type=a.jstree.root},this)),d.bind.call(this)},this.get_json=function(b,c,e){var f,g,h=this._model.data,i=c?a.extend(!0,{},c,{no_id:!1}):{},j=d.get_json.call(this,b,i,e);if(j===!1)return!1;if(a.isArray(j))for(f=0,g=j.length;g>f;f++)j[f].type=j[f].id&&h[j[f].id]&&h[j[f].id].type?h[j[f].id].type:\"default\",c&&c.no_id&&(delete j[f].id,j[f].li_attr&&j[f].li_attr.id&&delete j[f].li_attr.id,j[f].a_attr&&j[f].a_attr.id&&delete j[f].a_attr.id);else j.type=j.id&&h[j.id]&&h[j.id].type?h[j.id].type:\"default\",c&&c.no_id&&(j=this._delete_ids(j));return j},this._delete_ids=function(b){if(a.isArray(b)){for(var c=0,d=b.length;d>c;c++)b[c]=this._delete_ids(b[c]);return b}return delete b.id,b.li_attr&&b.li_attr.id&&delete b.li_attr.id,b.a_attr&&b.a_attr.id&&delete b.a_attr.id,b.children&&a.isArray(b.children)&&(b.children=this._delete_ids(b.children)),b},this.check=function(c,e,f,g,h){if(d.check.call(this,c,e,f,g,h)===!1)return!1;e=e&&e.id?e:this.get_node(e),f=f&&f.id?f:this.get_node(f);var i=e&&e.id?h&&h.origin?h.origin:a.jstree.reference(e.id):null,j,k,l,m;switch(i=i&&i._model&&i._model.data?i._model.data:null,c){case\"create_node\":case\"move_node\":case\"copy_node\":if(\"move_node\"!==c||-1===a.inArray(e.id,f.children)){if(j=this.get_rules(f),j.max_children!==b&&-1!==j.max_children&&j.max_children===f.children.length)return this._data.core.last_error={error:\"check\",plugin:\"types\",id:\"types_01\",reason:\"max_children prevents function: \"+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(j.valid_children!==b&&-1!==j.valid_children&&-1===a.inArray(e.type||\"default\",j.valid_children))return this._data.core.last_error={error:\"check\",plugin:\"types\",id:\"types_02\",reason:\"valid_children prevents function: \"+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(i&&e.children_d&&e.parents){for(k=0,l=0,m=e.children_d.length;m>l;l++)k=Math.max(k,i[e.children_d[l]].parents.length);k=k-e.parents.length+1}(0>=k||k===b)&&(k=1);do{if(j.max_depth!==b&&-1!==j.max_depth&&j.max_depth<k)return this._data.core.last_error={error:\"check\",plugin:\"types\",id:\"types_03\",reason:\"max_depth prevents function: \"+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent),j=this.get_rules(f),k++}while(f)}}return!0},this.get_rules=function(a){if(a=this.get_node(a),!a)return!1;var c=this.get_type(a,!0);return c.max_depth===b&&(c.max_depth=-1),c.max_children===b&&(c.max_children=-1),c.valid_children===b&&(c.valid_children=-1),c},this.get_type=function(b,c){return b=this.get_node(b),b?c?a.extend({type:b.type},this.settings.types[b.type]):b.type:!1},this.set_type=function(c,d){var e=this._model.data,f,g,h,i,j,k,l,m;if(a.isArray(c)){for(c=c.slice(),g=0,h=c.length;h>g;g++)this.set_type(c[g],d);return!0}if(f=this.settings.types,c=this.get_node(c),!f[d]||!c)return!1;if(l=this.get_node(c,!0),l&&l.length&&(m=l.children(\".jstree-anchor\")),i=c.type,j=this.get_icon(c),c.type=d,(j===!0||f[i]&&f[i].icon!==b&&j===f[i].icon)&&this.set_icon(c,f[d].icon!==b?f[d].icon:!0),f[i].li_attr!==b&&\"object\"==typeof f[i].li_attr)for(k in f[i].li_attr)if(f[i].li_attr.hasOwnProperty(k)){if(\"id\"===k)continue;\"class\"===k?(e[c.id].li_attr[\"class\"]=(e[c.id].li_attr[\"class\"]||\"\").replace(f[i].li_attr[k],\"\"),l&&l.removeClass(f[i].li_attr[k])):e[c.id].li_attr[k]===f[i].li_attr[k]&&(e[c.id].li_attr[k]=null,l&&l.removeAttr(k))}if(f[i].a_attr!==b&&\"object\"==typeof f[i].a_attr)for(k in f[i].a_attr)if(f[i].a_attr.hasOwnProperty(k)){if(\"id\"===k)continue;\"class\"===k?(e[c.id].a_attr[\"class\"]=(e[c.id].a_attr[\"class\"]||\"\").replace(f[i].a_attr[k],\"\"),m&&m.removeClass(f[i].a_attr[k])):e[c.id].a_attr[k]===f[i].a_attr[k]&&(\"href\"===k?(e[c.id].a_attr[k]=\"#\",m&&m.attr(\"href\",\"#\")):(delete e[c.id].a_attr[k],m&&m.removeAttr(k)))}if(f[d].li_attr!==b&&\"object\"==typeof f[d].li_attr)for(k in f[d].li_attr)if(f[d].li_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[c.id].li_attr[k]===b?(e[c.id].li_attr[k]=f[d].li_attr[k],l&&(\"class\"===k?l.addClass(f[d].li_attr[k]):l.attr(k,f[d].li_attr[k]))):\"class\"===k&&(e[c.id].li_attr[\"class\"]=f[d].li_attr[k]+\" \"+e[c.id].li_attr[\"class\"],l&&l.addClass(f[d].li_attr[k]))}if(f[d].a_attr!==b&&\"object\"==typeof f[d].a_attr)for(k in f[d].a_attr)if(f[d].a_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[c.id].a_attr[k]===b?(e[c.id].a_attr[k]=f[d].a_attr[k],m&&(\"class\"===k?m.addClass(f[d].a_attr[k]):m.attr(k,f[d].a_attr[k]))):\"href\"===k&&\"#\"===e[c.id].a_attr[k]?(e[c.id].a_attr.href=f[d].a_attr.href,m&&m.attr(\"href\",f[d].a_attr.href)):\"class\"===k&&(e[c.id].a_attr[\"class\"]=f[d].a_attr[\"class\"]+\" \"+e[c.id].a_attr[\"class\"],m&&m.addClass(f[d].a_attr[k]))}return!0}},a.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,b){return a+\" (\"+b+\")\"}},a.jstree.plugins.unique=function(c,d){this.check=function(b,c,e,f,g){if(d.check.call(this,b,c,e,f,g)===!1)return!1;if(c=c&&c.id?c:this.get_node(c),e=e&&e.id?e:this.get_node(e),!e||!e.children)return!0;var h=\"rename_node\"===b?f:c.text,i=[],j=this.settings.unique.case_sensitive,k=this._model.data,l,m;for(l=0,m=e.children.length;m>l;l++)i.push(j?k[e.children[l]].text:k[e.children[l]].text.toLowerCase());switch(j||(h=h.toLowerCase()),b){case\"delete_node\":return!0;case\"rename_node\":return l=-1===a.inArray(h,i)||c.text&&c.text[j?\"toString\":\"toLowerCase\"]()===h,l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_01\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l;case\"create_node\":return l=-1===a.inArray(h,i),l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_04\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l;case\"copy_node\":return l=-1===a.inArray(h,i),l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_02\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l;case\"move_node\":return l=c.parent===e.id&&(!g||!g.is_multi)||-1===a.inArray(h,i),l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_03\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l}return!0},this.create_node=function(c,e,f,g,h){if(!e||e.text===b){if(null===c&&(c=a.jstree.root),c=this.get_node(c),!c)return d.create_node.call(this,c,e,f,g,h);if(f=f===b?\"last\":f,!f.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(c))return d.create_node.call(this,c,e,f,g,h);\ne||(e={});var i,j,k,l,m,n=this._model.data,o=this.settings.unique.case_sensitive,p=this.settings.unique.duplicate;for(j=i=this.get_string(\"New node\"),k=[],l=0,m=c.children.length;m>l;l++)k.push(o?n[c.children[l]].text:n[c.children[l]].text.toLowerCase());l=1;while(-1!==a.inArray(o?j:j.toLowerCase(),k))j=p.call(this,i,++l).toString();e.text=j}return d.create_node.call(this,c,e,f,g,h)}};var q=i.createElement(\"DIV\");if(q.setAttribute(\"unselectable\",\"on\"),q.setAttribute(\"role\",\"presentation\"),q.className=\"jstree-wholerow\",q.innerHTML=\"&#160;\",a.jstree.plugins.wholerow=function(b,c){this.bind=function(){c.bind.call(this),this.element.on(\"ready.jstree set_state.jstree\",a.proxy(function(){this.hide_dots()},this)).on(\"init.jstree loading.jstree ready.jstree\",a.proxy(function(){this.get_container_ul().addClass(\"jstree-wholerow-ul\")},this)).on(\"deselect_all.jstree\",a.proxy(function(a,b){this.element.find(\".jstree-wholerow-clicked\").removeClass(\"jstree-wholerow-clicked\")},this)).on(\"changed.jstree\",a.proxy(function(a,b){this.element.find(\".jstree-wholerow-clicked\").removeClass(\"jstree-wholerow-clicked\");var c=!1,d,e;for(d=0,e=b.selected.length;e>d;d++)c=this.get_node(b.selected[d],!0),c&&c.length&&c.children(\".jstree-wholerow\").addClass(\"jstree-wholerow-clicked\")},this)).on(\"open_node.jstree\",a.proxy(function(a,b){this.get_node(b.node,!0).find(\".jstree-clicked\").parent().children(\".jstree-wholerow\").addClass(\"jstree-wholerow-clicked\")},this)).on(\"hover_node.jstree dehover_node.jstree\",a.proxy(function(a,b){\"hover_node\"===a.type&&this.is_disabled(b.node)||this.get_node(b.node,!0).children(\".jstree-wholerow\")[\"hover_node\"===a.type?\"addClass\":\"removeClass\"](\"jstree-wholerow-hovered\")},this)).on(\"contextmenu.jstree\",\".jstree-wholerow\",a.proxy(function(b){if(this._data.contextmenu){b.preventDefault();var c=a.Event(\"contextmenu\",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,pageX:b.pageX,pageY:b.pageY});a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").first().trigger(c)}},this)).on(\"click.jstree\",\".jstree-wholerow\",function(b){b.stopImmediatePropagation();var c=a.Event(\"click\",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").first().trigger(c).focus()}).on(\"click.jstree\",\".jstree-leaf > .jstree-ocl\",a.proxy(function(b){b.stopImmediatePropagation();var c=a.Event(\"click\",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").first().trigger(c).focus()},this)).on(\"mouseover.jstree\",\".jstree-wholerow, .jstree-icon\",a.proxy(function(a){return a.stopImmediatePropagation(),this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget),!1},this)).on(\"mouseleave.jstree\",\".jstree-node\",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(\".jstree-wholerow\").remove(),c.teardown.call(this)},this.redraw_node=function(b,d,e,f){if(b=c.redraw_node.apply(this,arguments)){var g=q.cloneNode(!0);-1!==a.inArray(b.id,this._data.core.selected)&&(g.className+=\" jstree-wholerow-clicked\"),this._data.core.focused&&this._data.core.focused===b.id&&(g.className+=\" jstree-wholerow-hovered\"),b.insertBefore(g,b.childNodes[0])}return b}},i.registerElement&&Object&&Object.create){var r=Object.create(HTMLElement.prototype);r.createdCallback=function(){var b={core:{},plugins:[]},c;for(c in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(c)&&this.attributes[c]&&(b.plugins.push(c),this.getAttribute(c)&&JSON.parse(this.getAttribute(c))&&(b[c]=JSON.parse(this.getAttribute(c))));for(c in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(c)&&this.attributes[c]&&(b.core[c]=JSON.parse(this.getAttribute(c))||this.getAttribute(c));a(this).jstree(b)};try{i.registerElement(\"vakata-jstree\",{prototype:r})}catch(s){}}}});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9saWJzL2pzdHJlZS9qc3RyZWUubWluLmpzPzg1YWMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBUSElTIEZJTEUgSEFTIEJFRU4gTUFOVUFMTFkgUEFUQ0hFRCBUTyBBTExPVyBDT1BZSU5HIElOVE8gU0VMRi9DSElMRFJFTlxuICogaHR0cHM6Ly9naXRodWIuY29tL0ZpbmFsQW5nZWwvanN0cmVlXG4gKi9cbi8qISBqc1RyZWUgLSB2My4zLjAgLSAyMDE2LTA0LTI1IC0gKE1JVCkgKi9cbiFmdW5jdGlvbihhKXtcInVzZSBzdHJpY3RcIjtcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKFtcImpxdWVyeVwiXSxhKTpcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1hKHJlcXVpcmUoXCJqcXVlcnlcIikpOmEoalF1ZXJ5KX0oZnVuY3Rpb24oYSxiKXtcInVzZSBzdHJpY3RcIjtpZighYS5qc3RyZWUpe3ZhciBjPTAsZD0hMSxlPSExLGY9ITEsZz1bXSxoPWEoXCJzY3JpcHQ6bGFzdFwiKS5hdHRyKFwic3JjXCIpLGk9d2luZG93LmRvY3VtZW50LGo9aS5jcmVhdGVFbGVtZW50KFwiTElcIiksayxsO2ouc2V0QXR0cmlidXRlKFwicm9sZVwiLFwidHJlZWl0ZW1cIiksaz1pLmNyZWF0ZUVsZW1lbnQoXCJJXCIpLGsuY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLW9jbFwiLGsuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGouYXBwZW5kQ2hpbGQoayksaz1pLmNyZWF0ZUVsZW1lbnQoXCJBXCIpLGsuY2xhc3NOYW1lPVwianN0cmVlLWFuY2hvclwiLGsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiI1wiKSxrLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsXCItMVwiKSxsPWkuY3JlYXRlRWxlbWVudChcIklcIiksbC5jbGFzc05hbWU9XCJqc3RyZWUtaWNvbiBqc3RyZWUtdGhlbWVpY29uXCIsbC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksay5hcHBlbmRDaGlsZChsKSxqLmFwcGVuZENoaWxkKGspLGs9bD1udWxsLGEuanN0cmVlPXt2ZXJzaW9uOlwie3tWRVJTSU9OfX1cIixkZWZhdWx0czp7cGx1Z2luczpbXX0scGx1Z2luczp7fSxwYXRoOmgmJi0xIT09aC5pbmRleE9mKFwiL1wiKT9oLnJlcGxhY2UoL1xcL1teXFwvXSskLyxcIlwiKTpcIlwiLGlkcmVnZXg6L1tcXFxcOiYhXnwoKVxcW1xcXTw+QConK34jXCI7Liw9XFwtIFxcLyR7fSU/YF0vZyxyb290OlwiI1wifSxhLmpzdHJlZS5jcmVhdGU9ZnVuY3Rpb24oYixkKXt2YXIgZT1uZXcgYS5qc3RyZWUuY29yZSgrK2MpLGY9ZDtyZXR1cm4gZD1hLmV4dGVuZCghMCx7fSxhLmpzdHJlZS5kZWZhdWx0cyxkKSxmJiZmLnBsdWdpbnMmJihkLnBsdWdpbnM9Zi5wbHVnaW5zKSxhLmVhY2goZC5wbHVnaW5zLGZ1bmN0aW9uKGEsYil7XCJjb3JlXCIhPT1hJiYoZT1lLnBsdWdpbihiLGRbYl0pKX0pLGEoYikuZGF0YShcImpzdHJlZVwiLGUpLGUuaW5pdChiLGQpLGV9LGEuanN0cmVlLmRlc3Ryb3k9ZnVuY3Rpb24oKXthKFwiLmpzdHJlZTpqc3RyZWVcIikuanN0cmVlKFwiZGVzdHJveVwiKSxhKGkpLm9mZihcIi5qc3RyZWVcIil9LGEuanN0cmVlLmNvcmU9ZnVuY3Rpb24oYSl7dGhpcy5faWQ9YSx0aGlzLl9jbnQ9MCx0aGlzLl93cms9bnVsbCx0aGlzLl9kYXRhPXtjb3JlOnt0aGVtZXM6e25hbWU6ITEsZG90czohMSxpY29uczohMX0sc2VsZWN0ZWQ6W10sbGFzdF9lcnJvcjp7fSx3b3JraW5nOiExLHdvcmtlcl9xdWV1ZTpbXSxmb2N1c2VkOm51bGx9fX0sYS5qc3RyZWUucmVmZXJlbmNlPWZ1bmN0aW9uKGIpe3ZhciBjPW51bGwsZD1udWxsO2lmKCFifHwhYi5pZHx8Yi50YWdOYW1lJiZiLm5vZGVUeXBlfHwoYj1iLmlkKSwhZHx8IWQubGVuZ3RoKXRyeXtkPWEoYil9Y2F0Y2goZSl7fWlmKCFkfHwhZC5sZW5ndGgpdHJ5e2Q9YShcIiNcIitiLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSl9Y2F0Y2goZSl7fXJldHVybiBkJiZkLmxlbmd0aCYmKGQ9ZC5jbG9zZXN0KFwiLmpzdHJlZVwiKSkubGVuZ3RoJiYoZD1kLmRhdGEoXCJqc3RyZWVcIikpP2M9ZDphKFwiLmpzdHJlZVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKS5kYXRhKFwianN0cmVlXCIpO3JldHVybiBkJiZkLl9tb2RlbC5kYXRhW2JdPyhjPWQsITEpOnZvaWQgMH0pLGN9LGEuZm4uanN0cmVlPWZ1bmN0aW9uKGMpe3ZhciBkPVwic3RyaW5nXCI9PXR5cGVvZiBjLGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLGY9bnVsbDtyZXR1cm4gYyE9PSEwfHx0aGlzLmxlbmd0aD8odGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGc9YS5qc3RyZWUucmVmZXJlbmNlKHRoaXMpLGg9ZCYmZz9nW2NdOm51bGw7cmV0dXJuIGY9ZCYmaD9oLmFwcGx5KGcsZSk6bnVsbCxnfHxkfHxjIT09YiYmIWEuaXNQbGFpbk9iamVjdChjKXx8YS5qc3RyZWUuY3JlYXRlKHRoaXMsYyksKGcmJiFkfHxjPT09ITApJiYoZj1nfHwhMSksbnVsbCE9PWYmJmYhPT1iPyExOnZvaWQgMH0pLG51bGwhPT1mJiZmIT09Yj9mOnRoaXMpOiExfSxhLmV4cHJbXCI6XCJdLmpzdHJlZT1hLmV4cHIuY3JlYXRlUHNldWRvKGZ1bmN0aW9uKGMpe3JldHVybiBmdW5jdGlvbihjKXtyZXR1cm4gYShjKS5oYXNDbGFzcyhcImpzdHJlZVwiKSYmYShjKS5kYXRhKFwianN0cmVlXCIpIT09Yn19KSxhLmpzdHJlZS5kZWZhdWx0cy5jb3JlPXtkYXRhOiExLHN0cmluZ3M6ITEsY2hlY2tfY2FsbGJhY2s6ITEsZXJyb3I6YS5ub29wLGFuaW1hdGlvbjoyMDAsbXVsdGlwbGU6ITAsdGhlbWVzOntuYW1lOiExLHVybDohMSxkaXI6ITEsZG90czohMCxpY29uczohMCxzdHJpcGVzOiExLHZhcmlhbnQ6ITEscmVzcG9uc2l2ZTohMX0sZXhwYW5kX3NlbGVjdGVkX29ubG9hZDohMCx3b3JrZXI6ITAsZm9yY2VfdGV4dDohMSxkYmxjbGlja190b2dnbGU6ITB9LGEuanN0cmVlLmNvcmUucHJvdG90eXBlPXtwbHVnaW46ZnVuY3Rpb24oYixjKXt2YXIgZD1hLmpzdHJlZS5wbHVnaW5zW2JdO3JldHVybiBkPyh0aGlzLl9kYXRhW2JdPXt9LGQucHJvdG90eXBlPXRoaXMsbmV3IGQoYyx0aGlzKSk6dGhpc30saW5pdDpmdW5jdGlvbihiLGMpe3RoaXMuX21vZGVsPXtkYXRhOnt9LGNoYW5nZWQ6W10sZm9yY2VfZnVsbF9yZWRyYXc6ITEscmVkcmF3X3RpbWVvdXQ6ITEsZGVmYXVsdF9zdGF0ZTp7bG9hZGVkOiEwLG9wZW5lZDohMSxzZWxlY3RlZDohMSxkaXNhYmxlZDohMX19LHRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF09e2lkOmEuanN0cmVlLnJvb3QscGFyZW50Om51bGwscGFyZW50czpbXSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLHN0YXRlOntsb2FkZWQ6ITF9fSx0aGlzLmVsZW1lbnQ9YShiKS5hZGRDbGFzcyhcImpzdHJlZSBqc3RyZWUtXCIrdGhpcy5faWQpLHRoaXMuc2V0dGluZ3M9Yyx0aGlzLl9kYXRhLmNvcmUucmVhZHk9ITEsdGhpcy5fZGF0YS5jb3JlLmxvYWRlZD0hMSx0aGlzLl9kYXRhLmNvcmUucnRsPVwicnRsXCI9PT10aGlzLmVsZW1lbnQuY3NzKFwiZGlyZWN0aW9uXCIpLHRoaXMuZWxlbWVudFt0aGlzLl9kYXRhLmNvcmUucnRsP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLXJ0bFwiKSx0aGlzLmVsZW1lbnQuYXR0cihcInJvbGVcIixcInRyZWVcIiksdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiZ0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtbXVsdGlzZWxlY3RhYmxlXCIsITApLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIil8fHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIjBcIiksdGhpcy5iaW5kKCksdGhpcy50cmlnZ2VyKFwiaW5pdFwiKSx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWw9dGhpcy5lbGVtZW50LmZpbmQoXCIgPiB1bCA+IGxpXCIpLmNsb25lKCEwKSx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWwuZmluZChcImxpXCIpLmFkZEJhY2soKS5jb250ZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzPT09dGhpcy5ub2RlVHlwZSYmKCF0aGlzLm5vZGVWYWx1ZXx8L15cXHMrJC8udGVzdCh0aGlzLm5vZGVWYWx1ZSkpfSkucmVtb3ZlKCksdGhpcy5lbGVtZW50Lmh0bWwoXCI8dWwgY2xhc3M9J2pzdHJlZS1jb250YWluZXItdWwganN0cmVlLWNoaWxkcmVuJyByb2xlPSdncm91cCc+PGxpIGlkPSdqXCIrdGhpcy5faWQrXCJfbG9hZGluZycgY2xhc3M9J2pzdHJlZS1pbml0aWFsLW5vZGUganN0cmVlLWxvYWRpbmcganN0cmVlLWxlYWYganN0cmVlLWxhc3QnIHJvbGU9J3RyZWUtaXRlbSc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS1vY2wnPjwvaT48YSBjbGFzcz0nanN0cmVlLWFuY2hvcicgaHJlZj0nIyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb24taGlkZGVuJz48L2k+XCIrdGhpcy5nZXRfc3RyaW5nKFwiTG9hZGluZyAuLi5cIikrXCI8L2E+PC9saT48L3VsPlwiKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFwialwiK3RoaXMuX2lkK1wiX2xvYWRpbmdcIiksdGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodD10aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcImxpXCIpLmZpcnN0KCkuaGVpZ2h0KCl8fDI0LHRoaXMudHJpZ2dlcihcImxvYWRpbmdcIiksdGhpcy5sb2FkX25vZGUoYS5qc3RyZWUucm9vdCl9LGRlc3Ryb3k6ZnVuY3Rpb24oYSl7aWYodGhpcy5fd3JrKXRyeXt3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLl93cmspLHRoaXMuX3dyaz1udWxsfWNhdGNoKGIpe31hfHx0aGlzLmVsZW1lbnQuZW1wdHkoKSx0aGlzLnRlYXJkb3duKCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7dGhpcy51bmJpbmQoKSx0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWVcIikucmVtb3ZlRGF0YShcImpzdHJlZVwiKS5maW5kKFwiW2NsYXNzXj0nanN0cmVlJ11cIikuYWRkQmFjaygpLmF0dHIoXCJjbGFzc1wiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2xhc3NOYW1lLnJlcGxhY2UoL2pzdHJlZVteIF0qfCQvZ2ksXCJcIil9KSx0aGlzLmVsZW1lbnQ9bnVsbH0sYmluZDpmdW5jdGlvbigpe3ZhciBiPVwiXCIsYz1udWxsLGQ9MDt0aGlzLmVsZW1lbnQub24oXCJkYmxjbGljay5qc3RyZWVcIixmdW5jdGlvbihhKXtpZihhLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1hLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aWYoaS5zZWxlY3Rpb24mJmkuc2VsZWN0aW9uLmVtcHR5KWkuc2VsZWN0aW9uLmVtcHR5KCk7ZWxzZSBpZih3aW5kb3cuZ2V0U2VsZWN0aW9uKXt2YXIgYj13aW5kb3cuZ2V0U2VsZWN0aW9uKCk7dHJ5e2IucmVtb3ZlQWxsUmFuZ2VzKCksYi5jb2xsYXBzZSgpfWNhdGNoKGMpe319fSkub24oXCJtb3VzZWRvd24uanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhKXthLnRhcmdldD09PXRoaXMuZWxlbWVudFswXSYmKGEucHJldmVudERlZmF1bHQoKSxkPStuZXcgRGF0ZSl9LHRoaXMpKS5vbihcIm1vdXNlZG93bi5qc3RyZWVcIixcIi5qc3RyZWUtb2NsXCIsZnVuY3Rpb24oYSl7YS5wcmV2ZW50RGVmYXVsdCgpfSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtb2NsXCIsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLnRvZ2dsZV9ub2RlKGEudGFyZ2V0KX0sdGhpcykpLm9uKFwiZGJsY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIGEudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWEudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKT8hMDp2b2lkKHRoaXMuc2V0dGluZ3MuY29yZS5kYmxjbGlja190b2dnbGUmJnRoaXMudG9nZ2xlX25vZGUoYS50YXJnZXQpKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpLGIuY3VycmVudFRhcmdldCE9PWkuYWN0aXZlRWxlbWVudCYmYShiLmN1cnJlbnRUYXJnZXQpLmZvY3VzKCksdGhpcy5hY3RpdmF0ZV9ub2RlKGIuY3VycmVudFRhcmdldCxiKX0sdGhpcykpLm9uKFwia2V5ZG93bi5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXtpZihiLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1iLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aWYoMzIhPT1iLndoaWNoJiYxMyE9PWIud2hpY2gmJihiLnNoaWZ0S2V5fHxiLmN0cmxLZXl8fGIuYWx0S2V5fHxiLm1ldGFLZXkpKXJldHVybiEwO3ZhciBjPW51bGw7c3dpdGNoKHRoaXMuX2RhdGEuY29yZS5ydGwmJigzNz09PWIud2hpY2g/Yi53aGljaD0zOTozOT09PWIud2hpY2gmJihiLndoaWNoPTM3KSksYi53aGljaCl7Y2FzZSAzMjpiLmN0cmxLZXkmJihiLnR5cGU9XCJjbGlja1wiLGEoYi5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKGIpKTticmVhaztjYXNlIDEzOmIudHlwZT1cImNsaWNrXCIsYShiLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoYik7YnJlYWs7Y2FzZSAzNzpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5pc19vcGVuKGIuY3VycmVudFRhcmdldCk/dGhpcy5jbG9zZV9ub2RlKGIuY3VycmVudFRhcmdldCk6KGM9dGhpcy5nZXRfcGFyZW50KGIuY3VycmVudFRhcmdldCksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3QmJnRoaXMuZ2V0X25vZGUoYywhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpKTticmVhaztjYXNlIDM4OmIucHJldmVudERlZmF1bHQoKSxjPXRoaXMuZ2V0X3ByZXZfZG9tKGIuY3VycmVudFRhcmdldCksYyYmYy5sZW5ndGgmJmMuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpO2JyZWFrO2Nhc2UgMzk6Yi5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuaXNfY2xvc2VkKGIuY3VycmVudFRhcmdldCk/dGhpcy5vcGVuX25vZGUoYi5jdXJyZW50VGFyZ2V0LGZ1bmN0aW9uKGEpe3RoaXMuZ2V0X25vZGUoYSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpfSk6dGhpcy5pc19vcGVuKGIuY3VycmVudFRhcmdldCkmJihjPXRoaXMuZ2V0X25vZGUoYi5jdXJyZW50VGFyZ2V0LCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0sYyYmYSh0aGlzLl9maXJzdENoaWxkKGMpKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpO2JyZWFrO2Nhc2UgNDA6Yi5wcmV2ZW50RGVmYXVsdCgpLGM9dGhpcy5nZXRfbmV4dF9kb20oYi5jdXJyZW50VGFyZ2V0KSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAxMDY6dGhpcy5vcGVuX2FsbCgpO2JyZWFrO2Nhc2UgMzY6Yi5wcmV2ZW50RGVmYXVsdCgpLGM9dGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSksYyYmYShjKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAzNTpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5maWx0ZXIoXCI6dmlzaWJsZVwiKS5sYXN0KCkuZm9jdXMoKTticmVhaztjYXNlIDExMzpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5lZGl0KGIuY3VycmVudFRhcmdldCl9fSx0aGlzKSkub24oXCJsb2FkX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe2Muc3RhdHVzJiYoYy5ub2RlLmlkIT09YS5qc3RyZWUucm9vdHx8dGhpcy5fZGF0YS5jb3JlLmxvYWRlZHx8KHRoaXMuX2RhdGEuY29yZS5sb2FkZWQ9ITAsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkuaWQpLHRoaXMudHJpZ2dlcihcImxvYWRlZFwiKSksdGhpcy5fZGF0YS5jb3JlLnJlYWR5fHxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1lbnQmJiF0aGlzLmdldF9jb250YWluZXJfdWwoKS5maW5kKFwiLmpzdHJlZS1sb2FkaW5nXCIpLmxlbmd0aCl7aWYodGhpcy5fZGF0YS5jb3JlLnJlYWR5PSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGgpe2lmKHRoaXMuc2V0dGluZ3MuY29yZS5leHBhbmRfc2VsZWN0ZWRfb25sb2FkKXt2YXIgYj1bXSxjLGQ7Zm9yKGM9MCxkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7ZD5jO2MrKyliPWIuY29uY2F0KHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2NdXS5wYXJlbnRzKTtmb3IoYj1hLnZha2F0YS5hcnJheV91bmlxdWUoYiksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLm9wZW5fbm9kZShiW2NdLCExLDApfXRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwicmVhZHlcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KX10aGlzLnRyaWdnZXIoXCJyZWFkeVwiKX19LHRoaXMpLDApKX0sdGhpcykpLm9uKFwia2V5cHJlc3MuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihkKXtpZihkLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1kLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7YyYmY2xlYXJUaW1lb3V0KGMpLGM9c2V0VGltZW91dChmdW5jdGlvbigpe2I9XCJcIn0sNTAwKTt2YXIgZT1TdHJpbmcuZnJvbUNoYXJDb2RlKGQud2hpY2gpLnRvTG93ZXJDYXNlKCksZj10aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLGc9Zi5pbmRleChpLmFjdGl2ZUVsZW1lbnQpfHwwLGg9ITE7aWYoYis9ZSxiLmxlbmd0aD4xKXtpZihmLnNsaWNlKGcpLmVhY2goYS5wcm94eShmdW5jdGlvbihjLGQpe3JldHVybiAwPT09YShkKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGIpPyhhKGQpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm47aWYoZi5zbGljZSgwLGcpLmVhY2goYS5wcm94eShmdW5jdGlvbihjLGQpe3JldHVybiAwPT09YShkKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGIpPyhhKGQpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm59aWYobmV3IFJlZ0V4cChcIl5cIitlLnJlcGxhY2UoL1stXFwvXFxcXF4kKis/LigpfFtcXF17fV0vZyxcIlxcXFwkJlwiKStcIiskXCIpLnRlc3QoYikpe2lmKGYuc2xpY2UoZysxKS5lYWNoKGEucHJveHkoZnVuY3Rpb24oYixjKXtyZXR1cm4gYShjKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCk9PT1lPyhhKGMpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm47aWYoZi5zbGljZSgwLGcrMSkuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEoYykudGV4dCgpLnRvTG93ZXJDYXNlKCkuY2hhckF0KDApPT09ZT8oYShjKS5mb2N1cygpLGg9ITAsITEpOnZvaWQgMH0sdGhpcykpLGgpcmV0dXJufX0sdGhpcykpLm9uKFwiaW5pdC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lczt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM9YS5kb3RzLHRoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz1hLnN0cmlwZXMsdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz1hLmljb25zLHRoaXMuc2V0X3RoZW1lKGEubmFtZXx8XCJkZWZhdWx0XCIsYS51cmwpLHRoaXMuc2V0X3RoZW1lX3ZhcmlhbnQoYS52YXJpYW50KX0sdGhpcykpLm9uKFwibG9hZGluZy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpc1t0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM/XCJzaG93X2RvdHNcIjpcImhpZGVfZG90c1wiXSgpLHRoaXNbdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz9cInNob3dfaWNvbnNcIjpcImhpZGVfaWNvbnNcIl0oKSx0aGlzW3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz9cInNob3dfc3RyaXBlc1wiOlwiaGlkZV9zdHJpcGVzXCJdKCl9LHRoaXMpKS5vbihcImJsdXIuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYil7dGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCxhKGIuY3VycmVudFRhcmdldCkuZmlsdGVyKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLm1vdXNlbGVhdmUoKSx0aGlzLmVsZW1lbnQuYXR0cihcInRhYmluZGV4XCIsXCIwXCIpfSx0aGlzKSkub24oXCJmb2N1cy5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXt2YXIgYz10aGlzLmdldF9ub2RlKGIuY3VycmVudFRhcmdldCk7YyYmYy5pZCYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPWMuaWQpLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLm5vdChiLmN1cnJlbnRUYXJnZXQpLm1vdXNlbGVhdmUoKSxhKGIuY3VycmVudFRhcmdldCkubW91c2VlbnRlcigpLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIi0xXCIpfSx0aGlzKSkub24oXCJmb2N1cy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7aWYoK25ldyBEYXRlLWQ+NTAwJiYhdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQpe2Q9MDt2YXIgYT10aGlzLmdldF9ub2RlKHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIpLCEwKTthJiZhLmZpbmQoXCI+IC5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCl9fSx0aGlzKSkub24oXCJtb3VzZWVudGVyLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuaG92ZXJfbm9kZShhLmN1cnJlbnRUYXJnZXQpfSx0aGlzKSkub24oXCJtb3VzZWxlYXZlLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuZGVob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCl9LHRoaXMpKX0sdW5iaW5kOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9mZihcIi5qc3RyZWVcIiksYShpKS5vZmYoXCIuanN0cmVlLVwiK3RoaXMuX2lkKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe2J8fChiPXt9KSxiLmluc3RhbmNlPXRoaXMsdGhpcy5lbGVtZW50LnRyaWdnZXJIYW5kbGVyKGEucmVwbGFjZShcIi5qc3RyZWVcIixcIlwiKStcIi5qc3RyZWVcIixiKX0sZ2V0X2NvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LGdldF9jb250YWluZXJfdWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5maXJzdCgpfSxnZXRfc3RyaW5nOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuc2V0dGluZ3MuY29yZS5zdHJpbmdzO3JldHVybiBhLmlzRnVuY3Rpb24oYyk/Yy5jYWxsKHRoaXMsYik6YyYmY1tiXT9jW2JdOmJ9LF9maXJzdENoaWxkOmZ1bmN0aW9uKGEpe2E9YT9hLmZpcnN0Q2hpbGQ6bnVsbDt3aGlsZShudWxsIT09YSYmMSE9PWEubm9kZVR5cGUpYT1hLm5leHRTaWJsaW5nO3JldHVybiBhfSxfbmV4dFNpYmxpbmc6ZnVuY3Rpb24oYSl7YT1hP2EubmV4dFNpYmxpbmc6bnVsbDt3aGlsZShudWxsIT09YSYmMSE9PWEubm9kZVR5cGUpYT1hLm5leHRTaWJsaW5nO3JldHVybiBhfSxfcHJldmlvdXNTaWJsaW5nOmZ1bmN0aW9uKGEpe2E9YT9hLnByZXZpb3VzU2libGluZzpudWxsO3doaWxlKG51bGwhPT1hJiYxIT09YS5ub2RlVHlwZSlhPWEucHJldmlvdXNTaWJsaW5nO3JldHVybiBhfSxnZXRfbm9kZTpmdW5jdGlvbihiLGMpe2ImJmIuaWQmJihiPWIuaWQpO3ZhciBkO3RyeXtpZih0aGlzLl9tb2RlbC5kYXRhW2JdKWI9dGhpcy5fbW9kZWwuZGF0YVtiXTtlbHNlIGlmKFwic3RyaW5nXCI9PXR5cGVvZiBiJiZ0aGlzLl9tb2RlbC5kYXRhW2IucmVwbGFjZSgvXiMvLFwiXCIpXSliPXRoaXMuX21vZGVsLmRhdGFbYi5yZXBsYWNlKC9eIy8sXCJcIildO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJihkPWEoXCIjXCIrYi5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KSkubGVuZ3RoJiZ0aGlzLl9tb2RlbC5kYXRhW2QuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildKWI9dGhpcy5fbW9kZWwuZGF0YVtkLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuYXR0cihcImlkXCIpXTtlbHNlIGlmKChkPWEoYix0aGlzLmVsZW1lbnQpKS5sZW5ndGgmJnRoaXMuX21vZGVsLmRhdGFbZC5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV0pYj10aGlzLl9tb2RlbC5kYXRhW2QuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildO2Vsc2V7aWYoIShkPWEoYix0aGlzLmVsZW1lbnQpKS5sZW5ndGh8fCFkLmhhc0NsYXNzKFwianN0cmVlXCIpKXJldHVybiExO2I9dGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XX1yZXR1cm4gYyYmKGI9Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5lbGVtZW50OmEoXCIjXCIrYi5pZC5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KSksYn1jYXRjaChlKXtyZXR1cm4hMX19LGdldF9wYXRoOmZ1bmN0aW9uKGIsYyxkKXtpZihiPWIucGFyZW50cz9iOnRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290fHwhYi5wYXJlbnRzKXJldHVybiExO3ZhciBlLGYsZz1bXTtmb3IoZy5wdXNoKGQ/Yi5pZDpiLnRleHQpLGU9MCxmPWIucGFyZW50cy5sZW5ndGg7Zj5lO2UrKylnLnB1c2goZD9iLnBhcmVudHNbZV06dGhpcy5nZXRfdGV4dChiLnBhcmVudHNbZV0pKTtyZXR1cm4gZz1nLnJldmVyc2UoKS5zbGljZSgxKSxjP2cuam9pbihjKTpnfSxnZXRfbmV4dF9kb206ZnVuY3Rpb24oYixjKXt2YXIgZDtpZihiPXRoaXMuZ2V0X25vZGUoYiwhMCksYlswXT09PXRoaXMuZWxlbWVudFswXSl7ZD10aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpZD10aGlzLl9uZXh0U2libGluZyhkKTtyZXR1cm4gZD9hKGQpOiExfWlmKCFifHwhYi5sZW5ndGgpcmV0dXJuITE7aWYoYyl7ZD1iWzBdO2RvIGQ9dGhpcy5fbmV4dFNpYmxpbmcoZCk7d2hpbGUoZCYmMD09PWQub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gZD9hKGQpOiExfWlmKGIuaGFzQ2xhc3MoXCJqc3RyZWUtb3BlblwiKSl7ZD10aGlzLl9maXJzdENoaWxkKGIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpZD10aGlzLl9uZXh0U2libGluZyhkKTtpZihudWxsIT09ZClyZXR1cm4gYShkKX1kPWJbMF07ZG8gZD10aGlzLl9uZXh0U2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO3JldHVybiBudWxsIT09ZD9hKGQpOmIucGFyZW50c1VudGlsKFwiLmpzdHJlZVwiLFwiLmpzdHJlZS1ub2RlXCIpLm5leHRBbGwoXCIuanN0cmVlLW5vZGU6dmlzaWJsZVwiKS5maXJzdCgpfSxnZXRfcHJldl9kb206ZnVuY3Rpb24oYixjKXt2YXIgZDtpZihiPXRoaXMuZ2V0X25vZGUoYiwhMCksYlswXT09PXRoaXMuZWxlbWVudFswXSl7ZD10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5sYXN0Q2hpbGQ7d2hpbGUoZCYmMD09PWQub2Zmc2V0SGVpZ2h0KWQ9dGhpcy5fcHJldmlvdXNTaWJsaW5nKGQpO3JldHVybiBkP2EoZCk6ITF9aWYoIWJ8fCFiLmxlbmd0aClyZXR1cm4hMTtpZihjKXtkPWJbMF07ZG8gZD10aGlzLl9wcmV2aW91c1NpYmxpbmcoZCk7d2hpbGUoZCYmMD09PWQub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gZD9hKGQpOiExfWQ9YlswXTtkbyBkPXRoaXMuX3ByZXZpb3VzU2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO2lmKG51bGwhPT1kKXtiPWEoZCk7d2hpbGUoYi5oYXNDbGFzcyhcImpzdHJlZS1vcGVuXCIpKWI9Yi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuZmlyc3QoKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZTp2aXNpYmxlOmxhc3RcIik7cmV0dXJuIGJ9cmV0dXJuIGQ9YlswXS5wYXJlbnROb2RlLnBhcmVudE5vZGUsZCYmZC5jbGFzc05hbWUmJi0xIT09ZC5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1ub2RlXCIpP2EoZCk6ITF9LGdldF9wYXJlbnQ6ZnVuY3Rpb24oYil7cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD9iLnBhcmVudDohMX0sZ2V0X2NoaWxkcmVuX2RvbTpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEsITApLGFbMF09PT10aGlzLmVsZW1lbnRbMF0/dGhpcy5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oXCIuanN0cmVlLW5vZGVcIik6YSYmYS5sZW5ndGg/YS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuY2hpbGRyZW4oXCIuanN0cmVlLW5vZGVcIik6ITF9LGlzX3BhcmVudDpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJihhLnN0YXRlLmxvYWRlZD09PSExfHxhLmNoaWxkcmVuLmxlbmd0aD4wKX0saXNfbG9hZGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmYS5zdGF0ZS5sb2FkZWR9LGlzX2xvYWRpbmc6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZhLnN0YXRlJiZhLnN0YXRlLmxvYWRpbmd9LGlzX29wZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZhLnN0YXRlLm9wZW5lZH0saXNfY2xvc2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmdGhpcy5pc19wYXJlbnQoYSkmJiFhLnN0YXRlLm9wZW5lZH0saXNfbGVhZjpmdW5jdGlvbihhKXtyZXR1cm4hdGhpcy5pc19wYXJlbnQoYSl9LGxvYWRfbm9kZTpmdW5jdGlvbihiLGMpe3ZhciBkLGUsZixnLGg7aWYoYS5pc0FycmF5KGIpKXJldHVybiB0aGlzLl9sb2FkX25vZGVzKGIuc2xpY2UoKSxjKSwhMDtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWIpcmV0dXJuIGMmJmMuY2FsbCh0aGlzLGIsITEpLCExO2lmKGIuc3RhdGUubG9hZGVkKXtmb3IoYi5zdGF0ZS5sb2FkZWQ9ITEsZj0wLGc9Yi5wYXJlbnRzLmxlbmd0aDtnPmY7ZisrKXRoaXMuX21vZGVsLmRhdGFbYi5wYXJlbnRzW2ZdXS5jaGlsZHJlbl9kPWEudmFrYXRhLmFycmF5X2ZpbHRlcih0aGlzLl9tb2RlbC5kYXRhW2IucGFyZW50c1tmXV0uY2hpbGRyZW5fZCxmdW5jdGlvbihjKXtyZXR1cm4tMT09PWEuaW5BcnJheShjLGIuY2hpbGRyZW5fZCl9KTtmb3IoZD0wLGU9Yi5jaGlsZHJlbl9kLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2RdXS5zdGF0ZS5zZWxlY3RlZCYmKGg9ITApLGRlbGV0ZSB0aGlzLl9tb2RlbC5kYXRhW2IuY2hpbGRyZW5fZFtkXV07aCYmKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9maWx0ZXIodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGZ1bmN0aW9uKGMpe3JldHVybi0xPT09YS5pbkFycmF5KGMsYi5jaGlsZHJlbl9kKX0pKSxiLmNoaWxkcmVuPVtdLGIuY2hpbGRyZW5fZD1bXSxoJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImxvYWRfbm9kZVwiLG5vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KX1yZXR1cm4gYi5zdGF0ZS5mYWlsZWQ9ITEsYi5zdGF0ZS5sb2FkaW5nPSEwLHRoaXMuZ2V0X25vZGUoYiwhMCkuYWRkQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITApLHRoaXMuX2xvYWRfbm9kZShiLGEucHJveHkoZnVuY3Rpb24oYSl7Yj10aGlzLl9tb2RlbC5kYXRhW2IuaWRdLGIuc3RhdGUubG9hZGluZz0hMSxiLnN0YXRlLmxvYWRlZD1hLGIuc3RhdGUuZmFpbGVkPSFiLnN0YXRlLmxvYWRlZDt2YXIgZD10aGlzLmdldF9ub2RlKGIsITApLGU9MCxmPTAsZz10aGlzLl9tb2RlbC5kYXRhLGg9ITE7Zm9yKGU9MCxmPWIuY2hpbGRyZW4ubGVuZ3RoO2Y+ZTtlKyspaWYoZ1tiLmNoaWxkcmVuW2VdXSYmIWdbYi5jaGlsZHJlbltlXV0uc3RhdGUuaGlkZGVuKXtoPSEwO2JyZWFrfWIuc3RhdGUubG9hZGVkJiZkJiZkLmxlbmd0aCYmKGQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xvc2VkIGpzdHJlZS1vcGVuIGpzdHJlZS1sZWFmXCIpLGg/XCIjXCIhPT1iLmlkJiZkLmFkZENsYXNzKGIuc3RhdGUub3BlbmVkP1wianN0cmVlLW9wZW5cIjpcImpzdHJlZS1jbG9zZWRcIik6ZC5hZGRDbGFzcyhcImpzdHJlZS1sZWFmXCIpKSxkLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKSx0aGlzLnRyaWdnZXIoXCJsb2FkX25vZGVcIix7bm9kZTpiLHN0YXR1czphfSksYyYmYy5jYWxsKHRoaXMsYixhKX0sdGhpcykpLCEwfSxfbG9hZF9ub2RlczpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT0hMCxmPWZ1bmN0aW9uKCl7dGhpcy5fbG9hZF9ub2RlcyhhLGIsITApfSxnPXRoaXMuX21vZGVsLmRhdGEsaCxpLGo9W107Zm9yKGg9MCxpPWEubGVuZ3RoO2k+aDtoKyspZ1thW2hdXSYmKCFnW2FbaF1dLnN0YXRlLmxvYWRlZCYmIWdbYVtoXV0uc3RhdGUuZmFpbGVkfHwhYyYmZCkmJih0aGlzLmlzX2xvYWRpbmcoYVtoXSl8fHRoaXMubG9hZF9ub2RlKGFbaF0sZiksZT0hMSk7aWYoZSl7Zm9yKGg9MCxpPWEubGVuZ3RoO2k+aDtoKyspZ1thW2hdXSYmZ1thW2hdXS5zdGF0ZS5sb2FkZWQmJmoucHVzaChhW2hdKTtiJiYhYi5kb25lJiYoYi5jYWxsKHRoaXMsaiksYi5kb25lPSEwKX19LGxvYWRfYWxsOmZ1bmN0aW9uKGIsYyl7aWYoYnx8KGI9YS5qc3RyZWUucm9vdCksYj10aGlzLmdldF9ub2RlKGIpLCFiKXJldHVybiExO3ZhciBkPVtdLGU9dGhpcy5fbW9kZWwuZGF0YSxmPWVbYi5pZF0uY2hpbGRyZW5fZCxnLGg7Zm9yKGIuc3RhdGUmJiFiLnN0YXRlLmxvYWRlZCYmZC5wdXNoKGIuaWQpLGc9MCxoPWYubGVuZ3RoO2g+ZztnKyspZVtmW2ddXSYmZVtmW2ddXS5zdGF0ZSYmIWVbZltnXV0uc3RhdGUubG9hZGVkJiZkLnB1c2goZltnXSk7ZC5sZW5ndGg/dGhpcy5fbG9hZF9ub2RlcyhkLGZ1bmN0aW9uKCl7dGhpcy5sb2FkX2FsbChiLGMpfSk6KGMmJmMuY2FsbCh0aGlzLGIpLHRoaXMudHJpZ2dlcihcImxvYWRfYWxsXCIse25vZGU6Yn0pKX0sX2xvYWRfbm9kZTpmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuc2V0dGluZ3MuY29yZS5kYXRhLGU7cmV0dXJuIGQ/YS5pc0Z1bmN0aW9uKGQpP2QuY2FsbCh0aGlzLGIsYS5wcm94eShmdW5jdGlvbihkKXtkPT09ITE/Yy5jYWxsKHRoaXMsITEpOnRoaXNbXCJzdHJpbmdcIj09dHlwZW9mIGQ/XCJfYXBwZW5kX2h0bWxfZGF0YVwiOlwiX2FwcGVuZF9qc29uX2RhdGFcIl0oYixcInN0cmluZ1wiPT10eXBlb2YgZD9hKGEucGFyc2VIVE1MKGQpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KTpkLGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLGEpfSl9LHRoaXMpKTpcIm9iamVjdFwiPT10eXBlb2YgZD9kLnVybD8oZD1hLmV4dGVuZCghMCx7fSxkKSxhLmlzRnVuY3Rpb24oZC51cmwpJiYoZC51cmw9ZC51cmwuY2FsbCh0aGlzLGIpKSxhLmlzRnVuY3Rpb24oZC5kYXRhKSYmKGQuZGF0YT1kLmRhdGEuY2FsbCh0aGlzLGIpKSxhLmFqYXgoZCkuZG9uZShhLnByb3h5KGZ1bmN0aW9uKGQsZSxmKXt2YXIgZz1mLmdldFJlc3BvbnNlSGVhZGVyKFwiQ29udGVudC1UeXBlXCIpO3JldHVybiBnJiYtMSE9PWcuaW5kZXhPZihcImpzb25cIil8fFwib2JqZWN0XCI9PXR5cGVvZiBkP3RoaXMuX2FwcGVuZF9qc29uX2RhdGEoYixkLGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLGEpfSk6ZyYmLTEhPT1nLmluZGV4T2YoXCJodG1sXCIpfHxcInN0cmluZ1wiPT10eXBlb2YgZD90aGlzLl9hcHBlbmRfaHRtbF9kYXRhKGIsYShhLnBhcnNlSFRNTChkKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDMhPT10aGlzLm5vZGVUeXBlfSksZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiYWpheFwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDRcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6Yi5pZCx4aHI6Zn0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSxjLmNhbGwodGhpcywhMSkpfSx0aGlzKSkuZmFpbChhLnByb3h5KGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLCExKSx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNFwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDpiLmlkLHhocjphfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpfSx0aGlzKSkpOihlPWEuaXNBcnJheShkKXx8YS5pc1BsYWluT2JqZWN0KGQpP0pTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZCkpOmQsYi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2pzb25fZGF0YShiLGUsZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwibm9kYXRhXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNVwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDpiLmlkfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLGMuY2FsbCh0aGlzLCExKSkpOlwic3RyaW5nXCI9PXR5cGVvZiBkP2IuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuX2FwcGVuZF9odG1sX2RhdGEoYixhKGEucGFyc2VIVE1MKGQpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJub2RhdGFcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA2XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOmIuaWR9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksYy5jYWxsKHRoaXMsITEpKTpjLmNhbGwodGhpcywhMSk6Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2h0bWxfZGF0YShiLHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbC5jbG9uZSghMCksZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KTpjLmNhbGwodGhpcywhMSl9LF9ub2RlX2NoYW5nZWQ6ZnVuY3Rpb24oYSl7YT10aGlzLmdldF9ub2RlKGEpLGEmJnRoaXMuX21vZGVsLmNoYW5nZWQucHVzaChhLmlkKX0sX2FwcGVuZF9odG1sX2RhdGE6ZnVuY3Rpb24oYixjLGQpe2I9dGhpcy5nZXRfbm9kZShiKSxiLmNoaWxkcmVuPVtdLGIuY2hpbGRyZW5fZD1bXTt2YXIgZT1jLmlzKFwidWxcIik/Yy5jaGlsZHJlbigpOmMsZj1iLmlkLGc9W10saD1bXSxpPXRoaXMuX21vZGVsLmRhdGEsaj1pW2ZdLGs9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCxsLG0sbjtmb3IoZS5lYWNoKGEucHJveHkoZnVuY3Rpb24oYixjKXtsPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21faHRtbChhKGMpLGYsai5wYXJlbnRzLmNvbmNhdCgpKSxsJiYoZy5wdXNoKGwpLGgucHVzaChsKSxpW2xdLmNoaWxkcmVuX2QubGVuZ3RoJiYoaD1oLmNvbmNhdChpW2xdLmNoaWxkcmVuX2QpKSl9LHRoaXMpKSxqLmNoaWxkcmVuPWcsai5jaGlsZHJlbl9kPWgsbT0wLG49ai5wYXJlbnRzLmxlbmd0aDtuPm07bSsrKWlbai5wYXJlbnRzW21dXS5jaGlsZHJlbl9kPWlbai5wYXJlbnRzW21dXS5jaGlsZHJlbl9kLmNvbmNhdChoKTt0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpoLHBhcmVudDpmfSksZiE9PWEuanN0cmVlLnJvb3Q/KHRoaXMuX25vZGVfY2hhbmdlZChmKSx0aGlzLnJlZHJhdygpKToodGhpcy5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oXCIuanN0cmVlLWluaXRpYWwtbm9kZVwiKS5yZW1vdmUoKSx0aGlzLnJlZHJhdyghMCkpLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGghPT1rJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcIm1vZGVsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksZC5jYWxsKHRoaXMsITApfSxfYXBwZW5kX2pzb25fZGF0YTpmdW5jdGlvbihiLGMsZCxlKXtpZihudWxsIT09dGhpcy5lbGVtZW50KXtiPXRoaXMuZ2V0X25vZGUoYiksYi5jaGlsZHJlbj1bXSxiLmNoaWxkcmVuX2Q9W10sYy5kJiYoYz1jLmQsXCJzdHJpbmdcIj09dHlwZW9mIGMmJihjPUpTT04ucGFyc2UoYykpKSxhLmlzQXJyYXkoYyl8fChjPVtjXSk7dmFyIGY9bnVsbCxnPXtkZjp0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLGRhdDpjLHBhcjpiLmlkLG06dGhpcy5fbW9kZWwuZGF0YSx0X2lkOnRoaXMuX2lkLHRfY250OnRoaXMuX2NudCxzZWw6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSxoPWZ1bmN0aW9uKGEsYil7YS5kYXRhJiYoYT1hLmRhdGEpO3ZhciBjPWEuZGF0LGQ9YS5wYXIsZT1bXSxmPVtdLGc9W10saD1hLmRmLGk9YS50X2lkLGo9YS50X2NudCxrPWEubSxsPWtbZF0sbT1hLnNlbCxuLG8scCxxLHI9ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT1hLmlkLnRvU3RyaW5nKCksZixpLGosbCxtPXtpZDplLHRleHQ6YS50ZXh0fHxcIlwiLGljb246YS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOmEuY2hpbGRyZW58fFtdLGNoaWxkcmVuX2Q6YS5jaGlsZHJlbl9kfHxbXSxkYXRhOmEuZGF0YSxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKGYgaW4gaCloLmhhc093blByb3BlcnR5KGYpJiYobS5zdGF0ZVtmXT1oW2ZdKTtpZihhJiZhLmRhdGEmJmEuZGF0YS5qc3RyZWUmJmEuZGF0YS5qc3RyZWUuaWNvbiYmKG0uaWNvbj1hLmRhdGEuanN0cmVlLmljb24pLG0uaWNvbiE9PWImJm51bGwhPT1tLmljb24mJlwiXCIhPT1tLmljb258fChtLmljb249ITApLGEmJmEuZGF0YSYmKG0uZGF0YT1hLmRhdGEsYS5kYXRhLmpzdHJlZSkpZm9yKGYgaW4gYS5kYXRhLmpzdHJlZSlhLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGYpJiYobS5zdGF0ZVtmXT1hLmRhdGEuanN0cmVlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5zdGF0ZSlmb3IoZiBpbiBhLnN0YXRlKWEuc3RhdGUuaGFzT3duUHJvcGVydHkoZikmJihtLnN0YXRlW2ZdPWEuc3RhdGVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmxpX2F0dHIpZm9yKGYgaW4gYS5saV9hdHRyKWEubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKG0ubGlfYXR0cltmXT1hLmxpX2F0dHJbZl0pO2lmKG0ubGlfYXR0ci5pZHx8KG0ubGlfYXR0ci5pZD1lKSxhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5hX2F0dHIpZm9yKGYgaW4gYS5hX2F0dHIpYS5hX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihtLmFfYXR0cltmXT1hLmFfYXR0cltmXSk7Zm9yKGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKG0uc3RhdGUubG9hZGVkPSExLG0uY2hpbGRyZW49W10sbS5jaGlsZHJlbl9kPVtdKSxrW20uaWRdPW0sZj0wLGk9bS5jaGlsZHJlbi5sZW5ndGg7aT5mO2YrKylqPXIoa1ttLmNoaWxkcmVuW2ZdXSxtLmlkLGQpLGw9a1tqXSxtLmNoaWxkcmVuX2QucHVzaChqKSxsLmNoaWxkcmVuX2QubGVuZ3RoJiYobS5jaGlsZHJlbl9kPW0uY2hpbGRyZW5fZC5jb25jYXQobC5jaGlsZHJlbl9kKSk7cmV0dXJuIGRlbGV0ZSBhLmRhdGEsZGVsZXRlIGEuY2hpbGRyZW4sa1ttLmlkXS5vcmlnaW5hbD1hLG0uc3RhdGUuc2VsZWN0ZWQmJmcucHVzaChtLmlkKSxtLmlkfSxzPWZ1bmN0aW9uKGEsYyxkKXtkPWQ/ZC5jb25jYXQoKTpbXSxjJiZkLnVuc2hpZnQoYyk7dmFyIGU9ITEsZixsLG0sbixvO2RvIGU9XCJqXCIraStcIl9cIisgKytqO3doaWxlKGtbZV0pO289e2lkOiExLHRleHQ6XCJzdHJpbmdcIj09dHlwZW9mIGE/YTpcIlwiLGljb246XCJvYmplY3RcIj09dHlwZW9mIGEmJmEuaWNvbiE9PWI/YS5pY29uOiEwLHBhcmVudDpjLHBhcmVudHM6ZCxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKGYgaW4gaCloLmhhc093blByb3BlcnR5KGYpJiYoby5zdGF0ZVtmXT1oW2ZdKTtpZihhJiZhLmlkJiYoby5pZD1hLmlkLnRvU3RyaW5nKCkpLGEmJmEudGV4dCYmKG8udGV4dD1hLnRleHQpLGEmJmEuZGF0YSYmYS5kYXRhLmpzdHJlZSYmYS5kYXRhLmpzdHJlZS5pY29uJiYoby5pY29uPWEuZGF0YS5qc3RyZWUuaWNvbiksby5pY29uIT09YiYmbnVsbCE9PW8uaWNvbiYmXCJcIiE9PW8uaWNvbnx8KG8uaWNvbj0hMCksYSYmYS5kYXRhJiYoby5kYXRhPWEuZGF0YSxhLmRhdGEuanN0cmVlKSlmb3IoZiBpbiBhLmRhdGEuanN0cmVlKWEuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkoZikmJihvLnN0YXRlW2ZdPWEuZGF0YS5qc3RyZWVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLnN0YXRlKWZvcihmIGluIGEuc3RhdGUpYS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShmKSYmKG8uc3RhdGVbZl09YS5zdGF0ZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEubGlfYXR0cilmb3IoZiBpbiBhLmxpX2F0dHIpYS5saV9hdHRyLmhhc093blByb3BlcnR5KGYpJiYoby5saV9hdHRyW2ZdPWEubGlfYXR0cltmXSk7aWYoby5saV9hdHRyLmlkJiYhby5pZCYmKG8uaWQ9by5saV9hdHRyLmlkLnRvU3RyaW5nKCkpLG8uaWR8fChvLmlkPWUpLG8ubGlfYXR0ci5pZHx8KG8ubGlfYXR0ci5pZD1vLmlkKSxhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5hX2F0dHIpZm9yKGYgaW4gYS5hX2F0dHIpYS5hX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihvLmFfYXR0cltmXT1hLmFfYXR0cltmXSk7aWYoYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbi5sZW5ndGgpe2ZvcihmPTAsbD1hLmNoaWxkcmVuLmxlbmd0aDtsPmY7ZisrKW09cyhhLmNoaWxkcmVuW2ZdLG8uaWQsZCksbj1rW21dLG8uY2hpbGRyZW4ucHVzaChtKSxuLmNoaWxkcmVuX2QubGVuZ3RoJiYoby5jaGlsZHJlbl9kPW8uY2hpbGRyZW5fZC5jb25jYXQobi5jaGlsZHJlbl9kKSk7by5jaGlsZHJlbl9kPW8uY2hpbGRyZW5fZC5jb25jYXQoby5jaGlsZHJlbil9cmV0dXJuIGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKG8uc3RhdGUubG9hZGVkPSExLG8uY2hpbGRyZW49W10sby5jaGlsZHJlbl9kPVtdKSxkZWxldGUgYS5kYXRhLGRlbGV0ZSBhLmNoaWxkcmVuLG8ub3JpZ2luYWw9YSxrW28uaWRdPW8sby5zdGF0ZS5zZWxlY3RlZCYmZy5wdXNoKG8uaWQpLG8uaWR9O2lmKGMubGVuZ3RoJiZjWzBdLmlkIT09YiYmY1swXS5wYXJlbnQhPT1iKXtmb3Iobz0wLHA9Yy5sZW5ndGg7cD5vO28rKyljW29dLmNoaWxkcmVufHwoY1tvXS5jaGlsZHJlbj1bXSksa1tjW29dLmlkLnRvU3RyaW5nKCldPWNbb107Zm9yKG89MCxwPWMubGVuZ3RoO3A+bztvKyspa1tjW29dLnBhcmVudC50b1N0cmluZygpXS5jaGlsZHJlbi5wdXNoKGNbb10uaWQudG9TdHJpbmcoKSksbC5jaGlsZHJlbl9kLnB1c2goY1tvXS5pZC50b1N0cmluZygpKTtmb3Iobz0wLHA9bC5jaGlsZHJlbi5sZW5ndGg7cD5vO28rKyluPXIoa1tsLmNoaWxkcmVuW29dXSxkLGwucGFyZW50cy5jb25jYXQoKSksZi5wdXNoKG4pLGtbbl0uY2hpbGRyZW5fZC5sZW5ndGgmJihmPWYuY29uY2F0KGtbbl0uY2hpbGRyZW5fZCkpO2ZvcihvPTAscD1sLnBhcmVudHMubGVuZ3RoO3A+bztvKyspa1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2Q9a1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2QuY29uY2F0KGYpO3E9e2NudDpqLG1vZDprLHNlbDptLHBhcjpkLGRwYzpmLGFkZDpnfX1lbHNle2ZvcihvPTAscD1jLmxlbmd0aDtwPm87bysrKW49cyhjW29dLGQsbC5wYXJlbnRzLmNvbmNhdCgpKSxuJiYoZS5wdXNoKG4pLGYucHVzaChuKSxrW25dLmNoaWxkcmVuX2QubGVuZ3RoJiYoZj1mLmNvbmNhdChrW25dLmNoaWxkcmVuX2QpKSk7Zm9yKGwuY2hpbGRyZW49ZSxsLmNoaWxkcmVuX2Q9ZixvPTAscD1sLnBhcmVudHMubGVuZ3RoO3A+bztvKyspa1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2Q9a1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2QuY29uY2F0KGYpO3E9e2NudDpqLG1vZDprLHNlbDptLHBhcjpkLGRwYzpmLGFkZDpnfX1yZXR1cm5cInVuZGVmaW5lZFwiIT10eXBlb2Ygd2luZG93JiZcInVuZGVmaW5lZFwiIT10eXBlb2Ygd2luZG93LmRvY3VtZW50P3E6dm9pZCBwb3N0TWVzc2FnZShxKX0saT1mdW5jdGlvbihiLGMpe2lmKG51bGwhPT10aGlzLmVsZW1lbnQpe3RoaXMuX2NudD1iLmNudDt2YXIgZSxmPXRoaXMuX21vZGVsLmRhdGE7Zm9yKGUgaW4gZilmLmhhc093blByb3BlcnR5KGUpJiZmW2VdLnN0YXRlJiZmW2VdLnN0YXRlLmxvYWRpbmcmJmIubW9kW2VdJiYoYi5tb2RbZV0uc3RhdGUubG9hZGluZz0hMCk7aWYodGhpcy5fbW9kZWwuZGF0YT1iLm1vZCxjKXt2YXIgZyxoPWIuYWRkLGk9Yi5zZWwsaj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuc2xpY2UoKTtpZihmPXRoaXMuX21vZGVsLmRhdGEsaS5sZW5ndGghPT1qLmxlbmd0aHx8YS52YWthdGEuYXJyYXlfdW5pcXVlKGkuY29uY2F0KGopKS5sZW5ndGghPT1pLmxlbmd0aCl7Zm9yKGU9MCxnPWkubGVuZ3RoO2c+ZTtlKyspLTE9PT1hLmluQXJyYXkoaVtlXSxoKSYmLTE9PT1hLmluQXJyYXkoaVtlXSxqKSYmKGZbaVtlXV0uc3RhdGUuc2VsZWN0ZWQ9ITEpO2ZvcihlPTAsZz1qLmxlbmd0aDtnPmU7ZSsrKS0xPT09YS5pbkFycmF5KGpbZV0saSkmJihmW2pbZV1dLnN0YXRlLnNlbGVjdGVkPSEwKX19Yi5hZGQubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoYi5hZGQpKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpiLmRwYyxwYXJlbnQ6Yi5wYXJ9KSxiLnBhciE9PWEuanN0cmVlLnJvb3Q/KHRoaXMuX25vZGVfY2hhbmdlZChiLnBhciksdGhpcy5yZWRyYXcoKSk6dGhpcy5yZWRyYXcoITApLGIuYWRkLmxlbmd0aCYmdGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJtb2RlbFwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pLGQuY2FsbCh0aGlzLCEwKX19O2lmKHRoaXMuc2V0dGluZ3MuY29yZS53b3JrZXImJndpbmRvdy5CbG9iJiZ3aW5kb3cuVVJMJiZ3aW5kb3cuV29ya2VyKXRyeXtudWxsPT09dGhpcy5fd3JrJiYodGhpcy5fd3JrPXdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyB3aW5kb3cuQmxvYihbXCJzZWxmLm9ubWVzc2FnZSA9IFwiK2gudG9TdHJpbmcoKV0se3R5cGU6XCJ0ZXh0L2phdmFzY3JpcHRcIn0pKSksIXRoaXMuX2RhdGEuY29yZS53b3JraW5nfHxlPyh0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMCxmPW5ldyB3aW5kb3cuV29ya2VyKHRoaXMuX3dyayksZi5vbm1lc3NhZ2U9YS5wcm94eShmdW5jdGlvbihhKXtpLmNhbGwodGhpcyxhLmRhdGEsITApO3RyeXtmLnRlcm1pbmF0ZSgpLGY9bnVsbH1jYXRjaChiKXt9dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5sZW5ndGg/dGhpcy5fYXBwZW5kX2pzb25fZGF0YS5hcHBseSh0aGlzLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUuc2hpZnQoKSk6dGhpcy5fZGF0YS5jb3JlLndvcmtpbmc9ITF9LHRoaXMpLGcucGFyP2YucG9zdE1lc3NhZ2UoZyk6dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5sZW5ndGg/dGhpcy5fYXBwZW5kX2pzb25fZGF0YS5hcHBseSh0aGlzLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUuc2hpZnQoKSk6dGhpcy5fZGF0YS5jb3JlLndvcmtpbmc9ITEpOnRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUucHVzaChbYixjLGQsITBdKX1jYXRjaChqKXtpLmNhbGwodGhpcyxoKGcpLCExKSx0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMX1lbHNlIGkuY2FsbCh0aGlzLGgoZyksITEpfX0sX3BhcnNlX21vZGVsX2Zyb21faHRtbDpmdW5jdGlvbihjLGQsZSl7ZT1lP1tdLmNvbmNhdChlKTpbXSxkJiZlLnVuc2hpZnQoZCk7dmFyIGYsZyxoPXRoaXMuX21vZGVsLmRhdGEsaT17aWQ6ITEsdGV4dDohMSxpY29uOiEwLHBhcmVudDpkLHBhcmVudHM6ZSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX0saixrLGw7Zm9yKGogaW4gdGhpcy5fbW9kZWwuZGVmYXVsdF9zdGF0ZSl0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLmhhc093blByb3BlcnR5KGopJiYoaS5zdGF0ZVtqXT10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlW2pdKTtpZihrPWEudmFrYXRhLmF0dHJpYnV0ZXMoYywhMCksYS5lYWNoKGssZnVuY3Rpb24oYixjKXtyZXR1cm4gYz1hLnRyaW0oYyksYy5sZW5ndGg/KGkubGlfYXR0cltiXT1jLHZvaWQoXCJpZFwiPT09YiYmKGkuaWQ9Yy50b1N0cmluZygpKSkpOiEwfSksaz1jLmNoaWxkcmVuKFwiYVwiKS5maXJzdCgpLGsubGVuZ3RoJiYoaz1hLnZha2F0YS5hdHRyaWJ1dGVzKGssITApLGEuZWFjaChrLGZ1bmN0aW9uKGIsYyl7Yz1hLnRyaW0oYyksYy5sZW5ndGgmJihpLmFfYXR0cltiXT1jKX0pKSxrPWMuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCkubGVuZ3RoP2MuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCkuY2xvbmUoKTpjLmNsb25lKCksay5jaGlsZHJlbihcImlucywgaSwgdWxcIikucmVtb3ZlKCksaz1rLmh0bWwoKSxrPWEoXCI8ZGl2IC8+XCIpLmh0bWwoayksaS50ZXh0PXRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0P2sudGV4dCgpOmsuaHRtbCgpLGs9Yy5kYXRhKCksaS5kYXRhPWs/YS5leHRlbmQoITAse30sayk6bnVsbCxpLnN0YXRlLm9wZW5lZD1jLmhhc0NsYXNzKFwianN0cmVlLW9wZW5cIiksaS5zdGF0ZS5zZWxlY3RlZD1jLmNoaWxkcmVuKFwiYVwiKS5oYXNDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLGkuc3RhdGUuZGlzYWJsZWQ9Yy5jaGlsZHJlbihcImFcIikuaGFzQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIiksaS5kYXRhJiZpLmRhdGEuanN0cmVlKWZvcihqIGluIGkuZGF0YS5qc3RyZWUpaS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShqKSYmKGkuc3RhdGVbal09aS5kYXRhLmpzdHJlZVtqXSk7az1jLmNoaWxkcmVuKFwiYVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLGsubGVuZ3RoJiYoaS5pY29uPWsuaGFzQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKT8hMTprLmF0dHIoXCJyZWxcIikpLGkuc3RhdGUuaWNvbiE9PWImJihpLmljb249aS5zdGF0ZS5pY29uKSxpLmljb24hPT1iJiZudWxsIT09aS5pY29uJiZcIlwiIT09aS5pY29ufHwoaS5pY29uPSEwKSxrPWMuY2hpbGRyZW4oXCJ1bFwiKS5jaGlsZHJlbihcImxpXCIpO2RvIGw9XCJqXCIrdGhpcy5faWQrXCJfXCIrICsrdGhpcy5fY250O3doaWxlKGhbbF0pO3JldHVybiBpLmlkPWkubGlfYXR0ci5pZD9pLmxpX2F0dHIuaWQudG9TdHJpbmcoKTpsLGsubGVuZ3RoPyhrLmVhY2goYS5wcm94eShmdW5jdGlvbihiLGMpe2Y9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9odG1sKGEoYyksaS5pZCxlKSxnPXRoaXMuX21vZGVsLmRhdGFbZl0saS5jaGlsZHJlbi5wdXNoKGYpLGcuY2hpbGRyZW5fZC5sZW5ndGgmJihpLmNoaWxkcmVuX2Q9aS5jaGlsZHJlbl9kLmNvbmNhdChnLmNoaWxkcmVuX2QpKX0sdGhpcykpLGkuY2hpbGRyZW5fZD1pLmNoaWxkcmVuX2QuY29uY2F0KGkuY2hpbGRyZW4pKTpjLmhhc0NsYXNzKFwianN0cmVlLWNsb3NlZFwiKSYmKGkuc3RhdGUubG9hZGVkPSExKSxpLmxpX2F0dHJbXCJjbGFzc1wiXSYmKGkubGlfYXR0cltcImNsYXNzXCJdPWkubGlfYXR0cltcImNsYXNzXCJdLnJlcGxhY2UoXCJqc3RyZWUtY2xvc2VkXCIsXCJcIikucmVwbGFjZShcImpzdHJlZS1vcGVuXCIsXCJcIikpLGkuYV9hdHRyW1wiY2xhc3NcIl0mJihpLmFfYXR0cltcImNsYXNzXCJdPWkuYV9hdHRyW1wiY2xhc3NcIl0ucmVwbGFjZShcImpzdHJlZS1jbGlja2VkXCIsXCJcIikucmVwbGFjZShcImpzdHJlZS1kaXNhYmxlZFwiLFwiXCIpKSxoW2kuaWRdPWksaS5zdGF0ZS5zZWxlY3RlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2goaS5pZCksaS5pZH0sX3BhcnNlX21vZGVsX2Zyb21fZmxhdF9qc29uOmZ1bmN0aW9uKGEsYyxkKXtkPWQ/ZC5jb25jYXQoKTpbXSxjJiZkLnVuc2hpZnQoYyk7dmFyIGU9YS5pZC50b1N0cmluZygpLGY9dGhpcy5fbW9kZWwuZGF0YSxnPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsaCxpLGosayxsPXtpZDplLHRleHQ6YS50ZXh0fHxcIlwiLGljb246YS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOmEuY2hpbGRyZW58fFtdLGNoaWxkcmVuX2Q6YS5jaGlsZHJlbl9kfHxbXSxkYXRhOmEuZGF0YSxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKGggaW4gZylnLmhhc093blByb3BlcnR5KGgpJiYobC5zdGF0ZVtoXT1nW2hdKTtpZihhJiZhLmRhdGEmJmEuZGF0YS5qc3RyZWUmJmEuZGF0YS5qc3RyZWUuaWNvbiYmKGwuaWNvbj1hLmRhdGEuanN0cmVlLmljb24pLGwuaWNvbiE9PWImJm51bGwhPT1sLmljb24mJlwiXCIhPT1sLmljb258fChsLmljb249ITApLGEmJmEuZGF0YSYmKGwuZGF0YT1hLmRhdGEsYS5kYXRhLmpzdHJlZSkpZm9yKGggaW4gYS5kYXRhLmpzdHJlZSlhLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGgpJiYobC5zdGF0ZVtoXT1hLmRhdGEuanN0cmVlW2hdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5zdGF0ZSlmb3IoaCBpbiBhLnN0YXRlKWEuc3RhdGUuaGFzT3duUHJvcGVydHkoaCkmJihsLnN0YXRlW2hdPWEuc3RhdGVbaF0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmxpX2F0dHIpZm9yKGggaW4gYS5saV9hdHRyKWEubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShoKSYmKGwubGlfYXR0cltoXT1hLmxpX2F0dHJbaF0pO2lmKGwubGlfYXR0ci5pZHx8KGwubGlfYXR0ci5pZD1lKSxhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5hX2F0dHIpZm9yKGggaW4gYS5hX2F0dHIpYS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaCkmJihsLmFfYXR0cltoXT1hLmFfYXR0cltoXSk7Zm9yKGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKGwuc3RhdGUubG9hZGVkPSExLGwuY2hpbGRyZW49W10sbC5jaGlsZHJlbl9kPVtdKSxmW2wuaWRdPWwsaD0wLGk9bC5jaGlsZHJlbi5sZW5ndGg7aT5oO2grKylqPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fZmxhdF9qc29uKGZbbC5jaGlsZHJlbltoXV0sbC5pZCxkKSxrPWZbal0sbC5jaGlsZHJlbl9kLnB1c2goaiksay5jaGlsZHJlbl9kLmxlbmd0aCYmKGwuY2hpbGRyZW5fZD1sLmNoaWxkcmVuX2QuY29uY2F0KGsuY2hpbGRyZW5fZCkpO3JldHVybiBkZWxldGUgYS5kYXRhLGRlbGV0ZSBhLmNoaWxkcmVuLGZbbC5pZF0ub3JpZ2luYWw9YSxsLnN0YXRlLnNlbGVjdGVkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQucHVzaChsLmlkKSxsLmlkfSxfcGFyc2VfbW9kZWxfZnJvbV9qc29uOmZ1bmN0aW9uKGEsYyxkKXtkPWQ/ZC5jb25jYXQoKTpbXSxjJiZkLnVuc2hpZnQoYyk7dmFyIGU9ITEsZixnLGgsaSxqPXRoaXMuX21vZGVsLmRhdGEsaz10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLGw7ZG8gZT1cImpcIit0aGlzLl9pZCtcIl9cIisgKyt0aGlzLl9jbnQ7d2hpbGUoaltlXSk7bD17aWQ6ITEsdGV4dDpcInN0cmluZ1wiPT10eXBlb2YgYT9hOlwiXCIsaWNvbjpcIm9iamVjdFwiPT10eXBlb2YgYSYmYS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoZiBpbiBrKWsuaGFzT3duUHJvcGVydHkoZikmJihsLnN0YXRlW2ZdPWtbZl0pO2lmKGEmJmEuaWQmJihsLmlkPWEuaWQudG9TdHJpbmcoKSksYSYmYS50ZXh0JiYobC50ZXh0PWEudGV4dCksYSYmYS5kYXRhJiZhLmRhdGEuanN0cmVlJiZhLmRhdGEuanN0cmVlLmljb24mJihsLmljb249YS5kYXRhLmpzdHJlZS5pY29uKSxsLmljb24hPT1iJiZudWxsIT09bC5pY29uJiZcIlwiIT09bC5pY29ufHwobC5pY29uPSEwKSxhJiZhLmRhdGEmJihsLmRhdGE9YS5kYXRhLGEuZGF0YS5qc3RyZWUpKWZvcihmIGluIGEuZGF0YS5qc3RyZWUpYS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShmKSYmKGwuc3RhdGVbZl09YS5kYXRhLmpzdHJlZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEuc3RhdGUpZm9yKGYgaW4gYS5zdGF0ZSlhLnN0YXRlLmhhc093blByb3BlcnR5KGYpJiYobC5zdGF0ZVtmXT1hLnN0YXRlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5saV9hdHRyKWZvcihmIGluIGEubGlfYXR0cilhLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihsLmxpX2F0dHJbZl09YS5saV9hdHRyW2ZdKTtpZihsLmxpX2F0dHIuaWQmJiFsLmlkJiYobC5pZD1sLmxpX2F0dHIuaWQudG9TdHJpbmcoKSksbC5pZHx8KGwuaWQ9ZSksbC5saV9hdHRyLmlkfHwobC5saV9hdHRyLmlkPWwuaWQpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoZiBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKGwuYV9hdHRyW2ZdPWEuYV9hdHRyW2ZdKTtpZihhJiZhLmNoaWxkcmVuJiZhLmNoaWxkcmVuLmxlbmd0aCl7Zm9yKGY9MCxnPWEuY2hpbGRyZW4ubGVuZ3RoO2c+ZjtmKyspaD10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24oYS5jaGlsZHJlbltmXSxsLmlkLGQpLGk9altoXSxsLmNoaWxkcmVuLnB1c2goaCksaS5jaGlsZHJlbl9kLmxlbmd0aCYmKGwuY2hpbGRyZW5fZD1sLmNoaWxkcmVuX2QuY29uY2F0KGkuY2hpbGRyZW5fZCkpO2wuY2hpbGRyZW5fZD1sLmNoaWxkcmVuX2QuY29uY2F0KGwuY2hpbGRyZW4pfXJldHVybiBhJiZhLmNoaWxkcmVuJiZhLmNoaWxkcmVuPT09ITAmJihsLnN0YXRlLmxvYWRlZD0hMSxsLmNoaWxkcmVuPVtdLGwuY2hpbGRyZW5fZD1bXSksZGVsZXRlIGEuZGF0YSxkZWxldGUgYS5jaGlsZHJlbixsLm9yaWdpbmFsPWEsaltsLmlkXT1sLGwuc3RhdGUuc2VsZWN0ZWQmJnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGwuaWQpLGwuaWR9LF9yZWRyYXc6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz90aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuLmNvbmNhdChbXSk6dGhpcy5fbW9kZWwuY2hhbmdlZC5jb25jYXQoW10pLGM9aS5jcmVhdGVFbGVtZW50KFwiVUxcIiksZCxlLGYsZz10aGlzLl9kYXRhLmNvcmUuZm9jdXNlZDtmb3IoZT0wLGY9Yi5sZW5ndGg7Zj5lO2UrKylkPXRoaXMucmVkcmF3X25vZGUoYltlXSwhMCx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyksZCYmdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXcmJmMuYXBwZW5kQ2hpbGQoZCk7dGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXcmJihjLmNsYXNzTmFtZT10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWUsYy5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSx0aGlzLmVsZW1lbnQuZW1wdHkoKS5hcHBlbmQoYykpLG51bGwhPT1nJiYoZD10aGlzLmdldF9ub2RlKGcsITApLGQmJmQubGVuZ3RoJiZkLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIilbMF0hPT1pLmFjdGl2ZUVsZW1lbnQ/ZC5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk6dGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITEsdGhpcy5fbW9kZWwuY2hhbmdlZD1bXSx0aGlzLnRyaWdnZXIoXCJyZWRyYXdcIix7bm9kZXM6Yn0pfSxyZWRyYXc6ZnVuY3Rpb24oYSl7YSYmKHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwKSx0aGlzLl9yZWRyYXcoKX0sZHJhd19jaGlsZHJlbjpmdW5jdGlvbihiKXt2YXIgYz10aGlzLmdldF9ub2RlKGIpLGQ9ITEsZT0hMSxmPSExLGc9aTtpZighYylyZXR1cm4hMTtpZihjLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4gdGhpcy5yZWRyYXcoITApO2lmKGI9dGhpcy5nZXRfbm9kZShiLCEwKSwhYnx8IWIubGVuZ3RoKXJldHVybiExO2lmKGIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnJlbW92ZSgpLGI9YlswXSxjLmNoaWxkcmVuLmxlbmd0aCYmYy5zdGF0ZS5sb2FkZWQpe2ZvcihmPWcuY3JlYXRlRWxlbWVudChcIlVMXCIpLGYuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiZ3JvdXBcIiksZi5jbGFzc05hbWU9XCJqc3RyZWUtY2hpbGRyZW5cIixkPTAsZT1jLmNoaWxkcmVuLmxlbmd0aDtlPmQ7ZCsrKWYuYXBwZW5kQ2hpbGQodGhpcy5yZWRyYXdfbm9kZShjLmNoaWxkcmVuW2RdLCEwLCEwKSk7Yi5hcHBlbmRDaGlsZChmKX19LHJlZHJhd19ub2RlOmZ1bmN0aW9uKGIsYyxkLGUpe3ZhciBmPXRoaXMuZ2V0X25vZGUoYiksZz0hMSxoPSExLGs9ITEsbD0hMSxtPSExLG49ITEsbz1cIlwiLHA9aSxxPXRoaXMuX21vZGVsLmRhdGEscj0hMSxzPSExLHQ9bnVsbCx1PTAsdj0wLHc9ITEseD0hMTtpZighZilyZXR1cm4hMTtpZihmLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4gdGhpcy5yZWRyYXcoITApO2lmKGM9Y3x8MD09PWYuY2hpbGRyZW4ubGVuZ3RoLGI9aS5xdWVyeVNlbGVjdG9yP3RoaXMuZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yKFwiI1wiKygtMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoZi5pZFswXSk/XCJcXFxcM1wiK2YuaWRbMF0rXCIgXCIrZi5pZC5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmYuaWQucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpKSk6aS5nZXRFbGVtZW50QnlJZChmLmlkKSliPWEoYiksXG5kfHwoZz1iLnBhcmVudCgpLnBhcmVudCgpWzBdLGc9PT10aGlzLmVsZW1lbnRbMF0mJihnPW51bGwpLGg9Yi5pbmRleCgpKSxjfHwhZi5jaGlsZHJlbi5sZW5ndGh8fGIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmxlbmd0aHx8KGM9ITApLGN8fChrPWIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKSxyPWIuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKVswXT09PWkuYWN0aXZlRWxlbWVudCxiLnJlbW92ZSgpO2Vsc2UgaWYoYz0hMCwhZCl7aWYoZz1mLnBhcmVudCE9PWEuanN0cmVlLnJvb3Q/YShcIiNcIitmLnBhcmVudC5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KVswXTpudWxsLCEobnVsbD09PWd8fGcmJnFbZi5wYXJlbnRdLnN0YXRlLm9wZW5lZCkpcmV0dXJuITE7aD1hLmluQXJyYXkoZi5pZCxudWxsPT09Zz9xW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuOnFbZi5wYXJlbnRdLmNoaWxkcmVuKX1iPWouY2xvbmVOb2RlKCEwKSxvPVwianN0cmVlLW5vZGUgXCI7Zm9yKGwgaW4gZi5saV9hdHRyKWlmKGYubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShsKSl7aWYoXCJpZFwiPT09bCljb250aW51ZTtcImNsYXNzXCIhPT1sP2Iuc2V0QXR0cmlidXRlKGwsZi5saV9hdHRyW2xdKTpvKz1mLmxpX2F0dHJbbF19Zm9yKGYuYV9hdHRyLmlkfHwoZi5hX2F0dHIuaWQ9Zi5pZCtcIl9hbmNob3JcIiksYi5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNlbGVjdGVkXCIsISFmLnN0YXRlLnNlbGVjdGVkKSxiLnNldEF0dHJpYnV0ZShcImFyaWEtbGV2ZWxcIixmLnBhcmVudHMubGVuZ3RoKSxiLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxsZWRieVwiLGYuYV9hdHRyLmlkKSxmLnN0YXRlLmRpc2FibGVkJiZiLnNldEF0dHJpYnV0ZShcImFyaWEtZGlzYWJsZWRcIiwhMCksbD0wLG09Zi5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKylpZighcVtmLmNoaWxkcmVuW2xdXS5zdGF0ZS5oaWRkZW4pe3c9ITA7YnJlYWt9aWYobnVsbCE9PWYucGFyZW50JiZxW2YucGFyZW50XSYmIWYuc3RhdGUuaGlkZGVuJiYobD1hLmluQXJyYXkoZi5pZCxxW2YucGFyZW50XS5jaGlsZHJlbikseD1mLmlkLC0xIT09bCkpZm9yKGwrKyxtPXFbZi5wYXJlbnRdLmNoaWxkcmVuLmxlbmd0aDttPmw7bCsrKWlmKHFbcVtmLnBhcmVudF0uY2hpbGRyZW5bbF1dLnN0YXRlLmhpZGRlbnx8KHg9cVtmLnBhcmVudF0uY2hpbGRyZW5bbF0pLHghPT1mLmlkKWJyZWFrO2Yuc3RhdGUuaGlkZGVuJiYobys9XCIganN0cmVlLWhpZGRlblwiKSxmLnN0YXRlLmxvYWRlZCYmIXc/bys9XCIganN0cmVlLWxlYWZcIjoobys9Zi5zdGF0ZS5vcGVuZWQmJmYuc3RhdGUubG9hZGVkP1wiIGpzdHJlZS1vcGVuXCI6XCIganN0cmVlLWNsb3NlZFwiLGIuc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLGYuc3RhdGUub3BlbmVkJiZmLnN0YXRlLmxvYWRlZCkpLHg9PT1mLmlkJiYobys9XCIganN0cmVlLWxhc3RcIiksYi5pZD1mLmlkLGIuY2xhc3NOYW1lPW8sbz0oZi5zdGF0ZS5zZWxlY3RlZD9cIiBqc3RyZWUtY2xpY2tlZFwiOlwiXCIpKyhmLnN0YXRlLmRpc2FibGVkP1wiIGpzdHJlZS1kaXNhYmxlZFwiOlwiXCIpO2ZvcihtIGluIGYuYV9hdHRyKWlmKGYuYV9hdHRyLmhhc093blByb3BlcnR5KG0pKXtpZihcImhyZWZcIj09PW0mJlwiI1wiPT09Zi5hX2F0dHJbbV0pY29udGludWU7XCJjbGFzc1wiIT09bT9iLmNoaWxkTm9kZXNbMV0uc2V0QXR0cmlidXRlKG0sZi5hX2F0dHJbbV0pOm8rPVwiIFwiK2YuYV9hdHRyW21dfWlmKG8ubGVuZ3RoJiYoYi5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZT1cImpzdHJlZS1hbmNob3IgXCIrbyksKGYuaWNvbiYmZi5pY29uIT09ITB8fGYuaWNvbj09PSExKSYmKGYuaWNvbj09PSExP2IuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLmNsYXNzTmFtZSs9XCIganN0cmVlLXRoZW1laWNvbi1oaWRkZW5cIjotMT09PWYuaWNvbi5pbmRleE9mKFwiL1wiKSYmLTE9PT1mLmljb24uaW5kZXhPZihcIi5cIik/Yi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBcIitmLmljb24rXCIganN0cmVlLXRoZW1laWNvbi1jdXN0b21cIjooYi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZEltYWdlPSd1cmwoXCInK2YuaWNvbisnXCIpJyxiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb249XCJjZW50ZXIgY2VudGVyXCIsYi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFNpemU9XCJhdXRvXCIsYi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKSksdGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQ/Yi5jaGlsZE5vZGVzWzFdLmFwcGVuZENoaWxkKHAuY3JlYXRlVGV4dE5vZGUoZi50ZXh0KSk6Yi5jaGlsZE5vZGVzWzFdLmlubmVySFRNTCs9Zi50ZXh0LGMmJmYuY2hpbGRyZW4ubGVuZ3RoJiYoZi5zdGF0ZS5vcGVuZWR8fGUpJiZmLnN0YXRlLmxvYWRlZCl7Zm9yKG49cC5jcmVhdGVFbGVtZW50KFwiVUxcIiksbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSxuLmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGw9MCxtPWYuY2hpbGRyZW4ubGVuZ3RoO20+bDtsKyspbi5hcHBlbmRDaGlsZCh0aGlzLnJlZHJhd19ub2RlKGYuY2hpbGRyZW5bbF0sYywhMCkpO2IuYXBwZW5kQ2hpbGQobil9aWYoayYmYi5hcHBlbmRDaGlsZChrKSwhZCl7Zm9yKGd8fChnPXRoaXMuZWxlbWVudFswXSksbD0wLG09Zy5jaGlsZE5vZGVzLmxlbmd0aDttPmw7bCsrKWlmKGcuY2hpbGROb2Rlc1tsXSYmZy5jaGlsZE5vZGVzW2xdLmNsYXNzTmFtZSYmLTEhPT1nLmNoaWxkTm9kZXNbbF0uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtY2hpbGRyZW5cIikpe3Q9Zy5jaGlsZE5vZGVzW2xdO2JyZWFrfXR8fCh0PXAuY3JlYXRlRWxlbWVudChcIlVMXCIpLHQuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiZ3JvdXBcIiksdC5jbGFzc05hbWU9XCJqc3RyZWUtY2hpbGRyZW5cIixnLmFwcGVuZENoaWxkKHQpKSxnPXQsaDxnLmNoaWxkTm9kZXMubGVuZ3RoP2cuaW5zZXJ0QmVmb3JlKGIsZy5jaGlsZE5vZGVzW2hdKTpnLmFwcGVuZENoaWxkKGIpLHImJih1PXRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3Asdj10aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdCxiLmNoaWxkTm9kZXNbMV0uZm9jdXMoKSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsVG9wPXUsdGhpcy5lbGVtZW50WzBdLnNjcm9sbExlZnQ9dil9cmV0dXJuIGYuc3RhdGUub3BlbmVkJiYhZi5zdGF0ZS5sb2FkZWQmJihmLnN0YXRlLm9wZW5lZD0hMSxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLm9wZW5fbm9kZShmLmlkLCExLDApfSx0aGlzKSwwKSksYn0sb3Blbl9ub2RlOmZ1bmN0aW9uKGMsZCxlKXt2YXIgZixnLGgsaTtpZihhLmlzQXJyYXkoYykpe2ZvcihjPWMuc2xpY2UoKSxmPTAsZz1jLmxlbmd0aDtnPmY7ZisrKXRoaXMub3Blbl9ub2RlKGNbZl0sZCxlKTtyZXR1cm4hMH1yZXR1cm4gYz10aGlzLmdldF9ub2RlKGMpLGMmJmMuaWQhPT1hLmpzdHJlZS5yb290PyhlPWU9PT1iP3RoaXMuc2V0dGluZ3MuY29yZS5hbmltYXRpb246ZSx0aGlzLmlzX2Nsb3NlZChjKT90aGlzLmlzX2xvYWRlZChjKT8oaD10aGlzLmdldF9ub2RlKGMsITApLGk9dGhpcyxoLmxlbmd0aCYmKGUmJmguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmxlbmd0aCYmaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuc3RvcCghMCwhMCksYy5jaGlsZHJlbi5sZW5ndGgmJiF0aGlzLl9maXJzdENoaWxkKGguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKSYmdGhpcy5kcmF3X2NoaWxkcmVuKGMpLGU/KHRoaXMudHJpZ2dlcihcImJlZm9yZV9vcGVuXCIse25vZGU6Y30pLGguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmNzcyhcImRpc3BsYXlcIixcIm5vbmVcIikuZW5kKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpLmFkZENsYXNzKFwianN0cmVlLW9wZW5cIikuYXR0cihcImFyaWEtZXhwYW5kZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnN0b3AoITAsITApLnNsaWRlRG93bihlLGZ1bmN0aW9uKCl7dGhpcy5zdHlsZS5kaXNwbGF5PVwiXCIsaS50cmlnZ2VyKFwiYWZ0ZXJfb3BlblwiLHtub2RlOmN9KX0pKToodGhpcy50cmlnZ2VyKFwiYmVmb3JlX29wZW5cIix7bm9kZTpjfSksaFswXS5jbGFzc05hbWU9aFswXS5jbGFzc05hbWUucmVwbGFjZShcImpzdHJlZS1jbG9zZWRcIixcImpzdHJlZS1vcGVuXCIpLGhbMF0uc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLCEwKSkpLGMuc3RhdGUub3BlbmVkPSEwLGQmJmQuY2FsbCh0aGlzLGMsITApLGgubGVuZ3RofHx0aGlzLnRyaWdnZXIoXCJiZWZvcmVfb3BlblwiLHtub2RlOmN9KSx0aGlzLnRyaWdnZXIoXCJvcGVuX25vZGVcIix7bm9kZTpjfSksZSYmaC5sZW5ndGh8fHRoaXMudHJpZ2dlcihcImFmdGVyX29wZW5cIix7bm9kZTpjfSksITApOnRoaXMuaXNfbG9hZGluZyhjKT9zZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLm9wZW5fbm9kZShjLGQsZSl9LHRoaXMpLDUwMCk6dm9pZCB0aGlzLmxvYWRfbm9kZShjLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGI/dGhpcy5vcGVuX25vZGUoYSxkLGUpOmQ/ZC5jYWxsKHRoaXMsYSwhMSk6ITF9KTooZCYmZC5jYWxsKHRoaXMsYywhMSksITEpKTohMX0sX29wZW5fdG86ZnVuY3Rpb24oYil7aWYoYj10aGlzLmdldF9ub2RlKGIpLCFifHxiLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4hMTt2YXIgYyxkLGU9Yi5wYXJlbnRzO2ZvcihjPTAsZD1lLmxlbmd0aDtkPmM7Yys9MSljIT09YS5qc3RyZWUucm9vdCYmdGhpcy5vcGVuX25vZGUoZVtjXSwhMSwwKTtyZXR1cm4gYShcIiNcIitiLmlkLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpfSxjbG9zZV9ub2RlOmZ1bmN0aW9uKGMsZCl7dmFyIGUsZixnLGg7aWYoYS5pc0FycmF5KGMpKXtmb3IoYz1jLnNsaWNlKCksZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyl0aGlzLmNsb3NlX25vZGUoY1tlXSxkKTtyZXR1cm4hMH1yZXR1cm4gYz10aGlzLmdldF9ub2RlKGMpLGMmJmMuaWQhPT1hLmpzdHJlZS5yb290P3RoaXMuaXNfY2xvc2VkKGMpPyExOihkPWQ9PT1iP3RoaXMuc2V0dGluZ3MuY29yZS5hbmltYXRpb246ZCxnPXRoaXMsaD10aGlzLmdldF9ub2RlKGMsITApLGMuc3RhdGUub3BlbmVkPSExLHRoaXMudHJpZ2dlcihcImNsb3NlX25vZGVcIix7bm9kZTpjfSksdm9pZChoLmxlbmd0aD9kP2guY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmF0dHIoXCJzdHlsZVwiLFwiZGlzcGxheTpibG9jayAhaW1wb3J0YW50XCIpLmVuZCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW9wZW5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKS5zbGlkZVVwKGQsZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9XCJcIixoLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5yZW1vdmUoKSxnLnRyaWdnZXIoXCJhZnRlcl9jbG9zZVwiLHtub2RlOmN9KX0pOihoWzBdLmNsYXNzTmFtZT1oWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwianN0cmVlLW9wZW5cIixcImpzdHJlZS1jbG9zZWRcIiksaC5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikucmVtb3ZlKCksdGhpcy50cmlnZ2VyKFwiYWZ0ZXJfY2xvc2VcIix7bm9kZTpjfSkpOnRoaXMudHJpZ2dlcihcImFmdGVyX2Nsb3NlXCIse25vZGU6Y30pKSk6ITF9LHRvZ2dsZV9ub2RlOmZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLnRvZ2dsZV9ub2RlKGJbY10pO3JldHVybiEwfXJldHVybiB0aGlzLmlzX2Nsb3NlZChiKT90aGlzLm9wZW5fbm9kZShiKTp0aGlzLmlzX29wZW4oYik/dGhpcy5jbG9zZV9ub2RlKGIpOnZvaWQgMH0sb3Blbl9hbGw6ZnVuY3Rpb24oYixjLGQpe2lmKGJ8fChiPWEuanN0cmVlLnJvb3QpLGI9dGhpcy5nZXRfbm9kZShiKSwhYilyZXR1cm4hMTt2YXIgZT1iLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLmdldF9jb250YWluZXJfdWwoKTp0aGlzLmdldF9ub2RlKGIsITApLGYsZyxoO2lmKCFlLmxlbmd0aCl7Zm9yKGY9MCxnPWIuY2hpbGRyZW5fZC5sZW5ndGg7Zz5mO2YrKyl0aGlzLmlzX2Nsb3NlZCh0aGlzLl9tb2RlbC5kYXRhW2IuY2hpbGRyZW5fZFtmXV0pJiYodGhpcy5fbW9kZWwuZGF0YVtiLmNoaWxkcmVuX2RbZl1dLnN0YXRlLm9wZW5lZD0hMCk7cmV0dXJuIHRoaXMudHJpZ2dlcihcIm9wZW5fYWxsXCIse25vZGU6Yn0pfWQ9ZHx8ZSxoPXRoaXMsZT10aGlzLmlzX2Nsb3NlZChiKT9lLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5hZGRCYWNrKCk6ZS5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIiksZS5lYWNoKGZ1bmN0aW9uKCl7aC5vcGVuX25vZGUodGhpcyxmdW5jdGlvbihhLGIpe2ImJnRoaXMuaXNfcGFyZW50KGEpJiZ0aGlzLm9wZW5fYWxsKGEsYyxkKX0sY3x8MCl9KSwwPT09ZC5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIikubGVuZ3RoJiZ0aGlzLnRyaWdnZXIoXCJvcGVuX2FsbFwiLHtub2RlOnRoaXMuZ2V0X25vZGUoZCl9KX0sY2xvc2VfYWxsOmZ1bmN0aW9uKGIsYyl7aWYoYnx8KGI9YS5qc3RyZWUucm9vdCksYj10aGlzLmdldF9ub2RlKGIpLCFiKXJldHVybiExO3ZhciBkPWIuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpOnRoaXMuZ2V0X25vZGUoYiwhMCksZT10aGlzLGYsZztmb3IoZC5sZW5ndGgmJihkPXRoaXMuaXNfb3BlbihiKT9kLmZpbmQoXCIuanN0cmVlLW9wZW5cIikuYWRkQmFjaygpOmQuZmluZChcIi5qc3RyZWUtb3BlblwiKSxhKGQuZ2V0KCkucmV2ZXJzZSgpKS5lYWNoKGZ1bmN0aW9uKCl7ZS5jbG9zZV9ub2RlKHRoaXMsY3x8MCl9KSksZj0wLGc9Yi5jaGlsZHJlbl9kLmxlbmd0aDtnPmY7ZisrKXRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2ZdXS5zdGF0ZS5vcGVuZWQ9ITE7dGhpcy50cmlnZ2VyKFwiY2xvc2VfYWxsXCIse25vZGU6Yn0pfSxpc19kaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmEuc3RhdGUmJmEuc3RhdGUuZGlzYWJsZWR9LGVuYWJsZV9ub2RlOmZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmVuYWJsZV9ub2RlKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGIuc3RhdGUuZGlzYWJsZWQ9ITEsdGhpcy5nZXRfbm9kZShiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWRpc2FibGVkXCIpLmF0dHIoXCJhcmlhLWRpc2FibGVkXCIsITEpLHZvaWQgdGhpcy50cmlnZ2VyKFwiZW5hYmxlX25vZGVcIix7bm9kZTpifSkpOiExfSxkaXNhYmxlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZGlzYWJsZV9ub2RlKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGIuc3RhdGUuZGlzYWJsZWQ9ITAsdGhpcy5nZXRfbm9kZShiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLWRpc2FibGVkXCIpLmF0dHIoXCJhcmlhLWRpc2FibGVkXCIsITApLHZvaWQgdGhpcy50cmlnZ2VyKFwiZGlzYWJsZV9ub2RlXCIse25vZGU6Yn0pKTohMX0saXNfaGlkZGVuOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYS5zdGF0ZS5oaWRkZW49PT0hMH0saGlkZV9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuaGlkZV9ub2RlKGJbZF0sITApO3JldHVybiBjfHx0aGlzLnJlZHJhdygpLCEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/dm9pZChiLnN0YXRlLmhpZGRlbnx8KGIuc3RhdGUuaGlkZGVuPSEwLHRoaXMuX25vZGVfY2hhbmdlZChiLnBhcmVudCksY3x8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJoaWRlX25vZGVcIix7bm9kZTpifSkpKTohMX0sc2hvd19ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuc2hvd19ub2RlKGJbZF0sITApO3JldHVybiBjfHx0aGlzLnJlZHJhdygpLCEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/dm9pZChiLnN0YXRlLmhpZGRlbiYmKGIuc3RhdGUuaGlkZGVuPSExLHRoaXMuX25vZGVfY2hhbmdlZChiLnBhcmVudCksY3x8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJzaG93X25vZGVcIix7bm9kZTpifSkpKTohMX0saGlkZV9hbGw6ZnVuY3Rpb24oYil7dmFyIGMsZD10aGlzLl9tb2RlbC5kYXRhLGU9W107Zm9yKGMgaW4gZClkLmhhc093blByb3BlcnR5KGMpJiZjIT09YS5qc3RyZWUucm9vdCYmIWRbY10uc3RhdGUuaGlkZGVuJiYoZFtjXS5zdGF0ZS5oaWRkZW49ITAsZS5wdXNoKGMpKTtyZXR1cm4gdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITAsYnx8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJoaWRlX2FsbFwiLHtub2RlczplfSksZX0sc2hvd19hbGw6ZnVuY3Rpb24oYil7dmFyIGMsZD10aGlzLl9tb2RlbC5kYXRhLGU9W107Zm9yKGMgaW4gZClkLmhhc093blByb3BlcnR5KGMpJiZjIT09YS5qc3RyZWUucm9vdCYmZFtjXS5zdGF0ZS5oaWRkZW4mJihkW2NdLnN0YXRlLmhpZGRlbj0hMSxlLnB1c2goYykpO3JldHVybiB0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCxifHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcInNob3dfYWxsXCIse25vZGVzOmV9KSxlfSxhY3RpdmF0ZV9ub2RlOmZ1bmN0aW9uKGEsYyl7aWYodGhpcy5pc19kaXNhYmxlZChhKSlyZXR1cm4hMTtpZihjJiZcIm9iamVjdFwiPT10eXBlb2YgY3x8KGM9e30pLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5pZCE9PWI/dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkKTpudWxsLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQmJiF0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLnN0YXRlLnNlbGVjdGVkJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD1udWxsKSwhdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCYmKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aC0xXSkpLHRoaXMuc2V0dGluZ3MuY29yZS5tdWx0aXBsZSYmKGMubWV0YUtleXx8Yy5jdHJsS2V5fHxjLnNoaWZ0S2V5KSYmKCFjLnNoaWZ0S2V5fHx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLmdldF9wYXJlbnQoYSkmJnRoaXMuZ2V0X3BhcmVudChhKT09PXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQucGFyZW50KSlpZihjLnNoaWZ0S2V5KXt2YXIgZD10aGlzLmdldF9ub2RlKGEpLmlkLGU9dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5pZCxmPXRoaXMuZ2V0X25vZGUodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5wYXJlbnQpLmNoaWxkcmVuLGc9ITEsaCxpO2ZvcihoPTAsaT1mLmxlbmd0aDtpPmg7aCs9MSlmW2hdPT09ZCYmKGc9IWcpLGZbaF09PT1lJiYoZz0hZyksdGhpcy5pc19kaXNhYmxlZChmW2hdKXx8IWcmJmZbaF0hPT1kJiZmW2hdIT09ZT90aGlzLmRlc2VsZWN0X25vZGUoZltoXSwhMCxjKTp0aGlzLmlzX2hpZGRlbihmW2hdKXx8dGhpcy5zZWxlY3Rfbm9kZShmW2hdLCEwLCExLGMpO3RoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwic2VsZWN0X25vZGVcIixub2RlOnRoaXMuZ2V0X25vZGUoYSksc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmN9KX1lbHNlIHRoaXMuaXNfc2VsZWN0ZWQoYSk/dGhpcy5kZXNlbGVjdF9ub2RlKGEsITEsYyk6dGhpcy5zZWxlY3Rfbm9kZShhLCExLCExLGMpO2Vsc2UhdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiYoYy5tZXRhS2V5fHxjLmN0cmxLZXl8fGMuc2hpZnRLZXkpJiZ0aGlzLmlzX3NlbGVjdGVkKGEpP3RoaXMuZGVzZWxlY3Rfbm9kZShhLCExLGMpOih0aGlzLmRlc2VsZWN0X2FsbCghMCksdGhpcy5zZWxlY3Rfbm9kZShhLCExLCExLGMpLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5nZXRfbm9kZShhKSk7dGhpcy50cmlnZ2VyKFwiYWN0aXZhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoYSksZXZlbnQ6Y30pfSxob3Zlcl9ub2RlOmZ1bmN0aW9uKGEpe2lmKGE9dGhpcy5nZXRfbm9kZShhLCEwKSwhYXx8IWEubGVuZ3RofHxhLmNoaWxkcmVuKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLmxlbmd0aClyZXR1cm4hMTt2YXIgYj10aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtaG92ZXJlZFwiKSxjPXRoaXMuZWxlbWVudDtiJiZiLmxlbmd0aCYmdGhpcy5kZWhvdmVyX25vZGUoYiksYS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLWhvdmVyZWRcIiksdGhpcy50cmlnZ2VyKFwiaG92ZXJfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoYSl9KSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsYVswXS5pZCl9LDApfSxkZWhvdmVyX25vZGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhLCEwKSxhJiZhLmxlbmd0aCYmYS5jaGlsZHJlbihcIi5qc3RyZWUtaG92ZXJlZFwiKS5sZW5ndGg/KGEuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpLHZvaWQgdGhpcy50cmlnZ2VyKFwiZGVob3Zlcl9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShhKX0pKTohMX0sc2VsZWN0X25vZGU6ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGYsZyxoLGk7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZz0wLGg9Yi5sZW5ndGg7aD5nO2crKyl0aGlzLnNlbGVjdF9ub2RlKGJbZ10sYyxkLGUpO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGY9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuc2VsZWN0ZWR8fChiLnN0YXRlLnNlbGVjdGVkPSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGIuaWQpLGR8fChmPXRoaXMuX29wZW5fdG8oYikpLGYmJmYubGVuZ3RoJiZmLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJzZWxlY3Rfbm9kZVwiLHtub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmV9KSxjfHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9ub2RlXCIsbm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxldmVudDplfSkpKSk6ITF9LGRlc2VsZWN0X25vZGU6ZnVuY3Rpb24oYixjLGQpe3ZhciBlLGYsZztpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKXRoaXMuZGVzZWxlY3Rfbm9kZShiW2VdLGMsZCk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZz10aGlzLmdldF9ub2RlKGIsITApLHZvaWQoYi5zdGF0ZS5zZWxlY3RlZCYmKGIuc3RhdGUuc2VsZWN0ZWQ9ITEsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxiLmlkKSxnLmxlbmd0aCYmZy5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksdGhpcy50cmlnZ2VyKFwiZGVzZWxlY3Rfbm9kZVwiLHtub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmR9KSxjfHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImRlc2VsZWN0X25vZGVcIixub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmR9KSkpKTohMX0sc2VsZWN0X2FsbDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKSxkLGU7Zm9yKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD10aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuX2QuY29uY2F0KCksZD0wLGU9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2RdXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2RdXS5zdGF0ZS5zZWxlY3RlZD0hMCk7dGhpcy5yZWRyYXcoITApLHRoaXMudHJpZ2dlcihcInNlbGVjdF9hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksYnx8dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJzZWxlY3RfYWxsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG9sZF9zZWxlY3Rpb246Y30pfSxkZXNlbGVjdF9hbGw6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChbXSksYyxkO2ZvcihjPTAsZD10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoO2Q+YztjKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbY11dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbY11dLnN0YXRlLnNlbGVjdGVkPSExKTt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9W10sdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNsaWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKS5wYXJlbnQoKS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKSx0aGlzLnRyaWdnZXIoXCJkZXNlbGVjdF9hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG5vZGU6Yn0pLGF8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVzZWxlY3RfYWxsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG9sZF9zZWxlY3Rpb246Yn0pfSxpc19zZWxlY3RlZDpmdW5jdGlvbihiKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2Iuc3RhdGUuc2VsZWN0ZWQ6ITF9LGdldF9zZWxlY3RlZDpmdW5jdGlvbihiKXtyZXR1cm4gYj9hLm1hcCh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5zbGljZSgpfSxnZXRfdG9wX3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X3NlbGVjdGVkKCEwKSxkPXt9LGUsZixnLGg7Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZFtjW2VdLmlkXT1jW2VdO2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWZvcihnPTAsaD1jW2VdLmNoaWxkcmVuX2QubGVuZ3RoO2g+ZztnKyspZFtjW2VdLmNoaWxkcmVuX2RbZ11dJiZkZWxldGUgZFtjW2VdLmNoaWxkcmVuX2RbZ11dO2M9W107Zm9yKGUgaW4gZClkLmhhc093blByb3BlcnR5KGUpJiZjLnB1c2goZSk7cmV0dXJuIGI/YS5tYXAoYyxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6Y30sZ2V0X2JvdHRvbV9zZWxlY3RlZDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLmdldF9zZWxlY3RlZCghMCksZD1bXSxlLGY7Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspY1tlXS5jaGlsZHJlbi5sZW5ndGh8fGQucHVzaChjW2VdLmlkKTtyZXR1cm4gYj9hLm1hcChkLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoYSl9LHRoaXMpKTpkfSxnZXRfc3RhdGU6ZnVuY3Rpb24oKXt2YXIgYj17Y29yZTp7b3BlbjpbXSxzY3JvbGw6e2xlZnQ6dGhpcy5lbGVtZW50LnNjcm9sbExlZnQoKSx0b3A6dGhpcy5lbGVtZW50LnNjcm9sbFRvcCgpfSxzZWxlY3RlZDpbXX19LGM7Zm9yKGMgaW4gdGhpcy5fbW9kZWwuZGF0YSl0aGlzLl9tb2RlbC5kYXRhLmhhc093blByb3BlcnR5KGMpJiZjIT09YS5qc3RyZWUucm9vdCYmKHRoaXMuX21vZGVsLmRhdGFbY10uc3RhdGUub3BlbmVkJiZiLmNvcmUub3Blbi5wdXNoKGMpLHRoaXMuX21vZGVsLmRhdGFbY10uc3RhdGUuc2VsZWN0ZWQmJmIuY29yZS5zZWxlY3RlZC5wdXNoKGMpKTtyZXR1cm4gYn0sc2V0X3N0YXRlOmZ1bmN0aW9uKGMsZCl7aWYoYyl7aWYoYy5jb3JlKXt2YXIgZSxmLGcsaCxpO2lmKGMuY29yZS5vcGVuKXJldHVybiBhLmlzQXJyYXkoYy5jb3JlLm9wZW4pJiZjLmNvcmUub3Blbi5sZW5ndGg/dGhpcy5fbG9hZF9ub2RlcyhjLmNvcmUub3BlbixmdW5jdGlvbihhKXt0aGlzLm9wZW5fbm9kZShhLCExLDApLGRlbGV0ZSBjLmNvcmUub3Blbix0aGlzLnNldF9zdGF0ZShjLGQpfSwhMCk6KGRlbGV0ZSBjLmNvcmUub3Blbix0aGlzLnNldF9zdGF0ZShjLGQpKSwhMTtpZihjLmNvcmUuc2Nyb2xsKXJldHVybiBjLmNvcmUuc2Nyb2xsJiZjLmNvcmUuc2Nyb2xsLmxlZnQhPT1iJiZ0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdChjLmNvcmUuc2Nyb2xsLmxlZnQpLGMuY29yZS5zY3JvbGwmJmMuY29yZS5zY3JvbGwudG9wIT09YiYmdGhpcy5lbGVtZW50LnNjcm9sbFRvcChjLmNvcmUuc2Nyb2xsLnRvcCksZGVsZXRlIGMuY29yZS5zY3JvbGwsdGhpcy5zZXRfc3RhdGUoYyxkKSwhMTtpZihjLmNvcmUuc2VsZWN0ZWQpcmV0dXJuIGg9dGhpcyx0aGlzLmRlc2VsZWN0X2FsbCgpLGEuZWFjaChjLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oYSxiKXtoLnNlbGVjdF9ub2RlKGIsITEsITApfSksZGVsZXRlIGMuY29yZS5zZWxlY3RlZCx0aGlzLnNldF9zdGF0ZShjLGQpLCExO2ZvcihpIGluIGMpYy5oYXNPd25Qcm9wZXJ0eShpKSYmXCJjb3JlXCIhPT1pJiYtMT09PWEuaW5BcnJheShpLHRoaXMuc2V0dGluZ3MucGx1Z2lucykmJmRlbGV0ZSBjW2ldO2lmKGEuaXNFbXB0eU9iamVjdChjLmNvcmUpKXJldHVybiBkZWxldGUgYy5jb3JlLHRoaXMuc2V0X3N0YXRlKGMsZCksITF9cmV0dXJuIGEuaXNFbXB0eU9iamVjdChjKT8oYz1udWxsLGQmJmQuY2FsbCh0aGlzKSx0aGlzLnRyaWdnZXIoXCJzZXRfc3RhdGVcIiksITEpOiEwfXJldHVybiExfSxyZWZyZXNoOmZ1bmN0aW9uKGIsYyl7dGhpcy5fZGF0YS5jb3JlLnN0YXRlPWM9PT0hMD97fTp0aGlzLmdldF9zdGF0ZSgpLGMmJmEuaXNGdW5jdGlvbihjKSYmKHRoaXMuX2RhdGEuY29yZS5zdGF0ZT1jLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUuc3RhdGUpKSx0aGlzLl9jbnQ9MCx0aGlzLl9tb2RlbC5kYXRhPXt9LHRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF09e2lkOmEuanN0cmVlLnJvb3QscGFyZW50Om51bGwscGFyZW50czpbXSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLHN0YXRlOntsb2FkZWQ6ITF9fSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9W10sdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD1udWxsLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW51bGw7dmFyIGQ9dGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0uY2xhc3NOYW1lO2J8fCh0aGlzLmVsZW1lbnQuaHRtbChcIjx1bCBjbGFzcz0nXCIrZCtcIicgcm9sZT0nZ3JvdXAnPjxsaSBjbGFzcz0nanN0cmVlLWluaXRpYWwtbm9kZSBqc3RyZWUtbG9hZGluZyBqc3RyZWUtbGVhZiBqc3RyZWUtbGFzdCcgcm9sZT0ndHJlZWl0ZW0nIGlkPSdqXCIrdGhpcy5faWQrXCJfbG9hZGluZyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS1vY2wnPjwvaT48YSBjbGFzcz0nanN0cmVlLWFuY2hvcicgaHJlZj0nIyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb24taGlkZGVuJz48L2k+XCIrdGhpcy5nZXRfc3RyaW5nKFwiTG9hZGluZyAuLi5cIikrXCI8L2E+PC9saT48L3VsPlwiKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFwialwiK3RoaXMuX2lkK1wiX2xvYWRpbmdcIikpLHRoaXMubG9hZF9ub2RlKGEuanN0cmVlLnJvb3QsZnVuY3Rpb24oYixjKXtjJiYodGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0uY2xhc3NOYW1lPWQsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkuaWQpLHRoaXMuc2V0X3N0YXRlKGEuZXh0ZW5kKCEwLHt9LHRoaXMuX2RhdGEuY29yZS5zdGF0ZSksZnVuY3Rpb24oKXt0aGlzLnRyaWdnZXIoXCJyZWZyZXNoXCIpfSkpLHRoaXMuX2RhdGEuY29yZS5zdGF0ZT1udWxsfSl9LHJlZnJlc2hfbm9kZTpmdW5jdGlvbihiKXtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBjPVtdLGQ9W10sZT10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKTtkLnB1c2goYi5pZCksYi5zdGF0ZS5vcGVuZWQ9PT0hMCYmYy5wdXNoKGIuaWQpLHRoaXMuZ2V0X25vZGUoYiwhMCkuZmluZChcIi5qc3RyZWUtb3BlblwiKS5lYWNoKGZ1bmN0aW9uKCl7ZC5wdXNoKHRoaXMuaWQpLGMucHVzaCh0aGlzLmlkKX0pLHRoaXMuX2xvYWRfbm9kZXMoZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMub3Blbl9ub2RlKGMsITEsMCksdGhpcy5zZWxlY3Rfbm9kZShlKSx0aGlzLnRyaWdnZXIoXCJyZWZyZXNoX25vZGVcIix7bm9kZTpiLG5vZGVzOmF9KX0sdGhpcyksITEsITApfSxzZXRfaWQ6ZnVuY3Rpb24oYixjKXtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBkLGUsZj10aGlzLl9tb2RlbC5kYXRhLGc9Yi5pZDtmb3IoYz1jLnRvU3RyaW5nKCksZltiLnBhcmVudF0uY2hpbGRyZW5bYS5pbkFycmF5KGIuaWQsZltiLnBhcmVudF0uY2hpbGRyZW4pXT1jLGQ9MCxlPWIucGFyZW50cy5sZW5ndGg7ZT5kO2QrKylmW2IucGFyZW50c1tkXV0uY2hpbGRyZW5fZFthLmluQXJyYXkoYi5pZCxmW2IucGFyZW50c1tkXV0uY2hpbGRyZW5fZCldPWM7Zm9yKGQ9MCxlPWIuY2hpbGRyZW4ubGVuZ3RoO2U+ZDtkKyspZltiLmNoaWxkcmVuW2RdXS5wYXJlbnQ9Yztmb3IoZD0wLGU9Yi5jaGlsZHJlbl9kLmxlbmd0aDtlPmQ7ZCsrKWZbYi5jaGlsZHJlbl9kW2RdXS5wYXJlbnRzW2EuaW5BcnJheShiLmlkLGZbYi5jaGlsZHJlbl9kW2RdXS5wYXJlbnRzKV09YztyZXR1cm4gZD1hLmluQXJyYXkoYi5pZCx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQpLC0xIT09ZCYmKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtkXT1jKSxkPXRoaXMuZ2V0X25vZGUoYi5pZCwhMCksZCYmKGQuYXR0cihcImlkXCIsYyksdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIik9PT1iLmlkJiZ0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLGMpKSxkZWxldGUgZltiLmlkXSxiLmlkPWMsYi5saV9hdHRyLmlkPWMsZltjXT1iLHRoaXMudHJpZ2dlcihcInNldF9pZFwiLHtub2RlOmIsXCJuZXdcIjpiLmlkLG9sZDpnfSksITB9LGdldF90ZXh0OmZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi50ZXh0OiExfSxzZXRfdGV4dDpmdW5jdGlvbihiLGMpe3ZhciBkLGU7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrKyl0aGlzLnNldF90ZXh0KGJbZF0sYyk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oYi50ZXh0PWMsdGhpcy5nZXRfbm9kZShiLCEwKS5sZW5ndGgmJnRoaXMucmVkcmF3X25vZGUoYi5pZCksdGhpcy50cmlnZ2VyKFwic2V0X3RleHRcIix7b2JqOmIsdGV4dDpjfSksITApOiExfSxnZXRfanNvbjpmdW5jdGlvbihiLGMsZCl7aWYoYj10aGlzLmdldF9ub2RlKGJ8fGEuanN0cmVlLnJvb3QpLCFiKXJldHVybiExO2MmJmMuZmxhdCYmIWQmJihkPVtdKTt2YXIgZT17aWQ6Yi5pZCx0ZXh0OmIudGV4dCxpY29uOnRoaXMuZ2V0X2ljb24oYiksbGlfYXR0cjphLmV4dGVuZCghMCx7fSxiLmxpX2F0dHIpLGFfYXR0cjphLmV4dGVuZCghMCx7fSxiLmFfYXR0ciksc3RhdGU6e30sZGF0YTpjJiZjLm5vX2RhdGE/ITE6YS5leHRlbmQoITAse30sYi5kYXRhKX0sZixnO2lmKGMmJmMuZmxhdD9lLnBhcmVudD1iLnBhcmVudDplLmNoaWxkcmVuPVtdLCFjfHwhYy5ub19zdGF0ZSlmb3IoZiBpbiBiLnN0YXRlKWIuc3RhdGUuaGFzT3duUHJvcGVydHkoZikmJihlLnN0YXRlW2ZdPWIuc3RhdGVbZl0pO2lmKGMmJmMubm9faWQmJihkZWxldGUgZS5pZCxlLmxpX2F0dHImJmUubGlfYXR0ci5pZCYmZGVsZXRlIGUubGlfYXR0ci5pZCxlLmFfYXR0ciYmZS5hX2F0dHIuaWQmJmRlbGV0ZSBlLmFfYXR0ci5pZCksYyYmYy5mbGF0JiZiLmlkIT09YS5qc3RyZWUucm9vdCYmZC5wdXNoKGUpLCFjfHwhYy5ub19jaGlsZHJlbilmb3IoZj0wLGc9Yi5jaGlsZHJlbi5sZW5ndGg7Zz5mO2YrKyljJiZjLmZsYXQ/dGhpcy5nZXRfanNvbihiLmNoaWxkcmVuW2ZdLGMsZCk6ZS5jaGlsZHJlbi5wdXNoKHRoaXMuZ2V0X2pzb24oYi5jaGlsZHJlbltmXSxjKSk7cmV0dXJuIGMmJmMuZmxhdD9kOmIuaWQ9PT1hLmpzdHJlZS5yb290P2UuY2hpbGRyZW46ZX0sY3JlYXRlX25vZGU6ZnVuY3Rpb24oYyxkLGUsZixnKXtpZihudWxsPT09YyYmKGM9YS5qc3RyZWUucm9vdCksYz10aGlzLmdldF9ub2RlKGMpLCFjKXJldHVybiExO2lmKGU9ZT09PWI/XCJsYXN0XCI6ZSwhZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFnJiYhdGhpcy5pc19sb2FkZWQoYykpcmV0dXJuIHRoaXMubG9hZF9ub2RlKGMsZnVuY3Rpb24oKXt0aGlzLmNyZWF0ZV9ub2RlKGMsZCxlLGYsITApfSk7ZHx8KGQ9e3RleHQ6dGhpcy5nZXRfc3RyaW5nKFwiTmV3IG5vZGVcIil9KSxcInN0cmluZ1wiPT10eXBlb2YgZCYmKGQ9e3RleHQ6ZH0pLGQudGV4dD09PWImJihkLnRleHQ9dGhpcy5nZXRfc3RyaW5nKFwiTmV3IG5vZGVcIikpO3ZhciBoLGksaixrO3N3aXRjaChjLmlkPT09YS5qc3RyZWUucm9vdCYmKFwiYmVmb3JlXCI9PT1lJiYoZT1cImZpcnN0XCIpLFwiYWZ0ZXJcIj09PWUmJihlPVwibGFzdFwiKSksZSl7Y2FzZVwiYmVmb3JlXCI6aD10aGlzLmdldF9ub2RlKGMucGFyZW50KSxlPWEuaW5BcnJheShjLmlkLGguY2hpbGRyZW4pLGM9aDticmVhaztjYXNlXCJhZnRlclwiOmg9dGhpcy5nZXRfbm9kZShjLnBhcmVudCksZT1hLmluQXJyYXkoYy5pZCxoLmNoaWxkcmVuKSsxLGM9aDticmVhaztjYXNlXCJpbnNpZGVcIjpjYXNlXCJmaXJzdFwiOmU9MDticmVhaztjYXNlXCJsYXN0XCI6ZT1jLmNoaWxkcmVuLmxlbmd0aDticmVhaztkZWZhdWx0OmV8fChlPTApfWlmKGU+Yy5jaGlsZHJlbi5sZW5ndGgmJihlPWMuY2hpbGRyZW4ubGVuZ3RoKSxkLmlkfHwoZC5pZD0hMCksIXRoaXMuY2hlY2soXCJjcmVhdGVfbm9kZVwiLGQsYyxlKSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7aWYoZC5pZD09PSEwJiZkZWxldGUgZC5pZCxkPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihkLGMuaWQsYy5wYXJlbnRzLmNvbmNhdCgpKSwhZClyZXR1cm4hMTtmb3IoaD10aGlzLmdldF9ub2RlKGQpLGk9W10saS5wdXNoKGQpLGk9aS5jb25jYXQoaC5jaGlsZHJlbl9kKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczppLHBhcmVudDpjLmlkfSksYy5jaGlsZHJlbl9kPWMuY2hpbGRyZW5fZC5jb25jYXQoaSksaj0wLGs9Yy5wYXJlbnRzLmxlbmd0aDtrPmo7aisrKXRoaXMuX21vZGVsLmRhdGFbYy5wYXJlbnRzW2pdXS5jaGlsZHJlbl9kPXRoaXMuX21vZGVsLmRhdGFbYy5wYXJlbnRzW2pdXS5jaGlsZHJlbl9kLmNvbmNhdChpKTtmb3IoZD1oLGg9W10saj0wLGs9Yy5jaGlsZHJlbi5sZW5ndGg7az5qO2orKyloW2o+PWU/aisxOmpdPWMuY2hpbGRyZW5bal07cmV0dXJuIGhbZV09ZC5pZCxjLmNoaWxkcmVuPWgsdGhpcy5yZWRyYXdfbm9kZShjLCEwKSxmJiZmLmNhbGwodGhpcyx0aGlzLmdldF9ub2RlKGQpKSx0aGlzLnRyaWdnZXIoXCJjcmVhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoZCkscGFyZW50OmMuaWQscG9zaXRpb246ZX0pLGQuaWR9LHJlbmFtZV9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZSxmO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy5yZW5hbWVfbm9kZShiW2RdLGMpO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGY9Yi50ZXh0LHRoaXMuY2hlY2soXCJyZW5hbWVfbm9kZVwiLGIsdGhpcy5nZXRfcGFyZW50KGIpLGMpPyh0aGlzLnNldF90ZXh0KGIsYyksdGhpcy50cmlnZ2VyKFwicmVuYW1lX25vZGVcIix7bm9kZTpiLHRleHQ6YyxvbGQ6Zn0pLCEwKToodGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITEpKTohMX0sZGVsZXRlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZCxlLGYsZyxoLGksaixrLGwsbSxuO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspdGhpcy5kZWxldGVfbm9kZShiW2NdKTtyZXR1cm4hMH1pZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO2lmKGU9dGhpcy5nZXRfbm9kZShiLnBhcmVudCksZj1hLmluQXJyYXkoYi5pZCxlLmNoaWxkcmVuKSxsPSExLCF0aGlzLmNoZWNrKFwiZGVsZXRlX25vZGVcIixiLGUsZikpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2ZvcigtMSE9PWYmJihlLmNoaWxkcmVuPWEudmFrYXRhLmFycmF5X3JlbW92ZShlLmNoaWxkcmVuLGYpKSxnPWIuY2hpbGRyZW5fZC5jb25jYXQoW10pLGcucHVzaChiLmlkKSxoPTAsaT1iLnBhcmVudHMubGVuZ3RoO2k+aDtoKyspdGhpcy5fbW9kZWwuZGF0YVtiLnBhcmVudHNbaF1dLmNoaWxkcmVuX2Q9YS52YWthdGEuYXJyYXlfZmlsdGVyKHRoaXMuX21vZGVsLmRhdGFbYi5wYXJlbnRzW2hdXS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGIpe3JldHVybi0xPT09YS5pbkFycmF5KGIsZyl9KTtmb3Ioaj0wLGs9Zy5sZW5ndGg7az5qO2orKylpZih0aGlzLl9tb2RlbC5kYXRhW2dbal1dLnN0YXRlLnNlbGVjdGVkKXtsPSEwO2JyZWFrfWZvcihsJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X2ZpbHRlcih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oYil7cmV0dXJuLTE9PT1hLmluQXJyYXkoYixnKX0pKSx0aGlzLnRyaWdnZXIoXCJkZWxldGVfbm9kZVwiLHtub2RlOmIscGFyZW50OmUuaWR9KSxsJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImRlbGV0ZV9ub2RlXCIsbm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxwYXJlbnQ6ZS5pZH0pLGo9MCxrPWcubGVuZ3RoO2s+ajtqKyspZGVsZXRlIHRoaXMuX21vZGVsLmRhdGFbZ1tqXV07cmV0dXJuLTEhPT1hLmluQXJyYXkodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQsZykmJih0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsLG09dGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcCxuPXRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0LGUuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW5bMF0mJnRoaXMuZ2V0X25vZGUodGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS5jaGlsZHJlblswXSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpOnRoaXMuZ2V0X25vZGUoZSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpLHRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3A9bSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdD1uKSx0aGlzLnJlZHJhd19ub2RlKGUsITApLCEwfSxjaGVjazpmdW5jdGlvbihiLGMsZCxlLGYpe2M9YyYmYy5pZD9jOnRoaXMuZ2V0X25vZGUoYyksZD1kJiZkLmlkP2Q6dGhpcy5nZXRfbm9kZShkKTt2YXIgZz1iLm1hdGNoKC9ebW92ZV9ub2RlfGNvcHlfbm9kZXxjcmVhdGVfbm9kZSQvaSk/ZDpjLGg9dGhpcy5zZXR0aW5ncy5jb3JlLmNoZWNrX2NhbGxiYWNrO3JldHVyblwibW92ZV9ub2RlXCIhPT1ifHxmJiZmLmlzX211bHRpfHxjLmlkIT09ZC5pZCYmKFwibW92ZV9ub2RlXCIhPT1ifHxhLmluQXJyYXkoYy5pZCxkLmNoaWxkcmVuKSE9PWUpJiYtMT09PWEuaW5BcnJheShkLmlkLGMuY2hpbGRyZW5fZCk/KGcmJmcuZGF0YSYmKGc9Zy5kYXRhKSxnJiZnLmZ1bmN0aW9ucyYmKGcuZnVuY3Rpb25zW2JdPT09ITF8fGcuZnVuY3Rpb25zW2JdPT09ITApPyhnLmZ1bmN0aW9uc1tiXT09PSExJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAyXCIscmVhc29uOlwiTm9kZSBkYXRhIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpiLHBvczplLG9iajpjJiZjLmlkP2MuaWQ6ITEscGFyOmQmJmQuaWQ/ZC5pZDohMX0pfSksZy5mdW5jdGlvbnNbYl0pOmg9PT0hMXx8YS5pc0Z1bmN0aW9uKGgpJiZoLmNhbGwodGhpcyxiLGMsZCxlLGYpPT09ITF8fGgmJmhbYl09PT0hMT8odGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAzXCIscmVhc29uOlwiVXNlciBjb25maWcgZm9yIGNvcmUuY2hlY2tfY2FsbGJhY2sgcHJldmVudHMgZnVuY3Rpb246IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmUsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZCYmZC5pZD9kLmlkOiExfSl9LCExKTohMCk6KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wMVwiLHJlYXNvbjpcIk1vdmluZyBwYXJlbnQgaW5zaWRlIGNoaWxkXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmUsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZCYmZC5pZD9kLmlkOiExfSl9LCExKX0sbGFzdF9lcnJvcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcn0sbW92ZV9ub2RlOmZ1bmN0aW9uKGMsZCxlLGYsZyxoLGkpe3ZhciBqLGssbCxtLG4sbyxwLHEscixzLHQsdSx2LHc7aWYoZD10aGlzLmdldF9ub2RlKGQpLGU9ZT09PWI/MDplLCFkKXJldHVybiExO2lmKCFlLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmIWcmJiF0aGlzLmlzX2xvYWRlZChkKSlyZXR1cm4gdGhpcy5sb2FkX25vZGUoZCxmdW5jdGlvbigpe3RoaXMubW92ZV9ub2RlKGMsZCxlLGYsITAsITEsaSl9KTtpZihhLmlzQXJyYXkoYykpe2lmKDEhPT1jLmxlbmd0aCl7Zm9yKGo9MCxrPWMubGVuZ3RoO2s+ajtqKyspKHI9dGhpcy5tb3ZlX25vZGUoY1tqXSxkLGUsZixnLCExLGkpKSYmKGQ9cixlPVwiYWZ0ZXJcIik7cmV0dXJuIHRoaXMucmVkcmF3KCksITB9Yz1jWzBdfWlmKGM9YyYmYy5pZD9jOnRoaXMuZ2V0X25vZGUoYyksIWN8fGMuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO2lmKGw9KGMucGFyZW50fHxhLmpzdHJlZS5yb290KS50b1N0cmluZygpLG49ZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJmQuaWQhPT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X25vZGUoZC5wYXJlbnQpOmQsbz1pP2k6dGhpcy5fbW9kZWwuZGF0YVtjLmlkXT90aGlzOmEuanN0cmVlLnJlZmVyZW5jZShjLmlkKSxwPSFvfHwhby5faWR8fHRoaXMuX2lkIT09by5faWQsbT1vJiZvLl9pZCYmbCYmby5fbW9kZWwuZGF0YVtsXSYmby5fbW9kZWwuZGF0YVtsXS5jaGlsZHJlbj9hLmluQXJyYXkoYy5pZCxvLl9tb2RlbC5kYXRhW2xdLmNoaWxkcmVuKTotMSxvJiZvLl9pZCYmKGM9by5fbW9kZWwuZGF0YVtjLmlkXSkscClyZXR1cm4ocj10aGlzLmNvcHlfbm9kZShjLGQsZSxmLGcsITEsaSkpPyhvJiZvLmRlbGV0ZV9ub2RlKGMpLHIpOiExO3N3aXRjaChkLmlkPT09YS5qc3RyZWUucm9vdCYmKFwiYmVmb3JlXCI9PT1lJiYoZT1cImZpcnN0XCIpLFwiYWZ0ZXJcIj09PWUmJihlPVwibGFzdFwiKSksZSl7Y2FzZVwiYmVmb3JlXCI6ZT1hLmluQXJyYXkoZC5pZCxuLmNoaWxkcmVuKTticmVhaztjYXNlXCJhZnRlclwiOmU9YS5pbkFycmF5KGQuaWQsbi5jaGlsZHJlbikrMTticmVhaztjYXNlXCJpbnNpZGVcIjpjYXNlXCJmaXJzdFwiOmU9MDticmVhaztjYXNlXCJsYXN0XCI6ZT1uLmNoaWxkcmVuLmxlbmd0aDticmVhaztkZWZhdWx0OmV8fChlPTApfWlmKGU+bi5jaGlsZHJlbi5sZW5ndGgmJihlPW4uY2hpbGRyZW4ubGVuZ3RoKSwhdGhpcy5jaGVjayhcIm1vdmVfbm9kZVwiLGMsbixlLHtjb3JlOiEwLG9yaWdpbjppLGlzX211bHRpOm8mJm8uX2lkJiZvLl9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IW98fCFvLl9pZH0pKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtpZihjLnBhcmVudD09PW4uaWQpe2ZvcihxPW4uY2hpbGRyZW4uY29uY2F0KCkscj1hLmluQXJyYXkoYy5pZCxxKSwtMSE9PXImJihxPWEudmFrYXRhLmFycmF5X3JlbW92ZShxLHIpLGU+ciYmZS0tKSxyPVtdLHM9MCx0PXEubGVuZ3RoO3Q+cztzKyspcltzPj1lP3MrMTpzXT1xW3NdO3JbZV09Yy5pZCxuLmNoaWxkcmVuPXIsdGhpcy5fbm9kZV9jaGFuZ2VkKG4uaWQpLHRoaXMucmVkcmF3KG4uaWQ9PT1hLmpzdHJlZS5yb290KX1lbHNle2ZvcihyPWMuY2hpbGRyZW5fZC5jb25jYXQoKSxyLnB1c2goYy5pZCkscz0wLHQ9Yy5wYXJlbnRzLmxlbmd0aDt0PnM7cysrKXtmb3IocT1bXSx3PW8uX21vZGVsLmRhdGFbYy5wYXJlbnRzW3NdXS5jaGlsZHJlbl9kLHU9MCx2PXcubGVuZ3RoO3Y+dTt1KyspLTE9PT1hLmluQXJyYXkod1t1XSxyKSYmcS5wdXNoKHdbdV0pO28uX21vZGVsLmRhdGFbYy5wYXJlbnRzW3NdXS5jaGlsZHJlbl9kPXF9Zm9yKG8uX21vZGVsLmRhdGFbbF0uY2hpbGRyZW49YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0oby5fbW9kZWwuZGF0YVtsXS5jaGlsZHJlbixjLmlkKSxzPTAsdD1uLnBhcmVudHMubGVuZ3RoO3Q+cztzKyspdGhpcy5fbW9kZWwuZGF0YVtuLnBhcmVudHNbc11dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtuLnBhcmVudHNbc11dLmNoaWxkcmVuX2QuY29uY2F0KHIpO2ZvcihxPVtdLHM9MCx0PW4uY2hpbGRyZW4ubGVuZ3RoO3Q+cztzKyspcVtzPj1lP3MrMTpzXT1uLmNoaWxkcmVuW3NdO2ZvcihxW2VdPWMuaWQsbi5jaGlsZHJlbj1xLG4uY2hpbGRyZW5fZC5wdXNoKGMuaWQpLG4uY2hpbGRyZW5fZD1uLmNoaWxkcmVuX2QuY29uY2F0KGMuY2hpbGRyZW5fZCksYy5wYXJlbnQ9bi5pZCxyPW4ucGFyZW50cy5jb25jYXQoKSxyLnVuc2hpZnQobi5pZCksdz1jLnBhcmVudHMubGVuZ3RoLGMucGFyZW50cz1yLHI9ci5jb25jYXQoKSxzPTAsdD1jLmNoaWxkcmVuX2QubGVuZ3RoO3Q+cztzKyspdGhpcy5fbW9kZWwuZGF0YVtjLmNoaWxkcmVuX2Rbc11dLnBhcmVudHM9dGhpcy5fbW9kZWwuZGF0YVtjLmNoaWxkcmVuX2Rbc11dLnBhcmVudHMuc2xpY2UoMCwtMSp3KSxBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSh0aGlzLl9tb2RlbC5kYXRhW2MuY2hpbGRyZW5fZFtzXV0ucGFyZW50cyxyKTtsIT09YS5qc3RyZWUucm9vdCYmbi5pZCE9PWEuanN0cmVlLnJvb3R8fCh0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXd8fCh0aGlzLl9ub2RlX2NoYW5nZWQobCksdGhpcy5fbm9kZV9jaGFuZ2VkKG4uaWQpKSxofHx0aGlzLnJlZHJhdygpfXJldHVybiBmJiZmLmNhbGwodGhpcyxjLG4sZSksdGhpcy50cmlnZ2VyKFwibW92ZV9ub2RlXCIse25vZGU6YyxwYXJlbnQ6bi5pZCxwb3NpdGlvbjplLG9sZF9wYXJlbnQ6bCxvbGRfcG9zaXRpb246bSxpc19tdWx0aTpvJiZvLl9pZCYmby5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiFvfHwhby5faWQsb2xkX2luc3RhbmNlOm8sbmV3X2luc3RhbmNlOnRoaXN9KSxjLmlkfSxjb3B5X25vZGU6ZnVuY3Rpb24oYyxkLGUsZixnLGgsaSl7dmFyIGosayxsLG0sbixvLHAscSxyLHMsdDtpZihkPXRoaXMuZ2V0X25vZGUoZCksZT1lPT09Yj8wOmUsIWQpcmV0dXJuITE7aWYoIWUudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhZyYmIXRoaXMuaXNfbG9hZGVkKGQpKXJldHVybiB0aGlzLmxvYWRfbm9kZShkLGZ1bmN0aW9uKCl7dGhpcy5jb3B5X25vZGUoYyxkLGUsZiwhMCwhMSxpKX0pO2lmKGEuaXNBcnJheShjKSl7aWYoMSE9PWMubGVuZ3RoKXtmb3Ioaj0wLGs9Yy5sZW5ndGg7az5qO2orKykobT10aGlzLmNvcHlfbm9kZShjW2pdLGQsZSxmLGcsITAsaSkpJiYoZD1tLGU9XCJhZnRlclwiKTtyZXR1cm4gdGhpcy5yZWRyYXcoKSwhMH1jPWNbMF19aWYoYz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSwhY3x8Yy5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7c3dpdGNoKHE9KGMucGFyZW50fHxhLmpzdHJlZS5yb290KS50b1N0cmluZygpLHI9ZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJmQuaWQhPT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X25vZGUoZC5wYXJlbnQpOmQscz1pP2k6dGhpcy5fbW9kZWwuZGF0YVtjLmlkXT90aGlzOmEuanN0cmVlLnJlZmVyZW5jZShjLmlkKSx0PSFzfHwhcy5faWR8fHRoaXMuX2lkIT09cy5faWQscyYmcy5faWQmJihjPXMuX21vZGVsLmRhdGFbYy5pZF0pLGQuaWQ9PT1hLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PWUmJihlPVwiZmlyc3RcIiksXCJhZnRlclwiPT09ZSYmKGU9XCJsYXN0XCIpKSxlKXtjYXNlXCJiZWZvcmVcIjplPWEuaW5BcnJheShkLmlkLHIuY2hpbGRyZW4pO2JyZWFrO2Nhc2VcImFmdGVyXCI6ZT1hLmluQXJyYXkoZC5pZCxyLmNoaWxkcmVuKSsxO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6ZT0wO2JyZWFrO2Nhc2VcImxhc3RcIjplPXIuY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6ZXx8KGU9MCl9aWYoZT5yLmNoaWxkcmVuLmxlbmd0aCYmKGU9ci5jaGlsZHJlbi5sZW5ndGgpLCF0aGlzLmNoZWNrKFwiY29weV9ub2RlXCIsYyxyLGUse2NvcmU6ITAsb3JpZ2luOmksaXNfbXVsdGk6cyYmcy5faWQmJnMuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohc3x8IXMuX2lkfSkpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKHA9cz9zLmdldF9qc29uKGMse25vX2lkOiEwLG5vX2RhdGE6ITAsbm9fc3RhdGU6ITB9KTpjLCFwKXJldHVybiExO2lmKHAuaWQ9PT0hMCYmZGVsZXRlIHAuaWQscD10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24ocCxyLmlkLHIucGFyZW50cy5jb25jYXQoKSksIXApcmV0dXJuITE7Zm9yKG09dGhpcy5nZXRfbm9kZShwKSxjJiZjLnN0YXRlJiZjLnN0YXRlLmxvYWRlZD09PSExJiYobS5zdGF0ZS5sb2FkZWQ9ITEpLGw9W10sbC5wdXNoKHApLGw9bC5jb25jYXQobS5jaGlsZHJlbl9kKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpsLHBhcmVudDpyLmlkfSksbj0wLG89ci5wYXJlbnRzLmxlbmd0aDtvPm47bisrKXRoaXMuX21vZGVsLmRhdGFbci5wYXJlbnRzW25dXS5jaGlsZHJlbl9kPXRoaXMuX21vZGVsLmRhdGFbci5wYXJlbnRzW25dXS5jaGlsZHJlbl9kLmNvbmNhdChsKTtmb3IobD1bXSxuPTAsbz1yLmNoaWxkcmVuLmxlbmd0aDtvPm47bisrKWxbbj49ZT9uKzE6bl09ci5jaGlsZHJlbltuXTtyZXR1cm4gbFtlXT1tLmlkLHIuY2hpbGRyZW49bCxyLmNoaWxkcmVuX2QucHVzaChtLmlkKSxyLmNoaWxkcmVuX2Q9ci5jaGlsZHJlbl9kLmNvbmNhdChtLmNoaWxkcmVuX2QpLHIuaWQ9PT1hLmpzdHJlZS5yb290JiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3fHx0aGlzLl9ub2RlX2NoYW5nZWQoci5pZCksaHx8dGhpcy5yZWRyYXcoci5pZD09PWEuanN0cmVlLnJvb3QpLGYmJmYuY2FsbCh0aGlzLG0scixlKSx0aGlzLnRyaWdnZXIoXCJjb3B5X25vZGVcIix7bm9kZTptLG9yaWdpbmFsOmMscGFyZW50OnIuaWQscG9zaXRpb246ZSxvbGRfcGFyZW50OnEsb2xkX3Bvc2l0aW9uOnMmJnMuX2lkJiZxJiZzLl9tb2RlbC5kYXRhW3FdJiZzLl9tb2RlbC5kYXRhW3FdLmNoaWxkcmVuP2EuaW5BcnJheShjLmlkLHMuX21vZGVsLmRhdGFbcV0uY2hpbGRyZW4pOi0xLGlzX211bHRpOnMmJnMuX2lkJiZzLl9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IXN8fCFzLl9pZCxvbGRfaW5zdGFuY2U6cyxuZXdfaW5zdGFuY2U6dGhpc30pLG0uaWR9LGN1dDpmdW5jdGlvbihiKXtpZihifHwoYj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KCkpLGEuaXNBcnJheShiKXx8KGI9W2JdKSwhYi5sZW5ndGgpcmV0dXJuITE7dmFyIGM9W10sZyxoLGk7Zm9yKGg9MCxpPWIubGVuZ3RoO2k+aDtoKyspZz10aGlzLmdldF9ub2RlKGJbaF0pLGcmJmcuaWQmJmcuaWQhPT1hLmpzdHJlZS5yb290JiZjLnB1c2goZyk7cmV0dXJuIGMubGVuZ3RoPyhkPWMsZj10aGlzLGU9XCJtb3ZlX25vZGVcIix2b2lkIHRoaXMudHJpZ2dlcihcImN1dFwiLHtub2RlOmJ9KSk6ITF9LGNvcHk6ZnVuY3Rpb24oYil7aWYoYnx8KGI9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdCgpKSxhLmlzQXJyYXkoYil8fChiPVtiXSksIWIubGVuZ3RoKXJldHVybiExO3ZhciBjPVtdLGcsaCxpO2ZvcihoPTAsaT1iLmxlbmd0aDtpPmg7aCsrKWc9dGhpcy5nZXRfbm9kZShiW2hdKSxnJiZnLmlkJiZnLmlkIT09YS5qc3RyZWUucm9vdCYmYy5wdXNoKGcpO3JldHVybiBjLmxlbmd0aD8oZD1jLGY9dGhpcyxlPVwiY29weV9ub2RlXCIsdm9pZCB0aGlzLnRyaWdnZXIoXCJjb3B5XCIse25vZGU6Yn0pKTohMX0sZ2V0X2J1ZmZlcjpmdW5jdGlvbigpe3JldHVybnttb2RlOmUsbm9kZTpkLGluc3Q6Zn19LGNhbl9wYXN0ZTpmdW5jdGlvbigpe3JldHVybiBlIT09ITEmJmQhPT0hMX0scGFzdGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmUmJmUubWF0Y2goL14oY29weV9ub2RlfG1vdmVfbm9kZSkkLykmJmQ/KHRoaXNbZV0oZCxhLGIsITEsITEsITEsZikmJnRoaXMudHJpZ2dlcihcInBhc3RlXCIse3BhcmVudDphLmlkLG5vZGU6ZCxtb2RlOmV9KSxkPSExLGU9ITEsdm9pZChmPSExKSk6ITF9LGNsZWFyX2J1ZmZlcjpmdW5jdGlvbigpe2Q9ITEsZT0hMSxmPSExLHRoaXMudHJpZ2dlcihcImNsZWFyX2J1ZmZlclwiKX0sZWRpdDpmdW5jdGlvbihiLGMsZCl7dmFyIGUsZixnLGgsaixrLGwsbSxuLG89ITE7cmV0dXJuKGI9dGhpcy5nZXRfbm9kZShiKSk/dGhpcy5zZXR0aW5ncy5jb3JlLmNoZWNrX2NhbGxiYWNrPT09ITE/KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wN1wiLHJlYXNvbjpcIkNvdWxkIG5vdCBlZGl0IG5vZGUgYmVjYXVzZSBvZiBjaGVja19jYWxsYmFja1wifSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMSk6KG49YixjPVwic3RyaW5nXCI9PXR5cGVvZiBjP2M6Yi50ZXh0LHRoaXMuc2V0X3RleHQoYixcIlwiKSxiPXRoaXMuX29wZW5fdG8oYiksbi50ZXh0PWMsZT10aGlzLl9kYXRhLmNvcmUucnRsLGY9dGhpcy5lbGVtZW50LndpZHRoKCksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bi5pZCxnPWIuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpLGg9YShcIjxzcGFuPlwiKSxqPWMsaz1hKFwiPGRpdiAvPlwiLHtjc3M6e3Bvc2l0aW9uOlwiYWJzb2x1dGVcIix0b3A6XCItMjAwcHhcIixsZWZ0OmU/XCIwcHhcIjpcIi0xMDAwcHhcIix2aXNpYmlsaXR5OlwiaGlkZGVuXCJ9fSkuYXBwZW5kVG8oXCJib2R5XCIpLGw9YShcIjxpbnB1dCAvPlwiLHt2YWx1ZTpqLFwiY2xhc3NcIjpcImpzdHJlZS1yZW5hbWUtaW5wdXRcIixjc3M6e3BhZGRpbmc6XCIwXCIsYm9yZGVyOlwiMXB4IHNvbGlkIHNpbHZlclwiLFwiYm94LXNpemluZ1wiOlwiYm9yZGVyLWJveFwiLGRpc3BsYXk6XCJpbmxpbmUtYmxvY2tcIixoZWlnaHQ6dGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCtcInB4XCIsbGluZUhlaWdodDp0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0K1wicHhcIix3aWR0aDpcIjE1MHB4XCJ9LGJsdXI6YS5wcm94eShmdW5jdGlvbihjKXtjLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGMucHJldmVudERlZmF1bHQoKTt2YXIgZT1oLmNoaWxkcmVuKFwiLmpzdHJlZS1yZW5hbWUtaW5wdXRcIiksZj1lLnZhbCgpLGk9dGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQsbTtcIlwiPT09ZiYmKGY9aiksay5yZW1vdmUoKSxoLnJlcGxhY2VXaXRoKGcpLGgucmVtb3ZlKCksaj1pP2o6YShcIjxkaXY+PC9kaXY+XCIpLmFwcGVuZChhLnBhcnNlSFRNTChqKSkuaHRtbCgpLHRoaXMuc2V0X3RleHQoYixqKSxtPSEhdGhpcy5yZW5hbWVfbm9kZShiLGk/YShcIjxkaXY+PC9kaXY+XCIpLnRleHQoZikudGV4dCgpOmEoXCI8ZGl2PjwvZGl2PlwiKS5hcHBlbmQoYS5wYXJzZUhUTUwoZikpLmh0bWwoKSksbXx8dGhpcy5zZXRfdGV4dChiLGopLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW4uaWQsc2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5nZXRfbm9kZShuLmlkLCEwKTthLmxlbmd0aCYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW4uaWQsYS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpfSx0aGlzKSwwKSxkJiZkLmNhbGwodGhpcyxuLG0sbyksbD1udWxsfSx0aGlzKSxrZXlkb3duOmZ1bmN0aW9uKGEpe3ZhciBiPWEud2hpY2g7Mjc9PT1iJiYobz0hMCx0aGlzLnZhbHVlPWopLDI3IT09YiYmMTMhPT1iJiYzNyE9PWImJjM4IT09YiYmMzkhPT1iJiY0MCE9PWImJjMyIT09Ynx8YS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwyNyE9PWImJjEzIT09Ynx8KGEucHJldmVudERlZmF1bHQoKSx0aGlzLmJsdXIoKSl9LGNsaWNrOmZ1bmN0aW9uKGEpe2Euc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9LG1vdXNlZG93bjpmdW5jdGlvbihhKXthLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfSxrZXl1cDpmdW5jdGlvbihhKXtsLndpZHRoKE1hdGgubWluKGsudGV4dChcInBXXCIrdGhpcy52YWx1ZSkud2lkdGgoKSxmKSl9LGtleXByZXNzOmZ1bmN0aW9uKGEpe3JldHVybiAxMz09PWEud2hpY2g/ITE6dm9pZCAwfX0pLG09e2ZvbnRGYW1pbHk6Zy5jc3MoXCJmb250RmFtaWx5XCIpfHxcIlwiLGZvbnRTaXplOmcuY3NzKFwiZm9udFNpemVcIil8fFwiXCIsZm9udFdlaWdodDpnLmNzcyhcImZvbnRXZWlnaHRcIil8fFwiXCIsZm9udFN0eWxlOmcuY3NzKFwiZm9udFN0eWxlXCIpfHxcIlwiLGZvbnRTdHJldGNoOmcuY3NzKFwiZm9udFN0cmV0Y2hcIil8fFwiXCIsZm9udFZhcmlhbnQ6Zy5jc3MoXCJmb250VmFyaWFudFwiKXx8XCJcIixsZXR0ZXJTcGFjaW5nOmcuY3NzKFwibGV0dGVyU3BhY2luZ1wiKXx8XCJcIix3b3JkU3BhY2luZzpnLmNzcyhcIndvcmRTcGFjaW5nXCIpfHxcIlwifSxoLmF0dHIoXCJjbGFzc1wiLGcuYXR0cihcImNsYXNzXCIpKS5hcHBlbmQoZy5jb250ZW50cygpLmNsb25lKCkpLmFwcGVuZChsKSxnLnJlcGxhY2VXaXRoKGgpLGsuY3NzKG0pLGwuY3NzKG0pLndpZHRoKE1hdGgubWluKGsudGV4dChcInBXXCIrbFswXS52YWx1ZSkud2lkdGgoKSxmKSlbMF0uc2VsZWN0KCksdm9pZCBhKGkpLm9uZShcIm1vdXNlZG93bi5qc3RyZWUgdG91Y2hzdGFydC5qc3RyZWUgZG5kX3N0YXJ0LnZha2F0YVwiLGZ1bmN0aW9uKGIpe1xubCYmYi50YXJnZXQhPT1sJiZhKGwpLmJsdXIoKX0pKTohMX0sc2V0X3RoZW1lOmZ1bmN0aW9uKGIsYyl7aWYoIWIpcmV0dXJuITE7aWYoYz09PSEwKXt2YXIgZD10aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLmRpcjtkfHwoZD1hLmpzdHJlZS5wYXRoK1wiL3RoZW1lc1wiKSxjPWQrXCIvXCIrYitcIi9zdHlsZS5jc3NcIn1jJiYtMT09PWEuaW5BcnJheShjLGcpJiYoYShcImhlYWRcIikuYXBwZW5kKCc8bGluayByZWw9XCJzdHlsZXNoZWV0XCIgaHJlZj1cIicrYysnXCIgdHlwZT1cInRleHQvY3NzXCIgLz4nKSxnLnB1c2goYykpLHRoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZSYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZSksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lPWIsdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLVwiK2IpLHRoaXMuZWxlbWVudFt0aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJqc3RyZWUtXCIrYitcIi1yZXNwb25zaXZlXCIpLHRoaXMudHJpZ2dlcihcInNldF90aGVtZVwiLHt0aGVtZTpifSl9LGdldF90aGVtZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWV9LHNldF90aGVtZV92YXJpYW50OmZ1bmN0aW9uKGEpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudCYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZStcIi1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQpLHRoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudD1hLGEmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWUrXCItXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50KX0sZ2V0X3RoZW1lX3ZhcmlhbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50fSxzaG93X3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkuYWRkQ2xhc3MoXCJqc3RyZWUtc3RyaXBlZFwiKX0saGlkZV9zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLXN0cmlwZWRcIil9LHRvZ2dsZV9zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzP3RoaXMuaGlkZV9zdHJpcGVzKCk6dGhpcy5zaG93X3N0cmlwZXMoKX0sc2hvd19kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWRvdHNcIil9LGhpZGVfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1kb3RzXCIpfSx0b2dnbGVfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz90aGlzLmhpZGVfZG90cygpOnRoaXMuc2hvd19kb3RzKCl9LHNob3dfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWljb25zXCIpfSxoaWRlX2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1pY29uc1wiKX0sdG9nZ2xlX2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz90aGlzLmhpZGVfaWNvbnMoKTp0aGlzLnNob3dfaWNvbnMoKX0sc2V0X2ljb246ZnVuY3Rpb24oYyxkKXt2YXIgZSxmLGcsaDtpZihhLmlzQXJyYXkoYykpe2ZvcihjPWMuc2xpY2UoKSxlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKXRoaXMuc2V0X2ljb24oY1tlXSxkKTtyZXR1cm4hMH1yZXR1cm4gYz10aGlzLmdldF9ub2RlKGMpLGMmJmMuaWQhPT1hLmpzdHJlZS5yb290PyhoPWMuaWNvbixjLmljb249ZD09PSEwfHxudWxsPT09ZHx8ZD09PWJ8fFwiXCI9PT1kPyEwOmQsZz10aGlzLmdldF9ub2RlKGMsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKSxkPT09ITE/dGhpcy5oaWRlX2ljb24oYyk6ZD09PSEwfHxudWxsPT09ZHx8ZD09PWJ8fFwiXCI9PT1kPyhnLnJlbW92ZUNsYXNzKFwianN0cmVlLXRoZW1laWNvbi1jdXN0b20gXCIraCkuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLnJlbW92ZUF0dHIoXCJyZWxcIiksaD09PSExJiZ0aGlzLnNob3dfaWNvbihjKSk6LTE9PT1kLmluZGV4T2YoXCIvXCIpJiYtMT09PWQuaW5kZXhPZihcIi5cIik/KGcucmVtb3ZlQ2xhc3MoaCkuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLGcuYWRkQ2xhc3MoZCtcIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKS5hdHRyKFwicmVsXCIsZCksaD09PSExJiZ0aGlzLnNob3dfaWNvbihjKSk6KGcucmVtb3ZlQ2xhc3MoaCkuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLGcuYWRkQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJ1cmwoJ1wiK2QrXCInKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdFwiKS5hdHRyKFwicmVsXCIsZCksaD09PSExJiZ0aGlzLnNob3dfaWNvbihjKSksITApOiExfSxnZXRfaWNvbjpmdW5jdGlvbihiKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2IuaWNvbjohMX0saGlkZV9pY29uOmZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmhpZGVfaWNvbihiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIhPT1hLmpzdHJlZS5yb290PyhiLmljb249ITEsdGhpcy5nZXRfbm9kZShiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikuYWRkQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKSwhMCk6ITF9LHNob3dfaWNvbjpmdW5jdGlvbihiKXt2YXIgYyxkLGU7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLnNob3dfaWNvbihiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIhPT1hLmpzdHJlZS5yb290PyhlPXRoaXMuZ2V0X25vZGUoYiwhMCksYi5pY29uPWUubGVuZ3RoP2UuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLmF0dHIoXCJyZWxcIik6ITAsYi5pY29ufHwoYi5pY29uPSEwKSxlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpLCEwKTohMX19LGEudmFrYXRhPXt9LGEudmFrYXRhLmF0dHJpYnV0ZXM9ZnVuY3Rpb24oYixjKXtiPWEoYilbMF07dmFyIGQ9Yz97fTpbXTtyZXR1cm4gYiYmYi5hdHRyaWJ1dGVzJiZhLmVhY2goYi5hdHRyaWJ1dGVzLGZ1bmN0aW9uKGIsZSl7LTE9PT1hLmluQXJyYXkoZS5uYW1lLnRvTG93ZXJDYXNlKCksW1wic3R5bGVcIixcImNvbnRlbnRlZGl0YWJsZVwiLFwiaGFzZm9jdXNcIixcInRhYmluZGV4XCJdKSYmbnVsbCE9PWUudmFsdWUmJlwiXCIhPT1hLnRyaW0oZS52YWx1ZSkmJihjP2RbZS5uYW1lXT1lLnZhbHVlOmQucHVzaChlLm5hbWUpKX0pLGR9LGEudmFrYXRhLmFycmF5X3VuaXF1ZT1mdW5jdGlvbihhKXt2YXIgYz1bXSxkLGUsZixnPXt9O2ZvcihkPTAsZj1hLmxlbmd0aDtmPmQ7ZCsrKWdbYVtkXV09PT1iJiYoYy5wdXNoKGFbZF0pLGdbYVtkXV09ITApO3JldHVybiBjfSxhLnZha2F0YS5hcnJheV9yZW1vdmU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5zcGxpY2UoYiwxKSxhfSxhLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbT1mdW5jdGlvbihiLGMpe3ZhciBkPWEuaW5BcnJheShjLGIpO3JldHVybi0xIT09ZD9hLnZha2F0YS5hcnJheV9yZW1vdmUoYixkKTpifSxhLnZha2F0YS5hcnJheV9maWx0ZXI9ZnVuY3Rpb24oYSxiLGMsZCxlKXtpZihhLmZpbHRlcilyZXR1cm4gYS5maWx0ZXIoYixjKTtkPVtdO2ZvcihlIGluIGEpfn5lK1wiXCI9PWUrXCJcIiYmZT49MCYmYi5jYWxsKGMsYVtlXSwrZSxhKSYmZC5wdXNoKGFbZV0pO3JldHVybiBkfSxhLmpzdHJlZS5wbHVnaW5zLmNoYW5nZWQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTt0aGlzLnRyaWdnZXI9ZnVuY3Rpb24oYSxkKXt2YXIgZSxmO2lmKGR8fChkPXt9KSxcImNoYW5nZWRcIj09PWEucmVwbGFjZShcIi5qc3RyZWVcIixcIlwiKSl7ZC5jaGFuZ2VkPXtzZWxlY3RlZDpbXSxkZXNlbGVjdGVkOltdfTt2YXIgZz17fTtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylnW2NbZV1dPTE7Zm9yKGU9MCxmPWQuc2VsZWN0ZWQubGVuZ3RoO2Y+ZTtlKyspZ1tkLnNlbGVjdGVkW2VdXT9nW2Quc2VsZWN0ZWRbZV1dPTI6ZC5jaGFuZ2VkLnNlbGVjdGVkLnB1c2goZC5zZWxlY3RlZFtlXSk7Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspMT09PWdbY1tlXV0mJmQuY2hhbmdlZC5kZXNlbGVjdGVkLnB1c2goY1tlXSk7Yz1kLnNlbGVjdGVkLnNsaWNlKCl9Yi50cmlnZ2VyLmNhbGwodGhpcyxhLGQpfSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oYSxkKXtyZXR1cm4gYz1bXSxiLnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpfX07dmFyIG09aS5jcmVhdGVFbGVtZW50KFwiSVwiKTttLmNsYXNzTmFtZT1cImpzdHJlZS1pY29uIGpzdHJlZS1jaGVja2JveFwiLG0uc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGEuanN0cmVlLmRlZmF1bHRzLmNoZWNrYm94PXt2aXNpYmxlOiEwLHRocmVlX3N0YXRlOiEwLHdob2xlX25vZGU6ITAsa2VlcF9zZWxlY3RlZF9zdHlsZTohMCxjYXNjYWRlOlwiXCIsdGllX3NlbGVjdGlvbjohMH0sYS5qc3RyZWUucGx1Z2lucy5jaGVja2JveD1mdW5jdGlvbihjLGQpe3RoaXMuYmluZD1mdW5jdGlvbigpe2QuYmluZC5jYWxsKHRoaXMpLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPSExLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9W10sdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aHJlZV9zdGF0ZSYmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZT1cInVwK2Rvd24rdW5kZXRlcm1pbmVkXCIpLHRoaXMuZWxlbWVudC5vbihcImluaXQuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY2hlY2tib3gudmlzaWJsZT10aGlzLnNldHRpbmdzLmNoZWNrYm94LnZpc2libGUsdGhpcy5zZXR0aW5ncy5jaGVja2JveC5rZWVwX3NlbGVjdGVkX3N0eWxlfHx0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3gtbm8tY2xpY2tlZFwiKSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1zZWxlY3Rpb25cIil9LHRoaXMpKS5vbihcImxvYWRpbmcuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXNbdGhpcy5fZGF0YS5jaGVja2JveC52aXNpYmxlP1wic2hvd19jaGVja2JveGVzXCI6XCJoaWRlX2NoZWNrYm94ZXNcIl0oKX0sdGhpcykpLC0xIT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1bmRldGVybWluZWRcIikmJnRoaXMuZWxlbWVudC5vbihcImNoYW5nZWQuanN0cmVlIHVuY2hlY2tfbm9kZS5qc3RyZWUgY2hlY2tfbm9kZS5qc3RyZWUgdW5jaGVja19hbGwuanN0cmVlIGNoZWNrX2FsbC5qc3RyZWUgbW92ZV9ub2RlLmpzdHJlZSBjb3B5X25vZGUuanN0cmVlIHJlZHJhdy5qc3RyZWUgb3Blbl9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNoZWNrYm94LnV0byYmY2xlYXJUaW1lb3V0KHRoaXMuX2RhdGEuY2hlY2tib3gudXRvKSx0aGlzLl9kYXRhLmNoZWNrYm94LnV0bz1zZXRUaW1lb3V0KGEucHJveHkodGhpcy5fdW5kZXRlcm1pbmVkLHRoaXMpLDUwKX0sdGhpcykpLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbnx8dGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX21vZGVsLmRhdGEsZD1jW2IucGFyZW50XSxlPWIubm9kZXMsZixnO2ZvcihmPTAsZz1lLmxlbmd0aDtnPmY7ZisrKWNbZVtmXV0uc3RhdGUuY2hlY2tlZD1jW2VbZl1dLnN0YXRlLmNoZWNrZWR8fGNbZVtmXV0ub3JpZ2luYWwmJmNbZVtmXV0ub3JpZ2luYWwuc3RhdGUmJmNbZVtmXV0ub3JpZ2luYWwuc3RhdGUuY2hlY2tlZCxjW2VbZl1dLnN0YXRlLmNoZWNrZWQmJnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQucHVzaChlW2ZdKX0sdGhpcykpLC0xPT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1cFwiKSYmLTE9PT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcImRvd25cIil8fHRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzLl9tb2RlbC5kYXRhLGU9ZFtjLnBhcmVudF0sZj1jLm5vZGVzLGc9W10saCxpLGosayxsLG0sbj10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUsbz10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoLTEhPT1uLmluZGV4T2YoXCJkb3duXCIpKWlmKGUuc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3IoaT0wLGo9Zi5sZW5ndGg7aj5pO2krKylkW2ZbaV1dLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMDt0aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD10aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5jb25jYXQoZil9ZWxzZSBmb3IoaT0wLGo9Zi5sZW5ndGg7aj5pO2krKylpZihkW2ZbaV1dLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGs9MCxsPWRbZltpXV0uY2hpbGRyZW5fZC5sZW5ndGg7bD5rO2srKylkW2RbZltpXV0uY2hpbGRyZW5fZFtrXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwO3RoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPXRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLmNvbmNhdChkW2ZbaV1dLmNoaWxkcmVuX2QpfWlmKC0xIT09bi5pbmRleE9mKFwidXBcIikpe2ZvcihpPTAsaj1lLmNoaWxkcmVuX2QubGVuZ3RoO2o+aTtpKyspZFtlLmNoaWxkcmVuX2RbaV1dLmNoaWxkcmVuLmxlbmd0aHx8Zy5wdXNoKGRbZS5jaGlsZHJlbl9kW2ldXS5wYXJlbnQpO2ZvcihnPWEudmFrYXRhLmFycmF5X3VuaXF1ZShnKSxrPTAsbD1nLmxlbmd0aDtsPms7aysrKXtlPWRbZ1trXV07d2hpbGUoZSYmZS5pZCE9PWEuanN0cmVlLnJvb3Qpe2ZvcihoPTAsaT0wLGo9ZS5jaGlsZHJlbi5sZW5ndGg7aj5pO2krKyloKz1kW2UuY2hpbGRyZW5baV1dLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXTtpZihoIT09ailicmVhaztlLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGUuaWQpLG09dGhpcy5nZXRfbm9kZShlLCEwKSxtJiZtLmxlbmd0aCYmbS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG8/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksZT10aGlzLmdldF9ub2RlKGUucGFyZW50KX19fXRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X3VuaXF1ZSh0aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJzZWxlY3Rfbm9kZS5qc3RyZWVcIjpcImNoZWNrX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPWMubm9kZSxlPXRoaXMuX21vZGVsLmRhdGEsZj10aGlzLmdldF9ub2RlKGQucGFyZW50KSxnPXRoaXMuZ2V0X25vZGUoZCwhMCksaCxpLGosayxsPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxtPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbixuPXt9LG89dGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ7Zm9yKGg9MCxpPW8ubGVuZ3RoO2k+aDtoKyspbltvW2hdXT0hMDtpZigtMSE9PWwuaW5kZXhPZihcImRvd25cIikpZm9yKGg9MCxpPWQuY2hpbGRyZW5fZC5sZW5ndGg7aT5oO2grKyluW2QuY2hpbGRyZW5fZFtoXV09ITAsaz1lW2QuY2hpbGRyZW5fZFtoXV0say5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsayYmay5vcmlnaW5hbCYmay5vcmlnaW5hbC5zdGF0ZSYmay5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihrLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSk7aWYoLTEhPT1sLmluZGV4T2YoXCJ1cFwiKSl3aGlsZShmJiZmLmlkIT09YS5qc3RyZWUucm9vdCl7Zm9yKGo9MCxoPTAsaT1mLmNoaWxkcmVuLmxlbmd0aDtpPmg7aCsrKWorPWVbZi5jaGlsZHJlbltoXV0uc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKGohPT1pKWJyZWFrO2Yuc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLG5bZi5pZF09ITAsaz10aGlzLmdldF9ub2RlKGYsITApLGsmJmsubGVuZ3RoJiZrLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MobT9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSxmPXRoaXMuZ2V0X25vZGUoZi5wYXJlbnQpfW89W107Zm9yKGggaW4gbiluLmhhc093blByb3BlcnR5KGgpJiZvLnB1c2goaCk7dGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9bywtMSE9PWwuaW5kZXhPZihcImRvd25cIikmJmcubGVuZ3RoJiZnLmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApfSx0aGlzKSkub24odGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP1wiZGVzZWxlY3RfYWxsLmpzdHJlZVwiOlwidW5jaGVja19hbGwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuZ2V0X25vZGUoYS5qc3RyZWUucm9vdCksZT10aGlzLl9tb2RlbC5kYXRhLGYsZyxoO2ZvcihmPTAsZz1kLmNoaWxkcmVuX2QubGVuZ3RoO2c+ZjtmKyspaD1lW2QuY2hpbGRyZW5fZFtmXV0saCYmaC5vcmlnaW5hbCYmaC5vcmlnaW5hbC5zdGF0ZSYmaC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJkZXNlbGVjdF9ub2RlLmpzdHJlZVwiOlwidW5jaGVja19ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXt2YXIgZD1jLm5vZGUsZT10aGlzLmdldF9ub2RlKGQsITApLGYsZyxoLGk9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLGo9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLGs9dGhpcy5fZGF0YVtqP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQsbD17fTtpZihkJiZkLm9yaWdpbmFsJiZkLm9yaWdpbmFsLnN0YXRlJiZkLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGQub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKSwtMSE9PWkuaW5kZXhPZihcImRvd25cIikpZm9yKGY9MCxnPWQuY2hpbGRyZW5fZC5sZW5ndGg7Zz5mO2YrKyloPXRoaXMuX21vZGVsLmRhdGFbZC5jaGlsZHJlbl9kW2ZdXSxoLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSxoJiZoLm9yaWdpbmFsJiZoLm9yaWdpbmFsLnN0YXRlJiZoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKTtpZigtMSE9PWkuaW5kZXhPZihcInVwXCIpKWZvcihmPTAsZz1kLnBhcmVudHMubGVuZ3RoO2c+ZjtmKyspaD10aGlzLl9tb2RlbC5kYXRhW2QucGFyZW50c1tmXV0saC5zdGF0ZVtqP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITEsaCYmaC5vcmlnaW5hbCYmaC5vcmlnaW5hbC5zdGF0ZSYmaC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSksaD10aGlzLmdldF9ub2RlKGQucGFyZW50c1tmXSwhMCksaCYmaC5sZW5ndGgmJmguYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhqP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpO2ZvcihsPXt9LGY9MCxnPWsubGVuZ3RoO2c+ZjtmKyspLTEhPT1pLmluZGV4T2YoXCJkb3duXCIpJiYtMSE9PWEuaW5BcnJheShrW2ZdLGQuY2hpbGRyZW5fZCl8fC0xIT09aS5pbmRleE9mKFwidXBcIikmJi0xIT09YS5pbkFycmF5KGtbZl0sZC5wYXJlbnRzKXx8KGxba1tmXV09ITApO2s9W107Zm9yKGYgaW4gbClsLmhhc093blByb3BlcnR5KGYpJiZrLnB1c2goZik7dGhpcy5fZGF0YVtqP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9aywtMSE9PWkuaW5kZXhPZihcImRvd25cIikmJmUubGVuZ3RoJiZlLmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhqP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpfSx0aGlzKSksLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVwXCIpJiZ0aGlzLmVsZW1lbnQub24oXCJkZWxldGVfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5nZXRfbm9kZShjLnBhcmVudCksZT10aGlzLl9tb2RlbC5kYXRhLGYsZyxoLGksaj10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247d2hpbGUoZCYmZC5pZCE9PWEuanN0cmVlLnJvb3QmJiFkLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGg9MCxmPTAsZz1kLmNoaWxkcmVuLmxlbmd0aDtnPmY7ZisrKWgrPWVbZC5jaGlsZHJlbltmXV0uc3RhdGVbaj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKCEoZz4wJiZoPT09ZykpYnJlYWs7ZC5zdGF0ZVtqP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVtqP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChkLmlkKSxpPXRoaXMuZ2V0X25vZGUoZCwhMCksaSYmaS5sZW5ndGgmJmkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhqP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGQ9dGhpcy5nZXRfbm9kZShkLnBhcmVudCl9fSx0aGlzKSkub24oXCJtb3ZlX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPWMuaXNfbXVsdGksZT1jLm9sZF9wYXJlbnQsZj10aGlzLmdldF9ub2RlKGMucGFyZW50KSxnPXRoaXMuX21vZGVsLmRhdGEsaCxpLGosayxsLG09dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uO2lmKCFkKXtoPXRoaXMuZ2V0X25vZGUoZSk7d2hpbGUoaCYmaC5pZCE9PWEuanN0cmVlLnJvb3QmJiFoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGk9MCxqPTAsaz1oLmNoaWxkcmVuLmxlbmd0aDtrPmo7aisrKWkrPWdbaC5jaGlsZHJlbltqXV0uc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKCEoaz4wJiZpPT09aykpYnJlYWs7aC5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChoLmlkKSxsPXRoaXMuZ2V0X25vZGUoaCwhMCksbCYmbC5sZW5ndGgmJmwuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGg9dGhpcy5nZXRfbm9kZShoLnBhcmVudCl9fWg9Zjt3aGlsZShoJiZoLmlkIT09YS5qc3RyZWUucm9vdCl7Zm9yKGk9MCxqPTAsaz1oLmNoaWxkcmVuLmxlbmd0aDtrPmo7aisrKWkrPWdbaC5jaGlsZHJlbltqXV0uc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKGk9PT1rKWguc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdfHwoaC5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChoLmlkKSxsPXRoaXMuZ2V0X25vZGUoaCwhMCksbCYmbC5sZW5ndGgmJmwuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpKTtlbHNle2lmKCFoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSlicmVhaztoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSx0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxoLmlkKSxsPXRoaXMuZ2V0X25vZGUoaCwhMCksbCYmbC5sZW5ndGgmJmwuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpfWg9dGhpcy5nZXRfbm9kZShoLnBhcmVudCl9fSx0aGlzKSl9LHRoaXMuX3VuZGV0ZXJtaW5lZD1mdW5jdGlvbigpe2lmKG51bGwhPT10aGlzLmVsZW1lbnQpe3ZhciBjLGQsZSxmLGc9e30saD10aGlzLl9tb2RlbC5kYXRhLGk9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLGo9dGhpcy5fZGF0YVtpP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQsaz1bXSxsPXRoaXM7Zm9yKGM9MCxkPWoubGVuZ3RoO2Q+YztjKyspaWYoaFtqW2NdXSYmaFtqW2NdXS5wYXJlbnRzKWZvcihlPTAsZj1oW2pbY11dLnBhcmVudHMubGVuZ3RoO2Y+ZTtlKyspe2lmKGdbaFtqW2NdXS5wYXJlbnRzW2VdXSE9PWIpYnJlYWs7aFtqW2NdXS5wYXJlbnRzW2VdIT09YS5qc3RyZWUucm9vdCYmKGdbaFtqW2NdXS5wYXJlbnRzW2VdXT0hMCxrLnB1c2goaFtqW2NdXS5wYXJlbnRzW2VdKSl9Zm9yKHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIikubm90KFwiOmhhcyguanN0cmVlLWNoaWxkcmVuKVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9bC5nZXRfbm9kZSh0aGlzKSxqO2lmKGkuc3RhdGUubG9hZGVkKXtmb3IoYz0wLGQ9aS5jaGlsZHJlbl9kLmxlbmd0aDtkPmM7YysrKWlmKGo9aFtpLmNoaWxkcmVuX2RbY11dLCFqLnN0YXRlLmxvYWRlZCYmai5vcmlnaW5hbCYmai5vcmlnaW5hbC5zdGF0ZSYmai5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJmoub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPT09ITApZm9yKGdbai5pZF09PT1iJiZqLmlkIT09YS5qc3RyZWUucm9vdCYmKGdbai5pZF09ITAsay5wdXNoKGouaWQpKSxlPTAsZj1qLnBhcmVudHMubGVuZ3RoO2Y+ZTtlKyspZ1tqLnBhcmVudHNbZV1dPT09YiYmai5wYXJlbnRzW2VdIT09YS5qc3RyZWUucm9vdCYmKGdbai5wYXJlbnRzW2VdXT0hMCxrLnB1c2goai5wYXJlbnRzW2VdKSl9ZWxzZSBpZihpLm9yaWdpbmFsJiZpLm9yaWdpbmFsLnN0YXRlJiZpLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmaS5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9PT0hMClmb3IoZ1tpLmlkXT09PWImJmkuaWQhPT1hLmpzdHJlZS5yb290JiYoZ1tpLmlkXT0hMCxrLnB1c2goaS5pZCkpLGU9MCxmPWkucGFyZW50cy5sZW5ndGg7Zj5lO2UrKylnW2kucGFyZW50c1tlXV09PT1iJiZpLnBhcmVudHNbZV0hPT1hLmpzdHJlZS5yb290JiYoZ1tpLnBhcmVudHNbZV1dPSEwLGsucHVzaChpLnBhcmVudHNbZV0pKX0pLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS11bmRldGVybWluZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtdW5kZXRlcm1pbmVkXCIpLGM9MCxkPWsubGVuZ3RoO2Q+YztjKyspaFtrW2NdXS5zdGF0ZVtpP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl18fChqPXRoaXMuZ2V0X25vZGUoa1tjXSwhMCksaiYmai5sZW5ndGgmJmouY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hlY2tib3hcIikuYWRkQ2xhc3MoXCJqc3RyZWUtdW5kZXRlcm1pbmVkXCIpKX19LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oYixjLGUsZil7aWYoYj1kLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl7dmFyIGcsaCxpPW51bGwsaj1udWxsO2ZvcihnPTAsaD1iLmNoaWxkTm9kZXMubGVuZ3RoO2g+ZztnKyspaWYoYi5jaGlsZE5vZGVzW2ddJiZiLmNoaWxkTm9kZXNbZ10uY2xhc3NOYW1lJiYtMSE9PWIuY2hpbGROb2Rlc1tnXS5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1hbmNob3JcIikpe2k9Yi5jaGlsZE5vZGVzW2ddO2JyZWFrfWkmJighdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uJiZ0aGlzLl9tb2RlbC5kYXRhW2IuaWRdLnN0YXRlLmNoZWNrZWQmJihpLmNsYXNzTmFtZSs9XCIganN0cmVlLWNoZWNrZWRcIiksaj1tLmNsb25lTm9kZSghMSksdGhpcy5fbW9kZWwuZGF0YVtiLmlkXS5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZCYmKGouY2xhc3NOYW1lKz1cIiBqc3RyZWUtY2hlY2tib3gtZGlzYWJsZWRcIiksaS5pbnNlcnRCZWZvcmUoaixpLmNoaWxkTm9kZXNbMF0pKX1yZXR1cm4gZXx8LTE9PT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVuZGV0ZXJtaW5lZFwiKXx8KHRoaXMuX2RhdGEuY2hlY2tib3gudXRvJiZjbGVhclRpbWVvdXQodGhpcy5fZGF0YS5jaGVja2JveC51dG8pLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPXNldFRpbWVvdXQoYS5wcm94eSh0aGlzLl91bmRldGVybWluZWQsdGhpcyksNTApKSxifSx0aGlzLnNob3dfY2hlY2tib3hlcz1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuY2hlY2tib3hlcz0hMCx0aGlzLmdldF9jb250YWluZXJfdWwoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1uby1jaGVja2JveGVzXCIpfSx0aGlzLmhpZGVfY2hlY2tib3hlcz1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuY2hlY2tib3hlcz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1jaGVja2JveGVzXCIpfSx0aGlzLnRvZ2dsZV9jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzP3RoaXMuaGlkZV9jaGVja2JveGVzKCk6dGhpcy5zaG93X2NoZWNrYm94ZXMoKX0sdGhpcy5pc191bmRldGVybWluZWQ9ZnVuY3Rpb24oYil7Yj10aGlzLmdldF9ub2RlKGIpO3ZhciBjPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxkLGUsZj10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24sZz10aGlzLl9kYXRhW2Y/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxoPXRoaXMuX21vZGVsLmRhdGE7aWYoIWJ8fGIuc3RhdGVbZj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPT09ITB8fC0xPT09Yy5pbmRleE9mKFwidW5kZXRlcm1pbmVkXCIpfHwtMT09PWMuaW5kZXhPZihcImRvd25cIikmJi0xPT09Yy5pbmRleE9mKFwidXBcIikpcmV0dXJuITE7aWYoIWIuc3RhdGUubG9hZGVkJiZiLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD09PSEwKXJldHVybiEwO2ZvcihkPTAsZT1iLmNoaWxkcmVuX2QubGVuZ3RoO2U+ZDtkKyspaWYoLTEhPT1hLmluQXJyYXkoYi5jaGlsZHJlbl9kW2RdLGcpfHwhaFtiLmNoaWxkcmVuX2RbZF1dLnN0YXRlLmxvYWRlZCYmaFtiLmNoaWxkcmVuX2RbZF1dLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZClyZXR1cm4hMDtyZXR1cm4hMX0sdGhpcy5kaXNhYmxlX2NoZWNrYm94PWZ1bmN0aW9uKGIpe3ZhciBjLGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZGlzYWJsZV9jaGVja2JveChiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhlPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkfHwoYi5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZD0hMCxlJiZlLmxlbmd0aCYmZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSx0aGlzLnRyaWdnZXIoXCJkaXNhYmxlX2NoZWNrYm94XCIse25vZGU6Yn0pKSkpOiExfSx0aGlzLmVuYWJsZV9jaGVja2JveD1mdW5jdGlvbihiKXt2YXIgYyxkLGU7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmVuYWJsZV9jaGVja2JveChiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhlPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkJiYoYi5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZD0hMSxlJiZlLmxlbmd0aCYmZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSx0aGlzLnRyaWdnZXIoXCJlbmFibGVfY2hlY2tib3hcIix7bm9kZTpifSkpKSk6ITF9LHRoaXMuYWN0aXZhdGVfbm9kZT1mdW5jdGlvbihiLGMpe3JldHVybiBhKGMudGFyZ2V0KS5oYXNDbGFzcyhcImpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKT8hMToodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uJiYodGhpcy5zZXR0aW5ncy5jaGVja2JveC53aG9sZV9ub2RlfHxhKGMudGFyZ2V0KS5oYXNDbGFzcyhcImpzdHJlZS1jaGVja2JveFwiKSkmJihjLmN0cmxLZXk9ITApLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbnx8IXRoaXMuc2V0dGluZ3MuY2hlY2tib3gud2hvbGVfbm9kZSYmIWEoYy50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94XCIpP2QuYWN0aXZhdGVfbm9kZS5jYWxsKHRoaXMsYixjKTp0aGlzLmlzX2Rpc2FibGVkKGIpPyExOih0aGlzLmlzX2NoZWNrZWQoYik/dGhpcy51bmNoZWNrX25vZGUoYixjKTp0aGlzLmNoZWNrX25vZGUoYixjKSx2b2lkIHRoaXMudHJpZ2dlcihcImFjdGl2YXRlX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGIpfSkpKX0sdGhpcy5jaGVja19ub2RlPWZ1bmN0aW9uKGIsYyl7aWYodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXJldHVybiB0aGlzLnNlbGVjdF9ub2RlKGIsITEsITAsYyk7dmFyIGQsZSxmLGc7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZT0wLGY9Yi5sZW5ndGg7Zj5lO2UrKyl0aGlzLmNoZWNrX25vZGUoYltlXSxjKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhkPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrZWR8fChiLnN0YXRlLmNoZWNrZWQ9ITAsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5wdXNoKGIuaWQpLGQmJmQubGVuZ3RoJiZkLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJjaGVja19ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGV2ZW50OmN9KSkpKTohMX0sdGhpcy51bmNoZWNrX25vZGU9ZnVuY3Rpb24oYixjKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZGVzZWxlY3Rfbm9kZShiLCExLGMpO3ZhciBkLGUsZjtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMudW5jaGVja19ub2RlKGJbZF0sYyk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZj10aGlzLmdldF9ub2RlKGIsITApLHZvaWQoYi5zdGF0ZS5jaGVja2VkJiYoYi5zdGF0ZS5jaGVja2VkPSExLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxiLmlkKSxmLmxlbmd0aCYmZi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrZWRcIiksdGhpcy50cmlnZ2VyKFwidW5jaGVja19ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGV2ZW50OmN9KSkpKTohMX0sdGhpcy5jaGVja19hbGw9ZnVuY3Rpb24oKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuc2VsZWN0X2FsbCgpO3ZhciBiPXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQuY29uY2F0KFtdKSxjLGQ7Zm9yKHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9dGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS5jaGlsZHJlbl9kLmNvbmNhdCgpLGM9MCxkPXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQubGVuZ3RoO2Q+YztjKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2NdXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFtjXV0uc3RhdGUuY2hlY2tlZD0hMCk7dGhpcy5yZWRyYXcoITApLHRoaXMudHJpZ2dlcihcImNoZWNrX2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkfSl9LHRoaXMudW5jaGVja19hbGw9ZnVuY3Rpb24oKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZGVzZWxlY3RfYWxsKCk7dmFyIGE9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5jb25jYXQoW10pLGIsYztmb3IoYj0wLGM9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5sZW5ndGg7Yz5iO2IrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbYl1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2JdXS5zdGF0ZS5jaGVja2VkPSExKTt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1jaGVja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrZWRcIiksdGhpcy50cmlnZ2VyKFwidW5jaGVja19hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxub2RlOmF9KX0sdGhpcy5pc19jaGVja2VkPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/dGhpcy5pc19zZWxlY3RlZChiKTooYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2Iuc3RhdGUuY2hlY2tlZDohMSl9LHRoaXMuZ2V0X2NoZWNrZWQ9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj90aGlzLmdldF9zZWxlY3RlZChiKTpiP2EubWFwKHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWR9LHRoaXMuZ2V0X3RvcF9jaGVja2VkPWZ1bmN0aW9uKGIpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5nZXRfdG9wX3NlbGVjdGVkKGIpO3ZhciBjPXRoaXMuZ2V0X2NoZWNrZWQoITApLGQ9e30sZSxmLGcsaDtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylkW2NbZV0uaWRdPWNbZV07Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZm9yKGc9MCxoPWNbZV0uY2hpbGRyZW5fZC5sZW5ndGg7aD5nO2crKylkW2NbZV0uY2hpbGRyZW5fZFtnXV0mJmRlbGV0ZSBkW2NbZV0uY2hpbGRyZW5fZFtnXV07Yz1bXTtmb3IoZSBpbiBkKWQuaGFzT3duUHJvcGVydHkoZSkmJmMucHVzaChlKTtyZXR1cm4gYj9hLm1hcChjLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoYSl9LHRoaXMpKTpjfSx0aGlzLmdldF9ib3R0b21fY2hlY2tlZD1mdW5jdGlvbihiKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZ2V0X2JvdHRvbV9zZWxlY3RlZChiKTt2YXIgYz10aGlzLmdldF9jaGVja2VkKCEwKSxkPVtdLGUsZjtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyljW2VdLmNoaWxkcmVuLmxlbmd0aHx8ZC5wdXNoKGNbZV0uaWQpO3JldHVybiBiP2EubWFwKGQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOmR9LHRoaXMubG9hZF9ub2RlPWZ1bmN0aW9uKGIsYyl7dmFyIGUsZixnLGgsaSxqO2lmKCFhLmlzQXJyYXkoYikmJiF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJihqPXRoaXMuZ2V0X25vZGUoYiksaiYmai5zdGF0ZS5sb2FkZWQpKWZvcihlPTAsZj1qLmNoaWxkcmVuX2QubGVuZ3RoO2Y+ZTtlKyspdGhpcy5fbW9kZWwuZGF0YVtqLmNoaWxkcmVuX2RbZV1dLnN0YXRlLmNoZWNrZWQmJihpPSEwLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxqLmNoaWxkcmVuX2RbZV0pKTtyZXR1cm4gZC5sb2FkX25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx0aGlzLmdldF9zdGF0ZT1mdW5jdGlvbigpe3ZhciBhPWQuZ2V0X3N0YXRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP2E6KGEuY2hlY2tib3g9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5zbGljZSgpLGEpfSx0aGlzLnNldF9zdGF0ZT1mdW5jdGlvbihiLGMpe3ZhciBlPWQuc2V0X3N0YXRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihlJiZiLmNoZWNrYm94KXtpZighdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXt0aGlzLnVuY2hlY2tfYWxsKCk7dmFyIGY9dGhpczthLmVhY2goYi5jaGVja2JveCxmdW5jdGlvbihhLGIpe2YuY2hlY2tfbm9kZShiKX0pfXJldHVybiBkZWxldGUgYi5jaGVja2JveCx0aGlzLnNldF9zdGF0ZShiLGMpLCExfXJldHVybiBlfSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHwodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSksZC5yZWZyZXNoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19LGEuanN0cmVlLmRlZmF1bHRzLmNvbmRpdGlvbmFsc2VsZWN0PWZ1bmN0aW9uKCl7cmV0dXJuITB9LGEuanN0cmVlLnBsdWdpbnMuY29uZGl0aW9uYWxzZWxlY3Q9ZnVuY3Rpb24oYSxiKXt0aGlzLmFjdGl2YXRlX25vZGU9ZnVuY3Rpb24oYSxjKXt0aGlzLnNldHRpbmdzLmNvbmRpdGlvbmFsc2VsZWN0LmNhbGwodGhpcyx0aGlzLmdldF9ub2RlKGEpLGMpJiZiLmFjdGl2YXRlX25vZGUuY2FsbCh0aGlzLGEsYyl9fSxhLmpzdHJlZS5kZWZhdWx0cy5jb250ZXh0bWVudT17c2VsZWN0X25vZGU6ITAsc2hvd19hdF9ub2RlOiEwLGl0ZW1zOmZ1bmN0aW9uKGIsYyl7cmV0dXJue2NyZWF0ZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxzZXBhcmF0b3JfYWZ0ZXI6ITAsX2Rpc2FibGVkOiExLGxhYmVsOlwiQ3JlYXRlXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmNyZWF0ZV9ub2RlKGQse30sXCJsYXN0XCIsZnVuY3Rpb24oYSl7c2V0VGltZW91dChmdW5jdGlvbigpe2MuZWRpdChhKX0sMCl9KX19LHJlbmFtZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsX2Rpc2FibGVkOiExLGxhYmVsOlwiUmVuYW1lXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmVkaXQoZCl9fSxyZW1vdmU6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsX2Rpc2FibGVkOiExLGxhYmVsOlwiRGVsZXRlXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmlzX3NlbGVjdGVkKGQpP2MuZGVsZXRlX25vZGUoYy5nZXRfc2VsZWN0ZWQoKSk6Yy5kZWxldGVfbm9kZShkKX19LGNjcDp7c2VwYXJhdG9yX2JlZm9yZTohMCxpY29uOiExLHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIkVkaXRcIixhY3Rpb246ITEsc3VibWVudTp7Y3V0OntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIkN1dFwiLGFjdGlvbjpmdW5jdGlvbihiKXt2YXIgYz1hLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLGQ9Yy5nZXRfbm9kZShiLnJlZmVyZW5jZSk7Yy5pc19zZWxlY3RlZChkKT9jLmN1dChjLmdldF90b3Bfc2VsZWN0ZWQoKSk6Yy5jdXQoZCl9fSxjb3B5OntzZXBhcmF0b3JfYmVmb3JlOiExLGljb246ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiQ29weVwiLGFjdGlvbjpmdW5jdGlvbihiKXt2YXIgYz1hLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLGQ9Yy5nZXRfbm9kZShiLnJlZmVyZW5jZSk7Yy5pc19zZWxlY3RlZChkKT9jLmNvcHkoYy5nZXRfdG9wX3NlbGVjdGVkKCkpOmMuY29weShkKX19LHBhc3RlOntzZXBhcmF0b3JfYmVmb3JlOiExLGljb246ITEsX2Rpc2FibGVkOmZ1bmN0aW9uKGIpe3JldHVybiFhLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLmNhbl9wYXN0ZSgpfSxzZXBhcmF0b3JfYWZ0ZXI6ITEsbGFiZWw6XCJQYXN0ZVwiLGFjdGlvbjpmdW5jdGlvbihiKXt2YXIgYz1hLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLGQ9Yy5nZXRfbm9kZShiLnJlZmVyZW5jZSk7Yy5wYXN0ZShkKX19fX19fX0sYS5qc3RyZWUucGx1Z2lucy5jb250ZXh0bWVudT1mdW5jdGlvbihjLGQpe3RoaXMuYmluZD1mdW5jdGlvbigpe2QuYmluZC5jYWxsKHRoaXMpO3ZhciBiPTAsYz1udWxsLGUsZjt0aGlzLmVsZW1lbnQub24oXCJjb250ZXh0bWVudS5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihhLGQpe2EucHJldmVudERlZmF1bHQoKSxiPWEuY3RybEtleT8rbmV3IERhdGU6MCwoZHx8YykmJihiPStuZXcgRGF0ZSsxZTQpLGMmJmNsZWFyVGltZW91dChjKSx0aGlzLmlzX2xvYWRpbmcoYS5jdXJyZW50VGFyZ2V0KXx8dGhpcy5zaG93X2NvbnRleHRtZW51KGEuY3VycmVudFRhcmdldCxhLnBhZ2VYLGEucGFnZVksYSl9LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGMpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZSYmKCFifHwrbmV3IERhdGUtYj4yNTApJiZhLnZha2F0YS5jb250ZXh0LmhpZGUoKSxiPTB9LHRoaXMpKS5vbihcInRvdWNoc3RhcnQuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGZ1bmN0aW9uKGIpe2Iub3JpZ2luYWxFdmVudCYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihlPWIucGFnZVgsZj1iLnBhZ2VZLGM9c2V0VGltZW91dChmdW5jdGlvbigpe2EoYi5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKFwiY29udGV4dG1lbnVcIiwhMCl9LDc1MCkpfSkub24oXCJ0b3VjaG1vdmUudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEpe2MmJmEub3JpZ2luYWxFdmVudCYmYS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZhLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihNYXRoLmFicyhlLWEucGFnZVgpPjUwfHxNYXRoLmFicyhmLWEucGFnZVkpPjUwKSYmY2xlYXJUaW1lb3V0KGMpfSkub24oXCJ0b3VjaGVuZC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSl7YyYmY2xlYXJUaW1lb3V0KGMpfSksYShpKS5vbihcImNvbnRleHRfaGlkZS52YWthdGEuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZT0hMSxiLnJlZmVyZW5jZS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jb250ZXh0XCIpfSx0aGlzKSl9LHRoaXMudGVhcmRvd249ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvbnRleHRtZW51LnZpc2libGUmJmEudmFrYXRhLmNvbnRleHQuaGlkZSgpLGQudGVhcmRvd24uY2FsbCh0aGlzKX0sdGhpcy5zaG93X2NvbnRleHRtZW51PWZ1bmN0aW9uKGMsZCxlLGYpe2lmKGM9dGhpcy5nZXRfbm9kZShjKSwhY3x8Yy5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGc9dGhpcy5zZXR0aW5ncy5jb250ZXh0bWVudSxoPXRoaXMuZ2V0X25vZGUoYywhMCksaT1oLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIiksaj0hMSxrPSExOyhnLnNob3dfYXRfbm9kZXx8ZD09PWJ8fGU9PT1iKSYmKGo9aS5vZmZzZXQoKSxkPWoubGVmdCxlPWoudG9wK3RoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpLHRoaXMuc2V0dGluZ3MuY29udGV4dG1lbnUuc2VsZWN0X25vZGUmJiF0aGlzLmlzX3NlbGVjdGVkKGMpJiZ0aGlzLmFjdGl2YXRlX25vZGUoYyxmKSxrPWcuaXRlbXMsYS5pc0Z1bmN0aW9uKGspJiYoaz1rLmNhbGwodGhpcyxjLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5fc2hvd19jb250ZXh0bWVudShjLGQsZSxhKX0sdGhpcykpKSxhLmlzUGxhaW5PYmplY3QoaykmJnRoaXMuX3Nob3dfY29udGV4dG1lbnUoYyxkLGUsayl9LHRoaXMuX3Nob3dfY29udGV4dG1lbnU9ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGY9dGhpcy5nZXRfbm9kZShiLCEwKSxnPWYuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKTthKGkpLm9uZShcImNvbnRleHRfc2hvdy52YWthdGEuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPVwianN0cmVlLWNvbnRleHRtZW51IGpzdHJlZS1cIit0aGlzLmdldF90aGVtZSgpK1wiLWNvbnRleHRtZW51XCI7YShjLmVsZW1lbnQpLmFkZENsYXNzKGQpLGcuYWRkQ2xhc3MoXCJqc3RyZWUtY29udGV4dFwiKX0sdGhpcykpLHRoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZT0hMCxhLnZha2F0YS5jb250ZXh0LnNob3coZyx7eDpjLHk6ZH0sZSksdGhpcy50cmlnZ2VyKFwic2hvd19jb250ZXh0bWVudVwiLHtub2RlOmIseDpjLHk6ZH0pfX0sZnVuY3Rpb24oYSl7dmFyIGI9ITEsYz17ZWxlbWVudDohMSxyZWZlcmVuY2U6ITEscG9zaXRpb25feDowLHBvc2l0aW9uX3k6MCxpdGVtczpbXSxodG1sOlwiXCIsaXNfdmlzaWJsZTohMX07YS52YWthdGEuY29udGV4dD17c2V0dGluZ3M6e2hpZGVfb25tb3VzZWxlYXZlOjAsaWNvbnM6ITB9LF90cmlnZ2VyOmZ1bmN0aW9uKGIpe2EoaSkudHJpZ2dlckhhbmRsZXIoXCJjb250ZXh0X1wiK2IrXCIudmFrYXRhXCIse3JlZmVyZW5jZTpjLnJlZmVyZW5jZSxlbGVtZW50OmMuZWxlbWVudCxwb3NpdGlvbjp7eDpjLnBvc2l0aW9uX3gseTpjLnBvc2l0aW9uX3l9fSl9LF9leGVjdXRlOmZ1bmN0aW9uKGIpe3JldHVybiBiPWMuaXRlbXNbYl0sYiYmKCFiLl9kaXNhYmxlZHx8YS5pc0Z1bmN0aW9uKGIuX2Rpc2FibGVkKSYmIWIuX2Rpc2FibGVkKHtpdGVtOmIscmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50fSkpJiZiLmFjdGlvbj9iLmFjdGlvbi5jYWxsKG51bGwse2l0ZW06YixyZWZlcmVuY2U6Yy5yZWZlcmVuY2UsZWxlbWVudDpjLmVsZW1lbnQscG9zaXRpb246e3g6Yy5wb3NpdGlvbl94LHk6Yy5wb3NpdGlvbl95fX0pOiExfSxfcGFyc2U6ZnVuY3Rpb24oYixkKXtpZighYilyZXR1cm4hMTtkfHwoYy5odG1sPVwiXCIsYy5pdGVtcz1bXSk7dmFyIGU9XCJcIixmPSExLGc7cmV0dXJuIGQmJihlKz1cIjx1bD5cIiksYS5lYWNoKGIsZnVuY3Rpb24oYixkKXtyZXR1cm4gZD8oYy5pdGVtcy5wdXNoKGQpLCFmJiZkLnNlcGFyYXRvcl9iZWZvcmUmJihlKz1cIjxsaSBjbGFzcz0ndmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yJz48YSBocmVmPScjJyBcIisoYS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5pY29ucz9cIlwiOidzdHlsZT1cIm1hcmdpbi1sZWZ0OjBweDtcIicpK1wiPiYjMTYwOzwvYT48L2xpPlwiKSxmPSExLGUrPVwiPGxpIGNsYXNzPSdcIisoZC5fY2xhc3N8fFwiXCIpKyhkLl9kaXNhYmxlZD09PSEwfHxhLmlzRnVuY3Rpb24oZC5fZGlzYWJsZWQpJiZkLl9kaXNhYmxlZCh7aXRlbTpkLHJlZmVyZW5jZTpjLnJlZmVyZW5jZSxlbGVtZW50OmMuZWxlbWVudH0pP1wiIHZha2F0YS1jb250ZXh0bWVudS1kaXNhYmxlZCBcIjpcIlwiKStcIicgXCIrKGQuc2hvcnRjdXQ/XCIgZGF0YS1zaG9ydGN1dD0nXCIrZC5zaG9ydGN1dCtcIicgXCI6XCJcIikrXCI+XCIsZSs9XCI8YSBocmVmPScjJyByZWw9J1wiKyhjLml0ZW1zLmxlbmd0aC0xKStcIic+XCIsYS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5pY29ucyYmKGUrPVwiPGkgXCIsZC5pY29uJiYoZSs9LTEhPT1kLmljb24uaW5kZXhPZihcIi9cIil8fC0xIT09ZC5pY29uLmluZGV4T2YoXCIuXCIpP1wiIHN0eWxlPSdiYWNrZ3JvdW5kOnVybChcXFwiXCIrZC5pY29uK1wiXFxcIikgY2VudGVyIGNlbnRlciBuby1yZXBlYXQnIFwiOlwiIGNsYXNzPSdcIitkLmljb24rXCInIFwiKSxlKz1cIj48L2k+PHNwYW4gY2xhc3M9J3Zha2F0YS1jb250ZXh0bWVudS1zZXAnPiYjMTYwOzwvc3Bhbj5cIiksZSs9KGEuaXNGdW5jdGlvbihkLmxhYmVsKT9kLmxhYmVsKHtpdGVtOmIscmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50fSk6ZC5sYWJlbCkrKGQuc2hvcnRjdXQ/JyA8c3BhbiBjbGFzcz1cInZha2F0YS1jb250ZXh0bWVudS1zaG9ydGN1dCB2YWthdGEtY29udGV4dG1lbnUtc2hvcnRjdXQtJytkLnNob3J0Y3V0KydcIj4nKyhkLnNob3J0Y3V0X2xhYmVsfHxcIlwiKStcIjwvc3Bhbj5cIjpcIlwiKStcIjwvYT5cIixkLnN1Ym1lbnUmJihnPWEudmFrYXRhLmNvbnRleHQuX3BhcnNlKGQuc3VibWVudSwhMCksZyYmKGUrPWcpKSxlKz1cIjwvbGk+XCIsdm9pZChkLnNlcGFyYXRvcl9hZnRlciYmKGUrPVwiPGxpIGNsYXNzPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InPjxhIGhyZWY9JyMnIFwiKyhhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zP1wiXCI6J3N0eWxlPVwibWFyZ2luLWxlZnQ6MHB4O1wiJykrXCI+JiMxNjA7PC9hPjwvbGk+XCIsZj0hMCkpKTohMH0pLGU9ZS5yZXBsYWNlKC88bGkgY2xhc3NcXD0ndmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yJ1xcPjxcXC9saVxcPiQvLFwiXCIpLGQmJihlKz1cIjwvdWw+XCIpLGR8fChjLmh0bWw9ZSxhLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwicGFyc2VcIikpLGUubGVuZ3RoPjEwP2U6ITF9LF9zaG93X3N1Ym1lbnU6ZnVuY3Rpb24oYyl7aWYoYz1hKGMpLGMubGVuZ3RoJiZjLmNoaWxkcmVuKFwidWxcIikubGVuZ3RoKXt2YXIgZD1jLmNoaWxkcmVuKFwidWxcIiksZT1jLm9mZnNldCgpLmxlZnQsZj1lK2Mub3V0ZXJXaWR0aCgpLGc9Yy5vZmZzZXQoKS50b3AsaD1kLndpZHRoKCksaT1kLmhlaWdodCgpLGo9YSh3aW5kb3cpLndpZHRoKCkrYSh3aW5kb3cpLnNjcm9sbExlZnQoKSxrPWEod2luZG93KS5oZWlnaHQoKSthKHdpbmRvdykuc2Nyb2xsVG9wKCk7Yj9jW2YtKGgrMTArYy5vdXRlcldpZHRoKCkpPDA/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ2YWthdGEtY29udGV4dC1sZWZ0XCIpOmNbZitoPmomJmU+ai1mP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidmFrYXRhLWNvbnRleHQtcmlnaHRcIiksZytpKzEwPmsmJmQuY3NzKFwiYm90dG9tXCIsXCItMXB4XCIpLGMuaGFzQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1yaWdodFwiKT9oPmUmJmQuY3NzKFwibWFyZ2luLXJpZ2h0XCIsZS1oKTpoPmotZiYmZC5jc3MoXCJtYXJnaW4tbGVmdFwiLGotZi1oKSxkLnNob3coKX19LHNob3c6ZnVuY3Rpb24oZCxlLGYpe3ZhciBnLGgsaSxqLGssbCxtLG4sbz0hMDtzd2l0Y2goYy5lbGVtZW50JiZjLmVsZW1lbnQubGVuZ3RoJiZjLmVsZW1lbnQud2lkdGgoXCJcIiksbyl7Y2FzZSFlJiYhZDpyZXR1cm4hMTtjYXNlISFlJiYhIWQ6Yy5yZWZlcmVuY2U9ZCxjLnBvc2l0aW9uX3g9ZS54LGMucG9zaXRpb25feT1lLnk7YnJlYWs7Y2FzZSFlJiYhIWQ6Yy5yZWZlcmVuY2U9ZCxnPWQub2Zmc2V0KCksYy5wb3NpdGlvbl94PWcubGVmdCtkLm91dGVySGVpZ2h0KCksYy5wb3NpdGlvbl95PWcudG9wO2JyZWFrO2Nhc2UhIWUmJiFkOmMucG9zaXRpb25feD1lLngsYy5wb3NpdGlvbl95PWUueX1kJiYhZiYmYShkKS5kYXRhKFwidmFrYXRhX2NvbnRleHRtZW51XCIpJiYoZj1hKGQpLmRhdGEoXCJ2YWthdGFfY29udGV4dG1lbnVcIikpLGEudmFrYXRhLmNvbnRleHQuX3BhcnNlKGYpJiZjLmVsZW1lbnQuaHRtbChjLmh0bWwpLGMuaXRlbXMubGVuZ3RoJiYoYy5lbGVtZW50LmFwcGVuZFRvKFwiYm9keVwiKSxoPWMuZWxlbWVudCxpPWMucG9zaXRpb25feCxqPWMucG9zaXRpb25feSxrPWgud2lkdGgoKSxsPWguaGVpZ2h0KCksbT1hKHdpbmRvdykud2lkdGgoKSthKHdpbmRvdykuc2Nyb2xsTGVmdCgpLG49YSh3aW5kb3cpLmhlaWdodCgpK2Eod2luZG93KS5zY3JvbGxUb3AoKSxiJiYoaS09aC5vdXRlcldpZHRoKCktYShkKS5vdXRlcldpZHRoKCksaTxhKHdpbmRvdykuc2Nyb2xsTGVmdCgpKzIwJiYoaT1hKHdpbmRvdykuc2Nyb2xsTGVmdCgpKzIwKSksaStrKzIwPm0mJihpPW0tKGsrMjApKSxqK2wrMjA+biYmKGo9bi0obCsyMCkpLGMuZWxlbWVudC5jc3Moe2xlZnQ6aSx0b3A6an0pLnNob3coKS5maW5kKFwiYVwiKS5maXJzdCgpLmZvY3VzKCkucGFyZW50KCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxjLmlzX3Zpc2libGU9ITAsYS52YWthdGEuY29udGV4dC5fdHJpZ2dlcihcInNob3dcIikpfSxoaWRlOmZ1bmN0aW9uKCl7Yy5pc192aXNpYmxlJiYoYy5lbGVtZW50LmhpZGUoKS5maW5kKFwidWxcIikuaGlkZSgpLmVuZCgpLmZpbmQoXCI6Zm9jdXNcIikuYmx1cigpLmVuZCgpLmRldGFjaCgpLGMuaXNfdmlzaWJsZT0hMSxhLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwiaGlkZVwiKSl9fSxhKGZ1bmN0aW9uKCl7Yj1cInJ0bFwiPT09YShcImJvZHlcIikuY3NzKFwiZGlyZWN0aW9uXCIpO3ZhciBkPSExO2MuZWxlbWVudD1hKFwiPHVsIGNsYXNzPSd2YWthdGEtY29udGV4dCc+PC91bD5cIiksYy5lbGVtZW50Lm9uKFwibW91c2VlbnRlclwiLFwibGlcIixmdW5jdGlvbihiKXtiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGEuY29udGFpbnModGhpcyxiLnJlbGF0ZWRUYXJnZXQpfHwoZCYmY2xlYXJUaW1lb3V0KGQpLGMuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuZW5kKCksYSh0aGlzKS5zaWJsaW5ncygpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCkuZW5kKCkucGFyZW50c1VudGlsKFwiLnZha2F0YS1jb250ZXh0XCIsXCJsaVwiKS5hZGRCYWNrKCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxhLnZha2F0YS5jb250ZXh0Ll9zaG93X3N1Ym1lbnUodGhpcykpfSkub24oXCJtb3VzZWxlYXZlXCIsXCJsaVwiLGZ1bmN0aW9uKGIpe2EuY29udGFpbnModGhpcyxiLnJlbGF0ZWRUYXJnZXQpfHxhKHRoaXMpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikuYWRkQmFjaygpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIil9KS5vbihcIm1vdXNlbGVhdmVcIixmdW5jdGlvbihiKXthKHRoaXMpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmhpZGVfb25tb3VzZWxlYXZlJiYoZD1zZXRUaW1lb3V0KGZ1bmN0aW9uKGIpe3JldHVybiBmdW5jdGlvbigpe2EudmFrYXRhLmNvbnRleHQuaGlkZSgpfX0odGhpcyksYS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5oaWRlX29ubW91c2VsZWF2ZSkpfSkub24oXCJjbGlja1wiLFwiYVwiLGZ1bmN0aW9uKGIpe2IucHJldmVudERlZmF1bHQoKSxhKHRoaXMpLmJsdXIoKS5wYXJlbnQoKS5oYXNDbGFzcyhcInZha2F0YS1jb250ZXh0LWRpc2FibGVkXCIpfHxhLnZha2F0YS5jb250ZXh0Ll9leGVjdXRlKGEodGhpcykuYXR0cihcInJlbFwiKSk9PT0hMXx8YS52YWthdGEuY29udGV4dC5oaWRlKCl9KS5vbihcImtleWRvd25cIixcImFcIixmdW5jdGlvbihiKXt2YXIgZD1udWxsO3N3aXRjaChiLndoaWNoKXtjYXNlIDEzOmNhc2UgMzI6Yi50eXBlPVwibW91c2V1cFwiLGIucHJldmVudERlZmF1bHQoKSxhKGIuY3VycmVudFRhcmdldCkudHJpZ2dlcihiKTticmVhaztjYXNlIDM3OmMuaXNfdmlzaWJsZSYmKGMuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmxhc3QoKS5jbG9zZXN0KFwibGlcIikuZmlyc3QoKS5maW5kKFwidWxcIikuaGlkZSgpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5lbmQoKS5lbmQoKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSxiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGIucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSAzODpjLmlzX3Zpc2libGUmJihkPWMuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikucHJldkFsbChcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpLGQubGVuZ3RofHwoZD1jLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5sYXN0KCkpLGQuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSxiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGIucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSAzOTpjLmlzX3Zpc2libGUmJihjLmVsZW1lbnQuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5sYXN0KCkuY2hpbGRyZW4oXCJ1bFwiKS5zaG93KCkuY2hpbGRyZW4oXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5maXJzdCgpLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuY2hpbGRyZW4oXCJhXCIpLmZvY3VzKCksYi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSxiLnByZXZlbnREZWZhdWx0KCkpO2JyZWFrO2Nhc2UgNDA6Yy5pc192aXNpYmxlJiYoZD1jLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLm5leHRBbGwoXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikuZmlyc3QoKSxkLmxlbmd0aHx8KGQ9Yy5lbGVtZW50LmZpbmQoXCJ1bDp2aXNpYmxlXCIpLmFkZEJhY2soKS5sYXN0KCkuY2hpbGRyZW4oXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikuZmlyc3QoKSksZC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYi5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDI3OmEudmFrYXRhLmNvbnRleHQuaGlkZSgpLGIucHJldmVudERlZmF1bHQoKX19KS5vbihcImtleWRvd25cIixmdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCk7dmFyIGI9Yy5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHRtZW51LXNob3J0Y3V0LVwiK2Eud2hpY2gpLnBhcmVudCgpO2IucGFyZW50KCkubm90KFwiLnZha2F0YS1jb250ZXh0LWRpc2FibGVkXCIpJiZiLmNsaWNrKCl9KSxhKGkpLm9uKFwibW91c2Vkb3duLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihiKXtjLmlzX3Zpc2libGUmJiFhLmNvbnRhaW5zKGMuZWxlbWVudFswXSxiLnRhcmdldCkmJmEudmFrYXRhLmNvbnRleHQuaGlkZSgpO1xufSkub24oXCJjb250ZXh0X3Nob3cudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsZCl7Yy5lbGVtZW50LmZpbmQoXCJsaTpoYXModWwpXCIpLmNoaWxkcmVuKFwiYVwiKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LXBhcmVudFwiKSxiJiZjLmVsZW1lbnQuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ydGxcIikuY3NzKFwiZGlyZWN0aW9uXCIsXCJydGxcIiksYy5lbGVtZW50LmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCl9KX0pfShhKSxhLmpzdHJlZS5kZWZhdWx0cy5kbmQ9e2NvcHk6ITAsb3Blbl90aW1lb3V0OjUwMCxpc19kcmFnZ2FibGU6ITAsY2hlY2tfd2hpbGVfZHJhZ2dpbmc6ITAsYWx3YXlzX2NvcHk6ITEsaW5zaWRlX3BvczowLGRyYWdfc2VsZWN0aW9uOiEwLHRvdWNoOiEwLGxhcmdlX2Ryb3BfdGFyZ2V0OiExLGxhcmdlX2RyYWdfdGFyZ2V0OiExLHVzZV9odG1sNTohMX07dmFyIG4sbzthLmpzdHJlZS5wbHVnaW5zLmRuZD1mdW5jdGlvbihiLGMpe3RoaXMuaW5pdD1mdW5jdGlvbihhLGIpe2MuaW5pdC5jYWxsKHRoaXMsYSxiKSx0aGlzLnNldHRpbmdzLmRuZC51c2VfaHRtbDU9dGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1JiZcImRyYWdnYWJsZVwiaW4gaS5jcmVhdGVFbGVtZW50KFwic3BhblwiKX0sdGhpcy5iaW5kPWZ1bmN0aW9uKCl7Yy5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKHRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNT9cImRyYWdzdGFydC5qc3RyZWVcIjpcIm1vdXNlZG93bi5qc3RyZWUgdG91Y2hzdGFydC5qc3RyZWVcIix0aGlzLnNldHRpbmdzLmRuZC5sYXJnZV9kcmFnX3RhcmdldD9cIi5qc3RyZWUtbm9kZVwiOlwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2lmKHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0JiZhKGIudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpWzBdIT09Yi5jdXJyZW50VGFyZ2V0KXJldHVybiEwO2lmKFwidG91Y2hzdGFydFwiPT09Yi50eXBlJiYoIXRoaXMuc2V0dGluZ3MuZG5kLnRvdWNofHxcInNlbGVjdGVkXCI9PT10aGlzLnNldHRpbmdzLmRuZC50b3VjaCYmIWEoYi5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuaGFzQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSkpcmV0dXJuITA7dmFyIGM9dGhpcy5nZXRfbm9kZShiLnRhcmdldCksZD10aGlzLmlzX3NlbGVjdGVkKGMpJiZ0aGlzLnNldHRpbmdzLmRuZC5kcmFnX3NlbGVjdGlvbj90aGlzLmdldF90b3Bfc2VsZWN0ZWQoKS5sZW5ndGg6MSxlPWQ+MT9kK1wiIFwiK3RoaXMuZ2V0X3N0cmluZyhcIm5vZGVzXCIpOnRoaXMuZ2V0X3RleHQoYi5jdXJyZW50VGFyZ2V0KTtpZih0aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dCYmKGU9YS52YWthdGEuaHRtbC5lc2NhcGUoZSkpLGMmJmMuaWQmJmMuaWQhPT1hLmpzdHJlZS5yb290JiYoMT09PWIud2hpY2h8fFwidG91Y2hzdGFydFwiPT09Yi50eXBlfHxcImRyYWdzdGFydFwiPT09Yi50eXBlKSYmKHRoaXMuc2V0dGluZ3MuZG5kLmlzX2RyYWdnYWJsZT09PSEwfHxhLmlzRnVuY3Rpb24odGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlKSYmdGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlLmNhbGwodGhpcyxkPjE/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCEwKTpbY10sYikpKXtpZihuPXtqc3RyZWU6ITAsb3JpZ2luOnRoaXMsb2JqOnRoaXMuZ2V0X25vZGUoYywhMCksbm9kZXM6ZD4xP3RoaXMuZ2V0X3RvcF9zZWxlY3RlZCgpOltjLmlkXX0sbz1iLmN1cnJlbnRUYXJnZXQsIXRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNSlyZXR1cm4gdGhpcy5lbGVtZW50LnRyaWdnZXIoXCJtb3VzZWRvd24uanN0cmVlXCIpLGEudmFrYXRhLmRuZC5zdGFydChiLG4sJzxkaXYgaWQ9XCJqc3RyZWUtZG5kXCIgY2xhc3M9XCJqc3RyZWUtJyt0aGlzLmdldF90aGVtZSgpK1wiIGpzdHJlZS1cIit0aGlzLmdldF90aGVtZSgpK1wiLVwiK3RoaXMuZ2V0X3RoZW1lX3ZhcmlhbnQoKStcIiBcIisodGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lcy5yZXNwb25zaXZlP1wiIGpzdHJlZS1kbmQtcmVzcG9uc2l2ZVwiOlwiXCIpKydcIj48aSBjbGFzcz1cImpzdHJlZS1pY29uIGpzdHJlZS1lclwiPjwvaT4nK2UrJzxpbnMgY2xhc3M9XCJqc3RyZWUtY29weVwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPis8L2lucz48L2Rpdj4nKTthLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJzdGFydFwiLGIse2hlbHBlcjphKCksZWxlbWVudDpvLGRhdGE6bn0pfX0sdGhpcykpLHRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNSYmdGhpcy5lbGVtZW50Lm9uKFwiZHJhZ292ZXIuanN0cmVlXCIsZnVuY3Rpb24oYil7cmV0dXJuIGIucHJldmVudERlZmF1bHQoKSxhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsYix7aGVscGVyOmEoKSxlbGVtZW50Om8sZGF0YTpufSksITF9KS5vbihcImRyb3AuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiKXtyZXR1cm4gYi5wcmV2ZW50RGVmYXVsdCgpLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0b3BcIixiLHtoZWxwZXI6YSgpLGVsZW1lbnQ6byxkYXRhOm59KSwhMX0sdGhpcykpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGEsYixkLGUpe2lmKGE9Yy5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYSYmdGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1KWlmKHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0KWEuc2V0QXR0cmlidXRlKFwiZHJhZ2dhYmxlXCIsITApO2Vsc2V7dmFyIGYsZyxoPW51bGw7Zm9yKGY9MCxnPWEuY2hpbGROb2Rlcy5sZW5ndGg7Zz5mO2YrKylpZihhLmNoaWxkTm9kZXNbZl0mJmEuY2hpbGROb2Rlc1tmXS5jbGFzc05hbWUmJi0xIT09YS5jaGlsZE5vZGVzW2ZdLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7aD1hLmNoaWxkTm9kZXNbZl07YnJlYWt9aCYmaC5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwhMCl9cmV0dXJuIGF9fSxhKGZ1bmN0aW9uKCl7dmFyIGM9ITEsZD0hMSxlPSExLGY9ITEsZz1hKCc8ZGl2IGlkPVwianN0cmVlLW1hcmtlclwiPiYjMTYwOzwvZGl2PicpLmhpZGUoKTthKGkpLm9uKFwiZG5kX3N0YXJ0LnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhLGIpe2M9ITEsZT0hMSxiJiZiLmRhdGEmJmIuZGF0YS5qc3RyZWUmJmcuYXBwZW5kVG8oXCJib2R5XCIpfSkub24oXCJkbmRfbW92ZS52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oaCxpKXtpZihmJiYoaS5ldmVudCYmXCJkcmFnb3ZlclwiPT09aS5ldmVudC50eXBlJiZpLmV2ZW50LnRhcmdldD09PWUudGFyZ2V0fHxjbGVhclRpbWVvdXQoZikpLGkmJmkuZGF0YSYmaS5kYXRhLmpzdHJlZSYmKCFpLmV2ZW50LnRhcmdldC5pZHx8XCJqc3RyZWUtbWFya2VyXCIhPT1pLmV2ZW50LnRhcmdldC5pZCkpe2U9aS5ldmVudDt2YXIgaj1hLmpzdHJlZS5yZWZlcmVuY2UoaS5ldmVudC50YXJnZXQpLGs9ITEsbD0hMSxtPSExLG4sbyxwLHEscixzLHQsdSx2LHcseCx5LHosQSxCLEM7aWYoaiYmai5fZGF0YSYmai5fZGF0YS5kbmQpaWYoZy5hdHRyKFwiY2xhc3NcIixcImpzdHJlZS1cIitqLmdldF90aGVtZSgpKyhqLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikpLEM9aS5kYXRhLm9yaWdpbiYmKGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoaS5ldmVudC5tZXRhS2V5fHxpLmV2ZW50LmN0cmxLZXkpKSxpLmhlbHBlci5jaGlsZHJlbigpLmF0dHIoXCJjbGFzc1wiLFwianN0cmVlLVwiK2ouZ2V0X3RoZW1lKCkrXCIganN0cmVlLVwiK2ouZ2V0X3RoZW1lKCkrXCItXCIrai5nZXRfdGhlbWVfdmFyaWFudCgpK1wiIFwiKyhqLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikpLmZpbmQoXCIuanN0cmVlLWNvcHlcIikuZmlyc3QoKVtDP1wic2hvd1wiOlwiaGlkZVwiXSgpLGkuZXZlbnQudGFyZ2V0IT09ai5lbGVtZW50WzBdJiZpLmV2ZW50LnRhcmdldCE9PWouZ2V0X2NvbnRhaW5lcl91bCgpWzBdfHwwIT09ai5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oKS5sZW5ndGgpe2lmKGs9ai5zZXR0aW5ncy5kbmQubGFyZ2VfZHJvcF90YXJnZXQ/YShpLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpOmEoaS5ldmVudC50YXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLWFuY2hvclwiKSxrJiZrLmxlbmd0aCYmay5wYXJlbnQoKS5pcyhcIi5qc3RyZWUtY2xvc2VkLCAuanN0cmVlLW9wZW4sIC5qc3RyZWUtbGVhZlwiKSYmKGw9ay5vZmZzZXQoKSxtPShpLmV2ZW50LnBhZ2VZIT09Yj9pLmV2ZW50LnBhZ2VZOmkuZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSktbC50b3AscT1rLm91dGVySGVpZ2h0KCksdD1xLzM+bT9bXCJiXCIsXCJpXCIsXCJhXCJdOm0+cS1xLzM/W1wiYVwiLFwiaVwiLFwiYlwiXTptPnEvMj9bXCJpXCIsXCJhXCIsXCJiXCJdOltcImlcIixcImJcIixcImFcIl0sYS5lYWNoKHQsZnVuY3Rpb24oYixlKXtzd2l0Y2goZSl7Y2FzZVwiYlwiOm89bC5sZWZ0LTYscD1sLnRvcCxyPWouZ2V0X3BhcmVudChrKSxzPWsucGFyZW50KCkuaW5kZXgoKTticmVhaztjYXNlXCJpXCI6QT1qLnNldHRpbmdzLmRuZC5pbnNpZGVfcG9zLEI9ai5nZXRfbm9kZShrLnBhcmVudCgpKSxvPWwubGVmdC0yLHA9bC50b3ArcS8yKzEscj1CLmlkLHM9XCJmaXJzdFwiPT09QT8wOlwibGFzdFwiPT09QT9CLmNoaWxkcmVuLmxlbmd0aDpNYXRoLm1pbihBLEIuY2hpbGRyZW4ubGVuZ3RoKTticmVhaztjYXNlXCJhXCI6bz1sLmxlZnQtNixwPWwudG9wK3Escj1qLmdldF9wYXJlbnQoaykscz1rLnBhcmVudCgpLmluZGV4KCkrMX1mb3IodT0hMCx2PTAsdz1pLmRhdGEubm9kZXMubGVuZ3RoO3c+djt2KyspaWYoeD1pLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihpLmV2ZW50Lm1ldGFLZXl8fGkuZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIix5PXMsXCJtb3ZlX25vZGVcIj09PXgmJlwiYVwiPT09ZSYmaS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbj09PWomJnI9PT1qLmdldF9wYXJlbnQoaS5kYXRhLm5vZGVzW3ZdKSYmKHo9ai5nZXRfbm9kZShyKSx5PmEuaW5BcnJheShpLmRhdGEubm9kZXNbdl0sei5jaGlsZHJlbikmJih5LT0xKSksdT11JiYoaiYmai5zZXR0aW5ncyYmai5zZXR0aW5ncy5kbmQmJmouc2V0dGluZ3MuZG5kLmNoZWNrX3doaWxlX2RyYWdnaW5nPT09ITF8fGouY2hlY2soeCxpLmRhdGEub3JpZ2luJiZpLmRhdGEub3JpZ2luIT09aj9pLmRhdGEub3JpZ2luLmdldF9ub2RlKGkuZGF0YS5ub2Rlc1t2XSk6aS5kYXRhLm5vZGVzW3ZdLHIseSx7ZG5kOiEwLHJlZjpqLmdldF9ub2RlKGsucGFyZW50KCkpLHBvczplLG9yaWdpbjppLmRhdGEub3JpZ2luLGlzX211bHRpOmkuZGF0YS5vcmlnaW4mJmkuZGF0YS5vcmlnaW4hPT1qLGlzX2ZvcmVpZ246IWkuZGF0YS5vcmlnaW59KSksIXUpe2omJmoubGFzdF9lcnJvciYmKGQ9ai5sYXN0X2Vycm9yKCkpO2JyZWFrfXJldHVyblwiaVwiPT09ZSYmay5wYXJlbnQoKS5pcyhcIi5qc3RyZWUtY2xvc2VkXCIpJiZqLnNldHRpbmdzLmRuZC5vcGVuX3RpbWVvdXQmJihmPXNldFRpbWVvdXQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oKXthLm9wZW5fbm9kZShiKX19KGosayksai5zZXR0aW5ncy5kbmQub3Blbl90aW1lb3V0KSksdT8oYz17aW5zOmoscGFyOnIscG9zOlwiaVwiIT09ZXx8XCJsYXN0XCIhPT1BfHwwIT09c3x8ai5pc19sb2FkZWQoQik/czpcImxhc3RcIn0sZy5jc3Moe2xlZnQ6bytcInB4XCIsdG9wOnArXCJweFwifSkuc2hvdygpLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1lclwiKS5hZGRDbGFzcyhcImpzdHJlZS1va1wiKSxpLmV2ZW50Lm9yaWdpbmFsRXZlbnQmJmkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXImJihpLmV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3Q9Qz9cImNvcHlcIjpcIm1vdmVcIiksZD17fSx0PSEwLCExKTp2b2lkIDB9KSx0PT09ITApKXJldHVybn1lbHNle2Zvcih1PSEwLHY9MCx3PWkuZGF0YS5ub2Rlcy5sZW5ndGg7dz52O3YrKylpZih1PXUmJmouY2hlY2soaS5kYXRhLm9yaWdpbiYmKGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoaS5ldmVudC5tZXRhS2V5fHxpLmV2ZW50LmN0cmxLZXkpKT9cImNvcHlfbm9kZVwiOlwibW92ZV9ub2RlXCIsaS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbiE9PWo/aS5kYXRhLm9yaWdpbi5nZXRfbm9kZShpLmRhdGEubm9kZXNbdl0pOmkuZGF0YS5ub2Rlc1t2XSxhLmpzdHJlZS5yb290LFwibGFzdFwiLHtkbmQ6ITAscmVmOmouZ2V0X25vZGUoYS5qc3RyZWUucm9vdCkscG9zOlwiaVwiLG9yaWdpbjppLmRhdGEub3JpZ2luLGlzX211bHRpOmkuZGF0YS5vcmlnaW4mJmkuZGF0YS5vcmlnaW4hPT1qLGlzX2ZvcmVpZ246IWkuZGF0YS5vcmlnaW59KSwhdSlicmVhaztpZih1KXJldHVybiBjPXtpbnM6aixwYXI6YS5qc3RyZWUucm9vdCxwb3M6XCJsYXN0XCJ9LGcuaGlkZSgpLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1lclwiKS5hZGRDbGFzcyhcImpzdHJlZS1va1wiKSx2b2lkKGkuZXZlbnQub3JpZ2luYWxFdmVudCYmaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciYmKGkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdD1DP1wiY29weVwiOlwibW92ZVwiKSl9Yz0hMSxpLmhlbHBlci5maW5kKFwiLmpzdHJlZS1pY29uXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLW9rXCIpLmFkZENsYXNzKFwianN0cmVlLWVyXCIpLGkuZXZlbnQub3JpZ2luYWxFdmVudCYmaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciYmKGkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdD1cIm5vbmVcIiksZy5oaWRlKCl9fSkub24oXCJkbmRfc2Nyb2xsLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhLGIpe2ImJmIuZGF0YSYmYi5kYXRhLmpzdHJlZSYmKGcuaGlkZSgpLGM9ITEsZT0hMSxiLmhlbHBlci5maW5kKFwiLmpzdHJlZS1pY29uXCIpLmZpcnN0KCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb2tcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZXJcIikpfSkub24oXCJkbmRfc3RvcC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYixoKXtpZihmJiZjbGVhclRpbWVvdXQoZiksaCYmaC5kYXRhJiZoLmRhdGEuanN0cmVlKXtnLmhpZGUoKS5kZXRhY2goKTt2YXIgaSxqLGs9W107aWYoYyl7Zm9yKGk9MCxqPWguZGF0YS5ub2Rlcy5sZW5ndGg7aj5pO2krKylrW2ldPWguZGF0YS5vcmlnaW4/aC5kYXRhLm9yaWdpbi5nZXRfbm9kZShoLmRhdGEubm9kZXNbaV0pOmguZGF0YS5ub2Rlc1tpXTtjLmluc1toLmRhdGEub3JpZ2luJiYoaC5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGguZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihoLmV2ZW50Lm1ldGFLZXl8fGguZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIl0oayxjLnBhcixjLnBvcywhMSwhMSwhMSxoLmRhdGEub3JpZ2luKX1lbHNlIGk9YShoLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWVcIiksaS5sZW5ndGgmJmQmJmQuZXJyb3ImJlwiY2hlY2tcIj09PWQuZXJyb3ImJihpPWkuanN0cmVlKCEwKSxpJiZpLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLGQpKTtlPSExLGM9ITF9fSkub24oXCJrZXl1cC5qc3RyZWUga2V5ZG93bi5qc3RyZWVcIixmdW5jdGlvbihiLGgpe2g9YS52YWthdGEuZG5kLl9nZXQoKSxoJiZoLmRhdGEmJmguZGF0YS5qc3RyZWUmJihcImtleXVwXCI9PT1iLnR5cGUmJjI3PT09Yi53aGljaD8oZiYmY2xlYXJUaW1lb3V0KGYpLGM9ITEsZD0hMSxlPSExLGY9ITEsZy5oaWRlKCkuZGV0YWNoKCksYS52YWthdGEuZG5kLl9jbGVhbigpKTooaC5oZWxwZXIuZmluZChcIi5qc3RyZWUtY29weVwiKS5maXJzdCgpW2guZGF0YS5vcmlnaW4mJihoLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8aC5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKGIubWV0YUtleXx8Yi5jdHJsS2V5KSk/XCJzaG93XCI6XCJoaWRlXCJdKCksZSYmKGUubWV0YUtleT1iLm1ldGFLZXksZS5jdHJsS2V5PWIuY3RybEtleSxhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsZSkpKSl9KX0pLGZ1bmN0aW9uKGEpe2EudmFrYXRhLmh0bWw9e2RpdjphKFwiPGRpdiAvPlwiKSxlc2NhcGU6ZnVuY3Rpb24oYil7cmV0dXJuIGEudmFrYXRhLmh0bWwuZGl2LnRleHQoYikuaHRtbCgpfSxzdHJpcDpmdW5jdGlvbihiKXtyZXR1cm4gYS52YWthdGEuaHRtbC5kaXYuZW1wdHkoKS5hcHBlbmQoYS5wYXJzZUhUTUwoYikpLnRleHQoKX19O3ZhciBjPXtlbGVtZW50OiExLHRhcmdldDohMSxpc19kb3duOiExLGlzX2RyYWc6ITEsaGVscGVyOiExLGhlbHBlcl93OjAsZGF0YTohMSxpbml0X3g6MCxpbml0X3k6MCxzY3JvbGxfbDowLHNjcm9sbF90OjAsc2Nyb2xsX2U6ITEsc2Nyb2xsX2k6ITEsaXNfdG91Y2g6ITF9O2EudmFrYXRhLmRuZD17c2V0dGluZ3M6e3Njcm9sbF9zcGVlZDoxMCxzY3JvbGxfcHJveGltaXR5OjIwLGhlbHBlcl9sZWZ0OjUsaGVscGVyX3RvcDoxMCx0aHJlc2hvbGQ6NSx0aHJlc2hvbGRfdG91Y2g6NTB9LF90cmlnZ2VyOmZ1bmN0aW9uKGMsZCxlKXtlPT09YiYmKGU9YS52YWthdGEuZG5kLl9nZXQoKSksZS5ldmVudD1kLGEoaSkudHJpZ2dlckhhbmRsZXIoXCJkbmRfXCIrYytcIi52YWthdGFcIixlKX0sX2dldDpmdW5jdGlvbigpe3JldHVybntkYXRhOmMuZGF0YSxlbGVtZW50OmMuZWxlbWVudCxoZWxwZXI6Yy5oZWxwZXJ9fSxfY2xlYW46ZnVuY3Rpb24oKXtjLmhlbHBlciYmYy5oZWxwZXIucmVtb3ZlKCksYy5zY3JvbGxfaSYmKGNsZWFySW50ZXJ2YWwoYy5zY3JvbGxfaSksYy5zY3JvbGxfaT0hMSksYz17ZWxlbWVudDohMSx0YXJnZXQ6ITEsaXNfZG93bjohMSxpc19kcmFnOiExLGhlbHBlcjohMSxoZWxwZXJfdzowLGRhdGE6ITEsaW5pdF94OjAsaW5pdF95OjAsc2Nyb2xsX2w6MCxzY3JvbGxfdDowLHNjcm9sbF9lOiExLHNjcm9sbF9pOiExLGlzX3RvdWNoOiExfSxhKGkpLm9mZihcIm1vdXNlbW92ZS52YWthdGEuanN0cmVlIHRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsYS52YWthdGEuZG5kLmRyYWcpLGEoaSkub2ZmKFwibW91c2V1cC52YWthdGEuanN0cmVlIHRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuc3RvcCl9LF9zY3JvbGw6ZnVuY3Rpb24oYil7aWYoIWMuc2Nyb2xsX2V8fCFjLnNjcm9sbF9sJiYhYy5zY3JvbGxfdClyZXR1cm4gYy5zY3JvbGxfaSYmKGNsZWFySW50ZXJ2YWwoYy5zY3JvbGxfaSksYy5zY3JvbGxfaT0hMSksITE7aWYoIWMuc2Nyb2xsX2kpcmV0dXJuIGMuc2Nyb2xsX2k9c2V0SW50ZXJ2YWwoYS52YWthdGEuZG5kLl9zY3JvbGwsMTAwKSwhMTtpZihiPT09ITApcmV0dXJuITE7dmFyIGQ9Yy5zY3JvbGxfZS5zY3JvbGxUb3AoKSxlPWMuc2Nyb2xsX2Uuc2Nyb2xsTGVmdCgpO2Muc2Nyb2xsX2Uuc2Nyb2xsVG9wKGQrYy5zY3JvbGxfdCphLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3NwZWVkKSxjLnNjcm9sbF9lLnNjcm9sbExlZnQoZStjLnNjcm9sbF9sKmEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfc3BlZWQpLGQ9PT1jLnNjcm9sbF9lLnNjcm9sbFRvcCgpJiZlPT09Yy5zY3JvbGxfZS5zY3JvbGxMZWZ0KCl8fGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcInNjcm9sbFwiLGMuc2Nyb2xsX2UpfSxzdGFydDpmdW5jdGlvbihiLGQsZSl7XCJ0b3VjaHN0YXJ0XCI9PT1iLnR5cGUmJmIub3JpZ2luYWxFdmVudCYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihiLnBhZ2VYPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxiLnBhZ2VZPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxiLnRhcmdldD1pLmVsZW1lbnRGcm9tUG9pbnQoYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLXdpbmRvdy5wYWdlWE9mZnNldCxiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVktd2luZG93LnBhZ2VZT2Zmc2V0KSksYy5pc19kcmFnJiZhLnZha2F0YS5kbmQuc3RvcCh7fSk7dHJ5e2IuY3VycmVudFRhcmdldC51bnNlbGVjdGFibGU9XCJvblwiLGIuY3VycmVudFRhcmdldC5vbnNlbGVjdHN0YXJ0PWZ1bmN0aW9uKCl7cmV0dXJuITF9LGIuY3VycmVudFRhcmdldC5zdHlsZSYmKGIuY3VycmVudFRhcmdldC5zdHlsZS50b3VjaEFjdGlvbj1cIm5vbmVcIixiLmN1cnJlbnRUYXJnZXQuc3R5bGUubXNUb3VjaEFjdGlvbj1cIm5vbmVcIixiLmN1cnJlbnRUYXJnZXQuc3R5bGUuTW96VXNlclNlbGVjdD1cIm5vbmVcIil9Y2F0Y2goZil7fXJldHVybiBjLmluaXRfeD1iLnBhZ2VYLGMuaW5pdF95PWIucGFnZVksYy5kYXRhPWQsYy5pc19kb3duPSEwLGMuZWxlbWVudD1iLmN1cnJlbnRUYXJnZXQsYy50YXJnZXQ9Yi50YXJnZXQsYy5pc190b3VjaD1cInRvdWNoc3RhcnRcIj09PWIudHlwZSxlIT09ITEmJihjLmhlbHBlcj1hKFwiPGRpdiBpZD0ndmFrYXRhLWRuZCc+PC9kaXY+XCIpLmh0bWwoZSkuY3NzKHtkaXNwbGF5OlwiYmxvY2tcIixtYXJnaW46XCIwXCIscGFkZGluZzpcIjBcIixwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiLTIwMDBweFwiLGxpbmVIZWlnaHQ6XCIxNnB4XCIsekluZGV4OlwiMTAwMDBcIn0pKSxhKGkpLm9uKFwibW91c2Vtb3ZlLnZha2F0YS5qc3RyZWUgdG91Y2htb3ZlLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuZHJhZyksYShpKS5vbihcIm1vdXNldXAudmFrYXRhLmpzdHJlZSB0b3VjaGVuZC52YWthdGEuanN0cmVlXCIsYS52YWthdGEuZG5kLnN0b3ApLCExfSxkcmFnOmZ1bmN0aW9uKGIpe2lmKFwidG91Y2htb3ZlXCI9PT1iLnR5cGUmJmIub3JpZ2luYWxFdmVudCYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihiLnBhZ2VYPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxiLnBhZ2VZPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxiLnRhcmdldD1pLmVsZW1lbnRGcm9tUG9pbnQoYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLXdpbmRvdy5wYWdlWE9mZnNldCxiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVktd2luZG93LnBhZ2VZT2Zmc2V0KSksYy5pc19kb3duKXtpZighYy5pc19kcmFnKXtpZighKE1hdGguYWJzKGIucGFnZVgtYy5pbml0X3gpPihjLmlzX3RvdWNoP2EudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGRfdG91Y2g6YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZCl8fE1hdGguYWJzKGIucGFnZVktYy5pbml0X3kpPihjLmlzX3RvdWNoP2EudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGRfdG91Y2g6YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZCkpKXJldHVybjtjLmhlbHBlciYmKGMuaGVscGVyLmFwcGVuZFRvKFwiYm9keVwiKSxjLmhlbHBlcl93PWMuaGVscGVyLm91dGVyV2lkdGgoKSksYy5pc19kcmFnPSEwLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0YXJ0XCIsYil9dmFyIGQ9ITEsZT0hMSxmPSExLGc9ITEsaD0hMSxqPSExLGs9ITEsbD0hMSxtPSExLG49ITE7cmV0dXJuIGMuc2Nyb2xsX3Q9MCxjLnNjcm9sbF9sPTAsYy5zY3JvbGxfZT0hMSxhKGEoYi50YXJnZXQpLnBhcmVudHNVbnRpbChcImJvZHlcIikuYWRkQmFjaygpLmdldCgpLnJldmVyc2UoKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuL15hdXRvfHNjcm9sbCQvLnRlc3QoYSh0aGlzKS5jc3MoXCJvdmVyZmxvd1wiKSkmJih0aGlzLnNjcm9sbEhlaWdodD50aGlzLm9mZnNldEhlaWdodHx8dGhpcy5zY3JvbGxXaWR0aD50aGlzLm9mZnNldFdpZHRoKX0pLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5vZmZzZXQoKTtyZXR1cm4gdGhpcy5zY3JvbGxIZWlnaHQ+dGhpcy5vZmZzZXRIZWlnaHQmJihlLnRvcCtkLmhlaWdodCgpLWIucGFnZVk8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF90PTEpLGIucGFnZVktZS50b3A8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF90PS0xKSksdGhpcy5zY3JvbGxXaWR0aD50aGlzLm9mZnNldFdpZHRoJiYoZS5sZWZ0K2Qud2lkdGgoKS1iLnBhZ2VYPGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfbD0xKSxiLnBhZ2VYLWUubGVmdDxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX2w9LTEpKSxjLnNjcm9sbF90fHxjLnNjcm9sbF9sPyhjLnNjcm9sbF9lPWEodGhpcyksITEpOnZvaWQgMH0pLGMuc2Nyb2xsX2V8fChkPWEoaSksZT1hKHdpbmRvdyksZj1kLmhlaWdodCgpLGc9ZS5oZWlnaHQoKSxoPWQud2lkdGgoKSxqPWUud2lkdGgoKSxrPWQuc2Nyb2xsVG9wKCksbD1kLnNjcm9sbExlZnQoKSxmPmcmJmIucGFnZVktazxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9LTEpLGY+ZyYmZy0oYi5wYWdlWS1rKTxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9MSksaD5qJiZiLnBhZ2VYLWw8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF9sPS0xKSxoPmomJmotKGIucGFnZVgtbCk8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF9sPTEpLChjLnNjcm9sbF90fHxjLnNjcm9sbF9sKSYmKGMuc2Nyb2xsX2U9ZCkpLGMuc2Nyb2xsX2UmJmEudmFrYXRhLmRuZC5fc2Nyb2xsKCEwKSxjLmhlbHBlciYmKG09cGFyc2VJbnQoYi5wYWdlWSthLnZha2F0YS5kbmQuc2V0dGluZ3MuaGVscGVyX3RvcCwxMCksbj1wYXJzZUludChiLnBhZ2VYK2EudmFrYXRhLmRuZC5zZXR0aW5ncy5oZWxwZXJfbGVmdCwxMCksZiYmbSsyNT5mJiYobT1mLTUwKSxoJiZuK2MuaGVscGVyX3c+aCYmKG49aC0oYy5oZWxwZXJfdysyKSksYy5oZWxwZXIuY3NzKHtsZWZ0Om4rXCJweFwiLHRvcDptK1wicHhcIn0pKSxhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsYiksITF9fSxzdG9wOmZ1bmN0aW9uKGIpe2lmKFwidG91Y2hlbmRcIj09PWIudHlwZSYmYi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGIucGFnZVg9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGIucGFnZVk9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGIudGFyZ2V0PWkuZWxlbWVudEZyb21Qb2ludChiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSxjLmlzX2RyYWcpYS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RvcFwiLGIpO2Vsc2UgaWYoXCJ0b3VjaGVuZFwiPT09Yi50eXBlJiZiLnRhcmdldD09PWMudGFyZ2V0KXt2YXIgZD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YShiLnRhcmdldCkuY2xpY2soKX0sMTAwKTthKGIudGFyZ2V0KS5vbmUoXCJjbGlja1wiLGZ1bmN0aW9uKCl7ZCYmY2xlYXJUaW1lb3V0KGQpfSl9cmV0dXJuIGEudmFrYXRhLmRuZC5fY2xlYW4oKSwhMX19fShhKSxhLmpzdHJlZS5kZWZhdWx0cy5tYXNzbG9hZD1udWxsLGEuanN0cmVlLnBsdWdpbnMubWFzc2xvYWQ9ZnVuY3Rpb24oYixjKXt0aGlzLmluaXQ9ZnVuY3Rpb24oYSxiKXt0aGlzLl9kYXRhLm1hc3Nsb2FkPXt9LGMuaW5pdC5jYWxsKHRoaXMsYSxiKX0sdGhpcy5fbG9hZF9ub2Rlcz1mdW5jdGlvbihiLGQsZSxmKXt2YXIgZz10aGlzLnNldHRpbmdzLm1hc3Nsb2FkLGg9SlNPTi5zdHJpbmdpZnkoYiksaT1bXSxqPXRoaXMuX21vZGVsLmRhdGEsayxsLG07aWYoIWUpe2ZvcihrPTAsbD1iLmxlbmd0aDtsPms7aysrKWpbYltrXV0mJihqW2Jba11dLnN0YXRlLmxvYWRlZHx8altiW2tdXS5zdGF0ZS5mYWlsZWQpJiYhZnx8KGkucHVzaChiW2tdKSxtPXRoaXMuZ2V0X25vZGUoYltrXSwhMCksbSYmbS5sZW5ndGgmJm0uYWRkQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITApKTtpZih0aGlzLl9kYXRhLm1hc3Nsb2FkPXt9LGkubGVuZ3RoKXtpZihhLmlzRnVuY3Rpb24oZykpcmV0dXJuIGcuY2FsbCh0aGlzLGksYS5wcm94eShmdW5jdGlvbihhKXt2YXIgZyxoO2lmKGEpZm9yKGcgaW4gYSlhLmhhc093blByb3BlcnR5KGcpJiYodGhpcy5fZGF0YS5tYXNzbG9hZFtnXT1hW2ddKTtmb3IoZz0wLGg9Yi5sZW5ndGg7aD5nO2crKyltPXRoaXMuZ2V0X25vZGUoYltnXSwhMCksbSYmbS5sZW5ndGgmJm0ucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITEpO2MuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLGIsZCxlLGYpfSx0aGlzKSk7aWYoXCJvYmplY3RcIj09dHlwZW9mIGcmJmcmJmcudXJsKXJldHVybiBnPWEuZXh0ZW5kKCEwLHt9LGcpLGEuaXNGdW5jdGlvbihnLnVybCkmJihnLnVybD1nLnVybC5jYWxsKHRoaXMsaSkpLGEuaXNGdW5jdGlvbihnLmRhdGEpJiYoZy5kYXRhPWcuZGF0YS5jYWxsKHRoaXMsaSkpLGEuYWpheChnKS5kb25lKGEucHJveHkoZnVuY3Rpb24oYSxnLGgpe3ZhciBpLGo7aWYoYSlmb3IoaSBpbiBhKWEuaGFzT3duUHJvcGVydHkoaSkmJih0aGlzLl9kYXRhLm1hc3Nsb2FkW2ldPWFbaV0pO2ZvcihpPTAsaj1iLmxlbmd0aDtqPmk7aSsrKW09dGhpcy5nZXRfbm9kZShiW2ldLCEwKSxtJiZtLmxlbmd0aCYmbS5yZW1vdmVDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMSk7Yy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMpKS5mYWlsKGEucHJveHkoZnVuY3Rpb24oYSl7Yy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMpKX19cmV0dXJuIGMuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLGIsZCxlLGYpfSx0aGlzLl9sb2FkX25vZGU9ZnVuY3Rpb24oYixkKXt2YXIgZT10aGlzLl9kYXRhLm1hc3Nsb2FkW2IuaWRdLGY9bnVsbCxnO3JldHVybiBlPyhmPXRoaXNbXCJzdHJpbmdcIj09dHlwZW9mIGU/XCJfYXBwZW5kX2h0bWxfZGF0YVwiOlwiX2FwcGVuZF9qc29uX2RhdGFcIl0oYixcInN0cmluZ1wiPT10eXBlb2YgZT9hKGEucGFyc2VIVE1MKGUpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KTplLGZ1bmN0aW9uKGEpe2QuY2FsbCh0aGlzLGEpfSksZz10aGlzLmdldF9ub2RlKGIuaWQsITApLGcmJmcubGVuZ3RoJiZnLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKSxkZWxldGUgdGhpcy5fZGF0YS5tYXNzbG9hZFtiLmlkXSxmKTpjLl9sb2FkX25vZGUuY2FsbCh0aGlzLGIsZCl9fSxhLmpzdHJlZS5kZWZhdWx0cy5zZWFyY2g9e2FqYXg6ITEsZnV6enk6ITEsY2FzZV9zZW5zaXRpdmU6ITEsc2hvd19vbmx5X21hdGNoZXM6ITEsc2hvd19vbmx5X21hdGNoZXNfY2hpbGRyZW46ITEsY2xvc2Vfb3BlbmVkX29uY2xlYXI6ITAsc2VhcmNoX2xlYXZlc19vbmx5OiExLHNlYXJjaF9jYWxsYmFjazohMX0sYS5qc3RyZWUucGx1Z2lucy5zZWFyY2g9ZnVuY3Rpb24oYyxkKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtkLmJpbmQuY2FsbCh0aGlzKSx0aGlzLl9kYXRhLnNlYXJjaC5zdHI9XCJcIix0aGlzLl9kYXRhLnNlYXJjaC5kb209YSgpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guc29tPSExLHRoaXMuX2RhdGEuc2VhcmNoLnNtYz0hMSx0aGlzLl9kYXRhLnNlYXJjaC5oZG49W10sdGhpcy5lbGVtZW50Lm9uKFwic2VhcmNoLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXtpZih0aGlzLl9kYXRhLnNlYXJjaC5zb20mJmMucmVzLmxlbmd0aCl7dmFyIGQ9dGhpcy5fbW9kZWwuZGF0YSxlLGYsZz1bXSxoLGk7Zm9yKGU9MCxmPWMucmVzLmxlbmd0aDtmPmU7ZSsrKWlmKGRbYy5yZXNbZV1dJiYhZFtjLnJlc1tlXV0uc3RhdGUuaGlkZGVuJiYoZy5wdXNoKGMucmVzW2VdKSxnPWcuY29uY2F0KGRbYy5yZXNbZV1dLnBhcmVudHMpLHRoaXMuX2RhdGEuc2VhcmNoLnNtYykpZm9yKGg9MCxpPWRbYy5yZXNbZV1dLmNoaWxkcmVuX2QubGVuZ3RoO2k+aDtoKyspZFtkW2MucmVzW2VdXS5jaGlsZHJlbl9kW2hdXSYmIWRbZFtjLnJlc1tlXV0uY2hpbGRyZW5fZFtoXV0uc3RhdGUuaGlkZGVuJiZnLnB1c2goZFtjLnJlc1tlXV0uY2hpbGRyZW5fZFtoXSk7Zz1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbShhLnZha2F0YS5hcnJheV91bmlxdWUoZyksYS5qc3RyZWUucm9vdCksdGhpcy5fZGF0YS5zZWFyY2guaGRuPXRoaXMuaGlkZV9hbGwoITApLHRoaXMuc2hvd19ub2RlKGcsITApLHRoaXMucmVkcmF3KCEwKX19LHRoaXMpKS5vbihcImNsZWFyX3NlYXJjaC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5fZGF0YS5zZWFyY2guc29tJiZiLnJlcy5sZW5ndGgmJih0aGlzLnNob3dfbm9kZSh0aGlzLl9kYXRhLnNlYXJjaC5oZG4sITApLHRoaXMucmVkcmF3KCEwKSl9LHRoaXMpKX0sdGhpcy5zZWFyY2g9ZnVuY3Rpb24oYyxkLGUsZixnLGgpe2lmKGM9PT0hMXx8XCJcIj09PWEudHJpbShjLnRvU3RyaW5nKCkpKXJldHVybiB0aGlzLmNsZWFyX3NlYXJjaCgpO2Y9dGhpcy5nZXRfbm9kZShmKSxmPWYmJmYuaWQ/Zi5pZDpudWxsLGM9Yy50b1N0cmluZygpO3ZhciBpPXRoaXMuc2V0dGluZ3Muc2VhcmNoLGo9aS5hamF4P2kuYWpheDohMSxrPXRoaXMuX21vZGVsLmRhdGEsbD1udWxsLG09W10sbj1bXSxvLHA7aWYodGhpcy5fZGF0YS5zZWFyY2gucmVzLmxlbmd0aCYmIWcmJnRoaXMuY2xlYXJfc2VhcmNoKCksZT09PWImJihlPWkuc2hvd19vbmx5X21hdGNoZXMpLGg9PT1iJiYoaD1pLnNob3dfb25seV9tYXRjaGVzX2NoaWxkcmVuKSwhZCYmaiE9PSExKXJldHVybiBhLmlzRnVuY3Rpb24oaik/ai5jYWxsKHRoaXMsYyxhLnByb3h5KGZ1bmN0aW9uKGIpe2ImJmIuZCYmKGI9Yi5kKSx0aGlzLl9sb2FkX25vZGVzKGEuaXNBcnJheShiKT9hLnZha2F0YS5hcnJheV91bmlxdWUoYik6W10sZnVuY3Rpb24oKXt0aGlzLnNlYXJjaChjLCEwLGUsZixnKX0pfSx0aGlzKSxmKTooaj1hLmV4dGVuZCh7fSxqKSxqLmRhdGF8fChqLmRhdGE9e30pLGouZGF0YS5zdHI9YyxmJiYoai5kYXRhLmluc2lkZT1mKSxhLmFqYXgoaikuZmFpbChhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiYWpheFwiLHBsdWdpbjpcInNlYXJjaFwiLGlkOlwic2VhcmNoXzAxXCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgc2VhcmNoIHBhcmVudHNcIixkYXRhOkpTT04uc3RyaW5naWZ5KGopfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKX0sdGhpcykpLmRvbmUoYS5wcm94eShmdW5jdGlvbihiKXtiJiZiLmQmJihiPWIuZCksdGhpcy5fbG9hZF9ub2RlcyhhLmlzQXJyYXkoYik/YS52YWthdGEuYXJyYXlfdW5pcXVlKGIpOltdLGZ1bmN0aW9uKCl7dGhpcy5zZWFyY2goYywhMCxlLGYsZyl9KX0sdGhpcykpKTtpZihnfHwodGhpcy5fZGF0YS5zZWFyY2guc3RyPWMsdGhpcy5fZGF0YS5zZWFyY2guZG9tPWEoKSx0aGlzLl9kYXRhLnNlYXJjaC5yZXM9W10sdGhpcy5fZGF0YS5zZWFyY2gub3BuPVtdLHRoaXMuX2RhdGEuc2VhcmNoLnNvbT1lLHRoaXMuX2RhdGEuc2VhcmNoLnNtYz1oKSxsPW5ldyBhLnZha2F0YS5zZWFyY2goYywhMCx7Y2FzZVNlbnNpdGl2ZTppLmNhc2Vfc2Vuc2l0aXZlLGZ1enp5OmkuZnV6enl9KSxhLmVhY2goa1tmP2Y6YS5qc3RyZWUucm9vdF0uY2hpbGRyZW5fZCxmdW5jdGlvbihhLGIpe3ZhciBkPWtbYl07ZC50ZXh0JiYhZC5zdGF0ZS5oaWRkZW4mJighaS5zZWFyY2hfbGVhdmVzX29ubHl8fGQuc3RhdGUubG9hZGVkJiYwPT09ZC5jaGlsZHJlbi5sZW5ndGgpJiYoaS5zZWFyY2hfY2FsbGJhY2smJmkuc2VhcmNoX2NhbGxiYWNrLmNhbGwodGhpcyxjLGQpfHwhaS5zZWFyY2hfY2FsbGJhY2smJmwuc2VhcmNoKGQudGV4dCkuaXNNYXRjaCkmJihtLnB1c2goYiksbj1uLmNvbmNhdChkLnBhcmVudHMpKX0pLG0ubGVuZ3RoKXtmb3Iobj1hLnZha2F0YS5hcnJheV91bmlxdWUobiksbz0wLHA9bi5sZW5ndGg7cD5vO28rKyluW29dIT09YS5qc3RyZWUucm9vdCYma1tuW29dXSYmdGhpcy5vcGVuX25vZGUobltvXSxudWxsLDApPT09ITAmJnRoaXMuX2RhdGEuc2VhcmNoLm9wbi5wdXNoKG5bb10pO2c/KHRoaXMuX2RhdGEuc2VhcmNoLmRvbT10aGlzLl9kYXRhLnNlYXJjaC5kb20uYWRkKGEodGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjXCIrYS5tYXAobSxmdW5jdGlvbihiKXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoYlswXSk/XCJcXFxcM1wiK2JbMF0rXCIgXCIrYi5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmIucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpKSx0aGlzLl9kYXRhLnNlYXJjaC5yZXM9YS52YWthdGEuYXJyYXlfdW5pcXVlKHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5jb25jYXQobSkpKToodGhpcy5fZGF0YS5zZWFyY2guZG9tPWEodGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjXCIrYS5tYXAobSxmdW5jdGlvbihiKXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoYlswXSk/XCJcXFxcM1wiK2JbMF0rXCIgXCIrYi5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmIucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1tKSx0aGlzLl9kYXRhLnNlYXJjaC5kb20uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1zZWFyY2hcIil9dGhpcy50cmlnZ2VyKFwic2VhcmNoXCIse25vZGVzOnRoaXMuX2RhdGEuc2VhcmNoLmRvbSxzdHI6YyxyZXM6dGhpcy5fZGF0YS5zZWFyY2gucmVzLHNob3dfb25seV9tYXRjaGVzOmV9KX0sdGhpcy5jbGVhcl9zZWFyY2g9ZnVuY3Rpb24oKXt0aGlzLnNldHRpbmdzLnNlYXJjaC5jbG9zZV9vcGVuZWRfb25jbGVhciYmdGhpcy5jbG9zZV9ub2RlKHRoaXMuX2RhdGEuc2VhcmNoLm9wbiwwKSx0aGlzLnRyaWdnZXIoXCJjbGVhcl9zZWFyY2hcIix7bm9kZXM6dGhpcy5fZGF0YS5zZWFyY2guZG9tLHN0cjp0aGlzLl9kYXRhLnNlYXJjaC5zdHIscmVzOnRoaXMuX2RhdGEuc2VhcmNoLnJlc30pLHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5sZW5ndGgmJih0aGlzLl9kYXRhLnNlYXJjaC5kb209YSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIithLm1hcCh0aGlzLl9kYXRhLnNlYXJjaC5yZXMsZnVuY3Rpb24oYil7cmV0dXJuLTEhPT1cIjAxMjM0NTY3ODlcIi5pbmRleE9mKGJbMF0pP1wiXFxcXDNcIitiWzBdK1wiIFwiK2Iuc3Vic3RyKDEpLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKTpiLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKX0pLmpvaW4oXCIsICNcIikpKSx0aGlzLl9kYXRhLnNlYXJjaC5kb20uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1zZWFyY2hcIikpLHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1cIlwiLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guZG9tPWEoKX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbihiLGMsZSxmKXtpZihiPWQucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpLGImJi0xIT09YS5pbkFycmF5KGIuaWQsdGhpcy5fZGF0YS5zZWFyY2gucmVzKSl7dmFyIGcsaCxpPW51bGw7Zm9yKGc9MCxoPWIuY2hpbGROb2Rlcy5sZW5ndGg7aD5nO2crKylpZihiLmNoaWxkTm9kZXNbZ10mJmIuY2hpbGROb2Rlc1tnXS5jbGFzc05hbWUmJi0xIT09Yi5jaGlsZE5vZGVzW2ddLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7aT1iLmNoaWxkTm9kZXNbZ107YnJlYWt9aSYmKGkuY2xhc3NOYW1lKz1cIiBqc3RyZWUtc2VhcmNoXCIpfXJldHVybiBifX0sZnVuY3Rpb24oYSl7YS52YWthdGEuc2VhcmNoPWZ1bmN0aW9uKGIsYyxkKXtkPWR8fHt9LGQ9YS5leHRlbmQoe30sYS52YWthdGEuc2VhcmNoLmRlZmF1bHRzLGQpLGQuZnV6enkhPT0hMSYmKGQuZnV6enk9ITApLGI9ZC5jYXNlU2Vuc2l0aXZlP2I6Yi50b0xvd2VyQ2FzZSgpO3ZhciBlPWQubG9jYXRpb24sZj1kLmRpc3RhbmNlLGc9ZC50aHJlc2hvbGQsaD1iLmxlbmd0aCxpLGosayxsO3JldHVybiBoPjMyJiYoZC5mdXp6eT0hMSksZC5mdXp6eSYmKGk9MTw8aC0xLGo9ZnVuY3Rpb24oKXt2YXIgYT17fSxjPTA7Zm9yKGM9MDtoPmM7YysrKWFbYi5jaGFyQXQoYyldPTA7Zm9yKGM9MDtoPmM7YysrKWFbYi5jaGFyQXQoYyldfD0xPDxoLWMtMTtyZXR1cm4gYX0oKSxrPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS9oLGQ9TWF0aC5hYnMoZS1iKTtyZXR1cm4gZj9jK2QvZjpkPzE6Y30pLGw9ZnVuY3Rpb24oYSl7aWYoYT1kLmNhc2VTZW5zaXRpdmU/YTphLnRvTG93ZXJDYXNlKCksYj09PWF8fC0xIT09YS5pbmRleE9mKGIpKXJldHVybntpc01hdGNoOiEwLHNjb3JlOjB9O2lmKCFkLmZ1enp5KXJldHVybntpc01hdGNoOiExLHNjb3JlOjF9O3ZhciBjLGYsbD1hLmxlbmd0aCxtPWcsbj1hLmluZGV4T2YoYixlKSxvLHAscT1oK2wscixzLHQsdSx2LHc9MSx4PVtdO2ZvcigtMSE9PW4mJihtPU1hdGgubWluKGsoMCxuKSxtKSxuPWEubGFzdEluZGV4T2YoYixlK2gpLC0xIT09biYmKG09TWF0aC5taW4oaygwLG4pLG0pKSksbj0tMSxjPTA7aD5jO2MrKyl7bz0wLHA9cTt3aGlsZShwPm8payhjLGUrcCk8PW0/bz1wOnE9cCxwPU1hdGguZmxvb3IoKHEtbykvMitvKTtmb3IocT1wLHM9TWF0aC5tYXgoMSxlLXArMSksdD1NYXRoLm1pbihlK3AsbCkraCx1PW5ldyBBcnJheSh0KzIpLHVbdCsxXT0oMTw8YyktMSxmPXQ7Zj49cztmLS0paWYodj1qW2EuY2hhckF0KGYtMSldLDA9PT1jP3VbZl09KHVbZisxXTw8MXwxKSZ2OnVbZl09KHVbZisxXTw8MXwxKSZ2fCgocltmKzFdfHJbZl0pPDwxfDEpfHJbZisxXSx1W2ZdJmkmJih3PWsoYyxmLTEpLG0+PXcpKXtpZihtPXcsbj1mLTEseC5wdXNoKG4pLCEobj5lKSlicmVhaztzPU1hdGgubWF4KDEsMiplLW4pfWlmKGsoYysxLGUpPm0pYnJlYWs7cj11fXJldHVybntpc01hdGNoOm4+PTAsc2NvcmU6d319LGM9PT0hMD97c2VhcmNoOmx9OmwoYyl9LGEudmFrYXRhLnNlYXJjaC5kZWZhdWx0cz17bG9jYXRpb246MCxkaXN0YW5jZToxMDAsdGhyZXNob2xkOi42LGZ1enp5OiExLGNhc2VTZW5zaXRpdmU6ITF9fShhKSxhLmpzdHJlZS5kZWZhdWx0cy5zb3J0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZ2V0X3RleHQoYSk+dGhpcy5nZXRfdGV4dChiKT8xOi0xfSxhLmpzdHJlZS5wbHVnaW5zLnNvcnQ9ZnVuY3Rpb24oYixjKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtjLmJpbmQuY2FsbCh0aGlzKSx0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5zb3J0KGIucGFyZW50LCEwKX0sdGhpcykpLm9uKFwicmVuYW1lX25vZGUuanN0cmVlIGNyZWF0ZV9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLnNvcnQoYi5wYXJlbnR8fGIubm9kZS5wYXJlbnQsITEpLHRoaXMucmVkcmF3X25vZGUoYi5wYXJlbnR8fGIubm9kZS5wYXJlbnQsITApfSx0aGlzKSkub24oXCJtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5zb3J0KGIucGFyZW50LCExKSx0aGlzLnJlZHJhd19ub2RlKGIucGFyZW50LCEwKX0sdGhpcykpfSx0aGlzLnNvcnQ9ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmNoaWxkcmVuJiZiLmNoaWxkcmVuLmxlbmd0aCYmKGIuY2hpbGRyZW4uc29ydChhLnByb3h5KHRoaXMuc2V0dGluZ3Muc29ydCx0aGlzKSksYykpZm9yKGQ9MCxlPWIuY2hpbGRyZW5fZC5sZW5ndGg7ZT5kO2QrKyl0aGlzLnNvcnQoYi5jaGlsZHJlbl9kW2RdLCExKX19O3ZhciBwPSExO2EuanN0cmVlLmRlZmF1bHRzLnN0YXRlPXtrZXk6XCJqc3RyZWVcIixldmVudHM6XCJjaGFuZ2VkLmpzdHJlZSBvcGVuX25vZGUuanN0cmVlIGNsb3NlX25vZGUuanN0cmVlIGNoZWNrX25vZGUuanN0cmVlIHVuY2hlY2tfbm9kZS5qc3RyZWVcIix0dGw6ITEsZmlsdGVyOiExfSxhLmpzdHJlZS5wbHVnaW5zLnN0YXRlPWZ1bmN0aW9uKGIsYyl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7Yy5iaW5kLmNhbGwodGhpcyk7dmFyIGI9YS5wcm94eShmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5vbih0aGlzLnNldHRpbmdzLnN0YXRlLmV2ZW50cyxhLnByb3h5KGZ1bmN0aW9uKCl7cCYmY2xlYXJUaW1lb3V0KHApLHA9c2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5zYXZlX3N0YXRlKCl9LHRoaXMpLDEwMCl9LHRoaXMpKSx0aGlzLnRyaWdnZXIoXCJzdGF0ZV9yZWFkeVwiKX0sdGhpcyk7dGhpcy5lbGVtZW50Lm9uKFwicmVhZHkuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGMpe3RoaXMuZWxlbWVudC5vbmUoXCJyZXN0b3JlX3N0YXRlLmpzdHJlZVwiLGIpLHRoaXMucmVzdG9yZV9zdGF0ZSgpfHxiKCl9LHRoaXMpKX0sdGhpcy5zYXZlX3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGI9e3N0YXRlOnRoaXMuZ2V0X3N0YXRlKCksdHRsOnRoaXMuc2V0dGluZ3Muc3RhdGUudHRsLHNlYzorbmV3IERhdGV9O2EudmFrYXRhLnN0b3JhZ2Uuc2V0KHRoaXMuc2V0dGluZ3Muc3RhdGUua2V5LEpTT04uc3RyaW5naWZ5KGIpKX0sdGhpcy5yZXN0b3JlX3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGI9YS52YWthdGEuc3RvcmFnZS5nZXQodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXkpO2lmKGIpdHJ5e2I9SlNPTi5wYXJzZShiKX1jYXRjaChjKXtyZXR1cm4hMX1yZXR1cm4gYiYmYi50dGwmJmIuc2VjJiYrbmV3IERhdGUtYi5zZWM+Yi50dGw/ITE6KGImJmIuc3RhdGUmJihiPWIuc3RhdGUpLGImJmEuaXNGdW5jdGlvbih0aGlzLnNldHRpbmdzLnN0YXRlLmZpbHRlcikmJihiPXRoaXMuc2V0dGluZ3Muc3RhdGUuZmlsdGVyLmNhbGwodGhpcyxiKSksYj8odGhpcy5lbGVtZW50Lm9uZShcInNldF9zdGF0ZS5qc3RyZWVcIixmdW5jdGlvbihjLGQpe2QuaW5zdGFuY2UudHJpZ2dlcihcInJlc3RvcmVfc3RhdGVcIix7c3RhdGU6YS5leHRlbmQoITAse30sYil9KX0pLHRoaXMuc2V0X3N0YXRlKGIpLCEwKTohMSl9LHRoaXMuY2xlYXJfc3RhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gYS52YWthdGEuc3RvcmFnZS5kZWwodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXkpfX0sZnVuY3Rpb24oYSxiKXthLnZha2F0YS5zdG9yYWdlPXtzZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGEsYil9LGdldDpmdW5jdGlvbihhKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGEpfSxkZWw6ZnVuY3Rpb24oYSl7cmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShhKX19fShhKSxhLmpzdHJlZS5kZWZhdWx0cy50eXBlcz17XCJkZWZhdWx0XCI6e319LGEuanN0cmVlLmRlZmF1bHRzLnR5cGVzW2EuanN0cmVlLnJvb3RdPXt9LGEuanN0cmVlLnBsdWdpbnMudHlwZXM9ZnVuY3Rpb24oYyxkKXt0aGlzLmluaXQ9ZnVuY3Rpb24oYyxlKXt2YXIgZixnO2lmKGUmJmUudHlwZXMmJmUudHlwZXNbXCJkZWZhdWx0XCJdKWZvcihmIGluIGUudHlwZXMpaWYoXCJkZWZhdWx0XCIhPT1mJiZmIT09YS5qc3RyZWUucm9vdCYmZS50eXBlcy5oYXNPd25Qcm9wZXJ0eShmKSlmb3IoZyBpbiBlLnR5cGVzW1wiZGVmYXVsdFwiXSllLnR5cGVzW1wiZGVmYXVsdFwiXS5oYXNPd25Qcm9wZXJ0eShnKSYmZS50eXBlc1tmXVtnXT09PWImJihlLnR5cGVzW2ZdW2ddPWUudHlwZXNbXCJkZWZhdWx0XCJdW2ddKTtkLmluaXQuY2FsbCh0aGlzLGMsZSksdGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS50eXBlPWEuanN0cmVlLnJvb3R9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihiLGMpe2QucmVmcmVzaC5jYWxsKHRoaXMsYixjKSx0aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLnR5cGU9YS5qc3RyZWUucm9vdH0sdGhpcy5iaW5kPWZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihjLGQpe3ZhciBlPXRoaXMuX21vZGVsLmRhdGEsZj1kLm5vZGVzLGc9dGhpcy5zZXR0aW5ncy50eXBlcyxoLGksaj1cImRlZmF1bHRcIixrO2ZvcihoPTAsaT1mLmxlbmd0aDtpPmg7aCsrKXtpZihqPVwiZGVmYXVsdFwiLGVbZltoXV0ub3JpZ2luYWwmJmVbZltoXV0ub3JpZ2luYWwudHlwZSYmZ1tlW2ZbaF1dLm9yaWdpbmFsLnR5cGVdJiYoaj1lW2ZbaF1dLm9yaWdpbmFsLnR5cGUpLGVbZltoXV0uZGF0YSYmZVtmW2hdXS5kYXRhLmpzdHJlZSYmZVtmW2hdXS5kYXRhLmpzdHJlZS50eXBlJiZnW2VbZltoXV0uZGF0YS5qc3RyZWUudHlwZV0mJihqPWVbZltoXV0uZGF0YS5qc3RyZWUudHlwZSksZVtmW2hdXS50eXBlPWosZVtmW2hdXS5pY29uPT09ITAmJmdbal0uaWNvbiE9PWImJihlW2ZbaF1dLmljb249Z1tqXS5pY29uKSxnW2pdLmxpX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZ1tqXS5saV9hdHRyKWZvcihrIGluIGdbal0ubGlfYXR0cilpZihnW2pdLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtmW2hdXS5saV9hdHRyW2tdPT09Yj9lW2ZbaF1dLmxpX2F0dHJba109Z1tqXS5saV9hdHRyW2tdOlwiY2xhc3NcIj09PWsmJihlW2ZbaF1dLmxpX2F0dHJbXCJjbGFzc1wiXT1nW2pdLmxpX2F0dHJbXCJjbGFzc1wiXStcIiBcIitlW2ZbaF1dLmxpX2F0dHJbXCJjbGFzc1wiXSl9aWYoZ1tqXS5hX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZ1tqXS5hX2F0dHIpZm9yKGsgaW4gZ1tqXS5hX2F0dHIpaWYoZ1tqXS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtmW2hdXS5hX2F0dHJba109PT1iP2VbZltoXV0uYV9hdHRyW2tdPWdbal0uYV9hdHRyW2tdOlwiaHJlZlwiPT09ayYmXCIjXCI9PT1lW2ZbaF1dLmFfYXR0cltrXT9lW2ZbaF1dLmFfYXR0ci5ocmVmPWdbal0uYV9hdHRyLmhyZWY6XCJjbGFzc1wiPT09ayYmKGVbZltoXV0uYV9hdHRyW1wiY2xhc3NcIl09Z1tqXS5hX2F0dHJbXCJjbGFzc1wiXStcIiBcIitlW2ZbaF1dLmFfYXR0cltcImNsYXNzXCJdKX19ZVthLmpzdHJlZS5yb290XS50eXBlPWEuanN0cmVlLnJvb3R9LHRoaXMpKSxkLmJpbmQuY2FsbCh0aGlzKX0sdGhpcy5nZXRfanNvbj1mdW5jdGlvbihiLGMsZSl7dmFyIGYsZyxoPXRoaXMuX21vZGVsLmRhdGEsaT1jP2EuZXh0ZW5kKCEwLHt9LGMse25vX2lkOiExfSk6e30saj1kLmdldF9qc29uLmNhbGwodGhpcyxiLGksZSk7aWYoaj09PSExKXJldHVybiExO2lmKGEuaXNBcnJheShqKSlmb3IoZj0wLGc9ai5sZW5ndGg7Zz5mO2YrKylqW2ZdLnR5cGU9altmXS5pZCYmaFtqW2ZdLmlkXSYmaFtqW2ZdLmlkXS50eXBlP2hbaltmXS5pZF0udHlwZTpcImRlZmF1bHRcIixjJiZjLm5vX2lkJiYoZGVsZXRlIGpbZl0uaWQsaltmXS5saV9hdHRyJiZqW2ZdLmxpX2F0dHIuaWQmJmRlbGV0ZSBqW2ZdLmxpX2F0dHIuaWQsaltmXS5hX2F0dHImJmpbZl0uYV9hdHRyLmlkJiZkZWxldGUgaltmXS5hX2F0dHIuaWQpO2Vsc2Ugai50eXBlPWouaWQmJmhbai5pZF0mJmhbai5pZF0udHlwZT9oW2ouaWRdLnR5cGU6XCJkZWZhdWx0XCIsYyYmYy5ub19pZCYmKGo9dGhpcy5fZGVsZXRlX2lkcyhqKSk7cmV0dXJuIGp9LHRoaXMuX2RlbGV0ZV9pZHM9ZnVuY3Rpb24oYil7aWYoYS5pc0FycmF5KGIpKXtmb3IodmFyIGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspYltjXT10aGlzLl9kZWxldGVfaWRzKGJbY10pO3JldHVybiBifXJldHVybiBkZWxldGUgYi5pZCxiLmxpX2F0dHImJmIubGlfYXR0ci5pZCYmZGVsZXRlIGIubGlfYXR0ci5pZCxiLmFfYXR0ciYmYi5hX2F0dHIuaWQmJmRlbGV0ZSBiLmFfYXR0ci5pZCxiLmNoaWxkcmVuJiZhLmlzQXJyYXkoYi5jaGlsZHJlbikmJihiLmNoaWxkcmVuPXRoaXMuX2RlbGV0ZV9pZHMoYi5jaGlsZHJlbikpLGJ9LHRoaXMuY2hlY2s9ZnVuY3Rpb24oYyxlLGYsZyxoKXtpZihkLmNoZWNrLmNhbGwodGhpcyxjLGUsZixnLGgpPT09ITEpcmV0dXJuITE7ZT1lJiZlLmlkP2U6dGhpcy5nZXRfbm9kZShlKSxmPWYmJmYuaWQ/Zjp0aGlzLmdldF9ub2RlKGYpO3ZhciBpPWUmJmUuaWQ/aCYmaC5vcmlnaW4/aC5vcmlnaW46YS5qc3RyZWUucmVmZXJlbmNlKGUuaWQpOm51bGwsaixrLGwsbTtzd2l0Y2goaT1pJiZpLl9tb2RlbCYmaS5fbW9kZWwuZGF0YT9pLl9tb2RlbC5kYXRhOm51bGwsYyl7Y2FzZVwiY3JlYXRlX25vZGVcIjpjYXNlXCJtb3ZlX25vZGVcIjpjYXNlXCJjb3B5X25vZGVcIjppZihcIm1vdmVfbm9kZVwiIT09Y3x8LTE9PT1hLmluQXJyYXkoZS5pZCxmLmNoaWxkcmVuKSl7aWYoaj10aGlzLmdldF9ydWxlcyhmKSxqLm1heF9jaGlsZHJlbiE9PWImJi0xIT09ai5tYXhfY2hpbGRyZW4mJmoubWF4X2NoaWxkcmVuPT09Zi5jaGlsZHJlbi5sZW5ndGgpcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAxXCIscmVhc29uOlwibWF4X2NoaWxkcmVuIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitjLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpjLHBvczpnLG9iajplJiZlLmlkP2UuaWQ6ITEscGFyOmYmJmYuaWQ/Zi5pZDohMX0pfSwhMTtpZihqLnZhbGlkX2NoaWxkcmVuIT09YiYmLTEhPT1qLnZhbGlkX2NoaWxkcmVuJiYtMT09PWEuaW5BcnJheShlLnR5cGV8fFwiZGVmYXVsdFwiLGoudmFsaWRfY2hpbGRyZW4pKXJldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInR5cGVzXCIsaWQ6XCJ0eXBlc18wMlwiLHJlYXNvbjpcInZhbGlkX2NoaWxkcmVuIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitjLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpjLHBvczpnLG9iajplJiZlLmlkP2UuaWQ6ITEscGFyOmYmJmYuaWQ/Zi5pZDohMX0pfSwhMTtpZihpJiZlLmNoaWxkcmVuX2QmJmUucGFyZW50cyl7Zm9yKGs9MCxsPTAsbT1lLmNoaWxkcmVuX2QubGVuZ3RoO20+bDtsKyspaz1NYXRoLm1heChrLGlbZS5jaGlsZHJlbl9kW2xdXS5wYXJlbnRzLmxlbmd0aCk7az1rLWUucGFyZW50cy5sZW5ndGgrMX0oMD49a3x8az09PWIpJiYoaz0xKTtkb3tpZihqLm1heF9kZXB0aCE9PWImJi0xIT09ai5tYXhfZGVwdGgmJmoubWF4X2RlcHRoPGspcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAzXCIscmVhc29uOlwibWF4X2RlcHRoIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitjLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpjLHBvczpnLG9iajplJiZlLmlkP2UuaWQ6ITEscGFyOmYmJmYuaWQ/Zi5pZDohMX0pfSwhMTtmPXRoaXMuZ2V0X25vZGUoZi5wYXJlbnQpLGo9dGhpcy5nZXRfcnVsZXMoZiksaysrfXdoaWxlKGYpfX1yZXR1cm4hMH0sdGhpcy5nZXRfcnVsZXM9ZnVuY3Rpb24oYSl7aWYoYT10aGlzLmdldF9ub2RlKGEpLCFhKXJldHVybiExO3ZhciBjPXRoaXMuZ2V0X3R5cGUoYSwhMCk7cmV0dXJuIGMubWF4X2RlcHRoPT09YiYmKGMubWF4X2RlcHRoPS0xKSxjLm1heF9jaGlsZHJlbj09PWImJihjLm1heF9jaGlsZHJlbj0tMSksYy52YWxpZF9jaGlsZHJlbj09PWImJihjLnZhbGlkX2NoaWxkcmVuPS0xKSxjfSx0aGlzLmdldF90eXBlPWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiP2M/YS5leHRlbmQoe3R5cGU6Yi50eXBlfSx0aGlzLnNldHRpbmdzLnR5cGVzW2IudHlwZV0pOmIudHlwZTohMX0sdGhpcy5zZXRfdHlwZT1mdW5jdGlvbihjLGQpe3ZhciBlPXRoaXMuX21vZGVsLmRhdGEsZixnLGgsaSxqLGssbCxtO2lmKGEuaXNBcnJheShjKSl7Zm9yKGM9Yy5zbGljZSgpLGc9MCxoPWMubGVuZ3RoO2g+ZztnKyspdGhpcy5zZXRfdHlwZShjW2ddLGQpO3JldHVybiEwfWlmKGY9dGhpcy5zZXR0aW5ncy50eXBlcyxjPXRoaXMuZ2V0X25vZGUoYyksIWZbZF18fCFjKXJldHVybiExO2lmKGw9dGhpcy5nZXRfbm9kZShjLCEwKSxsJiZsLmxlbmd0aCYmKG09bC5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpKSxpPWMudHlwZSxqPXRoaXMuZ2V0X2ljb24oYyksYy50eXBlPWQsKGo9PT0hMHx8ZltpXSYmZltpXS5pY29uIT09YiYmaj09PWZbaV0uaWNvbikmJnRoaXMuc2V0X2ljb24oYyxmW2RdLmljb24hPT1iP2ZbZF0uaWNvbjohMCksZltpXS5saV9hdHRyIT09YiYmXCJvYmplY3RcIj09dHlwZW9mIGZbaV0ubGlfYXR0cilmb3IoayBpbiBmW2ldLmxpX2F0dHIpaWYoZltpXS5saV9hdHRyLmhhc093blByb3BlcnR5KGspKXtpZihcImlkXCI9PT1rKWNvbnRpbnVlO1wiY2xhc3NcIj09PWs/KGVbYy5pZF0ubGlfYXR0cltcImNsYXNzXCJdPShlW2MuaWRdLmxpX2F0dHJbXCJjbGFzc1wiXXx8XCJcIikucmVwbGFjZShmW2ldLmxpX2F0dHJba10sXCJcIiksbCYmbC5yZW1vdmVDbGFzcyhmW2ldLmxpX2F0dHJba10pKTplW2MuaWRdLmxpX2F0dHJba109PT1mW2ldLmxpX2F0dHJba10mJihlW2MuaWRdLmxpX2F0dHJba109bnVsbCxsJiZsLnJlbW92ZUF0dHIoaykpfWlmKGZbaV0uYV9hdHRyIT09YiYmXCJvYmplY3RcIj09dHlwZW9mIGZbaV0uYV9hdHRyKWZvcihrIGluIGZbaV0uYV9hdHRyKWlmKGZbaV0uYV9hdHRyLmhhc093blByb3BlcnR5KGspKXtpZihcImlkXCI9PT1rKWNvbnRpbnVlO1wiY2xhc3NcIj09PWs/KGVbYy5pZF0uYV9hdHRyW1wiY2xhc3NcIl09KGVbYy5pZF0uYV9hdHRyW1wiY2xhc3NcIl18fFwiXCIpLnJlcGxhY2UoZltpXS5hX2F0dHJba10sXCJcIiksbSYmbS5yZW1vdmVDbGFzcyhmW2ldLmFfYXR0cltrXSkpOmVbYy5pZF0uYV9hdHRyW2tdPT09ZltpXS5hX2F0dHJba10mJihcImhyZWZcIj09PWs/KGVbYy5pZF0uYV9hdHRyW2tdPVwiI1wiLG0mJm0uYXR0cihcImhyZWZcIixcIiNcIikpOihkZWxldGUgZVtjLmlkXS5hX2F0dHJba10sbSYmbS5yZW1vdmVBdHRyKGspKSl9aWYoZltkXS5saV9hdHRyIT09YiYmXCJvYmplY3RcIj09dHlwZW9mIGZbZF0ubGlfYXR0cilmb3IoayBpbiBmW2RdLmxpX2F0dHIpaWYoZltkXS5saV9hdHRyLmhhc093blByb3BlcnR5KGspKXtpZihcImlkXCI9PT1rKWNvbnRpbnVlO2VbYy5pZF0ubGlfYXR0cltrXT09PWI/KGVbYy5pZF0ubGlfYXR0cltrXT1mW2RdLmxpX2F0dHJba10sbCYmKFwiY2xhc3NcIj09PWs/bC5hZGRDbGFzcyhmW2RdLmxpX2F0dHJba10pOmwuYXR0cihrLGZbZF0ubGlfYXR0cltrXSkpKTpcImNsYXNzXCI9PT1rJiYoZVtjLmlkXS5saV9hdHRyW1wiY2xhc3NcIl09ZltkXS5saV9hdHRyW2tdK1wiIFwiK2VbYy5pZF0ubGlfYXR0cltcImNsYXNzXCJdLGwmJmwuYWRkQ2xhc3MoZltkXS5saV9hdHRyW2tdKSl9aWYoZltkXS5hX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltkXS5hX2F0dHIpZm9yKGsgaW4gZltkXS5hX2F0dHIpaWYoZltkXS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtjLmlkXS5hX2F0dHJba109PT1iPyhlW2MuaWRdLmFfYXR0cltrXT1mW2RdLmFfYXR0cltrXSxtJiYoXCJjbGFzc1wiPT09az9tLmFkZENsYXNzKGZbZF0uYV9hdHRyW2tdKTptLmF0dHIoayxmW2RdLmFfYXR0cltrXSkpKTpcImhyZWZcIj09PWsmJlwiI1wiPT09ZVtjLmlkXS5hX2F0dHJba10/KGVbYy5pZF0uYV9hdHRyLmhyZWY9ZltkXS5hX2F0dHIuaHJlZixtJiZtLmF0dHIoXCJocmVmXCIsZltkXS5hX2F0dHIuaHJlZikpOlwiY2xhc3NcIj09PWsmJihlW2MuaWRdLmFfYXR0cltcImNsYXNzXCJdPWZbZF0uYV9hdHRyW1wiY2xhc3NcIl0rXCIgXCIrZVtjLmlkXS5hX2F0dHJbXCJjbGFzc1wiXSxtJiZtLmFkZENsYXNzKGZbZF0uYV9hdHRyW2tdKSl9cmV0dXJuITB9fSxhLmpzdHJlZS5kZWZhdWx0cy51bmlxdWU9e2Nhc2Vfc2Vuc2l0aXZlOiExLGR1cGxpY2F0ZTpmdW5jdGlvbihhLGIpe3JldHVybiBhK1wiIChcIitiK1wiKVwifX0sYS5qc3RyZWUucGx1Z2lucy51bmlxdWU9ZnVuY3Rpb24oYyxkKXt0aGlzLmNoZWNrPWZ1bmN0aW9uKGIsYyxlLGYsZyl7aWYoZC5jaGVjay5jYWxsKHRoaXMsYixjLGUsZixnKT09PSExKXJldHVybiExO2lmKGM9YyYmYy5pZD9jOnRoaXMuZ2V0X25vZGUoYyksZT1lJiZlLmlkP2U6dGhpcy5nZXRfbm9kZShlKSwhZXx8IWUuY2hpbGRyZW4pcmV0dXJuITA7dmFyIGg9XCJyZW5hbWVfbm9kZVwiPT09Yj9mOmMudGV4dCxpPVtdLGo9dGhpcy5zZXR0aW5ncy51bmlxdWUuY2FzZV9zZW5zaXRpdmUsaz10aGlzLl9tb2RlbC5kYXRhLGwsbTtmb3IobD0wLG09ZS5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKylpLnB1c2goaj9rW2UuY2hpbGRyZW5bbF1dLnRleHQ6a1tlLmNoaWxkcmVuW2xdXS50ZXh0LnRvTG93ZXJDYXNlKCkpO3N3aXRjaChqfHwoaD1oLnRvTG93ZXJDYXNlKCkpLGIpe2Nhc2VcImRlbGV0ZV9ub2RlXCI6cmV0dXJuITA7Y2FzZVwicmVuYW1lX25vZGVcIjpyZXR1cm4gbD0tMT09PWEuaW5BcnJheShoLGkpfHxjLnRleHQmJmMudGV4dFtqP1widG9TdHJpbmdcIjpcInRvTG93ZXJDYXNlXCJdKCk9PT1oLGx8fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzAxXCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2grXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmYsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZSYmZS5pZD9lLmlkOiExfSl9KSxsO2Nhc2VcImNyZWF0ZV9ub2RlXCI6cmV0dXJuIGw9LTE9PT1hLmluQXJyYXkoaCxpKSxsfHwodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ1bmlxdWVcIixpZDpcInVuaXF1ZV8wNFwiLHJlYXNvbjpcIkNoaWxkIHdpdGggbmFtZSBcIitoK1wiIGFscmVhZHkgZXhpc3RzLiBQcmV2ZW50aW5nOiBcIitiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpiLHBvczpmLG9iajpjJiZjLmlkP2MuaWQ6ITEscGFyOmUmJmUuaWQ/ZS5pZDohMX0pfSksbDtjYXNlXCJjb3B5X25vZGVcIjpyZXR1cm4gbD0tMT09PWEuaW5BcnJheShoLGkpLGx8fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzAyXCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2grXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmYsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZSYmZS5pZD9lLmlkOiExfSl9KSxsO2Nhc2VcIm1vdmVfbm9kZVwiOnJldHVybiBsPWMucGFyZW50PT09ZS5pZCYmKCFnfHwhZy5pc19tdWx0aSl8fC0xPT09YS5pbkFycmF5KGgsaSksbHx8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDNcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIraCtcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZixvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjplJiZlLmlkP2UuaWQ6ITF9KX0pLGx9cmV0dXJuITB9LHRoaXMuY3JlYXRlX25vZGU9ZnVuY3Rpb24oYyxlLGYsZyxoKXtpZighZXx8ZS50ZXh0PT09Yil7aWYobnVsbD09PWMmJihjPWEuanN0cmVlLnJvb3QpLGM9dGhpcy5nZXRfbm9kZShjKSwhYylyZXR1cm4gZC5jcmVhdGVfbm9kZS5jYWxsKHRoaXMsYyxlLGYsZyxoKTtpZihmPWY9PT1iP1wibGFzdFwiOmYsIWYudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhaCYmIXRoaXMuaXNfbG9hZGVkKGMpKXJldHVybiBkLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxjLGUsZixnLGgpO1xuZXx8KGU9e30pO3ZhciBpLGosayxsLG0sbj10aGlzLl9tb2RlbC5kYXRhLG89dGhpcy5zZXR0aW5ncy51bmlxdWUuY2FzZV9zZW5zaXRpdmUscD10aGlzLnNldHRpbmdzLnVuaXF1ZS5kdXBsaWNhdGU7Zm9yKGo9aT10aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKSxrPVtdLGw9MCxtPWMuY2hpbGRyZW4ubGVuZ3RoO20+bDtsKyspay5wdXNoKG8/bltjLmNoaWxkcmVuW2xdXS50ZXh0Om5bYy5jaGlsZHJlbltsXV0udGV4dC50b0xvd2VyQ2FzZSgpKTtsPTE7d2hpbGUoLTEhPT1hLmluQXJyYXkobz9qOmoudG9Mb3dlckNhc2UoKSxrKSlqPXAuY2FsbCh0aGlzLGksKytsKS50b1N0cmluZygpO2UudGV4dD1qfXJldHVybiBkLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxjLGUsZixnLGgpfX07dmFyIHE9aS5jcmVhdGVFbGVtZW50KFwiRElWXCIpO2lmKHEuc2V0QXR0cmlidXRlKFwidW5zZWxlY3RhYmxlXCIsXCJvblwiKSxxLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxxLmNsYXNzTmFtZT1cImpzdHJlZS13aG9sZXJvd1wiLHEuaW5uZXJIVE1MPVwiJiMxNjA7XCIsYS5qc3RyZWUucGx1Z2lucy53aG9sZXJvdz1mdW5jdGlvbihiLGMpe3RoaXMuYmluZD1mdW5jdGlvbigpe2MuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcInJlYWR5LmpzdHJlZSBzZXRfc3RhdGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuaGlkZV9kb3RzKCl9LHRoaXMpKS5vbihcImluaXQuanN0cmVlIGxvYWRpbmcuanN0cmVlIHJlYWR5LmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS13aG9sZXJvdy11bFwiKX0sdGhpcykpLm9uKFwiZGVzZWxlY3RfYWxsLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpfSx0aGlzKSkub24oXCJjaGFuZ2VkLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpO3ZhciBjPSExLGQsZTtmb3IoZD0wLGU9Yi5zZWxlY3RlZC5sZW5ndGg7ZT5kO2QrKyljPXRoaXMuZ2V0X25vZGUoYi5zZWxlY3RlZFtkXSwhMCksYyYmYy5sZW5ndGgmJmMuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcIm9wZW5fbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5nZXRfbm9kZShiLm5vZGUsITApLmZpbmQoXCIuanN0cmVlLWNsaWNrZWRcIikucGFyZW50KCkuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImhvdmVyX25vZGUuanN0cmVlIGRlaG92ZXJfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7XCJob3Zlcl9ub2RlXCI9PT1hLnR5cGUmJnRoaXMuaXNfZGlzYWJsZWQoYi5ub2RlKXx8dGhpcy5nZXRfbm9kZShiLm5vZGUsITApLmNoaWxkcmVuKFwiLmpzdHJlZS13aG9sZXJvd1wiKVtcImhvdmVyX25vZGVcIj09PWEudHlwZT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcImpzdHJlZS13aG9sZXJvdy1ob3ZlcmVkXCIpfSx0aGlzKSkub24oXCJjb250ZXh0bWVudS5qc3RyZWVcIixcIi5qc3RyZWUtd2hvbGVyb3dcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2lmKHRoaXMuX2RhdGEuY29udGV4dG1lbnUpe2IucHJldmVudERlZmF1bHQoKTt2YXIgYz1hLkV2ZW50KFwiY29udGV4dG1lbnVcIix7bWV0YUtleTpiLm1ldGFLZXksY3RybEtleTpiLmN0cmxLZXksYWx0S2V5OmIuYWx0S2V5LHNoaWZ0S2V5OmIuc2hpZnRLZXkscGFnZVg6Yi5wYWdlWCxwYWdlWTpiLnBhZ2VZfSk7YShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoYyl9fSx0aGlzKSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtd2hvbGVyb3dcIixmdW5jdGlvbihiKXtiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO3ZhciBjPWEuRXZlbnQoXCJjbGlja1wiLHttZXRhS2V5OmIubWV0YUtleSxjdHJsS2V5OmIuY3RybEtleSxhbHRLZXk6Yi5hbHRLZXksc2hpZnRLZXk6Yi5zaGlmdEtleX0pO2EoYi5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZmlyc3QoKS50cmlnZ2VyKGMpLmZvY3VzKCl9KS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1sZWFmID4gLmpzdHJlZS1vY2xcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2Iuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7dmFyIGM9YS5FdmVudChcImNsaWNrXCIse21ldGFLZXk6Yi5tZXRhS2V5LGN0cmxLZXk6Yi5jdHJsS2V5LGFsdEtleTpiLmFsdEtleSxzaGlmdEtleTpiLnNoaWZ0S2V5fSk7YShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoYykuZm9jdXMoKX0sdGhpcykpLm9uKFwibW91c2VvdmVyLmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvdywgLmpzdHJlZS1pY29uXCIsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSx0aGlzLmlzX2Rpc2FibGVkKGEuY3VycmVudFRhcmdldCl8fHRoaXMuaG92ZXJfbm9kZShhLmN1cnJlbnRUYXJnZXQpLCExfSx0aGlzKSkub24oXCJtb3VzZWxlYXZlLmpzdHJlZVwiLFwiLmpzdHJlZS1ub2RlXCIsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLmRlaG92ZXJfbm9kZShhLmN1cnJlbnRUYXJnZXQpfSx0aGlzKSl9LHRoaXMudGVhcmRvd249ZnVuY3Rpb24oKXt0aGlzLnNldHRpbmdzLndob2xlcm93JiZ0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3dcIikucmVtb3ZlKCksYy50ZWFyZG93bi5jYWxsKHRoaXMpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGIsZCxlLGYpe2lmKGI9Yy5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cykpe3ZhciBnPXEuY2xvbmVOb2RlKCEwKTstMSE9PWEuaW5BcnJheShiLmlkLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCkmJihnLmNsYXNzTmFtZSs9XCIganN0cmVlLXdob2xlcm93LWNsaWNrZWRcIiksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQmJnRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPT09Yi5pZCYmKGcuY2xhc3NOYW1lKz1cIiBqc3RyZWUtd2hvbGVyb3ctaG92ZXJlZFwiKSxiLmluc2VydEJlZm9yZShnLGIuY2hpbGROb2Rlc1swXSl9cmV0dXJuIGJ9fSxpLnJlZ2lzdGVyRWxlbWVudCYmT2JqZWN0JiZPYmplY3QuY3JlYXRlKXt2YXIgcj1PYmplY3QuY3JlYXRlKEhUTUxFbGVtZW50LnByb3RvdHlwZSk7ci5jcmVhdGVkQ2FsbGJhY2s9ZnVuY3Rpb24oKXt2YXIgYj17Y29yZTp7fSxwbHVnaW5zOltdfSxjO2ZvcihjIGluIGEuanN0cmVlLnBsdWdpbnMpYS5qc3RyZWUucGx1Z2lucy5oYXNPd25Qcm9wZXJ0eShjKSYmdGhpcy5hdHRyaWJ1dGVzW2NdJiYoYi5wbHVnaW5zLnB1c2goYyksdGhpcy5nZXRBdHRyaWJ1dGUoYykmJkpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoYykpJiYoYltjXT1KU09OLnBhcnNlKHRoaXMuZ2V0QXR0cmlidXRlKGMpKSkpO2ZvcihjIGluIGEuanN0cmVlLmRlZmF1bHRzLmNvcmUpYS5qc3RyZWUuZGVmYXVsdHMuY29yZS5oYXNPd25Qcm9wZXJ0eShjKSYmdGhpcy5hdHRyaWJ1dGVzW2NdJiYoYi5jb3JlW2NdPUpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoYykpfHx0aGlzLmdldEF0dHJpYnV0ZShjKSk7YSh0aGlzKS5qc3RyZWUoYil9O3RyeXtpLnJlZ2lzdGVyRWxlbWVudChcInZha2F0YS1qc3RyZWVcIix7cHJvdG90eXBlOnJ9KX1jYXRjaChzKXt9fX19KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY21zL3N0YXRpYy9jbXMvanMvbGlicy9qc3RyZWUvanN0cmVlLm1pbi5qc1xuLy8gbW9kdWxlIGlkID0gODVcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ 99:
/***/ (function(module, exports, __webpack_require__) {

eval("/*\n * Copyright https://github.com/divio/django-cms\n */\n\nvar $ = __webpack_require__(0);\n\n__webpack_require__(85);\n__webpack_require__(105);\n\nvar Class = __webpack_require__(4);\nvar Helpers = __webpack_require__(1).default.API.Helpers;\nvar KEYS = __webpack_require__(1).default.KEYS;\nvar PageTreeDropdowns = __webpack_require__(109);\nvar PageTreeStickyHeader = __webpack_require__(110);\n\n/**\n                                                                    * The pagetree is loaded via `/admin/cms/page` and has a custom admin\n                                                                    * templates stored within `templates/admin/cms/page/tree`.\n                                                                    *\n                                                                    * @class PageTree\n                                                                    * @namespace CMS\n                                                                    */\nvar PageTree = new Class({\n    options: {\n        pasteSelector: '.js-cms-tree-item-paste' },\n\n    // TODO add mechanics to set the home page\n    initialize: function initialize(options) {\n        // options are loaded from the pagetree html node\n        var opts = $('.js-cms-pagetree').data('json');\n\n        this.options = $.extend(true, {}, this.options, opts, options);\n\n        // states and events\n        this.click = 'click.cms.pagetree';\n        this.clipboard = {\n            id: null,\n            origin: null,\n            type: '' };\n\n        this.successTimer = 1000;\n\n        // elements\n        this._setupUI();\n        this._events();\n\n        // cancel if pagetree is not available\n        if (!$.isEmptyObject(opts)) {\n            this._setup();\n        }\n    },\n\n    /**\n        * Stores all jQuery references within `this.ui`.\n        *\n        * @method _setupUI\n        * @private\n        */\n    _setupUI: function _setupUI() {\n        var pagetree = $('.cms-pagetree');\n\n        this.ui = {\n            container: pagetree,\n            document: $(document),\n            tree: pagetree.find('.js-cms-pagetree'),\n            dialog: $('.js-cms-tree-dialog'),\n            siteForm: $('.js-cms-pagetree-site-form') };\n\n    },\n\n    /**\n        * Setting up the jstree and the related columns.\n        *\n        * @method _setup\n        * @private\n        */\n    _setup: function _setup() {\n        var that = this;\n        var columns = [];\n        var obj = {\n            language: this.options.lang.code,\n            openNodes: [] };\n\n        var data = false;\n\n        // make sure that ajax request send the csrf token\n        Helpers.csrf(this.options.csrf);\n\n        // setup column headings\n        // eslint-disable-next-line no-shadow\n        $.each(this.options.columns, function (index, obj) {\n            if (obj.key === '') {\n                // the first row is already populated, to avoid overwrites\n                // just leave the \"key\" param empty\n                columns.push({\n                    header: obj.title,\n                    width: obj.width || '1%',\n                    wideCellClass: obj.cls });\n\n            } else {\n                columns.push({\n                    header: obj.title,\n                    value: function value(node) {\n                        // it needs to have the \"colde\" format and not \"col-de\"\n                        // as jstree will convert \"col-de\" to \"colde\"\n                        // also we strip dashes, in case language code contains it\n                        // e.g. zh-hans, zh-cn etc\n                        if (node.data) {\n                            return node.data['col' + obj.key.replace('-', '')];\n                        }\n\n                        return '';\n                    },\n                    width: obj.width || '1%',\n                    wideCellClass: obj.cls });\n\n            }\n        });\n\n        // prepare data\n        if (!this.options.filtered) {\n            data = {\n                url: this.options.urls.tree,\n                cache: false,\n                data: function data(node) {\n                    // '#' is rendered if its the root node, there we only\n                    // care about `obj.openNodes`, in the following case\n                    // we are requesting a specific node\n                    if (node.id === '#') {\n                        obj.pageId = null;\n                    } else {\n                        obj.pageId = that._storeNodeId(node.data.id);\n                    }\n\n                    // we need to store the opened items inside the localstorage\n                    // as we have to load the pagetree with the previous opened\n                    // state\n                    obj.openNodes = that._getStoredNodeIds();\n\n                    // we need to set the site id to get the correct tree\n                    obj.site = that.options.site;\n\n                    return obj;\n                } };\n\n        }\n\n        // bind options to the jstree instance\n        this.ui.tree.jstree({\n            core: {\n                // disable open/close animations\n                animation: 0,\n                // core setting to allow actions\n                // eslint-disable-next-line max-params\n                check_callback: function check_callback(operation, node, node_parent, node_position, more) {\n                    if ((operation === 'move_node' || operation === 'copy_node') && more && more.pos) {\n                        if (more.pos === 'i') {\n                            $('#jstree-marker').addClass('jstree-marker-child');\n                        } else {\n                            $('#jstree-marker').removeClass('jstree-marker-child');\n                        }\n                    }\n\n                    return that._hasPermission(node_parent, 'add');\n                },\n                // https://www.jstree.com/api/#/?f=$.jstree.defaults.core.data\n                data: data,\n                // strings used within jstree that are called using `get_string`\n                strings: {\n                    'Loading ...': this.options.lang.loading,\n                    'New node': this.options.lang.newNode,\n                    'nodes': this.options.lang.nodes },\n\n                error: function error(_error) {\n                    // ignore warnings about dragging parent into child\n                    var errorData = JSON.parse(_error.data);\n\n                    if (_error.error === 'check' && errorData && errorData.chk === 'move_node') {\n                        return;\n                    }\n                    that.showError(_error.reason);\n                },\n                themes: {\n                    name: 'django-cms' },\n\n                // disable the multi selection of nodes for now\n                multiple: false },\n\n            // activate drag and drop plugin\n            plugins: ['dnd', 'search', 'grid'],\n            // https://www.jstree.com/api/#/?f=$.jstree.defaults.dnd\n            dnd: {\n                inside_pos: 'last',\n                // disable the multi selection of nodes for now\n                drag_selection: false,\n                // disable dragging if filtered\n                is_draggable: function is_draggable(nodes) {\n                    return that._hasPermission(nodes[0], 'move') && !that.options.filtered;\n                },\n                large_drop_target: true,\n                copy: true },\n\n            // https://github.com/deitch/jstree-grid\n            grid: {\n                // columns are provided from base.html options\n                width: '100%',\n                columns: columns } });\n\n\n\n    },\n\n    /**\n        * Sets up all the event handlers, such as opening and moving.\n        *\n        * @method _events\n        * @private\n        */\n    _events: function _events() {\n        var that = this;\n\n        // set events for the nodeId updates\n        this.ui.tree.on('after_close.jstree', function (e, el) {\n            that._removeNodeId(el.node.data.id);\n        });\n\n        this.ui.tree.on('after_open.jstree', function (e, el) {\n            that._storeNodeId(el.node.data.id);\n\n            // `after_open` event can be triggered when pasting\n            // is in progress (meaning we are pasting into a leaf node\n            // in this case we do not need to update helpers state\n            if (this.clipboard && !this.clipboard.isPasting) {\n                that._updatePasteHelpersState();\n            }\n        });\n\n        this.ui.document.on('keydown.pagetree.alt-mode', function (e) {\n            if (e.keyCode === KEYS.SHIFT) {\n                that.ui.container.addClass('cms-pagetree-alt-mode');\n            }\n        });\n\n        this.ui.document.on('keyup.pagetree.alt-mode', function (e) {\n            if (e.keyCode === KEYS.SHIFT) {\n                that.ui.container.removeClass('cms-pagetree-alt-mode');\n            }\n        });\n\n        this.ui.document.on('dnd_start.vakata', function (e, data) {\n            var element = $(data.element);\n            var node = element.parent();\n\n            that._dropdowns.closeAllDropdowns();\n\n            node.addClass('jstree-is-dragging');\n            data.data.nodes.forEach(function (nodeId) {\n                var descendantIds = that._getDescendantsIds(nodeId);\n\n                [nodeId].concat(descendantIds).forEach(function (id) {\n                    $('.jsgrid_' + id + '_col').addClass('jstree-is-dragging');\n                });\n            });\n\n            if (!node.hasClass('jstree-leaf')) {\n                data.helper.addClass('is-stacked');\n            }\n        });\n\n        var isCopyClassAdded = false;\n\n        this.ui.document.on('dnd_move.vakata', function (e, data) {\n            var isMovingCopy = data.data.origin && (\n            data.data.origin.settings.dnd.always_copy ||\n            data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey));\n\n\n            if (isMovingCopy) {\n                if (!isCopyClassAdded) {\n                    $('.jstree-is-dragging').addClass('jstree-is-dragging-copy');\n                    isCopyClassAdded = true;\n                }\n            } else if (isCopyClassAdded) {\n                $('.jstree-is-dragging').removeClass('jstree-is-dragging-copy');\n                isCopyClassAdded = false;\n            }\n        });\n\n        this.ui.document.on('dnd_stop.vakata', function (e, data) {\n            var element = $(data.element);\n            var node = element.parent();\n\n            node.removeClass('jstree-is-dragging jstree-is-dragging-copy');\n            data.data.nodes.forEach(function (nodeId) {\n                var descendantIds = that._getDescendantsIds(nodeId);\n\n                [nodeId].concat(descendantIds).forEach(function (id) {\n                    $('.jsgrid_' + id + '_col').removeClass('jstree-is-dragging jstree-is-dragging-copy');\n                });\n            });\n        });\n\n        // store moved position node\n        this.ui.tree.on('move_node.jstree copy_node.jstree', function (e, obj) {\n            if (!that.clipboard.type && e.type !== 'copy_node' || that.clipboard.type === 'cut') {\n                that._moveNode(that._getNodePosition(obj)).done(function () {\n                    var instance = that.ui.tree.jstree(true);\n\n                    instance._hide_grid(instance.get_node(obj.parent));\n                    if (obj.parent === '#') {\n                        instance.refresh();\n                    } else {\n                        // have to refresh parent, because refresh only\n                        // refreshes children of the node, never the node itself\n                        instance.refresh_node(obj.parent);\n                    }\n                });\n            } else {\n                that._copyNode(obj);\n            }\n            // we need to open the parent node if we trigger an element\n            // if not already opened\n            that.ui.tree.jstree('open_node', obj.parent);\n        });\n\n        // set event for cut and paste\n        this.ui.container.on(this.click, '.js-cms-tree-item-cut', function (e) {\n            e.preventDefault();\n            that._cutOrCopy({ type: 'cut', element: $(this) });\n        });\n\n        // set event for cut and paste\n        this.ui.container.on(this.click, '.js-cms-tree-item-copy', function (e) {\n            e.preventDefault();\n            that._cutOrCopy({ type: 'copy', element: $(this) });\n        });\n\n        // attach events to paste\n        this.ui.container.on(this.click, this.options.pasteSelector, function (e) {\n            e.preventDefault();\n            if ($(this).hasClass('cms-pagetree-dropdown-item-disabled')) {\n                return;\n            }\n            that._paste(e);\n        });\n\n        // advanced settings link handling\n        this.ui.container.on(this.click, '.js-cms-tree-advanced-settings', function (e) {\n            if (e.shiftKey) {\n                e.preventDefault();\n                var link = $(this);\n\n                if (link.data('url')) {\n                    window.location.href = link.data('url');\n                }\n            }\n        });\n\n        // add events for error reload (messagelist)\n        this.ui.document.on(this.click, '.messagelist .cms-tree-reload', function (e) {\n            e.preventDefault();\n            that._reloadHelper();\n        });\n\n        // propagate the sites dropdown \"li > a\" entries to the hidden sites form\n        this.ui.container.find('.js-cms-pagetree-site-trigger').on(this.click, function (e) {\n            e.preventDefault();\n            var el = $(this);\n\n            // prevent if parent is active\n            if (el.parent().hasClass('active')) {\n                return false;\n            }\n            that.ui.siteForm.find('select').\n            val(el.data().id).end().submit();\n        });\n\n        // additional event handlers\n        this._setupDropdowns();\n        this._setupSearch();\n\n        // make sure ajax post requests are working\n        this._setAjaxPost('.js-cms-tree-item-menu a');\n        this._setAjaxPost('.js-cms-tree-lang-trigger');\n\n        this._setupPageView();\n        that._setupStickyHeader();\n    },\n\n    /**\n        * Helper to process the cut and copy events.\n        *\n        * @method _cutOrCopy\n        * @param {Object} [obj]\n        * @param {Number} [obj.type] either 'cut' or 'copy'\n        * @param {Number} [obj.element] originated trigger element\n        * @private\n        * @returns {Boolean|void}\n        */\n    _cutOrCopy: function _cutOrCopy(obj) {\n        // prevent actions if you try to copy a page with an apphook\n        if (obj.type === 'copy' && obj.element.data().apphook) {\n            this.showError(this.options.lang.apphook);\n            return false;\n        }\n\n        var jsTreeId = this._getNodeId(obj.element.closest('.jstree-grid-cell'));\n\n        // resets if we click again\n        if (this.clipboard.type === obj.type && jsTreeId === this.clipboard.id) {\n            this.clipboard.type = null;\n            this.clipboard.id = null;\n            this.clipboard.origin = null;\n            this._disablePaste();\n        } else {\n            this.clipboard.origin = obj.element;\n            this.clipboard.type = obj.type;\n            this.clipboard.id = jsTreeId;\n            this._updatePasteHelpersState();\n        }\n    },\n\n    /**\n        * Helper to process the paste event.\n        *\n        * @method _paste\n        * @param {$.Event} event click event\n        * @private\n        */\n    _paste: function _paste(event) {\n        // hide helpers after we picked one\n        this._disablePaste();\n\n        var copyFromId = this._getNodeId(this.clipboard.origin);\n        var copyToId = this._getNodeId($(event.currentTarget));\n\n        if (this.clipboard.type === 'cut') {\n            this.ui.tree.jstree('cut', copyFromId);\n        } else {\n            this.ui.tree.jstree('copy', copyFromId);\n        }\n\n        this.clipboard.isPasting = true;\n        this.ui.tree.jstree('paste', copyToId, 'last');\n        this.clipboard.id = null;\n        this.clipboard.type = null;\n        this.clipboard.origin = null;\n        this.clipboard.isPasting = false;\n    },\n\n    /**\n        * Retreives a list of nodes from local storage.\n        *\n        * @method _getStoredNodeIds\n        * @private\n        * @returns {Array} list of ids\n        */\n    _getStoredNodeIds: function _getStoredNodeIds() {\n        return CMS.settings.pagetree || [];\n    },\n\n    /**\n        * Stores a node in local storage.\n        *\n        * @method _storeNodeId\n        * @private\n        * @param {String} id to be stored\n        * @returns {String} id that has been stored\n        */\n    _storeNodeId: function _storeNodeId(id) {\n        var number = id;\n        var storage = this._getStoredNodeIds();\n\n        // store value only if it isn't there yet\n        if (storage.indexOf(number) === -1) {\n            storage.push(number);\n        }\n\n        CMS.settings.pagetree = storage;\n        Helpers.setSettings(CMS.settings);\n\n        return number;\n    },\n\n    /**\n        * Removes a node in local storage.\n        *\n        * @method _removeNodeId\n        * @private\n        * @param {String} id to be stored\n        * @returns {String} id that has been removed\n        */\n    _removeNodeId: function _removeNodeId(id) {\n        var number = id;\n        var storage = this._getStoredNodeIds();\n        var index = storage.indexOf(number);\n\n        // remove given id from storage\n        if (index !== -1) {\n            storage.splice(index, 1);\n        }\n\n        CMS.settings.pagetree = storage;\n        Helpers.setSettings(CMS.settings);\n\n        return number;\n    },\n\n    /**\n        * Moves a node after drag & drop.\n        *\n        * @method _moveNode\n        * @param {Object} [obj]\n        * @param {Number} [obj.id] current element id for url matching\n        * @param {Number} [obj.target] target sibling or parent\n        * @param {Number} [obj.position] either `left`, `right` or `last-child`\n        * @returns {$.Deferred} ajax request object\n        * @private\n        */\n    _moveNode: function _moveNode(obj) {\n        var that = this;\n\n        obj.site = that.options.site;\n\n        return $.ajax({\n            method: 'post',\n            url: that.options.urls.move.replace('{id}', obj.id),\n            data: obj }).\n        done(function () {\n            that._showSuccess(obj.id);\n        }).fail(function (error) {\n            that.showError(error.statusText);\n        });\n    },\n\n    /**\n        * Copies a node into the selected node.\n        *\n        * @method _copyNode\n        * @param {Object} obj page obj\n        * @private\n        */\n    _copyNode: function _copyNode(obj) {\n        var that = this;\n        var node = that._getNodePosition(obj);\n        var data = {\n            site: this.options.site,\n            // we need to refer to the original item here, as the copied\n            // node will have no data attributes stored at it (not a clone)\n            id: obj.original.data.id,\n            position: node.position };\n\n\n        // if there is no target provided, the node lands in root\n        if (node.target) {\n            data.target = node.target;\n        }\n\n        if (that.options.permission) {\n            // we need to load a dialog first, to check if permissions should\n            // be copied or not\n            $.ajax({\n                method: 'post',\n                url: that.options.urls.copyPermission.replace('{id}', data.id),\n                data: data\n                // the dialog is loaded via the ajax respons originating from\n                // `templates/admin/cms/page/tree/copy_premissions.html`\n            }).done(function (dialog) {\n                that.ui.dialog.append(dialog);\n            }).fail(function (error) {\n                that.showError(error.statusText);\n            });\n\n            // attach events to the permission dialog\n            this.ui.dialog.off(this.click, '.cancel').on(this.click, '.cancel', function (e) {\n                e.preventDefault();\n                // remove just copied node\n                that.ui.tree.jstree('delete_node', obj.node.id);\n                $('.js-cms-dialog').remove();\n                $('.js-cms-dialog-dimmer').remove();\n            }).off(this.click, '.submit').on(this.click, '.submit', function (e) {\n                e.preventDefault();\n                var submitButton = $(this);\n                var formData = submitButton.closest('form').serialize().split('&');\n\n                submitButton.prop('disabled', true);\n\n                // loop through form data and attach to obj\n                for (var i = 0; i < formData.length; i++) {\n                    data[formData[i].split('=')[0]] = formData[i].split('=')[1];\n                }\n\n                that._saveCopiedNode(data);\n            });\n        } else {\n            this._saveCopiedNode(data);\n        }\n    },\n\n    /**\n        * Sends the request to copy a node.\n        *\n        * @method _saveCopiedNode\n        * @private\n        * @param {Object} data node position information\n        * @returns {$.Deferred}\n        */\n    _saveCopiedNode: function _saveCopiedNode(data) {\n        var that = this;\n\n        // send the real ajax request for copying the plugin\n        return $.ajax({\n            method: 'post',\n            url: that.options.urls.copy.replace('{id}', data.id),\n            data: data }).\n        done(function () {\n            that._reloadHelper();\n        }).fail(function (error) {\n            that.showError(error.statusText);\n        });\n    },\n\n    /**\n        * Returns element from any sub nodes.\n        *\n        * @method _getElement\n        * @private\n        * @param {jQuery} el jQuery node form where to search\n        * @returns {String} jsTree node element id\n        */\n    _getNodeId: function _getNodeId(el) {\n        var cls = el.closest('.jstree-grid-cell').attr('class');\n\n        // if it's not a cell, assume it's the root node\n        return cls ? cls.replace(/.*jsgrid_(.+?)_col.*/, '$1') : '#';\n    },\n\n    /**\n        * Gets the new node position after moving.\n        *\n        * @method _getNodePosition\n        * @private\n        * @param {Object} obj jstree move object\n        * @returns {Object} evaluated object with params\n        */\n    _getNodePosition: function _getNodePosition(obj) {\n        var data = {};\n        var node = this.ui.tree.jstree('get_node', obj.node.parent);\n\n        data.position = obj.position;\n\n        // jstree indicates no parent with `#`, in this case we do not\n        // need to set the target attribute at all\n        if (obj.parent !== '#') {\n            data.target = node.data.id;\n        }\n\n        // some functions like copy create a new element with a new id,\n        // in this case we need to set `data.id` manually\n        if (obj.node && obj.node.data) {\n            data.id = obj.node.data.id;\n        }\n\n        return data;\n    },\n\n    /**\n        * Sets up general tooltips that can have a list of links or content.\n        *\n        * @method _setupDropdowns\n        * @private\n        */\n    _setupDropdowns: function _setupDropdowns() {\n        this._dropdowns = new PageTreeDropdowns({\n            container: this.ui.container });\n\n    },\n\n    /**\n        * Handles page view click. Usual use case is that after you click\n        * on view page in the pagetree - sideframe is no longer needed,\n        * so we close it.\n        *\n        * @method _setupPageView\n        * @private\n        */\n    _setupPageView: function _setupPageView() {\n        var win = Helpers._getWindow();\n        var parent = win.parent ? win.parent : win;\n\n        this.ui.container.on(this.click, '.js-cms-pagetree-page-view', function () {\n            parent.CMS.API.Helpers.setSettings($.extend(true, {}, CMS.settings, {\n                sideframe: {\n                    url: null,\n                    hidden: true } }));\n\n\n        });\n    },\n\n    /**\n        * @method _setupStickyHeader\n        * @private\n        */\n    _setupStickyHeader: function _setupStickyHeader() {\n        var that = this;\n\n        that.ui.tree.on('ready.jstree', function () {\n            that.header = new PageTreeStickyHeader({\n                container: that.ui.container });\n\n        });\n    },\n\n    /**\n        * Triggers the links `href` as ajax post request.\n        *\n        * @method _setAjaxPost\n        * @private\n        * @param {jQuery} trigger jQuery link target\n        */\n    _setAjaxPost: function _setAjaxPost(trigger) {\n        var that = this;\n\n        this.ui.container.on(this.click, trigger, function (e) {\n            e.preventDefault();\n            $.ajax({\n                method: 'post',\n                url: $(this).attr('href') }).\n            done(function () {\n                if (window.self === window.top) {\n                    // simply reload the page\n                    that._reloadHelper();\n                } else {\n                    // if we're in the sideframe we have to actually\n                    // check if we are publishing a page we're currently in\n                    // because if the slug did change we would need to\n                    // redirect to that new slug\n                    // Problem here is that in case of the apphooked page\n                    // the model and pk are empty and reloadBrowser doesn't really\n                    // do anything - so here we specifically force the data\n                    // to be the data about the page and not the model\n                    var parent = window.parent ? window.parent : window;\n                    var data = {\n                        // FIXME shouldn't be hardcoded\n                        model: 'cms.page',\n                        pk: parent.CMS.config.request.page_id };\n\n\n                    Helpers.reloadBrowser('REFRESH_PAGE', false, true, data);\n                }\n            }).fail(function (error) {\n                that.showError(error.statusText);\n            });\n        });\n    },\n\n    /**\n        * Sets events for the search on the header.\n        *\n        * @method _setupSearch\n        * @private\n        */\n    _setupSearch: function _setupSearch() {\n        var that = this;\n        var click = this.click + '.search';\n\n        var filterActive = false;\n        var filterTrigger = this.ui.container.find('.js-cms-pagetree-header-filter-trigger');\n        var filterContainer = this.ui.container.find('.js-cms-pagetree-header-filter-container');\n        var filterClose = filterContainer.find('.js-cms-pagetree-header-search-close');\n        var filterClass = 'cms-pagetree-header-filter-active';\n        var pageTreeHeader = $('.cms-pagetree-header');\n\n        var visibleForm = this.ui.container.find('.js-cms-pagetree-header-search');\n        var hiddenForm = this.ui.container.find('.js-cms-pagetree-header-search-copy form');\n\n        var searchContainer = this.ui.container.find('.cms-pagetree-header-filter');\n        var searchField = searchContainer.find('#field-searchbar');\n        var timeout = 200;\n\n        // add active class when focusing the search field\n        searchField.on('focus', function (e) {\n            e.stopImmediatePropagation();\n            pageTreeHeader.addClass(filterClass);\n        });\n        searchField.on('blur', function (e) {\n            e.stopImmediatePropagation();\n            // timeout is required to prevent the search field from jumping\n            // between enlarging and shrinking\n            setTimeout(function () {\n                if (!filterActive) {\n                    pageTreeHeader.removeClass(filterClass);\n                }\n            }, timeout);\n            that.ui.document.off(click);\n        });\n\n        // shows/hides filter box\n        filterTrigger.add(filterClose).on(click, function (e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if (filterActive) {\n                filterContainer.hide();\n                pageTreeHeader.removeClass(filterClass);\n                that.ui.document.off(click);\n                filterActive = false;\n            } else {\n                filterContainer.show();\n                pageTreeHeader.addClass(filterClass);\n                that.ui.document.on(click, function () {\n                    filterActive = true;\n                    filterTrigger.trigger(click);\n                });\n                filterActive = true;\n            }\n        });\n\n        // prevent closing when on filter container\n        filterContainer.on('click', function (e) {\n            e.stopImmediatePropagation();\n        });\n\n        // add hidden fields to the form to maintain filter params\n        visibleForm.append(hiddenForm.find('input[type=\"hidden\"]'));\n    },\n\n    /**\n        * Shows paste helpers.\n        *\n        * @method _enablePaste\n        * @param {String} [selector=this.options.pasteSelector] jquery selector\n        * @private\n        */\n    _enablePaste: function _enablePaste(selector) {\n        var sel = typeof selector === 'undefined' ?\n        this.options.pasteSelector :\n        selector + ' ' + this.options.pasteSelector;\n        var dropdownSel = '.js-cms-pagetree-actions-dropdown';\n\n        if (typeof selector !== 'undefined') {\n            dropdownSel = selector + ' .js-cms-pagetree-actions-dropdown';\n        }\n\n        // helpers are generated on the fly, so we need to reference\n        // them every single time\n        $(sel).removeClass('cms-pagetree-dropdown-item-disabled');\n\n        var data = {};\n\n        if (this.clipboard.type === 'cut') {\n            data.has_cut = true;\n        } else {\n            data.has_copy = true;\n        }\n        // not loaded actions dropdown have to be updated as well\n        $(dropdownSel).data('lazyUrlData', data);\n    },\n\n    /**\n        * Hides paste helpers.\n        *\n        * @method _disablePaste\n        * @param {String} [selector=this.options.pasteSelector] jquery selector\n        * @private\n        */\n    _disablePaste: function _disablePaste(selector) {\n        var sel = typeof selector === 'undefined' ?\n        this.options.pasteSelector :\n        selector + ' ' + this.options.pasteSelector;\n        var dropdownSel = '.js-cms-pagetree-actions-dropdown';\n\n        if (typeof selector !== 'undefined') {\n            dropdownSel = selector + ' .js-cms-pagetree-actions-dropdown';\n        }\n\n\n        // helpers are generated on the fly, so we need to reference\n        // them every single time\n        $(sel).addClass('cms-pagetree-dropdown-item-disabled');\n\n        // not loaded actions dropdown have to be updated as well\n        $(dropdownSel).removeData('lazyUrlData');\n    },\n\n    /**\n        * Updates the current state of the helpers after `after_open.jstree`\n        * or `_cutOrCopy` is triggered.\n        *\n        * @method _updatePasteHelpersState\n        * @private\n        */\n    _updatePasteHelpersState: function _updatePasteHelpersState() {\n        var that = this;\n\n        if (this.clipboard.type && this.clipboard.id) {\n            this._enablePaste();\n        }\n\n        // hide cut element and it's descendants' paste helpers if it is visible\n        if (this.clipboard.type === 'cut' && this.clipboard.origin) {\n            var descendantIds = this._getDescendantsIds(this.clipboard.id);\n            var nodes = [this.clipboard.id];\n\n            if (descendantIds && descendantIds.length) {\n                nodes = nodes.concat(descendantIds);\n            }\n\n            nodes.forEach(function (id) {\n                that._disablePaste('.jsgrid_' + id + '_col');\n            });\n        }\n    },\n\n    /**\n        * Shows success message on node after successful action.\n        *\n        * @method _showSuccess\n        * @param {Number} id id of the element to add the success class\n        * @private\n        */\n    _showSuccess: function _showSuccess(id) {\n        var element = this.ui.tree.find('li[data-id=\"' + id + '\"]');\n\n        element.addClass('cms-tree-node-success');\n        setTimeout(function () {\n            element.removeClass('cms-tree-node-success');\n        }, this.successTimer);\n        // hide elements\n        this._disablePaste();\n        this.clipboard.id = null;\n    },\n\n    /**\n        * Checks if we should reload the iframe or entire window. For this we\n        * need to skip `CMS.API.Helpers.reloadBrowser();`.\n        *\n        * @method _reloadHelper\n        * @private\n        */\n    _reloadHelper: function _reloadHelper() {\n        if (window.self === window.top) {\n            Helpers.reloadBrowser();\n        } else {\n            window.location.reload();\n        }\n    },\n\n    /**\n        * Displays an error within the django UI.\n        *\n        * @method showError\n        * @param {String} message string message to display\n        */\n    showError: function showError(message) {\n        var messages = $('.messagelist');\n        var breadcrumb = $('.breadcrumbs');\n        var reload = this.options.lang.reload;\n        var tpl = '' +\n        '<ul class=\"messagelist\">' +\n        '   <li class=\"error\">' +\n        '       {msg} ' +\n        '       <a href=\"#reload\" class=\"cms-tree-reload\"> ' + reload + ' </a>' +\n        '   </li>' +\n        '</ul>';\n        var msg = tpl.replace('{msg}', '<strong>' + this.options.lang.error + '</strong> ' + message);\n\n        if (messages.length) {\n            messages.replaceWith(msg);\n        } else {\n            breadcrumb.after(msg);\n        }\n    },\n\n    /**\n        * @method _getDescendantsIds\n        * @private\n        * @param {String} nodeId jstree id of the node, e.g. j1_3\n        * @returns {String[]} array of ids\n        */\n    _getDescendantsIds: function _getDescendantsIds(nodeId) {\n        return this.ui.tree.jstree(true).get_node(nodeId).children_d;\n    },\n\n    /**\n        * @method _hasPermision\n        * @private\n        * @param {Object} node jstree node\n        * @param {String} permission move / add\n        * @returns {Boolean}\n        */\n    _hasPermission: function _hasPermision(node, permission) {\n        if (node.id === '#' && permission === 'add') {\n            return this.options.hasAddRootPermission;\n        } else if (node.id === '#') {\n            return false;\n        }\n\n        return node.li_attr['data-' + permission + '-permission'] === 'true';\n    } });\n\n\n// shorthand for jQuery(document).ready();\n$(function () {\n    // load cms settings beforehand\n    // have to set toolbar to \"expanded\" by default\n    // otherwise initialization will be incorrect when you\n    // go first to pages and then to normal page\n    window.CMS.config = {\n        settings: {\n            toolbar: 'expanded' },\n\n        urls: {\n            settings: $('.js-cms-pagetree').data('settings-url') } };\n\n\n    window.CMS.settings = Helpers.getSettings();\n    // autoload the pagetree\n    new PageTree();\n});\n\nmodule.exports = PageTree;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vY21zL3N0YXRpYy9jbXMvanMvbW9kdWxlcy9jbXMucGFnZXRyZWUuanM/ODA4MSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IGh0dHBzOi8vZ2l0aHViLmNvbS9kaXZpby9kamFuZ28tY21zXG4gKi9cblxudmFyICQgPSByZXF1aXJlKCdqcXVlcnknKTtcblxucmVxdWlyZSgnanN0cmVlJyk7XG5yZXF1aXJlKCcuLi9saWJzL2pzdHJlZS9qc3RyZWUuZ3JpZC5taW4nKTtcblxudmFyIENsYXNzID0gcmVxdWlyZSgnY2xhc3NqcycpO1xudmFyIEhlbHBlcnMgPSByZXF1aXJlKCcuL2Ntcy5iYXNlJykuZGVmYXVsdC5BUEkuSGVscGVycztcbnZhciBLRVlTID0gcmVxdWlyZSgnLi9jbXMuYmFzZScpLmRlZmF1bHQuS0VZUztcbnZhciBQYWdlVHJlZURyb3Bkb3ducyA9IHJlcXVpcmUoJy4vY21zLnBhZ2V0cmVlLmRyb3Bkb3duJyk7XG52YXIgUGFnZVRyZWVTdGlja3lIZWFkZXIgPSByZXF1aXJlKCcuL2Ntcy5wYWdldHJlZS5zdGlja3loZWFkZXInKTtcblxuLyoqXG4gKiBUaGUgcGFnZXRyZWUgaXMgbG9hZGVkIHZpYSBgL2FkbWluL2Ntcy9wYWdlYCBhbmQgaGFzIGEgY3VzdG9tIGFkbWluXG4gKiB0ZW1wbGF0ZXMgc3RvcmVkIHdpdGhpbiBgdGVtcGxhdGVzL2FkbWluL2Ntcy9wYWdlL3RyZWVgLlxuICpcbiAqIEBjbGFzcyBQYWdlVHJlZVxuICogQG5hbWVzcGFjZSBDTVNcbiAqL1xudmFyIFBhZ2VUcmVlID0gbmV3IENsYXNzKHtcbiAgICBvcHRpb25zOiB7XG4gICAgICAgIHBhc3RlU2VsZWN0b3I6ICcuanMtY21zLXRyZWUtaXRlbS1wYXN0ZSdcbiAgICB9LFxuICAgIC8vIFRPRE8gYWRkIG1lY2hhbmljcyB0byBzZXQgdGhlIGhvbWUgcGFnZVxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykge1xuICAgICAgICAvLyBvcHRpb25zIGFyZSBsb2FkZWQgZnJvbSB0aGUgcGFnZXRyZWUgaHRtbCBub2RlXG4gICAgICAgIHZhciBvcHRzID0gJCgnLmpzLWNtcy1wYWdldHJlZScpLmRhdGEoJ2pzb24nKTtcblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5vcHRpb25zLCBvcHRzLCBvcHRpb25zKTtcblxuICAgICAgICAvLyBzdGF0ZXMgYW5kIGV2ZW50c1xuICAgICAgICB0aGlzLmNsaWNrID0gJ2NsaWNrLmNtcy5wYWdldHJlZSc7XG4gICAgICAgIHRoaXMuY2xpcGJvYXJkID0ge1xuICAgICAgICAgICAgaWQ6IG51bGwsXG4gICAgICAgICAgICBvcmlnaW46IG51bGwsXG4gICAgICAgICAgICB0eXBlOiAnJ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnN1Y2Nlc3NUaW1lciA9IDEwMDA7XG5cbiAgICAgICAgLy8gZWxlbWVudHNcbiAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICB0aGlzLl9ldmVudHMoKTtcblxuICAgICAgICAvLyBjYW5jZWwgaWYgcGFnZXRyZWUgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgICBpZiAoISQuaXNFbXB0eU9iamVjdChvcHRzKSkge1xuICAgICAgICAgICAgdGhpcy5fc2V0dXAoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTdG9yZXMgYWxsIGpRdWVyeSByZWZlcmVuY2VzIHdpdGhpbiBgdGhpcy51aWAuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHZhciBwYWdldHJlZSA9ICQoJy5jbXMtcGFnZXRyZWUnKTtcblxuICAgICAgICB0aGlzLnVpID0ge1xuICAgICAgICAgICAgY29udGFpbmVyOiBwYWdldHJlZSxcbiAgICAgICAgICAgIGRvY3VtZW50OiAkKGRvY3VtZW50KSxcbiAgICAgICAgICAgIHRyZWU6IHBhZ2V0cmVlLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUnKSxcbiAgICAgICAgICAgIGRpYWxvZzogJCgnLmpzLWNtcy10cmVlLWRpYWxvZycpLFxuICAgICAgICAgICAgc2l0ZUZvcm06ICQoJy5qcy1jbXMtcGFnZXRyZWUtc2l0ZS1mb3JtJylcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0dGluZyB1cCB0aGUganN0cmVlIGFuZCB0aGUgcmVsYXRlZCBjb2x1bW5zLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cDogZnVuY3Rpb24gX3NldHVwKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBjb2x1bW5zID0gW107XG4gICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICBsYW5ndWFnZTogdGhpcy5vcHRpb25zLmxhbmcuY29kZSxcbiAgICAgICAgICAgIG9wZW5Ob2RlczogW11cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGRhdGEgPSBmYWxzZTtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBhamF4IHJlcXVlc3Qgc2VuZCB0aGUgY3NyZiB0b2tlblxuICAgICAgICBIZWxwZXJzLmNzcmYodGhpcy5vcHRpb25zLmNzcmYpO1xuXG4gICAgICAgIC8vIHNldHVwIGNvbHVtbiBoZWFkaW5nc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2hhZG93XG4gICAgICAgICQuZWFjaCh0aGlzLm9wdGlvbnMuY29sdW1ucywgZnVuY3Rpb24gKGluZGV4LCBvYmopIHtcbiAgICAgICAgICAgIGlmIChvYmoua2V5ID09PSAnJykge1xuICAgICAgICAgICAgICAgIC8vIHRoZSBmaXJzdCByb3cgaXMgYWxyZWFkeSBwb3B1bGF0ZWQsIHRvIGF2b2lkIG92ZXJ3cml0ZXNcbiAgICAgICAgICAgICAgICAvLyBqdXN0IGxlYXZlIHRoZSBcImtleVwiIHBhcmFtIGVtcHR5XG4gICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBvYmoudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBvYmoud2lkdGggfHwgJzElJyxcbiAgICAgICAgICAgICAgICAgICAgd2lkZUNlbGxDbGFzczogb2JqLmNsc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IG9iai50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCBuZWVkcyB0byBoYXZlIHRoZSBcImNvbGRlXCIgZm9ybWF0IGFuZCBub3QgXCJjb2wtZGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXMganN0cmVlIHdpbGwgY29udmVydCBcImNvbC1kZVwiIHRvIFwiY29sZGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxzbyB3ZSBzdHJpcCBkYXNoZXMsIGluIGNhc2UgbGFuZ3VhZ2UgY29kZSBjb250YWlucyBpdFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZS5nLiB6aC1oYW5zLCB6aC1jbiBldGNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5kYXRhWydjb2wnICsgb2JqLmtleS5yZXBsYWNlKCctJywgJycpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogb2JqLndpZHRoIHx8ICcxJScsXG4gICAgICAgICAgICAgICAgICAgIHdpZGVDZWxsQ2xhc3M6IG9iai5jbHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJlcGFyZSBkYXRhXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLmZpbHRlcmVkKSB7XG4gICAgICAgICAgICBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5vcHRpb25zLnVybHMudHJlZSxcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gJyMnIGlzIHJlbmRlcmVkIGlmIGl0cyB0aGUgcm9vdCBub2RlLCB0aGVyZSB3ZSBvbmx5XG4gICAgICAgICAgICAgICAgICAgIC8vIGNhcmUgYWJvdXQgYG9iai5vcGVuTm9kZXNgLCBpbiB0aGUgZm9sbG93aW5nIGNhc2VcbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgYXJlIHJlcXVlc3RpbmcgYSBzcGVjaWZpYyBub2RlXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlkID09PSAnIycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdlSWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnBhZ2VJZCA9IHRoYXQuX3N0b3JlTm9kZUlkKG5vZGUuZGF0YS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHN0b3JlIHRoZSBvcGVuZWQgaXRlbXMgaW5zaWRlIHRoZSBsb2NhbHN0b3JhZ2VcbiAgICAgICAgICAgICAgICAgICAgLy8gYXMgd2UgaGF2ZSB0byBsb2FkIHRoZSBwYWdldHJlZSB3aXRoIHRoZSBwcmV2aW91cyBvcGVuZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGVcbiAgICAgICAgICAgICAgICAgICAgb2JqLm9wZW5Ob2RlcyA9IHRoYXQuX2dldFN0b3JlZE5vZGVJZHMoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHNldCB0aGUgc2l0ZSBpZCB0byBnZXQgdGhlIGNvcnJlY3QgdHJlZVxuICAgICAgICAgICAgICAgICAgICBvYmouc2l0ZSA9IHRoYXQub3B0aW9ucy5zaXRlO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGJpbmQgb3B0aW9ucyB0byB0aGUganN0cmVlIGluc3RhbmNlXG4gICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoe1xuICAgICAgICAgICAgY29yZToge1xuICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgb3Blbi9jbG9zZSBhbmltYXRpb25zXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiAwLFxuICAgICAgICAgICAgICAgIC8vIGNvcmUgc2V0dGluZyB0byBhbGxvdyBhY3Rpb25zXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgICAgICAgICAgICAgICBjaGVja19jYWxsYmFjazogZnVuY3Rpb24gKG9wZXJhdGlvbiwgbm9kZSwgbm9kZV9wYXJlbnQsIG5vZGVfcG9zaXRpb24sIG1vcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKChvcGVyYXRpb24gPT09ICdtb3ZlX25vZGUnIHx8IG9wZXJhdGlvbiA9PT0gJ2NvcHlfbm9kZScpICYmIG1vcmUgJiYgbW9yZS5wb3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb3JlLnBvcyA9PT0gJ2knKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2pzdHJlZS1tYXJrZXInKS5hZGRDbGFzcygnanN0cmVlLW1hcmtlci1jaGlsZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjanN0cmVlLW1hcmtlcicpLnJlbW92ZUNsYXNzKCdqc3RyZWUtbWFya2VyLWNoaWxkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC5faGFzUGVybWlzc2lvbihub2RlX3BhcmVudCwgJ2FkZCcpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cuanN0cmVlLmNvbS9hcGkvIy8/Zj0kLmpzdHJlZS5kZWZhdWx0cy5jb3JlLmRhdGFcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIC8vIHN0cmluZ3MgdXNlZCB3aXRoaW4ganN0cmVlIHRoYXQgYXJlIGNhbGxlZCB1c2luZyBgZ2V0X3N0cmluZ2BcbiAgICAgICAgICAgICAgICBzdHJpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgICdMb2FkaW5nIC4uLic6IHRoaXMub3B0aW9ucy5sYW5nLmxvYWRpbmcsXG4gICAgICAgICAgICAgICAgICAgICdOZXcgbm9kZSc6IHRoaXMub3B0aW9ucy5sYW5nLm5ld05vZGUsXG4gICAgICAgICAgICAgICAgICAgICdub2Rlcyc6IHRoaXMub3B0aW9ucy5sYW5nLm5vZGVzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSB3YXJuaW5ncyBhYm91dCBkcmFnZ2luZyBwYXJlbnQgaW50byBjaGlsZFxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0gSlNPTi5wYXJzZShlcnJvci5kYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuZXJyb3IgPT09ICdjaGVjaycgJiYgZXJyb3JEYXRhICYmIGVycm9yRGF0YS5jaGsgPT09ICdtb3ZlX25vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3IucmVhc29uKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRoZW1lczoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnZGphbmdvLWNtcydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgdGhlIG11bHRpIHNlbGVjdGlvbiBvZiBub2RlcyBmb3Igbm93XG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gYWN0aXZhdGUgZHJhZyBhbmQgZHJvcCBwbHVnaW5cbiAgICAgICAgICAgIHBsdWdpbnM6IFsnZG5kJywgJ3NlYXJjaCcsICdncmlkJ10sXG4gICAgICAgICAgICAvLyBodHRwczovL3d3dy5qc3RyZWUuY29tL2FwaS8jLz9mPSQuanN0cmVlLmRlZmF1bHRzLmRuZFxuICAgICAgICAgICAgZG5kOiB7XG4gICAgICAgICAgICAgICAgaW5zaWRlX3BvczogJ2xhc3QnLFxuICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgdGhlIG11bHRpIHNlbGVjdGlvbiBvZiBub2RlcyBmb3Igbm93XG4gICAgICAgICAgICAgICAgZHJhZ19zZWxlY3Rpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgZHJhZ2dpbmcgaWYgZmlsdGVyZWRcbiAgICAgICAgICAgICAgICBpc19kcmFnZ2FibGU6IGZ1bmN0aW9uIChub2Rlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC5faGFzUGVybWlzc2lvbihub2Rlc1swXSwgJ21vdmUnKSAmJiAhdGhhdC5vcHRpb25zLmZpbHRlcmVkO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGFyZ2VfZHJvcF90YXJnZXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgY29weTogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kZWl0Y2gvanN0cmVlLWdyaWRcbiAgICAgICAgICAgIGdyaWQ6IHtcbiAgICAgICAgICAgICAgICAvLyBjb2x1bW5zIGFyZSBwcm92aWRlZCBmcm9tIGJhc2UuaHRtbCBvcHRpb25zXG4gICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zXG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgYWxsIHRoZSBldmVudCBoYW5kbGVycywgc3VjaCBhcyBvcGVuaW5nIGFuZCBtb3ZpbmcuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9ldmVudHNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9ldmVudHM6IGZ1bmN0aW9uIF9ldmVudHMoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAvLyBzZXQgZXZlbnRzIGZvciB0aGUgbm9kZUlkIHVwZGF0ZXNcbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdhZnRlcl9jbG9zZS5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgZWwpIHtcbiAgICAgICAgICAgIHRoYXQuX3JlbW92ZU5vZGVJZChlbC5ub2RlLmRhdGEuaWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLnRyZWUub24oJ2FmdGVyX29wZW4uanN0cmVlJywgZnVuY3Rpb24gKGUsIGVsKSB7XG4gICAgICAgICAgICB0aGF0Ll9zdG9yZU5vZGVJZChlbC5ub2RlLmRhdGEuaWQpO1xuXG4gICAgICAgICAgICAvLyBgYWZ0ZXJfb3BlbmAgZXZlbnQgY2FuIGJlIHRyaWdnZXJlZCB3aGVuIHBhc3RpbmdcbiAgICAgICAgICAgIC8vIGlzIGluIHByb2dyZXNzIChtZWFuaW5nIHdlIGFyZSBwYXN0aW5nIGludG8gYSBsZWFmIG5vZGVcbiAgICAgICAgICAgIC8vIGluIHRoaXMgY2FzZSB3ZSBkbyBub3QgbmVlZCB0byB1cGRhdGUgaGVscGVycyBzdGF0ZVxuICAgICAgICAgICAgaWYgKHRoaXMuY2xpcGJvYXJkICYmICF0aGlzLmNsaXBib2FyZC5pc1Bhc3RpbmcpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll91cGRhdGVQYXN0ZUhlbHBlcnNTdGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdrZXlkb3duLnBhZ2V0cmVlLmFsdC1tb2RlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtFWVMuU0hJRlQpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmNvbnRhaW5lci5hZGRDbGFzcygnY21zLXBhZ2V0cmVlLWFsdC1tb2RlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudWkuZG9jdW1lbnQub24oJ2tleXVwLnBhZ2V0cmVlLmFsdC1tb2RlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtFWVMuU0hJRlQpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmNvbnRhaW5lci5yZW1vdmVDbGFzcygnY21zLXBhZ2V0cmVlLWFsdC1tb2RlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudWkuZG9jdW1lbnQub24oJ2RuZF9zdGFydC52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGRhdGEuZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgbm9kZSA9IGVsZW1lbnQucGFyZW50KCk7XG5cbiAgICAgICAgICAgIHRoYXQuX2Ryb3Bkb3ducy5jbG9zZUFsbERyb3Bkb3ducygpO1xuXG4gICAgICAgICAgICBub2RlLmFkZENsYXNzKCdqc3RyZWUtaXMtZHJhZ2dpbmcnKTtcbiAgICAgICAgICAgIGRhdGEuZGF0YS5ub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVzY2VuZGFudElkcyA9IHRoYXQuX2dldERlc2NlbmRhbnRzSWRzKG5vZGVJZCk7XG5cbiAgICAgICAgICAgICAgICBbbm9kZUlkXS5jb25jYXQoZGVzY2VuZGFudElkcykuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmpzZ3JpZF8nICsgaWQgKyAnX2NvbCcpLmFkZENsYXNzKCdqc3RyZWUtaXMtZHJhZ2dpbmcnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIW5vZGUuaGFzQ2xhc3MoJ2pzdHJlZS1sZWFmJykpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmhlbHBlci5hZGRDbGFzcygnaXMtc3RhY2tlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgaXNDb3B5Q2xhc3NBZGRlZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudWkuZG9jdW1lbnQub24oJ2RuZF9tb3ZlLnZha2F0YScsIGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICB2YXIgaXNNb3ZpbmdDb3B5ID0gZGF0YS5kYXRhLm9yaWdpbiAmJiAoXG4gICAgICAgICAgICAgICAgZGF0YS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHkgfHxcbiAgICAgICAgICAgICAgICAgICAgKGRhdGEuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkgJiYgKGRhdGEuZXZlbnQubWV0YUtleSB8fCBkYXRhLmV2ZW50LmN0cmxLZXkpKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKGlzTW92aW5nQ29weSkge1xuICAgICAgICAgICAgICAgIGlmICghaXNDb3B5Q2xhc3NBZGRlZCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuanN0cmVlLWlzLWRyYWdnaW5nJykuYWRkQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZy1jb3B5Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlzQ29weUNsYXNzQWRkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDb3B5Q2xhc3NBZGRlZCkge1xuICAgICAgICAgICAgICAgICQoJy5qc3RyZWUtaXMtZHJhZ2dpbmcnKS5yZW1vdmVDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nLWNvcHknKTtcbiAgICAgICAgICAgICAgICBpc0NvcHlDbGFzc0FkZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudWkuZG9jdW1lbnQub24oJ2RuZF9zdG9wLnZha2F0YScsIGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoZGF0YS5lbGVtZW50KTtcbiAgICAgICAgICAgIHZhciBub2RlID0gZWxlbWVudC5wYXJlbnQoKTtcblxuICAgICAgICAgICAgbm9kZS5yZW1vdmVDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nIGpzdHJlZS1pcy1kcmFnZ2luZy1jb3B5Jyk7XG4gICAgICAgICAgICBkYXRhLmRhdGEubm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlc2NlbmRhbnRJZHMgPSB0aGF0Ll9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpO1xuXG4gICAgICAgICAgICAgICAgW25vZGVJZF0uY29uY2F0KGRlc2NlbmRhbnRJZHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5qc2dyaWRfJyArIGlkICsgJ19jb2wnKS5yZW1vdmVDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nIGpzdHJlZS1pcy1kcmFnZ2luZy1jb3B5Jyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc3RvcmUgbW92ZWQgcG9zaXRpb24gbm9kZVxuICAgICAgICB0aGlzLnVpLnRyZWUub24oJ21vdmVfbm9kZS5qc3RyZWUgY29weV9ub2RlLmpzdHJlZScsIGZ1bmN0aW9uIChlLCBvYmopIHtcbiAgICAgICAgICAgIGlmICghdGhhdC5jbGlwYm9hcmQudHlwZSAmJiBlLnR5cGUgIT09ICdjb3B5X25vZGUnIHx8IHRoYXQuY2xpcGJvYXJkLnR5cGUgPT09ICdjdXQnKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fbW92ZU5vZGUodGhhdC5fZ2V0Tm9kZVBvc2l0aW9uKG9iaikpLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGF0LnVpLnRyZWUuanN0cmVlKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLl9oaWRlX2dyaWQoaW5zdGFuY2UuZ2V0X25vZGUob2JqLnBhcmVudCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnBhcmVudCA9PT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIHRvIHJlZnJlc2ggcGFyZW50LCBiZWNhdXNlIHJlZnJlc2ggb25seVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVmcmVzaGVzIGNoaWxkcmVuIG9mIHRoZSBub2RlLCBuZXZlciB0aGUgbm9kZSBpdHNlbGZcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnJlZnJlc2hfbm9kZShvYmoucGFyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9jb3B5Tm9kZShvYmopO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBvcGVuIHRoZSBwYXJlbnQgbm9kZSBpZiB3ZSB0cmlnZ2VyIGFuIGVsZW1lbnRcbiAgICAgICAgICAgIC8vIGlmIG5vdCBhbHJlYWR5IG9wZW5lZFxuICAgICAgICAgICAgdGhhdC51aS50cmVlLmpzdHJlZSgnb3Blbl9ub2RlJywgb2JqLnBhcmVudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNldCBldmVudCBmb3IgY3V0IGFuZCBwYXN0ZVxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCAnLmpzLWNtcy10cmVlLWl0ZW0tY3V0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoYXQuX2N1dE9yQ29weSh7IHR5cGU6ICdjdXQnLCBlbGVtZW50OiAkKHRoaXMpIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgZXZlbnQgZm9yIGN1dCBhbmQgcGFzdGVcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1pdGVtLWNvcHknLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhhdC5fY3V0T3JDb3B5KHsgdHlwZTogJ2NvcHknLCBlbGVtZW50OiAkKHRoaXMpIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhdHRhY2ggZXZlbnRzIHRvIHBhc3RlXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2Ntcy1wYWdldHJlZS1kcm9wZG93bi1pdGVtLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGF0Ll9wYXN0ZShlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYWR2YW5jZWQgc2V0dGluZ3MgbGluayBoYW5kbGluZ1xuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCAnLmpzLWNtcy10cmVlLWFkdmFuY2VkLXNldHRpbmdzJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHZhciBsaW5rID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmIChsaW5rLmRhdGEoJ3VybCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbGluay5kYXRhKCd1cmwnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZCBldmVudHMgZm9yIGVycm9yIHJlbG9hZCAobWVzc2FnZWxpc3QpXG4gICAgICAgIHRoaXMudWkuZG9jdW1lbnQub24odGhpcy5jbGljaywgJy5tZXNzYWdlbGlzdCAuY21zLXRyZWUtcmVsb2FkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBwcm9wYWdhdGUgdGhlIHNpdGVzIGRyb3Bkb3duIFwibGkgPiBhXCIgZW50cmllcyB0byB0aGUgaGlkZGVuIHNpdGVzIGZvcm1cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1zaXRlLXRyaWdnZXInKS5vbih0aGlzLmNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgLy8gcHJldmVudCBpZiBwYXJlbnQgaXMgYWN0aXZlXG4gICAgICAgICAgICBpZiAoZWwucGFyZW50KCkuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhhdC51aS5zaXRlRm9ybS5maW5kKCdzZWxlY3QnKVxuICAgICAgICAgICAgICAgIC52YWwoZWwuZGF0YSgpLmlkKS5lbmQoKS5zdWJtaXQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYWRkaXRpb25hbCBldmVudCBoYW5kbGVyc1xuICAgICAgICB0aGlzLl9zZXR1cERyb3Bkb3ducygpO1xuICAgICAgICB0aGlzLl9zZXR1cFNlYXJjaCgpO1xuXG4gICAgICAgIC8vIG1ha2Ugc3VyZSBhamF4IHBvc3QgcmVxdWVzdHMgYXJlIHdvcmtpbmdcbiAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1pdGVtLW1lbnUgYScpO1xuICAgICAgICB0aGlzLl9zZXRBamF4UG9zdCgnLmpzLWNtcy10cmVlLWxhbmctdHJpZ2dlcicpO1xuXG4gICAgICAgIHRoaXMuX3NldHVwUGFnZVZpZXcoKTtcbiAgICAgICAgdGhhdC5fc2V0dXBTdGlja3lIZWFkZXIoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGVscGVyIHRvIHByb2Nlc3MgdGhlIGN1dCBhbmQgY29weSBldmVudHMuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9jdXRPckNvcHlcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29ial1cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai50eXBlXSBlaXRoZXIgJ2N1dCcgb3IgJ2NvcHknXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvYmouZWxlbWVudF0gb3JpZ2luYXRlZCB0cmlnZ2VyIGVsZW1lbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufHZvaWR9XG4gICAgICovXG4gICAgX2N1dE9yQ29weTogZnVuY3Rpb24gX2N1dE9yQ29weShvYmopIHtcbiAgICAgICAgLy8gcHJldmVudCBhY3Rpb25zIGlmIHlvdSB0cnkgdG8gY29weSBhIHBhZ2Ugd2l0aCBhbiBhcHBob29rXG4gICAgICAgIGlmIChvYmoudHlwZSA9PT0gJ2NvcHknICYmIG9iai5lbGVtZW50LmRhdGEoKS5hcHBob29rKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dFcnJvcih0aGlzLm9wdGlvbnMubGFuZy5hcHBob29rKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBqc1RyZWVJZCA9IHRoaXMuX2dldE5vZGVJZChvYmouZWxlbWVudC5jbG9zZXN0KCcuanN0cmVlLWdyaWQtY2VsbCcpKTtcblxuICAgICAgICAvLyByZXNldHMgaWYgd2UgY2xpY2sgYWdhaW5cbiAgICAgICAgaWYgKHRoaXMuY2xpcGJvYXJkLnR5cGUgPT09IG9iai50eXBlICYmIGpzVHJlZUlkID09PSB0aGlzLmNsaXBib2FyZC5pZCkge1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQudHlwZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC5vcmlnaW4gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZVBhc3RlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC5vcmlnaW4gPSBvYmouZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuY2xpcGJvYXJkLnR5cGUgPSBvYmoudHlwZTtcbiAgICAgICAgICAgIHRoaXMuY2xpcGJvYXJkLmlkID0ganNUcmVlSWQ7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVQYXN0ZUhlbHBlcnNTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhlbHBlciB0byBwcm9jZXNzIHRoZSBwYXN0ZSBldmVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3Bhc3RlXG4gICAgICogQHBhcmFtIHskLkV2ZW50fSBldmVudCBjbGljayBldmVudFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3Bhc3RlOiBmdW5jdGlvbiBfcGFzdGUoZXZlbnQpIHtcbiAgICAgICAgLy8gaGlkZSBoZWxwZXJzIGFmdGVyIHdlIHBpY2tlZCBvbmVcbiAgICAgICAgdGhpcy5fZGlzYWJsZVBhc3RlKCk7XG5cbiAgICAgICAgdmFyIGNvcHlGcm9tSWQgPSB0aGlzLl9nZXROb2RlSWQodGhpcy5jbGlwYm9hcmQub3JpZ2luKTtcbiAgICAgICAgdmFyIGNvcHlUb0lkID0gdGhpcy5fZ2V0Tm9kZUlkKCQoZXZlbnQuY3VycmVudFRhcmdldCkpO1xuXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgnY3V0JywgY29weUZyb21JZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVpLnRyZWUuanN0cmVlKCdjb3B5JywgY29weUZyb21JZCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNsaXBib2FyZC5pc1Bhc3RpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLnVpLnRyZWUuanN0cmVlKCdwYXN0ZScsIGNvcHlUb0lkLCAnbGFzdCcpO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IG51bGw7XG4gICAgICAgIHRoaXMuY2xpcGJvYXJkLnR5cGUgPSBudWxsO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC5vcmlnaW4gPSBudWxsO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC5pc1Bhc3RpbmcgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0cmVpdmVzIGEgbGlzdCBvZiBub2RlcyBmcm9tIGxvY2FsIHN0b3JhZ2UuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9nZXRTdG9yZWROb2RlSWRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9IGxpc3Qgb2YgaWRzXG4gICAgICovXG4gICAgX2dldFN0b3JlZE5vZGVJZHM6IGZ1bmN0aW9uIF9nZXRTdG9yZWROb2RlSWRzKCkge1xuICAgICAgICByZXR1cm4gQ01TLnNldHRpbmdzLnBhZ2V0cmVlIHx8IFtdO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTdG9yZXMgYSBub2RlIGluIGxvY2FsIHN0b3JhZ2UuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zdG9yZU5vZGVJZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIHRvIGJlIHN0b3JlZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGlkIHRoYXQgaGFzIGJlZW4gc3RvcmVkXG4gICAgICovXG4gICAgX3N0b3JlTm9kZUlkOiBmdW5jdGlvbiBfc3RvcmVOb2RlSWQoaWQpIHtcbiAgICAgICAgdmFyIG51bWJlciA9IGlkO1xuICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuX2dldFN0b3JlZE5vZGVJZHMoKTtcblxuICAgICAgICAvLyBzdG9yZSB2YWx1ZSBvbmx5IGlmIGl0IGlzbid0IHRoZXJlIHlldFxuICAgICAgICBpZiAoc3RvcmFnZS5pbmRleE9mKG51bWJlcikgPT09IC0xKSB7XG4gICAgICAgICAgICBzdG9yYWdlLnB1c2gobnVtYmVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIENNUy5zZXR0aW5ncy5wYWdldHJlZSA9IHN0b3JhZ2U7XG4gICAgICAgIEhlbHBlcnMuc2V0U2V0dGluZ3MoQ01TLnNldHRpbmdzKTtcblxuICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfcmVtb3ZlTm9kZUlkXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgdG8gYmUgc3RvcmVkXG4gICAgICogQHJldHVybnMge1N0cmluZ30gaWQgdGhhdCBoYXMgYmVlbiByZW1vdmVkXG4gICAgICovXG4gICAgX3JlbW92ZU5vZGVJZDogZnVuY3Rpb24gX3JlbW92ZU5vZGVJZChpZCkge1xuICAgICAgICB2YXIgbnVtYmVyID0gaWQ7XG4gICAgICAgIHZhciBzdG9yYWdlID0gdGhpcy5fZ2V0U3RvcmVkTm9kZUlkcygpO1xuICAgICAgICB2YXIgaW5kZXggPSBzdG9yYWdlLmluZGV4T2YobnVtYmVyKTtcblxuICAgICAgICAvLyByZW1vdmUgZ2l2ZW4gaWQgZnJvbSBzdG9yYWdlXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHN0b3JhZ2Uuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIENNUy5zZXR0aW5ncy5wYWdldHJlZSA9IHN0b3JhZ2U7XG4gICAgICAgIEhlbHBlcnMuc2V0U2V0dGluZ3MoQ01TLnNldHRpbmdzKTtcblxuICAgICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBNb3ZlcyBhIG5vZGUgYWZ0ZXIgZHJhZyAmIGRyb3AuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9tb3ZlTm9kZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqXVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLmlkXSBjdXJyZW50IGVsZW1lbnQgaWQgZm9yIHVybCBtYXRjaGluZ1xuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLnRhcmdldF0gdGFyZ2V0IHNpYmxpbmcgb3IgcGFyZW50XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvYmoucG9zaXRpb25dIGVpdGhlciBgbGVmdGAsIGByaWdodGAgb3IgYGxhc3QtY2hpbGRgXG4gICAgICogQHJldHVybnMgeyQuRGVmZXJyZWR9IGFqYXggcmVxdWVzdCBvYmplY3RcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9tb3ZlTm9kZTogZnVuY3Rpb24gX21vdmVOb2RlKG9iaikge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgb2JqLnNpdGUgPSB0aGF0Lm9wdGlvbnMuc2l0ZTtcblxuICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgdXJsOiB0aGF0Lm9wdGlvbnMudXJscy5tb3ZlLnJlcGxhY2UoJ3tpZH0nLCBvYmouaWQpLFxuICAgICAgICAgICAgZGF0YTogb2JqXG4gICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhhdC5fc2hvd1N1Y2Nlc3Mob2JqLmlkKTtcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ29waWVzIGEgbm9kZSBpbnRvIHRoZSBzZWxlY3RlZCBub2RlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfY29weU5vZGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIHBhZ2Ugb2JqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY29weU5vZGU6IGZ1bmN0aW9uIF9jb3B5Tm9kZShvYmopIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgbm9kZSA9IHRoYXQuX2dldE5vZGVQb3NpdGlvbihvYmopO1xuICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgIHNpdGU6IHRoaXMub3B0aW9ucy5zaXRlLFxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byByZWZlciB0byB0aGUgb3JpZ2luYWwgaXRlbSBoZXJlLCBhcyB0aGUgY29waWVkXG4gICAgICAgICAgICAvLyBub2RlIHdpbGwgaGF2ZSBubyBkYXRhIGF0dHJpYnV0ZXMgc3RvcmVkIGF0IGl0IChub3QgYSBjbG9uZSlcbiAgICAgICAgICAgIGlkOiBvYmoub3JpZ2luYWwuZGF0YS5pZCxcbiAgICAgICAgICAgIHBvc2l0aW9uOiBub2RlLnBvc2l0aW9uXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdGFyZ2V0IHByb3ZpZGVkLCB0aGUgbm9kZSBsYW5kcyBpbiByb290XG4gICAgICAgIGlmIChub2RlLnRhcmdldCkge1xuICAgICAgICAgICAgZGF0YS50YXJnZXQgPSBub2RlLnRhcmdldDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGF0Lm9wdGlvbnMucGVybWlzc2lvbikge1xuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBsb2FkIGEgZGlhbG9nIGZpcnN0LCB0byBjaGVjayBpZiBwZXJtaXNzaW9ucyBzaG91bGRcbiAgICAgICAgICAgIC8vIGJlIGNvcGllZCBvciBub3RcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGF0Lm9wdGlvbnMudXJscy5jb3B5UGVybWlzc2lvbi5yZXBsYWNlKCd7aWR9JywgZGF0YS5pZCksXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgLy8gdGhlIGRpYWxvZyBpcyBsb2FkZWQgdmlhIHRoZSBhamF4IHJlc3BvbnMgb3JpZ2luYXRpbmcgZnJvbVxuICAgICAgICAgICAgLy8gYHRlbXBsYXRlcy9hZG1pbi9jbXMvcGFnZS90cmVlL2NvcHlfcHJlbWlzc2lvbnMuaHRtbGBcbiAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKGRpYWxvZykge1xuICAgICAgICAgICAgICAgIHRoYXQudWkuZGlhbG9nLmFwcGVuZChkaWFsb2cpO1xuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggZXZlbnRzIHRvIHRoZSBwZXJtaXNzaW9uIGRpYWxvZ1xuICAgICAgICAgICAgdGhpcy51aS5kaWFsb2cub2ZmKHRoaXMuY2xpY2ssICcuY2FuY2VsJykub24odGhpcy5jbGljaywgJy5jYW5jZWwnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUganVzdCBjb3BpZWQgbm9kZVxuICAgICAgICAgICAgICAgIHRoYXQudWkudHJlZS5qc3RyZWUoJ2RlbGV0ZV9ub2RlJywgb2JqLm5vZGUuaWQpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1jbXMtZGlhbG9nJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJCgnLmpzLWNtcy1kaWFsb2ctZGltbWVyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KS5vZmYodGhpcy5jbGljaywgJy5zdWJtaXQnKS5vbih0aGlzLmNsaWNrLCAnLnN1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHZhciBzdWJtaXRCdXR0b24gPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IHN1Ym1pdEJ1dHRvbi5jbG9zZXN0KCdmb3JtJykuc2VyaWFsaXplKCkuc3BsaXQoJyYnKTtcblxuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGZvcm0gZGF0YSBhbmQgYXR0YWNoIHRvIG9ialxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybURhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtmb3JtRGF0YVtpXS5zcGxpdCgnPScpWzBdXSA9IGZvcm1EYXRhW2ldLnNwbGl0KCc9JylbMV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhhdC5fc2F2ZUNvcGllZE5vZGUoZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3NhdmVDb3BpZWROb2RlKGRhdGEpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNlbmRzIHRoZSByZXF1ZXN0IHRvIGNvcHkgYSBub2RlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2F2ZUNvcGllZE5vZGVcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIG5vZGUgcG9zaXRpb24gaW5mb3JtYXRpb25cbiAgICAgKiBAcmV0dXJucyB7JC5EZWZlcnJlZH1cbiAgICAgKi9cbiAgICBfc2F2ZUNvcGllZE5vZGU6IGZ1bmN0aW9uIF9zYXZlQ29waWVkTm9kZShkYXRhKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAvLyBzZW5kIHRoZSByZWFsIGFqYXggcmVxdWVzdCBmb3IgY29weWluZyB0aGUgcGx1Z2luXG4gICAgICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICB1cmw6IHRoYXQub3B0aW9ucy51cmxzLmNvcHkucmVwbGFjZSgne2lkfScsIGRhdGEuaWQpLFxuICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGVsZW1lbnQgZnJvbSBhbnkgc3ViIG5vZGVzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0RWxlbWVudFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IGVsIGpRdWVyeSBub2RlIGZvcm0gd2hlcmUgdG8gc2VhcmNoXG4gICAgICogQHJldHVybnMge1N0cmluZ30ganNUcmVlIG5vZGUgZWxlbWVudCBpZFxuICAgICAqL1xuICAgIF9nZXROb2RlSWQ6IGZ1bmN0aW9uIF9nZXROb2RlSWQoZWwpIHtcbiAgICAgICAgdmFyIGNscyA9IGVsLmNsb3Nlc3QoJy5qc3RyZWUtZ3JpZC1jZWxsJykuYXR0cignY2xhc3MnKTtcblxuICAgICAgICAvLyBpZiBpdCdzIG5vdCBhIGNlbGwsIGFzc3VtZSBpdCdzIHRoZSByb290IG5vZGVcbiAgICAgICAgcmV0dXJuIGNscyA/IGNscy5yZXBsYWNlKC8uKmpzZ3JpZF8oLis/KV9jb2wuKi8sICckMScpIDogJyMnO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBuZXcgbm9kZSBwb3NpdGlvbiBhZnRlciBtb3ZpbmcuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9nZXROb2RlUG9zaXRpb25cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoganN0cmVlIG1vdmUgb2JqZWN0XG4gICAgICogQHJldHVybnMge09iamVjdH0gZXZhbHVhdGVkIG9iamVjdCB3aXRoIHBhcmFtc1xuICAgICAqL1xuICAgIF9nZXROb2RlUG9zaXRpb246IGZ1bmN0aW9uIF9nZXROb2RlUG9zaXRpb24ob2JqKSB7XG4gICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgIHZhciBub2RlID0gdGhpcy51aS50cmVlLmpzdHJlZSgnZ2V0X25vZGUnLCBvYmoubm9kZS5wYXJlbnQpO1xuXG4gICAgICAgIGRhdGEucG9zaXRpb24gPSBvYmoucG9zaXRpb247XG5cbiAgICAgICAgLy8ganN0cmVlIGluZGljYXRlcyBubyBwYXJlbnQgd2l0aCBgI2AsIGluIHRoaXMgY2FzZSB3ZSBkbyBub3RcbiAgICAgICAgLy8gbmVlZCB0byBzZXQgdGhlIHRhcmdldCBhdHRyaWJ1dGUgYXQgYWxsXG4gICAgICAgIGlmIChvYmoucGFyZW50ICE9PSAnIycpIHtcbiAgICAgICAgICAgIGRhdGEudGFyZ2V0ID0gbm9kZS5kYXRhLmlkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc29tZSBmdW5jdGlvbnMgbGlrZSBjb3B5IGNyZWF0ZSBhIG5ldyBlbGVtZW50IHdpdGggYSBuZXcgaWQsXG4gICAgICAgIC8vIGluIHRoaXMgY2FzZSB3ZSBuZWVkIHRvIHNldCBgZGF0YS5pZGAgbWFudWFsbHlcbiAgICAgICAgaWYgKG9iai5ub2RlICYmIG9iai5ub2RlLmRhdGEpIHtcbiAgICAgICAgICAgIGRhdGEuaWQgPSBvYmoubm9kZS5kYXRhLmlkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgZ2VuZXJhbCB0b29sdGlwcyB0aGF0IGNhbiBoYXZlIGEgbGlzdCBvZiBsaW5rcyBvciBjb250ZW50LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBEcm9wZG93bnNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cERyb3Bkb3duczogZnVuY3Rpb24gX3NldHVwRHJvcGRvd25zKCkge1xuICAgICAgICB0aGlzLl9kcm9wZG93bnMgPSBuZXcgUGFnZVRyZWVEcm9wZG93bnMoe1xuICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLnVpLmNvbnRhaW5lclxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBwYWdlIHZpZXcgY2xpY2suIFVzdWFsIHVzZSBjYXNlIGlzIHRoYXQgYWZ0ZXIgeW91IGNsaWNrXG4gICAgICogb24gdmlldyBwYWdlIGluIHRoZSBwYWdldHJlZSAtIHNpZGVmcmFtZSBpcyBubyBsb25nZXIgbmVlZGVkLFxuICAgICAqIHNvIHdlIGNsb3NlIGl0LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBQYWdlVmlld1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwUGFnZVZpZXc6IGZ1bmN0aW9uIF9zZXR1cFBhZ2VWaWV3KCkge1xuICAgICAgICB2YXIgd2luID0gSGVscGVycy5fZ2V0V2luZG93KCk7XG4gICAgICAgIHZhciBwYXJlbnQgPSB3aW4ucGFyZW50ID8gd2luLnBhcmVudCA6IHdpbjtcblxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCAnLmpzLWNtcy1wYWdldHJlZS1wYWdlLXZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwYXJlbnQuQ01TLkFQSS5IZWxwZXJzLnNldFNldHRpbmdzKCQuZXh0ZW5kKHRydWUsIHt9LCBDTVMuc2V0dGluZ3MsIHtcbiAgICAgICAgICAgICAgICBzaWRlZnJhbWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBoaWRkZW46IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFN0aWNreUhlYWRlclxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwU3RpY2t5SGVhZGVyOiBmdW5jdGlvbiBfc2V0dXBTdGlja3lIZWFkZXIoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB0aGF0LnVpLnRyZWUub24oJ3JlYWR5LmpzdHJlZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuaGVhZGVyID0gbmV3IFBhZ2VUcmVlU3RpY2t5SGVhZGVyKHtcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IHRoYXQudWkuY29udGFpbmVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJzIHRoZSBsaW5rcyBgaHJlZmAgYXMgYWpheCBwb3N0IHJlcXVlc3QuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zZXRBamF4UG9zdFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IHRyaWdnZXIgalF1ZXJ5IGxpbmsgdGFyZ2V0XG4gICAgICovXG4gICAgX3NldEFqYXhQb3N0OiBmdW5jdGlvbiBfc2V0QWpheFBvc3QodHJpZ2dlcikge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgdHJpZ2dlciwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICAgICAgdXJsOiAkKHRoaXMpLmF0dHIoJ2hyZWYnKVxuICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5zZWxmID09PSB3aW5kb3cudG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNpbXBseSByZWxvYWQgdGhlIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVsb2FkSGVscGVyKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgaW4gdGhlIHNpZGVmcmFtZSB3ZSBoYXZlIHRvIGFjdHVhbGx5XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIHdlIGFyZSBwdWJsaXNoaW5nIGEgcGFnZSB3ZSdyZSBjdXJyZW50bHkgaW5cbiAgICAgICAgICAgICAgICAgICAgLy8gYmVjYXVzZSBpZiB0aGUgc2x1ZyBkaWQgY2hhbmdlIHdlIHdvdWxkIG5lZWQgdG9cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gdGhhdCBuZXcgc2x1Z1xuICAgICAgICAgICAgICAgICAgICAvLyBQcm9ibGVtIGhlcmUgaXMgdGhhdCBpbiBjYXNlIG9mIHRoZSBhcHBob29rZWQgcGFnZVxuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbW9kZWwgYW5kIHBrIGFyZSBlbXB0eSBhbmQgcmVsb2FkQnJvd3NlciBkb2Vzbid0IHJlYWxseVxuICAgICAgICAgICAgICAgICAgICAvLyBkbyBhbnl0aGluZyAtIHNvIGhlcmUgd2Ugc3BlY2lmaWNhbGx5IGZvcmNlIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvIGJlIHRoZSBkYXRhIGFib3V0IHRoZSBwYWdlIGFuZCBub3QgdGhlIG1vZGVsXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSB3aW5kb3cucGFyZW50ID8gd2luZG93LnBhcmVudCA6IHdpbmRvdztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGSVhNRSBzaG91bGRuJ3QgYmUgaGFyZGNvZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogJ2Ntcy5wYWdlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBrOiBwYXJlbnQuQ01TLmNvbmZpZy5yZXF1ZXN0LnBhZ2VfaWRcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBIZWxwZXJzLnJlbG9hZEJyb3dzZXIoJ1JFRlJFU0hfUEFHRScsIGZhbHNlLCB0cnVlLCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIGV2ZW50cyBmb3IgdGhlIHNlYXJjaCBvbiB0aGUgaGVhZGVyLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBTZWFyY2hcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFNlYXJjaDogZnVuY3Rpb24gX3NldHVwU2VhcmNoKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIHZhciBjbGljayA9IHRoaXMuY2xpY2sgKyAnLnNlYXJjaCc7XG5cbiAgICAgICAgdmFyIGZpbHRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB2YXIgZmlsdGVyVHJpZ2dlciA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLWZpbHRlci10cmlnZ2VyJyk7XG4gICAgICAgIHZhciBmaWx0ZXJDb250YWluZXIgPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1maWx0ZXItY29udGFpbmVyJyk7XG4gICAgICAgIHZhciBmaWx0ZXJDbG9zZSA9IGZpbHRlckNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1zZWFyY2gtY2xvc2UnKTtcbiAgICAgICAgdmFyIGZpbHRlckNsYXNzID0gJ2Ntcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyLWFjdGl2ZSc7XG4gICAgICAgIHZhciBwYWdlVHJlZUhlYWRlciA9ICQoJy5jbXMtcGFnZXRyZWUtaGVhZGVyJyk7XG5cbiAgICAgICAgdmFyIHZpc2libGVGb3JtID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoJyk7XG4gICAgICAgIHZhciBoaWRkZW5Gb3JtID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoLWNvcHkgZm9ybScpO1xuXG4gICAgICAgIHZhciBzZWFyY2hDb250YWluZXIgPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuY21zLXBhZ2V0cmVlLWhlYWRlci1maWx0ZXInKTtcbiAgICAgICAgdmFyIHNlYXJjaEZpZWxkID0gc2VhcmNoQ29udGFpbmVyLmZpbmQoJyNmaWVsZC1zZWFyY2hiYXInKTtcbiAgICAgICAgdmFyIHRpbWVvdXQgPSAyMDA7XG5cbiAgICAgICAgLy8gYWRkIGFjdGl2ZSBjbGFzcyB3aGVuIGZvY3VzaW5nIHRoZSBzZWFyY2ggZmllbGRcbiAgICAgICAgc2VhcmNoRmllbGQub24oJ2ZvY3VzJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBwYWdlVHJlZUhlYWRlci5hZGRDbGFzcyhmaWx0ZXJDbGFzcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZWFyY2hGaWVsZC5vbignYmx1cicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgLy8gdGltZW91dCBpcyByZXF1aXJlZCB0byBwcmV2ZW50IHRoZSBzZWFyY2ggZmllbGQgZnJvbSBqdW1waW5nXG4gICAgICAgICAgICAvLyBiZXR3ZWVuIGVubGFyZ2luZyBhbmQgc2hyaW5raW5nXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlVHJlZUhlYWRlci5yZW1vdmVDbGFzcyhmaWx0ZXJDbGFzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGltZW91dCk7XG4gICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9mZihjbGljayk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNob3dzL2hpZGVzIGZpbHRlciBib3hcbiAgICAgICAgZmlsdGVyVHJpZ2dlci5hZGQoZmlsdGVyQ2xvc2UpLm9uKGNsaWNrLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJDb250YWluZXIuaGlkZSgpO1xuICAgICAgICAgICAgICAgIHBhZ2VUcmVlSGVhZGVyLnJlbW92ZUNsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9mZihjbGljayk7XG4gICAgICAgICAgICAgICAgZmlsdGVyQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlckNvbnRhaW5lci5zaG93KCk7XG4gICAgICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIuYWRkQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIHRoYXQudWkuZG9jdW1lbnQub24oY2xpY2ssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHJpZ2dlci50cmlnZ2VyKGNsaWNrKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBmaWx0ZXJBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBwcmV2ZW50IGNsb3Npbmcgd2hlbiBvbiBmaWx0ZXIgY29udGFpbmVyXG4gICAgICAgIGZpbHRlckNvbnRhaW5lci5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYWRkIGhpZGRlbiBmaWVsZHMgdG8gdGhlIGZvcm0gdG8gbWFpbnRhaW4gZmlsdGVyIHBhcmFtc1xuICAgICAgICB2aXNpYmxlRm9ybS5hcHBlbmQoaGlkZGVuRm9ybS5maW5kKCdpbnB1dFt0eXBlPVwiaGlkZGVuXCJdJykpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93cyBwYXN0ZSBoZWxwZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZW5hYmxlUGFzdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlbGVjdG9yPXRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yXSBqcXVlcnkgc2VsZWN0b3JcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9lbmFibGVQYXN0ZTogZnVuY3Rpb24gX2VuYWJsZVBhc3RlKHNlbGVjdG9yKSB7XG4gICAgICAgIHZhciBzZWwgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICd1bmRlZmluZWQnID9cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yIDpcbiAgICAgICAgICAgIHNlbGVjdG9yICsgJyAnICsgdGhpcy5vcHRpb25zLnBhc3RlU2VsZWN0b3I7XG4gICAgICAgIHZhciBkcm9wZG93blNlbCA9ICcuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBkcm9wZG93blNlbCA9IHNlbGVjdG9yICsgJyAuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaGVscGVycyBhcmUgZ2VuZXJhdGVkIG9uIHRoZSBmbHksIHNvIHdlIG5lZWQgdG8gcmVmZXJlbmNlXG4gICAgICAgIC8vIHRoZW0gZXZlcnkgc2luZ2xlIHRpbWVcbiAgICAgICAgJChzZWwpLnJlbW92ZUNsYXNzKCdjbXMtcGFnZXRyZWUtZHJvcGRvd24taXRlbS1kaXNhYmxlZCcpO1xuXG4gICAgICAgIHZhciBkYXRhID0ge307XG5cbiAgICAgICAgaWYgKHRoaXMuY2xpcGJvYXJkLnR5cGUgPT09ICdjdXQnKSB7XG4gICAgICAgICAgICBkYXRhLmhhc19jdXQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YS5oYXNfY29weSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gbm90IGxvYWRlZCBhY3Rpb25zIGRyb3Bkb3duIGhhdmUgdG8gYmUgdXBkYXRlZCBhcyB3ZWxsXG4gICAgICAgICQoZHJvcGRvd25TZWwpLmRhdGEoJ2xhenlVcmxEYXRhJywgZGF0YSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhpZGVzIHBhc3RlIGhlbHBlcnMuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9kaXNhYmxlUGFzdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlbGVjdG9yPXRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yXSBqcXVlcnkgc2VsZWN0b3JcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9kaXNhYmxlUGFzdGU6IGZ1bmN0aW9uIF9kaXNhYmxlUGFzdGUoc2VsZWN0b3IpIHtcbiAgICAgICAgdmFyIHNlbCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gJ3VuZGVmaW5lZCcgP1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnBhc3RlU2VsZWN0b3IgOlxuICAgICAgICAgICAgc2VsZWN0b3IgKyAnICcgKyB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvcjtcbiAgICAgICAgdmFyIGRyb3Bkb3duU2VsID0gJy5qcy1jbXMtcGFnZXRyZWUtYWN0aW9ucy1kcm9wZG93bic7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGRyb3Bkb3duU2VsID0gc2VsZWN0b3IgKyAnIC5qcy1jbXMtcGFnZXRyZWUtYWN0aW9ucy1kcm9wZG93bic7XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vIGhlbHBlcnMgYXJlIGdlbmVyYXRlZCBvbiB0aGUgZmx5LCBzbyB3ZSBuZWVkIHRvIHJlZmVyZW5jZVxuICAgICAgICAvLyB0aGVtIGV2ZXJ5IHNpbmdsZSB0aW1lXG4gICAgICAgICQoc2VsKS5hZGRDbGFzcygnY21zLXBhZ2V0cmVlLWRyb3Bkb3duLWl0ZW0tZGlzYWJsZWQnKTtcblxuICAgICAgICAvLyBub3QgbG9hZGVkIGFjdGlvbnMgZHJvcGRvd24gaGF2ZSB0byBiZSB1cGRhdGVkIGFzIHdlbGxcbiAgICAgICAgJChkcm9wZG93blNlbCkucmVtb3ZlRGF0YSgnbGF6eVVybERhdGEnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgaGVscGVycyBhZnRlciBgYWZ0ZXJfb3Blbi5qc3RyZWVgXG4gICAgICogb3IgYF9jdXRPckNvcHlgIGlzIHRyaWdnZXJlZC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3VwZGF0ZVBhc3RlSGVscGVyc1N0YXRlXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGU6IGZ1bmN0aW9uIF91cGRhdGVQYXN0ZUhlbHBlcnNTdGF0ZSgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlICYmIHRoaXMuY2xpcGJvYXJkLmlkKSB7XG4gICAgICAgICAgICB0aGlzLl9lbmFibGVQYXN0ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaGlkZSBjdXQgZWxlbWVudCBhbmQgaXQncyBkZXNjZW5kYW50cycgcGFzdGUgaGVscGVycyBpZiBpdCBpcyB2aXNpYmxlXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSAnY3V0JyAmJiB0aGlzLmNsaXBib2FyZC5vcmlnaW4pIHtcbiAgICAgICAgICAgIHZhciBkZXNjZW5kYW50SWRzID0gdGhpcy5fZ2V0RGVzY2VuZGFudHNJZHModGhpcy5jbGlwYm9hcmQuaWQpO1xuICAgICAgICAgICAgdmFyIG5vZGVzID0gW3RoaXMuY2xpcGJvYXJkLmlkXTtcblxuICAgICAgICAgICAgaWYgKGRlc2NlbmRhbnRJZHMgJiYgZGVzY2VuZGFudElkcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBub2RlcyA9IG5vZGVzLmNvbmNhdChkZXNjZW5kYW50SWRzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB0aGF0Ll9kaXNhYmxlUGFzdGUoJy5qc2dyaWRfJyArIGlkICsgJ19jb2wnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNob3dzIHN1Y2Nlc3MgbWVzc2FnZSBvbiBub2RlIGFmdGVyIHN1Y2Nlc3NmdWwgYWN0aW9uLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2hvd1N1Y2Nlc3NcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaWQgaWQgb2YgdGhlIGVsZW1lbnQgdG8gYWRkIHRoZSBzdWNjZXNzIGNsYXNzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2hvd1N1Y2Nlc3M6IGZ1bmN0aW9uIF9zaG93U3VjY2VzcyhpZCkge1xuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMudWkudHJlZS5maW5kKCdsaVtkYXRhLWlkPVwiJyArIGlkICsgJ1wiXScpO1xuXG4gICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2Ntcy10cmVlLW5vZGUtc3VjY2VzcycpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2Ntcy10cmVlLW5vZGUtc3VjY2VzcycpO1xuICAgICAgICB9LCB0aGlzLnN1Y2Nlc3NUaW1lcik7XG4gICAgICAgIC8vIGhpZGUgZWxlbWVudHNcbiAgICAgICAgdGhpcy5fZGlzYWJsZVBhc3RlKCk7XG4gICAgICAgIHRoaXMuY2xpcGJvYXJkLmlkID0gbnVsbDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHdlIHNob3VsZCByZWxvYWQgdGhlIGlmcmFtZSBvciBlbnRpcmUgd2luZG93LiBGb3IgdGhpcyB3ZVxuICAgICAqIG5lZWQgdG8gc2tpcCBgQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfcmVsb2FkSGVscGVyXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcmVsb2FkSGVscGVyOiBmdW5jdGlvbiBfcmVsb2FkSGVscGVyKCkge1xuICAgICAgICBpZiAod2luZG93LnNlbGYgPT09IHdpbmRvdy50b3ApIHtcbiAgICAgICAgICAgIEhlbHBlcnMucmVsb2FkQnJvd3NlcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERpc3BsYXlzIGFuIGVycm9yIHdpdGhpbiB0aGUgZGphbmdvIFVJLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBzaG93RXJyb3JcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBzdHJpbmcgbWVzc2FnZSB0byBkaXNwbGF5XG4gICAgICovXG4gICAgc2hvd0Vycm9yOiBmdW5jdGlvbiBzaG93RXJyb3IobWVzc2FnZSkge1xuICAgICAgICB2YXIgbWVzc2FnZXMgPSAkKCcubWVzc2FnZWxpc3QnKTtcbiAgICAgICAgdmFyIGJyZWFkY3J1bWIgPSAkKCcuYnJlYWRjcnVtYnMnKTtcbiAgICAgICAgdmFyIHJlbG9hZCA9IHRoaXMub3B0aW9ucy5sYW5nLnJlbG9hZDtcbiAgICAgICAgdmFyIHRwbCA9ICcnICtcbiAgICAgICAgICAgICc8dWwgY2xhc3M9XCJtZXNzYWdlbGlzdFwiPicgK1xuICAgICAgICAgICAgJyAgIDxsaSBjbGFzcz1cImVycm9yXCI+JyArXG4gICAgICAgICAgICAnICAgICAgIHttc2d9ICcgK1xuICAgICAgICAgICAgJyAgICAgICA8YSBocmVmPVwiI3JlbG9hZFwiIGNsYXNzPVwiY21zLXRyZWUtcmVsb2FkXCI+ICcgKyByZWxvYWQgKyAnIDwvYT4nICtcbiAgICAgICAgICAgICcgICA8L2xpPicgK1xuICAgICAgICAgICAgJzwvdWw+JztcbiAgICAgICAgdmFyIG1zZyA9IHRwbC5yZXBsYWNlKCd7bXNnfScsICc8c3Ryb25nPicgKyB0aGlzLm9wdGlvbnMubGFuZy5lcnJvciArICc8L3N0cm9uZz4gJyArIG1lc3NhZ2UpO1xuXG4gICAgICAgIGlmIChtZXNzYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnJlcGxhY2VXaXRoKG1zZyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBicmVhZGNydW1iLmFmdGVyKG1zZyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfZ2V0RGVzY2VuZGFudHNJZHNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBub2RlSWQganN0cmVlIGlkIG9mIHRoZSBub2RlLCBlLmcuIGoxXzNcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nW119IGFycmF5IG9mIGlkc1xuICAgICAqL1xuICAgIF9nZXREZXNjZW5kYW50c0lkczogZnVuY3Rpb24gX2dldERlc2NlbmRhbnRzSWRzKG5vZGVJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy51aS50cmVlLmpzdHJlZSh0cnVlKS5nZXRfbm9kZShub2RlSWQpLmNoaWxkcmVuX2Q7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2hhc1Blcm1pc2lvblxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG5vZGUganN0cmVlIG5vZGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGVybWlzc2lvbiBtb3ZlIC8gYWRkXG4gICAgICogQHJldHVybnMge0Jvb2xlYW59XG4gICAgICovXG4gICAgX2hhc1Blcm1pc3Npb246IGZ1bmN0aW9uIF9oYXNQZXJtaXNpb24obm9kZSwgcGVybWlzc2lvbikge1xuICAgICAgICBpZiAobm9kZS5pZCA9PT0gJyMnICYmIHBlcm1pc3Npb24gPT09ICdhZGQnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhhc0FkZFJvb3RQZXJtaXNzaW9uO1xuICAgICAgICB9IGVsc2UgaWYgKG5vZGUuaWQgPT09ICcjJykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5vZGUubGlfYXR0clsnZGF0YS0nICsgcGVybWlzc2lvbiArICctcGVybWlzc2lvbiddID09PSAndHJ1ZSc7XG4gICAgfVxufSk7XG5cbi8vIHNob3J0aGFuZCBmb3IgalF1ZXJ5KGRvY3VtZW50KS5yZWFkeSgpO1xuJChmdW5jdGlvbiAoKSB7XG4gICAgLy8gbG9hZCBjbXMgc2V0dGluZ3MgYmVmb3JlaGFuZFxuICAgIC8vIGhhdmUgdG8gc2V0IHRvb2xiYXIgdG8gXCJleHBhbmRlZFwiIGJ5IGRlZmF1bHRcbiAgICAvLyBvdGhlcndpc2UgaW5pdGlhbGl6YXRpb24gd2lsbCBiZSBpbmNvcnJlY3Qgd2hlbiB5b3VcbiAgICAvLyBnbyBmaXJzdCB0byBwYWdlcyBhbmQgdGhlbiB0byBub3JtYWwgcGFnZVxuICAgIHdpbmRvdy5DTVMuY29uZmlnID0ge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgdG9vbGJhcjogJ2V4cGFuZGVkJ1xuICAgICAgICB9LFxuICAgICAgICB1cmxzOiB7XG4gICAgICAgICAgICBzZXR0aW5nczogJCgnLmpzLWNtcy1wYWdldHJlZScpLmRhdGEoJ3NldHRpbmdzLXVybCcpXG4gICAgICAgIH1cbiAgICB9O1xuICAgIHdpbmRvdy5DTVMuc2V0dGluZ3MgPSBIZWxwZXJzLmdldFNldHRpbmdzKCk7XG4gICAgLy8gYXV0b2xvYWQgdGhlIHBhZ2V0cmVlXG4gICAgbmV3IFBhZ2VUcmVlKCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBQYWdlVHJlZTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBjbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5qcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

<<<<<<< HEAD
/***/ }
]);
<<<<<<< HEAD
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9hZG1pbi5wYWdldHJlZS5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9saWJzL2pzdHJlZS9qc3RyZWUubWluLmpzIiwid2VicGFjazovLy8uL2Ntcy9zdGF0aWMvY21zL2pzL2xpYnMvanN0cmVlL2pzdHJlZS5ncmlkLm1pbi5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5kcm9wZG93bi5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5zdGlja3loZWFkZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7QUNSQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlDQUF3Qzs7QUFFeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQixjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCLGNBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakIsY0FBYTtBQUNiLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakIsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLDhCQUE2QixnQ0FBZ0M7QUFDN0QsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSw4QkFBNkIsaUNBQWlDO0FBQzlELFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGdCQUFlLE9BQU87QUFDdEIsZ0JBQWUsT0FBTztBQUN0QjtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCLE1BQU07QUFDdkI7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixnQkFBZSxPQUFPO0FBQ3RCLGdCQUFlLE9BQU87QUFDdEIsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsV0FBVztBQUM1QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsbURBQWtELEdBQUc7QUFDckQ7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBZ0UsR0FBRztBQUNuRTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQSxjQUFhO0FBQ2I7QUFDQSxjQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGdDQUErQixxQkFBcUI7QUFDcEQ7QUFDQTs7QUFFQTtBQUNBLGNBQWE7QUFDYixVQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEIsa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtREFBa0QsR0FBRztBQUNyRDtBQUNBLFVBQVM7QUFDVDtBQUNBLFVBQVM7QUFDVDtBQUNBLFVBQVM7QUFDVCxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQixPQUFPO0FBQ3hCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVCxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpRUFBZ0U7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2IsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYixVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0EsY0FBYTtBQUNiLFVBQVM7QUFDVCxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQSxzREFBcUQ7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUIsSUFBSTtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxpQ0FBZ0MsSUFBSTs7QUFFcEM7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQixTQUFTO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUM7O0FBRUQ7Ozs7Ozs7QUM3L0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhLGFBQWEsMGVBQW9KLGVBQWUsYUFBYSxjQUFjLHlHQUF5RyxnYUFBZ2EsV0FBVyxTQUFTLFlBQVksV0FBVyxXQUFXLDJGQUEyRixXQUFXLGdCQUFnQiwrQkFBK0IsaUNBQWlDLHVCQUF1Qix5RkFBeUYsaUNBQWlDLHNDQUFzQyw2QkFBNkIsMERBQTBELDJCQUEyQixrREFBa0QsTUFBTSxRQUFRLHlCQUF5QiwwQkFBMEIsMkNBQTJDLGdDQUFnQyxrQkFBa0IsZ0VBQWdFLE9BQU8sVUFBVSxxQkFBcUIsNENBQTRDLFVBQVUsMkdBQTJHLDZCQUE2QiwyQ0FBMkMsSUFBSSx5QkFBeUIsMEVBQTBFLGlEQUFpRCxnREFBZ0QsK0lBQStJLDZCQUE2QixvREFBb0QsbUJBQW1CLHlEQUF5RCwwQkFBMEIsb0ZBQW9GLDJFQUEyRSxzRUFBc0UsMEJBQTBCLHFCQUFxQiwwQkFBMEIsMEJBQTBCLHNDQUFzQyxvQkFBb0IsYUFBYSxPQUFPLGtFQUFrRSw2Q0FBNkMsa0NBQWtDLHlFQUF5RSxXQUFXLHNuQkFBc25CLDBFQUEwRSwya0JBQTJrQixxQkFBcUIsaUJBQWlCLHFEQUFxRCxVQUFVLHdDQUF3QyxxQkFBcUIsa0lBQWtJLG9EQUFvRCxvQkFBb0IsaUJBQWlCLG9CQUFvQiw4Q0FBOEMsdUVBQXVFLHNEQUFzRCw2QkFBNkIsNEJBQTRCLElBQUksaUNBQWlDLFlBQVksNENBQTRDLDZEQUE2RCx3REFBd0QsbUJBQW1CLHNEQUFzRCwyQkFBMkIsa0VBQWtFLDBJQUEwSSwrREFBK0QsdUhBQXVILGlFQUFpRSx1RUFBdUUscUZBQXFGLFdBQVcsMEZBQTBGLGtFQUFrRSxNQUFNLHFEQUFxRCxNQUFNLCtNQUErTSxNQUFNLGtIQUFrSCxNQUFNLHNHQUFzRyx1REFBdUQsb0tBQW9LLE1BQU0sa0hBQWtILE1BQU0seUJBQXlCLE1BQU0sd0lBQXdJLE1BQU0saUdBQWlHLE1BQU0sd0RBQXdELG9EQUFvRCwrU0FBK1MsMEVBQTBFLDZEQUE2RCw4Q0FBOEMsYUFBYSwwQ0FBMEMsSUFBSSxzRUFBc0UsOENBQThDLElBQUksOEJBQThCLHdCQUF3QixpREFBaUQsRUFBRSx1QkFBdUIsV0FBVyxpREFBaUQsdUVBQXVFLDJDQUEyQyxLQUFLLE1BQU0sNklBQTZJLG9CQUFvQix5Q0FBeUMsOEVBQThFLGlCQUFpQiwyQ0FBMkMsOEVBQThFLGlCQUFpQixpREFBaUQsMkJBQTJCLDJDQUEyQyw2RUFBNkUsaUJBQWlCLDZDQUE2Qyw2RUFBNkUsa0JBQWtCLDRDQUE0QyxnQ0FBZ0MsMkxBQTJMLCtDQUErQyxnTUFBZ00sOERBQThELHlIQUF5SCwrREFBK0QscUNBQXFDLGtMQUFrTCw2Q0FBNkMsOENBQThDLElBQUksbUVBQW1FLHVDQUF1QyxvRUFBb0UsaUNBQWlDLG9FQUFvRSxtQ0FBbUMsUUFBUSxtQkFBbUIsMERBQTBELHVCQUF1QixRQUFRLG1GQUFtRiwwQkFBMEIsb0JBQW9CLDZCQUE2Qix5REFBeUQsd0JBQXdCLGlDQUFpQyxxREFBcUQseUJBQXlCLHNCQUFzQiwrQ0FBK0MsU0FBUywwQkFBMEIsdUJBQXVCLCtDQUErQyxTQUFTLDhCQUE4QiwyQkFBMkIsbURBQW1ELFNBQVMsd0JBQXdCLGtCQUFrQixNQUFNLElBQUksNkNBQTZDLHdHQUF3RywrTUFBK00sc0pBQXNKLEtBQUssaUVBQWlFLGtDQUFrQyw0R0FBNEcsU0FBUyxVQUFVLDBCQUEwQixnRkFBZ0YsYUFBYSxpREFBaUQsSUFBSSx1REFBdUQsNENBQTRDLDRCQUE0QixNQUFNLGlEQUFpRCwrQ0FBK0MsbURBQW1ELGlCQUFpQiwwQkFBMEIsTUFBTSxPQUFPLDBCQUEwQiw2QkFBNkIsaUJBQWlCLDhCQUE4QixzREFBc0QsbURBQW1ELHdCQUF3QixPQUFPLDBCQUEwQiw2QkFBNkIsc0dBQXNHLDRCQUE0QixNQUFNLGlEQUFpRCx1Q0FBdUMsdURBQXVELGlCQUFpQiwwQkFBMEIsTUFBTSxPQUFPLDhCQUE4Qiw2QkFBNkIsaUJBQWlCLE9BQU8sOEJBQThCLDZCQUE2QixhQUFhLE9BQU8sK0dBQStHLFNBQVMsb0dBQW9HLHdCQUF3Qiw4REFBOEQsOEJBQThCLDRLQUE0Syx1QkFBdUIsd0VBQXdFLHVCQUF1Qiw0Q0FBNEMsd0JBQXdCLHNEQUFzRCxxQkFBcUIsNENBQTRDLHVCQUF1QixnRUFBZ0UscUJBQXFCLHlCQUF5Qix5QkFBeUIsY0FBYyx3REFBd0Qsd0RBQXdELG1CQUFtQiw2Q0FBNkMsSUFBSSwwSEFBMEgscUNBQXFDLEVBQUUsOEJBQThCLElBQUksc0dBQXNHLHdGQUF3RixxQ0FBcUMsNERBQTRELDREQUE0RCxFQUFFLHNKQUFzSiw0RkFBNEYsMERBQTBELDRCQUE0QixJQUFJLHlEQUF5RCxLQUFLLE1BQU0sc1FBQXNRLGdCQUFnQixzQkFBc0IsV0FBVywrQkFBK0Isc0JBQXNCLHlCQUF5Qiw2QkFBNkIsbUJBQW1CLElBQUkseUhBQXlILE1BQU0sbUJBQW1CLElBQUksZ0RBQWdELHdDQUF3Qyx3QkFBd0IsdURBQXVELHFEQUFxRCwwREFBMEQsSUFBSSxnRUFBZ0UsdUNBQXVDLG1CQUFtQiw4Q0FBOEMsT0FBTyxHQUFHLDBCQUEwQixnQ0FBZ0MsMkRBQTJELGlKQUFpSix5QkFBeUIsZ0JBQWdCLGVBQWUsRUFBRSxrREFBa0QsOElBQThJLDBDQUEwQyw0RkFBNEYsZUFBZSw2R0FBNkcseUJBQXlCLGNBQWMsZUFBZSwrQkFBK0IsMEZBQTBGLGNBQWMsRUFBRSxpRkFBaUYsaUNBQWlDLDRDQUE0QywwRkFBMEYsY0FBYyxFQUFFLGdFQUFnRSx5SUFBeUksZUFBZSwrQkFBK0IsNEZBQTRGLFFBQVEsRUFBRSx1TEFBdUwseUJBQXlCLGNBQWMsZUFBZSwrQkFBK0IsNEZBQTRGLFFBQVEsRUFBRSw2TUFBNk0sZUFBZSxrQkFBa0IsMkJBQTJCLHFEQUFxRCxtQ0FBbUMsaURBQWlELG1IQUFtSCxpQ0FBaUMsd0lBQXdJLDJEQUEyRCxJQUFJLG9FQUFvRSxzQkFBc0IsaUJBQWlCLDJNQUEyTSxpREFBaUQsa0JBQWtCLHFDQUFxQyx3QkFBd0IsMEhBQTBILGNBQWMsMEhBQTBILGlCQUFpQixtQkFBbUIsNEdBQTRHLGtDQUFrQyxpQ0FBaUMsMElBQTBJLFVBQVUsTUFBTSxTQUFTLFNBQVMsY0FBYyxrREFBa0QsZ1FBQWdRLG1HQUFtRyw2R0FBNkcsdUlBQXVJLHdIQUF3SCxJQUFJLG1JQUFtSSw4RkFBOEYsbUJBQW1CLGtDQUFrQyxtQkFBbUIsb0JBQW9CLFlBQVksR0FBRyxnSkFBZ0osVUFBVSxNQUFNLFNBQVMsU0FBUyxjQUFjLGtEQUFrRCwyVEFBMlQsbUdBQW1HLDZHQUE2Ryw2TUFBNk0scUNBQXFDLDRCQUE0QixJQUFJLDhIQUE4SCw2Q0FBNkMscUxBQXFMLDJDQUEyQyxtQkFBbUIsSUFBSSxpRUFBaUUsbUJBQW1CLElBQUksc0dBQXNHLDRCQUE0QixJQUFJLCtHQUErRywyQkFBMkIsSUFBSSxvRUFBb0UsR0FBRyxxQ0FBcUMsS0FBSyxtQkFBbUIsSUFBSSxrSEFBa0gsdURBQXVELElBQUksb0VBQW9FLEdBQUcscUNBQXFDLDRGQUE0RixpQkFBaUIsd0JBQXdCLGdCQUFnQix5QkFBeUIsc0dBQXNHLDZCQUE2Qix5REFBeUQsaUdBQWlHLG1CQUFtQixJQUFJLGdGQUFnRixtQkFBbUIsSUFBSSx5REFBeUQsc0dBQXNHLHlCQUF5Qix3SEFBd0gsaURBQWlELG9CQUFvQix5RUFBeUUsNEdBQTRHLHVCQUF1QiwySEFBMkgsdUJBQXVCLElBQUkscUJBQXFCLFVBQVUsdUlBQXVJLG9OQUFvTixTQUFTLDRKQUE0SiwyQkFBMkIsd0NBQXdDLG9DQUFvQyw4QkFBOEIscUZBQXFGLFVBQVUsTUFBTSxTQUFTLFNBQVMsYUFBYSxPQUFPLDBIQUEwSCxzREFBc0Qsb0ZBQW9GLDBGQUEwRixzQ0FBc0MsMk9BQTJPLHVSQUF1Uix3UEFBd1AsbUNBQW1DLFlBQVksMEZBQTBGLDBKQUEwSixrWkFBa1osNkNBQTZDLGtDQUFrQyxnRkFBZ0YsMElBQTBJLFVBQVUsTUFBTSxTQUFTLFNBQVMsY0FBYyxrREFBa0QsZ1FBQWdRLG1HQUFtRyw2R0FBNkcsdUlBQXVJLHdIQUF3SCxJQUFJLGtLQUFrSyxxSEFBcUgsd0NBQXdDLGtDQUFrQyxrRUFBa0UsbUNBQW1DLFlBQVksR0FBRyxnSkFBZ0osVUFBVSxNQUFNLFNBQVMsU0FBUyxjQUFjLGtEQUFrRCwyVEFBMlQsbUdBQW1HLDZHQUE2Ryw2TUFBNk0scUNBQXFDLDRCQUE0QixJQUFJLHdKQUF3Siw2Q0FBNkMsMk1BQTJNLG9CQUFvQiwrS0FBK0ssbUJBQW1CLElBQUksaUhBQWlILGtZQUFrWSxRQUFRLEVBQUUsb0JBQW9CLHFEQUFxRCwyQkFBMkIsMENBQTBDLGVBQWUsK0NBQStDLGdEQUFnRCxxRkFBcUYsaUhBQWlILElBQUkseURBQXlELGtCQUFrQiwrQkFBK0Isb0hBQW9ILGVBQWUsK0NBQStDO0FBQ3RzK0Isc1BBQXFQLGlCQUFpQixzSkFBc0osMEVBQTBFLG1DQUFtQyxtREFBbUQscUJBQXFCLDJEQUEyRCwwUUFBMFEsSUFBSSx1Q0FBdUMsS0FBSyxNQUFNLCtJQUErSSxJQUFJLDJGQUEyRix1VkFBdVYsaURBQWlELDBDQUEwQywyRUFBMkUsb3ZCQUFvdkIsaUhBQWlILElBQUksd0RBQXdELGlCQUFpQiwyQkFBMkIscURBQXFELElBQUksOEdBQThHLGtCQUFrQixNQUFNLHVVQUF1VSx5RkFBeUYsMEJBQTBCLGFBQWEsMkJBQTJCLFlBQVksaUJBQWlCLCtCQUErQixJQUFJLDZCQUE2QixTQUFTLDBYQUEwWCxPQUFPLDJNQUEyTSw4Q0FBOEMsT0FBTyxFQUFFLGdDQUFnQyxPQUFPLDRMQUE0TCxPQUFPLDRCQUE0QixPQUFPLDBDQUEwQyxPQUFPLHVEQUF1RCxzQkFBc0IsZ0RBQWdELHNEQUFzRCxnQ0FBZ0Msc0JBQXNCLHdEQUF3RCxvQkFBb0IsbUJBQW1CLElBQUksa0RBQWtELGlFQUFpRSwwQkFBMEIsWUFBWSxpQkFBaUIsK0JBQStCLElBQUksNEJBQTRCLFNBQVMseUxBQXlMLE9BQU8sNE9BQTRPLHVGQUF1RixPQUFPLEVBQUUscUtBQXFLLE9BQU8sK0JBQStCLE9BQU8sT0FBTyx5QkFBeUIsUUFBUSxpQkFBaUIsK0JBQStCLElBQUksMkJBQTJCLFNBQVMscUZBQXFGLDBCQUEwQix1REFBdUQsNkVBQTZFLGNBQWMsOEJBQThCLElBQUksMkdBQTJHLGdDQUFnQyxPQUFPLEVBQUUsZ0hBQWdILCtCQUErQiwyQ0FBMkMsT0FBTyxnRUFBZ0Usc0JBQXNCLEVBQUUseUJBQXlCLHVEQUF1RCxrRkFBa0YsOEhBQThILHdCQUF3Qiw2QkFBNkIsSUFBSSxzREFBc0QsMEJBQTBCLE9BQU8sRUFBRSx5QkFBeUIsdURBQXVELHlCQUF5QixRQUFRLGlCQUFpQiwrQkFBK0IsSUFBSSwyQkFBMkIsU0FBUywrTUFBK00sT0FBTyxNQUFNLDBCQUEwQixRQUFRLGlCQUFpQiwrQkFBK0IsSUFBSSw0QkFBNEIsU0FBUyw2TUFBNk0sT0FBTyxNQUFNLHVCQUF1Qiw4Q0FBOEMseUJBQXlCLFFBQVEsaUJBQWlCLCtCQUErQixJQUFJLDRCQUE0QiwyQkFBMkIsa0tBQWtLLE9BQU8sT0FBTyx5QkFBeUIsUUFBUSxpQkFBaUIsK0JBQStCLElBQUksNEJBQTRCLDJCQUEyQixrS0FBa0ssT0FBTyxPQUFPLHNCQUFzQiw4QkFBOEIsd0dBQXdHLGtGQUFrRixRQUFRLElBQUksc0JBQXNCLDhCQUE4Qix1R0FBdUcsa0ZBQWtGLFFBQVEsSUFBSSw2QkFBNkIsZ0NBQWdDLCtCQUErQix5bkJBQXluQixtSUFBbUksbUJBQW1CLElBQUkseUtBQXlLLHdCQUF3QixxRkFBcUYsRUFBRSxnRkFBZ0YsdU5BQXVOLDhCQUE4Qiw4QkFBOEIsRUFBRSx3QkFBd0Isc0ZBQXNGLDBEQUEwRCxxSEFBcUgsc0JBQXNCLHdCQUF3Qix3Q0FBd0MsSUFBSSwwQkFBMEIsNktBQTZLLHNCQUFzQixNQUFNLCtCQUErQixZQUFZLGlCQUFpQiwrQkFBK0IsSUFBSSxpQ0FBaUMsU0FBUywyU0FBMlMsaURBQWlELDZCQUE2QixzRUFBc0UsUUFBUSwrQkFBK0IsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksaUNBQWlDLFNBQVMsb1VBQW9VLGlEQUFpRCw2QkFBNkIsd0VBQXdFLFFBQVEsd0JBQXdCLDhDQUE4Qyx1SEFBdUgsSUFBSSxxSEFBcUgsMkNBQTJDLGtDQUFrQyw2QkFBNkIsc0VBQXNFLEVBQUUsMEJBQTBCLDhDQUE4QywwQ0FBMEMsSUFBSSxxSEFBcUgsOEpBQThKLHlDQUF5Qyw2QkFBNkIsd0VBQXdFLEVBQUUseUJBQXlCLHNFQUFzRSwwQkFBMEIsNERBQTRELHdCQUF3Qix5Q0FBeUMsOEJBQThCLGdDQUFnQyxTQUFTLG1CQUFtQixJQUFJLG9CQUFvQixtQkFBbUIsSUFBSSxxQ0FBcUMsSUFBSSx3REFBd0QsS0FBSywwQ0FBMEMscUNBQXFDLHdCQUF3QixVQUFVLGlDQUFpQyxxQ0FBcUMsbUJBQW1CLElBQUksMENBQTBDLHFDQUFxQyx3QkFBd0IsVUFBVSxzQkFBc0IsT0FBTyxNQUFNLGdCQUFnQiw0REFBNEQsY0FBYyxHQUFHLHFNQUFxTSxTQUFTLHlCQUF5QixNQUFNLFdBQVcsY0FBYywwR0FBMEcsOERBQThELGlEQUFpRCx1T0FBdU8sMEZBQTBGLHVCQUF1QixnREFBZ0QsaUdBQWlHLHVFQUF1RSxtRkFBbUYsU0FBUyx1QkFBdUIsK0JBQStCLGdJQUFnSSxrQ0FBa0MseUVBQXlFLFdBQVcsNEZBQTRGLDJDQUEyQyxxY0FBcWMsaU5BQWlOLG1DQUFtQyx3QkFBd0IsOEJBQThCLEVBQUUsMEJBQTBCLHdEQUF3RCxvREFBb0Qsd0dBQXdHLGdDQUFnQyx5Q0FBeUMsd0VBQXdFLGVBQWUsRUFBRSxjQUFjLHNCQUFzQix3REFBd0Qsa0NBQWtDLHVHQUF1RyxJQUFJLDZFQUE2RSw0QkFBNEIsSUFBSSw4QkFBOEIsOEJBQThCLElBQUksNkVBQTZFLDBTQUEwUyx3QkFBd0IsS0FBSyxzQkFBc0IsNERBQTRELHdCQUF3QixRQUFRLGlCQUFpQiwrQkFBK0IsSUFBSSwwQkFBMEIsU0FBUyx3SUFBd0ksYUFBYSxTQUFTLDBCQUEwQixpREFBaUQsc0JBQXNCLE9BQU8sZ0VBQWdFLGlDQUFpQyxtQkFBbUIsb0NBQW9DLFNBQVMsS0FBSyxpSUFBaUksOE1BQThNLElBQUksK0ZBQStGLHFEQUFxRCxpQ0FBaUMsOERBQThELHVIQUF1SCw2QkFBNkIsRUFBRSxPQUFPLGlDQUFpQywwQkFBMEIsT0FBTyxtREFBbUQsWUFBWSxvRkFBb0Ysd0VBQXdFLE1BQU0seUVBQXlFLE1BQU0sNkJBQTZCLE1BQU0sK0JBQStCLE1BQU0saUJBQWlCLHdLQUF3SywrRkFBK0YscUZBQXFGLG9CQUFvQiw2REFBNkQsSUFBSSxrR0FBa0cscUNBQXFDLElBQUksZ0NBQWdDLGtIQUFrSCw2Q0FBNkMsT0FBTywyQkFBMkIsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksNkJBQTZCLFNBQVMsNkpBQTZKLG9CQUFvQiw4RUFBOEUseUJBQXlCLDRCQUE0QixpQkFBaUIsK0JBQStCLElBQUksMkJBQTJCLFNBQVMsd0RBQXdELHlLQUF5SywySEFBMkgsSUFBSSwwSEFBMEgsMEJBQTBCLEVBQUUsbUJBQW1CLElBQUksOENBQThDLEtBQUssTUFBTSw0RkFBNEYsMEJBQTBCLCtCQUErQixtQkFBbUIsNkJBQTZCLDBFQUEwRSxpQkFBaUIsSUFBSSxrQ0FBa0Msc2JBQXNiLDJCQUEyQiwwREFBMEQsNEZBQTRGLDZRQUE2USx1R0FBdUcsb0RBQW9ELEVBQUUsa0hBQWtILGlJQUFpSSxvREFBb0QsRUFBRSxzQ0FBc0Msa0dBQWtHLG9EQUFvRCxFQUFFLEtBQUssdUJBQXVCLGtDQUFrQyxtQ0FBbUMsZ0NBQWdDLDhDQUE4QyxzR0FBc0csZ0NBQWdDLEVBQUUsaUJBQWlCLGlCQUFpQixtQkFBbUIsSUFBSSwyREFBMkQsd0JBQXdCLE9BQU8sa0VBQWtFLDZhQUE2YSxvRkFBb0YsMENBQTBDLE1BQU0sMkNBQTJDLE1BQU0sNkJBQTZCLE1BQU0sK0JBQStCLE1BQU0saUJBQWlCLDZFQUE2RSwyRUFBMkUsMkVBQTJFLG9CQUFvQixrSEFBa0gsSUFBSSx1QkFBdUIsa0ZBQWtGLEtBQUssZ0VBQWdFLElBQUksS0FBSyxpRUFBaUUsSUFBSSx5Q0FBeUMseUNBQXlDLGdIQUFnSCxJQUFJLGtHQUFrRyxpQ0FBaUMsSUFBSSxnQ0FBZ0MsMk5BQTJOLElBQUksOEtBQThLLDZLQUE2Syx1REFBdUQscUpBQXFKLE9BQU8sbUNBQW1DLDBCQUEwQiw4Q0FBOEMsc0dBQXNHLGdDQUFnQyxFQUFFLGlCQUFpQixpQkFBaUIsbUJBQW1CLElBQUksMkRBQTJELHdCQUF3QixPQUFPLGtFQUFrRSxnVkFBZ1YsMENBQTBDLE1BQU0sMkNBQTJDLE1BQU0sNkJBQTZCLE1BQU0sK0JBQStCLE1BQU0saUJBQWlCLDZFQUE2RSwyRUFBMkUsMkVBQTJFLHFCQUFxQixnQ0FBZ0MsZ0JBQWdCLCtGQUErRiwwSUFBMEksb0JBQW9CLHlCQUF5QixJQUFJLGtHQUFrRyxpQ0FBaUMsSUFBSSxnQ0FBZ0MsMlNBQTJTLG9RQUFvUSxPQUFPLGlCQUFpQixxRkFBcUYsZUFBZSxtQkFBbUIsSUFBSSxtRUFBbUUsbUVBQW1FLE9BQU8sTUFBTSxrQkFBa0IscUZBQXFGLGVBQWUsbUJBQW1CLElBQUksbUVBQW1FLG9FQUFvRSxPQUFPLE1BQU0sdUJBQXVCLE9BQU8sc0JBQXNCLHNCQUFzQixzQkFBc0IscUJBQXFCLHdIQUF3SCwwQkFBMEIsMkJBQTJCLHlCQUF5Qiw0Q0FBNEMsc0JBQXNCLDJCQUEyQiwrRkFBK0YsZ0dBQWdHLHlTQUF5UyxLQUFLLDZFQUE2RSxvQ0FBb0MsMkNBQTJDLHFMQUFxTCwwQkFBMEIsZ0RBQWdELHFGQUFxRix1VEFBdVQsNkJBQTZCLDhFQUE4RSx1Q0FBdUMsMkJBQTJCLGNBQWMsa0tBQWtLLG1CQUFtQiw2QkFBNkIsdUJBQXVCLDZCQUE2QixtQkFBbUIscURBQXFELHNCQUFzQiwrQkFBK0IsS0FBSyw4UkFBOFI7QUFDN2grQiw4QkFBNkIsTUFBTSx5QkFBeUIsZUFBZSxXQUFXLG9DQUFvQyxzREFBc0QsOFlBQThZLFFBQVEsRUFBRSxzQkFBc0IsbUNBQW1DLCtCQUErQix1UUFBdVEsOEJBQThCLHNDQUFzQyx5QkFBeUIscUZBQXFGLHlCQUF5Qix3RkFBd0YsMkJBQTJCLHVFQUF1RSxzQkFBc0IscUZBQXFGLHNCQUFzQixrRkFBa0Ysd0JBQXdCLDhEQUE4RCx1QkFBdUIsdUZBQXVGLHVCQUF1QixvRkFBb0YseUJBQXlCLGlFQUFpRSx3QkFBd0IsWUFBWSxpQkFBaUIsK0JBQStCLElBQUksMEJBQTBCLFNBQVMsdXJCQUF1ckIsc0JBQXNCLDREQUE0RCx1QkFBdUIsUUFBUSxpQkFBaUIsK0JBQStCLElBQUkseUJBQXlCLFNBQVMsa0xBQWtMLHVCQUF1QixVQUFVLGlCQUFpQiwrQkFBK0IsSUFBSSx5QkFBeUIsU0FBUyw4UkFBOFIsWUFBWSxtQ0FBbUMsVUFBVSxVQUFVLElBQUksMERBQTBELG1LQUFtSyxJQUFJLG1DQUFtQyxvQkFBb0IsbUJBQW1CLElBQUksMkNBQTJDLFNBQVMscUNBQXFDLHVCQUF1QiwwQ0FBMEMscUJBQXFCLDBDQUEwQywyQ0FBMkMsaUNBQWlDLEtBQUssaUVBQWlFLFNBQVMsd0NBQXdDLFNBQVMsMkJBQTJCLFFBQVEsV0FBVyx1Q0FBdUMsV0FBVywyQkFBMkIsU0FBUyxtQkFBbUIsSUFBSSxjQUFjLDRCQUE0QixJQUFJLCtFQUErRSxtQkFBbUIsSUFBSSxpREFBaUQscUJBQXFCLHlCQUF5Qiw0QkFBNEIsOENBQThDLDJCQUEyQiw0R0FBNEcsMkZBQTJGLHlDQUF5QyxxQkFBcUIsME5BQTBOLG9QQUFvUCwrQ0FBK0Msd0VBQXdFLG9RQUFvUSx1SUFBdUksbUdBQW1HLG1EQUFtRCxtQkFBbUIsSUFBSSx5TEFBeUwscUtBQXFLLHdJQUF3SSw4REFBOEQsbUJBQW1CLElBQUksNkNBQTZDLDRGQUE0Rix3QkFBd0IsSUFBSSw4Q0FBOEMsb0NBQW9DLElBQUksOERBQThELDZHQUE2Ryx5QkFBeUIsOEJBQThCLElBQUksMEVBQTBFLDhDQUE4QyxJQUFJLEtBQUssVUFBVSwrQkFBK0IsZ0NBQWdDLElBQUksc0RBQXNELGVBQWUsMFBBQTBQLHlHQUF5RywrR0FBK0csb0tBQW9LLDRDQUE0QyxtQkFBbUIsSUFBSSxlQUFlLHdEQUF3RCxJQUFJLHFMQUFxTCx1REFBdUQsZ0NBQWdDLElBQUksc0RBQXNELGVBQWUsK01BQStNLEtBQUssMENBQTBDLHNMQUFzTCxpSEFBaUgsNERBQTRELDhCQUE4QixJQUFJLDRIQUE0SCxtSEFBbUgsaUtBQWlLLDJKQUEySixJQUFJLDhLQUE4SyxtREFBbUQsSUFBSSxnVUFBZ1UsUUFBUSxnQkFBZ0IsSUFBSSxrSUFBa0ksS0FBSywwQ0FBMEMseUxBQXlMLHNIQUFzSCxnR0FBZ0csaUVBQWlFLGdDQUFnQyxJQUFJLHNEQUFzRCx1QkFBdUIseVBBQXlQLG9EQUFvRCw4SEFBOEgsT0FBTyxtQkFBbUIsaUVBQWlFLGdDQUFnQyxJQUFJLHNEQUFzRCx1QkFBdUIseVBBQXlQLElBQUksK0JBQStCLGdDQUFnQyxJQUFJLHNEQUFzRCwwUUFBMFEsS0FBSywwQ0FBMEMsZ1NBQWdTLDJCQUEyQixRQUFRLCtCQUErQix3QkFBd0IsZ0JBQWdCLGtIQUFrSCxtQkFBbUIsSUFBSSxpRUFBaUUsSUFBSSxLQUFLLG1DQUFtQywwRkFBMEYsc0ZBQXNGLHlCQUF5QixtQkFBbUIsOEJBQThCLElBQUkscU9BQXFPLElBQUksaUdBQWlHLGdNQUFnTSxJQUFJLGlHQUFpRyw4RkFBOEYsSUFBSSw4S0FBOEssb0NBQW9DLDBDQUEwQyxzQkFBc0IsOEJBQThCLElBQUksNEdBQTRHLGtCQUFrQixNQUFNLGtRQUFrUSxrTkFBa04saUNBQWlDLGlHQUFpRyxpQ0FBaUMsOEZBQThGLG1DQUFtQyxnRkFBZ0Ysa0NBQWtDLG1CQUFtQiw4SUFBOEksbUlBQW1JLGdFQUFnRSw4QkFBOEIsSUFBSSxvSUFBb0ksU0FBUyxtQ0FBbUMsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksZ0NBQWdDLFNBQVMsb1JBQW9SLE9BQU8sUUFBUSxrQ0FBa0MsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksK0JBQStCLFNBQVMsc1JBQXNSLE9BQU8sUUFBUSxrQ0FBa0MsMmNBQTJjLHNCQUFzQixJQUFJLCtCQUErQiwyRUFBMkUsWUFBWSxpQkFBaUIsK0JBQStCLElBQUksNEJBQTRCLFNBQVMsMlBBQTJQLHFEQUFxRCxRQUFRLGlDQUFpQywwRUFBMEUsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksOEJBQThCLFNBQVMsZ1RBQWdULHFEQUFxRCxRQUFRLDJCQUEyQixpRUFBaUUsa0RBQWtELCtIQUErSCxJQUFJLDRIQUE0SCwwQ0FBMEMsc0NBQXNDLEVBQUUsNkJBQTZCLG1FQUFtRSxrREFBa0QsOENBQThDLElBQUksNEhBQTRILCtIQUErSCw2Q0FBNkMsRUFBRSw2QkFBNkIsZ0lBQWdJLDhCQUE4QiwwSEFBMEgsd0JBQXdCLHFDQUFxQyxrQ0FBa0Msd0VBQXdFLCtCQUErQixTQUFTLG1CQUFtQixJQUFJLG9CQUFvQixtQkFBbUIsSUFBSSxxQ0FBcUMsSUFBSSx3REFBd0QsS0FBSywwQ0FBMEMscUNBQXFDLHdCQUF3QixVQUFVLHFDQUFxQywyRUFBMkUsb0NBQW9DLG1CQUFtQixJQUFJLDBDQUEwQyxxQ0FBcUMsd0JBQXdCLFVBQVUsOEJBQThCLGdCQUFnQiw4SEFBOEgsSUFBSSxrS0FBa0sseUNBQXlDLDJCQUEyQix3Q0FBd0Msa0dBQWtHLDhCQUE4Qix3Q0FBd0Msa0JBQWtCLDBDQUEwQyxtQkFBbUIsV0FBVyxnQ0FBZ0MsZ0JBQWdCLEVBQUUsZ0RBQWdELFNBQVMsNEJBQTRCLGdIQUFnSCxnREFBZ0QsU0FBUyxrREFBa0QsaUNBQWlDLCtGQUErRixnQ0FBZ0MsbURBQW1ELE9BQU8sUUFBUSxzRkFBc0YsZ0VBQWdFLGtCQUFrQixvQkFBb0Isc0JBQXNCLFVBQVUsSUFBSSxHQUFHLFNBQVMsc0ZBQXNGLGdFQUFnRSxXQUFXLFNBQVMsOEZBQThGLGdFQUFnRSxtRUFBbUUsTUFBTSwrRUFBK0UsS0FBSyxzRUFBc0UsZ0VBQWdFLHVEQUF1RCxPQUFPLCtFQUErRSxnRUFBZ0UseURBQXlELFFBQVEsa0RBQWtELG1EQUFtRCxxREFBcUQsZ0VBQWdFLGlCQUFpQiw0Q0FBNEMscUJBQXFCLGtCQUFrQixtQkFBbUIsNEVBQTRFLG1MQUFtTCwrREFBK0QsbUZBQW1GLDREQUE0RCxpSUFBaUksNkNBQTZDLE9BQU8sMkNBQTJDLHlKQUF5SiwwQ0FBMEMsbUJBQW1CLDZEQUE2RCw0RUFBNEUsUUFBUSwwQkFBMEIsOEVBQThFLHlDQUF5Qyx3REFBd0QsK0ZBQStGLCtPQUErTyxnQ0FBZ0MsNkRBQTZELDBDQUEwQyx5REFBeUQsNERBQTRELG1FQUFtRSxzREFBc0QsbUVBQW1FLFFBQVEscUNBQXFDLGVBQWUsR0FBRyxhQUFhLFlBQVksa0ZBQWtGLGtCQUFrQixVQUFVLDZCQUE2QixzQkFBc0IsNENBQTRDLGtEQUFrRCwrQkFBK0IsRUFBRSxzQkFBc0IsK0VBQStFLCtDQUErQyxpQ0FBaUMseURBQXlELCtCQUErQixLQUFLLHNCQUFzQixlQUFlLDBCQUEwQixnQkFBZ0IsNkNBQTZDLHNLQUFzSyxZQUFZLDRHQUE0RywrQ0FBK0MsMFlBQTBZLDZDQUE2QywrQ0FBK0Msa1hBQWtYLFlBQVksc0JBQXNCLHNKQUFzSiwyQkFBMkIsNkNBQTZDLDRMQUE0TCwrUkFBK1Isc0JBQXNCLHlCQUF5QiwyREFBMkQsb0JBQW9CLDZEQUE2RCxNQUFNLDhGQUE4RixNQUFNLDhDQUE4QyxxZUFBcWUsYUFBYSxnSUFBZ0ksaUJBQWlCLGlKQUFpSixjQUFjLHFDQUFxQyxTQUFTLDJGQUEyRiw0VUFBNFUsbUNBQW1DLHNIQUFzSCw4QkFBOEIsaUpBQWlKLGtCQUFrQix5QkFBeUIscURBQXFELDZCQUE2Qiw2SkFBNkosK0JBQStCLFdBQVcsZ0JBQWdCLGtGQUFrRixNQUFNLG1RQUFtUSxNQUFNLDZaQUE2WixNQUFNLDhSQUE4UixNQUFNLDhaQUE4WixNQUFNLG9EQUFvRCwyQkFBMkIsbUJBQW1CLHVFQUF1RSxzREFBc0QsZ0RBQWdEO0FBQzl2K0IsRUFBQyxnREFBZ0Qsa0xBQWtMLEVBQUUsRUFBRSwyQkFBMkIsZ0xBQWdMLFFBQVEsbUNBQW1DLHdCQUF3QixxSEFBcUgsc0JBQXNCLDhNQUE4TSwwR0FBMEcsdU1BQXVNLDJMQUEyTCw2VEFBNlQsTUFBTSx1RkFBdUYsd1lBQXdZLGtCQUFrQixpQ0FBaUMsNEJBQTRCLEdBQUcsbUZBQW1GLDBEQUEwRCw0QkFBNEIsS0FBSyx1Q0FBdUMsMERBQTBELDRCQUE0QixLQUFLLFFBQVEsb0NBQW9DLDhJQUE4SSxLQUFLLGVBQWUsOEJBQThCLElBQUksNEdBQTRHLGtCQUFrQixNQUFNLGtDQUFrQyxVQUFVLGNBQWMsMkRBQTJELGdCQUFnQixnREFBZ0QsdURBQXVELDRDQUE0Qyw0S0FBNEssVUFBVSx3RkFBd0YsMmxCQUEybEIsNGFBQTRhLFVBQVUsa0VBQWtFLE1BQU0sd0tBQXdLLE1BQU0sc0VBQXNFLG1DQUFtQyxJQUFJLDBmQUEwZixpSUFBaUksT0FBTyxvQ0FBb0MsTUFBTSx5R0FBeUcsa0JBQWtCLGdCQUFnQiwwQ0FBMEMsb0VBQW9FLFFBQVEsdUJBQXVCLDZOQUE2TixpQkFBaUIsaUJBQWlCLEtBQUssbUNBQW1DLElBQUksd1JBQXdSLHNJQUFzSSxXQUFXLGVBQWUsbUNBQW1DLGdPQUFnTyw4TUFBOE0sOENBQThDLG9JQUFvSSw0Q0FBNEMsZ0RBQWdELGtCQUFrQixhQUFhLE1BQU0sOEJBQThCLElBQUksK0VBQStFLGtNQUFrTSw0SUFBNEksV0FBVyxpREFBaUQseVpBQXlaLEVBQUUsY0FBYyxlQUFlLG9DQUFvQyx3Q0FBd0MsbUJBQW1CLGlFQUFpRSxPQUFPLHFKQUFxSixjQUFjLFVBQVUsK0ZBQStGLDBCQUEwQixtRkFBbUYsaUJBQWlCLE9BQU8sK0NBQStDLG1CQUFtQixxRkFBcUYsb0pBQW9KLDBKQUEwSixxQkFBcUIseUdBQXlHLDBFQUEwRSxtQkFBbUIsdURBQXVELGlQQUFpUCx1QkFBdUIsK1hBQStYLEVBQUUsSUFBSSwyRUFBMkUsU0FBUyx5SkFBeUosVUFBVSw0TUFBNE0sMEdBQTBHLDZKQUE2SixrQkFBa0IsNldBQTZXLGVBQWUsME9BQTBPLHFIQUFxSCxzREFBc0QsK0hBQStILDhIQUE4SCxrQkFBa0IsMkJBQTJCLHNiQUFzYiw0cUJBQTRxQix1QkFBdUIsdUNBQXVDLGtCQUFrQiwyWUFBMlksa0RBQWtELDRCQUE0QixvQkFBb0IsTUFBTSxtQ0FBbUMsbUJBQW1CLEVBQUUsa0NBQWtDLDRFQUE0RSx3QkFBd0Isc0JBQXNCLHVCQUF1QixvQ0FBb0MsK0VBQStFLE9BQU8sbUJBQW1CLElBQUksc0tBQXNLLHlCQUF5QixXQUFXLDREQUE0RCxRQUFRLG1FQUFtRSxtQkFBbUIsSUFBSSwrRkFBK0YsaUNBQWlDLFFBQVEsdURBQXVELDhJQUE4SSxRQUFRLG1FQUFtRSxtQkFBbUIsSUFBSSwrRkFBK0YsaUNBQWlDLGlDQUFpQyxpQ0FBaUMsU0FBUyx3Q0FBd0MsK0JBQStCLHlDQUF5QyxzSUFBc0kseUJBQXlCLGdCQUFnQixlQUFlLDhKQUE4SiwyQkFBMkIsdUpBQXVKLHVDQUF1QyxxQkFBcUIsd1BBQXdQLHdDQUF3QyxvQ0FBb0MsdUJBQXVCLElBQUksZ0tBQWdLLElBQUksZ0hBQWdILG1KQUFtSix1REFBdUQsZ0dBQWdHLFFBQVEsbUNBQW1DLGdFQUFnRSxzREFBc0Qsc0ZBQXNGLG9NQUFvTSxxRkFBcUYsd0JBQXdCLEVBQUUsd0JBQXdCLHNCQUFzQixzRUFBc0UsNEJBQTRCLDBHQUEwRyxnRUFBZ0UsaUNBQWlDLHFGQUFxRix3QkFBd0IsRUFBRSxTQUFTLHdMQUF3TCw2Q0FBNkMsdURBQXVELFdBQVcsZ09BQWdPLFlBQVksOENBQThDLElBQUksc0dBQXNHLDhHQUE4RyxxSUFBcUksaUxBQWlMLHFJQUFxSSxvSEFBb0gsdUJBQXVCLGdGQUFnRixFQUFFLDhCQUE4QixpSEFBaUgsZ0ZBQWdGLHNJQUFzSSxxSUFBcUksb01BQW9NLG9DQUFvQyx3RkFBd0YsZUFBZSw4QkFBOEIsSUFBSSw0R0FBNEcsa0JBQWtCLE1BQU0sbUNBQW1DLFVBQVUsYUFBYSxnQ0FBZ0MsT0FBTyxjQUFjLDRGQUE0RiwrREFBK0QsMERBQTBELFFBQVEsS0FBSyxRQUFRLElBQUkscUJBQXFCLFFBQVEsSUFBSSw2QkFBNkIsU0FBUyxtQkFBbUIsMEJBQTBCLHFCQUFxQixnQkFBZ0IsdUVBQXVFLG9CQUFvQixtQkFBbUIsb0JBQW9CLHFFQUFxRSxrR0FBa0csSUFBSSxLQUFLLFFBQVEsc0RBQXNELHFGQUFxRixLQUFLLGlJQUFpSSxvQ0FBb0Msb0JBQW9CLG9CQUFvQixJQUFJLE9BQU8sc0JBQXNCLFNBQVMsU0FBUyxNQUFNLDJCQUEyQixnRUFBZ0UseUNBQXlDLDhDQUE4QyxxQ0FBcUMscUJBQXFCLHVFQUF1RSx1QkFBdUIseUVBQXlFLG1GQUFtRixxRUFBcUUscURBQXFELFFBQVEseUJBQXlCLFFBQVEsNElBQTRJLElBQUksb0NBQW9DLFNBQVMseUJBQXlCLCtIQUErSCxzQ0FBc0MscUJBQXFCLGtCQUFrQix5QkFBeUIsOERBQThELG1EQUFtRCxrQkFBa0IsWUFBWSxvQ0FBb0MsT0FBTyxxREFBcUQscUVBQXFFLFFBQVEsNEJBQTRCLE9BQU8sa0VBQWtFLGdFQUFnRSwrQkFBK0Isb0RBQW9ELFNBQVMsZ0JBQWdCLFNBQVMsU0FBUyx3TkFBd04sb0NBQW9DLG9CQUFvQixJQUFJLEVBQUUsNEJBQTRCLDZCQUE2QixzREFBc0QsZUFBZSxrQkFBa0Isa0JBQWtCLHdDQUF3QyxpQkFBaUIsc0NBQXNDLGlCQUFpQiwyQ0FBMkMsNkJBQTZCLGFBQWEsMENBQTBDLHNDQUFzQyx3QkFBd0IsUUFBUSw2T0FBNk8seUVBQXlFLDRCQUE0Qiw0RUFBNEUsc0JBQXNCLHFEQUFxRCx5RUFBeUUsbUJBQW1CLElBQUksS0FBSyxzWkFBc1oscUJBQXFCLHFKQUFxSix3R0FBd0cscUJBQXFCLHlOQUF5TixvQ0FBb0MsMEJBQTBCLCtCQUErQiw2Q0FBNkMsSUFBSSxTQUFTLElBQUksK0JBQStCLG1CQUFtQixtQ0FBbUMsSUFBSSxtTkFBbU4sbUdBQW1HLFNBQVMsOEJBQThCLGlCQUFpQix1QkFBdUIsSUFBSSxnQ0FBZ0MsU0FBUyx5TEFBeUwsZ0NBQWdDLDhDQUE4QywwREFBMEQseUVBQXlFLDBEQUEwRCx1R0FBdUcsc0lBQXNJLDRHQUE0RyxvREFBb0QsRUFBRSxJQUFJLHNJQUFzSSw4R0FBOEcsb0RBQW9ELEVBQUUsSUFBSSwrQkFBK0Isa0NBQWtDLElBQUksb0RBQW9ELHVCQUF1QixxQkFBcUIsR0FBRyx1RkFBdUYseUdBQXlHLG9EQUFvRCxFQUFFLElBQUksa0RBQWtELFVBQVUsU0FBUyw0QkFBNEIsa0NBQWtDLDBCQUEwQiwrSEFBK0gsNkJBQTZCLHdDQUF3QyxZQUFZLHdDQUF3Qyw2QkFBNkIsdUNBQXVDLGlCQUFpQiwrQkFBK0IsSUFBSSwwQkFBMEIsU0FBUywrREFBK0QsK1NBQStTLHFCQUFxQix1TkFBdU4sd0dBQXdHLHFCQUFxQiw2UUFBNlEsNEdBQTRHLHFCQUFxQix1UEFBdVAsd0dBQXdHLHFCQUFxQixrV0FBa1csVUFBVSwyQkFBMkIsMENBQTBDLHFCQUFxQix1Q0FBdUMsK0JBQStCLDhDQUE4QyxzRkFBc0YsbUdBQW1HLDRCQUE0QixJQUFJLHdFQUF3RSxpQ0FBaUMsMkJBQTJCLGlJQUFpSSxnSUFBZ0ksb0RBQW9ELEVBQUUsSUFBSSwrRUFBK0UsZ0lBQWdJLG9EQUFvRCxFQUFFLElBQUksNkVBQTZFLGdJQUFnSSxvREFBb0QsRUFBRSxJQUFJLGlIQUFpSCxnSUFBZ0ksb0RBQW9ELEVBQUUsSUFBSSxTQUFTLHNDQUFzQyxtQkFBbUIsK0ZBQStGO0FBQ2xxK0IsU0FBUSxFQUFFLHdHQUF3RyxpRUFBaUUsSUFBSSx3RUFBd0UsSUFBSSw0RUFBNEUsU0FBUyw0Q0FBNEMsNkJBQTZCLDhIQUE4SCwwQ0FBMEMscUJBQXFCLHFGQUFxRixpQkFBaUIsd0VBQXdFLHVEQUF1RCx1REFBdUQscUZBQXFGLGtEQUFrRCxxRkFBcUYsYUFBYSw0QkFBNEIsSUFBSSxzSEFBc0gsb0RBQW9ELDJIQUEySCx5RUFBeUUsa0xBQWtMLHVFQUF1RSwyQkFBMkIsbUJBQW1CLDZCQUE2QixvR0FBb0csRUFBRSwwRkFBMEYseURBQXlELDZCQUE2Qix1QkFBdUIsd0VBQXdFLEVBQUUsaUdBQWlHLHFFQUFxRSw2QkFBNkIsdUJBQXVCLHdFQUF3RSxFQUFFLGlHQUFpRyxtRkFBbUYsMkdBQTJHLGtFQUFrRSxtQ0FBbUMsUUFBUSwwQkFBMEIsNkZBQTZGLG9DQUFvQywwQ0FBMEMsc0JBQXNCLDhOQUE4TixVQUFVLDJDQUEyQywyQ0FBMkMsNkJBQTZCLE9BQU8sT0FBTyxZQUFZLEdBQUcsc01BQXNNLGlLQUFpSyxtQkFBbUIsSUFBSSxtQ0FBbUMsWUFBWSxFQUFFLGFBQWE7Ozs7Ozs7QUNUMzJIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEVBQUM7QUFDRDtBQUNBLDRDQUEyQyxRQUFRO0FBQ25EO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCLDZDQUE2QztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFtQyx5Q0FBeUM7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQSwwQkFBeUIsbUJBQW1CO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE0QyxvQkFBb0IsaUJBQWlCLGNBQWMsa0JBQWtCLFlBQVksaUJBQWlCLHFCQUFxQjtBQUNuSyxrREFBaUQsaUJBQWlCLGlCQUFpQixnQkFBZ0IsaUJBQWlCLHFCQUFxQjtBQUN6SSxrREFBaUQsa0JBQWtCLGFBQWEsYUFBYSxrQkFBa0IseUJBQXlCLGlCQUFpQixrQkFBa0Isa0JBQWtCLFdBQVc7QUFDeE0sMENBQXlDLGlCQUFpQixxQkFBcUIsMEJBQTBCO0FBQ3pHLDJEQUEwRCxVQUFVLG1CQUFtQjtBQUN2Rix1REFBc0QsMkJBQTJCO0FBQ2pGLDREQUEyRCxtQkFBbUIsYUFBYTtBQUMzRiwwREFBeUQsc0JBQXNCLHNCQUFzQjtBQUNyRyx5REFBd0Qsd0JBQXdCLHFDQUFxQztBQUNySCxnREFBK0MsWUFBWSxtQkFBbUI7QUFDOUUsbURBQWtELG1CQUFtQixvQkFBb0I7QUFDekYsbURBQWtELFdBQVcsZUFBZTtBQUM1RSwrQ0FBOEMsb0JBQW9CLG1CQUFtQjtBQUNyRiw4Q0FBNkMsYUFBYTtBQUMxRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUIsY0FBYztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBNkIscUJBQXFCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0EsY0FBYTtBQUNiO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxzRkFBcUYsZ0NBQWdDOztBQUVySDtBQUNBOztBQUVBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7O0FBRWpCLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCLGFBQWE7QUFDdEM7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0Esc0JBQXFCLGNBQWM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEwQjtBQUMxQjs7QUFFQTtBQUNBLDhDQUE2QztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXVELHNCQUFzQjtBQUM3RTtBQUNBO0FBQ0E7QUFDQSw0TEFBMkw7QUFDM0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUIsYUFBYTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJEQUEwRCxvSkFBb0o7QUFDOU07QUFDQTtBQUNBLGtDQUFpQyxjQUFjO0FBQy9DO0FBQ0EsMENBQXlDO0FBQ3pDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0RBQXVEOztBQUV2RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCOztBQUVyQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQixrQkFBa0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUIsa0JBQWtCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBb0IsTUFBTTtBQUMxQixxQkFBb0IsSUFBSTtBQUN4QixxQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0EsdUJBQXNCLGNBQWM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBc0MsUUFBUSx5R0FBeUcsRUFBRTtBQUN6SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQSxpRkFBZ0Ysd0NBQXdDO0FBQ3hIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUF5QjtBQUN6QixpREFBZ0QsOEJBQThCLEVBQUU7QUFDaEYscURBQW9ELDhCQUE4QixFQUFFO0FBQ3BGO0FBQ0E7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSxxREFBb0QsY0FBYztBQUNsRTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUE4RCw0RUFBNEU7QUFDMUk7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EscURBQW9ELCtCQUErQjtBQUNuRixxQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQSxvQ0FBbUMsaUNBQWlDO0FBQ3BFLGNBQWE7QUFDYjtBQUNBLG9DQUFtQyxtQ0FBbUM7QUFDdEUsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUIsY0FBYztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSwwQkFBeUI7QUFDekI7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBOEI7QUFDOUIsc0JBQXFCLE9BQU8sZUFBZTs7QUFFM0M7QUFDQTtBQUNBLDBDQUF5QztBQUN6Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSwwQkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQThCLCtCQUErQjtBQUM3RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUM7Ozs7Ozs7QUM3ekJEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQSx5Q0FBd0M7QUFDeEM7O0FBRUE7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQSxVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QjtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsbUJBQW1CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFDOztBQUVEOzs7Ozs7O0FDaklBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlDQUF3QztBQUN4QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBLGNBQWE7O0FBRWI7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBLGtCQUFpQixRQUFRO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQixRQUFRO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixnQkFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2IsVUFBUzs7QUFFVDtBQUNBO0FBQ0EsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBOztBQUVBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUEsRUFBQzs7QUFFRCIsImZpbGUiOiJidW5kbGUuYWRtaW4ucGFnZXRyZWUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gcG9seWZpbGxzXG5yZXF1aXJlKCcuL3BvbHlmaWxscy9mdW5jdGlvbi5wcm90b3R5cGUuYmluZC5qcycpO1xucmVxdWlyZSgnLi9saWJzL3BlcCcpO1xuXG52YXIgQ01TID0gcmVxdWlyZSgnLi9tb2R1bGVzL2Ntcy5iYXNlJyk7XG5cbndpbmRvdy5DTVMgPSBDTVM7XG5cbkNNUy5QYWdlVHJlZSA9IHJlcXVpcmUoJy4vbW9kdWxlcy9jbXMucGFnZXRyZWUnKTtcblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9jbXMvc3RhdGljL2Ntcy9qcy9hZG1pbi5wYWdldHJlZS5qc1xuICoqIG1vZHVsZSBpZCA9IDBcbiAqKiBtb2R1bGUgY2h1bmtzID0gMlxuICoqLyIsIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG52YXIgJCA9IHJlcXVpcmUoJ2pxdWVyeScpO1xuXG5yZXF1aXJlKCdqc3RyZWUnKTtcbnJlcXVpcmUoJy4uL2xpYnMvanN0cmVlL2pzdHJlZS5ncmlkLm1pbicpO1xuXG52YXIgQ2xhc3MgPSByZXF1aXJlKCdjbGFzc2pzJyk7XG52YXIgSGVscGVycyA9IHJlcXVpcmUoJy4vY21zLmJhc2UnKS5BUEkuSGVscGVycztcbnZhciBLRVlTID0gcmVxdWlyZSgnLi9jbXMuYmFzZScpLktFWVM7XG52YXIgUGFnZVRyZWVEcm9wZG93bnMgPSByZXF1aXJlKCcuL2Ntcy5wYWdldHJlZS5kcm9wZG93bicpO1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gcmVxdWlyZSgnLi9jbXMucGFnZXRyZWUuc3RpY2t5aGVhZGVyJyk7XG5cbi8qKlxuICogVGhlIHBhZ2V0cmVlIGlzIGxvYWRlZCB2aWEgYC9hZG1pbi9jbXMvcGFnZWAgYW5kIGhhcyBhIGN1c3RvbSBhZG1pblxuICogdGVtcGxhdGVzIHN0b3JlZCB3aXRoaW4gYHRlbXBsYXRlcy9hZG1pbi9jbXMvcGFnZS90cmVlYC5cbiAqXG4gKiBAY2xhc3MgUGFnZVRyZWVcbiAqIEBuYW1lc3BhY2UgQ01TXG4gKi9cbnZhciBQYWdlVHJlZSA9IG5ldyBDbGFzcyh7XG4gICAgb3B0aW9uczoge1xuICAgICAgICBwYXN0ZVNlbGVjdG9yOiAnLmpzLWNtcy10cmVlLWl0ZW0tcGFzdGUnXG4gICAgfSxcbiAgICAvLyBUT0RPIGFkZCBtZWNoYW5pY3MgdG8gc2V0IHRoZSBob21lIHBhZ2VcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgLy8gb3B0aW9ucyBhcmUgbG9hZGVkIGZyb20gdGhlIHBhZ2V0cmVlIGh0bWwgbm9kZVxuICAgICAgICB2YXIgb3B0cyA9ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdqc29uJyk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0cywgb3B0aW9ucyk7XG5cbiAgICAgICAgLy8gc3RhdGVzIGFuZCBldmVudHNcbiAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMucGFnZXRyZWUnO1xuICAgICAgICB0aGlzLmNsaXBib2FyZCA9IHtcbiAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgb3JpZ2luOiBudWxsLFxuICAgICAgICAgICAgdHlwZTogJydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdWNjZXNzVGltZXIgPSAxMDAwO1xuXG4gICAgICAgIC8vIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuX3NldHVwVUkoKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzKCk7XG5cbiAgICAgICAgLy8gY2FuY2VsIGlmIHBhZ2V0cmVlIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3Qob3B0cykpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldHVwKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU3RvcmVzIGFsbCBqUXVlcnkgcmVmZXJlbmNlcyB3aXRoaW4gYHRoaXMudWlgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICB2YXIgcGFnZXRyZWUgPSAkKCcuY21zLXBhZ2V0cmVlJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogcGFnZXRyZWUsXG4gICAgICAgICAgICBkb2N1bWVudDogJChkb2N1bWVudCksXG4gICAgICAgICAgICB0cmVlOiBwYWdldHJlZS5maW5kKCcuanMtY21zLXBhZ2V0cmVlJyksXG4gICAgICAgICAgICBkaWFsb2c6ICQoJy5qcy1jbXMtdHJlZS1kaWFsb2cnKSxcbiAgICAgICAgICAgIHNpdGVGb3JtOiAkKCcuanMtY21zLXBhZ2V0cmVlLXNpdGUtZm9ybScpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldHRpbmcgdXAgdGhlIGpzdHJlZSBhbmQgdGhlIHJlbGF0ZWQgY29sdW1ucy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXA6IGZ1bmN0aW9uIF9zZXR1cCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgY29sdW1ucyA9IFtdO1xuICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMub3B0aW9ucy5sYW5nLmNvZGUsXG4gICAgICAgICAgICBvcGVuTm9kZXM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHZhciBkYXRhID0gZmFsc2U7XG5cbiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgYWpheCByZXF1ZXN0IHNlbmQgdGhlIGNzcmYgdG9rZW5cbiAgICAgICAgSGVscGVycy5jc3JmKHRoaXMub3B0aW9ucy5jc3JmKTtcblxuICAgICAgICAvLyBzZXR1cCBjb2x1bW4gaGVhZGluZ3NcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNoYWRvd1xuICAgICAgICAkLmVhY2godGhpcy5vcHRpb25zLmNvbHVtbnMsIGZ1bmN0aW9uIChpbmRleCwgb2JqKSB7XG4gICAgICAgICAgICBpZiAob2JqLmtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGUgZmlyc3Qgcm93IGlzIGFscmVhZHkgcG9wdWxhdGVkLCB0byBhdm9pZCBvdmVyd3JpdGVzXG4gICAgICAgICAgICAgICAgLy8ganVzdCBsZWF2ZSB0aGUgXCJrZXlcIiBwYXJhbSBlbXB0eVxuICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcjogb2JqLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogb2JqLndpZHRoIHx8ICcxJScsXG4gICAgICAgICAgICAgICAgICAgIHdpZGVDZWxsQ2xhc3M6IG9iai5jbHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBvYmoudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgbmVlZHMgdG8gaGF2ZSB0aGUgXCJjb2xkZVwiIGZvcm1hdCBhbmQgbm90IFwiY29sLWRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIGpzdHJlZSB3aWxsIGNvbnZlcnQgXCJjb2wtZGVcIiB0byBcImNvbGRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsc28gd2Ugc3RyaXAgZGFzaGVzLCBpbiBjYXNlIGxhbmd1YWdlIGNvZGUgY29udGFpbnMgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGUuZy4gemgtaGFucywgemgtY24gZXRjXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZGF0YVsnY29sJyArIG9iai5rZXkucmVwbGFjZSgnLScsICcnKV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG9iai53aWR0aCB8fCAnMSUnLFxuICAgICAgICAgICAgICAgICAgICB3aWRlQ2VsbENsYXNzOiBvYmouY2xzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHByZXBhcmUgZGF0YVxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5maWx0ZXJlZCkge1xuICAgICAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMub3B0aW9ucy51cmxzLnRyZWUsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICcjJyBpcyByZW5kZXJlZCBpZiBpdHMgdGhlIHJvb3Qgbm9kZSwgdGhlcmUgd2Ugb25seVxuICAgICAgICAgICAgICAgICAgICAvLyBjYXJlIGFib3V0IGBvYmoub3Blbk5vZGVzYCwgaW4gdGhlIGZvbGxvd2luZyBjYXNlXG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIGFyZSByZXF1ZXN0aW5nIGEgc3BlY2lmaWMgbm9kZVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucGFnZUlkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdlSWQgPSB0aGF0Ll9zdG9yZU5vZGVJZChub2RlLmRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzdG9yZSB0aGUgb3BlbmVkIGl0ZW1zIGluc2lkZSB0aGUgbG9jYWxzdG9yYWdlXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzIHdlIGhhdmUgdG8gbG9hZCB0aGUgcGFnZXRyZWUgd2l0aCB0aGUgcHJldmlvdXMgb3BlbmVkXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcGVuTm9kZXMgPSB0aGF0Ll9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzZXQgdGhlIHNpdGUgaWQgdG8gZ2V0IHRoZSBjb3JyZWN0IHRyZWVcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNpdGUgPSB0aGF0Lm9wdGlvbnMuc2l0ZTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBiaW5kIG9wdGlvbnMgdG8gdGhlIGpzdHJlZSBpbnN0YW5jZVxuICAgICAgICB0aGlzLnVpLnRyZWUuanN0cmVlKHtcbiAgICAgICAgICAgIGNvcmU6IHtcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIG9wZW4vY2xvc2UgYW5pbWF0aW9uc1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMCxcbiAgICAgICAgICAgICAgICAvLyBjb3JlIHNldHRpbmcgdG8gYWxsb3cgYWN0aW9uc1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgICAgICAgICAgICAgY2hlY2tfY2FsbGJhY2s6IGZ1bmN0aW9uIChvcGVyYXRpb24sIG5vZGUsIG5vZGVfcGFyZW50LCBub2RlX3Bvc2l0aW9uLCBtb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0aW9uID09PSAnbW92ZV9ub2RlJyB8fCBvcGVyYXRpb24gPT09ICdjb3B5X25vZGUnKSAmJiBtb3JlICYmIG1vcmUucG9zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9yZS5wb3MgPT09ICdpJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNqc3RyZWUtbWFya2VyJykuYWRkQ2xhc3MoJ2pzdHJlZS1tYXJrZXItY2hpbGQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2pzdHJlZS1tYXJrZXInKS5yZW1vdmVDbGFzcygnanN0cmVlLW1hcmtlci1jaGlsZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2hhc1Blcm1pc3Npb24obm9kZV9wYXJlbnQsICdhZGQnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LmpzdHJlZS5jb20vYXBpLyMvP2Y9JC5qc3RyZWUuZGVmYXVsdHMuY29yZS5kYXRhXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAvLyBzdHJpbmdzIHVzZWQgd2l0aGluIGpzdHJlZSB0aGF0IGFyZSBjYWxsZWQgdXNpbmcgYGdldF9zdHJpbmdgXG4gICAgICAgICAgICAgICAgc3RyaW5nczoge1xuICAgICAgICAgICAgICAgICAgICAnTG9hZGluZyAuLi4nOiB0aGlzLm9wdGlvbnMubGFuZy5sb2FkaW5nLFxuICAgICAgICAgICAgICAgICAgICAnTmV3IG5vZGUnOiB0aGlzLm9wdGlvbnMubGFuZy5uZXdOb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbm9kZXMnOiB0aGlzLm9wdGlvbnMubGFuZy5ub2Rlc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgd2FybmluZ3MgYWJvdXQgZHJhZ2dpbmcgcGFyZW50IGludG8gY2hpbGRcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yRGF0YSA9IEpTT04ucGFyc2UoZXJyb3IuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmVycm9yID09PSAnY2hlY2snICYmIGVycm9yRGF0YSAmJiBlcnJvckRhdGEuY2hrID09PSAnbW92ZV9ub2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnJlYXNvbik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGVtZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2RqYW5nby1jbXMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIHRoZSBtdWx0aSBzZWxlY3Rpb24gb2Ygbm9kZXMgZm9yIG5vd1xuICAgICAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGFjdGl2YXRlIGRyYWcgYW5kIGRyb3AgcGx1Z2luXG4gICAgICAgICAgICBwbHVnaW5zOiBbJ2RuZCcsICdzZWFyY2gnLCAnZ3JpZCddLFxuICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cuanN0cmVlLmNvbS9hcGkvIy8/Zj0kLmpzdHJlZS5kZWZhdWx0cy5kbmRcbiAgICAgICAgICAgIGRuZDoge1xuICAgICAgICAgICAgICAgIGluc2lkZV9wb3M6ICdsYXN0JyxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIHRoZSBtdWx0aSBzZWxlY3Rpb24gb2Ygbm9kZXMgZm9yIG5vd1xuICAgICAgICAgICAgICAgIGRyYWdfc2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIGRyYWdnaW5nIGlmIGZpbHRlcmVkXG4gICAgICAgICAgICAgICAgaXNfZHJhZ2dhYmxlOiBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2hhc1Blcm1pc3Npb24obm9kZXNbMF0sICdtb3ZlJykgJiYgIXRoYXQub3B0aW9ucy5maWx0ZXJlZDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhcmdlX2Ryb3BfdGFyZ2V0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvcHk6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkXG4gICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgLy8gY29sdW1ucyBhcmUgcHJvdmlkZWQgZnJvbSBiYXNlLmh0bWwgb3B0aW9uc1xuICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgY29sdW1uczogY29sdW1uc1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMsIHN1Y2ggYXMgb3BlbmluZyBhbmQgbW92aW5nLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gc2V0IGV2ZW50cyBmb3IgdGhlIG5vZGVJZCB1cGRhdGVzXG4gICAgICAgIHRoaXMudWkudHJlZS5vbignYWZ0ZXJfY2xvc2UuanN0cmVlJywgZnVuY3Rpb24gKGUsIGVsKSB7XG4gICAgICAgICAgICB0aGF0Ll9yZW1vdmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdhZnRlcl9vcGVuLmpzdHJlZScsIGZ1bmN0aW9uIChlLCBlbCkge1xuICAgICAgICAgICAgdGhhdC5fc3RvcmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcblxuICAgICAgICAgICAgLy8gYGFmdGVyX29wZW5gIGV2ZW50IGNhbiBiZSB0cmlnZ2VyZWQgd2hlbiBwYXN0aW5nXG4gICAgICAgICAgICAvLyBpcyBpbiBwcm9ncmVzcyAobWVhbmluZyB3ZSBhcmUgcGFzdGluZyBpbnRvIGEgbGVhZiBub2RlXG4gICAgICAgICAgICAvLyBpbiB0aGlzIGNhc2Ugd2UgZG8gbm90IG5lZWQgdG8gdXBkYXRlIGhlbHBlcnMgc3RhdGVcbiAgICAgICAgICAgIGlmICh0aGlzLmNsaXBib2FyZCAmJiAhdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5kb2N1bWVudC5vbigna2V5ZG93bi5wYWdldHJlZS5hbHQtbW9kZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLRVlTLlNISUZUKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5jb250YWluZXIuYWRkQ2xhc3MoJ2Ntcy1wYWdldHJlZS1hbHQtbW9kZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdrZXl1cC5wYWdldHJlZS5hbHQtbW9kZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLRVlTLlNISUZUKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5jb250YWluZXIucmVtb3ZlQ2xhc3MoJ2Ntcy1wYWdldHJlZS1hbHQtbW9kZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfc3RhcnQudmFrYXRhJywgZnVuY3Rpb24gKGUsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChkYXRhLmVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIG5vZGUgPSBlbGVtZW50LnBhcmVudCgpO1xuXG4gICAgICAgICAgICB0aGF0Ll9kcm9wZG93bnMuY2xvc2VBbGxEcm9wZG93bnMoKTtcblxuICAgICAgICAgICAgbm9kZS5hZGRDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICBkYXRhLmRhdGEubm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlc2NlbmRhbnRJZHMgPSB0aGF0Ll9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpO1xuXG4gICAgICAgICAgICAgICAgW25vZGVJZF0uY29uY2F0KGRlc2NlbmRhbnRJZHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5qc2dyaWRfJyArIGlkICsgJ19jb2wnKS5hZGRDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFub2RlLmhhc0NsYXNzKCdqc3RyZWUtbGVhZicpKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5oZWxwZXIuYWRkQ2xhc3MoJ2lzLXN0YWNrZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGlzQ29weUNsYXNzQWRkZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfbW92ZS52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGlzTW92aW5nQ29weSA9IGRhdGEuZGF0YS5vcmlnaW4gJiYgKFxuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5IHx8XG4gICAgICAgICAgICAgICAgICAgIChkYXRhLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5ICYmIChkYXRhLmV2ZW50Lm1ldGFLZXkgfHwgZGF0YS5ldmVudC5jdHJsS2V5KSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChpc01vdmluZ0NvcHkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzQ29weUNsYXNzQWRkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmpzdHJlZS1pcy1kcmFnZ2luZycpLmFkZENsYXNzKCdqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgICAgICAgICBpc0NvcHlDbGFzc0FkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29weUNsYXNzQWRkZWQpIHtcbiAgICAgICAgICAgICAgICAkKCcuanN0cmVlLWlzLWRyYWdnaW5nJykucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZy1jb3B5Jyk7XG4gICAgICAgICAgICAgICAgaXNDb3B5Q2xhc3NBZGRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfc3RvcC52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGRhdGEuZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgbm9kZSA9IGVsZW1lbnQucGFyZW50KCk7XG5cbiAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZyBqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgZGF0YS5kYXRhLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkZXNjZW5kYW50SWRzID0gdGhhdC5fZ2V0RGVzY2VuZGFudHNJZHMobm9kZUlkKTtcblxuICAgICAgICAgICAgICAgIFtub2RlSWRdLmNvbmNhdChkZXNjZW5kYW50SWRzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuanNncmlkXycgKyBpZCArICdfY29sJykucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZyBqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHN0b3JlIG1vdmVkIHBvc2l0aW9uIG5vZGVcbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgb2JqKSB7XG4gICAgICAgICAgICBpZiAoIXRoYXQuY2xpcGJvYXJkLnR5cGUgJiYgZS50eXBlICE9PSAnY29weV9ub2RlJyB8fCB0aGF0LmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgICAgIHRoYXQuX21vdmVOb2RlKHRoYXQuX2dldE5vZGVQb3NpdGlvbihvYmopKS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhhdC51aS50cmVlLmpzdHJlZSh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5faGlkZV9ncmlkKGluc3RhbmNlLmdldF9ub2RlKG9iai5wYXJlbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5wYXJlbnQgPT09ICcjJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSB0byByZWZyZXNoIHBhcmVudCwgYmVjYXVzZSByZWZyZXNoIG9ubHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnJlc2hlcyBjaGlsZHJlbiBvZiB0aGUgbm9kZSwgbmV2ZXIgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoX25vZGUob2JqLnBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fY29weU5vZGUob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gb3BlbiB0aGUgcGFyZW50IG5vZGUgaWYgd2UgdHJpZ2dlciBhbiBlbGVtZW50XG4gICAgICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBvcGVuZWRcbiAgICAgICAgICAgIHRoYXQudWkudHJlZS5qc3RyZWUoJ29wZW5fbm9kZScsIG9iai5wYXJlbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgZXZlbnQgZm9yIGN1dCBhbmQgcGFzdGVcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1pdGVtLWN1dCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGF0Ll9jdXRPckNvcHkoeyB0eXBlOiAnY3V0JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc2V0IGV2ZW50IGZvciBjdXQgYW5kIHBhc3RlXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssICcuanMtY21zLXRyZWUtaXRlbS1jb3B5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoYXQuX2N1dE9yQ29weSh7IHR5cGU6ICdjb3B5JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byBwYXN0ZVxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvciwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdjbXMtcGFnZXRyZWUtZHJvcGRvd24taXRlbS1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhhdC5fcGFzdGUoZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkdmFuY2VkIHNldHRpbmdzIGxpbmsgaGFuZGxpbmdcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1hZHZhbmNlZC1zZXR0aW5ncycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgbGluayA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAobGluay5kYXRhKCd1cmwnKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGxpbmsuZGF0YSgndXJsJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhZGQgZXZlbnRzIGZvciBlcnJvciByZWxvYWQgKG1lc3NhZ2VsaXN0KVxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKHRoaXMuY2xpY2ssICcubWVzc2FnZWxpc3QgLmNtcy10cmVlLXJlbG9hZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJvcGFnYXRlIHRoZSBzaXRlcyBkcm9wZG93biBcImxpID4gYVwiIGVudHJpZXMgdG8gdGhlIGhpZGRlbiBzaXRlcyBmb3JtXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtc2l0ZS10cmlnZ2VyJykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgIC8vIHByZXZlbnQgaWYgcGFyZW50IGlzIGFjdGl2ZVxuICAgICAgICAgICAgaWYgKGVsLnBhcmVudCgpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoYXQudWkuc2l0ZUZvcm0uZmluZCgnc2VsZWN0JylcbiAgICAgICAgICAgICAgICAudmFsKGVsLmRhdGEoKS5pZCkuZW5kKCkuc3VibWl0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZGl0aW9uYWwgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgdGhpcy5fc2V0dXBEcm9wZG93bnMoKTtcbiAgICAgICAgdGhpcy5fc2V0dXBTZWFyY2goKTtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgYWpheCBwb3N0IHJlcXVlc3RzIGFyZSB3b3JraW5nXG4gICAgICAgIHRoaXMuX3NldEFqYXhQb3N0KCcuanMtY21zLXRyZWUtaXRlbS1tZW51IGEnKTtcbiAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1sYW5nLXRyaWdnZXInKTtcblxuICAgICAgICB0aGlzLl9zZXR1cFBhZ2VWaWV3KCk7XG4gICAgICAgIHRoYXQuX3NldHVwU3RpY2t5SGVhZGVyKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhlbHBlciB0byBwcm9jZXNzIHRoZSBjdXQgYW5kIGNvcHkgZXZlbnRzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfY3V0T3JDb3B5XG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmpdXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvYmoudHlwZV0gZWl0aGVyICdjdXQnIG9yICdjb3B5J1xuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLmVsZW1lbnRdIG9yaWdpbmF0ZWQgdHJpZ2dlciBlbGVtZW50XG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbnx2b2lkfVxuICAgICAqL1xuICAgIF9jdXRPckNvcHk6IGZ1bmN0aW9uIF9jdXRPckNvcHkob2JqKSB7XG4gICAgICAgIC8vIHByZXZlbnQgYWN0aW9ucyBpZiB5b3UgdHJ5IHRvIGNvcHkgYSBwYWdlIHdpdGggYW4gYXBwaG9va1xuICAgICAgICBpZiAob2JqLnR5cGUgPT09ICdjb3B5JyAmJiBvYmouZWxlbWVudC5kYXRhKCkuYXBwaG9vaykge1xuICAgICAgICAgICAgdGhpcy5zaG93RXJyb3IodGhpcy5vcHRpb25zLmxhbmcuYXBwaG9vayk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIganNUcmVlSWQgPSB0aGlzLl9nZXROb2RlSWQob2JqLmVsZW1lbnQuY2xvc2VzdCgnLmpzdHJlZS1ncmlkLWNlbGwnKSk7XG5cbiAgICAgICAgLy8gcmVzZXRzIGlmIHdlIGNsaWNrIGFnYWluXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSBvYmoudHlwZSAmJiBqc1RyZWVJZCA9PT0gdGhpcy5jbGlwYm9hcmQuaWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2xpcGJvYXJkLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQuaWQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gb2JqLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC50eXBlID0gb2JqLnR5cGU7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IGpzVHJlZUlkO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgdG8gcHJvY2VzcyB0aGUgcGFzdGUgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9wYXN0ZVxuICAgICAqIEBwYXJhbSB7JC5FdmVudH0gZXZlbnQgY2xpY2sgZXZlbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXN0ZTogZnVuY3Rpb24gX3Bhc3RlKGV2ZW50KSB7XG4gICAgICAgIC8vIGhpZGUgaGVscGVycyBhZnRlciB3ZSBwaWNrZWQgb25lXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuXG4gICAgICAgIHZhciBjb3B5RnJvbUlkID0gdGhpcy5fZ2V0Tm9kZUlkKHRoaXMuY2xpcGJvYXJkLm9yaWdpbik7XG4gICAgICAgIHZhciBjb3B5VG9JZCA9IHRoaXMuX2dldE5vZGVJZCgkKGV2ZW50LmN1cnJlbnRUYXJnZXQpKTtcblxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSA9PT0gJ2N1dCcpIHtcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoJ2N1dCcsIGNvcHlGcm9tSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgnY29weScsIGNvcHlGcm9tSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgncGFzdGUnLCBjb3B5VG9JZCwgJ2xhc3QnKTtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaWQgPSBudWxsO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC50eXBlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJldHJlaXZlcyBhIGxpc3Qgb2Ygbm9kZXMgZnJvbSBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0U3RvcmVkTm9kZUlkc1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge0FycmF5fSBsaXN0IG9mIGlkc1xuICAgICAqL1xuICAgIF9nZXRTdG9yZWROb2RlSWRzOiBmdW5jdGlvbiBfZ2V0U3RvcmVkTm9kZUlkcygpIHtcbiAgICAgICAgcmV0dXJuIENNUy5zZXR0aW5ncy5wYWdldHJlZSB8fCBbXTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU3RvcmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc3RvcmVOb2RlSWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZCB0byBiZSBzdG9yZWRcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBpZCB0aGF0IGhhcyBiZWVuIHN0b3JlZFxuICAgICAqL1xuICAgIF9zdG9yZU5vZGVJZDogZnVuY3Rpb24gX3N0b3JlTm9kZUlkKGlkKSB7XG4gICAgICAgIHZhciBudW1iZXIgPSBpZDtcbiAgICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLl9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgLy8gc3RvcmUgdmFsdWUgb25seSBpZiBpdCBpc24ndCB0aGVyZSB5ZXRcbiAgICAgICAgaWYgKHN0b3JhZ2UuaW5kZXhPZihudW1iZXIpID09PSAtMSkge1xuICAgICAgICAgICAgc3RvcmFnZS5wdXNoKG51bWJlcik7XG4gICAgICAgIH1cblxuICAgICAgICBDTVMuc2V0dGluZ3MucGFnZXRyZWUgPSBzdG9yYWdlO1xuICAgICAgICBIZWxwZXJzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG5cbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIG5vZGUgaW4gbG9jYWwgc3RvcmFnZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3JlbW92ZU5vZGVJZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIHRvIGJlIHN0b3JlZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGlkIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZFxuICAgICAqL1xuICAgIF9yZW1vdmVOb2RlSWQ6IGZ1bmN0aW9uIF9yZW1vdmVOb2RlSWQoaWQpIHtcbiAgICAgICAgdmFyIG51bWJlciA9IGlkO1xuICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuX2dldFN0b3JlZE5vZGVJZHMoKTtcbiAgICAgICAgdmFyIGluZGV4ID0gc3RvcmFnZS5pbmRleE9mKG51bWJlcik7XG5cbiAgICAgICAgLy8gcmVtb3ZlIGdpdmVuIGlkIGZyb20gc3RvcmFnZVxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBzdG9yYWdlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBDTVMuc2V0dGluZ3MucGFnZXRyZWUgPSBzdG9yYWdlO1xuICAgICAgICBIZWxwZXJzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG5cbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTW92ZXMgYSBub2RlIGFmdGVyIGRyYWcgJiBkcm9wLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfbW92ZU5vZGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29ial1cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai5pZF0gY3VycmVudCBlbGVtZW50IGlkIGZvciB1cmwgbWF0Y2hpbmdcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai50YXJnZXRdIHRhcmdldCBzaWJsaW5nIG9yIHBhcmVudFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLnBvc2l0aW9uXSBlaXRoZXIgYGxlZnRgLCBgcmlnaHRgIG9yIGBsYXN0LWNoaWxkYFxuICAgICAqIEByZXR1cm5zIHskLkRlZmVycmVkfSBhamF4IHJlcXVlc3Qgb2JqZWN0XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbW92ZU5vZGU6IGZ1bmN0aW9uIF9tb3ZlTm9kZShvYmopIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIG9iai5zaXRlID0gdGhhdC5vcHRpb25zLnNpdGU7XG5cbiAgICAgICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMubW92ZS5yZXBsYWNlKCd7aWR9Jywgb2JqLmlkKSxcbiAgICAgICAgICAgIGRhdGE6IG9ialxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuX3Nob3dTdWNjZXNzKG9iai5pZCk7XG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvcGllcyBhIG5vZGUgaW50byB0aGUgc2VsZWN0ZWQgbm9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2NvcHlOb2RlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBwYWdlIG9ialxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NvcHlOb2RlOiBmdW5jdGlvbiBfY29weU5vZGUob2JqKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIG5vZGUgPSB0aGF0Ll9nZXROb2RlUG9zaXRpb24ob2JqKTtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICBzaXRlOiB0aGlzLm9wdGlvbnMuc2l0ZSxcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVmZXIgdG8gdGhlIG9yaWdpbmFsIGl0ZW0gaGVyZSwgYXMgdGhlIGNvcGllZFxuICAgICAgICAgICAgLy8gbm9kZSB3aWxsIGhhdmUgbm8gZGF0YSBhdHRyaWJ1dGVzIHN0b3JlZCBhdCBpdCAobm90IGEgY2xvbmUpXG4gICAgICAgICAgICBpZDogb2JqLm9yaWdpbmFsLmRhdGEuaWQsXG4gICAgICAgICAgICBwb3NpdGlvbjogbm9kZS5wb3NpdGlvblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRhcmdldCBwcm92aWRlZCwgdGhlIG5vZGUgbGFuZHMgaW4gcm9vdFxuICAgICAgICBpZiAobm9kZS50YXJnZXQpIHtcbiAgICAgICAgICAgIGRhdGEudGFyZ2V0ID0gbm9kZS50YXJnZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhhdC5vcHRpb25zLnBlcm1pc3Npb24pIHtcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gbG9hZCBhIGRpYWxvZyBmaXJzdCwgdG8gY2hlY2sgaWYgcGVybWlzc2lvbnMgc2hvdWxkXG4gICAgICAgICAgICAvLyBiZSBjb3BpZWQgb3Igbm90XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMuY29weVBlcm1pc3Npb24ucmVwbGFjZSgne2lkfScsIGRhdGEuaWQpLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIC8vIHRoZSBkaWFsb2cgaXMgbG9hZGVkIHZpYSB0aGUgYWpheCByZXNwb25zIG9yaWdpbmF0aW5nIGZyb21cbiAgICAgICAgICAgIC8vIGB0ZW1wbGF0ZXMvYWRtaW4vY21zL3BhZ2UvdHJlZS9jb3B5X3ByZW1pc3Npb25zLmh0bWxgXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChkaWFsb2cpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRpYWxvZy5hcHBlbmQoZGlhbG9nKTtcbiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byB0aGUgcGVybWlzc2lvbiBkaWFsb2dcbiAgICAgICAgICAgIHRoaXMudWkuZGlhbG9nLm9mZih0aGlzLmNsaWNrLCAnLmNhbmNlbCcpLm9uKHRoaXMuY2xpY2ssICcuY2FuY2VsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGp1c3QgY29waWVkIG5vZGVcbiAgICAgICAgICAgICAgICB0aGF0LnVpLnRyZWUuanN0cmVlKCdkZWxldGVfbm9kZScsIG9iai5ub2RlLmlkKTtcbiAgICAgICAgICAgICAgICAkKCcuanMtY21zLWRpYWxvZycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1jbXMtZGlhbG9nLWRpbW1lcicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSkub2ZmKHRoaXMuY2xpY2ssICcuc3VibWl0Jykub24odGhpcy5jbGljaywgJy5zdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VibWl0QnV0dG9uID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBzdWJtaXRCdXR0b24uY2xvc2VzdCgnZm9ybScpLnNlcmlhbGl6ZSgpLnNwbGl0KCcmJyk7XG5cbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24ucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBmb3JtIGRhdGEgYW5kIGF0dGFjaCB0byBvYmpcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1EYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZm9ybURhdGFbaV0uc3BsaXQoJz0nKVswXV0gPSBmb3JtRGF0YVtpXS5zcGxpdCgnPScpWzFdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX3NhdmVDb3BpZWROb2RlKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9zYXZlQ29waWVkTm9kZShkYXRhKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZW5kcyB0aGUgcmVxdWVzdCB0byBjb3B5IGEgbm9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NhdmVDb3BpZWROb2RlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBub2RlIHBvc2l0aW9uIGluZm9ybWF0aW9uXG4gICAgICogQHJldHVybnMgeyQuRGVmZXJyZWR9XG4gICAgICovXG4gICAgX3NhdmVDb3BpZWROb2RlOiBmdW5jdGlvbiBfc2F2ZUNvcGllZE5vZGUoZGF0YSkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gc2VuZCB0aGUgcmVhbCBhamF4IHJlcXVlc3QgZm9yIGNvcHlpbmcgdGhlIHBsdWdpblxuICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgdXJsOiB0aGF0Lm9wdGlvbnMudXJscy5jb3B5LnJlcGxhY2UoJ3tpZH0nLCBkYXRhLmlkKSxcbiAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBlbGVtZW50IGZyb20gYW55IHN1YiBub2Rlcy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2dldEVsZW1lbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCBqUXVlcnkgbm9kZSBmb3JtIHdoZXJlIHRvIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGpzVHJlZSBub2RlIGVsZW1lbnQgaWRcbiAgICAgKi9cbiAgICBfZ2V0Tm9kZUlkOiBmdW5jdGlvbiBfZ2V0Tm9kZUlkKGVsKSB7XG4gICAgICAgIHZhciBjbHMgPSBlbC5jbG9zZXN0KCcuanN0cmVlLWdyaWQtY2VsbCcpLmF0dHIoJ2NsYXNzJyk7XG5cbiAgICAgICAgLy8gaWYgaXQncyBub3QgYSBjZWxsLCBhc3N1bWUgaXQncyB0aGUgcm9vdCBub2RlXG4gICAgICAgIHJldHVybiBjbHMgPyBjbHMucmVwbGFjZSgvLipqc2dyaWRfKC4rPylfY29sLiovLCAnJDEnKSA6ICcjJztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgbmV3IG5vZGUgcG9zaXRpb24gYWZ0ZXIgbW92aW5nLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0Tm9kZVBvc2l0aW9uXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIGpzdHJlZSBtb3ZlIG9iamVjdFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IGV2YWx1YXRlZCBvYmplY3Qgd2l0aCBwYXJhbXNcbiAgICAgKi9cbiAgICBfZ2V0Tm9kZVBvc2l0aW9uOiBmdW5jdGlvbiBfZ2V0Tm9kZVBvc2l0aW9uKG9iaikge1xuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMudWkudHJlZS5qc3RyZWUoJ2dldF9ub2RlJywgb2JqLm5vZGUucGFyZW50KTtcblxuICAgICAgICBkYXRhLnBvc2l0aW9uID0gb2JqLnBvc2l0aW9uO1xuXG4gICAgICAgIC8vIGpzdHJlZSBpbmRpY2F0ZXMgbm8gcGFyZW50IHdpdGggYCNgLCBpbiB0aGlzIGNhc2Ugd2UgZG8gbm90XG4gICAgICAgIC8vIG5lZWQgdG8gc2V0IHRoZSB0YXJnZXQgYXR0cmlidXRlIGF0IGFsbFxuICAgICAgICBpZiAob2JqLnBhcmVudCAhPT0gJyMnKSB7XG4gICAgICAgICAgICBkYXRhLnRhcmdldCA9IG5vZGUuZGF0YS5pZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWUgZnVuY3Rpb25zIGxpa2UgY29weSBjcmVhdGUgYSBuZXcgZWxlbWVudCB3aXRoIGEgbmV3IGlkLFxuICAgICAgICAvLyBpbiB0aGlzIGNhc2Ugd2UgbmVlZCB0byBzZXQgYGRhdGEuaWRgIG1hbnVhbGx5XG4gICAgICAgIGlmIChvYmoubm9kZSAmJiBvYmoubm9kZS5kYXRhKSB7XG4gICAgICAgICAgICBkYXRhLmlkID0gb2JqLm5vZGUuZGF0YS5pZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGdlbmVyYWwgdG9vbHRpcHMgdGhhdCBjYW4gaGF2ZSBhIGxpc3Qgb2YgbGlua3Mgb3IgY29udGVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwRHJvcGRvd25zXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBEcm9wZG93bnM6IGZ1bmN0aW9uIF9zZXR1cERyb3Bkb3ducygpIHtcbiAgICAgICAgdGhpcy5fZHJvcGRvd25zID0gbmV3IFBhZ2VUcmVlRHJvcGRvd25zKHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy51aS5jb250YWluZXJcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgcGFnZSB2aWV3IGNsaWNrLiBVc3VhbCB1c2UgY2FzZSBpcyB0aGF0IGFmdGVyIHlvdSBjbGlja1xuICAgICAqIG9uIHZpZXcgcGFnZSBpbiB0aGUgcGFnZXRyZWUgLSBzaWRlZnJhbWUgaXMgbm8gbG9uZ2VyIG5lZWRlZCxcbiAgICAgKiBzbyB3ZSBjbG9zZSBpdC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwUGFnZVZpZXdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFBhZ2VWaWV3OiBmdW5jdGlvbiBfc2V0dXBQYWdlVmlldygpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuICAgICAgICB2YXIgcGFyZW50ID0gd2luLnBhcmVudCA/IHdpbi5wYXJlbnQgOiB3aW47XG5cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtcGFnZXRyZWUtcGFnZS12aWV3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcGFyZW50LkNNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncygkLmV4dGVuZCh0cnVlLCB7fSwgQ01TLnNldHRpbmdzLCB7XG4gICAgICAgICAgICAgICAgc2lkZWZyYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc2V0dXBTdGlja3lIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFN0aWNreUhlYWRlcjogZnVuY3Rpb24gX3NldHVwU3RpY2t5SGVhZGVyKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC51aS50cmVlLm9uKCdyZWFkeS5qc3RyZWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LmhlYWRlciA9IG5ldyBQYWdlVHJlZVN0aWNreUhlYWRlcih7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiB0aGF0LnVpLmNvbnRhaW5lclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VycyB0aGUgbGlua3MgYGhyZWZgIGFzIGFqYXggcG9zdCByZXF1ZXN0LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0QWpheFBvc3RcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSB0cmlnZ2VyIGpRdWVyeSBsaW5rIHRhcmdldFxuICAgICAqL1xuICAgIF9zZXRBamF4UG9zdDogZnVuY3Rpb24gX3NldEFqYXhQb3N0KHRyaWdnZXIpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogJCh0aGlzKS5hdHRyKCdocmVmJylcbiAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2VsZiA9PT0gd2luZG93LnRvcCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzaW1wbHkgcmVsb2FkIHRoZSBwYWdlXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGluIHRoZSBzaWRlZnJhbWUgd2UgaGF2ZSB0byBhY3R1YWxseVxuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgcHVibGlzaGluZyBhIHBhZ2Ugd2UncmUgY3VycmVudGx5IGluXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgaWYgdGhlIHNsdWcgZGlkIGNoYW5nZSB3ZSB3b3VsZCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIHRoYXQgbmV3IHNsdWdcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJvYmxlbSBoZXJlIGlzIHRoYXQgaW4gY2FzZSBvZiB0aGUgYXBwaG9va2VkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1vZGVsIGFuZCBwayBhcmUgZW1wdHkgYW5kIHJlbG9hZEJyb3dzZXIgZG9lc24ndCByZWFsbHlcbiAgICAgICAgICAgICAgICAgICAgLy8gZG8gYW55dGhpbmcgLSBzbyBoZXJlIHdlIHNwZWNpZmljYWxseSBmb3JjZSB0aGUgZGF0YVxuICAgICAgICAgICAgICAgICAgICAvLyB0byBiZSB0aGUgZGF0YSBhYm91dCB0aGUgcGFnZSBhbmQgbm90IHRoZSBtb2RlbFxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gd2luZG93LnBhcmVudCA/IHdpbmRvdy5wYXJlbnQgOiB3aW5kb3c7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRklYTUUgc2hvdWxkbid0IGJlIGhhcmRjb2RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICdjbXMucGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwazogcGFyZW50LkNNUy5jb25maWcucmVxdWVzdC5wYWdlX2lkXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgSGVscGVycy5yZWxvYWRCcm93c2VyKCdSRUZSRVNIX1BBR0UnLCBmYWxzZSwgdHJ1ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0cyBldmVudHMgZm9yIHRoZSBzZWFyY2ggb24gdGhlIGhlYWRlci5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwU2VhcmNoXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBTZWFyY2g6IGZ1bmN0aW9uIF9zZXR1cFNlYXJjaCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgY2xpY2sgPSB0aGlzLmNsaWNrICsgJy5zZWFyY2gnO1xuXG4gICAgICAgIHZhciBmaWx0ZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZpbHRlclRyaWdnZXIgPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1maWx0ZXItdHJpZ2dlcicpO1xuICAgICAgICB2YXIgZmlsdGVyQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyLWNvbnRhaW5lcicpO1xuICAgICAgICB2YXIgZmlsdGVyQ2xvc2UgPSBmaWx0ZXJDb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoLWNsb3NlJyk7XG4gICAgICAgIHZhciBmaWx0ZXJDbGFzcyA9ICdjbXMtcGFnZXRyZWUtaGVhZGVyLWZpbHRlci1hY3RpdmUnO1xuICAgICAgICB2YXIgcGFnZVRyZWVIZWFkZXIgPSAkKCcuY21zLXBhZ2V0cmVlLWhlYWRlcicpO1xuXG4gICAgICAgIHZhciB2aXNpYmxlRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaCcpO1xuICAgICAgICB2YXIgaGlkZGVuRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaC1jb3B5IGZvcm0nKTtcblxuICAgICAgICB2YXIgc2VhcmNoQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyJyk7XG4gICAgICAgIHZhciBzZWFyY2hGaWVsZCA9IHNlYXJjaENvbnRhaW5lci5maW5kKCcjZmllbGQtc2VhcmNoYmFyJyk7XG4gICAgICAgIHZhciB0aW1lb3V0ID0gMjAwO1xuXG4gICAgICAgIC8vIGFkZCBhY3RpdmUgY2xhc3Mgd2hlbiBmb2N1c2luZyB0aGUgc2VhcmNoIGZpZWxkXG4gICAgICAgIHNlYXJjaEZpZWxkLm9uKCdmb2N1cycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIuYWRkQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VhcmNoRmllbGQub24oJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgaXMgcmVxdWlyZWQgdG8gcHJldmVudCB0aGUgc2VhcmNoIGZpZWxkIGZyb20ganVtcGluZ1xuICAgICAgICAgICAgLy8gYmV0d2VlbiBlbmxhcmdpbmcgYW5kIHNocmlua2luZ1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIucmVtb3ZlQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYoY2xpY2spO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzaG93cy9oaWRlcyBmaWx0ZXIgYm94XG4gICAgICAgIGZpbHRlclRyaWdnZXIuYWRkKGZpbHRlckNsb3NlKS5vbihjbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpZiAoZmlsdGVyQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyQ29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBwYWdlVHJlZUhlYWRlci5yZW1vdmVDbGFzcyhmaWx0ZXJDbGFzcyk7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYoY2xpY2spO1xuICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJDb250YWluZXIuc2hvdygpO1xuICAgICAgICAgICAgICAgIHBhZ2VUcmVlSGVhZGVyLmFkZENsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9uKGNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclRyaWdnZXIudHJpZ2dlcihjbGljayk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZmlsdGVyQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJldmVudCBjbG9zaW5nIHdoZW4gb24gZmlsdGVyIGNvbnRhaW5lclxuICAgICAgICBmaWx0ZXJDb250YWluZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZCBoaWRkZW4gZmllbGRzIHRvIHRoZSBmb3JtIHRvIG1haW50YWluIGZpbHRlciBwYXJhbXNcbiAgICAgICAgdmlzaWJsZUZvcm0uYXBwZW5kKGhpZGRlbkZvcm0uZmluZCgnaW5wdXRbdHlwZT1cImhpZGRlblwiXScpKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvd3MgcGFzdGUgaGVscGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2VuYWJsZVBhc3RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWxlY3Rvcj10aGlzLm9wdGlvbnMucGFzdGVTZWxlY3Rvcl0ganF1ZXJ5IHNlbGVjdG9yXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZW5hYmxlUGFzdGU6IGZ1bmN0aW9uIF9lbmFibGVQYXN0ZShzZWxlY3Rvcikge1xuICAgICAgICB2YXIgc2VsID0gdHlwZW9mIHNlbGVjdG9yID09PSAndW5kZWZpbmVkJyA/XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvciA6XG4gICAgICAgICAgICBzZWxlY3RvciArICcgJyArIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yO1xuICAgICAgICB2YXIgZHJvcGRvd25TZWwgPSAnLmpzLWNtcy1wYWdldHJlZS1hY3Rpb25zLWRyb3Bkb3duJztcblxuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgZHJvcGRvd25TZWwgPSBzZWxlY3RvciArICcgLmpzLWNtcy1wYWdldHJlZS1hY3Rpb25zLWRyb3Bkb3duJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhlbHBlcnMgYXJlIGdlbmVyYXRlZCBvbiB0aGUgZmx5LCBzbyB3ZSBuZWVkIHRvIHJlZmVyZW5jZVxuICAgICAgICAvLyB0aGVtIGV2ZXJ5IHNpbmdsZSB0aW1lXG4gICAgICAgICQoc2VsKS5yZW1vdmVDbGFzcygnY21zLXBhZ2V0cmVlLWRyb3Bkb3duLWl0ZW0tZGlzYWJsZWQnKTtcblxuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgZGF0YS5oYXNfY3V0ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGEuaGFzX2NvcHkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vdCBsb2FkZWQgYWN0aW9ucyBkcm9wZG93biBoYXZlIHRvIGJlIHVwZGF0ZWQgYXMgd2VsbFxuICAgICAgICAkKGRyb3Bkb3duU2VsKS5kYXRhKCdsYXp5VXJsRGF0YScsIGRhdGEpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaWRlcyBwYXN0ZSBoZWxwZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZGlzYWJsZVBhc3RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWxlY3Rvcj10aGlzLm9wdGlvbnMucGFzdGVTZWxlY3Rvcl0ganF1ZXJ5IHNlbGVjdG9yXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZGlzYWJsZVBhc3RlOiBmdW5jdGlvbiBfZGlzYWJsZVBhc3RlKHNlbGVjdG9yKSB7XG4gICAgICAgIHZhciBzZWwgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICd1bmRlZmluZWQnID9cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yIDpcbiAgICAgICAgICAgIHNlbGVjdG9yICsgJyAnICsgdGhpcy5vcHRpb25zLnBhc3RlU2VsZWN0b3I7XG4gICAgICAgIHZhciBkcm9wZG93blNlbCA9ICcuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBkcm9wZG93blNlbCA9IHNlbGVjdG9yICsgJyAuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyBoZWxwZXJzIGFyZSBnZW5lcmF0ZWQgb24gdGhlIGZseSwgc28gd2UgbmVlZCB0byByZWZlcmVuY2VcbiAgICAgICAgLy8gdGhlbSBldmVyeSBzaW5nbGUgdGltZVxuICAgICAgICAkKHNlbCkuYWRkQ2xhc3MoJ2Ntcy1wYWdldHJlZS1kcm9wZG93bi1pdGVtLWRpc2FibGVkJyk7XG5cbiAgICAgICAgLy8gbm90IGxvYWRlZCBhY3Rpb25zIGRyb3Bkb3duIGhhdmUgdG8gYmUgdXBkYXRlZCBhcyB3ZWxsXG4gICAgICAgICQoZHJvcGRvd25TZWwpLnJlbW92ZURhdGEoJ2xhenlVcmxEYXRhJyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGhlbHBlcnMgYWZ0ZXIgYGFmdGVyX29wZW4uanN0cmVlYFxuICAgICAqIG9yIGBfY3V0T3JDb3B5YCBpcyB0cmlnZ2VyZWQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF91cGRhdGVQYXN0ZUhlbHBlcnNTdGF0ZVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3VwZGF0ZVBhc3RlSGVscGVyc1N0YXRlOiBmdW5jdGlvbiBfdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSAmJiB0aGlzLmNsaXBib2FyZC5pZCkge1xuICAgICAgICAgICAgdGhpcy5fZW5hYmxlUGFzdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhpZGUgY3V0IGVsZW1lbnQgYW5kIGl0J3MgZGVzY2VuZGFudHMnIHBhc3RlIGhlbHBlcnMgaWYgaXQgaXMgdmlzaWJsZVxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSA9PT0gJ2N1dCcgJiYgdGhpcy5jbGlwYm9hcmQub3JpZ2luKSB7XG4gICAgICAgICAgICB2YXIgZGVzY2VuZGFudElkcyA9IHRoaXMuX2dldERlc2NlbmRhbnRzSWRzKHRoaXMuY2xpcGJvYXJkLmlkKTtcbiAgICAgICAgICAgIHZhciBub2RlcyA9IFt0aGlzLmNsaXBib2FyZC5pZF07XG5cbiAgICAgICAgICAgIGlmIChkZXNjZW5kYW50SWRzICYmIGRlc2NlbmRhbnRJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbm9kZXMgPSBub2Rlcy5jb25jYXQoZGVzY2VuZGFudElkcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fZGlzYWJsZVBhc3RlKCcuanNncmlkXycgKyBpZCArICdfY29sJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93cyBzdWNjZXNzIG1lc3NhZ2Ugb24gbm9kZSBhZnRlciBzdWNjZXNzZnVsIGFjdGlvbi5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3Nob3dTdWNjZXNzXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIGlkIG9mIHRoZSBlbGVtZW50IHRvIGFkZCB0aGUgc3VjY2VzcyBjbGFzc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3Nob3dTdWNjZXNzOiBmdW5jdGlvbiBfc2hvd1N1Y2Nlc3MoaWQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnVpLnRyZWUuZmluZCgnbGlbZGF0YS1pZD1cIicgKyBpZCArICdcIl0nKTtcblxuICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgfSwgdGhpcy5zdWNjZXNzVGltZXIpO1xuICAgICAgICAvLyBoaWRlIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB3ZSBzaG91bGQgcmVsb2FkIHRoZSBpZnJhbWUgb3IgZW50aXJlIHdpbmRvdy4gRm9yIHRoaXMgd2VcbiAgICAgKiBuZWVkIHRvIHNraXAgYENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7YC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3JlbG9hZEhlbHBlclxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlbG9hZEhlbHBlcjogZnVuY3Rpb24gX3JlbG9hZEhlbHBlcigpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5zZWxmID09PSB3aW5kb3cudG9wKSB7XG4gICAgICAgICAgICBIZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5cyBhbiBlcnJvciB3aXRoaW4gdGhlIGRqYW5nbyBVSS5cbiAgICAgKlxuICAgICAqIEBtZXRob2Qgc2hvd0Vycm9yXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2Ugc3RyaW5nIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAqL1xuICAgIHNob3dFcnJvcjogZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2VzID0gJCgnLm1lc3NhZ2VsaXN0Jyk7XG4gICAgICAgIHZhciBicmVhZGNydW1iID0gJCgnLmJyZWFkY3J1bWJzJyk7XG4gICAgICAgIHZhciByZWxvYWQgPSB0aGlzLm9wdGlvbnMubGFuZy5yZWxvYWQ7XG4gICAgICAgIHZhciB0cGwgPSAnJyArXG4gICAgICAgICAgICAnPHVsIGNsYXNzPVwibWVzc2FnZWxpc3RcIj4nICtcbiAgICAgICAgICAgICcgICA8bGkgY2xhc3M9XCJlcnJvclwiPicgK1xuICAgICAgICAgICAgJyAgICAgICB7bXNnfSAnICtcbiAgICAgICAgICAgICcgICAgICAgPGEgaHJlZj1cIiNyZWxvYWRcIiBjbGFzcz1cImNtcy10cmVlLXJlbG9hZFwiPiAnICsgcmVsb2FkICsgJyA8L2E+JyArXG4gICAgICAgICAgICAnICAgPC9saT4nICtcbiAgICAgICAgICAgICc8L3VsPic7XG4gICAgICAgIHZhciBtc2cgPSB0cGwucmVwbGFjZSgne21zZ30nLCAnPHN0cm9uZz4nICsgdGhpcy5vcHRpb25zLmxhbmcuZXJyb3IgKyAnPC9zdHJvbmc+ICcgKyBtZXNzYWdlKTtcblxuICAgICAgICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBtZXNzYWdlcy5yZXBsYWNlV2l0aChtc2cpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnJlYWRjcnVtYi5hZnRlcihtc2cpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2dldERlc2NlbmRhbnRzSWRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkIGpzdHJlZSBpZCBvZiB0aGUgbm9kZSwgZS5nLiBqMV8zXG4gICAgICogQHJldHVybnMge1N0cmluZ1tdfSBhcnJheSBvZiBpZHNcbiAgICAgKi9cbiAgICBfZ2V0RGVzY2VuZGFudHNJZHM6IGZ1bmN0aW9uIF9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudWkudHJlZS5qc3RyZWUodHJ1ZSkuZ2V0X25vZGUobm9kZUlkKS5jaGlsZHJlbl9kO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9oYXNQZXJtaXNpb25cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlIGpzdHJlZSBub2RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBlcm1pc3Npb24gbW92ZSAvIGFkZFxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAqL1xuICAgIF9oYXNQZXJtaXNzaW9uOiBmdW5jdGlvbiBfaGFzUGVybWlzaW9uKG5vZGUsIHBlcm1pc3Npb24pIHtcbiAgICAgICAgaWYgKG5vZGUuaWQgPT09ICcjJyAmJiBwZXJtaXNzaW9uID09PSAnYWRkJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5oYXNBZGRSb290UGVybWlzc2lvbjtcbiAgICAgICAgfSBlbHNlIGlmIChub2RlLmlkID09PSAnIycpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub2RlLmxpX2F0dHJbJ2RhdGEtJyArIHBlcm1pc3Npb24gKyAnLXBlcm1pc3Npb24nXSA9PT0gJ3RydWUnO1xuICAgIH1cbn0pO1xuXG4vLyBzaG9ydGhhbmQgZm9yIGpRdWVyeShkb2N1bWVudCkucmVhZHkoKTtcbiQoZnVuY3Rpb24gKCkge1xuICAgIC8vIGxvYWQgY21zIHNldHRpbmdzIGJlZm9yZWhhbmRcbiAgICAvLyBoYXZlIHRvIHNldCB0b29sYmFyIHRvIFwiZXhwYW5kZWRcIiBieSBkZWZhdWx0XG4gICAgLy8gb3RoZXJ3aXNlIGluaXRpYWxpemF0aW9uIHdpbGwgYmUgaW5jb3JyZWN0IHdoZW4geW91XG4gICAgLy8gZ28gZmlyc3QgdG8gcGFnZXMgYW5kIHRoZW4gdG8gbm9ybWFsIHBhZ2VcbiAgICB3aW5kb3cuQ01TLmNvbmZpZyA9IHtcbiAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHRvb2xiYXI6ICdleHBhbmRlZCdcbiAgICAgICAgfSxcbiAgICAgICAgdXJsczoge1xuICAgICAgICAgICAgc2V0dGluZ3M6ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdzZXR0aW5ncy11cmwnKVxuICAgICAgICB9XG4gICAgfTtcbiAgICB3aW5kb3cuQ01TLnNldHRpbmdzID0gSGVscGVycy5nZXRTZXR0aW5ncygpO1xuICAgIC8vIGF1dG9sb2FkIHRoZSBwYWdldHJlZVxuICAgIG5ldyBQYWdlVHJlZSgpO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFnZVRyZWU7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vY21zL3N0YXRpYy9jbXMvanMvbW9kdWxlcy9jbXMucGFnZXRyZWUuanNcbiAqKiBtb2R1bGUgaWQgPSA4XG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iLCIvKiFcbiAqIFRISVMgRklMRSBIQVMgQkVFTiBNQU5VQUxMWSBQQVRDSEVEIFRPIEFMTE9XIENPUFlJTkcgSU5UTyBTRUxGL0NISUxEUkVOXG4gKiBodHRwczovL2dpdGh1Yi5jb20vRmluYWxBbmdlbC9qc3RyZWVcbiAqL1xuLyohIGpzVHJlZSAtIHYzLjMuMCAtIDIwMTYtMDQtMjUgLSAoTUlUKSAqL1xuIWZ1bmN0aW9uKGEpe1widXNlIHN0cmljdFwiO1wiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wianF1ZXJ5XCJdLGEpOlwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPWEocmVxdWlyZShcImpxdWVyeVwiKSk6YShqUXVlcnkpfShmdW5jdGlvbihhLGIpe1widXNlIHN0cmljdFwiO2lmKCFhLmpzdHJlZSl7dmFyIGM9MCxkPSExLGU9ITEsZj0hMSxnPVtdLGg9YShcInNjcmlwdDpsYXN0XCIpLmF0dHIoXCJzcmNcIiksaT13aW5kb3cuZG9jdW1lbnQsaj1pLmNyZWF0ZUVsZW1lbnQoXCJMSVwiKSxrLGw7ai5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJ0cmVlaXRlbVwiKSxrPWkuY3JlYXRlRWxlbWVudChcIklcIiksay5jbGFzc05hbWU9XCJqc3RyZWUtaWNvbiBqc3RyZWUtb2NsXCIsay5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksai5hcHBlbmRDaGlsZChrKSxrPWkuY3JlYXRlRWxlbWVudChcIkFcIiksay5jbGFzc05hbWU9XCJqc3RyZWUtYW5jaG9yXCIsay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCIjXCIpLGsuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIixcIi0xXCIpLGw9aS5jcmVhdGVFbGVtZW50KFwiSVwiKSxsLmNsYXNzTmFtZT1cImpzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb25cIixsLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxrLmFwcGVuZENoaWxkKGwpLGouYXBwZW5kQ2hpbGQoayksaz1sPW51bGwsYS5qc3RyZWU9e3ZlcnNpb246XCJ7e1ZFUlNJT059fVwiLGRlZmF1bHRzOntwbHVnaW5zOltdfSxwbHVnaW5zOnt9LHBhdGg6aCYmLTEhPT1oLmluZGV4T2YoXCIvXCIpP2gucmVwbGFjZSgvXFwvW15cXC9dKyQvLFwiXCIpOlwiXCIsaWRyZWdleDovW1xcXFw6JiFefCgpXFxbXFxdPD5AKicrfiNcIjsuLD1cXC0gXFwvJHt9JT9gXS9nLHJvb3Q6XCIjXCJ9LGEuanN0cmVlLmNyZWF0ZT1mdW5jdGlvbihiLGQpe3ZhciBlPW5ldyBhLmpzdHJlZS5jb3JlKCsrYyksZj1kO3JldHVybiBkPWEuZXh0ZW5kKCEwLHt9LGEuanN0cmVlLmRlZmF1bHRzLGQpLGYmJmYucGx1Z2lucyYmKGQucGx1Z2lucz1mLnBsdWdpbnMpLGEuZWFjaChkLnBsdWdpbnMsZnVuY3Rpb24oYSxiKXtcImNvcmVcIiE9PWEmJihlPWUucGx1Z2luKGIsZFtiXSkpfSksYShiKS5kYXRhKFwianN0cmVlXCIsZSksZS5pbml0KGIsZCksZX0sYS5qc3RyZWUuZGVzdHJveT1mdW5jdGlvbigpe2EoXCIuanN0cmVlOmpzdHJlZVwiKS5qc3RyZWUoXCJkZXN0cm95XCIpLGEoaSkub2ZmKFwiLmpzdHJlZVwiKX0sYS5qc3RyZWUuY29yZT1mdW5jdGlvbihhKXt0aGlzLl9pZD1hLHRoaXMuX2NudD0wLHRoaXMuX3dyaz1udWxsLHRoaXMuX2RhdGE9e2NvcmU6e3RoZW1lczp7bmFtZTohMSxkb3RzOiExLGljb25zOiExfSxzZWxlY3RlZDpbXSxsYXN0X2Vycm9yOnt9LHdvcmtpbmc6ITEsd29ya2VyX3F1ZXVlOltdLGZvY3VzZWQ6bnVsbH19fSxhLmpzdHJlZS5yZWZlcmVuY2U9ZnVuY3Rpb24oYil7dmFyIGM9bnVsbCxkPW51bGw7aWYoIWJ8fCFiLmlkfHxiLnRhZ05hbWUmJmIubm9kZVR5cGV8fChiPWIuaWQpLCFkfHwhZC5sZW5ndGgpdHJ5e2Q9YShiKX1jYXRjaChlKXt9aWYoIWR8fCFkLmxlbmd0aCl0cnl7ZD1hKFwiI1wiK2IucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpKX1jYXRjaChlKXt9cmV0dXJuIGQmJmQubGVuZ3RoJiYoZD1kLmNsb3Nlc3QoXCIuanN0cmVlXCIpKS5sZW5ndGgmJihkPWQuZGF0YShcImpzdHJlZVwiKSk/Yz1kOmEoXCIuanN0cmVlXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLmRhdGEoXCJqc3RyZWVcIik7cmV0dXJuIGQmJmQuX21vZGVsLmRhdGFbYl0/KGM9ZCwhMSk6dm9pZCAwfSksY30sYS5mbi5qc3RyZWU9ZnVuY3Rpb24oYyl7dmFyIGQ9XCJzdHJpbmdcIj09dHlwZW9mIGMsZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksZj1udWxsO3JldHVybiBjIT09ITB8fHRoaXMubGVuZ3RoPyh0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZz1hLmpzdHJlZS5yZWZlcmVuY2UodGhpcyksaD1kJiZnP2dbY106bnVsbDtyZXR1cm4gZj1kJiZoP2guYXBwbHkoZyxlKTpudWxsLGd8fGR8fGMhPT1iJiYhYS5pc1BsYWluT2JqZWN0KGMpfHxhLmpzdHJlZS5jcmVhdGUodGhpcyxjKSwoZyYmIWR8fGM9PT0hMCkmJihmPWd8fCExKSxudWxsIT09ZiYmZiE9PWI/ITE6dm9pZCAwfSksbnVsbCE9PWYmJmYhPT1iP2Y6dGhpcyk6ITF9LGEuZXhwcltcIjpcIl0uanN0cmVlPWEuZXhwci5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24oYyl7cmV0dXJuIGZ1bmN0aW9uKGMpe3JldHVybiBhKGMpLmhhc0NsYXNzKFwianN0cmVlXCIpJiZhKGMpLmRhdGEoXCJqc3RyZWVcIikhPT1ifX0pLGEuanN0cmVlLmRlZmF1bHRzLmNvcmU9e2RhdGE6ITEsc3RyaW5nczohMSxjaGVja19jYWxsYmFjazohMSxlcnJvcjphLm5vb3AsYW5pbWF0aW9uOjIwMCxtdWx0aXBsZTohMCx0aGVtZXM6e25hbWU6ITEsdXJsOiExLGRpcjohMSxkb3RzOiEwLGljb25zOiEwLHN0cmlwZXM6ITEsdmFyaWFudDohMSxyZXNwb25zaXZlOiExfSxleHBhbmRfc2VsZWN0ZWRfb25sb2FkOiEwLHdvcmtlcjohMCxmb3JjZV90ZXh0OiExLGRibGNsaWNrX3RvZ2dsZTohMH0sYS5qc3RyZWUuY29yZS5wcm90b3R5cGU9e3BsdWdpbjpmdW5jdGlvbihiLGMpe3ZhciBkPWEuanN0cmVlLnBsdWdpbnNbYl07cmV0dXJuIGQ/KHRoaXMuX2RhdGFbYl09e30sZC5wcm90b3R5cGU9dGhpcyxuZXcgZChjLHRoaXMpKTp0aGlzfSxpbml0OmZ1bmN0aW9uKGIsYyl7dGhpcy5fbW9kZWw9e2RhdGE6e30sY2hhbmdlZDpbXSxmb3JjZV9mdWxsX3JlZHJhdzohMSxyZWRyYXdfdGltZW91dDohMSxkZWZhdWx0X3N0YXRlOntsb2FkZWQ6ITAsb3BlbmVkOiExLHNlbGVjdGVkOiExLGRpc2FibGVkOiExfX0sdGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XT17aWQ6YS5qc3RyZWUucm9vdCxwYXJlbnQ6bnVsbCxwYXJlbnRzOltdLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sc3RhdGU6e2xvYWRlZDohMX19LHRoaXMuZWxlbWVudD1hKGIpLmFkZENsYXNzKFwianN0cmVlIGpzdHJlZS1cIit0aGlzLl9pZCksdGhpcy5zZXR0aW5ncz1jLHRoaXMuX2RhdGEuY29yZS5yZWFkeT0hMSx0aGlzLl9kYXRhLmNvcmUubG9hZGVkPSExLHRoaXMuX2RhdGEuY29yZS5ydGw9XCJydGxcIj09PXRoaXMuZWxlbWVudC5jc3MoXCJkaXJlY3Rpb25cIiksdGhpcy5lbGVtZW50W3RoaXMuX2RhdGEuY29yZS5ydGw/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJqc3RyZWUtcnRsXCIpLHRoaXMuZWxlbWVudC5hdHRyKFwicm9sZVwiLFwidHJlZVwiKSx0aGlzLnNldHRpbmdzLmNvcmUubXVsdGlwbGUmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1tdWx0aXNlbGVjdGFibGVcIiwhMCksdGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiKXx8dGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiLFwiMFwiKSx0aGlzLmJpbmQoKSx0aGlzLnRyaWdnZXIoXCJpbml0XCIpLHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbD10aGlzLmVsZW1lbnQuZmluZChcIiA+IHVsID4gbGlcIikuY2xvbmUoITApLHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbC5maW5kKFwibGlcIikuYWRkQmFjaygpLmNvbnRlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDM9PT10aGlzLm5vZGVUeXBlJiYoIXRoaXMubm9kZVZhbHVlfHwvXlxccyskLy50ZXN0KHRoaXMubm9kZVZhbHVlKSl9KS5yZW1vdmUoKSx0aGlzLmVsZW1lbnQuaHRtbChcIjx1bCBjbGFzcz0nanN0cmVlLWNvbnRhaW5lci11bCBqc3RyZWUtY2hpbGRyZW4nIHJvbGU9J2dyb3VwJz48bGkgaWQ9J2pcIit0aGlzLl9pZCtcIl9sb2FkaW5nJyBjbGFzcz0nanN0cmVlLWluaXRpYWwtbm9kZSBqc3RyZWUtbG9hZGluZyBqc3RyZWUtbGVhZiBqc3RyZWUtbGFzdCcgcm9sZT0ndHJlZS1pdGVtJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLW9jbCc+PC9pPjxhIGNsYXNzPSdqc3RyZWUtYW5jaG9yJyBocmVmPScjJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLXRoZW1laWNvbi1oaWRkZW4nPjwvaT5cIit0aGlzLmdldF9zdHJpbmcoXCJMb2FkaW5nIC4uLlwiKStcIjwvYT48L2xpPjwvdWw+XCIpLHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsXCJqXCIrdGhpcy5faWQrXCJfbG9hZGluZ1wiKSx0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0PXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmNoaWxkcmVuKFwibGlcIikuZmlyc3QoKS5oZWlnaHQoKXx8MjQsdGhpcy50cmlnZ2VyKFwibG9hZGluZ1wiKSx0aGlzLmxvYWRfbm9kZShhLmpzdHJlZS5yb290KX0sZGVzdHJveTpmdW5jdGlvbihhKXtpZih0aGlzLl93cmspdHJ5e3dpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHRoaXMuX3dyayksdGhpcy5fd3JrPW51bGx9Y2F0Y2goYil7fWF8fHRoaXMuZWxlbWVudC5lbXB0eSgpLHRoaXMudGVhcmRvd24oKX0sdGVhcmRvd246ZnVuY3Rpb24oKXt0aGlzLnVuYmluZCgpLHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImpzdHJlZVwiKS5yZW1vdmVEYXRhKFwianN0cmVlXCIpLmZpbmQoXCJbY2xhc3NePSdqc3RyZWUnXVwiKS5hZGRCYWNrKCkuYXR0cihcImNsYXNzXCIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jbGFzc05hbWUucmVwbGFjZSgvanN0cmVlW14gXSp8JC9naSxcIlwiKX0pLHRoaXMuZWxlbWVudD1udWxsfSxiaW5kOmZ1bmN0aW9uKCl7dmFyIGI9XCJcIixjPW51bGwsZD0wO3RoaXMuZWxlbWVudC5vbihcImRibGNsaWNrLmpzdHJlZVwiLGZ1bmN0aW9uKGEpe2lmKGEudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWEudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtpZihpLnNlbGVjdGlvbiYmaS5zZWxlY3Rpb24uZW1wdHkpaS5zZWxlY3Rpb24uZW1wdHkoKTtlbHNlIGlmKHdpbmRvdy5nZXRTZWxlY3Rpb24pe3ZhciBiPXdpbmRvdy5nZXRTZWxlY3Rpb24oKTt0cnl7Yi5yZW1vdmVBbGxSYW5nZXMoKSxiLmNvbGxhcHNlKCl9Y2F0Y2goYyl7fX19KS5vbihcIm1vdXNlZG93bi5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEpe2EudGFyZ2V0PT09dGhpcy5lbGVtZW50WzBdJiYoYS5wcmV2ZW50RGVmYXVsdCgpLGQ9K25ldyBEYXRlKX0sdGhpcykpLm9uKFwibW91c2Vkb3duLmpzdHJlZVwiLFwiLmpzdHJlZS1vY2xcIixmdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCl9KS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1vY2xcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMudG9nZ2xlX25vZGUoYS50YXJnZXQpfSx0aGlzKSkub24oXCJkYmxjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gYS50YXJnZXQudGFnTmFtZSYmXCJpbnB1dFwiPT09YS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpPyEwOnZvaWQodGhpcy5zZXR0aW5ncy5jb3JlLmRibGNsaWNrX3RvZ2dsZSYmdGhpcy50b2dnbGVfbm9kZShhLnRhcmdldCkpfSx0aGlzKSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXtiLnByZXZlbnREZWZhdWx0KCksYi5jdXJyZW50VGFyZ2V0IT09aS5hY3RpdmVFbGVtZW50JiZhKGIuY3VycmVudFRhcmdldCkuZm9jdXMoKSx0aGlzLmFjdGl2YXRlX25vZGUoYi5jdXJyZW50VGFyZ2V0LGIpfSx0aGlzKSkub24oXCJrZXlkb3duLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2lmKGIudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWIudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtpZigzMiE9PWIud2hpY2gmJjEzIT09Yi53aGljaCYmKGIuc2hpZnRLZXl8fGIuY3RybEtleXx8Yi5hbHRLZXl8fGIubWV0YUtleSkpcmV0dXJuITA7dmFyIGM9bnVsbDtzd2l0Y2godGhpcy5fZGF0YS5jb3JlLnJ0bCYmKDM3PT09Yi53aGljaD9iLndoaWNoPTM5OjM5PT09Yi53aGljaCYmKGIud2hpY2g9MzcpKSxiLndoaWNoKXtjYXNlIDMyOmIuY3RybEtleSYmKGIudHlwZT1cImNsaWNrXCIsYShiLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoYikpO2JyZWFrO2Nhc2UgMTM6Yi50eXBlPVwiY2xpY2tcIixhKGIuY3VycmVudFRhcmdldCkudHJpZ2dlcihiKTticmVhaztjYXNlIDM3OmIucHJldmVudERlZmF1bHQoKSx0aGlzLmlzX29wZW4oYi5jdXJyZW50VGFyZ2V0KT90aGlzLmNsb3NlX25vZGUoYi5jdXJyZW50VGFyZ2V0KTooYz10aGlzLmdldF9wYXJlbnQoYi5jdXJyZW50VGFyZ2V0KSxjJiZjLmlkIT09YS5qc3RyZWUucm9vdCYmdGhpcy5nZXRfbm9kZShjLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpO2JyZWFrO2Nhc2UgMzg6Yi5wcmV2ZW50RGVmYXVsdCgpLGM9dGhpcy5nZXRfcHJldl9kb20oYi5jdXJyZW50VGFyZ2V0KSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAzOTpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5pc19jbG9zZWQoYi5jdXJyZW50VGFyZ2V0KT90aGlzLm9wZW5fbm9kZShiLmN1cnJlbnRUYXJnZXQsZnVuY3Rpb24oYSl7dGhpcy5nZXRfbm9kZShhLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCl9KTp0aGlzLmlzX29wZW4oYi5jdXJyZW50VGFyZ2V0KSYmKGM9dGhpcy5nZXRfbm9kZShiLmN1cnJlbnRUYXJnZXQsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKVswXSxjJiZhKHRoaXMuX2ZpcnN0Q2hpbGQoYykpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSk7YnJlYWs7Y2FzZSA0MDpiLnByZXZlbnREZWZhdWx0KCksYz10aGlzLmdldF9uZXh0X2RvbShiLmN1cnJlbnRUYXJnZXQpLGMmJmMubGVuZ3RoJiZjLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTticmVhaztjYXNlIDEwNjp0aGlzLm9wZW5fYWxsKCk7YnJlYWs7Y2FzZSAzNjpiLnByZXZlbnREZWZhdWx0KCksYz10aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSxjJiZhKGMpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZmlsdGVyKFwiOnZpc2libGVcIikuZm9jdXMoKTticmVhaztjYXNlIDM1OmIucHJldmVudERlZmF1bHQoKSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmxhc3QoKS5mb2N1cygpO2JyZWFrO2Nhc2UgMTEzOmIucHJldmVudERlZmF1bHQoKSx0aGlzLmVkaXQoYi5jdXJyZW50VGFyZ2V0KX19LHRoaXMpKS5vbihcImxvYWRfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7Yy5zdGF0dXMmJihjLm5vZGUuaWQhPT1hLmpzdHJlZS5yb290fHx0aGlzLl9kYXRhLmNvcmUubG9hZGVkfHwodGhpcy5fZGF0YS5jb3JlLmxvYWRlZD0hMCx0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKS5pZCksdGhpcy50cmlnZ2VyKFwibG9hZGVkXCIpKSx0aGlzLl9kYXRhLmNvcmUucmVhZHl8fHNldFRpbWVvdXQoYS5wcm94eShmdW5jdGlvbigpe2lmKHRoaXMuZWxlbWVudCYmIXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmZpbmQoXCIuanN0cmVlLWxvYWRpbmdcIikubGVuZ3RoKXtpZih0aGlzLl9kYXRhLmNvcmUucmVhZHk9ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCl7aWYodGhpcy5zZXR0aW5ncy5jb3JlLmV4cGFuZF9zZWxlY3RlZF9vbmxvYWQpe3ZhciBiPVtdLGMsZDtmb3IoYz0wLGQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtkPmM7YysrKWI9Yi5jb25jYXQodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbY11dLnBhcmVudHMpO2ZvcihiPWEudmFrYXRhLmFycmF5X3VuaXF1ZShiKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMub3Blbl9ub2RlKGJbY10sITEsMCl9dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJyZWFkeVwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pfXRoaXMudHJpZ2dlcihcInJlYWR5XCIpfX0sdGhpcyksMCkpfSx0aGlzKSkub24oXCJrZXlwcmVzcy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGQpe2lmKGQudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWQudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtjJiZjbGVhclRpbWVvdXQoYyksYz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yj1cIlwifSw1MDApO3ZhciBlPVN0cmluZy5mcm9tQ2hhckNvZGUoZC53aGljaCkudG9Mb3dlckNhc2UoKSxmPXRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1hbmNob3JcIikuZmlsdGVyKFwiOnZpc2libGVcIiksZz1mLmluZGV4KGkuYWN0aXZlRWxlbWVudCl8fDAsaD0hMTtpZihiKz1lLGIubGVuZ3RoPjEpe2lmKGYuc2xpY2UoZykuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGMsZCl7cmV0dXJuIDA9PT1hKGQpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoYik/KGEoZCkuZm9jdXMoKSxoPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxoKXJldHVybjtpZihmLnNsaWNlKDAsZykuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGMsZCl7cmV0dXJuIDA9PT1hKGQpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoYik/KGEoZCkuZm9jdXMoKSxoPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxoKXJldHVybn1pZihuZXcgUmVnRXhwKFwiXlwiK2UucmVwbGFjZSgvWy1cXC9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLFwiXFxcXCQmXCIpK1wiKyRcIikudGVzdChiKSl7aWYoZi5zbGljZShnKzEpLmVhY2goYS5wcm94eShmdW5jdGlvbihiLGMpe3JldHVybiBhKGMpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmNoYXJBdCgwKT09PWU/KGEoYykuZm9jdXMoKSxoPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxoKXJldHVybjtpZihmLnNsaWNlKDAsZysxKS5lYWNoKGEucHJveHkoZnVuY3Rpb24oYixjKXtyZXR1cm4gYShjKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCk9PT1lPyhhKGMpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm59fSx0aGlzKSkub24oXCJpbml0LmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt2YXIgYT10aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzO3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz1hLmRvdHMsdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPWEuc3RyaXBlcyx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPWEuaWNvbnMsdGhpcy5zZXRfdGhlbWUoYS5uYW1lfHxcImRlZmF1bHRcIixhLnVybCksdGhpcy5zZXRfdGhlbWVfdmFyaWFudChhLnZhcmlhbnQpfSx0aGlzKSkub24oXCJsb2FkaW5nLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt0aGlzW3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz9cInNob3dfZG90c1wiOlwiaGlkZV9kb3RzXCJdKCksdGhpc1t0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zP1wic2hvd19pY29uc1wiOlwiaGlkZV9pY29uc1wiXSgpLHRoaXNbdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzP1wic2hvd19zdHJpcGVzXCI6XCJoaWRlX3N0cmlwZXNcIl0oKX0sdGhpcykpLm9uKFwiYmx1ci5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXt0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsLGEoYi5jdXJyZW50VGFyZ2V0KS5maWx0ZXIoXCIuanN0cmVlLWhvdmVyZWRcIikubW91c2VsZWF2ZSgpLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIjBcIil9LHRoaXMpKS5vbihcImZvY3VzLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X25vZGUoYi5jdXJyZW50VGFyZ2V0KTtjJiZjLmlkJiYodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9Yy5pZCksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWhvdmVyZWRcIikubm90KGIuY3VycmVudFRhcmdldCkubW91c2VsZWF2ZSgpLGEoYi5jdXJyZW50VGFyZ2V0KS5tb3VzZWVudGVyKCksdGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiLFwiLTFcIil9LHRoaXMpKS5vbihcImZvY3VzLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXtpZigrbmV3IERhdGUtZD41MDAmJiF0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCl7ZD0wO3ZhciBhPXRoaXMuZ2V0X25vZGUodGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIiksITApO2EmJmEuZmluZChcIj4gLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKX19LHRoaXMpKS5vbihcIm1vdXNlZW50ZXIuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5ob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCl9LHRoaXMpKS5vbihcIm1vdXNlbGVhdmUuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5kZWhvdmVyX25vZGUoYS5jdXJyZW50VGFyZ2V0KX0sdGhpcykpfSx1bmJpbmQ6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub2ZmKFwiLmpzdHJlZVwiKSxhKGkpLm9mZihcIi5qc3RyZWUtXCIrdGhpcy5faWQpfSx0cmlnZ2VyOmZ1bmN0aW9uKGEsYil7Ynx8KGI9e30pLGIuaW5zdGFuY2U9dGhpcyx0aGlzLmVsZW1lbnQudHJpZ2dlckhhbmRsZXIoYS5yZXBsYWNlKFwiLmpzdHJlZVwiLFwiXCIpK1wiLmpzdHJlZVwiLGIpfSxnZXRfY29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudH0sZ2V0X2NvbnRhaW5lcl91bDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmZpcnN0KCl9LGdldF9zdHJpbmc6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5zZXR0aW5ncy5jb3JlLnN0cmluZ3M7cmV0dXJuIGEuaXNGdW5jdGlvbihjKT9jLmNhbGwodGhpcyxiKTpjJiZjW2JdP2NbYl06Yn0sX2ZpcnN0Q2hpbGQ6ZnVuY3Rpb24oYSl7YT1hP2EuZmlyc3RDaGlsZDpudWxsO3doaWxlKG51bGwhPT1hJiYxIT09YS5ub2RlVHlwZSlhPWEubmV4dFNpYmxpbmc7cmV0dXJuIGF9LF9uZXh0U2libGluZzpmdW5jdGlvbihhKXthPWE/YS5uZXh0U2libGluZzpudWxsO3doaWxlKG51bGwhPT1hJiYxIT09YS5ub2RlVHlwZSlhPWEubmV4dFNpYmxpbmc7cmV0dXJuIGF9LF9wcmV2aW91c1NpYmxpbmc6ZnVuY3Rpb24oYSl7YT1hP2EucHJldmlvdXNTaWJsaW5nOm51bGw7d2hpbGUobnVsbCE9PWEmJjEhPT1hLm5vZGVUeXBlKWE9YS5wcmV2aW91c1NpYmxpbmc7cmV0dXJuIGF9LGdldF9ub2RlOmZ1bmN0aW9uKGIsYyl7YiYmYi5pZCYmKGI9Yi5pZCk7dmFyIGQ7dHJ5e2lmKHRoaXMuX21vZGVsLmRhdGFbYl0pYj10aGlzLl9tb2RlbC5kYXRhW2JdO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJnRoaXMuX21vZGVsLmRhdGFbYi5yZXBsYWNlKC9eIy8sXCJcIildKWI9dGhpcy5fbW9kZWwuZGF0YVtiLnJlcGxhY2UoL14jLyxcIlwiKV07ZWxzZSBpZihcInN0cmluZ1wiPT10eXBlb2YgYiYmKGQ9YShcIiNcIitiLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpKS5sZW5ndGgmJnRoaXMuX21vZGVsLmRhdGFbZC5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV0pYj10aGlzLl9tb2RlbC5kYXRhW2QuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildO2Vsc2UgaWYoKGQ9YShiLHRoaXMuZWxlbWVudCkpLmxlbmd0aCYmdGhpcy5fbW9kZWwuZGF0YVtkLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuYXR0cihcImlkXCIpXSliPXRoaXMuX21vZGVsLmRhdGFbZC5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV07ZWxzZXtpZighKGQ9YShiLHRoaXMuZWxlbWVudCkpLmxlbmd0aHx8IWQuaGFzQ2xhc3MoXCJqc3RyZWVcIikpcmV0dXJuITE7Yj10aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdfXJldHVybiBjJiYoYj1iLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLmVsZW1lbnQ6YShcIiNcIitiLmlkLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpKSxifWNhdGNoKGUpe3JldHVybiExfX0sZ2V0X3BhdGg6ZnVuY3Rpb24oYixjLGQpe2lmKGI9Yi5wYXJlbnRzP2I6dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3R8fCFiLnBhcmVudHMpcmV0dXJuITE7dmFyIGUsZixnPVtdO2ZvcihnLnB1c2goZD9iLmlkOmIudGV4dCksZT0wLGY9Yi5wYXJlbnRzLmxlbmd0aDtmPmU7ZSsrKWcucHVzaChkP2IucGFyZW50c1tlXTp0aGlzLmdldF90ZXh0KGIucGFyZW50c1tlXSkpO3JldHVybiBnPWcucmV2ZXJzZSgpLnNsaWNlKDEpLGM/Zy5qb2luKGMpOmd9LGdldF9uZXh0X2RvbTpmdW5jdGlvbihiLGMpe3ZhciBkO2lmKGI9dGhpcy5nZXRfbm9kZShiLCEwKSxiWzBdPT09dGhpcy5lbGVtZW50WzBdKXtkPXRoaXMuX2ZpcnN0Q2hpbGQodGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0pO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodClkPXRoaXMuX25leHRTaWJsaW5nKGQpO3JldHVybiBkP2EoZCk6ITF9aWYoIWJ8fCFiLmxlbmd0aClyZXR1cm4hMTtpZihjKXtkPWJbMF07ZG8gZD10aGlzLl9uZXh0U2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO3JldHVybiBkP2EoZCk6ITF9aWYoYi5oYXNDbGFzcyhcImpzdHJlZS1vcGVuXCIpKXtkPXRoaXMuX2ZpcnN0Q2hpbGQoYi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodClkPXRoaXMuX25leHRTaWJsaW5nKGQpO2lmKG51bGwhPT1kKXJldHVybiBhKGQpfWQ9YlswXTtkbyBkPXRoaXMuX25leHRTaWJsaW5nKGQpO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodCk7cmV0dXJuIG51bGwhPT1kP2EoZCk6Yi5wYXJlbnRzVW50aWwoXCIuanN0cmVlXCIsXCIuanN0cmVlLW5vZGVcIikubmV4dEFsbChcIi5qc3RyZWUtbm9kZTp2aXNpYmxlXCIpLmZpcnN0KCl9LGdldF9wcmV2X2RvbTpmdW5jdGlvbihiLGMpe3ZhciBkO2lmKGI9dGhpcy5nZXRfbm9kZShiLCEwKSxiWzBdPT09dGhpcy5lbGVtZW50WzBdKXtkPXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdLmxhc3RDaGlsZDt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpZD10aGlzLl9wcmV2aW91c1NpYmxpbmcoZCk7cmV0dXJuIGQ/YShkKTohMX1pZighYnx8IWIubGVuZ3RoKXJldHVybiExO2lmKGMpe2Q9YlswXTtkbyBkPXRoaXMuX3ByZXZpb3VzU2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO3JldHVybiBkP2EoZCk6ITF9ZD1iWzBdO2RvIGQ9dGhpcy5fcHJldmlvdXNTaWJsaW5nKGQpO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodCk7aWYobnVsbCE9PWQpe2I9YShkKTt3aGlsZShiLmhhc0NsYXNzKFwianN0cmVlLW9wZW5cIikpYj1iLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5maXJzdCgpLmNoaWxkcmVuKFwiLmpzdHJlZS1ub2RlOnZpc2libGU6bGFzdFwiKTtyZXR1cm4gYn1yZXR1cm4gZD1iWzBdLnBhcmVudE5vZGUucGFyZW50Tm9kZSxkJiZkLmNsYXNzTmFtZSYmLTEhPT1kLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLW5vZGVcIik/YShkKTohMX0sZ2V0X3BhcmVudDpmdW5jdGlvbihiKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2IucGFyZW50OiExfSxnZXRfY2hpbGRyZW5fZG9tOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSwhMCksYVswXT09PXRoaXMuZWxlbWVudFswXT90aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZVwiKTphJiZhLmxlbmd0aD9hLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZVwiKTohMX0saXNfcGFyZW50OmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmKGEuc3RhdGUubG9hZGVkPT09ITF8fGEuY2hpbGRyZW4ubGVuZ3RoPjApfSxpc19sb2FkZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZhLnN0YXRlLmxvYWRlZH0saXNfbG9hZGluZzpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmEuc3RhdGUmJmEuc3RhdGUubG9hZGluZ30saXNfb3BlbjpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmEuc3RhdGUub3BlbmVkfSxpc19jbG9zZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZ0aGlzLmlzX3BhcmVudChhKSYmIWEuc3RhdGUub3BlbmVkfSxpc19sZWFmOmZ1bmN0aW9uKGEpe3JldHVybiF0aGlzLmlzX3BhcmVudChhKX0sbG9hZF9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZSxmLGcsaDtpZihhLmlzQXJyYXkoYikpcmV0dXJuIHRoaXMuX2xvYWRfbm9kZXMoYi5zbGljZSgpLGMpLCEwO2lmKGI9dGhpcy5nZXRfbm9kZShiKSwhYilyZXR1cm4gYyYmYy5jYWxsKHRoaXMsYiwhMSksITE7aWYoYi5zdGF0ZS5sb2FkZWQpe2ZvcihiLnN0YXRlLmxvYWRlZD0hMSxmPTAsZz1iLnBhcmVudHMubGVuZ3RoO2c+ZjtmKyspdGhpcy5fbW9kZWwuZGF0YVtiLnBhcmVudHNbZl1dLmNoaWxkcmVuX2Q9YS52YWthdGEuYXJyYXlfZmlsdGVyKHRoaXMuX21vZGVsLmRhdGFbYi5wYXJlbnRzW2ZdXS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGMpe3JldHVybi0xPT09YS5pbkFycmF5KGMsYi5jaGlsZHJlbl9kKX0pO2ZvcihkPTAsZT1iLmNoaWxkcmVuX2QubGVuZ3RoO2U+ZDtkKyspdGhpcy5fbW9kZWwuZGF0YVtiLmNoaWxkcmVuX2RbZF1dLnN0YXRlLnNlbGVjdGVkJiYoaD0hMCksZGVsZXRlIHRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2RdXTtoJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X2ZpbHRlcih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oYyl7cmV0dXJuLTE9PT1hLmluQXJyYXkoYyxiLmNoaWxkcmVuX2QpfSkpLGIuY2hpbGRyZW49W10sYi5jaGlsZHJlbl9kPVtdLGgmJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwibG9hZF9ub2RlXCIsbm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pfXJldHVybiBiLnN0YXRlLmZhaWxlZD0hMSxiLnN0YXRlLmxvYWRpbmc9ITAsdGhpcy5nZXRfbm9kZShiLCEwKS5hZGRDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMCksdGhpcy5fbG9hZF9ub2RlKGIsYS5wcm94eShmdW5jdGlvbihhKXtiPXRoaXMuX21vZGVsLmRhdGFbYi5pZF0sYi5zdGF0ZS5sb2FkaW5nPSExLGIuc3RhdGUubG9hZGVkPWEsYi5zdGF0ZS5mYWlsZWQ9IWIuc3RhdGUubG9hZGVkO3ZhciBkPXRoaXMuZ2V0X25vZGUoYiwhMCksZT0wLGY9MCxnPXRoaXMuX21vZGVsLmRhdGEsaD0hMTtmb3IoZT0wLGY9Yi5jaGlsZHJlbi5sZW5ndGg7Zj5lO2UrKylpZihnW2IuY2hpbGRyZW5bZV1dJiYhZ1tiLmNoaWxkcmVuW2VdXS5zdGF0ZS5oaWRkZW4pe2g9ITA7YnJlYWt9Yi5zdGF0ZS5sb2FkZWQmJmQmJmQubGVuZ3RoJiYoZC5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbG9zZWQganN0cmVlLW9wZW4ganN0cmVlLWxlYWZcIiksaD9cIiNcIiE9PWIuaWQmJmQuYWRkQ2xhc3MoYi5zdGF0ZS5vcGVuZWQ/XCJqc3RyZWUtb3BlblwiOlwianN0cmVlLWNsb3NlZFwiKTpkLmFkZENsYXNzKFwianN0cmVlLWxlYWZcIikpLGQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITEpLHRoaXMudHJpZ2dlcihcImxvYWRfbm9kZVwiLHtub2RlOmIsc3RhdHVzOmF9KSxjJiZjLmNhbGwodGhpcyxiLGEpfSx0aGlzKSksITB9LF9sb2FkX25vZGVzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPSEwLGY9ZnVuY3Rpb24oKXt0aGlzLl9sb2FkX25vZGVzKGEsYiwhMCl9LGc9dGhpcy5fbW9kZWwuZGF0YSxoLGksaj1bXTtmb3IoaD0wLGk9YS5sZW5ndGg7aT5oO2grKylnW2FbaF1dJiYoIWdbYVtoXV0uc3RhdGUubG9hZGVkJiYhZ1thW2hdXS5zdGF0ZS5mYWlsZWR8fCFjJiZkKSYmKHRoaXMuaXNfbG9hZGluZyhhW2hdKXx8dGhpcy5sb2FkX25vZGUoYVtoXSxmKSxlPSExKTtpZihlKXtmb3IoaD0wLGk9YS5sZW5ndGg7aT5oO2grKylnW2FbaF1dJiZnW2FbaF1dLnN0YXRlLmxvYWRlZCYmai5wdXNoKGFbaF0pO2ImJiFiLmRvbmUmJihiLmNhbGwodGhpcyxqKSxiLmRvbmU9ITApfX0sbG9hZF9hbGw6ZnVuY3Rpb24oYixjKXtpZihifHwoYj1hLmpzdHJlZS5yb290KSxiPXRoaXMuZ2V0X25vZGUoYiksIWIpcmV0dXJuITE7dmFyIGQ9W10sZT10aGlzLl9tb2RlbC5kYXRhLGY9ZVtiLmlkXS5jaGlsZHJlbl9kLGcsaDtmb3IoYi5zdGF0ZSYmIWIuc3RhdGUubG9hZGVkJiZkLnB1c2goYi5pZCksZz0wLGg9Zi5sZW5ndGg7aD5nO2crKyllW2ZbZ11dJiZlW2ZbZ11dLnN0YXRlJiYhZVtmW2ddXS5zdGF0ZS5sb2FkZWQmJmQucHVzaChmW2ddKTtkLmxlbmd0aD90aGlzLl9sb2FkX25vZGVzKGQsZnVuY3Rpb24oKXt0aGlzLmxvYWRfYWxsKGIsYyl9KTooYyYmYy5jYWxsKHRoaXMsYiksdGhpcy50cmlnZ2VyKFwibG9hZF9hbGxcIix7bm9kZTpifSkpfSxfbG9hZF9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5zZXR0aW5ncy5jb3JlLmRhdGEsZTtyZXR1cm4gZD9hLmlzRnVuY3Rpb24oZCk/ZC5jYWxsKHRoaXMsYixhLnByb3h5KGZ1bmN0aW9uKGQpe2Q9PT0hMT9jLmNhbGwodGhpcywhMSk6dGhpc1tcInN0cmluZ1wiPT10eXBlb2YgZD9cIl9hcHBlbmRfaHRtbF9kYXRhXCI6XCJfYXBwZW5kX2pzb25fZGF0YVwiXShiLFwic3RyaW5nXCI9PXR5cGVvZiBkP2EoYS5wYXJzZUhUTUwoZCkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pOmQsZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KX0sdGhpcykpOlwib2JqZWN0XCI9PXR5cGVvZiBkP2QudXJsPyhkPWEuZXh0ZW5kKCEwLHt9LGQpLGEuaXNGdW5jdGlvbihkLnVybCkmJihkLnVybD1kLnVybC5jYWxsKHRoaXMsYikpLGEuaXNGdW5jdGlvbihkLmRhdGEpJiYoZC5kYXRhPWQuZGF0YS5jYWxsKHRoaXMsYikpLGEuYWpheChkKS5kb25lKGEucHJveHkoZnVuY3Rpb24oZCxlLGYpe3ZhciBnPWYuZ2V0UmVzcG9uc2VIZWFkZXIoXCJDb250ZW50LVR5cGVcIik7cmV0dXJuIGcmJi0xIT09Zy5pbmRleE9mKFwianNvblwiKXx8XCJvYmplY3RcIj09dHlwZW9mIGQ/dGhpcy5fYXBwZW5kX2pzb25fZGF0YShiLGQsZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KTpnJiYtMSE9PWcuaW5kZXhPZihcImh0bWxcIil8fFwic3RyaW5nXCI9PXR5cGVvZiBkP3RoaXMuX2FwcGVuZF9odG1sX2RhdGEoYixhKGEucGFyc2VIVE1MKGQpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNFwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDpiLmlkLHhocjpmfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLGMuY2FsbCh0aGlzLCExKSl9LHRoaXMpKS5mYWlsKGEucHJveHkoZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsITEpLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImFqYXhcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA0XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOmIuaWQseGhyOmF9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcil9LHRoaXMpKSk6KGU9YS5pc0FycmF5KGQpfHxhLmlzUGxhaW5PYmplY3QoZCk/SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkKSk6ZCxiLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLl9hcHBlbmRfanNvbl9kYXRhKGIsZSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJub2RhdGFcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA1XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOmIuaWR9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksYy5jYWxsKHRoaXMsITEpKSk6XCJzdHJpbmdcIj09dHlwZW9mIGQ/Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2h0bWxfZGF0YShiLGEoYS5wYXJzZUhUTUwoZCkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pLGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLGEpfSk6KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcIm5vZGF0YVwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDZcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6Yi5pZH0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSxjLmNhbGwodGhpcywhMSkpOmMuY2FsbCh0aGlzLCExKTpiLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLl9hcHBlbmRfaHRtbF9kYXRhKGIsdGhpcy5fZGF0YS5jb3JlLm9yaWdpbmFsX2NvbnRhaW5lcl9odG1sLmNsb25lKCEwKSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOmMuY2FsbCh0aGlzLCExKX0sX25vZGVfY2hhbmdlZDpmdW5jdGlvbihhKXthPXRoaXMuZ2V0X25vZGUoYSksYSYmdGhpcy5fbW9kZWwuY2hhbmdlZC5wdXNoKGEuaWQpfSxfYXBwZW5kX2h0bWxfZGF0YTpmdW5jdGlvbihiLGMsZCl7Yj10aGlzLmdldF9ub2RlKGIpLGIuY2hpbGRyZW49W10sYi5jaGlsZHJlbl9kPVtdO3ZhciBlPWMuaXMoXCJ1bFwiKT9jLmNoaWxkcmVuKCk6YyxmPWIuaWQsZz1bXSxoPVtdLGk9dGhpcy5fbW9kZWwuZGF0YSxqPWlbZl0saz10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoLGwsbSxuO2ZvcihlLmVhY2goYS5wcm94eShmdW5jdGlvbihiLGMpe2w9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9odG1sKGEoYyksZixqLnBhcmVudHMuY29uY2F0KCkpLGwmJihnLnB1c2gobCksaC5wdXNoKGwpLGlbbF0uY2hpbGRyZW5fZC5sZW5ndGgmJihoPWguY29uY2F0KGlbbF0uY2hpbGRyZW5fZCkpKX0sdGhpcykpLGouY2hpbGRyZW49ZyxqLmNoaWxkcmVuX2Q9aCxtPTAsbj1qLnBhcmVudHMubGVuZ3RoO24+bTttKyspaVtqLnBhcmVudHNbbV1dLmNoaWxkcmVuX2Q9aVtqLnBhcmVudHNbbV1dLmNoaWxkcmVuX2QuY29uY2F0KGgpO3RoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmgscGFyZW50OmZ9KSxmIT09YS5qc3RyZWUucm9vdD8odGhpcy5fbm9kZV9jaGFuZ2VkKGYpLHRoaXMucmVkcmF3KCkpOih0aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcIi5qc3RyZWUtaW5pdGlhbC1ub2RlXCIpLnJlbW92ZSgpLHRoaXMucmVkcmF3KCEwKSksdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCE9PWsmJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwibW9kZWxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KSxkLmNhbGwodGhpcywhMCl9LF9hcHBlbmRfanNvbl9kYXRhOmZ1bmN0aW9uKGIsYyxkLGUpe2lmKG51bGwhPT10aGlzLmVsZW1lbnQpe2I9dGhpcy5nZXRfbm9kZShiKSxiLmNoaWxkcmVuPVtdLGIuY2hpbGRyZW5fZD1bXSxjLmQmJihjPWMuZCxcInN0cmluZ1wiPT10eXBlb2YgYyYmKGM9SlNPTi5wYXJzZShjKSkpLGEuaXNBcnJheShjKXx8KGM9W2NdKTt2YXIgZj1udWxsLGc9e2RmOnRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsZGF0OmMscGFyOmIuaWQsbTp0aGlzLl9tb2RlbC5kYXRhLHRfaWQ6dGhpcy5faWQsdF9jbnQ6dGhpcy5fY250LHNlbDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9LGg9ZnVuY3Rpb24oYSxiKXthLmRhdGEmJihhPWEuZGF0YSk7dmFyIGM9YS5kYXQsZD1hLnBhcixlPVtdLGY9W10sZz1bXSxoPWEuZGYsaT1hLnRfaWQsaj1hLnRfY250LGs9YS5tLGw9a1tkXSxtPWEuc2VsLG4sbyxwLHEscj1mdW5jdGlvbihhLGMsZCl7ZD1kP2QuY29uY2F0KCk6W10sYyYmZC51bnNoaWZ0KGMpO3ZhciBlPWEuaWQudG9TdHJpbmcoKSxmLGksaixsLG09e2lkOmUsdGV4dDphLnRleHR8fFwiXCIsaWNvbjphLmljb24hPT1iP2EuaWNvbjohMCxwYXJlbnQ6YyxwYXJlbnRzOmQsY2hpbGRyZW46YS5jaGlsZHJlbnx8W10sY2hpbGRyZW5fZDphLmNoaWxkcmVuX2R8fFtdLGRhdGE6YS5kYXRhLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoZiBpbiBoKWguaGFzT3duUHJvcGVydHkoZikmJihtLnN0YXRlW2ZdPWhbZl0pO2lmKGEmJmEuZGF0YSYmYS5kYXRhLmpzdHJlZSYmYS5kYXRhLmpzdHJlZS5pY29uJiYobS5pY29uPWEuZGF0YS5qc3RyZWUuaWNvbiksbS5pY29uIT09YiYmbnVsbCE9PW0uaWNvbiYmXCJcIiE9PW0uaWNvbnx8KG0uaWNvbj0hMCksYSYmYS5kYXRhJiYobS5kYXRhPWEuZGF0YSxhLmRhdGEuanN0cmVlKSlmb3IoZiBpbiBhLmRhdGEuanN0cmVlKWEuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkoZikmJihtLnN0YXRlW2ZdPWEuZGF0YS5qc3RyZWVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLnN0YXRlKWZvcihmIGluIGEuc3RhdGUpYS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShmKSYmKG0uc3RhdGVbZl09YS5zdGF0ZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEubGlfYXR0cilmb3IoZiBpbiBhLmxpX2F0dHIpYS5saV9hdHRyLmhhc093blByb3BlcnR5KGYpJiYobS5saV9hdHRyW2ZdPWEubGlfYXR0cltmXSk7aWYobS5saV9hdHRyLmlkfHwobS5saV9hdHRyLmlkPWUpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoZiBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKG0uYV9hdHRyW2ZdPWEuYV9hdHRyW2ZdKTtmb3IoYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbj09PSEwJiYobS5zdGF0ZS5sb2FkZWQ9ITEsbS5jaGlsZHJlbj1bXSxtLmNoaWxkcmVuX2Q9W10pLGtbbS5pZF09bSxmPTAsaT1tLmNoaWxkcmVuLmxlbmd0aDtpPmY7ZisrKWo9cihrW20uY2hpbGRyZW5bZl1dLG0uaWQsZCksbD1rW2pdLG0uY2hpbGRyZW5fZC5wdXNoKGopLGwuY2hpbGRyZW5fZC5sZW5ndGgmJihtLmNoaWxkcmVuX2Q9bS5jaGlsZHJlbl9kLmNvbmNhdChsLmNoaWxkcmVuX2QpKTtyZXR1cm4gZGVsZXRlIGEuZGF0YSxkZWxldGUgYS5jaGlsZHJlbixrW20uaWRdLm9yaWdpbmFsPWEsbS5zdGF0ZS5zZWxlY3RlZCYmZy5wdXNoKG0uaWQpLG0uaWR9LHM9ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT0hMSxmLGwsbSxuLG87ZG8gZT1cImpcIitpK1wiX1wiKyArK2o7d2hpbGUoa1tlXSk7bz17aWQ6ITEsdGV4dDpcInN0cmluZ1wiPT10eXBlb2YgYT9hOlwiXCIsaWNvbjpcIm9iamVjdFwiPT10eXBlb2YgYSYmYS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoZiBpbiBoKWguaGFzT3duUHJvcGVydHkoZikmJihvLnN0YXRlW2ZdPWhbZl0pO2lmKGEmJmEuaWQmJihvLmlkPWEuaWQudG9TdHJpbmcoKSksYSYmYS50ZXh0JiYoby50ZXh0PWEudGV4dCksYSYmYS5kYXRhJiZhLmRhdGEuanN0cmVlJiZhLmRhdGEuanN0cmVlLmljb24mJihvLmljb249YS5kYXRhLmpzdHJlZS5pY29uKSxvLmljb24hPT1iJiZudWxsIT09by5pY29uJiZcIlwiIT09by5pY29ufHwoby5pY29uPSEwKSxhJiZhLmRhdGEmJihvLmRhdGE9YS5kYXRhLGEuZGF0YS5qc3RyZWUpKWZvcihmIGluIGEuZGF0YS5qc3RyZWUpYS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShmKSYmKG8uc3RhdGVbZl09YS5kYXRhLmpzdHJlZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEuc3RhdGUpZm9yKGYgaW4gYS5zdGF0ZSlhLnN0YXRlLmhhc093blByb3BlcnR5KGYpJiYoby5zdGF0ZVtmXT1hLnN0YXRlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5saV9hdHRyKWZvcihmIGluIGEubGlfYXR0cilhLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihvLmxpX2F0dHJbZl09YS5saV9hdHRyW2ZdKTtpZihvLmxpX2F0dHIuaWQmJiFvLmlkJiYoby5pZD1vLmxpX2F0dHIuaWQudG9TdHJpbmcoKSksby5pZHx8KG8uaWQ9ZSksby5saV9hdHRyLmlkfHwoby5saV9hdHRyLmlkPW8uaWQpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoZiBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKG8uYV9hdHRyW2ZdPWEuYV9hdHRyW2ZdKTtpZihhJiZhLmNoaWxkcmVuJiZhLmNoaWxkcmVuLmxlbmd0aCl7Zm9yKGY9MCxsPWEuY2hpbGRyZW4ubGVuZ3RoO2w+ZjtmKyspbT1zKGEuY2hpbGRyZW5bZl0sby5pZCxkKSxuPWtbbV0sby5jaGlsZHJlbi5wdXNoKG0pLG4uY2hpbGRyZW5fZC5sZW5ndGgmJihvLmNoaWxkcmVuX2Q9by5jaGlsZHJlbl9kLmNvbmNhdChuLmNoaWxkcmVuX2QpKTtvLmNoaWxkcmVuX2Q9by5jaGlsZHJlbl9kLmNvbmNhdChvLmNoaWxkcmVuKX1yZXR1cm4gYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbj09PSEwJiYoby5zdGF0ZS5sb2FkZWQ9ITEsby5jaGlsZHJlbj1bXSxvLmNoaWxkcmVuX2Q9W10pLGRlbGV0ZSBhLmRhdGEsZGVsZXRlIGEuY2hpbGRyZW4sby5vcmlnaW5hbD1hLGtbby5pZF09byxvLnN0YXRlLnNlbGVjdGVkJiZnLnB1c2goby5pZCksby5pZH07aWYoYy5sZW5ndGgmJmNbMF0uaWQhPT1iJiZjWzBdLnBhcmVudCE9PWIpe2ZvcihvPTAscD1jLmxlbmd0aDtwPm87bysrKWNbb10uY2hpbGRyZW58fChjW29dLmNoaWxkcmVuPVtdKSxrW2Nbb10uaWQudG9TdHJpbmcoKV09Y1tvXTtmb3Iobz0wLHA9Yy5sZW5ndGg7cD5vO28rKylrW2Nbb10ucGFyZW50LnRvU3RyaW5nKCldLmNoaWxkcmVuLnB1c2goY1tvXS5pZC50b1N0cmluZygpKSxsLmNoaWxkcmVuX2QucHVzaChjW29dLmlkLnRvU3RyaW5nKCkpO2ZvcihvPTAscD1sLmNoaWxkcmVuLmxlbmd0aDtwPm87bysrKW49cihrW2wuY2hpbGRyZW5bb11dLGQsbC5wYXJlbnRzLmNvbmNhdCgpKSxmLnB1c2gobiksa1tuXS5jaGlsZHJlbl9kLmxlbmd0aCYmKGY9Zi5jb25jYXQoa1tuXS5jaGlsZHJlbl9kKSk7Zm9yKG89MCxwPWwucGFyZW50cy5sZW5ndGg7cD5vO28rKylrW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZD1rW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZC5jb25jYXQoZik7cT17Y250OmosbW9kOmssc2VsOm0scGFyOmQsZHBjOmYsYWRkOmd9fWVsc2V7Zm9yKG89MCxwPWMubGVuZ3RoO3A+bztvKyspbj1zKGNbb10sZCxsLnBhcmVudHMuY29uY2F0KCkpLG4mJihlLnB1c2gobiksZi5wdXNoKG4pLGtbbl0uY2hpbGRyZW5fZC5sZW5ndGgmJihmPWYuY29uY2F0KGtbbl0uY2hpbGRyZW5fZCkpKTtmb3IobC5jaGlsZHJlbj1lLGwuY2hpbGRyZW5fZD1mLG89MCxwPWwucGFyZW50cy5sZW5ndGg7cD5vO28rKylrW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZD1rW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZC5jb25jYXQoZik7cT17Y250OmosbW9kOmssc2VsOm0scGFyOmQsZHBjOmYsYWRkOmd9fXJldHVyblwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cuZG9jdW1lbnQ/cTp2b2lkIHBvc3RNZXNzYWdlKHEpfSxpPWZ1bmN0aW9uKGIsYyl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7dGhpcy5fY250PWIuY250O3ZhciBlLGY9dGhpcy5fbW9kZWwuZGF0YTtmb3IoZSBpbiBmKWYuaGFzT3duUHJvcGVydHkoZSkmJmZbZV0uc3RhdGUmJmZbZV0uc3RhdGUubG9hZGluZyYmYi5tb2RbZV0mJihiLm1vZFtlXS5zdGF0ZS5sb2FkaW5nPSEwKTtpZih0aGlzLl9tb2RlbC5kYXRhPWIubW9kLGMpe3ZhciBnLGg9Yi5hZGQsaT1iLnNlbCxqPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5zbGljZSgpO2lmKGY9dGhpcy5fbW9kZWwuZGF0YSxpLmxlbmd0aCE9PWoubGVuZ3RofHxhLnZha2F0YS5hcnJheV91bmlxdWUoaS5jb25jYXQoaikpLmxlbmd0aCE9PWkubGVuZ3RoKXtmb3IoZT0wLGc9aS5sZW5ndGg7Zz5lO2UrKyktMT09PWEuaW5BcnJheShpW2VdLGgpJiYtMT09PWEuaW5BcnJheShpW2VdLGopJiYoZltpW2VdXS5zdGF0ZS5zZWxlY3RlZD0hMSk7Zm9yKGU9MCxnPWoubGVuZ3RoO2c+ZTtlKyspLTE9PT1hLmluQXJyYXkoaltlXSxpKSYmKGZbaltlXV0uc3RhdGUuc2VsZWN0ZWQ9ITApfX1iLmFkZC5sZW5ndGgmJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChiLmFkZCkpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmIuZHBjLHBhcmVudDpiLnBhcn0pLGIucGFyIT09YS5qc3RyZWUucm9vdD8odGhpcy5fbm9kZV9jaGFuZ2VkKGIucGFyKSx0aGlzLnJlZHJhdygpKTp0aGlzLnJlZHJhdyghMCksYi5hZGQubGVuZ3RoJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcIm1vZGVsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksZC5jYWxsKHRoaXMsITApfX07aWYodGhpcy5zZXR0aW5ncy5jb3JlLndvcmtlciYmd2luZG93LkJsb2ImJndpbmRvdy5VUkwmJndpbmRvdy5Xb3JrZXIpdHJ5e251bGw9PT10aGlzLl93cmsmJih0aGlzLl93cms9d2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IHdpbmRvdy5CbG9iKFtcInNlbGYub25tZXNzYWdlID0gXCIraC50b1N0cmluZygpXSx7dHlwZTpcInRleHQvamF2YXNjcmlwdFwifSkpKSwhdGhpcy5fZGF0YS5jb3JlLndvcmtpbmd8fGU/KHRoaXMuX2RhdGEuY29yZS53b3JraW5nPSEwLGY9bmV3IHdpbmRvdy5Xb3JrZXIodGhpcy5fd3JrKSxmLm9ubWVzc2FnZT1hLnByb3h5KGZ1bmN0aW9uKGEpe2kuY2FsbCh0aGlzLGEuZGF0YSwhMCk7dHJ5e2YudGVybWluYXRlKCksZj1udWxsfWNhdGNoKGIpe310aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMX0sdGhpcyksZy5wYXI/Zi5wb3N0TWVzc2FnZShnKTp0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMSk6dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5wdXNoKFtiLGMsZCwhMF0pfWNhdGNoKGope2kuY2FsbCh0aGlzLGgoZyksITEpLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUubGVuZ3RoP3RoaXMuX2FwcGVuZF9qc29uX2RhdGEuYXBwbHkodGhpcyx0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLnNoaWZ0KCkpOnRoaXMuX2RhdGEuY29yZS53b3JraW5nPSExfWVsc2UgaS5jYWxsKHRoaXMsaChnKSwhMSl9fSxfcGFyc2VfbW9kZWxfZnJvbV9odG1sOmZ1bmN0aW9uKGMsZCxlKXtlPWU/W10uY29uY2F0KGUpOltdLGQmJmUudW5zaGlmdChkKTt2YXIgZixnLGg9dGhpcy5fbW9kZWwuZGF0YSxpPXtpZDohMSx0ZXh0OiExLGljb246ITAscGFyZW50OmQscGFyZW50czplLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfSxqLGssbDtmb3IoaiBpbiB0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlKXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUuaGFzT3duUHJvcGVydHkoaikmJihpLnN0YXRlW2pdPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGVbal0pO2lmKGs9YS52YWthdGEuYXR0cmlidXRlcyhjLCEwKSxhLmVhY2goayxmdW5jdGlvbihiLGMpe3JldHVybiBjPWEudHJpbShjKSxjLmxlbmd0aD8oaS5saV9hdHRyW2JdPWMsdm9pZChcImlkXCI9PT1iJiYoaS5pZD1jLnRvU3RyaW5nKCkpKSk6ITB9KSxrPWMuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCksay5sZW5ndGgmJihrPWEudmFrYXRhLmF0dHJpYnV0ZXMoaywhMCksYS5lYWNoKGssZnVuY3Rpb24oYixjKXtjPWEudHJpbShjKSxjLmxlbmd0aCYmKGkuYV9hdHRyW2JdPWMpfSkpLGs9Yy5jaGlsZHJlbihcImFcIikuZmlyc3QoKS5sZW5ndGg/Yy5jaGlsZHJlbihcImFcIikuZmlyc3QoKS5jbG9uZSgpOmMuY2xvbmUoKSxrLmNoaWxkcmVuKFwiaW5zLCBpLCB1bFwiKS5yZW1vdmUoKSxrPWsuaHRtbCgpLGs9YShcIjxkaXYgLz5cIikuaHRtbChrKSxpLnRleHQ9dGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQ/ay50ZXh0KCk6ay5odG1sKCksaz1jLmRhdGEoKSxpLmRhdGE9az9hLmV4dGVuZCghMCx7fSxrKTpudWxsLGkuc3RhdGUub3BlbmVkPWMuaGFzQ2xhc3MoXCJqc3RyZWUtb3BlblwiKSxpLnN0YXRlLnNlbGVjdGVkPWMuY2hpbGRyZW4oXCJhXCIpLmhhc0NsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksaS5zdGF0ZS5kaXNhYmxlZD1jLmNoaWxkcmVuKFwiYVwiKS5oYXNDbGFzcyhcImpzdHJlZS1kaXNhYmxlZFwiKSxpLmRhdGEmJmkuZGF0YS5qc3RyZWUpZm9yKGogaW4gaS5kYXRhLmpzdHJlZSlpLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGopJiYoaS5zdGF0ZVtqXT1pLmRhdGEuanN0cmVlW2pdKTtrPWMuY2hpbGRyZW4oXCJhXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIiksay5sZW5ndGgmJihpLmljb249ay5oYXNDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpPyExOmsuYXR0cihcInJlbFwiKSksaS5zdGF0ZS5pY29uIT09YiYmKGkuaWNvbj1pLnN0YXRlLmljb24pLGkuaWNvbiE9PWImJm51bGwhPT1pLmljb24mJlwiXCIhPT1pLmljb258fChpLmljb249ITApLGs9Yy5jaGlsZHJlbihcInVsXCIpLmNoaWxkcmVuKFwibGlcIik7ZG8gbD1cImpcIit0aGlzLl9pZCtcIl9cIisgKyt0aGlzLl9jbnQ7d2hpbGUoaFtsXSk7cmV0dXJuIGkuaWQ9aS5saV9hdHRyLmlkP2kubGlfYXR0ci5pZC50b1N0cmluZygpOmwsay5sZW5ndGg/KGsuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGIsYyl7Zj10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2h0bWwoYShjKSxpLmlkLGUpLGc9dGhpcy5fbW9kZWwuZGF0YVtmXSxpLmNoaWxkcmVuLnB1c2goZiksZy5jaGlsZHJlbl9kLmxlbmd0aCYmKGkuY2hpbGRyZW5fZD1pLmNoaWxkcmVuX2QuY29uY2F0KGcuY2hpbGRyZW5fZCkpfSx0aGlzKSksaS5jaGlsZHJlbl9kPWkuY2hpbGRyZW5fZC5jb25jYXQoaS5jaGlsZHJlbikpOmMuaGFzQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpJiYoaS5zdGF0ZS5sb2FkZWQ9ITEpLGkubGlfYXR0cltcImNsYXNzXCJdJiYoaS5saV9hdHRyW1wiY2xhc3NcIl09aS5saV9hdHRyW1wiY2xhc3NcIl0ucmVwbGFjZShcImpzdHJlZS1jbG9zZWRcIixcIlwiKS5yZXBsYWNlKFwianN0cmVlLW9wZW5cIixcIlwiKSksaS5hX2F0dHJbXCJjbGFzc1wiXSYmKGkuYV9hdHRyW1wiY2xhc3NcIl09aS5hX2F0dHJbXCJjbGFzc1wiXS5yZXBsYWNlKFwianN0cmVlLWNsaWNrZWRcIixcIlwiKS5yZXBsYWNlKFwianN0cmVlLWRpc2FibGVkXCIsXCJcIikpLGhbaS5pZF09aSxpLnN0YXRlLnNlbGVjdGVkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQucHVzaChpLmlkKSxpLmlkfSxfcGFyc2VfbW9kZWxfZnJvbV9mbGF0X2pzb246ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT1hLmlkLnRvU3RyaW5nKCksZj10aGlzLl9tb2RlbC5kYXRhLGc9dGhpcy5fbW9kZWwuZGVmYXVsdF9zdGF0ZSxoLGksaixrLGw9e2lkOmUsdGV4dDphLnRleHR8fFwiXCIsaWNvbjphLmljb24hPT1iP2EuaWNvbjohMCxwYXJlbnQ6YyxwYXJlbnRzOmQsY2hpbGRyZW46YS5jaGlsZHJlbnx8W10sY2hpbGRyZW5fZDphLmNoaWxkcmVuX2R8fFtdLGRhdGE6YS5kYXRhLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoaCBpbiBnKWcuaGFzT3duUHJvcGVydHkoaCkmJihsLnN0YXRlW2hdPWdbaF0pO2lmKGEmJmEuZGF0YSYmYS5kYXRhLmpzdHJlZSYmYS5kYXRhLmpzdHJlZS5pY29uJiYobC5pY29uPWEuZGF0YS5qc3RyZWUuaWNvbiksbC5pY29uIT09YiYmbnVsbCE9PWwuaWNvbiYmXCJcIiE9PWwuaWNvbnx8KGwuaWNvbj0hMCksYSYmYS5kYXRhJiYobC5kYXRhPWEuZGF0YSxhLmRhdGEuanN0cmVlKSlmb3IoaCBpbiBhLmRhdGEuanN0cmVlKWEuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkoaCkmJihsLnN0YXRlW2hdPWEuZGF0YS5qc3RyZWVbaF0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLnN0YXRlKWZvcihoIGluIGEuc3RhdGUpYS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShoKSYmKGwuc3RhdGVbaF09YS5zdGF0ZVtoXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEubGlfYXR0cilmb3IoaCBpbiBhLmxpX2F0dHIpYS5saV9hdHRyLmhhc093blByb3BlcnR5KGgpJiYobC5saV9hdHRyW2hdPWEubGlfYXR0cltoXSk7aWYobC5saV9hdHRyLmlkfHwobC5saV9hdHRyLmlkPWUpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoaCBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShoKSYmKGwuYV9hdHRyW2hdPWEuYV9hdHRyW2hdKTtmb3IoYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbj09PSEwJiYobC5zdGF0ZS5sb2FkZWQ9ITEsbC5jaGlsZHJlbj1bXSxsLmNoaWxkcmVuX2Q9W10pLGZbbC5pZF09bCxoPTAsaT1sLmNoaWxkcmVuLmxlbmd0aDtpPmg7aCsrKWo9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9mbGF0X2pzb24oZltsLmNoaWxkcmVuW2hdXSxsLmlkLGQpLGs9ZltqXSxsLmNoaWxkcmVuX2QucHVzaChqKSxrLmNoaWxkcmVuX2QubGVuZ3RoJiYobC5jaGlsZHJlbl9kPWwuY2hpbGRyZW5fZC5jb25jYXQoay5jaGlsZHJlbl9kKSk7cmV0dXJuIGRlbGV0ZSBhLmRhdGEsZGVsZXRlIGEuY2hpbGRyZW4sZltsLmlkXS5vcmlnaW5hbD1hLGwuc3RhdGUuc2VsZWN0ZWQmJnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGwuaWQpLGwuaWR9LF9wYXJzZV9tb2RlbF9mcm9tX2pzb246ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT0hMSxmLGcsaCxpLGo9dGhpcy5fbW9kZWwuZGF0YSxrPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsbDtkbyBlPVwialwiK3RoaXMuX2lkK1wiX1wiKyArK3RoaXMuX2NudDt3aGlsZShqW2VdKTtsPXtpZDohMSx0ZXh0Olwic3RyaW5nXCI9PXR5cGVvZiBhP2E6XCJcIixpY29uOlwib2JqZWN0XCI9PXR5cGVvZiBhJiZhLmljb24hPT1iP2EuaWNvbjohMCxwYXJlbnQ6YyxwYXJlbnRzOmQsY2hpbGRyZW46W10sY2hpbGRyZW5fZDpbXSxkYXRhOm51bGwsc3RhdGU6e30sbGlfYXR0cjp7aWQ6ITF9LGFfYXR0cjp7aHJlZjpcIiNcIn0sb3JpZ2luYWw6ITF9O2ZvcihmIGluIGspay5oYXNPd25Qcm9wZXJ0eShmKSYmKGwuc3RhdGVbZl09a1tmXSk7aWYoYSYmYS5pZCYmKGwuaWQ9YS5pZC50b1N0cmluZygpKSxhJiZhLnRleHQmJihsLnRleHQ9YS50ZXh0KSxhJiZhLmRhdGEmJmEuZGF0YS5qc3RyZWUmJmEuZGF0YS5qc3RyZWUuaWNvbiYmKGwuaWNvbj1hLmRhdGEuanN0cmVlLmljb24pLGwuaWNvbiE9PWImJm51bGwhPT1sLmljb24mJlwiXCIhPT1sLmljb258fChsLmljb249ITApLGEmJmEuZGF0YSYmKGwuZGF0YT1hLmRhdGEsYS5kYXRhLmpzdHJlZSkpZm9yKGYgaW4gYS5kYXRhLmpzdHJlZSlhLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGYpJiYobC5zdGF0ZVtmXT1hLmRhdGEuanN0cmVlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5zdGF0ZSlmb3IoZiBpbiBhLnN0YXRlKWEuc3RhdGUuaGFzT3duUHJvcGVydHkoZikmJihsLnN0YXRlW2ZdPWEuc3RhdGVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmxpX2F0dHIpZm9yKGYgaW4gYS5saV9hdHRyKWEubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKGwubGlfYXR0cltmXT1hLmxpX2F0dHJbZl0pO2lmKGwubGlfYXR0ci5pZCYmIWwuaWQmJihsLmlkPWwubGlfYXR0ci5pZC50b1N0cmluZygpKSxsLmlkfHwobC5pZD1lKSxsLmxpX2F0dHIuaWR8fChsLmxpX2F0dHIuaWQ9bC5pZCksYSYmXCJvYmplY3RcIj09dHlwZW9mIGEuYV9hdHRyKWZvcihmIGluIGEuYV9hdHRyKWEuYV9hdHRyLmhhc093blByb3BlcnR5KGYpJiYobC5hX2F0dHJbZl09YS5hX2F0dHJbZl0pO2lmKGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW4ubGVuZ3RoKXtmb3IoZj0wLGc9YS5jaGlsZHJlbi5sZW5ndGg7Zz5mO2YrKyloPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihhLmNoaWxkcmVuW2ZdLGwuaWQsZCksaT1qW2hdLGwuY2hpbGRyZW4ucHVzaChoKSxpLmNoaWxkcmVuX2QubGVuZ3RoJiYobC5jaGlsZHJlbl9kPWwuY2hpbGRyZW5fZC5jb25jYXQoaS5jaGlsZHJlbl9kKSk7bC5jaGlsZHJlbl9kPWwuY2hpbGRyZW5fZC5jb25jYXQobC5jaGlsZHJlbil9cmV0dXJuIGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKGwuc3RhdGUubG9hZGVkPSExLGwuY2hpbGRyZW49W10sbC5jaGlsZHJlbl9kPVtdKSxkZWxldGUgYS5kYXRhLGRlbGV0ZSBhLmNoaWxkcmVuLGwub3JpZ2luYWw9YSxqW2wuaWRdPWwsbC5zdGF0ZS5zZWxlY3RlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2gobC5pZCksbC5pZH0sX3JlZHJhdzpmdW5jdGlvbigpe3ZhciBiPXRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3P3RoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW4uY29uY2F0KFtdKTp0aGlzLl9tb2RlbC5jaGFuZ2VkLmNvbmNhdChbXSksYz1pLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSxkLGUsZixnPXRoaXMuX2RhdGEuY29yZS5mb2N1c2VkO2ZvcihlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKWQ9dGhpcy5yZWRyYXdfbm9kZShiW2VdLCEwLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3KSxkJiZ0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyYmYy5hcHBlbmRDaGlsZChkKTt0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyYmKGMuY2xhc3NOYW1lPXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdLmNsYXNzTmFtZSxjLnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLHRoaXMuZWxlbWVudC5lbXB0eSgpLmFwcGVuZChjKSksbnVsbCE9PWcmJihkPXRoaXMuZ2V0X25vZGUoZywhMCksZCYmZC5sZW5ndGgmJmQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKVswXSE9PWkuYWN0aXZlRWxlbWVudD9kLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTp0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsKSx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMSx0aGlzLl9tb2RlbC5jaGFuZ2VkPVtdLHRoaXMudHJpZ2dlcihcInJlZHJhd1wiLHtub2RlczpifSl9LHJlZHJhdzpmdW5jdGlvbihhKXthJiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX3JlZHJhdygpfSxkcmF3X2NoaWxkcmVuOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X25vZGUoYiksZD0hMSxlPSExLGY9ITEsZz1pO2lmKCFjKXJldHVybiExO2lmKGMuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiB0aGlzLnJlZHJhdyghMCk7aWYoYj10aGlzLmdldF9ub2RlKGIsITApLCFifHwhYi5sZW5ndGgpcmV0dXJuITE7aWYoYi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikucmVtb3ZlKCksYj1iWzBdLGMuY2hpbGRyZW4ubGVuZ3RoJiZjLnN0YXRlLmxvYWRlZCl7Zm9yKGY9Zy5jcmVhdGVFbGVtZW50KFwiVUxcIiksZi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSxmLmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGQ9MCxlPWMuY2hpbGRyZW4ubGVuZ3RoO2U+ZDtkKyspZi5hcHBlbmRDaGlsZCh0aGlzLnJlZHJhd19ub2RlKGMuY2hpbGRyZW5bZF0sITAsITApKTtiLmFwcGVuZENoaWxkKGYpfX0scmVkcmF3X25vZGU6ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGY9dGhpcy5nZXRfbm9kZShiKSxnPSExLGg9ITEsaz0hMSxsPSExLG09ITEsbj0hMSxvPVwiXCIscD1pLHE9dGhpcy5fbW9kZWwuZGF0YSxyPSExLHM9ITEsdD1udWxsLHU9MCx2PTAsdz0hMSx4PSExO2lmKCFmKXJldHVybiExO2lmKGYuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiB0aGlzLnJlZHJhdyghMCk7aWYoYz1jfHwwPT09Zi5jaGlsZHJlbi5sZW5ndGgsYj1pLnF1ZXJ5U2VsZWN0b3I/dGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoXCIjXCIrKC0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZihmLmlkWzBdKT9cIlxcXFwzXCIrZi5pZFswXStcIiBcIitmLmlkLnN1YnN0cigxKS5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6Zi5pZC5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIikpKTppLmdldEVsZW1lbnRCeUlkKGYuaWQpKWI9YShiKSxcbmR8fChnPWIucGFyZW50KCkucGFyZW50KClbMF0sZz09PXRoaXMuZWxlbWVudFswXSYmKGc9bnVsbCksaD1iLmluZGV4KCkpLGN8fCFmLmNoaWxkcmVuLmxlbmd0aHx8Yi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikubGVuZ3RofHwoYz0hMCksY3x8KGs9Yi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pLHI9Yi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpWzBdPT09aS5hY3RpdmVFbGVtZW50LGIucmVtb3ZlKCk7ZWxzZSBpZihjPSEwLCFkKXtpZihnPWYucGFyZW50IT09YS5qc3RyZWUucm9vdD9hKFwiI1wiK2YucGFyZW50LnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpWzBdOm51bGwsIShudWxsPT09Z3x8ZyYmcVtmLnBhcmVudF0uc3RhdGUub3BlbmVkKSlyZXR1cm4hMTtoPWEuaW5BcnJheShmLmlkLG51bGw9PT1nP3FbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW46cVtmLnBhcmVudF0uY2hpbGRyZW4pfWI9ai5jbG9uZU5vZGUoITApLG89XCJqc3RyZWUtbm9kZSBcIjtmb3IobCBpbiBmLmxpX2F0dHIpaWYoZi5saV9hdHRyLmhhc093blByb3BlcnR5KGwpKXtpZihcImlkXCI9PT1sKWNvbnRpbnVlO1wiY2xhc3NcIiE9PWw/Yi5zZXRBdHRyaWJ1dGUobCxmLmxpX2F0dHJbbF0pOm8rPWYubGlfYXR0cltsXX1mb3IoZi5hX2F0dHIuaWR8fChmLmFfYXR0ci5pZD1mLmlkK1wiX2FuY2hvclwiKSxiLnNldEF0dHJpYnV0ZShcImFyaWEtc2VsZWN0ZWRcIiwhIWYuc3RhdGUuc2VsZWN0ZWQpLGIuc2V0QXR0cmlidXRlKFwiYXJpYS1sZXZlbFwiLGYucGFyZW50cy5sZW5ndGgpLGIuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbGxlZGJ5XCIsZi5hX2F0dHIuaWQpLGYuc3RhdGUuZGlzYWJsZWQmJmIuc2V0QXR0cmlidXRlKFwiYXJpYS1kaXNhYmxlZFwiLCEwKSxsPTAsbT1mLmNoaWxkcmVuLmxlbmd0aDttPmw7bCsrKWlmKCFxW2YuY2hpbGRyZW5bbF1dLnN0YXRlLmhpZGRlbil7dz0hMDticmVha31pZihudWxsIT09Zi5wYXJlbnQmJnFbZi5wYXJlbnRdJiYhZi5zdGF0ZS5oaWRkZW4mJihsPWEuaW5BcnJheShmLmlkLHFbZi5wYXJlbnRdLmNoaWxkcmVuKSx4PWYuaWQsLTEhPT1sKSlmb3IobCsrLG09cVtmLnBhcmVudF0uY2hpbGRyZW4ubGVuZ3RoO20+bDtsKyspaWYocVtxW2YucGFyZW50XS5jaGlsZHJlbltsXV0uc3RhdGUuaGlkZGVufHwoeD1xW2YucGFyZW50XS5jaGlsZHJlbltsXSkseCE9PWYuaWQpYnJlYWs7Zi5zdGF0ZS5oaWRkZW4mJihvKz1cIiBqc3RyZWUtaGlkZGVuXCIpLGYuc3RhdGUubG9hZGVkJiYhdz9vKz1cIiBqc3RyZWUtbGVhZlwiOihvKz1mLnN0YXRlLm9wZW5lZCYmZi5zdGF0ZS5sb2FkZWQ/XCIganN0cmVlLW9wZW5cIjpcIiBqc3RyZWUtY2xvc2VkXCIsYi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWV4cGFuZGVkXCIsZi5zdGF0ZS5vcGVuZWQmJmYuc3RhdGUubG9hZGVkKSkseD09PWYuaWQmJihvKz1cIiBqc3RyZWUtbGFzdFwiKSxiLmlkPWYuaWQsYi5jbGFzc05hbWU9byxvPShmLnN0YXRlLnNlbGVjdGVkP1wiIGpzdHJlZS1jbGlja2VkXCI6XCJcIikrKGYuc3RhdGUuZGlzYWJsZWQ/XCIganN0cmVlLWRpc2FibGVkXCI6XCJcIik7Zm9yKG0gaW4gZi5hX2F0dHIpaWYoZi5hX2F0dHIuaGFzT3duUHJvcGVydHkobSkpe2lmKFwiaHJlZlwiPT09bSYmXCIjXCI9PT1mLmFfYXR0clttXSljb250aW51ZTtcImNsYXNzXCIhPT1tP2IuY2hpbGROb2Rlc1sxXS5zZXRBdHRyaWJ1dGUobSxmLmFfYXR0clttXSk6bys9XCIgXCIrZi5hX2F0dHJbbV19aWYoby5sZW5ndGgmJihiLmNoaWxkTm9kZXNbMV0uY2xhc3NOYW1lPVwianN0cmVlLWFuY2hvciBcIitvKSwoZi5pY29uJiZmLmljb24hPT0hMHx8Zi5pY29uPT09ITEpJiYoZi5pY29uPT09ITE/Yi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiOi0xPT09Zi5pY29uLmluZGV4T2YoXCIvXCIpJiYtMT09PWYuaWNvbi5pbmRleE9mKFwiLlwiKT9iLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIFwiK2YuaWNvbitcIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiOihiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2U9J3VybChcIicrZi5pY29uKydcIiknLGIuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbj1cImNlbnRlciBjZW50ZXJcIixiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kU2l6ZT1cImF1dG9cIixiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIGpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpKSx0aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dD9iLmNoaWxkTm9kZXNbMV0uYXBwZW5kQ2hpbGQocC5jcmVhdGVUZXh0Tm9kZShmLnRleHQpKTpiLmNoaWxkTm9kZXNbMV0uaW5uZXJIVE1MKz1mLnRleHQsYyYmZi5jaGlsZHJlbi5sZW5ndGgmJihmLnN0YXRlLm9wZW5lZHx8ZSkmJmYuc3RhdGUubG9hZGVkKXtmb3Iobj1wLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSxuLnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLG4uY2xhc3NOYW1lPVwianN0cmVlLWNoaWxkcmVuXCIsbD0wLG09Zi5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKyluLmFwcGVuZENoaWxkKHRoaXMucmVkcmF3X25vZGUoZi5jaGlsZHJlbltsXSxjLCEwKSk7Yi5hcHBlbmRDaGlsZChuKX1pZihrJiZiLmFwcGVuZENoaWxkKGspLCFkKXtmb3IoZ3x8KGc9dGhpcy5lbGVtZW50WzBdKSxsPTAsbT1nLmNoaWxkTm9kZXMubGVuZ3RoO20+bDtsKyspaWYoZy5jaGlsZE5vZGVzW2xdJiZnLmNoaWxkTm9kZXNbbF0uY2xhc3NOYW1lJiYtMSE9PWcuY2hpbGROb2Rlc1tsXS5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1jaGlsZHJlblwiKSl7dD1nLmNoaWxkTm9kZXNbbF07YnJlYWt9dHx8KHQ9cC5jcmVhdGVFbGVtZW50KFwiVUxcIiksdC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSx0LmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGcuYXBwZW5kQ2hpbGQodCkpLGc9dCxoPGcuY2hpbGROb2Rlcy5sZW5ndGg/Zy5pbnNlcnRCZWZvcmUoYixnLmNoaWxkTm9kZXNbaF0pOmcuYXBwZW5kQ2hpbGQoYiksciYmKHU9dGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcCx2PXRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0LGIuY2hpbGROb2Rlc1sxXS5mb2N1cygpLHRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3A9dSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdD12KX1yZXR1cm4gZi5zdGF0ZS5vcGVuZWQmJiFmLnN0YXRlLmxvYWRlZCYmKGYuc3RhdGUub3BlbmVkPSExLHNldFRpbWVvdXQoYS5wcm94eShmdW5jdGlvbigpe3RoaXMub3Blbl9ub2RlKGYuaWQsITEsMCl9LHRoaXMpLDApKSxifSxvcGVuX25vZGU6ZnVuY3Rpb24oYyxkLGUpe3ZhciBmLGcsaCxpO2lmKGEuaXNBcnJheShjKSl7Zm9yKGM9Yy5zbGljZSgpLGY9MCxnPWMubGVuZ3RoO2c+ZjtmKyspdGhpcy5vcGVuX25vZGUoY1tmXSxkLGUpO3JldHVybiEwfXJldHVybiBjPXRoaXMuZ2V0X25vZGUoYyksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3Q/KGU9ZT09PWI/dGhpcy5zZXR0aW5ncy5jb3JlLmFuaW1hdGlvbjplLHRoaXMuaXNfY2xvc2VkKGMpP3RoaXMuaXNfbG9hZGVkKGMpPyhoPXRoaXMuZ2V0X25vZGUoYywhMCksaT10aGlzLGgubGVuZ3RoJiYoZSYmaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikubGVuZ3RoJiZoLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKSxjLmNoaWxkcmVuLmxlbmd0aCYmIXRoaXMuX2ZpcnN0Q2hpbGQoaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pJiZ0aGlzLmRyYXdfY2hpbGRyZW4oYyksZT8odGhpcy50cmlnZ2VyKFwiYmVmb3JlX29wZW5cIix7bm9kZTpjfSksaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKS5lbmQoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikuYWRkQ2xhc3MoXCJqc3RyZWUtb3BlblwiKS5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuc3RvcCghMCwhMCkuc2xpZGVEb3duKGUsZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9XCJcIixpLnRyaWdnZXIoXCJhZnRlcl9vcGVuXCIse25vZGU6Y30pfSkpOih0aGlzLnRyaWdnZXIoXCJiZWZvcmVfb3BlblwiLHtub2RlOmN9KSxoWzBdLmNsYXNzTmFtZT1oWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwianN0cmVlLWNsb3NlZFwiLFwianN0cmVlLW9wZW5cIiksaFswXS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWV4cGFuZGVkXCIsITApKSksYy5zdGF0ZS5vcGVuZWQ9ITAsZCYmZC5jYWxsKHRoaXMsYywhMCksaC5sZW5ndGh8fHRoaXMudHJpZ2dlcihcImJlZm9yZV9vcGVuXCIse25vZGU6Y30pLHRoaXMudHJpZ2dlcihcIm9wZW5fbm9kZVwiLHtub2RlOmN9KSxlJiZoLmxlbmd0aHx8dGhpcy50cmlnZ2VyKFwiYWZ0ZXJfb3BlblwiLHtub2RlOmN9KSwhMCk6dGhpcy5pc19sb2FkaW5nKGMpP3NldFRpbWVvdXQoYS5wcm94eShmdW5jdGlvbigpe3RoaXMub3Blbl9ub2RlKGMsZCxlKX0sdGhpcyksNTAwKTp2b2lkIHRoaXMubG9hZF9ub2RlKGMsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYj90aGlzLm9wZW5fbm9kZShhLGQsZSk6ZD9kLmNhbGwodGhpcyxhLCExKTohMX0pOihkJiZkLmNhbGwodGhpcyxjLCExKSwhMSkpOiExfSxfb3Blbl90bzpmdW5jdGlvbihiKXtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBjLGQsZT1iLnBhcmVudHM7Zm9yKGM9MCxkPWUubGVuZ3RoO2Q+YztjKz0xKWMhPT1hLmpzdHJlZS5yb290JiZ0aGlzLm9wZW5fbm9kZShlW2NdLCExLDApO3JldHVybiBhKFwiI1wiK2IuaWQucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpLHRoaXMuZWxlbWVudCl9LGNsb3NlX25vZGU6ZnVuY3Rpb24oYyxkKXt2YXIgZSxmLGcsaDtpZihhLmlzQXJyYXkoYykpe2ZvcihjPWMuc2xpY2UoKSxlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKXRoaXMuY2xvc2Vfbm9kZShjW2VdLGQpO3JldHVybiEwfXJldHVybiBjPXRoaXMuZ2V0X25vZGUoYyksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3Q/dGhpcy5pc19jbG9zZWQoYyk/ITE6KGQ9ZD09PWI/dGhpcy5zZXR0aW5ncy5jb3JlLmFuaW1hdGlvbjpkLGc9dGhpcyxoPXRoaXMuZ2V0X25vZGUoYywhMCksYy5zdGF0ZS5vcGVuZWQ9ITEsdGhpcy50cmlnZ2VyKFwiY2xvc2Vfbm9kZVwiLHtub2RlOmN9KSx2b2lkKGgubGVuZ3RoP2Q/aC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuYXR0cihcInN0eWxlXCIsXCJkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnRcIikuZW5kKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb3BlblwiKS5hZGRDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikuYXR0cihcImFyaWEtZXhwYW5kZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnN0b3AoITAsITApLnNsaWRlVXAoZCxmdW5jdGlvbigpe3RoaXMuc3R5bGUuZGlzcGxheT1cIlwiLGguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnJlbW92ZSgpLGcudHJpZ2dlcihcImFmdGVyX2Nsb3NlXCIse25vZGU6Y30pfSk6KGhbMF0uY2xhc3NOYW1lPWhbMF0uY2xhc3NOYW1lLnJlcGxhY2UoXCJqc3RyZWUtb3BlblwiLFwianN0cmVlLWNsb3NlZFwiKSxoLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5yZW1vdmUoKSx0aGlzLnRyaWdnZXIoXCJhZnRlcl9jbG9zZVwiLHtub2RlOmN9KSk6dGhpcy50cmlnZ2VyKFwiYWZ0ZXJfY2xvc2VcIix7bm9kZTpjfSkpKTohMX0sdG9nZ2xlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMudG9nZ2xlX25vZGUoYltjXSk7cmV0dXJuITB9cmV0dXJuIHRoaXMuaXNfY2xvc2VkKGIpP3RoaXMub3Blbl9ub2RlKGIpOnRoaXMuaXNfb3BlbihiKT90aGlzLmNsb3NlX25vZGUoYik6dm9pZCAwfSxvcGVuX2FsbDpmdW5jdGlvbihiLGMsZCl7aWYoYnx8KGI9YS5qc3RyZWUucm9vdCksYj10aGlzLmdldF9ub2RlKGIpLCFiKXJldHVybiExO3ZhciBlPWIuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpOnRoaXMuZ2V0X25vZGUoYiwhMCksZixnLGg7aWYoIWUubGVuZ3RoKXtmb3IoZj0wLGc9Yi5jaGlsZHJlbl9kLmxlbmd0aDtnPmY7ZisrKXRoaXMuaXNfY2xvc2VkKHRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2ZdXSkmJih0aGlzLl9tb2RlbC5kYXRhW2IuY2hpbGRyZW5fZFtmXV0uc3RhdGUub3BlbmVkPSEwKTtyZXR1cm4gdGhpcy50cmlnZ2VyKFwib3Blbl9hbGxcIix7bm9kZTpifSl9ZD1kfHxlLGg9dGhpcyxlPXRoaXMuaXNfY2xvc2VkKGIpP2UuZmluZChcIi5qc3RyZWUtY2xvc2VkXCIpLmFkZEJhY2soKTplLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKSxlLmVhY2goZnVuY3Rpb24oKXtoLm9wZW5fbm9kZSh0aGlzLGZ1bmN0aW9uKGEsYil7YiYmdGhpcy5pc19wYXJlbnQoYSkmJnRoaXMub3Blbl9hbGwoYSxjLGQpfSxjfHwwKX0pLDA9PT1kLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5sZW5ndGgmJnRoaXMudHJpZ2dlcihcIm9wZW5fYWxsXCIse25vZGU6dGhpcy5nZXRfbm9kZShkKX0pfSxjbG9zZV9hbGw6ZnVuY3Rpb24oYixjKXtpZihifHwoYj1hLmpzdHJlZS5yb290KSxiPXRoaXMuZ2V0X25vZGUoYiksIWIpcmV0dXJuITE7dmFyIGQ9Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5nZXRfY29udGFpbmVyX3VsKCk6dGhpcy5nZXRfbm9kZShiLCEwKSxlPXRoaXMsZixnO2ZvcihkLmxlbmd0aCYmKGQ9dGhpcy5pc19vcGVuKGIpP2QuZmluZChcIi5qc3RyZWUtb3BlblwiKS5hZGRCYWNrKCk6ZC5maW5kKFwiLmpzdHJlZS1vcGVuXCIpLGEoZC5nZXQoKS5yZXZlcnNlKCkpLmVhY2goZnVuY3Rpb24oKXtlLmNsb3NlX25vZGUodGhpcyxjfHwwKX0pKSxmPTAsZz1iLmNoaWxkcmVuX2QubGVuZ3RoO2c+ZjtmKyspdGhpcy5fbW9kZWwuZGF0YVtiLmNoaWxkcmVuX2RbZl1dLnN0YXRlLm9wZW5lZD0hMTt0aGlzLnRyaWdnZXIoXCJjbG9zZV9hbGxcIix7bm9kZTpifSl9LGlzX2Rpc2FibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmYS5zdGF0ZSYmYS5zdGF0ZS5kaXNhYmxlZH0sZW5hYmxlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZW5hYmxlX25vZGUoYltjXSk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oYi5zdGF0ZS5kaXNhYmxlZD0hMSx0aGlzLmdldF9ub2RlKGIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIiwhMSksdm9pZCB0aGlzLnRyaWdnZXIoXCJlbmFibGVfbm9kZVwiLHtub2RlOmJ9KSk6ITF9LGRpc2FibGVfbm9kZTpmdW5jdGlvbihiKXt2YXIgYyxkO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspdGhpcy5kaXNhYmxlX25vZGUoYltjXSk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oYi5zdGF0ZS5kaXNhYmxlZD0hMCx0aGlzLmdldF9ub2RlKGIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIiwhMCksdm9pZCB0aGlzLnRyaWdnZXIoXCJkaXNhYmxlX25vZGVcIix7bm9kZTpifSkpOiExfSxpc19oaWRkZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhLnN0YXRlLmhpZGRlbj09PSEwfSxoaWRlX25vZGU6ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy5oaWRlX25vZGUoYltkXSwhMCk7cmV0dXJuIGN8fHRoaXMucmVkcmF3KCksITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD92b2lkKGIuc3RhdGUuaGlkZGVufHwoYi5zdGF0ZS5oaWRkZW49ITAsdGhpcy5fbm9kZV9jaGFuZ2VkKGIucGFyZW50KSxjfHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcImhpZGVfbm9kZVwiLHtub2RlOmJ9KSkpOiExfSxzaG93X25vZGU6ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy5zaG93X25vZGUoYltkXSwhMCk7cmV0dXJuIGN8fHRoaXMucmVkcmF3KCksITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD92b2lkKGIuc3RhdGUuaGlkZGVuJiYoYi5zdGF0ZS5oaWRkZW49ITEsdGhpcy5fbm9kZV9jaGFuZ2VkKGIucGFyZW50KSxjfHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcInNob3dfbm9kZVwiLHtub2RlOmJ9KSkpOiExfSxoaWRlX2FsbDpmdW5jdGlvbihiKXt2YXIgYyxkPXRoaXMuX21vZGVsLmRhdGEsZT1bXTtmb3IoYyBpbiBkKWQuaGFzT3duUHJvcGVydHkoYykmJmMhPT1hLmpzdHJlZS5yb290JiYhZFtjXS5zdGF0ZS5oaWRkZW4mJihkW2NdLnN0YXRlLmhpZGRlbj0hMCxlLnB1c2goYykpO3JldHVybiB0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCxifHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcImhpZGVfYWxsXCIse25vZGVzOmV9KSxlfSxzaG93X2FsbDpmdW5jdGlvbihiKXt2YXIgYyxkPXRoaXMuX21vZGVsLmRhdGEsZT1bXTtmb3IoYyBpbiBkKWQuaGFzT3duUHJvcGVydHkoYykmJmMhPT1hLmpzdHJlZS5yb290JiZkW2NdLnN0YXRlLmhpZGRlbiYmKGRbY10uc3RhdGUuaGlkZGVuPSExLGUucHVzaChjKSk7cmV0dXJuIHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwLGJ8fHRoaXMucmVkcmF3KCksdGhpcy50cmlnZ2VyKFwic2hvd19hbGxcIix7bm9kZXM6ZX0pLGV9LGFjdGl2YXRlX25vZGU6ZnVuY3Rpb24oYSxjKXtpZih0aGlzLmlzX2Rpc2FibGVkKGEpKXJldHVybiExO2lmKGMmJlwib2JqZWN0XCI9PXR5cGVvZiBjfHwoYz17fSksdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkIT09Yj90aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuaWQpOm51bGwsdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmIXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuc3RhdGUuc2VsZWN0ZWQmJih0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPW51bGwpLCF0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoLTFdKSksdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiYoYy5tZXRhS2V5fHxjLmN0cmxLZXl8fGMuc2hpZnRLZXkpJiYoIWMuc2hpZnRLZXl8fHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQmJnRoaXMuZ2V0X3BhcmVudChhKSYmdGhpcy5nZXRfcGFyZW50KGEpPT09dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5wYXJlbnQpKWlmKGMuc2hpZnRLZXkpe3ZhciBkPXRoaXMuZ2V0X25vZGUoYSkuaWQsZT10aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkLGY9dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLnBhcmVudCkuY2hpbGRyZW4sZz0hMSxoLGk7Zm9yKGg9MCxpPWYubGVuZ3RoO2k+aDtoKz0xKWZbaF09PT1kJiYoZz0hZyksZltoXT09PWUmJihnPSFnKSx0aGlzLmlzX2Rpc2FibGVkKGZbaF0pfHwhZyYmZltoXSE9PWQmJmZbaF0hPT1lP3RoaXMuZGVzZWxlY3Rfbm9kZShmW2hdLCEwLGMpOnRoaXMuaXNfaGlkZGVuKGZbaF0pfHx0aGlzLnNlbGVjdF9ub2RlKGZbaF0sITAsITEsYyk7dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJzZWxlY3Rfbm9kZVwiLG5vZGU6dGhpcy5nZXRfbm9kZShhKSxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6Y30pfWVsc2UgdGhpcy5pc19zZWxlY3RlZChhKT90aGlzLmRlc2VsZWN0X25vZGUoYSwhMSxjKTp0aGlzLnNlbGVjdF9ub2RlKGEsITEsITEsYyk7ZWxzZSF0aGlzLnNldHRpbmdzLmNvcmUubXVsdGlwbGUmJihjLm1ldGFLZXl8fGMuY3RybEtleXx8Yy5zaGlmdEtleSkmJnRoaXMuaXNfc2VsZWN0ZWQoYSk/dGhpcy5kZXNlbGVjdF9ub2RlKGEsITEsYyk6KHRoaXMuZGVzZWxlY3RfYWxsKCEwKSx0aGlzLnNlbGVjdF9ub2RlKGEsITEsITEsYyksdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLmdldF9ub2RlKGEpKTt0aGlzLnRyaWdnZXIoXCJhY3RpdmF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShhKSxldmVudDpjfSl9LGhvdmVyX25vZGU6ZnVuY3Rpb24oYSl7aWYoYT10aGlzLmdldF9ub2RlKGEsITApLCFhfHwhYS5sZW5ndGh8fGEuY2hpbGRyZW4oXCIuanN0cmVlLWhvdmVyZWRcIikubGVuZ3RoKXJldHVybiExO3ZhciBiPXRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLGM9dGhpcy5lbGVtZW50O2ImJmIubGVuZ3RoJiZ0aGlzLmRlaG92ZXJfbm9kZShiKSxhLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKSx0aGlzLnRyaWdnZXIoXCJob3Zlcl9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShhKX0pLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIixhWzBdLmlkKX0sMCl9LGRlaG92ZXJfbm9kZTpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEsITApLGEmJmEubGVuZ3RoJiZhLmNoaWxkcmVuKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLmxlbmd0aD8oYS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIiksdm9pZCB0aGlzLnRyaWdnZXIoXCJkZWhvdmVyX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGEpfSkpOiExfSxzZWxlY3Rfbm9kZTpmdW5jdGlvbihiLGMsZCxlKXt2YXIgZixnLGgsaTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxnPTAsaD1iLmxlbmd0aDtoPmc7ZysrKXRoaXMuc2VsZWN0X25vZGUoYltnXSxjLGQsZSk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZj10aGlzLmdldF9ub2RlKGIsITApLHZvaWQoYi5zdGF0ZS5zZWxlY3RlZHx8KGIuc3RhdGUuc2VsZWN0ZWQ9ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2goYi5pZCksZHx8KGY9dGhpcy5fb3Blbl90byhiKSksZiYmZi5sZW5ndGgmJmYuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLHRoaXMudHJpZ2dlcihcInNlbGVjdF9ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6ZX0pLGN8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwic2VsZWN0X25vZGVcIixub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmV9KSkpKTohMX0sZGVzZWxlY3Rfbm9kZTpmdW5jdGlvbihiLGMsZCl7dmFyIGUsZixnO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGU9MCxmPWIubGVuZ3RoO2Y+ZTtlKyspdGhpcy5kZXNlbGVjdF9ub2RlKGJbZV0sYyxkKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhnPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLnNlbGVjdGVkJiYoYi5zdGF0ZS5zZWxlY3RlZD0hMSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGIuaWQpLGcubGVuZ3RoJiZnLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJkZXNlbGVjdF9ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6ZH0pLGN8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVzZWxlY3Rfbm9kZVwiLG5vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6ZH0pKSkpOiExfSxzZWxlY3RfYWxsOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoW10pLGQsZTtmb3IodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPXRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW5fZC5jb25jYXQoKSxkPTAsZT10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoO2U+ZDtkKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbZF1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbZF1dLnN0YXRlLnNlbGVjdGVkPSEwKTt0aGlzLnJlZHJhdyghMCksdGhpcy50cmlnZ2VyKFwic2VsZWN0X2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KSxifHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9hbGxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsb2xkX3NlbGVjdGlvbjpjfSl9LGRlc2VsZWN0X2FsbDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKSxjLGQ7Zm9yKGM9MCxkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7ZD5jO2MrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtjXV0mJih0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtjXV0uc3RhdGUuc2VsZWN0ZWQ9ITEpO3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1bXSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLHRoaXMudHJpZ2dlcihcImRlc2VsZWN0X2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsbm9kZTpifSksYXx8dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJkZXNlbGVjdF9hbGxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsb2xkX3NlbGVjdGlvbjpifSl9LGlzX3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi5zdGF0ZS5zZWxlY3RlZDohMX0sZ2V0X3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3JldHVybiBiP2EubWFwKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnNsaWNlKCl9LGdldF90b3Bfc2VsZWN0ZWQ6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5nZXRfc2VsZWN0ZWQoITApLGQ9e30sZSxmLGcsaDtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylkW2NbZV0uaWRdPWNbZV07Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZm9yKGc9MCxoPWNbZV0uY2hpbGRyZW5fZC5sZW5ndGg7aD5nO2crKylkW2NbZV0uY2hpbGRyZW5fZFtnXV0mJmRlbGV0ZSBkW2NbZV0uY2hpbGRyZW5fZFtnXV07Yz1bXTtmb3IoZSBpbiBkKWQuaGFzT3duUHJvcGVydHkoZSkmJmMucHVzaChlKTtyZXR1cm4gYj9hLm1hcChjLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoYSl9LHRoaXMpKTpjfSxnZXRfYm90dG9tX3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X3NlbGVjdGVkKCEwKSxkPVtdLGUsZjtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyljW2VdLmNoaWxkcmVuLmxlbmd0aHx8ZC5wdXNoKGNbZV0uaWQpO3JldHVybiBiP2EubWFwKGQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOmR9LGdldF9zdGF0ZTpmdW5jdGlvbigpe3ZhciBiPXtjb3JlOntvcGVuOltdLHNjcm9sbDp7bGVmdDp0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdCgpLHRvcDp0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKCl9LHNlbGVjdGVkOltdfX0sYztmb3IoYyBpbiB0aGlzLl9tb2RlbC5kYXRhKXRoaXMuX21vZGVsLmRhdGEuaGFzT3duUHJvcGVydHkoYykmJmMhPT1hLmpzdHJlZS5yb290JiYodGhpcy5fbW9kZWwuZGF0YVtjXS5zdGF0ZS5vcGVuZWQmJmIuY29yZS5vcGVuLnB1c2goYyksdGhpcy5fbW9kZWwuZGF0YVtjXS5zdGF0ZS5zZWxlY3RlZCYmYi5jb3JlLnNlbGVjdGVkLnB1c2goYykpO3JldHVybiBifSxzZXRfc3RhdGU6ZnVuY3Rpb24oYyxkKXtpZihjKXtpZihjLmNvcmUpe3ZhciBlLGYsZyxoLGk7aWYoYy5jb3JlLm9wZW4pcmV0dXJuIGEuaXNBcnJheShjLmNvcmUub3BlbikmJmMuY29yZS5vcGVuLmxlbmd0aD90aGlzLl9sb2FkX25vZGVzKGMuY29yZS5vcGVuLGZ1bmN0aW9uKGEpe3RoaXMub3Blbl9ub2RlKGEsITEsMCksZGVsZXRlIGMuY29yZS5vcGVuLHRoaXMuc2V0X3N0YXRlKGMsZCl9LCEwKTooZGVsZXRlIGMuY29yZS5vcGVuLHRoaXMuc2V0X3N0YXRlKGMsZCkpLCExO2lmKGMuY29yZS5zY3JvbGwpcmV0dXJuIGMuY29yZS5zY3JvbGwmJmMuY29yZS5zY3JvbGwubGVmdCE9PWImJnRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0KGMuY29yZS5zY3JvbGwubGVmdCksYy5jb3JlLnNjcm9sbCYmYy5jb3JlLnNjcm9sbC50b3AhPT1iJiZ0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKGMuY29yZS5zY3JvbGwudG9wKSxkZWxldGUgYy5jb3JlLnNjcm9sbCx0aGlzLnNldF9zdGF0ZShjLGQpLCExO2lmKGMuY29yZS5zZWxlY3RlZClyZXR1cm4gaD10aGlzLHRoaXMuZGVzZWxlY3RfYWxsKCksYS5lYWNoKGMuY29yZS5zZWxlY3RlZCxmdW5jdGlvbihhLGIpe2guc2VsZWN0X25vZGUoYiwhMSwhMCl9KSxkZWxldGUgYy5jb3JlLnNlbGVjdGVkLHRoaXMuc2V0X3N0YXRlKGMsZCksITE7Zm9yKGkgaW4gYyljLmhhc093blByb3BlcnR5KGkpJiZcImNvcmVcIiE9PWkmJi0xPT09YS5pbkFycmF5KGksdGhpcy5zZXR0aW5ncy5wbHVnaW5zKSYmZGVsZXRlIGNbaV07aWYoYS5pc0VtcHR5T2JqZWN0KGMuY29yZSkpcmV0dXJuIGRlbGV0ZSBjLmNvcmUsdGhpcy5zZXRfc3RhdGUoYyxkKSwhMX1yZXR1cm4gYS5pc0VtcHR5T2JqZWN0KGMpPyhjPW51bGwsZCYmZC5jYWxsKHRoaXMpLHRoaXMudHJpZ2dlcihcInNldF9zdGF0ZVwiKSwhMSk6ITB9cmV0dXJuITF9LHJlZnJlc2g6ZnVuY3Rpb24oYixjKXt0aGlzLl9kYXRhLmNvcmUuc3RhdGU9Yz09PSEwP3t9OnRoaXMuZ2V0X3N0YXRlKCksYyYmYS5pc0Z1bmN0aW9uKGMpJiYodGhpcy5fZGF0YS5jb3JlLnN0YXRlPWMuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5zdGF0ZSkpLHRoaXMuX2NudD0wLHRoaXMuX21vZGVsLmRhdGE9e30sdGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XT17aWQ6YS5qc3RyZWUucm9vdCxwYXJlbnQ6bnVsbCxwYXJlbnRzOltdLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sc3RhdGU6e2xvYWRlZDohMX19LHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1bXSx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPW51bGwsdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbDt2YXIgZD10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWU7Ynx8KHRoaXMuZWxlbWVudC5odG1sKFwiPHVsIGNsYXNzPSdcIitkK1wiJyByb2xlPSdncm91cCc+PGxpIGNsYXNzPSdqc3RyZWUtaW5pdGlhbC1ub2RlIGpzdHJlZS1sb2FkaW5nIGpzdHJlZS1sZWFmIGpzdHJlZS1sYXN0JyByb2xlPSd0cmVlaXRlbScgaWQ9J2pcIit0aGlzLl9pZCtcIl9sb2FkaW5nJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLW9jbCc+PC9pPjxhIGNsYXNzPSdqc3RyZWUtYW5jaG9yJyBocmVmPScjJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLXRoZW1laWNvbi1oaWRkZW4nPjwvaT5cIit0aGlzLmdldF9zdHJpbmcoXCJMb2FkaW5nIC4uLlwiKStcIjwvYT48L2xpPjwvdWw+XCIpLHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsXCJqXCIrdGhpcy5faWQrXCJfbG9hZGluZ1wiKSksdGhpcy5sb2FkX25vZGUoYS5qc3RyZWUucm9vdCxmdW5jdGlvbihiLGMpe2MmJih0aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWU9ZCx0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKS5pZCksdGhpcy5zZXRfc3RhdGUoYS5leHRlbmQoITAse30sdGhpcy5fZGF0YS5jb3JlLnN0YXRlKSxmdW5jdGlvbigpe3RoaXMudHJpZ2dlcihcInJlZnJlc2hcIil9KSksdGhpcy5fZGF0YS5jb3JlLnN0YXRlPW51bGx9KX0scmVmcmVzaF9ub2RlOmZ1bmN0aW9uKGIpe2lmKGI9dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGM9W10sZD1bXSxlPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoW10pO2QucHVzaChiLmlkKSxiLnN0YXRlLm9wZW5lZD09PSEwJiZjLnB1c2goYi5pZCksdGhpcy5nZXRfbm9kZShiLCEwKS5maW5kKFwiLmpzdHJlZS1vcGVuXCIpLmVhY2goZnVuY3Rpb24oKXtkLnB1c2godGhpcy5pZCksYy5wdXNoKHRoaXMuaWQpfSksdGhpcy5fbG9hZF9ub2RlcyhkLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5vcGVuX25vZGUoYywhMSwwKSx0aGlzLnNlbGVjdF9ub2RlKGUpLHRoaXMudHJpZ2dlcihcInJlZnJlc2hfbm9kZVwiLHtub2RlOmIsbm9kZXM6YX0pfSx0aGlzKSwhMSwhMCl9LHNldF9pZDpmdW5jdGlvbihiLGMpe2lmKGI9dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGQsZSxmPXRoaXMuX21vZGVsLmRhdGEsZz1iLmlkO2ZvcihjPWMudG9TdHJpbmcoKSxmW2IucGFyZW50XS5jaGlsZHJlblthLmluQXJyYXkoYi5pZCxmW2IucGFyZW50XS5jaGlsZHJlbildPWMsZD0wLGU9Yi5wYXJlbnRzLmxlbmd0aDtlPmQ7ZCsrKWZbYi5wYXJlbnRzW2RdXS5jaGlsZHJlbl9kW2EuaW5BcnJheShiLmlkLGZbYi5wYXJlbnRzW2RdXS5jaGlsZHJlbl9kKV09Yztmb3IoZD0wLGU9Yi5jaGlsZHJlbi5sZW5ndGg7ZT5kO2QrKylmW2IuY2hpbGRyZW5bZF1dLnBhcmVudD1jO2ZvcihkPTAsZT1iLmNoaWxkcmVuX2QubGVuZ3RoO2U+ZDtkKyspZltiLmNoaWxkcmVuX2RbZF1dLnBhcmVudHNbYS5pbkFycmF5KGIuaWQsZltiLmNoaWxkcmVuX2RbZF1dLnBhcmVudHMpXT1jO3JldHVybiBkPWEuaW5BcnJheShiLmlkLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCksLTEhPT1kJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2RdPWMpLGQ9dGhpcy5nZXRfbm9kZShiLmlkLCEwKSxkJiYoZC5hdHRyKFwiaWRcIixjKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiKT09PWIuaWQmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsYykpLGRlbGV0ZSBmW2IuaWRdLGIuaWQ9YyxiLmxpX2F0dHIuaWQ9YyxmW2NdPWIsdGhpcy50cmlnZ2VyKFwic2V0X2lkXCIse25vZGU6YixcIm5ld1wiOmIuaWQsb2xkOmd9KSwhMH0sZ2V0X3RleHQ6ZnVuY3Rpb24oYil7cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD9iLnRleHQ6ITF9LHNldF90ZXh0OmZ1bmN0aW9uKGIsYyl7dmFyIGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuc2V0X3RleHQoYltkXSxjKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhiLnRleHQ9Yyx0aGlzLmdldF9ub2RlKGIsITApLmxlbmd0aCYmdGhpcy5yZWRyYXdfbm9kZShiLmlkKSx0aGlzLnRyaWdnZXIoXCJzZXRfdGV4dFwiLHtvYmo6Yix0ZXh0OmN9KSwhMCk6ITF9LGdldF9qc29uOmZ1bmN0aW9uKGIsYyxkKXtpZihiPXRoaXMuZ2V0X25vZGUoYnx8YS5qc3RyZWUucm9vdCksIWIpcmV0dXJuITE7YyYmYy5mbGF0JiYhZCYmKGQ9W10pO3ZhciBlPXtpZDpiLmlkLHRleHQ6Yi50ZXh0LGljb246dGhpcy5nZXRfaWNvbihiKSxsaV9hdHRyOmEuZXh0ZW5kKCEwLHt9LGIubGlfYXR0ciksYV9hdHRyOmEuZXh0ZW5kKCEwLHt9LGIuYV9hdHRyKSxzdGF0ZTp7fSxkYXRhOmMmJmMubm9fZGF0YT8hMTphLmV4dGVuZCghMCx7fSxiLmRhdGEpfSxmLGc7aWYoYyYmYy5mbGF0P2UucGFyZW50PWIucGFyZW50OmUuY2hpbGRyZW49W10sIWN8fCFjLm5vX3N0YXRlKWZvcihmIGluIGIuc3RhdGUpYi5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShmKSYmKGUuc3RhdGVbZl09Yi5zdGF0ZVtmXSk7aWYoYyYmYy5ub19pZCYmKGRlbGV0ZSBlLmlkLGUubGlfYXR0ciYmZS5saV9hdHRyLmlkJiZkZWxldGUgZS5saV9hdHRyLmlkLGUuYV9hdHRyJiZlLmFfYXR0ci5pZCYmZGVsZXRlIGUuYV9hdHRyLmlkKSxjJiZjLmZsYXQmJmIuaWQhPT1hLmpzdHJlZS5yb290JiZkLnB1c2goZSksIWN8fCFjLm5vX2NoaWxkcmVuKWZvcihmPTAsZz1iLmNoaWxkcmVuLmxlbmd0aDtnPmY7ZisrKWMmJmMuZmxhdD90aGlzLmdldF9qc29uKGIuY2hpbGRyZW5bZl0sYyxkKTplLmNoaWxkcmVuLnB1c2godGhpcy5nZXRfanNvbihiLmNoaWxkcmVuW2ZdLGMpKTtyZXR1cm4gYyYmYy5mbGF0P2Q6Yi5pZD09PWEuanN0cmVlLnJvb3Q/ZS5jaGlsZHJlbjplfSxjcmVhdGVfbm9kZTpmdW5jdGlvbihjLGQsZSxmLGcpe2lmKG51bGw9PT1jJiYoYz1hLmpzdHJlZS5yb290KSxjPXRoaXMuZ2V0X25vZGUoYyksIWMpcmV0dXJuITE7aWYoZT1lPT09Yj9cImxhc3RcIjplLCFlLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmIWcmJiF0aGlzLmlzX2xvYWRlZChjKSlyZXR1cm4gdGhpcy5sb2FkX25vZGUoYyxmdW5jdGlvbigpe3RoaXMuY3JlYXRlX25vZGUoYyxkLGUsZiwhMCl9KTtkfHwoZD17dGV4dDp0aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKX0pLFwic3RyaW5nXCI9PXR5cGVvZiBkJiYoZD17dGV4dDpkfSksZC50ZXh0PT09YiYmKGQudGV4dD10aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKSk7dmFyIGgsaSxqLGs7c3dpdGNoKGMuaWQ9PT1hLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PWUmJihlPVwiZmlyc3RcIiksXCJhZnRlclwiPT09ZSYmKGU9XCJsYXN0XCIpKSxlKXtjYXNlXCJiZWZvcmVcIjpoPXRoaXMuZ2V0X25vZGUoYy5wYXJlbnQpLGU9YS5pbkFycmF5KGMuaWQsaC5jaGlsZHJlbiksYz1oO2JyZWFrO2Nhc2VcImFmdGVyXCI6aD10aGlzLmdldF9ub2RlKGMucGFyZW50KSxlPWEuaW5BcnJheShjLmlkLGguY2hpbGRyZW4pKzEsYz1oO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6ZT0wO2JyZWFrO2Nhc2VcImxhc3RcIjplPWMuY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6ZXx8KGU9MCl9aWYoZT5jLmNoaWxkcmVuLmxlbmd0aCYmKGU9Yy5jaGlsZHJlbi5sZW5ndGgpLGQuaWR8fChkLmlkPSEwKSwhdGhpcy5jaGVjayhcImNyZWF0ZV9ub2RlXCIsZCxjLGUpKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtpZihkLmlkPT09ITAmJmRlbGV0ZSBkLmlkLGQ9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9qc29uKGQsYy5pZCxjLnBhcmVudHMuY29uY2F0KCkpLCFkKXJldHVybiExO2ZvcihoPXRoaXMuZ2V0X25vZGUoZCksaT1bXSxpLnB1c2goZCksaT1pLmNvbmNhdChoLmNoaWxkcmVuX2QpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmkscGFyZW50OmMuaWR9KSxjLmNoaWxkcmVuX2Q9Yy5jaGlsZHJlbl9kLmNvbmNhdChpKSxqPTAsaz1jLnBhcmVudHMubGVuZ3RoO2s+ajtqKyspdGhpcy5fbW9kZWwuZGF0YVtjLnBhcmVudHNbal1dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtjLnBhcmVudHNbal1dLmNoaWxkcmVuX2QuY29uY2F0KGkpO2ZvcihkPWgsaD1bXSxqPTAsaz1jLmNoaWxkcmVuLmxlbmd0aDtrPmo7aisrKWhbaj49ZT9qKzE6al09Yy5jaGlsZHJlbltqXTtyZXR1cm4gaFtlXT1kLmlkLGMuY2hpbGRyZW49aCx0aGlzLnJlZHJhd19ub2RlKGMsITApLGYmJmYuY2FsbCh0aGlzLHRoaXMuZ2V0X25vZGUoZCkpLHRoaXMudHJpZ2dlcihcImNyZWF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShkKSxwYXJlbnQ6Yy5pZCxwb3NpdGlvbjplfSksZC5pZH0scmVuYW1lX25vZGU6ZnVuY3Rpb24oYixjKXt2YXIgZCxlLGY7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrKyl0aGlzLnJlbmFtZV9ub2RlKGJbZF0sYyk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZj1iLnRleHQsdGhpcy5jaGVjayhcInJlbmFtZV9ub2RlXCIsYix0aGlzLmdldF9wYXJlbnQoYiksYyk/KHRoaXMuc2V0X3RleHQoYixjKSx0aGlzLnRyaWdnZXIoXCJyZW5hbWVfbm9kZVwiLHtub2RlOmIsdGV4dDpjLG9sZDpmfSksITApOih0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMSkpOiExfSxkZWxldGVfbm9kZTpmdW5jdGlvbihiKXt2YXIgYyxkLGUsZixnLGgsaSxqLGssbCxtLG47aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmRlbGV0ZV9ub2RlKGJbY10pO3JldHVybiEwfWlmKGI9dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7aWYoZT10aGlzLmdldF9ub2RlKGIucGFyZW50KSxmPWEuaW5BcnJheShiLmlkLGUuY2hpbGRyZW4pLGw9ITEsIXRoaXMuY2hlY2soXCJkZWxldGVfbm9kZVwiLGIsZSxmKSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7Zm9yKC0xIT09ZiYmKGUuY2hpbGRyZW49YS52YWthdGEuYXJyYXlfcmVtb3ZlKGUuY2hpbGRyZW4sZikpLGc9Yi5jaGlsZHJlbl9kLmNvbmNhdChbXSksZy5wdXNoKGIuaWQpLGg9MCxpPWIucGFyZW50cy5sZW5ndGg7aT5oO2grKyl0aGlzLl9tb2RlbC5kYXRhW2IucGFyZW50c1toXV0uY2hpbGRyZW5fZD1hLnZha2F0YS5hcnJheV9maWx0ZXIodGhpcy5fbW9kZWwuZGF0YVtiLnBhcmVudHNbaF1dLmNoaWxkcmVuX2QsZnVuY3Rpb24oYil7cmV0dXJuLTE9PT1hLmluQXJyYXkoYixnKX0pO2ZvcihqPTAsaz1nLmxlbmd0aDtrPmo7aisrKWlmKHRoaXMuX21vZGVsLmRhdGFbZ1tqXV0uc3RhdGUuc2VsZWN0ZWQpe2w9ITA7YnJlYWt9Zm9yKGwmJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfZmlsdGVyKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxmdW5jdGlvbihiKXtyZXR1cm4tMT09PWEuaW5BcnJheShiLGcpfSkpLHRoaXMudHJpZ2dlcihcImRlbGV0ZV9ub2RlXCIse25vZGU6YixwYXJlbnQ6ZS5pZH0pLGwmJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVsZXRlX25vZGVcIixub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLHBhcmVudDplLmlkfSksaj0wLGs9Zy5sZW5ndGg7az5qO2orKylkZWxldGUgdGhpcy5fbW9kZWwuZGF0YVtnW2pdXTtyZXR1cm4tMSE9PWEuaW5BcnJheSh0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCxnKSYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW51bGwsbT10aGlzLmVsZW1lbnRbMF0uc2Nyb2xsVG9wLG49dGhpcy5lbGVtZW50WzBdLnNjcm9sbExlZnQsZS5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS5jaGlsZHJlblswXSYmdGhpcy5nZXRfbm9kZSh0aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuWzBdLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk6dGhpcy5nZXRfbm9kZShlLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCksdGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcD1tLHRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0PW4pLHRoaXMucmVkcmF3X25vZGUoZSwhMCksITB9LGNoZWNrOmZ1bmN0aW9uKGIsYyxkLGUsZil7Yz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSxkPWQmJmQuaWQ/ZDp0aGlzLmdldF9ub2RlKGQpO3ZhciBnPWIubWF0Y2goL15tb3ZlX25vZGV8Y29weV9ub2RlfGNyZWF0ZV9ub2RlJC9pKT9kOmMsaD10aGlzLnNldHRpbmdzLmNvcmUuY2hlY2tfY2FsbGJhY2s7cmV0dXJuXCJtb3ZlX25vZGVcIiE9PWJ8fGYmJmYuaXNfbXVsdGl8fGMuaWQhPT1kLmlkJiYoXCJtb3ZlX25vZGVcIiE9PWJ8fGEuaW5BcnJheShjLmlkLGQuY2hpbGRyZW4pIT09ZSkmJi0xPT09YS5pbkFycmF5KGQuaWQsYy5jaGlsZHJlbl9kKT8oZyYmZy5kYXRhJiYoZz1nLmRhdGEpLGcmJmcuZnVuY3Rpb25zJiYoZy5mdW5jdGlvbnNbYl09PT0hMXx8Zy5mdW5jdGlvbnNbYl09PT0hMCk/KGcuZnVuY3Rpb25zW2JdPT09ITEmJih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDJcIixyZWFzb246XCJOb2RlIGRhdGEgcHJldmVudHMgZnVuY3Rpb246IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmUsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZCYmZC5pZD9kLmlkOiExfSl9KSxnLmZ1bmN0aW9uc1tiXSk6aD09PSExfHxhLmlzRnVuY3Rpb24oaCkmJmguY2FsbCh0aGlzLGIsYyxkLGUsZik9PT0hMXx8aCYmaFtiXT09PSExPyh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDNcIixyZWFzb246XCJVc2VyIGNvbmZpZyBmb3IgY29yZS5jaGVja19jYWxsYmFjayBwcmV2ZW50cyBmdW5jdGlvbjogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZSxvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjpkJiZkLmlkP2QuaWQ6ITF9KX0sITEpOiEwKToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAxXCIscmVhc29uOlwiTW92aW5nIHBhcmVudCBpbnNpZGUgY2hpbGRcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZSxvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjpkJiZkLmlkP2QuaWQ6ITF9KX0sITEpfSxsYXN0X2Vycm9yOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yfSxtb3ZlX25vZGU6ZnVuY3Rpb24oYyxkLGUsZixnLGgsaSl7dmFyIGosayxsLG0sbixvLHAscSxyLHMsdCx1LHYsdztpZihkPXRoaXMuZ2V0X25vZGUoZCksZT1lPT09Yj8wOmUsIWQpcmV0dXJuITE7aWYoIWUudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhZyYmIXRoaXMuaXNfbG9hZGVkKGQpKXJldHVybiB0aGlzLmxvYWRfbm9kZShkLGZ1bmN0aW9uKCl7dGhpcy5tb3ZlX25vZGUoYyxkLGUsZiwhMCwhMSxpKX0pO2lmKGEuaXNBcnJheShjKSl7aWYoMSE9PWMubGVuZ3RoKXtmb3Ioaj0wLGs9Yy5sZW5ndGg7az5qO2orKykocj10aGlzLm1vdmVfbm9kZShjW2pdLGQsZSxmLGcsITEsaSkpJiYoZD1yLGU9XCJhZnRlclwiKTtyZXR1cm4gdGhpcy5yZWRyYXcoKSwhMH1jPWNbMF19aWYoYz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSwhY3x8Yy5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7aWYobD0oYy5wYXJlbnR8fGEuanN0cmVlLnJvb3QpLnRvU3RyaW5nKCksbj1lLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmZC5pZCE9PWEuanN0cmVlLnJvb3Q/dGhpcy5nZXRfbm9kZShkLnBhcmVudCk6ZCxvPWk/aTp0aGlzLl9tb2RlbC5kYXRhW2MuaWRdP3RoaXM6YS5qc3RyZWUucmVmZXJlbmNlKGMuaWQpLHA9IW98fCFvLl9pZHx8dGhpcy5faWQhPT1vLl9pZCxtPW8mJm8uX2lkJiZsJiZvLl9tb2RlbC5kYXRhW2xdJiZvLl9tb2RlbC5kYXRhW2xdLmNoaWxkcmVuP2EuaW5BcnJheShjLmlkLG8uX21vZGVsLmRhdGFbbF0uY2hpbGRyZW4pOi0xLG8mJm8uX2lkJiYoYz1vLl9tb2RlbC5kYXRhW2MuaWRdKSxwKXJldHVybihyPXRoaXMuY29weV9ub2RlKGMsZCxlLGYsZywhMSxpKSk/KG8mJm8uZGVsZXRlX25vZGUoYykscik6ITE7c3dpdGNoKGQuaWQ9PT1hLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PWUmJihlPVwiZmlyc3RcIiksXCJhZnRlclwiPT09ZSYmKGU9XCJsYXN0XCIpKSxlKXtjYXNlXCJiZWZvcmVcIjplPWEuaW5BcnJheShkLmlkLG4uY2hpbGRyZW4pO2JyZWFrO2Nhc2VcImFmdGVyXCI6ZT1hLmluQXJyYXkoZC5pZCxuLmNoaWxkcmVuKSsxO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6ZT0wO2JyZWFrO2Nhc2VcImxhc3RcIjplPW4uY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6ZXx8KGU9MCl9aWYoZT5uLmNoaWxkcmVuLmxlbmd0aCYmKGU9bi5jaGlsZHJlbi5sZW5ndGgpLCF0aGlzLmNoZWNrKFwibW92ZV9ub2RlXCIsYyxuLGUse2NvcmU6ITAsb3JpZ2luOmksaXNfbXVsdGk6byYmby5faWQmJm8uX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohb3x8IW8uX2lkfSkpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKGMucGFyZW50PT09bi5pZCl7Zm9yKHE9bi5jaGlsZHJlbi5jb25jYXQoKSxyPWEuaW5BcnJheShjLmlkLHEpLC0xIT09ciYmKHE9YS52YWthdGEuYXJyYXlfcmVtb3ZlKHEsciksZT5yJiZlLS0pLHI9W10scz0wLHQ9cS5sZW5ndGg7dD5zO3MrKylyW3M+PWU/cysxOnNdPXFbc107cltlXT1jLmlkLG4uY2hpbGRyZW49cix0aGlzLl9ub2RlX2NoYW5nZWQobi5pZCksdGhpcy5yZWRyYXcobi5pZD09PWEuanN0cmVlLnJvb3QpfWVsc2V7Zm9yKHI9Yy5jaGlsZHJlbl9kLmNvbmNhdCgpLHIucHVzaChjLmlkKSxzPTAsdD1jLnBhcmVudHMubGVuZ3RoO3Q+cztzKyspe2ZvcihxPVtdLHc9by5fbW9kZWwuZGF0YVtjLnBhcmVudHNbc11dLmNoaWxkcmVuX2QsdT0wLHY9dy5sZW5ndGg7dj51O3UrKyktMT09PWEuaW5BcnJheSh3W3VdLHIpJiZxLnB1c2god1t1XSk7by5fbW9kZWwuZGF0YVtjLnBhcmVudHNbc11dLmNoaWxkcmVuX2Q9cX1mb3Ioby5fbW9kZWwuZGF0YVtsXS5jaGlsZHJlbj1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbShvLl9tb2RlbC5kYXRhW2xdLmNoaWxkcmVuLGMuaWQpLHM9MCx0PW4ucGFyZW50cy5sZW5ndGg7dD5zO3MrKyl0aGlzLl9tb2RlbC5kYXRhW24ucGFyZW50c1tzXV0uY2hpbGRyZW5fZD10aGlzLl9tb2RlbC5kYXRhW24ucGFyZW50c1tzXV0uY2hpbGRyZW5fZC5jb25jYXQocik7Zm9yKHE9W10scz0wLHQ9bi5jaGlsZHJlbi5sZW5ndGg7dD5zO3MrKylxW3M+PWU/cysxOnNdPW4uY2hpbGRyZW5bc107Zm9yKHFbZV09Yy5pZCxuLmNoaWxkcmVuPXEsbi5jaGlsZHJlbl9kLnB1c2goYy5pZCksbi5jaGlsZHJlbl9kPW4uY2hpbGRyZW5fZC5jb25jYXQoYy5jaGlsZHJlbl9kKSxjLnBhcmVudD1uLmlkLHI9bi5wYXJlbnRzLmNvbmNhdCgpLHIudW5zaGlmdChuLmlkKSx3PWMucGFyZW50cy5sZW5ndGgsYy5wYXJlbnRzPXIscj1yLmNvbmNhdCgpLHM9MCx0PWMuY2hpbGRyZW5fZC5sZW5ndGg7dD5zO3MrKyl0aGlzLl9tb2RlbC5kYXRhW2MuY2hpbGRyZW5fZFtzXV0ucGFyZW50cz10aGlzLl9tb2RlbC5kYXRhW2MuY2hpbGRyZW5fZFtzXV0ucGFyZW50cy5zbGljZSgwLC0xKncpLEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHRoaXMuX21vZGVsLmRhdGFbYy5jaGlsZHJlbl9kW3NdXS5wYXJlbnRzLHIpO2whPT1hLmpzdHJlZS5yb290JiZuLmlkIT09YS5qc3RyZWUucm9vdHx8KHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwKSx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhd3x8KHRoaXMuX25vZGVfY2hhbmdlZChsKSx0aGlzLl9ub2RlX2NoYW5nZWQobi5pZCkpLGh8fHRoaXMucmVkcmF3KCl9cmV0dXJuIGYmJmYuY2FsbCh0aGlzLGMsbixlKSx0aGlzLnRyaWdnZXIoXCJtb3ZlX25vZGVcIix7bm9kZTpjLHBhcmVudDpuLmlkLHBvc2l0aW9uOmUsb2xkX3BhcmVudDpsLG9sZF9wb3NpdGlvbjptLGlzX211bHRpOm8mJm8uX2lkJiZvLl9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IW98fCFvLl9pZCxvbGRfaW5zdGFuY2U6byxuZXdfaW5zdGFuY2U6dGhpc30pLGMuaWR9LGNvcHlfbm9kZTpmdW5jdGlvbihjLGQsZSxmLGcsaCxpKXt2YXIgaixrLGwsbSxuLG8scCxxLHIscyx0O2lmKGQ9dGhpcy5nZXRfbm9kZShkKSxlPWU9PT1iPzA6ZSwhZClyZXR1cm4hMTtpZighZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFnJiYhdGhpcy5pc19sb2FkZWQoZCkpcmV0dXJuIHRoaXMubG9hZF9ub2RlKGQsZnVuY3Rpb24oKXt0aGlzLmNvcHlfbm9kZShjLGQsZSxmLCEwLCExLGkpfSk7aWYoYS5pc0FycmF5KGMpKXtpZigxIT09Yy5sZW5ndGgpe2ZvcihqPTAsaz1jLmxlbmd0aDtrPmo7aisrKShtPXRoaXMuY29weV9ub2RlKGNbal0sZCxlLGYsZywhMCxpKSkmJihkPW0sZT1cImFmdGVyXCIpO3JldHVybiB0aGlzLnJlZHJhdygpLCEwfWM9Y1swXX1pZihjPWMmJmMuaWQ/Yzp0aGlzLmdldF9ub2RlKGMpLCFjfHxjLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4hMTtzd2l0Y2gocT0oYy5wYXJlbnR8fGEuanN0cmVlLnJvb3QpLnRvU3RyaW5nKCkscj1lLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmZC5pZCE9PWEuanN0cmVlLnJvb3Q/dGhpcy5nZXRfbm9kZShkLnBhcmVudCk6ZCxzPWk/aTp0aGlzLl9tb2RlbC5kYXRhW2MuaWRdP3RoaXM6YS5qc3RyZWUucmVmZXJlbmNlKGMuaWQpLHQ9IXN8fCFzLl9pZHx8dGhpcy5faWQhPT1zLl9pZCxzJiZzLl9pZCYmKGM9cy5fbW9kZWwuZGF0YVtjLmlkXSksZC5pZD09PWEuanN0cmVlLnJvb3QmJihcImJlZm9yZVwiPT09ZSYmKGU9XCJmaXJzdFwiKSxcImFmdGVyXCI9PT1lJiYoZT1cImxhc3RcIikpLGUpe2Nhc2VcImJlZm9yZVwiOmU9YS5pbkFycmF5KGQuaWQsci5jaGlsZHJlbik7YnJlYWs7Y2FzZVwiYWZ0ZXJcIjplPWEuaW5BcnJheShkLmlkLHIuY2hpbGRyZW4pKzE7YnJlYWs7Y2FzZVwiaW5zaWRlXCI6Y2FzZVwiZmlyc3RcIjplPTA7YnJlYWs7Y2FzZVwibGFzdFwiOmU9ci5jaGlsZHJlbi5sZW5ndGg7YnJlYWs7ZGVmYXVsdDplfHwoZT0wKX1pZihlPnIuY2hpbGRyZW4ubGVuZ3RoJiYoZT1yLmNoaWxkcmVuLmxlbmd0aCksIXRoaXMuY2hlY2soXCJjb3B5X25vZGVcIixjLHIsZSx7Y29yZTohMCxvcmlnaW46aSxpc19tdWx0aTpzJiZzLl9pZCYmcy5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiFzfHwhcy5faWR9KSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7aWYocD1zP3MuZ2V0X2pzb24oYyx7bm9faWQ6ITAsbm9fZGF0YTohMCxub19zdGF0ZTohMH0pOmMsIXApcmV0dXJuITE7aWYocC5pZD09PSEwJiZkZWxldGUgcC5pZCxwPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihwLHIuaWQsci5wYXJlbnRzLmNvbmNhdCgpKSwhcClyZXR1cm4hMTtmb3IobT10aGlzLmdldF9ub2RlKHApLGMmJmMuc3RhdGUmJmMuc3RhdGUubG9hZGVkPT09ITEmJihtLnN0YXRlLmxvYWRlZD0hMSksbD1bXSxsLnB1c2gocCksbD1sLmNvbmNhdChtLmNoaWxkcmVuX2QpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmwscGFyZW50OnIuaWR9KSxuPTAsbz1yLnBhcmVudHMubGVuZ3RoO28+bjtuKyspdGhpcy5fbW9kZWwuZGF0YVtyLnBhcmVudHNbbl1dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtyLnBhcmVudHNbbl1dLmNoaWxkcmVuX2QuY29uY2F0KGwpO2ZvcihsPVtdLG49MCxvPXIuY2hpbGRyZW4ubGVuZ3RoO28+bjtuKyspbFtuPj1lP24rMTpuXT1yLmNoaWxkcmVuW25dO3JldHVybiBsW2VdPW0uaWQsci5jaGlsZHJlbj1sLHIuY2hpbGRyZW5fZC5wdXNoKG0uaWQpLHIuY2hpbGRyZW5fZD1yLmNoaWxkcmVuX2QuY29uY2F0KG0uY2hpbGRyZW5fZCksci5pZD09PWEuanN0cmVlLnJvb3QmJih0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXd8fHRoaXMuX25vZGVfY2hhbmdlZChyLmlkKSxofHx0aGlzLnJlZHJhdyhyLmlkPT09YS5qc3RyZWUucm9vdCksZiYmZi5jYWxsKHRoaXMsbSxyLGUpLHRoaXMudHJpZ2dlcihcImNvcHlfbm9kZVwiLHtub2RlOm0sb3JpZ2luYWw6YyxwYXJlbnQ6ci5pZCxwb3NpdGlvbjplLG9sZF9wYXJlbnQ6cSxvbGRfcG9zaXRpb246cyYmcy5faWQmJnEmJnMuX21vZGVsLmRhdGFbcV0mJnMuX21vZGVsLmRhdGFbcV0uY2hpbGRyZW4/YS5pbkFycmF5KGMuaWQscy5fbW9kZWwuZGF0YVtxXS5jaGlsZHJlbik6LTEsaXNfbXVsdGk6cyYmcy5faWQmJnMuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohc3x8IXMuX2lkLG9sZF9pbnN0YW5jZTpzLG5ld19pbnN0YW5jZTp0aGlzfSksbS5pZH0sY3V0OmZ1bmN0aW9uKGIpe2lmKGJ8fChiPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoKSksYS5pc0FycmF5KGIpfHwoYj1bYl0pLCFiLmxlbmd0aClyZXR1cm4hMTt2YXIgYz1bXSxnLGgsaTtmb3IoaD0wLGk9Yi5sZW5ndGg7aT5oO2grKylnPXRoaXMuZ2V0X25vZGUoYltoXSksZyYmZy5pZCYmZy5pZCE9PWEuanN0cmVlLnJvb3QmJmMucHVzaChnKTtyZXR1cm4gYy5sZW5ndGg/KGQ9YyxmPXRoaXMsZT1cIm1vdmVfbm9kZVwiLHZvaWQgdGhpcy50cmlnZ2VyKFwiY3V0XCIse25vZGU6Yn0pKTohMX0sY29weTpmdW5jdGlvbihiKXtpZihifHwoYj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KCkpLGEuaXNBcnJheShiKXx8KGI9W2JdKSwhYi5sZW5ndGgpcmV0dXJuITE7dmFyIGM9W10sZyxoLGk7Zm9yKGg9MCxpPWIubGVuZ3RoO2k+aDtoKyspZz10aGlzLmdldF9ub2RlKGJbaF0pLGcmJmcuaWQmJmcuaWQhPT1hLmpzdHJlZS5yb290JiZjLnB1c2goZyk7cmV0dXJuIGMubGVuZ3RoPyhkPWMsZj10aGlzLGU9XCJjb3B5X25vZGVcIix2b2lkIHRoaXMudHJpZ2dlcihcImNvcHlcIix7bm9kZTpifSkpOiExfSxnZXRfYnVmZmVyOmZ1bmN0aW9uKCl7cmV0dXJue21vZGU6ZSxub2RlOmQsaW5zdDpmfX0sY2FuX3Bhc3RlOmZ1bmN0aW9uKCl7cmV0dXJuIGUhPT0hMSYmZCE9PSExfSxwYXN0ZTpmdW5jdGlvbihhLGIpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmZSYmZS5tYXRjaCgvXihjb3B5X25vZGV8bW92ZV9ub2RlKSQvKSYmZD8odGhpc1tlXShkLGEsYiwhMSwhMSwhMSxmKSYmdGhpcy50cmlnZ2VyKFwicGFzdGVcIix7cGFyZW50OmEuaWQsbm9kZTpkLG1vZGU6ZX0pLGQ9ITEsZT0hMSx2b2lkKGY9ITEpKTohMX0sY2xlYXJfYnVmZmVyOmZ1bmN0aW9uKCl7ZD0hMSxlPSExLGY9ITEsdGhpcy50cmlnZ2VyKFwiY2xlYXJfYnVmZmVyXCIpfSxlZGl0OmZ1bmN0aW9uKGIsYyxkKXt2YXIgZSxmLGcsaCxqLGssbCxtLG4sbz0hMTtyZXR1cm4oYj10aGlzLmdldF9ub2RlKGIpKT90aGlzLnNldHRpbmdzLmNvcmUuY2hlY2tfY2FsbGJhY2s9PT0hMT8odGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA3XCIscmVhc29uOlwiQ291bGQgbm90IGVkaXQgbm9kZSBiZWNhdXNlIG9mIGNoZWNrX2NhbGxiYWNrXCJ9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExKToobj1iLGM9XCJzdHJpbmdcIj09dHlwZW9mIGM/YzpiLnRleHQsdGhpcy5zZXRfdGV4dChiLFwiXCIpLGI9dGhpcy5fb3Blbl90byhiKSxuLnRleHQ9YyxlPXRoaXMuX2RhdGEuY29yZS5ydGwsZj10aGlzLmVsZW1lbnQud2lkdGgoKSx0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1uLmlkLGc9Yi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCksaD1hKFwiPHNwYW4+XCIpLGo9YyxrPWEoXCI8ZGl2IC8+XCIse2Nzczp7cG9zaXRpb246XCJhYnNvbHV0ZVwiLHRvcDpcIi0yMDBweFwiLGxlZnQ6ZT9cIjBweFwiOlwiLTEwMDBweFwiLHZpc2liaWxpdHk6XCJoaWRkZW5cIn19KS5hcHBlbmRUbyhcImJvZHlcIiksbD1hKFwiPGlucHV0IC8+XCIse3ZhbHVlOmosXCJjbGFzc1wiOlwianN0cmVlLXJlbmFtZS1pbnB1dFwiLGNzczp7cGFkZGluZzpcIjBcIixib3JkZXI6XCIxcHggc29saWQgc2lsdmVyXCIsXCJib3gtc2l6aW5nXCI6XCJib3JkZXItYm94XCIsZGlzcGxheTpcImlubGluZS1ibG9ja1wiLGhlaWdodDp0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0K1wicHhcIixsaW5lSGVpZ2h0OnRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQrXCJweFwiLHdpZHRoOlwiMTUwcHhcIn0sYmx1cjphLnByb3h5KGZ1bmN0aW9uKGMpe2Muc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYy5wcmV2ZW50RGVmYXVsdCgpO3ZhciBlPWguY2hpbGRyZW4oXCIuanN0cmVlLXJlbmFtZS1pbnB1dFwiKSxmPWUudmFsKCksaT10aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dCxtO1wiXCI9PT1mJiYoZj1qKSxrLnJlbW92ZSgpLGgucmVwbGFjZVdpdGgoZyksaC5yZW1vdmUoKSxqPWk/ajphKFwiPGRpdj48L2Rpdj5cIikuYXBwZW5kKGEucGFyc2VIVE1MKGopKS5odG1sKCksdGhpcy5zZXRfdGV4dChiLGopLG09ISF0aGlzLnJlbmFtZV9ub2RlKGIsaT9hKFwiPGRpdj48L2Rpdj5cIikudGV4dChmKS50ZXh0KCk6YShcIjxkaXY+PC9kaXY+XCIpLmFwcGVuZChhLnBhcnNlSFRNTChmKSkuaHRtbCgpKSxtfHx0aGlzLnNldF90ZXh0KGIsaiksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bi5pZCxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt2YXIgYT10aGlzLmdldF9ub2RlKG4uaWQsITApO2EubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bi5pZCxhLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSl9LHRoaXMpLDApLGQmJmQuY2FsbCh0aGlzLG4sbSxvKSxsPW51bGx9LHRoaXMpLGtleWRvd246ZnVuY3Rpb24oYSl7dmFyIGI9YS53aGljaDsyNz09PWImJihvPSEwLHRoaXMudmFsdWU9aiksMjchPT1iJiYxMyE9PWImJjM3IT09YiYmMzghPT1iJiYzOSE9PWImJjQwIT09YiYmMzIhPT1ifHxhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLDI3IT09YiYmMTMhPT1ifHwoYS5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuYmx1cigpKX0sY2xpY2s6ZnVuY3Rpb24oYSl7YS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKX0sbW91c2Vkb3duOmZ1bmN0aW9uKGEpe2Euc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9LGtleXVwOmZ1bmN0aW9uKGEpe2wud2lkdGgoTWF0aC5taW4oay50ZXh0KFwicFdcIit0aGlzLnZhbHVlKS53aWR0aCgpLGYpKX0sa2V5cHJlc3M6ZnVuY3Rpb24oYSl7cmV0dXJuIDEzPT09YS53aGljaD8hMTp2b2lkIDB9fSksbT17Zm9udEZhbWlseTpnLmNzcyhcImZvbnRGYW1pbHlcIil8fFwiXCIsZm9udFNpemU6Zy5jc3MoXCJmb250U2l6ZVwiKXx8XCJcIixmb250V2VpZ2h0OmcuY3NzKFwiZm9udFdlaWdodFwiKXx8XCJcIixmb250U3R5bGU6Zy5jc3MoXCJmb250U3R5bGVcIil8fFwiXCIsZm9udFN0cmV0Y2g6Zy5jc3MoXCJmb250U3RyZXRjaFwiKXx8XCJcIixmb250VmFyaWFudDpnLmNzcyhcImZvbnRWYXJpYW50XCIpfHxcIlwiLGxldHRlclNwYWNpbmc6Zy5jc3MoXCJsZXR0ZXJTcGFjaW5nXCIpfHxcIlwiLHdvcmRTcGFjaW5nOmcuY3NzKFwid29yZFNwYWNpbmdcIil8fFwiXCJ9LGguYXR0cihcImNsYXNzXCIsZy5hdHRyKFwiY2xhc3NcIikpLmFwcGVuZChnLmNvbnRlbnRzKCkuY2xvbmUoKSkuYXBwZW5kKGwpLGcucmVwbGFjZVdpdGgoaCksay5jc3MobSksbC5jc3MobSkud2lkdGgoTWF0aC5taW4oay50ZXh0KFwicFdcIitsWzBdLnZhbHVlKS53aWR0aCgpLGYpKVswXS5zZWxlY3QoKSx2b2lkIGEoaSkub25lKFwibW91c2Vkb3duLmpzdHJlZSB0b3VjaHN0YXJ0LmpzdHJlZSBkbmRfc3RhcnQudmFrYXRhXCIsZnVuY3Rpb24oYil7XG5sJiZiLnRhcmdldCE9PWwmJmEobCkuYmx1cigpfSkpOiExfSxzZXRfdGhlbWU6ZnVuY3Rpb24oYixjKXtpZighYilyZXR1cm4hMTtpZihjPT09ITApe3ZhciBkPXRoaXMuc2V0dGluZ3MuY29yZS50aGVtZXMuZGlyO2R8fChkPWEuanN0cmVlLnBhdGgrXCIvdGhlbWVzXCIpLGM9ZCtcIi9cIitiK1wiL3N0eWxlLmNzc1wifWMmJi0xPT09YS5pbkFycmF5KGMsZykmJihhKFwiaGVhZFwiKS5hcHBlbmQoJzxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiJytjKydcIiB0eXBlPVwidGV4dC9jc3NcIiAvPicpLGcucHVzaChjKSksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lKSx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWU9Yix0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJqc3RyZWUtXCIrYiksdGhpcy5lbGVtZW50W3RoaXMuc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcImpzdHJlZS1cIitiK1wiLXJlc3BvbnNpdmVcIiksdGhpcy50cmlnZ2VyKFwic2V0X3RoZW1lXCIse3RoZW1lOmJ9KX0sZ2V0X3RoZW1lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZX0sc2V0X3RoZW1lX3ZhcmlhbnQ6ZnVuY3Rpb24oYSl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50JiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lK1wiLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudCksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50PWEsYSYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZStcIi1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQpfSxnZXRfdGhlbWVfdmFyaWFudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnR9LHNob3dfc3RyaXBlczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz0hMCx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1zdHJpcGVkXCIpfSxoaWRlX3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM9ITEsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtc3RyaXBlZFwiKX0sdG9nZ2xlX3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM/dGhpcy5oaWRlX3N0cmlwZXMoKTp0aGlzLnNob3dfc3RyaXBlcygpfSxzaG93X2RvdHM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbm8tZG90c1wiKX0saGlkZV9kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWRvdHNcIil9LHRvZ2dsZV9kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzP3RoaXMuaGlkZV9kb3RzKCk6dGhpcy5zaG93X2RvdHMoKX0sc2hvd19pY29uczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuaWNvbnM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbm8taWNvbnNcIil9LGhpZGVfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWljb25zXCIpfSx0b2dnbGVfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zP3RoaXMuaGlkZV9pY29ucygpOnRoaXMuc2hvd19pY29ucygpfSxzZXRfaWNvbjpmdW5jdGlvbihjLGQpe3ZhciBlLGYsZyxoO2lmKGEuaXNBcnJheShjKSl7Zm9yKGM9Yy5zbGljZSgpLGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspdGhpcy5zZXRfaWNvbihjW2VdLGQpO3JldHVybiEwfXJldHVybiBjPXRoaXMuZ2V0X25vZGUoYyksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3Q/KGg9Yy5pY29uLGMuaWNvbj1kPT09ITB8fG51bGw9PT1kfHxkPT09Ynx8XCJcIj09PWQ/ITA6ZCxnPXRoaXMuZ2V0X25vZGUoYywhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLGQ9PT0hMT90aGlzLmhpZGVfaWNvbihjKTpkPT09ITB8fG51bGw9PT1kfHxkPT09Ynx8XCJcIj09PWQ/KGcucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWN1c3RvbSBcIitoKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJcIikucmVtb3ZlQXR0cihcInJlbFwiKSxoPT09ITEmJnRoaXMuc2hvd19pY29uKGMpKTotMT09PWQuaW5kZXhPZihcIi9cIikmJi0xPT09ZC5pbmRleE9mKFwiLlwiKT8oZy5yZW1vdmVDbGFzcyhoKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJcIiksZy5hZGRDbGFzcyhkK1wiIGpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpLmF0dHIoXCJyZWxcIixkKSxoPT09ITEmJnRoaXMuc2hvd19pY29uKGMpKTooZy5yZW1vdmVDbGFzcyhoKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJcIiksZy5hZGRDbGFzcyhcImpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpLmNzcyhcImJhY2tncm91bmRcIixcInVybCgnXCIrZCtcIicpIGNlbnRlciBjZW50ZXIgbm8tcmVwZWF0XCIpLmF0dHIoXCJyZWxcIixkKSxoPT09ITEmJnRoaXMuc2hvd19pY29uKGMpKSwhMCk6ITF9LGdldF9pY29uOmZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi5pY29uOiExfSxoaWRlX2ljb246ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuaGlkZV9pY29uKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYiE9PWEuanN0cmVlLnJvb3Q/KGIuaWNvbj0hMSx0aGlzLmdldF9ub2RlKGIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKS5hZGRDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpLCEwKTohMX0sc2hvd19pY29uOmZ1bmN0aW9uKGIpe3ZhciBjLGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuc2hvd19pY29uKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYiE9PWEuanN0cmVlLnJvb3Q/KGU9dGhpcy5nZXRfbm9kZShiLCEwKSxiLmljb249ZS5sZW5ndGg/ZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikuYXR0cihcInJlbFwiKTohMCxiLmljb258fChiLmljb249ITApLGUuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXRoZW1laWNvbi1oaWRkZW5cIiksITApOiExfX0sYS52YWthdGE9e30sYS52YWthdGEuYXR0cmlidXRlcz1mdW5jdGlvbihiLGMpe2I9YShiKVswXTt2YXIgZD1jP3t9OltdO3JldHVybiBiJiZiLmF0dHJpYnV0ZXMmJmEuZWFjaChiLmF0dHJpYnV0ZXMsZnVuY3Rpb24oYixlKXstMT09PWEuaW5BcnJheShlLm5hbWUudG9Mb3dlckNhc2UoKSxbXCJzdHlsZVwiLFwiY29udGVudGVkaXRhYmxlXCIsXCJoYXNmb2N1c1wiLFwidGFiaW5kZXhcIl0pJiZudWxsIT09ZS52YWx1ZSYmXCJcIiE9PWEudHJpbShlLnZhbHVlKSYmKGM/ZFtlLm5hbWVdPWUudmFsdWU6ZC5wdXNoKGUubmFtZSkpfSksZH0sYS52YWthdGEuYXJyYXlfdW5pcXVlPWZ1bmN0aW9uKGEpe3ZhciBjPVtdLGQsZSxmLGc9e307Zm9yKGQ9MCxmPWEubGVuZ3RoO2Y+ZDtkKyspZ1thW2RdXT09PWImJihjLnB1c2goYVtkXSksZ1thW2RdXT0hMCk7cmV0dXJuIGN9LGEudmFrYXRhLmFycmF5X3JlbW92ZT1mdW5jdGlvbihhLGIpe3JldHVybiBhLnNwbGljZShiLDEpLGF9LGEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS5pbkFycmF5KGMsYik7cmV0dXJuLTEhPT1kP2EudmFrYXRhLmFycmF5X3JlbW92ZShiLGQpOmJ9LGEudmFrYXRhLmFycmF5X2ZpbHRlcj1mdW5jdGlvbihhLGIsYyxkLGUpe2lmKGEuZmlsdGVyKXJldHVybiBhLmZpbHRlcihiLGMpO2Q9W107Zm9yKGUgaW4gYSl+fmUrXCJcIj09ZStcIlwiJiZlPj0wJiZiLmNhbGwoYyxhW2VdLCtlLGEpJiZkLnB1c2goYVtlXSk7cmV0dXJuIGR9LGEuanN0cmVlLnBsdWdpbnMuY2hhbmdlZD1mdW5jdGlvbihhLGIpe3ZhciBjPVtdO3RoaXMudHJpZ2dlcj1mdW5jdGlvbihhLGQpe3ZhciBlLGY7aWYoZHx8KGQ9e30pLFwiY2hhbmdlZFwiPT09YS5yZXBsYWNlKFwiLmpzdHJlZVwiLFwiXCIpKXtkLmNoYW5nZWQ9e3NlbGVjdGVkOltdLGRlc2VsZWN0ZWQ6W119O3ZhciBnPXt9O2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWdbY1tlXV09MTtmb3IoZT0wLGY9ZC5zZWxlY3RlZC5sZW5ndGg7Zj5lO2UrKylnW2Quc2VsZWN0ZWRbZV1dP2dbZC5zZWxlY3RlZFtlXV09MjpkLmNoYW5nZWQuc2VsZWN0ZWQucHVzaChkLnNlbGVjdGVkW2VdKTtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKykxPT09Z1tjW2VdXSYmZC5jaGFuZ2VkLmRlc2VsZWN0ZWQucHVzaChjW2VdKTtjPWQuc2VsZWN0ZWQuc2xpY2UoKX1iLnRyaWdnZXIuY2FsbCh0aGlzLGEsZCl9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihhLGQpe3JldHVybiBjPVtdLGIucmVmcmVzaC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fTt2YXIgbT1pLmNyZWF0ZUVsZW1lbnQoXCJJXCIpO20uY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLWNoZWNrYm94XCIsbS5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksYS5qc3RyZWUuZGVmYXVsdHMuY2hlY2tib3g9e3Zpc2libGU6ITAsdGhyZWVfc3RhdGU6ITAsd2hvbGVfbm9kZTohMCxrZWVwX3NlbGVjdGVkX3N0eWxlOiEwLGNhc2NhZGU6XCJcIix0aWVfc2VsZWN0aW9uOiEwfSxhLmpzdHJlZS5wbHVnaW5zLmNoZWNrYm94PWZ1bmN0aW9uKGMsZCl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ZC5iaW5kLmNhbGwodGhpcyksdGhpcy5fZGF0YS5jaGVja2JveC51dG89ITEsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRocmVlX3N0YXRlJiYodGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlPVwidXArZG93bit1bmRldGVybWluZWRcIiksdGhpcy5lbGVtZW50Lm9uKFwiaW5pdC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jaGVja2JveC52aXNpYmxlPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudmlzaWJsZSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LmtlZXBfc2VsZWN0ZWRfc3R5bGV8fHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1uby1jbGlja2VkXCIpLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LXNlbGVjdGlvblwiKX0sdGhpcykpLm9uKFwibG9hZGluZy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpc1t0aGlzLl9kYXRhLmNoZWNrYm94LnZpc2libGU/XCJzaG93X2NoZWNrYm94ZXNcIjpcImhpZGVfY2hlY2tib3hlc1wiXSgpfSx0aGlzKSksLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVuZGV0ZXJtaW5lZFwiKSYmdGhpcy5lbGVtZW50Lm9uKFwiY2hhbmdlZC5qc3RyZWUgdW5jaGVja19ub2RlLmpzdHJlZSBjaGVja19ub2RlLmpzdHJlZSB1bmNoZWNrX2FsbC5qc3RyZWUgY2hlY2tfYWxsLmpzdHJlZSBtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUgcmVkcmF3LmpzdHJlZSBvcGVuX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY2hlY2tib3gudXRvJiZjbGVhclRpbWVvdXQodGhpcy5fZGF0YS5jaGVja2JveC51dG8pLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPXNldFRpbWVvdXQoYS5wcm94eSh0aGlzLl91bmRldGVybWluZWQsdGhpcyksNTApfSx0aGlzKSksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHx0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fbW9kZWwuZGF0YSxkPWNbYi5wYXJlbnRdLGU9Yi5ub2RlcyxmLGc7Zm9yKGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspY1tlW2ZdXS5zdGF0ZS5jaGVja2VkPWNbZVtmXV0uc3RhdGUuY2hlY2tlZHx8Y1tlW2ZdXS5vcmlnaW5hbCYmY1tlW2ZdXS5vcmlnaW5hbC5zdGF0ZSYmY1tlW2ZdXS5vcmlnaW5hbC5zdGF0ZS5jaGVja2VkLGNbZVtmXV0uc3RhdGUuY2hlY2tlZCYmdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5wdXNoKGVbZl0pfSx0aGlzKSksLTE9PT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVwXCIpJiYtMT09PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwiZG93blwiKXx8dGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuX21vZGVsLmRhdGEsZT1kW2MucGFyZW50XSxmPWMubm9kZXMsZz1bXSxoLGksaixrLGwsbSxuPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxvPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjtpZigtMSE9PW4uaW5kZXhPZihcImRvd25cIikpaWYoZS5zdGF0ZVtvP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl0pe2ZvcihpPTAsaj1mLmxlbmd0aDtqPmk7aSsrKWRbZltpXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwO3RoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPXRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLmNvbmNhdChmKX1lbHNlIGZvcihpPTAsaj1mLmxlbmd0aDtqPmk7aSsrKWlmKGRbZltpXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3Ioaz0wLGw9ZFtmW2ldXS5jaGlsZHJlbl9kLmxlbmd0aDtsPms7aysrKWRbZFtmW2ldXS5jaGlsZHJlbl9kW2tdXS5zdGF0ZVtvP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITA7dGhpcy5fZGF0YVtvP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9dGhpcy5fZGF0YVtvP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQuY29uY2F0KGRbZltpXV0uY2hpbGRyZW5fZCl9aWYoLTEhPT1uLmluZGV4T2YoXCJ1cFwiKSl7Zm9yKGk9MCxqPWUuY2hpbGRyZW5fZC5sZW5ndGg7aj5pO2krKylkW2UuY2hpbGRyZW5fZFtpXV0uY2hpbGRyZW4ubGVuZ3RofHxnLnB1c2goZFtlLmNoaWxkcmVuX2RbaV1dLnBhcmVudCk7Zm9yKGc9YS52YWthdGEuYXJyYXlfdW5pcXVlKGcpLGs9MCxsPWcubGVuZ3RoO2w+aztrKyspe2U9ZFtnW2tdXTt3aGlsZShlJiZlLmlkIT09YS5qc3RyZWUucm9vdCl7Zm9yKGg9MCxpPTAsaj1lLmNoaWxkcmVuLmxlbmd0aDtqPmk7aSsrKWgrPWRbZS5jaGlsZHJlbltpXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKGghPT1qKWJyZWFrO2Uuc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLHRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLnB1c2goZS5pZCksbT10aGlzLmdldF9ub2RlKGUsITApLG0mJm0ubGVuZ3RoJiZtLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3Mobz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSxlPXRoaXMuZ2V0X25vZGUoZS5wYXJlbnQpfX19dGhpcy5fZGF0YVtvP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfdW5pcXVlKHRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkKX0sdGhpcykpLm9uKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj9cInNlbGVjdF9ub2RlLmpzdHJlZVwiOlwiY2hlY2tfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yy5ub2RlLGU9dGhpcy5fbW9kZWwuZGF0YSxmPXRoaXMuZ2V0X25vZGUoZC5wYXJlbnQpLGc9dGhpcy5nZXRfbm9kZShkLCEwKSxoLGksaixrLGw9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLG09dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLG49e30sbz10aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZDtmb3IoaD0wLGk9by5sZW5ndGg7aT5oO2grKyluW29baF1dPSEwO2lmKC0xIT09bC5pbmRleE9mKFwiZG93blwiKSlmb3IoaD0wLGk9ZC5jaGlsZHJlbl9kLmxlbmd0aDtpPmg7aCsrKW5bZC5jaGlsZHJlbl9kW2hdXT0hMCxrPWVbZC5jaGlsZHJlbl9kW2hdXSxrLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCxrJiZrLm9yaWdpbmFsJiZrLm9yaWdpbmFsLnN0YXRlJiZrLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGsub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKTtpZigtMSE9PWwuaW5kZXhPZihcInVwXCIpKXdoaWxlKGYmJmYuaWQhPT1hLmpzdHJlZS5yb290KXtmb3Ioaj0wLGg9MCxpPWYuY2hpbGRyZW4ubGVuZ3RoO2k+aDtoKyspais9ZVtmLmNoaWxkcmVuW2hdXS5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoaiE9PWkpYnJlYWs7Zi5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsbltmLmlkXT0hMCxrPXRoaXMuZ2V0X25vZGUoZiwhMCksayYmay5sZW5ndGgmJmsuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGY9dGhpcy5nZXRfbm9kZShmLnBhcmVudCl9bz1bXTtmb3IoaCBpbiBuKW4uaGFzT3duUHJvcGVydHkoaCkmJm8ucHVzaChoKTt0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1vLC0xIT09bC5pbmRleE9mKFwiZG93blwiKSYmZy5sZW5ndGgmJmcuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikucGFyZW50KCkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJkZXNlbGVjdF9hbGwuanN0cmVlXCI6XCJ1bmNoZWNrX2FsbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5nZXRfbm9kZShhLmpzdHJlZS5yb290KSxlPXRoaXMuX21vZGVsLmRhdGEsZixnLGg7Zm9yKGY9MCxnPWQuY2hpbGRyZW5fZC5sZW5ndGg7Zz5mO2YrKyloPWVbZC5jaGlsZHJlbl9kW2ZdXSxoJiZoLm9yaWdpbmFsJiZoLm9yaWdpbmFsLnN0YXRlJiZoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKX0sdGhpcykpLm9uKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj9cImRlc2VsZWN0X25vZGUuanN0cmVlXCI6XCJ1bmNoZWNrX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPWMubm9kZSxlPXRoaXMuZ2V0X25vZGUoZCwhMCksZixnLGgsaT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUsaj10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24saz10aGlzLl9kYXRhW2o/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxsPXt9O2lmKGQmJmQub3JpZ2luYWwmJmQub3JpZ2luYWwuc3RhdGUmJmQub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYoZC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpLC0xIT09aS5pbmRleE9mKFwiZG93blwiKSlmb3IoZj0wLGc9ZC5jaGlsZHJlbl9kLmxlbmd0aDtnPmY7ZisrKWg9dGhpcy5fbW9kZWwuZGF0YVtkLmNoaWxkcmVuX2RbZl1dLGguc3RhdGVbaj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSExLGgmJmgub3JpZ2luYWwmJmgub3JpZ2luYWwuc3RhdGUmJmgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYoaC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpO2lmKC0xIT09aS5pbmRleE9mKFwidXBcIikpZm9yKGY9MCxnPWQucGFyZW50cy5sZW5ndGg7Zz5mO2YrKyloPXRoaXMuX21vZGVsLmRhdGFbZC5wYXJlbnRzW2ZdXSxoLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSxoJiZoLm9yaWdpbmFsJiZoLm9yaWdpbmFsLnN0YXRlJiZoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKSxoPXRoaXMuZ2V0X25vZGUoZC5wYXJlbnRzW2ZdLCEwKSxoJiZoLmxlbmd0aCYmaC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKGo/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIik7Zm9yKGw9e30sZj0wLGc9ay5sZW5ndGg7Zz5mO2YrKyktMSE9PWkuaW5kZXhPZihcImRvd25cIikmJi0xIT09YS5pbkFycmF5KGtbZl0sZC5jaGlsZHJlbl9kKXx8LTEhPT1pLmluZGV4T2YoXCJ1cFwiKSYmLTEhPT1hLmluQXJyYXkoa1tmXSxkLnBhcmVudHMpfHwobFtrW2ZdXT0hMCk7az1bXTtmb3IoZiBpbiBsKWwuaGFzT3duUHJvcGVydHkoZikmJmsucHVzaChmKTt0aGlzLl9kYXRhW2o/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1rLC0xIT09aS5pbmRleE9mKFwiZG93blwiKSYmZS5sZW5ndGgmJmUuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKGo/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikucGFyZW50KCkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSl9LHRoaXMpKSwtMSE9PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwidXBcIikmJnRoaXMuZWxlbWVudC5vbihcImRlbGV0ZV9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzLmdldF9ub2RlKGMucGFyZW50KSxlPXRoaXMuX21vZGVsLmRhdGEsZixnLGgsaSxqPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjt3aGlsZShkJiZkLmlkIT09YS5qc3RyZWUucm9vdCYmIWQuc3RhdGVbaj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3IoaD0wLGY9MCxnPWQuY2hpbGRyZW4ubGVuZ3RoO2c+ZjtmKyspaCs9ZVtkLmNoaWxkcmVuW2ZdXS5zdGF0ZVtqP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoIShnPjAmJmg9PT1nKSlicmVhaztkLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW2o/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGQuaWQpLGk9dGhpcy5nZXRfbm9kZShkLCEwKSxpJiZpLmxlbmd0aCYmaS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKGo/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksZD10aGlzLmdldF9ub2RlKGQucGFyZW50KX19LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yy5pc19tdWx0aSxlPWMub2xkX3BhcmVudCxmPXRoaXMuZ2V0X25vZGUoYy5wYXJlbnQpLGc9dGhpcy5fbW9kZWwuZGF0YSxoLGksaixrLGwsbT10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoIWQpe2g9dGhpcy5nZXRfbm9kZShlKTt3aGlsZShoJiZoLmlkIT09YS5qc3RyZWUucm9vdCYmIWguc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3IoaT0wLGo9MCxrPWguY2hpbGRyZW4ubGVuZ3RoO2s+ajtqKyspaSs9Z1toLmNoaWxkcmVuW2pdXS5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoIShrPjAmJmk9PT1rKSlicmVhaztoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGguaWQpLGw9dGhpcy5nZXRfbm9kZShoLCEwKSxsJiZsLmxlbmd0aCYmbC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksaD10aGlzLmdldF9ub2RlKGgucGFyZW50KX19aD1mO3doaWxlKGgmJmguaWQhPT1hLmpzdHJlZS5yb290KXtmb3IoaT0wLGo9MCxrPWguY2hpbGRyZW4ubGVuZ3RoO2s+ajtqKyspaSs9Z1toLmNoaWxkcmVuW2pdXS5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoaT09PWspaC5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl18fChoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGguaWQpLGw9dGhpcy5nZXRfbm9kZShoLCEwKSxsJiZsLmxlbmd0aCYmbC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikpO2Vsc2V7aWYoIWguc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKWJyZWFrO2guc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSExLHRoaXMuX2RhdGFbbT9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGFbbT9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLGguaWQpLGw9dGhpcy5nZXRfbm9kZShoLCEwKSxsJiZsLmxlbmd0aCYmbC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIil9aD10aGlzLmdldF9ub2RlKGgucGFyZW50KX19LHRoaXMpKX0sdGhpcy5fdW5kZXRlcm1pbmVkPWZ1bmN0aW9uKCl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7dmFyIGMsZCxlLGYsZz17fSxoPXRoaXMuX21vZGVsLmRhdGEsaT10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24saj10aGlzLl9kYXRhW2k/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxrPVtdLGw9dGhpcztmb3IoYz0wLGQ9ai5sZW5ndGg7ZD5jO2MrKylpZihoW2pbY11dJiZoW2pbY11dLnBhcmVudHMpZm9yKGU9MCxmPWhbaltjXV0ucGFyZW50cy5sZW5ndGg7Zj5lO2UrKyl7aWYoZ1toW2pbY11dLnBhcmVudHNbZV1dIT09YilicmVhaztoW2pbY11dLnBhcmVudHNbZV0hPT1hLmpzdHJlZS5yb290JiYoZ1toW2pbY11dLnBhcmVudHNbZV1dPSEwLGsucHVzaChoW2pbY11dLnBhcmVudHNbZV0pKX1mb3IodGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5ub3QoXCI6aGFzKC5qc3RyZWUtY2hpbGRyZW4pXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1sLmdldF9ub2RlKHRoaXMpLGo7aWYoaS5zdGF0ZS5sb2FkZWQpe2ZvcihjPTAsZD1pLmNoaWxkcmVuX2QubGVuZ3RoO2Q+YztjKyspaWYoaj1oW2kuY2hpbGRyZW5fZFtjXV0sIWouc3RhdGUubG9hZGVkJiZqLm9yaWdpbmFsJiZqLm9yaWdpbmFsLnN0YXRlJiZqLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmai5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9PT0hMClmb3IoZ1tqLmlkXT09PWImJmouaWQhPT1hLmpzdHJlZS5yb290JiYoZ1tqLmlkXT0hMCxrLnB1c2goai5pZCkpLGU9MCxmPWoucGFyZW50cy5sZW5ndGg7Zj5lO2UrKylnW2oucGFyZW50c1tlXV09PT1iJiZqLnBhcmVudHNbZV0hPT1hLmpzdHJlZS5yb290JiYoZ1tqLnBhcmVudHNbZV1dPSEwLGsucHVzaChqLnBhcmVudHNbZV0pKX1lbHNlIGlmKGkub3JpZ2luYWwmJmkub3JpZ2luYWwuc3RhdGUmJmkub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiZpLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD09PSEwKWZvcihnW2kuaWRdPT09YiYmaS5pZCE9PWEuanN0cmVlLnJvb3QmJihnW2kuaWRdPSEwLGsucHVzaChpLmlkKSksZT0wLGY9aS5wYXJlbnRzLmxlbmd0aDtmPmU7ZSsrKWdbaS5wYXJlbnRzW2VdXT09PWImJmkucGFyZW50c1tlXSE9PWEuanN0cmVlLnJvb3QmJihnW2kucGFyZW50c1tlXV09ITAsay5wdXNoKGkucGFyZW50c1tlXSkpfSksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLXVuZGV0ZXJtaW5lZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS11bmRldGVybWluZWRcIiksYz0wLGQ9ay5sZW5ndGg7ZD5jO2MrKyloW2tbY11dLnN0YXRlW2k/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXXx8KGo9dGhpcy5nZXRfbm9kZShrW2NdLCEwKSxqJiZqLmxlbmd0aCYmai5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5hZGRDbGFzcyhcImpzdHJlZS11bmRldGVybWluZWRcIikpfX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbihiLGMsZSxmKXtpZihiPWQucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpKXt2YXIgZyxoLGk9bnVsbCxqPW51bGw7Zm9yKGc9MCxoPWIuY2hpbGROb2Rlcy5sZW5ndGg7aD5nO2crKylpZihiLmNoaWxkTm9kZXNbZ10mJmIuY2hpbGROb2Rlc1tnXS5jbGFzc05hbWUmJi0xIT09Yi5jaGlsZE5vZGVzW2ddLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7aT1iLmNoaWxkTm9kZXNbZ107YnJlYWt9aSYmKCF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJnRoaXMuX21vZGVsLmRhdGFbYi5pZF0uc3RhdGUuY2hlY2tlZCYmKGkuY2xhc3NOYW1lKz1cIiBqc3RyZWUtY2hlY2tlZFwiKSxqPW0uY2xvbmVOb2RlKCExKSx0aGlzLl9tb2RlbC5kYXRhW2IuaWRdLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkJiYoai5jbGFzc05hbWUrPVwiIGpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSxpLmluc2VydEJlZm9yZShqLGkuY2hpbGROb2Rlc1swXSkpfXJldHVybiBlfHwtMT09PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwidW5kZXRlcm1pbmVkXCIpfHwodGhpcy5fZGF0YS5jaGVja2JveC51dG8mJmNsZWFyVGltZW91dCh0aGlzLl9kYXRhLmNoZWNrYm94LnV0byksdGhpcy5fZGF0YS5jaGVja2JveC51dG89c2V0VGltZW91dChhLnByb3h5KHRoaXMuX3VuZGV0ZXJtaW5lZCx0aGlzKSw1MCkpLGJ9LHRoaXMuc2hvd19jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWNoZWNrYm94ZXNcIil9LHRoaXMuaGlkZV9jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWNoZWNrYm94ZXNcIil9LHRoaXMudG9nZ2xlX2NoZWNrYm94ZXM9ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmNoZWNrYm94ZXM/dGhpcy5oaWRlX2NoZWNrYm94ZXMoKTp0aGlzLnNob3dfY2hlY2tib3hlcygpfSx0aGlzLmlzX3VuZGV0ZXJtaW5lZD1mdW5jdGlvbihiKXtiPXRoaXMuZ2V0X25vZGUoYik7dmFyIGM9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLGQsZSxmPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbixnPXRoaXMuX2RhdGFbZj9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLGg9dGhpcy5fbW9kZWwuZGF0YTtpZighYnx8Yi5zdGF0ZVtmP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09PT0hMHx8LTE9PT1jLmluZGV4T2YoXCJ1bmRldGVybWluZWRcIil8fC0xPT09Yy5pbmRleE9mKFwiZG93blwiKSYmLTE9PT1jLmluZGV4T2YoXCJ1cFwiKSlyZXR1cm4hMTtpZighYi5zdGF0ZS5sb2FkZWQmJmIub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPT09ITApcmV0dXJuITA7Zm9yKGQ9MCxlPWIuY2hpbGRyZW5fZC5sZW5ndGg7ZT5kO2QrKylpZigtMSE9PWEuaW5BcnJheShiLmNoaWxkcmVuX2RbZF0sZyl8fCFoW2IuY2hpbGRyZW5fZFtkXV0uc3RhdGUubG9hZGVkJiZoW2IuY2hpbGRyZW5fZFtkXV0ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkKXJldHVybiEwO3JldHVybiExfSx0aGlzLmRpc2FibGVfY2hlY2tib3g9ZnVuY3Rpb24oYil7dmFyIGMsZCxlO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspdGhpcy5kaXNhYmxlX2NoZWNrYm94KGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGU9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWR8fChiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkPSEwLGUmJmUubGVuZ3RoJiZlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLHRoaXMudHJpZ2dlcihcImRpc2FibGVfY2hlY2tib3hcIix7bm9kZTpifSkpKSk6ITF9LHRoaXMuZW5hYmxlX2NoZWNrYm94PWZ1bmN0aW9uKGIpe3ZhciBjLGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZW5hYmxlX2NoZWNrYm94KGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGU9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWQmJihiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkPSExLGUmJmUubGVuZ3RoJiZlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLHRoaXMudHJpZ2dlcihcImVuYWJsZV9jaGVja2JveFwiLHtub2RlOmJ9KSkpKTohMX0sdGhpcy5hY3RpdmF0ZV9ub2RlPWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEoYy50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpPyExOih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJih0aGlzLnNldHRpbmdzLmNoZWNrYm94Lndob2xlX25vZGV8fGEoYy50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94XCIpKSYmKGMuY3RybEtleT0hMCksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHwhdGhpcy5zZXR0aW5ncy5jaGVja2JveC53aG9sZV9ub2RlJiYhYShjLnRhcmdldCkuaGFzQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3hcIik/ZC5hY3RpdmF0ZV9ub2RlLmNhbGwodGhpcyxiLGMpOnRoaXMuaXNfZGlzYWJsZWQoYik/ITE6KHRoaXMuaXNfY2hlY2tlZChiKT90aGlzLnVuY2hlY2tfbm9kZShiLGMpOnRoaXMuY2hlY2tfbm9kZShiLGMpLHZvaWQgdGhpcy50cmlnZ2VyKFwiYWN0aXZhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoYil9KSkpfSx0aGlzLmNoZWNrX25vZGU9ZnVuY3Rpb24oYixjKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuc2VsZWN0X25vZGUoYiwhMSwhMCxjKTt2YXIgZCxlLGYsZztpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKXRoaXMuY2hlY2tfbm9kZShiW2VdLGMpO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGQ9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuY2hlY2tlZHx8KGIuc3RhdGUuY2hlY2tlZD0hMCx0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnB1c2goYi5pZCksZCYmZC5sZW5ndGgmJmQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2VkXCIpLHRoaXMudHJpZ2dlcihcImNoZWNrX25vZGVcIix7bm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZXZlbnQ6Y30pKSkpOiExfSx0aGlzLnVuY2hlY2tfbm9kZT1mdW5jdGlvbihiLGMpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5kZXNlbGVjdF9ub2RlKGIsITEsYyk7dmFyIGQsZSxmO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy51bmNoZWNrX25vZGUoYltkXSxjKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhmPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrZWQmJihiLnN0YXRlLmNoZWNrZWQ9ITEsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGIuaWQpLGYubGVuZ3RoJiZmLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJ1bmNoZWNrX25vZGVcIix7bm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZXZlbnQ6Y30pKSkpOiExfSx0aGlzLmNoZWNrX2FsbD1mdW5jdGlvbigpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5zZWxlY3RfYWxsKCk7dmFyIGI9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5jb25jYXQoW10pLGMsZDtmb3IodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD10aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuX2QuY29uY2F0KCksYz0wLGQ9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5sZW5ndGg7ZD5jO2MrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbY11dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2NdXS5zdGF0ZS5jaGVja2VkPSEwKTt0aGlzLnJlZHJhdyghMCksdGhpcy50cmlnZ2VyKFwiY2hlY2tfYWxsXCIse3NlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWR9KX0sdGhpcy51bmNoZWNrX2FsbD1mdW5jdGlvbigpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5kZXNlbGVjdF9hbGwoKTt2YXIgYT10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmNvbmNhdChbXSksYixjO2ZvcihiPTAsYz10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmxlbmd0aDtjPmI7YisrKXRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFtiXV0mJih0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbYl1dLnN0YXRlLmNoZWNrZWQ9ITEpO3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9W10sdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNoZWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJ1bmNoZWNrX2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLG5vZGU6YX0pfSx0aGlzLmlzX2NoZWNrZWQ9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj90aGlzLmlzX3NlbGVjdGVkKGIpOihiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi5zdGF0ZS5jaGVja2VkOiExKX0sdGhpcy5nZXRfY2hlY2tlZD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP3RoaXMuZ2V0X3NlbGVjdGVkKGIpOmI/YS5tYXAodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZH0sdGhpcy5nZXRfdG9wX2NoZWNrZWQ9ZnVuY3Rpb24oYil7aWYodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXJldHVybiB0aGlzLmdldF90b3Bfc2VsZWN0ZWQoYik7dmFyIGM9dGhpcy5nZXRfY2hlY2tlZCghMCksZD17fSxlLGYsZyxoO2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWRbY1tlXS5pZF09Y1tlXTtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylmb3IoZz0wLGg9Y1tlXS5jaGlsZHJlbl9kLmxlbmd0aDtoPmc7ZysrKWRbY1tlXS5jaGlsZHJlbl9kW2ddXSYmZGVsZXRlIGRbY1tlXS5jaGlsZHJlbl9kW2ddXTtjPVtdO2ZvcihlIGluIGQpZC5oYXNPd25Qcm9wZXJ0eShlKSYmYy5wdXNoKGUpO3JldHVybiBiP2EubWFwKGMsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOmN9LHRoaXMuZ2V0X2JvdHRvbV9jaGVja2VkPWZ1bmN0aW9uKGIpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5nZXRfYm90dG9tX3NlbGVjdGVkKGIpO3ZhciBjPXRoaXMuZ2V0X2NoZWNrZWQoITApLGQ9W10sZSxmO2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWNbZV0uY2hpbGRyZW4ubGVuZ3RofHxkLnB1c2goY1tlXS5pZCk7cmV0dXJuIGI/YS5tYXAoZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6ZH0sdGhpcy5sb2FkX25vZGU9ZnVuY3Rpb24oYixjKXt2YXIgZSxmLGcsaCxpLGo7aWYoIWEuaXNBcnJheShiKSYmIXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmKGo9dGhpcy5nZXRfbm9kZShiKSxqJiZqLnN0YXRlLmxvYWRlZCkpZm9yKGU9MCxmPWouY2hpbGRyZW5fZC5sZW5ndGg7Zj5lO2UrKyl0aGlzLl9tb2RlbC5kYXRhW2ouY2hpbGRyZW5fZFtlXV0uc3RhdGUuY2hlY2tlZCYmKGk9ITAsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGouY2hpbGRyZW5fZFtlXSkpO3JldHVybiBkLmxvYWRfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHRoaXMuZ2V0X3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGE9ZC5nZXRfc3RhdGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/YTooYS5jaGVja2JveD10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnNsaWNlKCksYSl9LHRoaXMuc2V0X3N0YXRlPWZ1bmN0aW9uKGIsYyl7dmFyIGU9ZC5zZXRfc3RhdGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKGUmJmIuY2hlY2tib3gpe2lmKCF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pe3RoaXMudW5jaGVja19hbGwoKTt2YXIgZj10aGlzO2EuZWFjaChiLmNoZWNrYm94LGZ1bmN0aW9uKGEsYil7Zi5jaGVja19ub2RlKGIpfSl9cmV0dXJuIGRlbGV0ZSBiLmNoZWNrYm94LHRoaXMuc2V0X3N0YXRlKGIsYyksITF9cmV0dXJuIGV9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb258fCh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdKSxkLnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpfX0sYS5qc3RyZWUuZGVmYXVsdHMuY29uZGl0aW9uYWxzZWxlY3Q9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sYS5qc3RyZWUucGx1Z2lucy5jb25kaXRpb25hbHNlbGVjdD1mdW5jdGlvbihhLGIpe3RoaXMuYWN0aXZhdGVfbm9kZT1mdW5jdGlvbihhLGMpe3RoaXMuc2V0dGluZ3MuY29uZGl0aW9uYWxzZWxlY3QuY2FsbCh0aGlzLHRoaXMuZ2V0X25vZGUoYSksYykmJmIuYWN0aXZhdGVfbm9kZS5jYWxsKHRoaXMsYSxjKX19LGEuanN0cmVlLmRlZmF1bHRzLmNvbnRleHRtZW51PXtzZWxlY3Rfbm9kZTohMCxzaG93X2F0X25vZGU6ITAsaXRlbXM6ZnVuY3Rpb24oYixjKXtyZXR1cm57Y3JlYXRlOntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMCxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJDcmVhdGVcIixhY3Rpb246ZnVuY3Rpb24oYil7dmFyIGM9YS5qc3RyZWUucmVmZXJlbmNlKGIucmVmZXJlbmNlKSxkPWMuZ2V0X25vZGUoYi5yZWZlcmVuY2UpO2MuY3JlYXRlX25vZGUoZCx7fSxcImxhc3RcIixmdW5jdGlvbihhKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5lZGl0KGEpfSwwKX0pfX0scmVuYW1lOntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMSxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJSZW5hbWVcIixhY3Rpb246ZnVuY3Rpb24oYil7dmFyIGM9YS5qc3RyZWUucmVmZXJlbmNlKGIucmVmZXJlbmNlKSxkPWMuZ2V0X25vZGUoYi5yZWZlcmVuY2UpO2MuZWRpdChkKX19LHJlbW92ZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxpY29uOiExLHNlcGFyYXRvcl9hZnRlcjohMSxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJEZWxldGVcIixhY3Rpb246ZnVuY3Rpb24oYil7dmFyIGM9YS5qc3RyZWUucmVmZXJlbmNlKGIucmVmZXJlbmNlKSxkPWMuZ2V0X25vZGUoYi5yZWZlcmVuY2UpO2MuaXNfc2VsZWN0ZWQoZCk/Yy5kZWxldGVfbm9kZShjLmdldF9zZWxlY3RlZCgpKTpjLmRlbGV0ZV9ub2RlKGQpfX0sY2NwOntzZXBhcmF0b3JfYmVmb3JlOiEwLGljb246ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiRWRpdFwiLGFjdGlvbjohMSxzdWJtZW51OntjdXQ6e3NlcGFyYXRvcl9iZWZvcmU6ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiQ3V0XCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmlzX3NlbGVjdGVkKGQpP2MuY3V0KGMuZ2V0X3RvcF9zZWxlY3RlZCgpKTpjLmN1dChkKX19LGNvcHk6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsbGFiZWw6XCJDb3B5XCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmlzX3NlbGVjdGVkKGQpP2MuY29weShjLmdldF90b3Bfc2VsZWN0ZWQoKSk6Yy5jb3B5KGQpfX0scGFzdGU6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxfZGlzYWJsZWQ6ZnVuY3Rpb24oYil7cmV0dXJuIWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSkuY2FuX3Bhc3RlKCl9LHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIlBhc3RlXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLnBhc3RlKGQpfX19fX19fSxhLmpzdHJlZS5wbHVnaW5zLmNvbnRleHRtZW51PWZ1bmN0aW9uKGMsZCl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ZC5iaW5kLmNhbGwodGhpcyk7dmFyIGI9MCxjPW51bGwsZSxmO3RoaXMuZWxlbWVudC5vbihcImNvbnRleHRtZW51LmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGEsZCl7YS5wcmV2ZW50RGVmYXVsdCgpLGI9YS5jdHJsS2V5PytuZXcgRGF0ZTowLChkfHxjKSYmKGI9K25ldyBEYXRlKzFlNCksYyYmY2xlYXJUaW1lb3V0KGMpLHRoaXMuaXNfbG9hZGluZyhhLmN1cnJlbnRUYXJnZXQpfHx0aGlzLnNob3dfY29udGV4dG1lbnUoYS5jdXJyZW50VGFyZ2V0LGEucGFnZVgsYS5wYWdlWSxhKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYyl7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlJiYoIWJ8fCtuZXcgRGF0ZS1iPjI1MCkmJmEudmFrYXRhLmNvbnRleHQuaGlkZSgpLGI9MH0sdGhpcykpLm9uKFwidG91Y2hzdGFydC5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZnVuY3Rpb24oYil7Yi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGU9Yi5wYWdlWCxmPWIucGFnZVksYz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YShiLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoXCJjb250ZXh0bWVudVwiLCEwKX0sNzUwKSl9KS5vbihcInRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSl7YyYmYS5vcmlnaW5hbEV2ZW50JiZhLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmEub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKE1hdGguYWJzKGUtYS5wYWdlWCk+NTB8fE1hdGguYWJzKGYtYS5wYWdlWSk+NTApJiZjbGVhclRpbWVvdXQoYyl9KS5vbihcInRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhKXtjJiZjbGVhclRpbWVvdXQoYyl9KSxhKGkpLm9uKFwiY29udGV4dF9oaWRlLnZha2F0YS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlPSExLGIucmVmZXJlbmNlLnJlbW92ZUNsYXNzKFwianN0cmVlLWNvbnRleHRcIil9LHRoaXMpKX0sdGhpcy50ZWFyZG93bj1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZSYmYS52YWthdGEuY29udGV4dC5oaWRlKCksZC50ZWFyZG93bi5jYWxsKHRoaXMpfSx0aGlzLnNob3dfY29udGV4dG1lbnU9ZnVuY3Rpb24oYyxkLGUsZil7aWYoYz10aGlzLmdldF9ub2RlKGMpLCFjfHxjLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4hMTt2YXIgZz10aGlzLnNldHRpbmdzLmNvbnRleHRtZW51LGg9dGhpcy5nZXRfbm9kZShjLCEwKSxpPWguY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKSxqPSExLGs9ITE7KGcuc2hvd19hdF9ub2RlfHxkPT09Ynx8ZT09PWIpJiYoaj1pLm9mZnNldCgpLGQ9ai5sZWZ0LGU9ai50b3ArdGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCksdGhpcy5zZXR0aW5ncy5jb250ZXh0bWVudS5zZWxlY3Rfbm9kZSYmIXRoaXMuaXNfc2VsZWN0ZWQoYykmJnRoaXMuYWN0aXZhdGVfbm9kZShjLGYpLGs9Zy5pdGVtcyxhLmlzRnVuY3Rpb24oaykmJihrPWsuY2FsbCh0aGlzLGMsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLl9zaG93X2NvbnRleHRtZW51KGMsZCxlLGEpfSx0aGlzKSkpLGEuaXNQbGFpbk9iamVjdChrKSYmdGhpcy5fc2hvd19jb250ZXh0bWVudShjLGQsZSxrKX0sdGhpcy5fc2hvd19jb250ZXh0bWVudT1mdW5jdGlvbihiLGMsZCxlKXt2YXIgZj10aGlzLmdldF9ub2RlKGIsITApLGc9Zi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpO2EoaSkub25lKFwiY29udGV4dF9zaG93LnZha2F0YS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9XCJqc3RyZWUtY29udGV4dG1lbnUganN0cmVlLVwiK3RoaXMuZ2V0X3RoZW1lKCkrXCItY29udGV4dG1lbnVcIjthKGMuZWxlbWVudCkuYWRkQ2xhc3MoZCksZy5hZGRDbGFzcyhcImpzdHJlZS1jb250ZXh0XCIpfSx0aGlzKSksdGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlPSEwLGEudmFrYXRhLmNvbnRleHQuc2hvdyhnLHt4OmMseTpkfSxlKSx0aGlzLnRyaWdnZXIoXCJzaG93X2NvbnRleHRtZW51XCIse25vZGU6Yix4OmMseTpkfSl9fSxmdW5jdGlvbihhKXt2YXIgYj0hMSxjPXtlbGVtZW50OiExLHJlZmVyZW5jZTohMSxwb3NpdGlvbl94OjAscG9zaXRpb25feTowLGl0ZW1zOltdLGh0bWw6XCJcIixpc192aXNpYmxlOiExfTthLnZha2F0YS5jb250ZXh0PXtzZXR0aW5nczp7aGlkZV9vbm1vdXNlbGVhdmU6MCxpY29uczohMH0sX3RyaWdnZXI6ZnVuY3Rpb24oYil7YShpKS50cmlnZ2VySGFuZGxlcihcImNvbnRleHRfXCIrYitcIi52YWthdGFcIix7cmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50LHBvc2l0aW9uOnt4OmMucG9zaXRpb25feCx5OmMucG9zaXRpb25feX19KX0sX2V4ZWN1dGU6ZnVuY3Rpb24oYil7cmV0dXJuIGI9Yy5pdGVtc1tiXSxiJiYoIWIuX2Rpc2FibGVkfHxhLmlzRnVuY3Rpb24oYi5fZGlzYWJsZWQpJiYhYi5fZGlzYWJsZWQoe2l0ZW06YixyZWZlcmVuY2U6Yy5yZWZlcmVuY2UsZWxlbWVudDpjLmVsZW1lbnR9KSkmJmIuYWN0aW9uP2IuYWN0aW9uLmNhbGwobnVsbCx7aXRlbTpiLHJlZmVyZW5jZTpjLnJlZmVyZW5jZSxlbGVtZW50OmMuZWxlbWVudCxwb3NpdGlvbjp7eDpjLnBvc2l0aW9uX3gseTpjLnBvc2l0aW9uX3l9fSk6ITF9LF9wYXJzZTpmdW5jdGlvbihiLGQpe2lmKCFiKXJldHVybiExO2R8fChjLmh0bWw9XCJcIixjLml0ZW1zPVtdKTt2YXIgZT1cIlwiLGY9ITEsZztyZXR1cm4gZCYmKGUrPVwiPHVsPlwiKSxhLmVhY2goYixmdW5jdGlvbihiLGQpe3JldHVybiBkPyhjLml0ZW1zLnB1c2goZCksIWYmJmQuc2VwYXJhdG9yX2JlZm9yZSYmKGUrPVwiPGxpIGNsYXNzPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InPjxhIGhyZWY9JyMnIFwiKyhhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zP1wiXCI6J3N0eWxlPVwibWFyZ2luLWxlZnQ6MHB4O1wiJykrXCI+JiMxNjA7PC9hPjwvbGk+XCIpLGY9ITEsZSs9XCI8bGkgY2xhc3M9J1wiKyhkLl9jbGFzc3x8XCJcIikrKGQuX2Rpc2FibGVkPT09ITB8fGEuaXNGdW5jdGlvbihkLl9kaXNhYmxlZCkmJmQuX2Rpc2FibGVkKHtpdGVtOmQscmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50fSk/XCIgdmFrYXRhLWNvbnRleHRtZW51LWRpc2FibGVkIFwiOlwiXCIpK1wiJyBcIisoZC5zaG9ydGN1dD9cIiBkYXRhLXNob3J0Y3V0PSdcIitkLnNob3J0Y3V0K1wiJyBcIjpcIlwiKStcIj5cIixlKz1cIjxhIGhyZWY9JyMnIHJlbD0nXCIrKGMuaXRlbXMubGVuZ3RoLTEpK1wiJz5cIixhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zJiYoZSs9XCI8aSBcIixkLmljb24mJihlKz0tMSE9PWQuaWNvbi5pbmRleE9mKFwiL1wiKXx8LTEhPT1kLmljb24uaW5kZXhPZihcIi5cIik/XCIgc3R5bGU9J2JhY2tncm91bmQ6dXJsKFxcXCJcIitkLmljb24rXCJcXFwiKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdCcgXCI6XCIgY2xhc3M9J1wiK2QuaWNvbitcIicgXCIpLGUrPVwiPjwvaT48c3BhbiBjbGFzcz0ndmFrYXRhLWNvbnRleHRtZW51LXNlcCc+JiMxNjA7PC9zcGFuPlwiKSxlKz0oYS5pc0Z1bmN0aW9uKGQubGFiZWwpP2QubGFiZWwoe2l0ZW06YixyZWZlcmVuY2U6Yy5yZWZlcmVuY2UsZWxlbWVudDpjLmVsZW1lbnR9KTpkLmxhYmVsKSsoZC5zaG9ydGN1dD8nIDxzcGFuIGNsYXNzPVwidmFrYXRhLWNvbnRleHRtZW51LXNob3J0Y3V0IHZha2F0YS1jb250ZXh0bWVudS1zaG9ydGN1dC0nK2Quc2hvcnRjdXQrJ1wiPicrKGQuc2hvcnRjdXRfbGFiZWx8fFwiXCIpK1wiPC9zcGFuPlwiOlwiXCIpK1wiPC9hPlwiLGQuc3VibWVudSYmKGc9YS52YWthdGEuY29udGV4dC5fcGFyc2UoZC5zdWJtZW51LCEwKSxnJiYoZSs9ZykpLGUrPVwiPC9saT5cIix2b2lkKGQuc2VwYXJhdG9yX2FmdGVyJiYoZSs9XCI8bGkgY2xhc3M9J3Zha2F0YS1jb250ZXh0LXNlcGFyYXRvcic+PGEgaHJlZj0nIycgXCIrKGEudmFrYXRhLmNvbnRleHQuc2V0dGluZ3MuaWNvbnM/XCJcIjonc3R5bGU9XCJtYXJnaW4tbGVmdDowcHg7XCInKStcIj4mIzE2MDs8L2E+PC9saT5cIixmPSEwKSkpOiEwfSksZT1lLnJlcGxhY2UoLzxsaSBjbGFzc1xcPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InXFw+PFxcL2xpXFw+JC8sXCJcIiksZCYmKGUrPVwiPC91bD5cIiksZHx8KGMuaHRtbD1lLGEudmFrYXRhLmNvbnRleHQuX3RyaWdnZXIoXCJwYXJzZVwiKSksZS5sZW5ndGg+MTA/ZTohMX0sX3Nob3dfc3VibWVudTpmdW5jdGlvbihjKXtpZihjPWEoYyksYy5sZW5ndGgmJmMuY2hpbGRyZW4oXCJ1bFwiKS5sZW5ndGgpe3ZhciBkPWMuY2hpbGRyZW4oXCJ1bFwiKSxlPWMub2Zmc2V0KCkubGVmdCxmPWUrYy5vdXRlcldpZHRoKCksZz1jLm9mZnNldCgpLnRvcCxoPWQud2lkdGgoKSxpPWQuaGVpZ2h0KCksaj1hKHdpbmRvdykud2lkdGgoKSthKHdpbmRvdykuc2Nyb2xsTGVmdCgpLGs9YSh3aW5kb3cpLmhlaWdodCgpK2Eod2luZG93KS5zY3JvbGxUb3AoKTtiP2NbZi0oaCsxMCtjLm91dGVyV2lkdGgoKSk8MD9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInZha2F0YS1jb250ZXh0LWxlZnRcIik6Y1tmK2g+aiYmZT5qLWY/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ2YWthdGEtY29udGV4dC1yaWdodFwiKSxnK2krMTA+ayYmZC5jc3MoXCJib3R0b21cIixcIi0xcHhcIiksYy5oYXNDbGFzcyhcInZha2F0YS1jb250ZXh0LXJpZ2h0XCIpP2g+ZSYmZC5jc3MoXCJtYXJnaW4tcmlnaHRcIixlLWgpOmg+ai1mJiZkLmNzcyhcIm1hcmdpbi1sZWZ0XCIsai1mLWgpLGQuc2hvdygpfX0sc2hvdzpmdW5jdGlvbihkLGUsZil7dmFyIGcsaCxpLGosayxsLG0sbixvPSEwO3N3aXRjaChjLmVsZW1lbnQmJmMuZWxlbWVudC5sZW5ndGgmJmMuZWxlbWVudC53aWR0aChcIlwiKSxvKXtjYXNlIWUmJiFkOnJldHVybiExO2Nhc2UhIWUmJiEhZDpjLnJlZmVyZW5jZT1kLGMucG9zaXRpb25feD1lLngsYy5wb3NpdGlvbl95PWUueTticmVhaztjYXNlIWUmJiEhZDpjLnJlZmVyZW5jZT1kLGc9ZC5vZmZzZXQoKSxjLnBvc2l0aW9uX3g9Zy5sZWZ0K2Qub3V0ZXJIZWlnaHQoKSxjLnBvc2l0aW9uX3k9Zy50b3A7YnJlYWs7Y2FzZSEhZSYmIWQ6Yy5wb3NpdGlvbl94PWUueCxjLnBvc2l0aW9uX3k9ZS55fWQmJiFmJiZhKGQpLmRhdGEoXCJ2YWthdGFfY29udGV4dG1lbnVcIikmJihmPWEoZCkuZGF0YShcInZha2F0YV9jb250ZXh0bWVudVwiKSksYS52YWthdGEuY29udGV4dC5fcGFyc2UoZikmJmMuZWxlbWVudC5odG1sKGMuaHRtbCksYy5pdGVtcy5sZW5ndGgmJihjLmVsZW1lbnQuYXBwZW5kVG8oXCJib2R5XCIpLGg9Yy5lbGVtZW50LGk9Yy5wb3NpdGlvbl94LGo9Yy5wb3NpdGlvbl95LGs9aC53aWR0aCgpLGw9aC5oZWlnaHQoKSxtPWEod2luZG93KS53aWR0aCgpK2Eod2luZG93KS5zY3JvbGxMZWZ0KCksbj1hKHdpbmRvdykuaGVpZ2h0KCkrYSh3aW5kb3cpLnNjcm9sbFRvcCgpLGImJihpLT1oLm91dGVyV2lkdGgoKS1hKGQpLm91dGVyV2lkdGgoKSxpPGEod2luZG93KS5zY3JvbGxMZWZ0KCkrMjAmJihpPWEod2luZG93KS5zY3JvbGxMZWZ0KCkrMjApKSxpK2srMjA+bSYmKGk9bS0oaysyMCkpLGorbCsyMD5uJiYoaj1uLShsKzIwKSksYy5lbGVtZW50LmNzcyh7bGVmdDppLHRvcDpqfSkuc2hvdygpLmZpbmQoXCJhXCIpLmZpcnN0KCkuZm9jdXMoKS5wYXJlbnQoKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGMuaXNfdmlzaWJsZT0hMCxhLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwic2hvd1wiKSl9LGhpZGU6ZnVuY3Rpb24oKXtjLmlzX3Zpc2libGUmJihjLmVsZW1lbnQuaGlkZSgpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCkuZmluZChcIjpmb2N1c1wiKS5ibHVyKCkuZW5kKCkuZGV0YWNoKCksYy5pc192aXNpYmxlPSExLGEudmFrYXRhLmNvbnRleHQuX3RyaWdnZXIoXCJoaWRlXCIpKX19LGEoZnVuY3Rpb24oKXtiPVwicnRsXCI9PT1hKFwiYm9keVwiKS5jc3MoXCJkaXJlY3Rpb25cIik7dmFyIGQ9ITE7Yy5lbGVtZW50PWEoXCI8dWwgY2xhc3M9J3Zha2F0YS1jb250ZXh0Jz48L3VsPlwiKSxjLmVsZW1lbnQub24oXCJtb3VzZWVudGVyXCIsXCJsaVwiLGZ1bmN0aW9uKGIpe2Iuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYS5jb250YWlucyh0aGlzLGIucmVsYXRlZFRhcmdldCl8fChkJiZjbGVhclRpbWVvdXQoZCksYy5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5lbmQoKSxhKHRoaXMpLnNpYmxpbmdzKCkuZmluZChcInVsXCIpLmhpZGUoKS5lbmQoKS5lbmQoKS5wYXJlbnRzVW50aWwoXCIudmFrYXRhLWNvbnRleHRcIixcImxpXCIpLmFkZEJhY2soKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGEudmFrYXRhLmNvbnRleHQuX3Nob3dfc3VibWVudSh0aGlzKSl9KS5vbihcIm1vdXNlbGVhdmVcIixcImxpXCIsZnVuY3Rpb24oYil7YS5jb250YWlucyh0aGlzLGIucmVsYXRlZFRhcmdldCl8fGEodGhpcykuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5hZGRCYWNrKCkucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKX0pLm9uKFwibW91c2VsZWF2ZVwiLGZ1bmN0aW9uKGIpe2EodGhpcykuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGEudmFrYXRhLmNvbnRleHQuc2V0dGluZ3MuaGlkZV9vbm1vdXNlbGVhdmUmJihkPXNldFRpbWVvdXQoZnVuY3Rpb24oYil7cmV0dXJuIGZ1bmN0aW9uKCl7YS52YWthdGEuY29udGV4dC5oaWRlKCl9fSh0aGlzKSxhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmhpZGVfb25tb3VzZWxlYXZlKSl9KS5vbihcImNsaWNrXCIsXCJhXCIsZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpLGEodGhpcykuYmx1cigpLnBhcmVudCgpLmhhc0NsYXNzKFwidmFrYXRhLWNvbnRleHQtZGlzYWJsZWRcIil8fGEudmFrYXRhLmNvbnRleHQuX2V4ZWN1dGUoYSh0aGlzKS5hdHRyKFwicmVsXCIpKT09PSExfHxhLnZha2F0YS5jb250ZXh0LmhpZGUoKX0pLm9uKFwia2V5ZG93blwiLFwiYVwiLGZ1bmN0aW9uKGIpe3ZhciBkPW51bGw7c3dpdGNoKGIud2hpY2gpe2Nhc2UgMTM6Y2FzZSAzMjpiLnR5cGU9XCJtb3VzZXVwXCIsYi5wcmV2ZW50RGVmYXVsdCgpLGEoYi5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKGIpO2JyZWFrO2Nhc2UgMzc6Yy5pc192aXNpYmxlJiYoYy5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikubGFzdCgpLmNsb3Nlc3QoXCJsaVwiKS5maXJzdCgpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmVuZCgpLmVuZCgpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYi5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDM4OmMuaXNfdmlzaWJsZSYmKGQ9Yy5lbGVtZW50LmZpbmQoXCJ1bDp2aXNpYmxlXCIpLmFkZEJhY2soKS5sYXN0KCkuY2hpbGRyZW4oXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5wcmV2QWxsKFwibGk6bm90KC52YWthdGEtY29udGV4dC1zZXBhcmF0b3IpXCIpLmZpcnN0KCksZC5sZW5ndGh8fChkPWMuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwibGk6bm90KC52YWthdGEtY29udGV4dC1zZXBhcmF0b3IpXCIpLmxhc3QoKSksZC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYi5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDM5OmMuaXNfdmlzaWJsZSYmKGMuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmxhc3QoKS5jaGlsZHJlbihcInVsXCIpLnNob3coKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmZpcnN0KCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSxiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGIucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSA0MDpjLmlzX3Zpc2libGUmJihkPWMuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikubmV4dEFsbChcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpLGQubGVuZ3RofHwoZD1jLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpKSxkLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuY2hpbGRyZW4oXCJhXCIpLmZvY3VzKCksYi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSxiLnByZXZlbnREZWZhdWx0KCkpO2JyZWFrO2Nhc2UgMjc6YS52YWthdGEuY29udGV4dC5oaWRlKCksYi5wcmV2ZW50RGVmYXVsdCgpfX0pLm9uKFwia2V5ZG93blwiLGZ1bmN0aW9uKGEpe2EucHJldmVudERlZmF1bHQoKTt2YXIgYj1jLmVsZW1lbnQuZmluZChcIi52YWthdGEtY29udGV4dG1lbnUtc2hvcnRjdXQtXCIrYS53aGljaCkucGFyZW50KCk7Yi5wYXJlbnQoKS5ub3QoXCIudmFrYXRhLWNvbnRleHQtZGlzYWJsZWRcIikmJmIuY2xpY2soKX0pLGEoaSkub24oXCJtb3VzZWRvd24udmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGIpe2MuaXNfdmlzaWJsZSYmIWEuY29udGFpbnMoYy5lbGVtZW50WzBdLGIudGFyZ2V0KSYmYS52YWthdGEuY29udGV4dC5oaWRlKCk7XG59KS5vbihcImNvbnRleHRfc2hvdy52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSxkKXtjLmVsZW1lbnQuZmluZChcImxpOmhhcyh1bClcIikuY2hpbGRyZW4oXCJhXCIpLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtcGFyZW50XCIpLGImJmMuZWxlbWVudC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LXJ0bFwiKS5jc3MoXCJkaXJlY3Rpb25cIixcInJ0bFwiKSxjLmVsZW1lbnQuZmluZChcInVsXCIpLmhpZGUoKS5lbmQoKX0pfSl9KGEpLGEuanN0cmVlLmRlZmF1bHRzLmRuZD17Y29weTohMCxvcGVuX3RpbWVvdXQ6NTAwLGlzX2RyYWdnYWJsZTohMCxjaGVja193aGlsZV9kcmFnZ2luZzohMCxhbHdheXNfY29weTohMSxpbnNpZGVfcG9zOjAsZHJhZ19zZWxlY3Rpb246ITAsdG91Y2g6ITAsbGFyZ2VfZHJvcF90YXJnZXQ6ITEsbGFyZ2VfZHJhZ190YXJnZXQ6ITEsdXNlX2h0bWw1OiExfTt2YXIgbixvO2EuanN0cmVlLnBsdWdpbnMuZG5kPWZ1bmN0aW9uKGIsYyl7dGhpcy5pbml0PWZ1bmN0aW9uKGEsYil7Yy5pbml0LmNhbGwodGhpcyxhLGIpLHRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNT10aGlzLnNldHRpbmdzLmRuZC51c2VfaHRtbDUmJlwiZHJhZ2dhYmxlXCJpbiBpLmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpfSx0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtjLmJpbmQuY2FsbCh0aGlzKSx0aGlzLmVsZW1lbnQub24odGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1P1wiZHJhZ3N0YXJ0LmpzdHJlZVwiOlwibW91c2Vkb3duLmpzdHJlZSB0b3VjaHN0YXJ0LmpzdHJlZVwiLHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0P1wiLmpzdHJlZS1ub2RlXCI6XCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYil7aWYodGhpcy5zZXR0aW5ncy5kbmQubGFyZ2VfZHJhZ190YXJnZXQmJmEoYi50YXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIilbMF0hPT1iLmN1cnJlbnRUYXJnZXQpcmV0dXJuITA7aWYoXCJ0b3VjaHN0YXJ0XCI9PT1iLnR5cGUmJighdGhpcy5zZXR0aW5ncy5kbmQudG91Y2h8fFwic2VsZWN0ZWRcIj09PXRoaXMuc2V0dGluZ3MuZG5kLnRvdWNoJiYhYShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5oYXNDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpKSlyZXR1cm4hMDt2YXIgYz10aGlzLmdldF9ub2RlKGIudGFyZ2V0KSxkPXRoaXMuaXNfc2VsZWN0ZWQoYykmJnRoaXMuc2V0dGluZ3MuZG5kLmRyYWdfc2VsZWN0aW9uP3RoaXMuZ2V0X3RvcF9zZWxlY3RlZCgpLmxlbmd0aDoxLGU9ZD4xP2QrXCIgXCIrdGhpcy5nZXRfc3RyaW5nKFwibm9kZXNcIik6dGhpcy5nZXRfdGV4dChiLmN1cnJlbnRUYXJnZXQpO2lmKHRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0JiYoZT1hLnZha2F0YS5odG1sLmVzY2FwZShlKSksYyYmYy5pZCYmYy5pZCE9PWEuanN0cmVlLnJvb3QmJigxPT09Yi53aGljaHx8XCJ0b3VjaHN0YXJ0XCI9PT1iLnR5cGV8fFwiZHJhZ3N0YXJ0XCI9PT1iLnR5cGUpJiYodGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlPT09ITB8fGEuaXNGdW5jdGlvbih0aGlzLnNldHRpbmdzLmRuZC5pc19kcmFnZ2FibGUpJiZ0aGlzLnNldHRpbmdzLmRuZC5pc19kcmFnZ2FibGUuY2FsbCh0aGlzLGQ+MT90aGlzLmdldF90b3Bfc2VsZWN0ZWQoITApOltjXSxiKSkpe2lmKG49e2pzdHJlZTohMCxvcmlnaW46dGhpcyxvYmo6dGhpcy5nZXRfbm9kZShjLCEwKSxub2RlczpkPjE/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCk6W2MuaWRdfSxvPWIuY3VycmVudFRhcmdldCwhdGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1KXJldHVybiB0aGlzLmVsZW1lbnQudHJpZ2dlcihcIm1vdXNlZG93bi5qc3RyZWVcIiksYS52YWthdGEuZG5kLnN0YXJ0KGIsbiwnPGRpdiBpZD1cImpzdHJlZS1kbmRcIiBjbGFzcz1cImpzdHJlZS0nK3RoaXMuZ2V0X3RoZW1lKCkrXCIganN0cmVlLVwiK3RoaXMuZ2V0X3RoZW1lKCkrXCItXCIrdGhpcy5nZXRfdGhlbWVfdmFyaWFudCgpK1wiIFwiKyh0aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikrJ1wiPjxpIGNsYXNzPVwianN0cmVlLWljb24ganN0cmVlLWVyXCI+PC9pPicrZSsnPGlucyBjbGFzcz1cImpzdHJlZS1jb3B5XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+KzwvaW5zPjwvZGl2PicpO2EudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0YXJ0XCIsYix7aGVscGVyOmEoKSxlbGVtZW50Om8sZGF0YTpufSl9fSx0aGlzKSksdGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1JiZ0aGlzLmVsZW1lbnQub24oXCJkcmFnb3Zlci5qc3RyZWVcIixmdW5jdGlvbihiKXtyZXR1cm4gYi5wcmV2ZW50RGVmYXVsdCgpLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixiLHtoZWxwZXI6YSgpLGVsZW1lbnQ6byxkYXRhOm59KSwhMX0pLm9uKFwiZHJvcC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIpe3JldHVybiBiLnByZXZlbnREZWZhdWx0KCksYS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RvcFwiLGIse2hlbHBlcjphKCksZWxlbWVudDpvLGRhdGE6bn0pLCExfSx0aGlzKSl9LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oYSxiLGQsZSl7aWYoYT1jLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxhJiZ0aGlzLnNldHRpbmdzLmRuZC51c2VfaHRtbDUpaWYodGhpcy5zZXR0aW5ncy5kbmQubGFyZ2VfZHJhZ190YXJnZXQpYS5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwhMCk7ZWxzZXt2YXIgZixnLGg9bnVsbDtmb3IoZj0wLGc9YS5jaGlsZE5vZGVzLmxlbmd0aDtnPmY7ZisrKWlmKGEuY2hpbGROb2Rlc1tmXSYmYS5jaGlsZE5vZGVzW2ZdLmNsYXNzTmFtZSYmLTEhPT1hLmNoaWxkTm9kZXNbZl0uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtYW5jaG9yXCIpKXtoPWEuY2hpbGROb2Rlc1tmXTticmVha31oJiZoLnNldEF0dHJpYnV0ZShcImRyYWdnYWJsZVwiLCEwKX1yZXR1cm4gYX19LGEoZnVuY3Rpb24oKXt2YXIgYz0hMSxkPSExLGU9ITEsZj0hMSxnPWEoJzxkaXYgaWQ9XCJqc3RyZWUtbWFya2VyXCI+JiMxNjA7PC9kaXY+JykuaGlkZSgpO2EoaSkub24oXCJkbmRfc3RhcnQudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsYil7Yz0hMSxlPSExLGImJmIuZGF0YSYmYi5kYXRhLmpzdHJlZSYmZy5hcHBlbmRUbyhcImJvZHlcIil9KS5vbihcImRuZF9tb3ZlLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihoLGkpe2lmKGYmJihpLmV2ZW50JiZcImRyYWdvdmVyXCI9PT1pLmV2ZW50LnR5cGUmJmkuZXZlbnQudGFyZ2V0PT09ZS50YXJnZXR8fGNsZWFyVGltZW91dChmKSksaSYmaS5kYXRhJiZpLmRhdGEuanN0cmVlJiYoIWkuZXZlbnQudGFyZ2V0LmlkfHxcImpzdHJlZS1tYXJrZXJcIiE9PWkuZXZlbnQudGFyZ2V0LmlkKSl7ZT1pLmV2ZW50O3ZhciBqPWEuanN0cmVlLnJlZmVyZW5jZShpLmV2ZW50LnRhcmdldCksaz0hMSxsPSExLG09ITEsbixvLHAscSxyLHMsdCx1LHYsdyx4LHkseixBLEIsQztpZihqJiZqLl9kYXRhJiZqLl9kYXRhLmRuZClpZihnLmF0dHIoXCJjbGFzc1wiLFwianN0cmVlLVwiK2ouZ2V0X3RoZW1lKCkrKGouc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSksQz1pLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihpLmV2ZW50Lm1ldGFLZXl8fGkuZXZlbnQuY3RybEtleSkpLGkuaGVscGVyLmNoaWxkcmVuKCkuYXR0cihcImNsYXNzXCIsXCJqc3RyZWUtXCIrai5nZXRfdGhlbWUoKStcIiBqc3RyZWUtXCIrai5nZXRfdGhlbWUoKStcIi1cIitqLmdldF90aGVtZV92YXJpYW50KCkrXCIgXCIrKGouc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSkuZmluZChcIi5qc3RyZWUtY29weVwiKS5maXJzdCgpW0M/XCJzaG93XCI6XCJoaWRlXCJdKCksaS5ldmVudC50YXJnZXQhPT1qLmVsZW1lbnRbMF0mJmkuZXZlbnQudGFyZ2V0IT09ai5nZXRfY29udGFpbmVyX3VsKClbMF18fDAhPT1qLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbigpLmxlbmd0aCl7aWYoaz1qLnNldHRpbmdzLmRuZC5sYXJnZV9kcm9wX3RhcmdldD9hKGkuZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIik6YShpLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtYW5jaG9yXCIpLGsmJmsubGVuZ3RoJiZrLnBhcmVudCgpLmlzKFwiLmpzdHJlZS1jbG9zZWQsIC5qc3RyZWUtb3BlbiwgLmpzdHJlZS1sZWFmXCIpJiYobD1rLm9mZnNldCgpLG09KGkuZXZlbnQucGFnZVkhPT1iP2kuZXZlbnQucGFnZVk6aS5ldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZKS1sLnRvcCxxPWsub3V0ZXJIZWlnaHQoKSx0PXEvMz5tP1tcImJcIixcImlcIixcImFcIl06bT5xLXEvMz9bXCJhXCIsXCJpXCIsXCJiXCJdOm0+cS8yP1tcImlcIixcImFcIixcImJcIl06W1wiaVwiLFwiYlwiLFwiYVwiXSxhLmVhY2godCxmdW5jdGlvbihiLGUpe3N3aXRjaChlKXtjYXNlXCJiXCI6bz1sLmxlZnQtNixwPWwudG9wLHI9ai5nZXRfcGFyZW50KGspLHM9ay5wYXJlbnQoKS5pbmRleCgpO2JyZWFrO2Nhc2VcImlcIjpBPWouc2V0dGluZ3MuZG5kLmluc2lkZV9wb3MsQj1qLmdldF9ub2RlKGsucGFyZW50KCkpLG89bC5sZWZ0LTIscD1sLnRvcCtxLzIrMSxyPUIuaWQscz1cImZpcnN0XCI9PT1BPzA6XCJsYXN0XCI9PT1BP0IuY2hpbGRyZW4ubGVuZ3RoOk1hdGgubWluKEEsQi5jaGlsZHJlbi5sZW5ndGgpO2JyZWFrO2Nhc2VcImFcIjpvPWwubGVmdC02LHA9bC50b3ArcSxyPWouZ2V0X3BhcmVudChrKSxzPWsucGFyZW50KCkuaW5kZXgoKSsxfWZvcih1PSEwLHY9MCx3PWkuZGF0YS5ub2Rlcy5sZW5ndGg7dz52O3YrKylpZih4PWkuZGF0YS5vcmlnaW4mJihpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8aS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKGkuZXZlbnQubWV0YUtleXx8aS5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiLHk9cyxcIm1vdmVfbm9kZVwiPT09eCYmXCJhXCI9PT1lJiZpLmRhdGEub3JpZ2luJiZpLmRhdGEub3JpZ2luPT09aiYmcj09PWouZ2V0X3BhcmVudChpLmRhdGEubm9kZXNbdl0pJiYoej1qLmdldF9ub2RlKHIpLHk+YS5pbkFycmF5KGkuZGF0YS5ub2Rlc1t2XSx6LmNoaWxkcmVuKSYmKHktPTEpKSx1PXUmJihqJiZqLnNldHRpbmdzJiZqLnNldHRpbmdzLmRuZCYmai5zZXR0aW5ncy5kbmQuY2hlY2tfd2hpbGVfZHJhZ2dpbmc9PT0hMXx8ai5jaGVjayh4LGkuZGF0YS5vcmlnaW4mJmkuZGF0YS5vcmlnaW4hPT1qP2kuZGF0YS5vcmlnaW4uZ2V0X25vZGUoaS5kYXRhLm5vZGVzW3ZdKTppLmRhdGEubm9kZXNbdl0scix5LHtkbmQ6ITAscmVmOmouZ2V0X25vZGUoay5wYXJlbnQoKSkscG9zOmUsb3JpZ2luOmkuZGF0YS5vcmlnaW4saXNfbXVsdGk6aS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbiE9PWosaXNfZm9yZWlnbjohaS5kYXRhLm9yaWdpbn0pKSwhdSl7aiYmai5sYXN0X2Vycm9yJiYoZD1qLmxhc3RfZXJyb3IoKSk7YnJlYWt9cmV0dXJuXCJpXCI9PT1lJiZrLnBhcmVudCgpLmlzKFwiLmpzdHJlZS1jbG9zZWRcIikmJmouc2V0dGluZ3MuZG5kLm9wZW5fdGltZW91dCYmKGY9c2V0VGltZW91dChmdW5jdGlvbihhLGIpe3JldHVybiBmdW5jdGlvbigpe2Eub3Blbl9ub2RlKGIpfX0oaixrKSxqLnNldHRpbmdzLmRuZC5vcGVuX3RpbWVvdXQpKSx1PyhjPXtpbnM6aixwYXI6cixwb3M6XCJpXCIhPT1lfHxcImxhc3RcIiE9PUF8fDAhPT1zfHxqLmlzX2xvYWRlZChCKT9zOlwibGFzdFwifSxnLmNzcyh7bGVmdDpvK1wicHhcIix0b3A6cCtcInB4XCJ9KS5zaG93KCksaS5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5maXJzdCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWVyXCIpLmFkZENsYXNzKFwianN0cmVlLW9rXCIpLGkuZXZlbnQub3JpZ2luYWxFdmVudCYmaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciYmKGkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdD1DP1wiY29weVwiOlwibW92ZVwiKSxkPXt9LHQ9ITAsITEpOnZvaWQgMH0pLHQ9PT0hMCkpcmV0dXJufWVsc2V7Zm9yKHU9ITAsdj0wLHc9aS5kYXRhLm5vZGVzLmxlbmd0aDt3PnY7disrKWlmKHU9dSYmai5jaGVjayhpLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihpLmV2ZW50Lm1ldGFLZXl8fGkuZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIixpLmRhdGEub3JpZ2luJiZpLmRhdGEub3JpZ2luIT09aj9pLmRhdGEub3JpZ2luLmdldF9ub2RlKGkuZGF0YS5ub2Rlc1t2XSk6aS5kYXRhLm5vZGVzW3ZdLGEuanN0cmVlLnJvb3QsXCJsYXN0XCIse2RuZDohMCxyZWY6ai5nZXRfbm9kZShhLmpzdHJlZS5yb290KSxwb3M6XCJpXCIsb3JpZ2luOmkuZGF0YS5vcmlnaW4saXNfbXVsdGk6aS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbiE9PWosaXNfZm9yZWlnbjohaS5kYXRhLm9yaWdpbn0pLCF1KWJyZWFrO2lmKHUpcmV0dXJuIGM9e2luczpqLHBhcjphLmpzdHJlZS5yb290LHBvczpcImxhc3RcIn0sZy5oaWRlKCksaS5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5maXJzdCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWVyXCIpLmFkZENsYXNzKFwianN0cmVlLW9rXCIpLHZvaWQoaS5ldmVudC5vcmlnaW5hbEV2ZW50JiZpLmV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyJiYoaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0PUM/XCJjb3B5XCI6XCJtb3ZlXCIpKX1jPSExLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb2tcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZXJcIiksaS5ldmVudC5vcmlnaW5hbEV2ZW50JiZpLmV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyJiYoaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0PVwibm9uZVwiKSxnLmhpZGUoKX19KS5vbihcImRuZF9zY3JvbGwudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsYil7YiYmYi5kYXRhJiZiLmRhdGEuanN0cmVlJiYoZy5oaWRlKCksYz0hMSxlPSExLGIuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1va1wiKS5hZGRDbGFzcyhcImpzdHJlZS1lclwiKSl9KS5vbihcImRuZF9zdG9wLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihiLGgpe2lmKGYmJmNsZWFyVGltZW91dChmKSxoJiZoLmRhdGEmJmguZGF0YS5qc3RyZWUpe2cuaGlkZSgpLmRldGFjaCgpO3ZhciBpLGosaz1bXTtpZihjKXtmb3IoaT0wLGo9aC5kYXRhLm5vZGVzLmxlbmd0aDtqPmk7aSsrKWtbaV09aC5kYXRhLm9yaWdpbj9oLmRhdGEub3JpZ2luLmdldF9ub2RlKGguZGF0YS5ub2Rlc1tpXSk6aC5kYXRhLm5vZGVzW2ldO2MuaW5zW2guZGF0YS5vcmlnaW4mJihoLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8aC5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKGguZXZlbnQubWV0YUtleXx8aC5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiXShrLGMucGFyLGMucG9zLCExLCExLCExLGguZGF0YS5vcmlnaW4pfWVsc2UgaT1hKGguZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZVwiKSxpLmxlbmd0aCYmZCYmZC5lcnJvciYmXCJjaGVja1wiPT09ZC5lcnJvciYmKGk9aS5qc3RyZWUoITApLGkmJmkuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsZCkpO2U9ITEsYz0hMX19KS5vbihcImtleXVwLmpzdHJlZSBrZXlkb3duLmpzdHJlZVwiLGZ1bmN0aW9uKGIsaCl7aD1hLnZha2F0YS5kbmQuX2dldCgpLGgmJmguZGF0YSYmaC5kYXRhLmpzdHJlZSYmKFwia2V5dXBcIj09PWIudHlwZSYmMjc9PT1iLndoaWNoPyhmJiZjbGVhclRpbWVvdXQoZiksYz0hMSxkPSExLGU9ITEsZj0hMSxnLmhpZGUoKS5kZXRhY2goKSxhLnZha2F0YS5kbmQuX2NsZWFuKCkpOihoLmhlbHBlci5maW5kKFwiLmpzdHJlZS1jb3B5XCIpLmZpcnN0KClbaC5kYXRhLm9yaWdpbiYmKGguZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxoLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoYi5tZXRhS2V5fHxiLmN0cmxLZXkpKT9cInNob3dcIjpcImhpZGVcIl0oKSxlJiYoZS5tZXRhS2V5PWIubWV0YUtleSxlLmN0cmxLZXk9Yi5jdHJsS2V5LGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixlKSkpKX0pfSksZnVuY3Rpb24oYSl7YS52YWthdGEuaHRtbD17ZGl2OmEoXCI8ZGl2IC8+XCIpLGVzY2FwZTpmdW5jdGlvbihiKXtyZXR1cm4gYS52YWthdGEuaHRtbC5kaXYudGV4dChiKS5odG1sKCl9LHN0cmlwOmZ1bmN0aW9uKGIpe3JldHVybiBhLnZha2F0YS5odG1sLmRpdi5lbXB0eSgpLmFwcGVuZChhLnBhcnNlSFRNTChiKSkudGV4dCgpfX07dmFyIGM9e2VsZW1lbnQ6ITEsdGFyZ2V0OiExLGlzX2Rvd246ITEsaXNfZHJhZzohMSxoZWxwZXI6ITEsaGVscGVyX3c6MCxkYXRhOiExLGluaXRfeDowLGluaXRfeTowLHNjcm9sbF9sOjAsc2Nyb2xsX3Q6MCxzY3JvbGxfZTohMSxzY3JvbGxfaTohMSxpc190b3VjaDohMX07YS52YWthdGEuZG5kPXtzZXR0aW5nczp7c2Nyb2xsX3NwZWVkOjEwLHNjcm9sbF9wcm94aW1pdHk6MjAsaGVscGVyX2xlZnQ6NSxoZWxwZXJfdG9wOjEwLHRocmVzaG9sZDo1LHRocmVzaG9sZF90b3VjaDo1MH0sX3RyaWdnZXI6ZnVuY3Rpb24oYyxkLGUpe2U9PT1iJiYoZT1hLnZha2F0YS5kbmQuX2dldCgpKSxlLmV2ZW50PWQsYShpKS50cmlnZ2VySGFuZGxlcihcImRuZF9cIitjK1wiLnZha2F0YVwiLGUpfSxfZ2V0OmZ1bmN0aW9uKCl7cmV0dXJue2RhdGE6Yy5kYXRhLGVsZW1lbnQ6Yy5lbGVtZW50LGhlbHBlcjpjLmhlbHBlcn19LF9jbGVhbjpmdW5jdGlvbigpe2MuaGVscGVyJiZjLmhlbHBlci5yZW1vdmUoKSxjLnNjcm9sbF9pJiYoY2xlYXJJbnRlcnZhbChjLnNjcm9sbF9pKSxjLnNjcm9sbF9pPSExKSxjPXtlbGVtZW50OiExLHRhcmdldDohMSxpc19kb3duOiExLGlzX2RyYWc6ITEsaGVscGVyOiExLGhlbHBlcl93OjAsZGF0YTohMSxpbml0X3g6MCxpbml0X3k6MCxzY3JvbGxfbDowLHNjcm9sbF90OjAsc2Nyb2xsX2U6ITEsc2Nyb2xsX2k6ITEsaXNfdG91Y2g6ITF9LGEoaSkub2ZmKFwibW91c2Vtb3ZlLnZha2F0YS5qc3RyZWUgdG91Y2htb3ZlLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuZHJhZyksYShpKS5vZmYoXCJtb3VzZXVwLnZha2F0YS5qc3RyZWUgdG91Y2hlbmQudmFrYXRhLmpzdHJlZVwiLGEudmFrYXRhLmRuZC5zdG9wKX0sX3Njcm9sbDpmdW5jdGlvbihiKXtpZighYy5zY3JvbGxfZXx8IWMuc2Nyb2xsX2wmJiFjLnNjcm9sbF90KXJldHVybiBjLnNjcm9sbF9pJiYoY2xlYXJJbnRlcnZhbChjLnNjcm9sbF9pKSxjLnNjcm9sbF9pPSExKSwhMTtpZighYy5zY3JvbGxfaSlyZXR1cm4gYy5zY3JvbGxfaT1zZXRJbnRlcnZhbChhLnZha2F0YS5kbmQuX3Njcm9sbCwxMDApLCExO2lmKGI9PT0hMClyZXR1cm4hMTt2YXIgZD1jLnNjcm9sbF9lLnNjcm9sbFRvcCgpLGU9Yy5zY3JvbGxfZS5zY3JvbGxMZWZ0KCk7Yy5zY3JvbGxfZS5zY3JvbGxUb3AoZCtjLnNjcm9sbF90KmEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfc3BlZWQpLGMuc2Nyb2xsX2Uuc2Nyb2xsTGVmdChlK2Muc2Nyb2xsX2wqYS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9zcGVlZCksZD09PWMuc2Nyb2xsX2Uuc2Nyb2xsVG9wKCkmJmU9PT1jLnNjcm9sbF9lLnNjcm9sbExlZnQoKXx8YS52YWthdGEuZG5kLl90cmlnZ2VyKFwic2Nyb2xsXCIsYy5zY3JvbGxfZSl9LHN0YXJ0OmZ1bmN0aW9uKGIsZCxlKXtcInRvdWNoc3RhcnRcIj09PWIudHlwZSYmYi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGIucGFnZVg9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGIucGFnZVk9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGIudGFyZ2V0PWkuZWxlbWVudEZyb21Qb2ludChiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSxjLmlzX2RyYWcmJmEudmFrYXRhLmRuZC5zdG9wKHt9KTt0cnl7Yi5jdXJyZW50VGFyZ2V0LnVuc2VsZWN0YWJsZT1cIm9uXCIsYi5jdXJyZW50VGFyZ2V0Lm9uc2VsZWN0c3RhcnQ9ZnVuY3Rpb24oKXtyZXR1cm4hMX0sYi5jdXJyZW50VGFyZ2V0LnN0eWxlJiYoYi5jdXJyZW50VGFyZ2V0LnN0eWxlLnRvdWNoQWN0aW9uPVwibm9uZVwiLGIuY3VycmVudFRhcmdldC5zdHlsZS5tc1RvdWNoQWN0aW9uPVwibm9uZVwiLGIuY3VycmVudFRhcmdldC5zdHlsZS5Nb3pVc2VyU2VsZWN0PVwibm9uZVwiKX1jYXRjaChmKXt9cmV0dXJuIGMuaW5pdF94PWIucGFnZVgsYy5pbml0X3k9Yi5wYWdlWSxjLmRhdGE9ZCxjLmlzX2Rvd249ITAsYy5lbGVtZW50PWIuY3VycmVudFRhcmdldCxjLnRhcmdldD1iLnRhcmdldCxjLmlzX3RvdWNoPVwidG91Y2hzdGFydFwiPT09Yi50eXBlLGUhPT0hMSYmKGMuaGVscGVyPWEoXCI8ZGl2IGlkPSd2YWthdGEtZG5kJz48L2Rpdj5cIikuaHRtbChlKS5jc3Moe2Rpc3BsYXk6XCJibG9ja1wiLG1hcmdpbjpcIjBcIixwYWRkaW5nOlwiMFwiLHBvc2l0aW9uOlwiYWJzb2x1dGVcIix0b3A6XCItMjAwMHB4XCIsbGluZUhlaWdodDpcIjE2cHhcIix6SW5kZXg6XCIxMDAwMFwifSkpLGEoaSkub24oXCJtb3VzZW1vdmUudmFrYXRhLmpzdHJlZSB0b3VjaG1vdmUudmFrYXRhLmpzdHJlZVwiLGEudmFrYXRhLmRuZC5kcmFnKSxhKGkpLm9uKFwibW91c2V1cC52YWthdGEuanN0cmVlIHRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuc3RvcCksITF9LGRyYWc6ZnVuY3Rpb24oYil7aWYoXCJ0b3VjaG1vdmVcIj09PWIudHlwZSYmYi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGIucGFnZVg9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGIucGFnZVk9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGIudGFyZ2V0PWkuZWxlbWVudEZyb21Qb2ludChiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSxjLmlzX2Rvd24pe2lmKCFjLmlzX2RyYWcpe2lmKCEoTWF0aC5hYnMoYi5wYWdlWC1jLmluaXRfeCk+KGMuaXNfdG91Y2g/YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZF90b3VjaDphLnZha2F0YS5kbmQuc2V0dGluZ3MudGhyZXNob2xkKXx8TWF0aC5hYnMoYi5wYWdlWS1jLmluaXRfeSk+KGMuaXNfdG91Y2g/YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZF90b3VjaDphLnZha2F0YS5kbmQuc2V0dGluZ3MudGhyZXNob2xkKSkpcmV0dXJuO2MuaGVscGVyJiYoYy5oZWxwZXIuYXBwZW5kVG8oXCJib2R5XCIpLGMuaGVscGVyX3c9Yy5oZWxwZXIub3V0ZXJXaWR0aCgpKSxjLmlzX2RyYWc9ITAsYS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RhcnRcIixiKX12YXIgZD0hMSxlPSExLGY9ITEsZz0hMSxoPSExLGo9ITEsaz0hMSxsPSExLG09ITEsbj0hMTtyZXR1cm4gYy5zY3JvbGxfdD0wLGMuc2Nyb2xsX2w9MCxjLnNjcm9sbF9lPSExLGEoYShiLnRhcmdldCkucGFyZW50c1VudGlsKFwiYm9keVwiKS5hZGRCYWNrKCkuZ2V0KCkucmV2ZXJzZSgpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vXmF1dG98c2Nyb2xsJC8udGVzdChhKHRoaXMpLmNzcyhcIm92ZXJmbG93XCIpKSYmKHRoaXMuc2Nyb2xsSGVpZ2h0PnRoaXMub2Zmc2V0SGVpZ2h0fHx0aGlzLnNjcm9sbFdpZHRoPnRoaXMub2Zmc2V0V2lkdGgpfSkuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLm9mZnNldCgpO3JldHVybiB0aGlzLnNjcm9sbEhlaWdodD50aGlzLm9mZnNldEhlaWdodCYmKGUudG9wK2QuaGVpZ2h0KCktYi5wYWdlWTxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9MSksYi5wYWdlWS1lLnRvcDxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9LTEpKSx0aGlzLnNjcm9sbFdpZHRoPnRoaXMub2Zmc2V0V2lkdGgmJihlLmxlZnQrZC53aWR0aCgpLWIucGFnZVg8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF9sPTEpLGIucGFnZVgtZS5sZWZ0PGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfbD0tMSkpLGMuc2Nyb2xsX3R8fGMuc2Nyb2xsX2w/KGMuc2Nyb2xsX2U9YSh0aGlzKSwhMSk6dm9pZCAwfSksYy5zY3JvbGxfZXx8KGQ9YShpKSxlPWEod2luZG93KSxmPWQuaGVpZ2h0KCksZz1lLmhlaWdodCgpLGg9ZC53aWR0aCgpLGo9ZS53aWR0aCgpLGs9ZC5zY3JvbGxUb3AoKSxsPWQuc2Nyb2xsTGVmdCgpLGY+ZyYmYi5wYWdlWS1rPGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfdD0tMSksZj5nJiZnLShiLnBhZ2VZLWspPGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfdD0xKSxoPmomJmIucGFnZVgtbDxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX2w9LTEpLGg+aiYmai0oYi5wYWdlWC1sKTxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX2w9MSksKGMuc2Nyb2xsX3R8fGMuc2Nyb2xsX2wpJiYoYy5zY3JvbGxfZT1kKSksYy5zY3JvbGxfZSYmYS52YWthdGEuZG5kLl9zY3JvbGwoITApLGMuaGVscGVyJiYobT1wYXJzZUludChiLnBhZ2VZK2EudmFrYXRhLmRuZC5zZXR0aW5ncy5oZWxwZXJfdG9wLDEwKSxuPXBhcnNlSW50KGIucGFnZVgrYS52YWthdGEuZG5kLnNldHRpbmdzLmhlbHBlcl9sZWZ0LDEwKSxmJiZtKzI1PmYmJihtPWYtNTApLGgmJm4rYy5oZWxwZXJfdz5oJiYobj1oLShjLmhlbHBlcl93KzIpKSxjLmhlbHBlci5jc3Moe2xlZnQ6bitcInB4XCIsdG9wOm0rXCJweFwifSkpLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixiKSwhMX19LHN0b3A6ZnVuY3Rpb24oYil7aWYoXCJ0b3VjaGVuZFwiPT09Yi50eXBlJiZiLm9yaWdpbmFsRXZlbnQmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcyYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdJiYoYi5wYWdlWD1iLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgsYi5wYWdlWT1iLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVksYi50YXJnZXQ9aS5lbGVtZW50RnJvbVBvaW50KGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWC13aW5kb3cucGFnZVhPZmZzZXQsYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLXdpbmRvdy5wYWdlWU9mZnNldCkpLGMuaXNfZHJhZylhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJzdG9wXCIsYik7ZWxzZSBpZihcInRvdWNoZW5kXCI9PT1iLnR5cGUmJmIudGFyZ2V0PT09Yy50YXJnZXQpe3ZhciBkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXthKGIudGFyZ2V0KS5jbGljaygpfSwxMDApO2EoYi50YXJnZXQpLm9uZShcImNsaWNrXCIsZnVuY3Rpb24oKXtkJiZjbGVhclRpbWVvdXQoZCl9KX1yZXR1cm4gYS52YWthdGEuZG5kLl9jbGVhbigpLCExfX19KGEpLGEuanN0cmVlLmRlZmF1bHRzLm1hc3Nsb2FkPW51bGwsYS5qc3RyZWUucGx1Z2lucy5tYXNzbG9hZD1mdW5jdGlvbihiLGMpe3RoaXMuaW5pdD1mdW5jdGlvbihhLGIpe3RoaXMuX2RhdGEubWFzc2xvYWQ9e30sYy5pbml0LmNhbGwodGhpcyxhLGIpfSx0aGlzLl9sb2FkX25vZGVzPWZ1bmN0aW9uKGIsZCxlLGYpe3ZhciBnPXRoaXMuc2V0dGluZ3MubWFzc2xvYWQsaD1KU09OLnN0cmluZ2lmeShiKSxpPVtdLGo9dGhpcy5fbW9kZWwuZGF0YSxrLGwsbTtpZighZSl7Zm9yKGs9MCxsPWIubGVuZ3RoO2w+aztrKyspaltiW2tdXSYmKGpbYltrXV0uc3RhdGUubG9hZGVkfHxqW2Jba11dLnN0YXRlLmZhaWxlZCkmJiFmfHwoaS5wdXNoKGJba10pLG09dGhpcy5nZXRfbm9kZShiW2tdLCEwKSxtJiZtLmxlbmd0aCYmbS5hZGRDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMCkpO2lmKHRoaXMuX2RhdGEubWFzc2xvYWQ9e30saS5sZW5ndGgpe2lmKGEuaXNGdW5jdGlvbihnKSlyZXR1cm4gZy5jYWxsKHRoaXMsaSxhLnByb3h5KGZ1bmN0aW9uKGEpe3ZhciBnLGg7aWYoYSlmb3IoZyBpbiBhKWEuaGFzT3duUHJvcGVydHkoZykmJih0aGlzLl9kYXRhLm1hc3Nsb2FkW2ddPWFbZ10pO2ZvcihnPTAsaD1iLmxlbmd0aDtoPmc7ZysrKW09dGhpcy5nZXRfbm9kZShiW2ddLCEwKSxtJiZtLmxlbmd0aCYmbS5yZW1vdmVDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMSk7Yy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMpKTtpZihcIm9iamVjdFwiPT10eXBlb2YgZyYmZyYmZy51cmwpcmV0dXJuIGc9YS5leHRlbmQoITAse30sZyksYS5pc0Z1bmN0aW9uKGcudXJsKSYmKGcudXJsPWcudXJsLmNhbGwodGhpcyxpKSksYS5pc0Z1bmN0aW9uKGcuZGF0YSkmJihnLmRhdGE9Zy5kYXRhLmNhbGwodGhpcyxpKSksYS5hamF4KGcpLmRvbmUoYS5wcm94eShmdW5jdGlvbihhLGcsaCl7dmFyIGksajtpZihhKWZvcihpIGluIGEpYS5oYXNPd25Qcm9wZXJ0eShpKSYmKHRoaXMuX2RhdGEubWFzc2xvYWRbaV09YVtpXSk7Zm9yKGk9MCxqPWIubGVuZ3RoO2o+aTtpKyspbT10aGlzLmdldF9ub2RlKGJbaV0sITApLG0mJm0ubGVuZ3RoJiZtLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKTtjLl9sb2FkX25vZGVzLmNhbGwodGhpcyxiLGQsZSxmKX0sdGhpcykpLmZhaWwoYS5wcm94eShmdW5jdGlvbihhKXtjLl9sb2FkX25vZGVzLmNhbGwodGhpcyxiLGQsZSxmKX0sdGhpcykpfX1yZXR1cm4gYy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMuX2xvYWRfbm9kZT1mdW5jdGlvbihiLGQpe3ZhciBlPXRoaXMuX2RhdGEubWFzc2xvYWRbYi5pZF0sZj1udWxsLGc7cmV0dXJuIGU/KGY9dGhpc1tcInN0cmluZ1wiPT10eXBlb2YgZT9cIl9hcHBlbmRfaHRtbF9kYXRhXCI6XCJfYXBwZW5kX2pzb25fZGF0YVwiXShiLFwic3RyaW5nXCI9PXR5cGVvZiBlP2EoYS5wYXJzZUhUTUwoZSkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pOmUsZnVuY3Rpb24oYSl7ZC5jYWxsKHRoaXMsYSl9KSxnPXRoaXMuZ2V0X25vZGUoYi5pZCwhMCksZyYmZy5sZW5ndGgmJmcucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITEpLGRlbGV0ZSB0aGlzLl9kYXRhLm1hc3Nsb2FkW2IuaWRdLGYpOmMuX2xvYWRfbm9kZS5jYWxsKHRoaXMsYixkKX19LGEuanN0cmVlLmRlZmF1bHRzLnNlYXJjaD17YWpheDohMSxmdXp6eTohMSxjYXNlX3NlbnNpdGl2ZTohMSxzaG93X29ubHlfbWF0Y2hlczohMSxzaG93X29ubHlfbWF0Y2hlc19jaGlsZHJlbjohMSxjbG9zZV9vcGVuZWRfb25jbGVhcjohMCxzZWFyY2hfbGVhdmVzX29ubHk6ITEsc2VhcmNoX2NhbGxiYWNrOiExfSxhLmpzdHJlZS5wbHVnaW5zLnNlYXJjaD1mdW5jdGlvbihjLGQpe3RoaXMuYmluZD1mdW5jdGlvbigpe2QuYmluZC5jYWxsKHRoaXMpLHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1cIlwiLHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1hKCksdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5zb209ITEsdGhpcy5fZGF0YS5zZWFyY2guc21jPSExLHRoaXMuX2RhdGEuc2VhcmNoLmhkbj1bXSx0aGlzLmVsZW1lbnQub24oXCJzZWFyY2guanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe2lmKHRoaXMuX2RhdGEuc2VhcmNoLnNvbSYmYy5yZXMubGVuZ3RoKXt2YXIgZD10aGlzLl9tb2RlbC5kYXRhLGUsZixnPVtdLGgsaTtmb3IoZT0wLGY9Yy5yZXMubGVuZ3RoO2Y+ZTtlKyspaWYoZFtjLnJlc1tlXV0mJiFkW2MucmVzW2VdXS5zdGF0ZS5oaWRkZW4mJihnLnB1c2goYy5yZXNbZV0pLGc9Zy5jb25jYXQoZFtjLnJlc1tlXV0ucGFyZW50cyksdGhpcy5fZGF0YS5zZWFyY2guc21jKSlmb3IoaD0wLGk9ZFtjLnJlc1tlXV0uY2hpbGRyZW5fZC5sZW5ndGg7aT5oO2grKylkW2RbYy5yZXNbZV1dLmNoaWxkcmVuX2RbaF1dJiYhZFtkW2MucmVzW2VdXS5jaGlsZHJlbl9kW2hdXS5zdGF0ZS5oaWRkZW4mJmcucHVzaChkW2MucmVzW2VdXS5jaGlsZHJlbl9kW2hdKTtnPWEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKGEudmFrYXRhLmFycmF5X3VuaXF1ZShnKSxhLmpzdHJlZS5yb290KSx0aGlzLl9kYXRhLnNlYXJjaC5oZG49dGhpcy5oaWRlX2FsbCghMCksdGhpcy5zaG93X25vZGUoZywhMCksdGhpcy5yZWRyYXcoITApfX0sdGhpcykpLm9uKFwiY2xlYXJfc2VhcmNoLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLl9kYXRhLnNlYXJjaC5zb20mJmIucmVzLmxlbmd0aCYmKHRoaXMuc2hvd19ub2RlKHRoaXMuX2RhdGEuc2VhcmNoLmhkbiwhMCksdGhpcy5yZWRyYXcoITApKX0sdGhpcykpfSx0aGlzLnNlYXJjaD1mdW5jdGlvbihjLGQsZSxmLGcsaCl7aWYoYz09PSExfHxcIlwiPT09YS50cmltKGMudG9TdHJpbmcoKSkpcmV0dXJuIHRoaXMuY2xlYXJfc2VhcmNoKCk7Zj10aGlzLmdldF9ub2RlKGYpLGY9ZiYmZi5pZD9mLmlkOm51bGwsYz1jLnRvU3RyaW5nKCk7dmFyIGk9dGhpcy5zZXR0aW5ncy5zZWFyY2gsaj1pLmFqYXg/aS5hamF4OiExLGs9dGhpcy5fbW9kZWwuZGF0YSxsPW51bGwsbT1bXSxuPVtdLG8scDtpZih0aGlzLl9kYXRhLnNlYXJjaC5yZXMubGVuZ3RoJiYhZyYmdGhpcy5jbGVhcl9zZWFyY2goKSxlPT09YiYmKGU9aS5zaG93X29ubHlfbWF0Y2hlcyksaD09PWImJihoPWkuc2hvd19vbmx5X21hdGNoZXNfY2hpbGRyZW4pLCFkJiZqIT09ITEpcmV0dXJuIGEuaXNGdW5jdGlvbihqKT9qLmNhbGwodGhpcyxjLGEucHJveHkoZnVuY3Rpb24oYil7YiYmYi5kJiYoYj1iLmQpLHRoaXMuX2xvYWRfbm9kZXMoYS5pc0FycmF5KGIpP2EudmFrYXRhLmFycmF5X3VuaXF1ZShiKTpbXSxmdW5jdGlvbigpe3RoaXMuc2VhcmNoKGMsITAsZSxmLGcpfSl9LHRoaXMpLGYpOihqPWEuZXh0ZW5kKHt9LGopLGouZGF0YXx8KGouZGF0YT17fSksai5kYXRhLnN0cj1jLGYmJihqLmRhdGEuaW5zaWRlPWYpLGEuYWpheChqKS5mYWlsKGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwic2VhcmNoXCIsaWQ6XCJzZWFyY2hfMDFcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBzZWFyY2ggcGFyZW50c1wiLGRhdGE6SlNPTi5zdHJpbmdpZnkoail9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpfSx0aGlzKSkuZG9uZShhLnByb3h5KGZ1bmN0aW9uKGIpe2ImJmIuZCYmKGI9Yi5kKSx0aGlzLl9sb2FkX25vZGVzKGEuaXNBcnJheShiKT9hLnZha2F0YS5hcnJheV91bmlxdWUoYik6W10sZnVuY3Rpb24oKXt0aGlzLnNlYXJjaChjLCEwLGUsZixnKX0pfSx0aGlzKSkpO2lmKGd8fCh0aGlzLl9kYXRhLnNlYXJjaC5zdHI9Yyx0aGlzLl9kYXRhLnNlYXJjaC5kb209YSgpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guc29tPWUsdGhpcy5fZGF0YS5zZWFyY2guc21jPWgpLGw9bmV3IGEudmFrYXRhLnNlYXJjaChjLCEwLHtjYXNlU2Vuc2l0aXZlOmkuY2FzZV9zZW5zaXRpdmUsZnV6enk6aS5mdXp6eX0pLGEuZWFjaChrW2Y/ZjphLmpzdHJlZS5yb290XS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGEsYil7dmFyIGQ9a1tiXTtkLnRleHQmJiFkLnN0YXRlLmhpZGRlbiYmKCFpLnNlYXJjaF9sZWF2ZXNfb25seXx8ZC5zdGF0ZS5sb2FkZWQmJjA9PT1kLmNoaWxkcmVuLmxlbmd0aCkmJihpLnNlYXJjaF9jYWxsYmFjayYmaS5zZWFyY2hfY2FsbGJhY2suY2FsbCh0aGlzLGMsZCl8fCFpLnNlYXJjaF9jYWxsYmFjayYmbC5zZWFyY2goZC50ZXh0KS5pc01hdGNoKSYmKG0ucHVzaChiKSxuPW4uY29uY2F0KGQucGFyZW50cykpfSksbS5sZW5ndGgpe2ZvcihuPWEudmFrYXRhLmFycmF5X3VuaXF1ZShuKSxvPTAscD1uLmxlbmd0aDtwPm87bysrKW5bb10hPT1hLmpzdHJlZS5yb290JiZrW25bb11dJiZ0aGlzLm9wZW5fbm9kZShuW29dLG51bGwsMCk9PT0hMCYmdGhpcy5fZGF0YS5zZWFyY2gub3BuLnB1c2gobltvXSk7Zz8odGhpcy5fZGF0YS5zZWFyY2guZG9tPXRoaXMuX2RhdGEuc2VhcmNoLmRvbS5hZGQoYSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIithLm1hcChtLGZ1bmN0aW9uKGIpe3JldHVybi0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZihiWzBdKT9cIlxcXFwzXCIrYlswXStcIiBcIitiLnN1YnN0cigxKS5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6Yi5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIil9KS5qb2luKFwiLCAjXCIpKSkpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1hLnZha2F0YS5hcnJheV91bmlxdWUodGhpcy5fZGF0YS5zZWFyY2gucmVzLmNvbmNhdChtKSkpOih0aGlzLl9kYXRhLnNlYXJjaC5kb209YSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIithLm1hcChtLGZ1bmN0aW9uKGIpe3JldHVybi0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZihiWzBdKT9cIlxcXFwzXCIrYlswXStcIiBcIitiLnN1YnN0cigxKS5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6Yi5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIil9KS5qb2luKFwiLCAjXCIpKSksdGhpcy5fZGF0YS5zZWFyY2gucmVzPW0pLHRoaXMuX2RhdGEuc2VhcmNoLmRvbS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLXNlYXJjaFwiKX10aGlzLnRyaWdnZXIoXCJzZWFyY2hcIix7bm9kZXM6dGhpcy5fZGF0YS5zZWFyY2guZG9tLHN0cjpjLHJlczp0aGlzLl9kYXRhLnNlYXJjaC5yZXMsc2hvd19vbmx5X21hdGNoZXM6ZX0pfSx0aGlzLmNsZWFyX3NlYXJjaD1mdW5jdGlvbigpe3RoaXMuc2V0dGluZ3Muc2VhcmNoLmNsb3NlX29wZW5lZF9vbmNsZWFyJiZ0aGlzLmNsb3NlX25vZGUodGhpcy5fZGF0YS5zZWFyY2gub3BuLDApLHRoaXMudHJpZ2dlcihcImNsZWFyX3NlYXJjaFwiLHtub2Rlczp0aGlzLl9kYXRhLnNlYXJjaC5kb20sc3RyOnRoaXMuX2RhdGEuc2VhcmNoLnN0cixyZXM6dGhpcy5fZGF0YS5zZWFyY2gucmVzfSksdGhpcy5fZGF0YS5zZWFyY2gucmVzLmxlbmd0aCYmKHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1hKHRoaXMuZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yQWxsKFwiI1wiK2EubWFwKHRoaXMuX2RhdGEuc2VhcmNoLnJlcyxmdW5jdGlvbihiKXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoYlswXSk/XCJcXFxcM1wiK2JbMF0rXCIgXCIrYi5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmIucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpLHRoaXMuX2RhdGEuc2VhcmNoLmRvbS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXNlYXJjaFwiKSksdGhpcy5fZGF0YS5zZWFyY2guc3RyPVwiXCIsdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5kb209YSgpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGIsYyxlLGYpe2lmKGI9ZC5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYiYmLTEhPT1hLmluQXJyYXkoYi5pZCx0aGlzLl9kYXRhLnNlYXJjaC5yZXMpKXt2YXIgZyxoLGk9bnVsbDtmb3IoZz0wLGg9Yi5jaGlsZE5vZGVzLmxlbmd0aDtoPmc7ZysrKWlmKGIuY2hpbGROb2Rlc1tnXSYmYi5jaGlsZE5vZGVzW2ddLmNsYXNzTmFtZSYmLTEhPT1iLmNoaWxkTm9kZXNbZ10uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtYW5jaG9yXCIpKXtpPWIuY2hpbGROb2Rlc1tnXTticmVha31pJiYoaS5jbGFzc05hbWUrPVwiIGpzdHJlZS1zZWFyY2hcIil9cmV0dXJuIGJ9fSxmdW5jdGlvbihhKXthLnZha2F0YS5zZWFyY2g9ZnVuY3Rpb24oYixjLGQpe2Q9ZHx8e30sZD1hLmV4dGVuZCh7fSxhLnZha2F0YS5zZWFyY2guZGVmYXVsdHMsZCksZC5mdXp6eSE9PSExJiYoZC5mdXp6eT0hMCksYj1kLmNhc2VTZW5zaXRpdmU/YjpiLnRvTG93ZXJDYXNlKCk7dmFyIGU9ZC5sb2NhdGlvbixmPWQuZGlzdGFuY2UsZz1kLnRocmVzaG9sZCxoPWIubGVuZ3RoLGksaixrLGw7cmV0dXJuIGg+MzImJihkLmZ1enp5PSExKSxkLmZ1enp5JiYoaT0xPDxoLTEsaj1mdW5jdGlvbigpe3ZhciBhPXt9LGM9MDtmb3IoYz0wO2g+YztjKyspYVtiLmNoYXJBdChjKV09MDtmb3IoYz0wO2g+YztjKyspYVtiLmNoYXJBdChjKV18PTE8PGgtYy0xO3JldHVybiBhfSgpLGs9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hL2gsZD1NYXRoLmFicyhlLWIpO3JldHVybiBmP2MrZC9mOmQ/MTpjfSksbD1mdW5jdGlvbihhKXtpZihhPWQuY2FzZVNlbnNpdGl2ZT9hOmEudG9Mb3dlckNhc2UoKSxiPT09YXx8LTEhPT1hLmluZGV4T2YoYikpcmV0dXJue2lzTWF0Y2g6ITAsc2NvcmU6MH07aWYoIWQuZnV6enkpcmV0dXJue2lzTWF0Y2g6ITEsc2NvcmU6MX07dmFyIGMsZixsPWEubGVuZ3RoLG09ZyxuPWEuaW5kZXhPZihiLGUpLG8scCxxPWgrbCxyLHMsdCx1LHYsdz0xLHg9W107Zm9yKC0xIT09biYmKG09TWF0aC5taW4oaygwLG4pLG0pLG49YS5sYXN0SW5kZXhPZihiLGUraCksLTEhPT1uJiYobT1NYXRoLm1pbihrKDAsbiksbSkpKSxuPS0xLGM9MDtoPmM7YysrKXtvPTAscD1xO3doaWxlKHA+bylrKGMsZStwKTw9bT9vPXA6cT1wLHA9TWF0aC5mbG9vcigocS1vKS8yK28pO2ZvcihxPXAscz1NYXRoLm1heCgxLGUtcCsxKSx0PU1hdGgubWluKGUrcCxsKStoLHU9bmV3IEFycmF5KHQrMiksdVt0KzFdPSgxPDxjKS0xLGY9dDtmPj1zO2YtLSlpZih2PWpbYS5jaGFyQXQoZi0xKV0sMD09PWM/dVtmXT0odVtmKzFdPDwxfDEpJnY6dVtmXT0odVtmKzFdPDwxfDEpJnZ8KChyW2YrMV18cltmXSk8PDF8MSl8cltmKzFdLHVbZl0maSYmKHc9ayhjLGYtMSksbT49dykpe2lmKG09dyxuPWYtMSx4LnB1c2gobiksIShuPmUpKWJyZWFrO3M9TWF0aC5tYXgoMSwyKmUtbil9aWYoayhjKzEsZSk+bSlicmVhaztyPXV9cmV0dXJue2lzTWF0Y2g6bj49MCxzY29yZTp3fX0sYz09PSEwP3tzZWFyY2g6bH06bChjKX0sYS52YWthdGEuc2VhcmNoLmRlZmF1bHRzPXtsb2NhdGlvbjowLGRpc3RhbmNlOjEwMCx0aHJlc2hvbGQ6LjYsZnV6enk6ITEsY2FzZVNlbnNpdGl2ZTohMX19KGEpLGEuanN0cmVlLmRlZmF1bHRzLnNvcnQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5nZXRfdGV4dChhKT50aGlzLmdldF90ZXh0KGIpPzE6LTF9LGEuanN0cmVlLnBsdWdpbnMuc29ydD1mdW5jdGlvbihiLGMpe3RoaXMuYmluZD1mdW5jdGlvbigpe2MuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLnNvcnQoYi5wYXJlbnQsITApfSx0aGlzKSkub24oXCJyZW5hbWVfbm9kZS5qc3RyZWUgY3JlYXRlX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuc29ydChiLnBhcmVudHx8Yi5ub2RlLnBhcmVudCwhMSksdGhpcy5yZWRyYXdfbm9kZShiLnBhcmVudHx8Yi5ub2RlLnBhcmVudCwhMCl9LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWUgY29weV9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLnNvcnQoYi5wYXJlbnQsITEpLHRoaXMucmVkcmF3X25vZGUoYi5wYXJlbnQsITApfSx0aGlzKSl9LHRoaXMuc29ydD1mdW5jdGlvbihiLGMpe3ZhciBkLGU7aWYoYj10aGlzLmdldF9ub2RlKGIpLGImJmIuY2hpbGRyZW4mJmIuY2hpbGRyZW4ubGVuZ3RoJiYoYi5jaGlsZHJlbi5zb3J0KGEucHJveHkodGhpcy5zZXR0aW5ncy5zb3J0LHRoaXMpKSxjKSlmb3IoZD0wLGU9Yi5jaGlsZHJlbl9kLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuc29ydChiLmNoaWxkcmVuX2RbZF0sITEpfX07dmFyIHA9ITE7YS5qc3RyZWUuZGVmYXVsdHMuc3RhdGU9e2tleTpcImpzdHJlZVwiLGV2ZW50czpcImNoYW5nZWQuanN0cmVlIG9wZW5fbm9kZS5qc3RyZWUgY2xvc2Vfbm9kZS5qc3RyZWUgY2hlY2tfbm9kZS5qc3RyZWUgdW5jaGVja19ub2RlLmpzdHJlZVwiLHR0bDohMSxmaWx0ZXI6ITF9LGEuanN0cmVlLnBsdWdpbnMuc3RhdGU9ZnVuY3Rpb24oYixjKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtjLmJpbmQuY2FsbCh0aGlzKTt2YXIgYj1hLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9uKHRoaXMuc2V0dGluZ3Muc3RhdGUuZXZlbnRzLGEucHJveHkoZnVuY3Rpb24oKXtwJiZjbGVhclRpbWVvdXQocCkscD1zZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLnNhdmVfc3RhdGUoKX0sdGhpcyksMTAwKX0sdGhpcykpLHRoaXMudHJpZ2dlcihcInN0YXRlX3JlYWR5XCIpfSx0aGlzKTt0aGlzLmVsZW1lbnQub24oXCJyZWFkeS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYyl7dGhpcy5lbGVtZW50Lm9uZShcInJlc3RvcmVfc3RhdGUuanN0cmVlXCIsYiksdGhpcy5yZXN0b3JlX3N0YXRlKCl8fGIoKX0sdGhpcykpfSx0aGlzLnNhdmVfc3RhdGU9ZnVuY3Rpb24oKXt2YXIgYj17c3RhdGU6dGhpcy5nZXRfc3RhdGUoKSx0dGw6dGhpcy5zZXR0aW5ncy5zdGF0ZS50dGwsc2VjOituZXcgRGF0ZX07YS52YWthdGEuc3RvcmFnZS5zZXQodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXksSlNPTi5zdHJpbmdpZnkoYikpfSx0aGlzLnJlc3RvcmVfc3RhdGU9ZnVuY3Rpb24oKXt2YXIgYj1hLnZha2F0YS5zdG9yYWdlLmdldCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSk7aWYoYil0cnl7Yj1KU09OLnBhcnNlKGIpfWNhdGNoKGMpe3JldHVybiExfXJldHVybiBiJiZiLnR0bCYmYi5zZWMmJituZXcgRGF0ZS1iLnNlYz5iLnR0bD8hMTooYiYmYi5zdGF0ZSYmKGI9Yi5zdGF0ZSksYiYmYS5pc0Z1bmN0aW9uKHRoaXMuc2V0dGluZ3Muc3RhdGUuZmlsdGVyKSYmKGI9dGhpcy5zZXR0aW5ncy5zdGF0ZS5maWx0ZXIuY2FsbCh0aGlzLGIpKSxiPyh0aGlzLmVsZW1lbnQub25lKFwic2V0X3N0YXRlLmpzdHJlZVwiLGZ1bmN0aW9uKGMsZCl7ZC5pbnN0YW5jZS50cmlnZ2VyKFwicmVzdG9yZV9zdGF0ZVwiLHtzdGF0ZTphLmV4dGVuZCghMCx7fSxiKX0pfSksdGhpcy5zZXRfc3RhdGUoYiksITApOiExKX0sdGhpcy5jbGVhcl9zdGF0ZT1mdW5jdGlvbigpe3JldHVybiBhLnZha2F0YS5zdG9yYWdlLmRlbCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSl9fSxmdW5jdGlvbihhLGIpe2EudmFrYXRhLnN0b3JhZ2U9e3NldDpmdW5jdGlvbihhLGIpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oYSxiKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oYSl9LGRlbDpmdW5jdGlvbihhKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGEpfX19KGEpLGEuanN0cmVlLmRlZmF1bHRzLnR5cGVzPXtcImRlZmF1bHRcIjp7fX0sYS5qc3RyZWUuZGVmYXVsdHMudHlwZXNbYS5qc3RyZWUucm9vdF09e30sYS5qc3RyZWUucGx1Z2lucy50eXBlcz1mdW5jdGlvbihjLGQpe3RoaXMuaW5pdD1mdW5jdGlvbihjLGUpe3ZhciBmLGc7aWYoZSYmZS50eXBlcyYmZS50eXBlc1tcImRlZmF1bHRcIl0pZm9yKGYgaW4gZS50eXBlcylpZihcImRlZmF1bHRcIiE9PWYmJmYhPT1hLmpzdHJlZS5yb290JiZlLnR5cGVzLmhhc093blByb3BlcnR5KGYpKWZvcihnIGluIGUudHlwZXNbXCJkZWZhdWx0XCJdKWUudHlwZXNbXCJkZWZhdWx0XCJdLmhhc093blByb3BlcnR5KGcpJiZlLnR5cGVzW2ZdW2ddPT09YiYmKGUudHlwZXNbZl1bZ109ZS50eXBlc1tcImRlZmF1bHRcIl1bZ10pO2QuaW5pdC5jYWxsKHRoaXMsYyxlKSx0aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLnR5cGU9YS5qc3RyZWUucm9vdH0sdGhpcy5yZWZyZXNoPWZ1bmN0aW9uKGIsYyl7ZC5yZWZyZXNoLmNhbGwodGhpcyxiLGMpLHRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0udHlwZT1hLmpzdHJlZS5yb290fSx0aGlzLmJpbmQ9ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGMsZCl7dmFyIGU9dGhpcy5fbW9kZWwuZGF0YSxmPWQubm9kZXMsZz10aGlzLnNldHRpbmdzLnR5cGVzLGgsaSxqPVwiZGVmYXVsdFwiLGs7Zm9yKGg9MCxpPWYubGVuZ3RoO2k+aDtoKyspe2lmKGo9XCJkZWZhdWx0XCIsZVtmW2hdXS5vcmlnaW5hbCYmZVtmW2hdXS5vcmlnaW5hbC50eXBlJiZnW2VbZltoXV0ub3JpZ2luYWwudHlwZV0mJihqPWVbZltoXV0ub3JpZ2luYWwudHlwZSksZVtmW2hdXS5kYXRhJiZlW2ZbaF1dLmRhdGEuanN0cmVlJiZlW2ZbaF1dLmRhdGEuanN0cmVlLnR5cGUmJmdbZVtmW2hdXS5kYXRhLmpzdHJlZS50eXBlXSYmKGo9ZVtmW2hdXS5kYXRhLmpzdHJlZS50eXBlKSxlW2ZbaF1dLnR5cGU9aixlW2ZbaF1dLmljb249PT0hMCYmZ1tqXS5pY29uIT09YiYmKGVbZltoXV0uaWNvbj1nW2pdLmljb24pLGdbal0ubGlfYXR0ciE9PWImJlwib2JqZWN0XCI9PXR5cGVvZiBnW2pdLmxpX2F0dHIpZm9yKGsgaW4gZ1tqXS5saV9hdHRyKWlmKGdbal0ubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShrKSl7aWYoXCJpZFwiPT09ayljb250aW51ZTtlW2ZbaF1dLmxpX2F0dHJba109PT1iP2VbZltoXV0ubGlfYXR0cltrXT1nW2pdLmxpX2F0dHJba106XCJjbGFzc1wiPT09ayYmKGVbZltoXV0ubGlfYXR0cltcImNsYXNzXCJdPWdbal0ubGlfYXR0cltcImNsYXNzXCJdK1wiIFwiK2VbZltoXV0ubGlfYXR0cltcImNsYXNzXCJdKX1pZihnW2pdLmFfYXR0ciE9PWImJlwib2JqZWN0XCI9PXR5cGVvZiBnW2pdLmFfYXR0cilmb3IoayBpbiBnW2pdLmFfYXR0cilpZihnW2pdLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShrKSl7aWYoXCJpZFwiPT09ayljb250aW51ZTtlW2ZbaF1dLmFfYXR0cltrXT09PWI/ZVtmW2hdXS5hX2F0dHJba109Z1tqXS5hX2F0dHJba106XCJocmVmXCI9PT1rJiZcIiNcIj09PWVbZltoXV0uYV9hdHRyW2tdP2VbZltoXV0uYV9hdHRyLmhyZWY9Z1tqXS5hX2F0dHIuaHJlZjpcImNsYXNzXCI9PT1rJiYoZVtmW2hdXS5hX2F0dHJbXCJjbGFzc1wiXT1nW2pdLmFfYXR0cltcImNsYXNzXCJdK1wiIFwiK2VbZltoXV0uYV9hdHRyW1wiY2xhc3NcIl0pfX1lW2EuanN0cmVlLnJvb3RdLnR5cGU9YS5qc3RyZWUucm9vdH0sdGhpcykpLGQuYmluZC5jYWxsKHRoaXMpfSx0aGlzLmdldF9qc29uPWZ1bmN0aW9uKGIsYyxlKXt2YXIgZixnLGg9dGhpcy5fbW9kZWwuZGF0YSxpPWM/YS5leHRlbmQoITAse30sYyx7bm9faWQ6ITF9KTp7fSxqPWQuZ2V0X2pzb24uY2FsbCh0aGlzLGIsaSxlKTtpZihqPT09ITEpcmV0dXJuITE7aWYoYS5pc0FycmF5KGopKWZvcihmPTAsZz1qLmxlbmd0aDtnPmY7ZisrKWpbZl0udHlwZT1qW2ZdLmlkJiZoW2pbZl0uaWRdJiZoW2pbZl0uaWRdLnR5cGU/aFtqW2ZdLmlkXS50eXBlOlwiZGVmYXVsdFwiLGMmJmMubm9faWQmJihkZWxldGUgaltmXS5pZCxqW2ZdLmxpX2F0dHImJmpbZl0ubGlfYXR0ci5pZCYmZGVsZXRlIGpbZl0ubGlfYXR0ci5pZCxqW2ZdLmFfYXR0ciYmaltmXS5hX2F0dHIuaWQmJmRlbGV0ZSBqW2ZdLmFfYXR0ci5pZCk7ZWxzZSBqLnR5cGU9ai5pZCYmaFtqLmlkXSYmaFtqLmlkXS50eXBlP2hbai5pZF0udHlwZTpcImRlZmF1bHRcIixjJiZjLm5vX2lkJiYoaj10aGlzLl9kZWxldGVfaWRzKGopKTtyZXR1cm4gan0sdGhpcy5fZGVsZXRlX2lkcz1mdW5jdGlvbihiKXtpZihhLmlzQXJyYXkoYikpe2Zvcih2YXIgYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyliW2NdPXRoaXMuX2RlbGV0ZV9pZHMoYltjXSk7cmV0dXJuIGJ9cmV0dXJuIGRlbGV0ZSBiLmlkLGIubGlfYXR0ciYmYi5saV9hdHRyLmlkJiZkZWxldGUgYi5saV9hdHRyLmlkLGIuYV9hdHRyJiZiLmFfYXR0ci5pZCYmZGVsZXRlIGIuYV9hdHRyLmlkLGIuY2hpbGRyZW4mJmEuaXNBcnJheShiLmNoaWxkcmVuKSYmKGIuY2hpbGRyZW49dGhpcy5fZGVsZXRlX2lkcyhiLmNoaWxkcmVuKSksYn0sdGhpcy5jaGVjaz1mdW5jdGlvbihjLGUsZixnLGgpe2lmKGQuY2hlY2suY2FsbCh0aGlzLGMsZSxmLGcsaCk9PT0hMSlyZXR1cm4hMTtlPWUmJmUuaWQ/ZTp0aGlzLmdldF9ub2RlKGUpLGY9ZiYmZi5pZD9mOnRoaXMuZ2V0X25vZGUoZik7dmFyIGk9ZSYmZS5pZD9oJiZoLm9yaWdpbj9oLm9yaWdpbjphLmpzdHJlZS5yZWZlcmVuY2UoZS5pZCk6bnVsbCxqLGssbCxtO3N3aXRjaChpPWkmJmkuX21vZGVsJiZpLl9tb2RlbC5kYXRhP2kuX21vZGVsLmRhdGE6bnVsbCxjKXtjYXNlXCJjcmVhdGVfbm9kZVwiOmNhc2VcIm1vdmVfbm9kZVwiOmNhc2VcImNvcHlfbm9kZVwiOmlmKFwibW92ZV9ub2RlXCIhPT1jfHwtMT09PWEuaW5BcnJheShlLmlkLGYuY2hpbGRyZW4pKXtpZihqPXRoaXMuZ2V0X3J1bGVzKGYpLGoubWF4X2NoaWxkcmVuIT09YiYmLTEhPT1qLm1heF9jaGlsZHJlbiYmai5tYXhfY2hpbGRyZW49PT1mLmNoaWxkcmVuLmxlbmd0aClyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ0eXBlc1wiLGlkOlwidHlwZXNfMDFcIixyZWFzb246XCJtYXhfY2hpbGRyZW4gcHJldmVudHMgZnVuY3Rpb246IFwiK2MsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmMscG9zOmcsb2JqOmUmJmUuaWQ/ZS5pZDohMSxwYXI6ZiYmZi5pZD9mLmlkOiExfSl9LCExO2lmKGoudmFsaWRfY2hpbGRyZW4hPT1iJiYtMSE9PWoudmFsaWRfY2hpbGRyZW4mJi0xPT09YS5pbkFycmF5KGUudHlwZXx8XCJkZWZhdWx0XCIsai52YWxpZF9jaGlsZHJlbikpcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAyXCIscmVhc29uOlwidmFsaWRfY2hpbGRyZW4gcHJldmVudHMgZnVuY3Rpb246IFwiK2MsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmMscG9zOmcsb2JqOmUmJmUuaWQ/ZS5pZDohMSxwYXI6ZiYmZi5pZD9mLmlkOiExfSl9LCExO2lmKGkmJmUuY2hpbGRyZW5fZCYmZS5wYXJlbnRzKXtmb3Ioaz0wLGw9MCxtPWUuY2hpbGRyZW5fZC5sZW5ndGg7bT5sO2wrKylrPU1hdGgubWF4KGssaVtlLmNoaWxkcmVuX2RbbF1dLnBhcmVudHMubGVuZ3RoKTtrPWstZS5wYXJlbnRzLmxlbmd0aCsxfSgwPj1rfHxrPT09YikmJihrPTEpO2Rve2lmKGoubWF4X2RlcHRoIT09YiYmLTEhPT1qLm1heF9kZXB0aCYmai5tYXhfZGVwdGg8aylyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ0eXBlc1wiLGlkOlwidHlwZXNfMDNcIixyZWFzb246XCJtYXhfZGVwdGggcHJldmVudHMgZnVuY3Rpb246IFwiK2MsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmMscG9zOmcsb2JqOmUmJmUuaWQ/ZS5pZDohMSxwYXI6ZiYmZi5pZD9mLmlkOiExfSl9LCExO2Y9dGhpcy5nZXRfbm9kZShmLnBhcmVudCksaj10aGlzLmdldF9ydWxlcyhmKSxrKyt9d2hpbGUoZil9fXJldHVybiEwfSx0aGlzLmdldF9ydWxlcz1mdW5jdGlvbihhKXtpZihhPXRoaXMuZ2V0X25vZGUoYSksIWEpcmV0dXJuITE7dmFyIGM9dGhpcy5nZXRfdHlwZShhLCEwKTtyZXR1cm4gYy5tYXhfZGVwdGg9PT1iJiYoYy5tYXhfZGVwdGg9LTEpLGMubWF4X2NoaWxkcmVuPT09YiYmKGMubWF4X2NoaWxkcmVuPS0xKSxjLnZhbGlkX2NoaWxkcmVuPT09YiYmKGMudmFsaWRfY2hpbGRyZW49LTEpLGN9LHRoaXMuZ2V0X3R5cGU9ZnVuY3Rpb24oYixjKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGI/Yz9hLmV4dGVuZCh7dHlwZTpiLnR5cGV9LHRoaXMuc2V0dGluZ3MudHlwZXNbYi50eXBlXSk6Yi50eXBlOiExfSx0aGlzLnNldF90eXBlPWZ1bmN0aW9uKGMsZCl7dmFyIGU9dGhpcy5fbW9kZWwuZGF0YSxmLGcsaCxpLGosayxsLG07aWYoYS5pc0FycmF5KGMpKXtmb3IoYz1jLnNsaWNlKCksZz0wLGg9Yy5sZW5ndGg7aD5nO2crKyl0aGlzLnNldF90eXBlKGNbZ10sZCk7cmV0dXJuITB9aWYoZj10aGlzLnNldHRpbmdzLnR5cGVzLGM9dGhpcy5nZXRfbm9kZShjKSwhZltkXXx8IWMpcmV0dXJuITE7aWYobD10aGlzLmdldF9ub2RlKGMsITApLGwmJmwubGVuZ3RoJiYobT1sLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikpLGk9Yy50eXBlLGo9dGhpcy5nZXRfaWNvbihjKSxjLnR5cGU9ZCwoaj09PSEwfHxmW2ldJiZmW2ldLmljb24hPT1iJiZqPT09ZltpXS5pY29uKSYmdGhpcy5zZXRfaWNvbihjLGZbZF0uaWNvbiE9PWI/ZltkXS5pY29uOiEwKSxmW2ldLmxpX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltpXS5saV9hdHRyKWZvcihrIGluIGZbaV0ubGlfYXR0cilpZihmW2ldLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7XCJjbGFzc1wiPT09az8oZVtjLmlkXS5saV9hdHRyW1wiY2xhc3NcIl09KGVbYy5pZF0ubGlfYXR0cltcImNsYXNzXCJdfHxcIlwiKS5yZXBsYWNlKGZbaV0ubGlfYXR0cltrXSxcIlwiKSxsJiZsLnJlbW92ZUNsYXNzKGZbaV0ubGlfYXR0cltrXSkpOmVbYy5pZF0ubGlfYXR0cltrXT09PWZbaV0ubGlfYXR0cltrXSYmKGVbYy5pZF0ubGlfYXR0cltrXT1udWxsLGwmJmwucmVtb3ZlQXR0cihrKSl9aWYoZltpXS5hX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltpXS5hX2F0dHIpZm9yKGsgaW4gZltpXS5hX2F0dHIpaWYoZltpXS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7XCJjbGFzc1wiPT09az8oZVtjLmlkXS5hX2F0dHJbXCJjbGFzc1wiXT0oZVtjLmlkXS5hX2F0dHJbXCJjbGFzc1wiXXx8XCJcIikucmVwbGFjZShmW2ldLmFfYXR0cltrXSxcIlwiKSxtJiZtLnJlbW92ZUNsYXNzKGZbaV0uYV9hdHRyW2tdKSk6ZVtjLmlkXS5hX2F0dHJba109PT1mW2ldLmFfYXR0cltrXSYmKFwiaHJlZlwiPT09az8oZVtjLmlkXS5hX2F0dHJba109XCIjXCIsbSYmbS5hdHRyKFwiaHJlZlwiLFwiI1wiKSk6KGRlbGV0ZSBlW2MuaWRdLmFfYXR0cltrXSxtJiZtLnJlbW92ZUF0dHIoaykpKX1pZihmW2RdLmxpX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltkXS5saV9hdHRyKWZvcihrIGluIGZbZF0ubGlfYXR0cilpZihmW2RdLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtjLmlkXS5saV9hdHRyW2tdPT09Yj8oZVtjLmlkXS5saV9hdHRyW2tdPWZbZF0ubGlfYXR0cltrXSxsJiYoXCJjbGFzc1wiPT09az9sLmFkZENsYXNzKGZbZF0ubGlfYXR0cltrXSk6bC5hdHRyKGssZltkXS5saV9hdHRyW2tdKSkpOlwiY2xhc3NcIj09PWsmJihlW2MuaWRdLmxpX2F0dHJbXCJjbGFzc1wiXT1mW2RdLmxpX2F0dHJba10rXCIgXCIrZVtjLmlkXS5saV9hdHRyW1wiY2xhc3NcIl0sbCYmbC5hZGRDbGFzcyhmW2RdLmxpX2F0dHJba10pKX1pZihmW2RdLmFfYXR0ciE9PWImJlwib2JqZWN0XCI9PXR5cGVvZiBmW2RdLmFfYXR0cilmb3IoayBpbiBmW2RdLmFfYXR0cilpZihmW2RdLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShrKSl7aWYoXCJpZFwiPT09ayljb250aW51ZTtlW2MuaWRdLmFfYXR0cltrXT09PWI/KGVbYy5pZF0uYV9hdHRyW2tdPWZbZF0uYV9hdHRyW2tdLG0mJihcImNsYXNzXCI9PT1rP20uYWRkQ2xhc3MoZltkXS5hX2F0dHJba10pOm0uYXR0cihrLGZbZF0uYV9hdHRyW2tdKSkpOlwiaHJlZlwiPT09ayYmXCIjXCI9PT1lW2MuaWRdLmFfYXR0cltrXT8oZVtjLmlkXS5hX2F0dHIuaHJlZj1mW2RdLmFfYXR0ci5ocmVmLG0mJm0uYXR0cihcImhyZWZcIixmW2RdLmFfYXR0ci5ocmVmKSk6XCJjbGFzc1wiPT09ayYmKGVbYy5pZF0uYV9hdHRyW1wiY2xhc3NcIl09ZltkXS5hX2F0dHJbXCJjbGFzc1wiXStcIiBcIitlW2MuaWRdLmFfYXR0cltcImNsYXNzXCJdLG0mJm0uYWRkQ2xhc3MoZltkXS5hX2F0dHJba10pKX1yZXR1cm4hMH19LGEuanN0cmVlLmRlZmF1bHRzLnVuaXF1ZT17Y2FzZV9zZW5zaXRpdmU6ITEsZHVwbGljYXRlOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGErXCIgKFwiK2IrXCIpXCJ9fSxhLmpzdHJlZS5wbHVnaW5zLnVuaXF1ZT1mdW5jdGlvbihjLGQpe3RoaXMuY2hlY2s9ZnVuY3Rpb24oYixjLGUsZixnKXtpZihkLmNoZWNrLmNhbGwodGhpcyxiLGMsZSxmLGcpPT09ITEpcmV0dXJuITE7aWYoYz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSxlPWUmJmUuaWQ/ZTp0aGlzLmdldF9ub2RlKGUpLCFlfHwhZS5jaGlsZHJlbilyZXR1cm4hMDt2YXIgaD1cInJlbmFtZV9ub2RlXCI9PT1iP2Y6Yy50ZXh0LGk9W10saj10aGlzLnNldHRpbmdzLnVuaXF1ZS5jYXNlX3NlbnNpdGl2ZSxrPXRoaXMuX21vZGVsLmRhdGEsbCxtO2ZvcihsPTAsbT1lLmNoaWxkcmVuLmxlbmd0aDttPmw7bCsrKWkucHVzaChqP2tbZS5jaGlsZHJlbltsXV0udGV4dDprW2UuY2hpbGRyZW5bbF1dLnRleHQudG9Mb3dlckNhc2UoKSk7c3dpdGNoKGp8fChoPWgudG9Mb3dlckNhc2UoKSksYil7Y2FzZVwiZGVsZXRlX25vZGVcIjpyZXR1cm4hMDtjYXNlXCJyZW5hbWVfbm9kZVwiOnJldHVybiBsPS0xPT09YS5pbkFycmF5KGgsaSl8fGMudGV4dCYmYy50ZXh0W2o/XCJ0b1N0cmluZ1wiOlwidG9Mb3dlckNhc2VcIl0oKT09PWgsbHx8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDFcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIraCtcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZixvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjplJiZlLmlkP2UuaWQ6ITF9KX0pLGw7Y2FzZVwiY3JlYXRlX25vZGVcIjpyZXR1cm4gbD0tMT09PWEuaW5BcnJheShoLGkpLGx8fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzA0XCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2grXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmYsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZSYmZS5pZD9lLmlkOiExfSl9KSxsO2Nhc2VcImNvcHlfbm9kZVwiOnJldHVybiBsPS0xPT09YS5pbkFycmF5KGgsaSksbHx8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDJcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIraCtcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZixvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjplJiZlLmlkP2UuaWQ6ITF9KX0pLGw7Y2FzZVwibW92ZV9ub2RlXCI6cmV0dXJuIGw9Yy5wYXJlbnQ9PT1lLmlkJiYoIWd8fCFnLmlzX211bHRpKXx8LTE9PT1hLmluQXJyYXkoaCxpKSxsfHwodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ1bmlxdWVcIixpZDpcInVuaXF1ZV8wM1wiLHJlYXNvbjpcIkNoaWxkIHdpdGggbmFtZSBcIitoK1wiIGFscmVhZHkgZXhpc3RzLiBQcmV2ZW50aW5nOiBcIitiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpiLHBvczpmLG9iajpjJiZjLmlkP2MuaWQ6ITEscGFyOmUmJmUuaWQ/ZS5pZDohMX0pfSksbH1yZXR1cm4hMH0sdGhpcy5jcmVhdGVfbm9kZT1mdW5jdGlvbihjLGUsZixnLGgpe2lmKCFlfHxlLnRleHQ9PT1iKXtpZihudWxsPT09YyYmKGM9YS5qc3RyZWUucm9vdCksYz10aGlzLmdldF9ub2RlKGMpLCFjKXJldHVybiBkLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxjLGUsZixnLGgpO2lmKGY9Zj09PWI/XCJsYXN0XCI6ZiwhZi50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFoJiYhdGhpcy5pc19sb2FkZWQoYykpcmV0dXJuIGQuY3JlYXRlX25vZGUuY2FsbCh0aGlzLGMsZSxmLGcsaCk7XG5lfHwoZT17fSk7dmFyIGksaixrLGwsbSxuPXRoaXMuX21vZGVsLmRhdGEsbz10aGlzLnNldHRpbmdzLnVuaXF1ZS5jYXNlX3NlbnNpdGl2ZSxwPXRoaXMuc2V0dGluZ3MudW5pcXVlLmR1cGxpY2F0ZTtmb3Ioaj1pPXRoaXMuZ2V0X3N0cmluZyhcIk5ldyBub2RlXCIpLGs9W10sbD0wLG09Yy5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKylrLnB1c2gobz9uW2MuY2hpbGRyZW5bbF1dLnRleHQ6bltjLmNoaWxkcmVuW2xdXS50ZXh0LnRvTG93ZXJDYXNlKCkpO2w9MTt3aGlsZSgtMSE9PWEuaW5BcnJheShvP2o6ai50b0xvd2VyQ2FzZSgpLGspKWo9cC5jYWxsKHRoaXMsaSwrK2wpLnRvU3RyaW5nKCk7ZS50ZXh0PWp9cmV0dXJuIGQuY3JlYXRlX25vZGUuY2FsbCh0aGlzLGMsZSxmLGcsaCl9fTt2YXIgcT1pLmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7aWYocS5zZXRBdHRyaWJ1dGUoXCJ1bnNlbGVjdGFibGVcIixcIm9uXCIpLHEuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLHEuY2xhc3NOYW1lPVwianN0cmVlLXdob2xlcm93XCIscS5pbm5lckhUTUw9XCImIzE2MDtcIixhLmpzdHJlZS5wbHVnaW5zLndob2xlcm93PWZ1bmN0aW9uKGIsYyl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7Yy5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKFwicmVhZHkuanN0cmVlIHNldF9zdGF0ZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5oaWRlX2RvdHMoKX0sdGhpcykpLm9uKFwiaW5pdC5qc3RyZWUgbG9hZGluZy5qc3RyZWUgcmVhZHkuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LXVsXCIpfSx0aGlzKSkub24oXCJkZXNlbGVjdF9hbGwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImNoYW5nZWQuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIik7dmFyIGM9ITEsZCxlO2ZvcihkPTAsZT1iLnNlbGVjdGVkLmxlbmd0aDtlPmQ7ZCsrKWM9dGhpcy5nZXRfbm9kZShiLnNlbGVjdGVkW2RdLCEwKSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtd2hvbGVyb3dcIikuYWRkQ2xhc3MoXCJqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwib3Blbl9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLmdldF9ub2RlKGIubm9kZSwhMCkuZmluZChcIi5qc3RyZWUtY2xpY2tlZFwiKS5wYXJlbnQoKS5jaGlsZHJlbihcIi5qc3RyZWUtd2hvbGVyb3dcIikuYWRkQ2xhc3MoXCJqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwiaG92ZXJfbm9kZS5qc3RyZWUgZGVob3Zlcl9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXtcImhvdmVyX25vZGVcIj09PWEudHlwZSYmdGhpcy5pc19kaXNhYmxlZChiLm5vZGUpfHx0aGlzLmdldF9ub2RlKGIubm9kZSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpW1wiaG92ZXJfbm9kZVwiPT09YS50eXBlP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLXdob2xlcm93LWhvdmVyZWRcIil9LHRoaXMpKS5vbihcImNvbnRleHRtZW51LmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvd1wiLGEucHJveHkoZnVuY3Rpb24oYil7aWYodGhpcy5fZGF0YS5jb250ZXh0bWVudSl7Yi5wcmV2ZW50RGVmYXVsdCgpO3ZhciBjPWEuRXZlbnQoXCJjb250ZXh0bWVudVwiLHttZXRhS2V5OmIubWV0YUtleSxjdHJsS2V5OmIuY3RybEtleSxhbHRLZXk6Yi5hbHRLZXksc2hpZnRLZXk6Yi5zaGlmdEtleSxwYWdlWDpiLnBhZ2VYLHBhZ2VZOmIucGFnZVl9KTthKGIuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihjKX19LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvd1wiLGZ1bmN0aW9uKGIpe2Iuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7dmFyIGM9YS5FdmVudChcImNsaWNrXCIse21ldGFLZXk6Yi5tZXRhS2V5LGN0cmxLZXk6Yi5jdHJsS2V5LGFsdEtleTpiLmFsdEtleSxzaGlmdEtleTpiLnNoaWZ0S2V5fSk7YShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoYykuZm9jdXMoKX0pLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWxlYWYgPiAuanN0cmVlLW9jbFwiLGEucHJveHkoZnVuY3Rpb24oYil7Yi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTt2YXIgYz1hLkV2ZW50KFwiY2xpY2tcIix7bWV0YUtleTpiLm1ldGFLZXksY3RybEtleTpiLmN0cmxLZXksYWx0S2V5OmIuYWx0S2V5LHNoaWZ0S2V5OmIuc2hpZnRLZXl9KTthKGIuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihjKS5mb2N1cygpfSx0aGlzKSkub24oXCJtb3VzZW92ZXIuanN0cmVlXCIsXCIuanN0cmVlLXdob2xlcm93LCAuanN0cmVlLWljb25cIixhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiBhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHRoaXMuaXNfZGlzYWJsZWQoYS5jdXJyZW50VGFyZ2V0KXx8dGhpcy5ob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCksITF9LHRoaXMpKS5vbihcIm1vdXNlbGVhdmUuanN0cmVlXCIsXCIuanN0cmVlLW5vZGVcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuZGVob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCl9LHRoaXMpKX0sdGhpcy50ZWFyZG93bj1mdW5jdGlvbigpe3RoaXMuc2V0dGluZ3Mud2hvbGVyb3cmJnRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvd1wiKS5yZW1vdmUoKSxjLnRlYXJkb3duLmNhbGwodGhpcyl9LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oYixkLGUsZil7aWYoYj1jLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl7dmFyIGc9cS5jbG9uZU5vZGUoITApOy0xIT09YS5pbkFycmF5KGIuaWQsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkKSYmKGcuY2xhc3NOYW1lKz1cIiBqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKSx0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCYmdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9PT1iLmlkJiYoZy5jbGFzc05hbWUrPVwiIGpzdHJlZS13aG9sZXJvdy1ob3ZlcmVkXCIpLGIuaW5zZXJ0QmVmb3JlKGcsYi5jaGlsZE5vZGVzWzBdKX1yZXR1cm4gYn19LGkucmVnaXN0ZXJFbGVtZW50JiZPYmplY3QmJk9iamVjdC5jcmVhdGUpe3ZhciByPU9iamVjdC5jcmVhdGUoSFRNTEVsZW1lbnQucHJvdG90eXBlKTtyLmNyZWF0ZWRDYWxsYmFjaz1mdW5jdGlvbigpe3ZhciBiPXtjb3JlOnt9LHBsdWdpbnM6W119LGM7Zm9yKGMgaW4gYS5qc3RyZWUucGx1Z2lucylhLmpzdHJlZS5wbHVnaW5zLmhhc093blByb3BlcnR5KGMpJiZ0aGlzLmF0dHJpYnV0ZXNbY10mJihiLnBsdWdpbnMucHVzaChjKSx0aGlzLmdldEF0dHJpYnV0ZShjKSYmSlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZShjKSkmJihiW2NdPUpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoYykpKSk7Zm9yKGMgaW4gYS5qc3RyZWUuZGVmYXVsdHMuY29yZSlhLmpzdHJlZS5kZWZhdWx0cy5jb3JlLmhhc093blByb3BlcnR5KGMpJiZ0aGlzLmF0dHJpYnV0ZXNbY10mJihiLmNvcmVbY109SlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZShjKSl8fHRoaXMuZ2V0QXR0cmlidXRlKGMpKTthKHRoaXMpLmpzdHJlZShiKX07dHJ5e2kucmVnaXN0ZXJFbGVtZW50KFwidmFrYXRhLWpzdHJlZVwiLHtwcm90b3R5cGU6cn0pfWNhdGNoKHMpe319fX0pO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL2Ntcy9zdGF0aWMvY21zL2pzL2xpYnMvanN0cmVlL2pzdHJlZS5taW4uanNcbiAqKiBtb2R1bGUgaWQgPSA5XG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iLCIvKlxuICogaHR0cHM6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZFxuICpcbiAqIFRoaXMgcGx1Z2luIGhhbmRsZXMgYWRkaW5nIGEgZ3JpZCB0byBhIHRyZWUgdG8gZGlzcGxheSBhZGRpdGlvbmFsIGRhdGFcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2U6XG4gKiAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG4gKlxuICogV29ya3Mgb25seSB3aXRoIGpzdHJlZSB2ZXJzaW9uID49IDMuMC4wXG4gKlxuICogJERhdGU6IDIwMTUtMTEtMjkgJFxuICogJFJldmlzaW9uOiAgMy40LjIgJFxuICpcbiAqICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISFcbiAqICEhISAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhISFcbiAqICEhISAgIElNUE9SVEFOVCBpdCBzYXlzIDMuNC4yIGJ1dCBpdCdzIGFjdHVhbGx5IDMuNC40LCBhbmQgaXQncyBtb2RpZmllZCEgICAhISFcbiAqICEhISAgIGxpbmUgNjQ2LCBzYW1lIGFzOiBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkL3B1bGwvMTY1ICAgICAhISFcbiAqICEhISAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhISFcbiAqICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISFcbiAqL1xuXG4vKmpzbGludCBub21lbjp0cnVlICovXG4vKmpzaGludCB1bnVzZWQ6dmFycyAqL1xuLypnbG9iYWwgbmF2aWdhdG9yLCBkb2N1bWVudCwgalF1ZXJ5LCBkZWZpbmUgKi9cblxuLyogQU1EIHN1cHBvcnQgYWRkZWQgYnkgam9jaGVuYmVyZ2VyIHBlciBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkL3B1bGwvNDlcbiAqXG4gKi9cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLlxuICAgICAgICBkZWZpbmUoWydqcXVlcnknLCAnanN0cmVlJ10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEJyb3dzZXIgZ2xvYmFsc1xuICAgICAgICBmYWN0b3J5KGpRdWVyeSk7XG4gICAgfVxufShmdW5jdGlvbiAoJCkge1xuICAgIHZhciByZW5kZXJBV2lkdGgsIHJlbmRlckFUaXRsZSwgZ2V0SW5kZW50LCBodG1sc3RyaXByZSwgZmluZExhc3RDbG9zZWROb2RlLCBCTEFOS1JFID0gL15cXHMqJC9nLFxuICAgICAgICBJRFJFR0VYID0gL1tcXFxcOiYhXnwoKVxcW1xcXTw+QConK34jXCI7LD0gXFwvJHt9JV0vZywgZXNjYXBlSWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAoaWR8fFwiXCIpLnJlcGxhY2UoSURSRUdFWCwnXFxcXCQmJyk7XG4gICAgICAgIH0sIE5PREVfREFUQV9BVFRSID0gXCJkYXRhLWpzdHJlZWdyaWRcIixcbiAgICBTUEVDSUFMX1RJVExFID0gXCJfREFUQV9cIiwgTEVWRUxJTkRFTlQgPSAyNCwgc3R5bGVkID0gZmFsc2UsIEdSSURDRUxMSURfUFJFRklYID0gXCJqc2dyaWRfXCIsR1JJRENFTExJRF9QT1NURklYID0gXCJfY29sXCIsXG4gICAgICAgIGZpbmREYXRhQ2VsbCA9IGZ1bmN0aW9uIChmcm9tLGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZnJvbS5maW5kKFwiZGl2W1wiK05PREVfREFUQV9BVFRSK1wiPSdcIitpZCtcIiddXCIpO1xuICAgICAgICB9LFxuICAgICAgICBpc0NsaWNrZWRTZXAgPSBmYWxzZSwgdG9SZXNpemUgPSBudWxsLCBvbGRNb3VzZVggPSAwLCBuZXdNb3VzZVggPSAwO1xuXG4gICAgLypqc2xpbnQgcmVnZXhwOnRydWUgKi9cbiAgICBodG1sc3RyaXByZSA9IC88XFwvP1tePl0rPi9naTtcbiAgICAvKmpzbGludCByZWdleHA6ZmFsc2UgKi9cblxuICAgIGdldEluZGVudCA9IGZ1bmN0aW9uKG5vZGUsdHJlZSkge1xuICAgICAgICB2YXIgZGl2LCBpLCBsaSwgd2lkdGg7XG5cbiAgICAgICAgLy8gZGlkIHdlIGFscmVhZHkgc2F2ZSBpdCBmb3IgdGhpcyB0cmVlP1xuICAgICAgICB0cmVlLl9ncmlkU2V0dGluZ3MgPSB0cmVlLl9ncmlkU2V0dGluZ3MgfHwge307XG4gICAgICAgIGlmICh0cmVlLl9ncmlkU2V0dGluZ3MuaW5kZW50ID4gMCkge1xuICAgICAgICAgICAgd2lkdGggPSB0cmVlLl9ncmlkU2V0dGluZ3MuaW5kZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY3JlYXRlIGEgbmV3IGRpdiBvbiB0aGUgRE9NIGJ1dCBub3QgdmlzaWJsZSBvbiB0aGUgcGFnZVxuICAgICAgICAgICAgZGl2ID0gJChcIjxkaXY+PC9kaXY+XCIpO1xuICAgICAgICAgICAgaSA9IG5vZGUucHJldihcImlcIik7XG4gICAgICAgICAgICBsaSA9IGkucGFyZW50KCk7XG4gICAgICAgICAgICAvLyBhZGQgdG8gdGhhdCBkaXYgYWxsIG9mIHRoZSBjbGFzc2VzIG9uIHRoZSB0cmVlIHJvb3RcbiAgICAgICAgICAgIGRpdi5hZGRDbGFzcyh0cmVlLmdldF9ub2RlKFwiI1wiLHRydWUpLmF0dHIoXCJjbGFzc1wiKSk7XG5cbiAgICAgICAgICAgIC8vIG1vdmUgdGhlIGxpIHRvIHRoZSB0ZW1wb3JhcnkgZGl2IHJvb3RcbiAgICAgICAgICAgIGxpLmFwcGVuZFRvKGRpdik7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCB0byB0aGUgYm9keSBxdWlja2x5XG4gICAgICAgICAgICBkaXYuYXBwZW5kVG8oJChcImJvZHlcIikpO1xuXG4gICAgICAgICAgICAvLyBnZXQgdGhlIHdpZHRoXG4gICAgICAgICAgICB3aWR0aCA9IGkud2lkdGgoKSB8fCBMRVZFTElOREVOVDtcblxuICAgICAgICAgICAgLy8gZGV0YWNoIHRoZSBsaSBmcm9tIHRoZSBuZXcgZGl2IGFuZCBkZXN0cm95IHRoZSBuZXcgZGl2XG4gICAgICAgICAgICBsaS5kZXRhY2goKTtcbiAgICAgICAgICAgIGRpdi5yZW1vdmUoKTtcblxuICAgICAgICAgICAgLy8gc2F2ZSBpdCBmb3IgdGhlIGZ1dHVyZVxuICAgICAgICAgICAgdHJlZS5fZ3JpZFNldHRpbmdzLmluZGVudCA9IHdpZHRoO1xuICAgICAgICB9XG5cblxuICAgICAgICByZXR1cm4od2lkdGgpO1xuXG4gICAgfTtcblxuICAgIGZpbmRMYXN0Q2xvc2VkTm9kZSA9IGZ1bmN0aW9uICh0cmVlLGlkKSB7XG4gICAgICAgIC8vIGZpcnN0IGdldCBvdXIgbm9kZVxuICAgICAgICB2YXIgcmV0LCBub2RlID0gdHJlZS5nZXRfbm9kZShpZCksIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjtcbiAgICAgICAgLy8gaXMgaXQgY2xvc2VkP1xuICAgICAgICBpZiAoIWNoaWxkcmVuIHx8IGNoaWxkcmVuLmxlbmd0aCA8PSAwIHx8ICFub2RlLnN0YXRlLm9wZW5lZCkge1xuICAgICAgICAgICAgcmV0ID0gaWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXQgPSBmaW5kTGFzdENsb3NlZE5vZGUodHJlZSxjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGgtMV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybihyZXQpO1xuICAgIH07XG5cbiAgICByZW5kZXJBV2lkdGggPSBmdW5jdGlvbihub2RlLHRyZWUpIHtcbiAgICAgICAgdmFyIGRlcHRoLCB3aWR0aCxcbiAgICAgICAgZnVsbFdpZHRoID0gcGFyc2VJbnQodHJlZS5zZXR0aW5ncy5ncmlkLmNvbHVtbnNbMF0ud2lkdGgsMTApICsgcGFyc2VJbnQodHJlZS5fZ3JpZFNldHRpbmdzLnRyZWVXaWR0aERpZmYsMTApO1xuICAgICAgICAvLyBuZWVkIHRvIHVzZSBhIHNlbGVjdG9yIGluIGpxdWVyeSAxLjQuNCtcbiAgICAgICAgZGVwdGggPSB0cmVlLmdldF9ub2RlKG5vZGUpLnBhcmVudHMubGVuZ3RoO1xuICAgICAgICB3aWR0aCA9IGZ1bGxXaWR0aCAtIGRlcHRoKmdldEluZGVudChub2RlLHRyZWUpO1xuICAgICAgICAvLyB0aGUgZm9sbG93aW5nIGxpbmUgaXMgbm8gbG9uZ2VyIG5lZWRlZCwgc2luY2Ugd2UgYXJlIGRvaW5nIHRoaXMgaW5zaWRlIGEgPHRkPlxuICAgICAgICAvL2EuY3NzKHtcInZlcnRpY2FsLWFsaWduXCI6IFwidG9wXCIsIFwib3ZlcmZsb3dcIjpcImhpZGRlblwifSk7XG4gICAgICAgIHJldHVybihmdWxsV2lkdGgpO1xuICAgIH07XG4gICAgcmVuZGVyQVRpdGxlID0gZnVuY3Rpb24obm9kZSx0LHRyZWUpIHtcbiAgICAgICAgdmFyIGEgPSBub2RlLmdldCgwKS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiYVwiID8gbm9kZSA6IG5vZGUuY2hpbGRyZW4oXCJhXCIpLCB0aXRsZSwgY29sID0gdHJlZS5zZXR0aW5ncy5ncmlkLmNvbHVtbnNbMF07XG4gICAgICAgIC8vIGdldCB0aGUgdGl0bGVcbiAgICAgICAgdGl0bGUgPSBcIlwiO1xuICAgICAgICBpZiAoY29sLnRpdGxlKSB7XG4gICAgICAgICAgICBpZiAoY29sLnRpdGxlID09PSBTUEVDSUFMX1RJVExFKSB7XG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0cmVlLmdldF90ZXh0KHQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0LmF0dHIoY29sLnRpdGxlKSkge1xuICAgICAgICAgICAgICAgIHRpdGxlID0gdC5hdHRyKGNvbC50aXRsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3RyaXAgb3V0IEhUTUxcbiAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKGh0bWxzdHJpcHJlLCAnJyk7XG4gICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgYS5hdHRyKFwidGl0bGVcIix0aXRsZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5qc3RyZWUuZGVmYXVsdHMuZ3JpZCA9IHtcbiAgICAgICAgd2lkdGg6ICdhdXRvJ1xuICAgIH07XG5cbiAgICAkLmpzdHJlZS5wbHVnaW5zLmdyaWQgPSBmdW5jdGlvbihvcHRpb25zLHBhcmVudCkge1xuICAgICAgICB0aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gdGhpcy5zZXR0aW5ncy5ncmlkIHx8IHt9LCBzdHlsZXMsICAgIGNvbnRhaW5lciA9IHRoaXMuZWxlbWVudCwgZ3JpZHBhcmVudCA9IGNvbnRhaW5lci5wYXJlbnQoKSwgaSxcbiAgICAgICAgICAgICAgICBncyA9IHRoaXMuX2dyaWRTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucyA6IHMuY29sdW1ucyB8fCBbXSxcbiAgICAgICAgICAgICAgICAgICAgdHJlZUNsYXNzIDogXCJqc3RyZWUtZ3JpZC1jb2wtMFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBzLmNvbnRleHRtZW51IHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5XaWR0aCA6IHMuY29sdW1uV2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRDb25mIDoge1wiKmRpc3BsYXlcIjpcImlubGluZVwiLFwiKitkaXNwbGF5XCI6XCJpbmxpbmVcIn0sXG4gICAgICAgICAgICAgICAgICAgIGlzVGhlbWVyb2xsZXIgOiAhIXRoaXMuX2RhdGEudGhlbWVyb2xsZXIsXG4gICAgICAgICAgICAgICAgICAgIHRyZWVXaWR0aERpZmYgOiAwLFxuICAgICAgICAgICAgICAgICAgICByZXNpemFibGUgOiBzLnJlc2l6YWJsZSxcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50OiAwXG4gICAgICAgICAgICAgICAgfSwgY29scyA9IGdzLmNvbHVtbnMsIHRyZWVjb2wgPSAwO1xuICAgICAgICAgICAgICAgIC8vIGZpbmQgd2hpY2ggY29sdW1uIG91ciB0cmVlIHNodWxkIGdvIGluXG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTxzLmNvbHVtbnMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocy5jb2x1bW5zW2ldLnRyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNhdmUgd2hpY2ggY29sdW1uIGl0IHdhc1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJlZWNvbCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3QgY2hlY2sgYW55IG90aGVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gc2V0IGEgdW5pcXVlIElEIGZvciB0aGlzIHRhYmxlXG4gICAgICAgICAgICAgICAgdGhpcy51bmlxID0gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkqMTAwMCk7XG4gICAgICAgICAgICAgICAgdGhpcy50cmVlY29sID0gdHJlZWNvbDtcbiAgICAgICAgICAgICAgICB0aGlzLnJvb3RpZCA9IGNvbnRhaW5lci5hdHRyKFwiaWRcIik7XG5cbiAgICAgICAgICAgICAgICB2YXIgbXNpZSA9IC9tc2llLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgaWYgKG1zaWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZUZsb2F0KG5hdmlnYXRvci5hcHBWZXJzaW9uLnNwbGl0KFwiTVNJRVwiKVsxXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uIDwgOCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3MuZGVmYXVsdENvbmYuZGlzcGxheSA9IFwiaW5saW5lXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBncy5kZWZhdWx0Q29uZi56b29tID0gXCIxXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgdGhlIGNsYXNzZXMgd2UgbmVlZFxuICAgICAgICAgICAgICAgIGlmICghc3R5bGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtY2VsbCB7dmVydGljYWwtYWxpZ246IHRvcDsgb3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1sZWZ0OjA7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6IDEwMCU7cGFkZGluZy1sZWZ0OjdweDt3aGl0ZS1zcGFjZTogbm93cmFwO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jZWxsIHNwYW4ge21hcmdpbi1yaWdodDowcHg7bWFyZ2luLXJpZ2h0OjBweDsqZGlzcGxheTppbmxpbmU7KitkaXNwbGF5OmlubGluZTt3aGl0ZS1zcGFjZTogbm93cmFwO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1zZXBhcmF0b3Ige3Bvc2l0aW9uOnJlbGF0aXZlOyBoZWlnaHQ6MjRweDsgZmxvYXQ6cmlnaHQ7bWFyZ2luLWxlZnQ6IC0ycHg7IGJvcmRlci13aWR0aDogMCAycHggMCAwOyAqZGlzcGxheTppbmxpbmU7ICorZGlzcGxheTppbmxpbmU7IG1hcmdpbi1yaWdodDowcHg7d2lkdGg6MHB4O30nLFxuICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWhlYWRlci1jZWxsIHtvdmVyZmxvdzogaGlkZGVuOyB3aGl0ZS1zcGFjZTogbm93cmFwO3BhZGRpbmc6IDFweCAzcHggMnB4IDVweDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtaGVhZGVyLXRoZW1lcm9sbGVyIHtib3JkZXI6IDA7IHBhZGRpbmc6IDFweCAzcHg7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWhlYWRlci1yZWd1bGFyIHtiYWNrZ3JvdW5kLWNvbG9yOiAjRUJGM0ZEO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yIHtjdXJzb3I6IGNvbC1yZXNpemU7IHdpZHRoOiAycHg7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLXNlcGFyYXRvci1yZWd1bGFyIHtib3JkZXItY29sb3I6ICNkMGQwZDA7IGJvcmRlci1zdHlsZTogc29saWQ7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWNlbGwtdGhlbWVyb2xsZXIge2JvcmRlcjogbm9uZSAhaW1wb3J0YW50OyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudCAhaW1wb3J0YW50O30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC13cmFwcGVyIHt3aWR0aDogMTAwJTsgb3ZlcmZsb3cteDogYXV0bzt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtbWlkd3JhcHBlciB7ZGlzcGxheTogdGFibGUtcm93OyBvdmVyZmxvdzogdmlzaWJsZTt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtd2lkdGgtYXV0byB7d2lkdGg6YXV0bztkaXNwbGF5OmJsb2NrO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jb2x1bW4ge2Rpc3BsYXk6IHRhYmxlLWNlbGw7IG92ZXJmbG93OiBoaWRkZW47fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWNvbC0wIHt3aWR0aDogMTAwJTt9J1xuICAgICAgICAgICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICAgICAgICAgICQoJzxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj4nK3N0eWxlcy5qb2luKFwiXFxuXCIpKyc8L3N0eWxlPicpLmFwcGVuZFRvKFwiaGVhZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlciA9ICQoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdyYXBwZXJcIikuYXBwZW5kVG8oZ3JpZHBhcmVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5taWRXcmFwcGVyID0gJChcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwianN0cmVlLWdyaWQtbWlkd3JhcHBlclwiKS5hcHBlbmRUbyh0aGlzLmdyaWRXcmFwcGVyKTtcbiAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHdyYXBwZXIgd2lkdGhcbiAgICAgICAgICAgICAgICBpZiAocy53aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRXcmFwcGVyLndpZHRoKHMud2lkdGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGRhdGEgY29sdW1uc1xuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgY29sdW1uXG4gICAgICAgICAgICAgICAgICAgICQoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNvbHVtbiBqc3RyZWUtZ3JpZC1jb2x1bW4tXCIraStcIiBqc3RyZWUtZ3JpZC1jb2x1bW4tcm9vdC1cIit0aGlzLnJvb3RpZCkuYXBwZW5kVG8odGhpcy5taWRXcmFwcGVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5taWRXcmFwcGVyLmNoaWxkcmVuKFwiZGl2OmVxKFwiK3RyZWVjb2wrXCIpXCIpLmFwcGVuZChjb250YWluZXIpO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGxcIik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaW5pdCA9IGZ1bmN0aW9uIChlbCxvcHRpb25zKSB7XG4gICAgICAgICAgICBwYXJlbnQuaW5pdC5jYWxsKHRoaXMsZWwsb3B0aW9ucyk7XG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmluZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHBhcmVudC5iaW5kLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplKCk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIC5vbihcIm1vdmVfbm9kZS5qc3RyZWUgY3JlYXRlX25vZGUuanN0cmVlIGNsZWFuX25vZGUuanN0cmVlIGNoYW5nZV9ub2RlLmpzdHJlZVwiLCAkLnByb3h5KGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0X25vZGUoZGF0YSB8fCBcIiNcIix0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlX2dyaWQodGFyZ2V0KTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVsZXRlX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubm9kZS5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBncmlkID0gdGhpcy5ncmlkV3JhcHBlciwgcmVtb3ZlTm9kZXMgPSBbZGF0YS5ub2RlLmlkXSwgaTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGNoaWxkcmVuIHRvIHJlbW92ZSBsaXN0XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm5vZGUgJiYgZGF0YS5ub2RlLmNoaWxkcmVuX2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZU5vZGVzID0gcmVtb3ZlTm9kZXMuY29uY2F0KGRhdGEubm9kZS5jaGlsZHJlbl9kKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPHJlbW92ZU5vZGVzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbChncmlkLHJlbW92ZU5vZGVzW2ldKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiY2xvc2Vfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uIChlLGRhdGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlX2dyaWQoZGF0YS5ub2RlKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwib3Blbl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgfSwgdGhpcykpXG4gICAgICAgICAgICAub24oXCJsb2FkX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImxvYWRlZC5qc3RyZWVcIiwgJC5wcm94eShmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ByZXBhcmVfaGVhZGVycygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKFwibG9hZGVkX2dyaWQuanN0cmVlXCIpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwicmVhZHkuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgbGluZS1oZWlnaHQgb2YgdGhlIGZpcnN0IGtub3duIG5vZGVcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9ySGVpZ2h0ID0gdGhpcy5lbGVtZW50LmZpbmQoXCJsaSBhOmZpcnN0XCIpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgJCgnPHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPmRpdi5qc3RyZWUtZ3JpZC1jZWxsLXJvb3QtJyt0aGlzLnJvb3RpZCsnIHtsaW5lLWhlaWdodDogJythbmNob3JIZWlnaHQrJ3B4fTwvc3R5bGU+JykuYXBwZW5kVG8oXCJoZWFkXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gYWRkIGNvbnRhaW5lciBjbGFzc2VzIHRvIHRoZSB3cmFwcGVyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQuYXR0cihcImNsYXNzXCIpKTtcblxuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcIm1vdmVfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBkYXRhLm5ld19pbnN0YW5jZS5lbGVtZW50O1xuICAgICAgICAgICAgICAgIC8vcmVuZGVyQVdpZHRoKG5vZGUsdGhpcyk7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgYWxsIHRoZSBjaGlsZHJlbiwgYmVjYXVzZSB3ZSBjb3VsZCBkcmFnIGEgdHJlZSBvdmVyXG4gICAgICAgICAgICAgICAgbm9kZS5maW5kKFwibGkgPiBhXCIpLmVhY2goJC5wcm94eShmdW5jdGlvbihpLGVsbSl7XG4gICAgICAgICAgICAgICAgICAgIC8vcmVuZGVyQVdpZHRoKCQoZWxtKSx0aGlzKTtcbiAgICAgICAgICAgICAgICB9LHRoaXMpKTtcblxuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImhvdmVyX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihub2RlLHNlbGVjdGVkLGV2ZW50KXtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBzZWxlY3RlZC5ub2RlLmlkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ob3Zlcl9ub2RlICE9PSBudWxsICYmIHRoaXMuX2hvdmVyX25vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcix0aGlzLl9ob3Zlcl9ub2RlKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9ob3Zlcl9ub2RlID0gaWQ7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLmFkZENsYXNzKFwianN0cmVlLWhvdmVyZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc2VsZWN0ZWQubm9kZS5pZDtcbiAgICAgICAgICAgICAgICB0aGlzLl9ob3Zlcl9ub2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixpZCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKTtcbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKG5vZGUsc2VsZWN0ZWQsZXZlbnQpe1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHNlbGVjdGVkLm5vZGUuaWQ7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLmFkZENsYXNzKFwianN0cmVlLWNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRfbm9kZShzZWxlY3RlZC5ub2RlLmlkLHRydWUpLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGxcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKTtcbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJkZXNlbGVjdF9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc2VsZWN0ZWQubm9kZS5pZDtcbiAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixpZCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKTtcbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJkZXNlbGVjdF9hbGwuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihub2RlLHNlbGVjdGVkLGV2ZW50KXtcbiAgICAgICAgICAgICAgICAvLyBnZXQgYWxsIG9mIHRoZSBpZHMgdGhhdCB3ZXJlIHVuc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICB2YXIgaWRzID0gc2VsZWN0ZWQubm9kZSB8fCBbXSwgaTtcbiAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPGlkcy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGlkc1tpXSkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwic2VhcmNoLmpzdHJlZVwiLCAkLnByb3h5KGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gc2VhcmNoIHNvbWV0aW1lcyBmaWx0ZXJzLCBzbyB3ZSBuZWVkIHRvIGhpZGUgYWxsIG9mIHRoZSBhcHByb3ByaWF0ZSBncmlkIGNlbGxzIGFzIHdlbGwsIGFuZCBzaG93IG9ubHkgdGhlIG1hdGNoZXNcbiAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZFdyYXBwZXI7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5fZGF0YS5zZWFyY2guc29tKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEubm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIGFsbCBvZiB0aGUgZ3JpZCBjZWxsc1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5maW5kKCdkaXYuanN0cmVlLWdyaWQtY2VsbDpub3QoOmZpcnN0KScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3cgb25seSB0aG9zZSB0aGF0IG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm5vZGVzLmFkZChkYXRhLm5vZGVzLnBhcmVudHNVbnRpbChcIi5qc3RyZWVcIikpLmZpbHRlcihcIi5qc3RyZWUtbm9kZVwiKS5lYWNoKGZ1bmN0aW9uIChpLG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBub2RlLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwoZ3JpZCxpZCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSwgdGhpcykpXG4gICAgICAgICAgICAub24oXCJjbGVhcl9zZWFyY2guanN0cmVlXCIsICQucHJveHkoZnVuY3Rpb24gKGUsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAvLyBzZWFyY2ggaGFzIGJlZW4gY2xlYXJlZCwgc28gd2UgbmVlZCB0byBzaG93IGFsbCByb3dzXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci5maW5kKCdkaXYuanN0cmVlLWdyaWQtY2VsbCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2dyaWRTZXR0aW5ncy5pc1RoZW1lcm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIC5vbihcInNlbGVjdF9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24oZSxkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImRlc2VsZWN0X25vZGUuanN0cmVlIGRlc2VsZWN0X2FsbC5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24oZSxkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiZGVob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24oZSxkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSx0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIHRlYXIgZG93biB0aGUgdHJlZSBlbnRpcmVseVxuICAgICAgICB0aGlzLnRlYXJkb3duID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZ3cgPSB0aGlzLmdyaWRXcmFwcGVyLCBjb250YWluZXIgPSB0aGlzLmVsZW1lbnQsIGdyaWRwYXJlbnQgPSBndy5wYXJlbnQoKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5kZXRhY2goKTtcbiAgICAgICAgICAgIGd3LnJlbW92ZSgpO1xuICAgICAgICAgICAgZ3JpZHBhcmVudC5hcHBlbmQoY29udGFpbmVyKTtcbiAgICAgICAgICAgIHBhcmVudC50ZWFyZG93bi5jYWxsKHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBjbGVhbiB0aGUgZ3JpZCBpbiBjYXNlIG9mIHJlZHJhdyBvciByZWZyZXNoIGVudGlyZSB0cmVlXG4gICAgICAgIHRoaXMuX2NsZWFuX2dyaWQgPSBmdW5jdGlvbiAodGFyZ2V0LGlkKSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZFdyYXBwZXI7XG4gICAgICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKGdyaWQsaWQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgYWxsIG9mIHRoZSBgZGl2YCBjaGlsZHJlbiBpbiBhbGwgb2YgdGhlIGB0ZGAgaW4gZGF0YVJvdyBleGNlcHQgZm9yIDpmaXJzdCAodGhhdCBpcyB0aGUgdHJlZSBpdHNlbGYpIGFuZCByZW1vdmVcbiAgICAgICAgICAgICAgICBncmlkLmZpbmQoXCJkaXYuanN0cmVlLWdyaWQtY2VsbDpub3QoOmZpcnN0KVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gcHJlcGFyZSB0aGUgaGVhZGVyc1xuICAgICAgICB0aGlzLl9wcmVwYXJlX2hlYWRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXIsIGksIGNvbCwgZ3MgPSB0aGlzLl9ncmlkU2V0dGluZ3MsY29scyA9IGdzLmNvbHVtbnMgfHwgW10sIHdpZHRoLCBkZWZhdWx0V2lkdGggPSBncy5jb2x1bW5XaWR0aCwgcmVzaXphYmxlID0gZ3MucmVzaXphYmxlIHx8IGZhbHNlLFxuICAgICAgICAgICAgY2wsIGNjbCwgdmFsLCBtYXJnaW4sIGxhc3QsIHRyID0gZ3MuaXNUaGVtZXJvbGxlciwgY2xhc3NBZGQgPSAodHI/XCJ0aGVtZXJvbGxlclwiOlwicmVndWxhclwiKSwgcHVsbGVyLFxuICAgICAgICAgICAgaGFzSGVhZGVycyA9IGZhbHNlLCBncmlkcGFyZW50ID0gdGhpcy5ncmlkcGFyZW50LFxuICAgICAgICAgICAgY29uZiA9IGdzLmRlZmF1bHRDb25mLFxuICAgICAgICAgICAgY29sTnVtID0gMCwgYm9yUGFkV2lkdGggPSAwLCB0b3RhbFdpZHRoID0gMDtcbiAgICAgICAgICAgIC8vIHNhdmUgdGhlIG9yaWdpbmFsIHBhcmVudCBzbyB3ZSBjYW4gcmVwYXJlbnQgb24gZGVzdHJveVxuICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBncmlkcGFyZW50O1xuXG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgaGVhZGVyc1xuICAgICAgICAgICAgZm9yIChpPTA7aTxjb2xzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAvL2NvbCA9ICQoXCI8Y29sLz5cIik7XG4gICAgICAgICAgICAgICAgLy9jb2wuYXBwZW5kVG8oY29sZ3JvdXApO1xuICAgICAgICAgICAgICAgIGNsID0gY29sc1tpXS5oZWFkZXJDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGNjbCA9IGNvbHNbaV0uY29sdW1uQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICB2YWwgPSBjb2xzW2ldLmhlYWRlciB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICh2YWwpIHtoYXNIZWFkZXJzID0gdHJ1ZTt9XG4gICAgICAgICAgICAgICAgd2lkdGggPSBjb2xzW2ldLndpZHRoIHx8IGRlZmF1bHRXaWR0aDtcblxuICAgICAgICAgICAgICAgIC8vIHdlIG9ubHkgZGVhbCB3aXRoIGJvcmRlcnMgaWYgd2lkdGggaXMgbm90IGF1dG8gYW5kIG5vdCBwZXJjZW50YWdlc1xuICAgICAgICAgICAgICAgIGJvclBhZFdpZHRoID0gdHIgPyAxKzYgOiAyKzg7IC8vIGFjY291bnQgZm9yIHRoZSBib3JkZXJzIGFuZCBwYWRkaW5nXG4gICAgICAgICAgICAgICAgaWYgKHdpZHRoICE9PSAnYXV0bycgJiYgdHlwZW9mKHdpZHRoKSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aCAtPSBib3JQYWRXaWR0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWFyZ2luID0gaSA9PT0gMCA/IDMgOiAwO1xuICAgICAgICAgICAgICAgIGNvbCA9IHRoaXMubWlkV3JhcHBlci5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW4tXCIraSk7XG4gICAgICAgICAgICAgICAgbGFzdCA9ICQoXCI8ZGl2PjwvZGl2PlwiKS5jc3MoY29uZikuY3NzKHtcIm1hcmdpbi1sZWZ0XCI6IG1hcmdpbn0pLmFkZENsYXNzKFwianN0cmVlLWdyaWQtZGl2LVwiK3RoaXMudW5pcStcIi1cIitpK1wiIFwiKyh0cj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCIganN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1jZWxsIGpzdHJlZS1ncmlkLWhlYWRlci1cIitjbGFzc0FkZCtcIiBcIitjbCtcIiBcIitjY2wpLmh0bWwodmFsKTtcbiAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKCh0cj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCJqc3RyZWUtZ3JpZC1oZWFkZXIganN0cmVlLWdyaWQtaGVhZGVyLVwiK2NsYXNzQWRkKTtcbiAgICAgICAgICAgICAgICBsYXN0LnByZXBlbmRUbyhjb2wpO1xuICAgICAgICAgICAgICAgIHRvdGFsV2lkdGggKz0gbGFzdC5vdXRlcldpZHRoKCk7XG4gICAgICAgICAgICAgICAgcHVsbGVyID0gJChcIjxkaXYgY2xhc3M9J2pzdHJlZS1ncmlkLXNlcGFyYXRvciBqc3RyZWUtZ3JpZC1zZXBhcmF0b3ItXCIrY2xhc3NBZGQrKHRyID8gXCIgdWktd2lkZ2V0LWhlYWRlclwiIDogXCJcIikrKHJlc2l6YWJsZT8gXCIganN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiOlwiXCIpK1wiJz4mbmJzcDs8L2Rpdj5cIikuYXBwZW5kVG8obGFzdCk7XG4gICAgICAgICAgICAgICAgY29sLndpZHRoKHdpZHRoKTtcbiAgICAgICAgICAgICAgICBjb2wuY3NzKFwibWluLXdpZHRoXCIsd2lkdGgpO1xuICAgICAgICAgICAgICAgIGNvbC5jc3MoXCJtYXgtd2lkdGhcIix3aWR0aCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxhc3QuYWRkQ2xhc3MoKHRyP1widWktd2lkZ2V0LWhlYWRlciBcIjpcIlwiKStcImpzdHJlZS1ncmlkLWhlYWRlciBqc3RyZWUtZ3JpZC1oZWFkZXItbGFzdCBqc3RyZWUtZ3JpZC1oZWFkZXItXCIrY2xhc3NBZGQpO1xuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gd2lkdGggZ2l2ZW4gZm9yIHRoZSBsYXN0IGNvbHVtbiwgZG8gaXQgdmlhIGF1dG9tYXRpY1xuICAgICAgICAgICAgaWYgKGNvbHNbY29scy5sZW5ndGgtMV0ud2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRvdGFsV2lkdGggLT0gd2lkdGg7XG4gICAgICAgICAgICAgICAgY29sLmNzcyh7d2lkdGg6XCJhdXRvXCJ9KTtcbiAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKFwianN0cmVlLWdyaWQtd2lkdGgtYXV0b1wiKS5uZXh0KFwiLmpzdHJlZS1ncmlkLXNlcGFyYXRvclwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNIZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgb2Zmc2V0IG9mIHRoZSBkaXYgZnJvbSB0aGUgYm9keVxuICAgICAgICAgICAgICAgIC8vZ3MuZGl2T2Zmc2V0ID0gaGVhZGVyLnBhcmVudCgpLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgICAgICAgZ3MuaGVhZGVyID0gaGVhZGVyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiZGl2LmpzdHJlZS1ncmlkLWhlYWRlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5ib3VuZCAmJiByZXNpemFibGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICBpLCByZWYsIGNvbHMsIHdpZHRocywgaGVhZGVycywgdywgY3VycmVudFRyZWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0NsaWNrZWRTZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUcmVlID0gdG9SZXNpemUuY2xvc2VzdChcIi5qc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmZpbmQoXCIuanN0cmVlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmID0gJC5qc3RyZWUucmVmZXJlbmNlKGN1cnJlbnRUcmVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHMgPSByZWYuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHRvUmVzaXplLnBhcmVudCgpLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRocyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGNvbE51bSkgfHwgY29sTnVtIDwgMCkgeyByZWYuX2dyaWRTZXR0aW5ncy50cmVlV2lkdGhEaWZmID0gY3VycmVudFRyZWUuZmluZChcImluczplcSgwKVwiKS53aWR0aCgpICsgY3VycmVudFRyZWUuZmluZChcImE6ZXEoMClcIikud2lkdGgoKSAtIHJlZi5fZ3JpZFNldHRpbmdzLmNvbHVtbnNbMF0ud2lkdGg7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xpY2tlZFNlcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTxjb2xzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gcGFyc2VGbG9hdChoZWFkZXJzW2ldLnN0eWxlLndpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aHNbaV0gPSB7dzogdywgcjogaT09PWNvbE51bSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZi5fZ3JpZFNldHRpbmdzLmNvbHVtbnNbaV0ud2lkdGggPSB3O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VHJlZS50cmlnZ2VyKFwicmVzaXplX2NvbHVtbi5qc3RyZWUtZ3JpZFwiLCB3aWR0aHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkubW91c2Vtb3ZlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbGlja2VkU2VwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3TW91c2VYID0gZS5wYWdlWDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IG5ld01vdXNlWCAtIG9sZE1vdXNlWCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmV2SGVhZGVySW5uZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkUHJldkNvbFdpZHRoLCBuZXdQcmV2Q29sV2lkdGg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPT0gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByZXZIZWFkZXJJbm5lciA9IHRvUmVzaXplLndpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByZXZDb2xXaWR0aCA9IHBhcnNlRmxvYXQodG9SZXNpemUuY3NzKFwid2lkdGhcIikpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBhIENocm9tZSBpc3N1ZSB3aXRoIGNvbHVtbnMgc2V0IHRvIGF1dG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhhbmtzIHRvIEJyYWJ1cyBodHRwczovL2dpdGh1Yi5jb20vc2lkZS1ieS1zaWRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb2xkUHJldkNvbFdpZHRoKSB7b2xkUHJldkNvbFdpZHRoID0gdG9SZXNpemUuaW5uZXJXaWR0aCgpO31cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBkaWZmIGNhbm5vdCBiZSBiZXlvbmQgdGhlIGxlZnQvcmlnaHQgbGltaXRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmYgPSBkaWZmIDwgMCA/IE1hdGgubWF4KGRpZmYsLW9sZFByZXZIZWFkZXJJbm5lcikgOiBkaWZmO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQcmV2Q29sV2lkdGggPSAob2xkUHJldkNvbFdpZHRoK2RpZmYpK1wicHhcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGRvIHRoaXMgaWYgd2UgYXJlIG5vdCBzaHJpbmtpbmcgcGFzdCAwIG9uIGxlZnQgLSBhbmQgbGltaXQgaXQgdG8gdGhhdCBhbW91bnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgPiAwIHx8IG9sZFByZXZIZWFkZXJJbm5lciA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVzaXplLndpZHRoKG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Jlc2l6ZS5jc3MoXCJtaW4td2lkdGhcIixuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUuY3NzKFwibWF4LXdpZHRoXCIsbmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZE1vdXNlWCA9IG5ld01vdXNlWDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci5vbihcInNlbGVjdHN0YXJ0XCIsIFwiLmpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSkub24oXCJtb3VzZWRvd25cIiwgXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpc0NsaWNrZWRTZXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBvbGRNb3VzZVggPSBlLnBhZ2VYO1xuICAgICAgICAgICAgICAgICAgICB0b1Jlc2l6ZSA9ICQodGhpcykuY2xvc2VzdChcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBtYXggcmlnaHRtb3N0IHBvc2l0aW9uIHdlIHdpbGwgYWxsb3cgaXMgdGhlIHJpZ2h0LW1vc3Qgb2YgdGhlIHdyYXBwZXIgbWludXMgYSBidWZmZXIgKDEwKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oXCJkYmxjbGlja1wiLCBcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGlja2VkU2VwID0gJCh0aGlzKSwgY29sID0gY2xpY2tlZFNlcC5jbG9zZXN0KFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKSxcbiAgICAgICAgICAgICAgICAgICAgb2xkUHJldkNvbFdpZHRoID0gcGFyc2VGbG9hdChjb2wuY3NzKFwid2lkdGhcIikpLCBuZXdXaWR0aCA9IDAsIGRpZmYsXG4gICAgICAgICAgICAgICAgICAgIG9sZFByZXZIZWFkZXJJbm5lciA9IGNvbC53aWR0aCgpLCBuZXdQcmV2Q29sV2lkdGg7XG5cblxuICAgICAgICAgICAgICAgICAgICAvL2ZpbmQgbGFyZ2VzdCB3aWR0aFxuICAgICAgICAgICAgICAgICAgICBjb2wuZmluZChcIi5qc3RyZWUtZ3JpZC1jZWxsXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQodGhpcyksIHdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jc3MoXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jc3MoXCJ3aWR0aFwiLCBcImF1dG9cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGl0ZW0ub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jc3MoXCJwb3NpdGlvblwiLCBcInJlbGF0aXZlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkdGg+bmV3V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdXaWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBkaWZmID0gbmV3V2lkdGgtb2xkUHJldkNvbFdpZHRoO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IGRpZmYgY2Fubm90IGJlIGJleW9uZCB0aGUgbGVmdCBsaW1pdHNcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IGRpZmYgPCAwID8gTWF0aC5tYXgoZGlmZiwtb2xkUHJldkhlYWRlcklubmVyKSA6IGRpZmY7XG4gICAgICAgICAgICAgICAgICAgIG5ld1ByZXZDb2xXaWR0aCA9IChvbGRQcmV2Q29sV2lkdGgrZGlmZikrXCJweFwiO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aChuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICBjb2wuY3NzKFwibWluLXdpZHRoXCIsbmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNzcyhcIm1heC13aWR0aFwiLG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qXG4gICAgICAgICAqIE92ZXJyaWRlIHJlZHJhd19ub2RlIHRvIGNvcnJlY3RseSBpbnNlcnQgdGhlIGdyaWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVkcmF3X25vZGUgPSBmdW5jdGlvbihvYmosIGRlZXAsIGlzX2NhbGxiYWNrLCBmb3JjZV9yZW5kZXIpIHtcbiAgICAgICAgICAgIC8vIGZpcnN0IGFsbG93IHRoZSBwYXJlbnQgdG8gcmVkcmF3IHRoZSBub2RlXG4gICAgICAgICAgICBvYmogPSBwYXJlbnQucmVkcmF3X25vZGUuY2FsbCh0aGlzLCBvYmosIGRlZXAsIGlzX2NhbGxiYWNrLCBmb3JjZV9yZW5kZXIpO1xuICAgICAgICAgICAgLy8gbmV4dCBwcmVwYXJlIHRoZSBncmlkXG4gICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlX2dyaWQob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFuX2dyaWQoKTtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQucmVmcmVzaC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2hpZGVfZ3JpZCA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlICYmIG5vZGUuY2hpbGRyZW5fZCA/IG5vZGUuY2hpbGRyZW5fZCA6IFtdLCBpO1xuICAgICAgICAgICAgLy8gZ28gdGhyb3VnaCBlYWNoIGNvbHVtbiwgcmVtb3ZlIGFsbCBjaGlsZHJlbiB3aXRoIHRoZSBjb3JyZWN0IElEIG5hbWVcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y2hpbGRyZW4ubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGNoaWxkcmVuW2ldKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ob2xkaW5nQ2VsbHMgPSB7fTtcbiAgICAgICAgdGhpcy5nZXRIb2xkaW5nQ2VsbHMgPSBmdW5jdGlvbiAob2JqLGNvbCxoYykge1xuICAgICAgICAgICAgdmFyIHJldCA9ICQoKSwgY2hpbGRyZW4gPSBvYmouY2hpbGRyZW58fFtdLCBjaGlsZCwgaTtcbiAgICAgICAgICAgIC8vIHJ1biB0aHJvdWdoIGVhY2ggY2hpbGQsIHJlbmRlciBpdCwgYW5kIHRoZW4gcmVuZGVyIGl0cyBjaGlsZHJlbiByZWN1cnNpdmVseVxuICAgICAgICAgICAgZm9yIChpPTA7aTxjaGlsZHJlbi5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgY2hpbGQgPSBHUklEQ0VMTElEX1BSRUZJWCtlc2NhcGVJZChjaGlsZHJlbltpXSkrR1JJRENFTExJRF9QT1NURklYK2NvbDtcbiAgICAgICAgICAgICAgICBpZiAoaGNbY2hpbGRdICYmIG9iai5zdGF0ZS5vcGVuZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0LmFkZChoY1tjaGlsZF0pLmFkZCh0aGlzLmdldEhvbGRpbmdDZWxscyh0aGlzLmdldF9ub2RlKGNoaWxkcmVuW2ldKSxjb2wsaGMpKTtcbiAgICAgICAgICAgICAgICAgICAgLy9kZWxldGUgaGNbY2hpbGRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybihyZXQpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogcHV0IGEgZ3JpZCBjZWxsIGluIGVkaXQgbW9kZSAoaW5wdXQgZmllbGQgdG8gZWRpdCB0aGUgZGF0YSlcbiAgICAgICAgICogQG5hbWUgZWRpdChvYmosIGNvbClcbiAgICAgICAgICogQHBhcmFtICB7bWl4ZWR9IG9ialxuICAgICAgICAgKiBAcGFyYW0gIHtvYmp9IGNvbCBkZWZpbml0aW9uXG4gICAgICAgICAqIEBwYXJhbSAge2VsZW1lbnR9IGNlbGwgZWxlbWVudCwgZWl0aGVyIHNwYW4gb3Igd3JhcHBpbmcgZGl2XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9lZGl0ID0gZnVuY3Rpb24gKG9iaiwgY29sLCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZighb2JqKSB7IHJldHVybiBmYWxzZTsgfVxuICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5wcm9wKFwidGFnTmFtZVwiKS50b0xvd2VyQ2FzZSgpID09PSBcImRpdlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LmNoaWxkcmVuKFwic3BhbjpmaXJzdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gZmluZCB0aGUgZWxlbWVudCAtIGxhdGVyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJ0bCA9IHRoaXMuX2RhdGEuY29yZS5ydGwsXG4gICAgICAgICAgICAgICAgdyAgPSB0aGlzLmVsZW1lbnQud2lkdGgoKSxcbiAgICAgICAgICAgICAgICB0ID0gb2JqLmRhdGFbY29sLnZhbHVlXSxcbiAgICAgICAgICAgICAgICBoMSA9ICQoXCI8XCIrXCJkaXYgLz5cIiwgeyBjc3MgOiB7IFwicG9zaXRpb25cIiA6IFwiYWJzb2x1dGVcIiwgXCJ0b3BcIiA6IFwiLTIwMHB4XCIsIFwibGVmdFwiIDogKHJ0bCA/IFwiMHB4XCIgOiBcIi0xMDAwcHhcIiksIFwidmlzaWJpbGl0eVwiIDogXCJoaWRkZW5cIiB9IH0pLmFwcGVuZFRvKFwiYm9keVwiKSxcbiAgICAgICAgICAgICAgICBoMiA9ICQoXCI8XCIrXCJpbnB1dCAvPlwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCIgOiB0LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGFzc1wiIDogXCJqc3RyZWUtcmVuYW1lLWlucHV0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNzc1wiIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFkZGluZ1wiIDogXCIwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJib3JkZXJcIiA6IFwiMXB4IHNvbGlkIHNpbHZlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYm94LXNpemluZ1wiIDogXCJib3JkZXItYm94XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkaXNwbGF5XCIgOiBcImlubGluZS1ibG9ja1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVpZ2h0XCIgOiAodGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCkgKyBcInB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsaW5lSGVpZ2h0XCIgOiAodGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCkgKyBcInB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3aWR0aFwiIDogXCIxNTBweFwiIC8vIHdpbGwgYmUgc2V0IGEgYml0IGZ1cnRoZXIgZG93blxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYmx1clwiIDogJC5wcm94eShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBoMi52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSB2YWx1ZSBpZiBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodiA9PT0gXCJcIiB8fCB2ID09PSB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhW2NvbC52YWx1ZV0gPSB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcigndXBkYXRlX2NlbGwuanN0cmVlLWdyaWQnLHtub2RlOm9iaiwgY29sOmNvbC52YWx1ZSwgdmFsdWU6diwgb2xkOnR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkKHRoaXMuZ2V0X25vZGUob2JqLHRydWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDIucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwia2V5ZG93blwiIDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGV2ZW50LndoaWNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gMjcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gMjcgfHwga2V5ID09PSAxMyB8fCBrZXkgPT09IDM3IHx8IGtleSA9PT0gMzggfHwga2V5ID09PSAzOSB8fCBrZXkgPT09IDQwIHx8IGtleSA9PT0gMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gMjcgfHwga2V5ID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGlja1wiIDogZnVuY3Rpb24gKGUpIHsgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibW91c2Vkb3duXCIgOiBmdW5jdGlvbiAoZSkgeyBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJrZXl1cFwiIDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDIud2lkdGgoTWF0aC5taW4oaDEudGV4dChcInBXXCIgKyB0aGlzLnZhbHVlKS53aWR0aCgpLHcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImtleXByZXNzXCIgOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LndoaWNoID09PSAxMykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZm4gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb250RmFtaWx5ICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250RmFtaWx5JykgICAgICAgIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemUgICAgICAgIDogZWxlbWVudC5jc3MoJ2ZvbnRTaXplJykgICAgICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQgICAgICAgIDogZWxlbWVudC5jc3MoJ2ZvbnRXZWlnaHQnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250U3R5bGUgICAgICAgIDogZWxlbWVudC5jc3MoJ2ZvbnRTdHlsZScpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTdHJldGNoICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250U3RyZXRjaCcpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRWYXJpYW50ICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250VmFyaWFudCcpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlclNwYWNpbmcgICAgOiBlbGVtZW50LmNzcygnbGV0dGVyU3BhY2luZycpICAgIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZFNwYWNpbmcgICAgICAgIDogZWxlbWVudC5jc3MoJ3dvcmRTcGFjaW5nJykgICAgICAgIHx8ICcnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGVsZW1lbnQuaGlkZSgpO1xuICAgICAgICAgICAgZWxlbWVudC5wYXJlbnQoKS5hcHBlbmQoaDIpO1xuICAgICAgICAgICAgaDIuY3NzKGZuKS53aWR0aChNYXRoLm1pbihoMS50ZXh0KFwicFdcIiArIGgyWzBdLnZhbHVlKS53aWR0aCgpLHcpKVswXS5zZWxlY3QoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgdmFyIGdzID0gdGhpcy5fZ3JpZFNldHRpbmdzLCBjID0gZ3MudHJlZUNsYXNzLCBfdGhpcyA9IHRoaXMsIHQsIGNvbHMgPSBncy5jb2x1bW5zIHx8IFtdLCB3aWR0aCwgdHIgPSBncy5pc1RoZW1lcm9sbGVyLFxuICAgICAgICAgICAgdHJlZSA9IHRoaXMuZWxlbWVudCwgcm9vdGlkID0gdGhpcy5yb290aWQsXG4gICAgICAgICAgICBjbGFzc0FkZCA9ICh0cj9cInRoZW1lcm9sbGVyXCI6XCJyZWd1bGFyXCIpLCBpbWcsIG9iakRhdGEgPSB0aGlzLmdldF9ub2RlKG9iaiksXG4gICAgICAgICAgICBkZWZhdWx0V2lkdGggPSBncy5jb2x1bW5XaWR0aCwgY29uZiA9IGdzLmRlZmF1bHRDb25mLCBjZWxsQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKHRyZWUsbm9kZSx2YWwsY29sLHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAvL25vZGUgPSB0cmVlLmZpbmQoXCIjXCIrbm9kZS5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikudHJpZ2dlcihcImNsaWNrLmpzdHJlZVwiLGUpO1xuICAgICAgICAgICAgICAgICAgICB0cmVlLnRyaWdnZXIoXCJzZWxlY3RfY2VsbC5qc3RyZWUtZ3JpZFwiLCBbe3ZhbHVlOiB2YWwsY29sdW1uOiBjb2wuaGVhZGVyLG5vZGU6IG5vZGUsZ3JpZDokKHRoaXMpLHNvdXJjZU5hbWU6IGNvbC52YWx1ZX1dKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSwgY2VsbFJpZ2h0Q2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKHRyZWUsbm9kZSx2YWwsY29sLHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdzLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQudmFrYXRhLmNvbnRleHQuc2hvdyh0aGlzLHsgJ3gnIDogZS5wYWdlWCwgJ3knIDogZS5wYWdlWSB9LHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVkaXRcIjp7bGFiZWw6XCJFZGl0XCIsXCJhY3Rpb25cIjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHQuZ2V0X25vZGUobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9lZGl0KG9iaixjb2wsZS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaG92ZXJJbkhhbmRsZXIgPSBmdW5jdGlvbiAobm9kZSwganNUcmVlSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7IGpzVHJlZUluc3RhbmNlLmhvdmVyX25vZGUobm9kZSk7IH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaG92ZXJPdXRIYW5kbGVyID0gZnVuY3Rpb24gKG5vZGUsIGpzVHJlZUluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyBqc1RyZWVJbnN0YW5jZS5kZWhvdmVyX25vZGUobm9kZSk7IH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaSwgdmFsLCBjbCwgd2NsLCBjY2wsIGEsIGxhc3QsIHZhbENsYXNzLCB3aWRlVmFsQ2xhc3MsIHNwYW4sIHBhZGRpbmdsZWZ0LCB0aXRsZSwgZ3JpZENlbGxOYW1lLCBncmlkQ2VsbFBhcmVudElkLCBncmlkQ2VsbFBhcmVudCxcbiAgICAgICAgICAgIGdyaWRDZWxsUHJldiwgZ3JpZENlbGxQcmV2SWQsIGdyaWRDZWxsTmV4dCwgZ3JpZENlbGxOZXh0SWQsIGdyaWRDZWxsQ2hpbGQsIGdyaWRDZWxsQ2hpbGRJZCxcbiAgICAgICAgICAgIGNvbCwgY29udGVudCwgdG1wV2lkdGgsIG13ID0gdGhpcy5taWRXcmFwcGVyLCBkYXRhQ2VsbCwgbGlkID0gb2JqRGF0YS5pZCxcbiAgICAgICAgICAgIHBlZXJzID0gdGhpcy5nZXRfbm9kZShvYmpEYXRhLnBhcmVudCkuY2hpbGRyZW4sXG4gICAgICAgICAgICAvLyBmaW5kIG15IHBvc2l0aW9uIGluIHRoZSBsaXN0IG9mIHBlZXJzLiBcInBlZXJzXCIgaXMgdGhlIGxpc3Qgb2YgZXZlcnlvbmUgYXQgbXkgbGV2ZWwgdW5kZXIgbXkgcGFyZW50LCBpbiBvcmRlclxuICAgICAgICAgICAgcG9zID0gJC5pbkFycmF5KGxpZCxwZWVycyksXG4gICAgICAgICAgICBoYyA9IHRoaXMuaG9sZGluZ0NlbGxzLCByZW5kZXJlZCA9IGZhbHNlLCBjbG9zZWQ7XG4gICAgICAgICAgICAvLyBnZXQgb3VyIGNvbHVtbiBkZWZpbml0aW9uXG4gICAgICAgICAgICB0ID0gJChvYmopO1xuXG4gICAgICAgICAgICAvLyBmaW5kIHRoZSBhIGNoaWxkcmVuXG4gICAgICAgICAgICBhID0gdC5jaGlsZHJlbihcImFcIik7XG5cbiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNsb3NlZCA9ICFvYmpEYXRhLnN0YXRlLm9wZW5lZDtcbiAgICAgICAgICAgICAgICBncmlkQ2VsbE5hbWUgPSBHUklEQ0VMTElEX1BSRUZJWCtlc2NhcGVJZChsaWQpK0dSSURDRUxMSURfUE9TVEZJWDtcbiAgICAgICAgICAgICAgICBncmlkQ2VsbFBhcmVudElkID0gb2JqRGF0YS5wYXJlbnQgPT09IFwiI1wiID8gbnVsbCA6IG9iakRhdGEucGFyZW50O1xuICAgICAgICAgICAgICAgIGEuYWRkQ2xhc3MoYyk7XG4gICAgICAgICAgICAgICAgLy9yZW5kZXJBV2lkdGgoYSxfdGhpcyk7XG4gICAgICAgICAgICAgICAgcmVuZGVyQVRpdGxlKGEsdCxfdGhpcyk7XG4gICAgICAgICAgICAgICAgbGFzdCA9IGE7XG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTxjb2xzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJlZWNvbCA9PT0gaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29sID0gY29sc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUNlbGwgPSBtdy5jaGlsZHJlbihcImRpdjplcShcIitpK1wiKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBjZWxsQ2xhc3MsIHRoZSB3aWRlQ2VsbENsYXNzLCBhbmQgdGhlIGNvbHVtbkNsYXNzXG4gICAgICAgICAgICAgICAgICAgIGNsID0gY29sLmNlbGxDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB3Y2wgPSBjb2wud2lkZUNlbGxDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBjY2wgPSBjb2wuY29sdW1uQ2xhc3MgfHwgXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBjb2x1bW4gY2xhc3MgdG8gdGhlIGRhdGFDZWxsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFDZWxsLmFkZENsYXNzKGNjbCk7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGNvbnRlbnRzIG9mIHRoZSBjZWxsIC0gdmFsdWUgY291bGQgYmUgYSBzdHJpbmcgb3IgYSBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgY29sLnZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGNvbC52YWx1ZSkgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGNvbC52YWx1ZShvYmpEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkICYmIG9iakRhdGEuZGF0YVtjb2wudmFsdWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBvYmpEYXRhLmRhdGFbY29sLnZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGNvbC5mb3JtYXQpID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGNvbC5mb3JtYXQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHB1dCBpbWFnZXMgaW5zdGVhZCBvZiB0ZXh0IGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmltYWdlcykge1xuICAgICAgICAgICAgICAgICAgICBpbWcgPSBjb2wuaW1hZ2VzW3ZhbF0gfHwgY29sLmltYWdlc1tcImRlZmF1bHRcIl07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbWcpIHtjb250ZW50ID0gaW1nWzBdID09PSBcIipcIiA/ICc8c3BhbiBjbGFzcz1cIicraW1nLnN1YnN0cigxKSsnXCI+PC9zcGFuPicgOiAnPGltZyBzcmM9XCInK2ltZysnXCI+Jzt9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IGNvbnRlbnQgPSB2YWw7IH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjb250ZW50IGNhbm5vdCBiZSBibGFuaywgb3IgaXQgbWVzc2VzIHVwIGhlaWdodHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQgPT09IHVuZGVmaW5lZCB8fCBjb250ZW50ID09PSBudWxsIHx8IEJMQU5LUkUudGVzdChjb250ZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IFwiJm5ic3A7XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHZhbHVlQ2xhc3NcbiAgICAgICAgICAgICAgICAgICAgdmFsQ2xhc3MgPSBjb2wudmFsdWVDbGFzcyAmJiBvYmpEYXRhLmRhdGEgIT09IG51bGwgJiYgb2JqRGF0YS5kYXRhICE9PSB1bmRlZmluZWQgPyBvYmpEYXRhLmRhdGFbY29sLnZhbHVlQ2xhc3NdIHx8IFwiXCIgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsQ2xhc3MgJiYgY29sLnZhbHVlQ2xhc3NQcmVmaXggJiYgY29sLnZhbHVlQ2xhc3NQcmVmaXggIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbENsYXNzID0gY29sLnZhbHVlQ2xhc3NQcmVmaXggKyB2YWxDbGFzcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHdpZGVWYWx1ZUNsYXNzXG4gICAgICAgICAgICAgICAgICAgIHdpZGVWYWxDbGFzcyA9IGNvbC53aWRlVmFsdWVDbGFzcyAmJiBvYmpEYXRhLmRhdGEgIT09IG51bGwgJiYgb2JqRGF0YS5kYXRhICE9PSB1bmRlZmluZWQgPyBvYmpEYXRhLmRhdGFbY29sLndpZGVWYWx1ZUNsYXNzXSB8fCBcIlwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGVWYWxDbGFzcyAmJiBjb2wud2lkZVZhbHVlQ2xhc3NQcmVmaXggJiYgY29sLndpZGVWYWx1ZUNsYXNzUHJlZml4ICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRlVmFsQ2xhc3MgPSBjb2wud2lkZVZhbHVlQ2xhc3NQcmVmaXggKyB3aWRlVmFsQ2xhc3M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB0aXRsZVxuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IGNvbC50aXRsZSAmJiBvYmpEYXRhLmRhdGEgIT09IG51bGwgJiYgb2JqRGF0YS5kYXRhICE9PSB1bmRlZmluZWQgPyBvYmpEYXRhLmRhdGFbY29sLnRpdGxlXSB8fCBcIlwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgLy8gc3RyaXAgb3V0IEhUTUxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKGh0bWxzdHJpcHJlLCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB3aWR0aFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nbGVmdCA9IDc7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoID0gY29sLndpZHRoIHx8IGRlZmF1bHRXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpZHRoICE9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gdG1wV2lkdGggfHwgKHdpZHRoIC0gcGFkZGluZ2xlZnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGFzdCA9IGRhdGFDZWxsLmNoaWxkcmVuKFwiZGl2I1wiK2dyaWRDZWxsTmFtZStpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFsYXN0IHx8IGxhc3QubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCA9ICQoXCI8ZGl2PjwvZGl2PlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbj48L3NwYW4+XCIpLmFwcGVuZFRvKGxhc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hdHRyKFwiaWRcIixncmlkQ2VsbE5hbWUraSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKGdyaWRDZWxsTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LmF0dHIoTk9ERV9EQVRBX0FUVFIsbGlkKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcHV0IGl0IGluIHRoZSBkYXRhQ2VsbCAtIGFmdGVyIHRoZSBwYXJlbnQsIGJ1dCB0aGUgcG9zaXRpb24gbWF0dGVyc1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vIHBhcmVudCwgdGhlbiB3ZSBhcmUgb25lIG9mIHRoZSByb290IG5vZGVzLCBidXQgc3RpbGwgbmVlZCB0byBsb29rIGF0IHBlZXJzXG5cblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBhcmUgZmlyc3QsIGkuZS4gcG9zID09PSAwLCB3ZSBnbyByaWdodCBhZnRlciB0aGUgcGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBhcmUgbm90IGZpcnN0LCBhbmQgb3VyIHByZXZpb3VzIHBlZXIgKG9uZSBiZWZvcmUgdXMpIGlzIGNsb3NlZCwgd2UgZ28gcmlnaHQgYWZ0ZXIgdGhlIHByZXZpb3VzIHBlZXIgY2VsbFxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBhcmUgbm90IGZpcnN0LCBhbmQgb3VyIHByZXZpb3VzIHBlZXIgaXMgb3BlbmVkLCB0aGVuIHdlIGhhdmUgdG8gZmluZCBpdHMgeW91bmdlc3QgJiBsb3dlc3QgY2xvc2VkIGNoaWxkIChpbmNsLiBsZWFmKVxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBwcm9iYWJseSBiZSBtdWNoIGVhc2llciB0byBnbyAqYmVmb3JlKiBvdXIgbmV4dCBvbmVcbiAgICAgICAgICAgICAgICAgICAgLy8gYnV0IHRoYXQgb25lIG1pZ2h0IG5vdCBiZSBkcmF3biB5ZXRcbiAgICAgICAgICAgICAgICAgICAgLy8gaGVyZSBpcyB0aGUgbG9naWMgZm9yIGpzdHJlZSBkcmF3aW5nOlxuICAgICAgICAgICAgICAgICAgICAvLyAgIGl0IGRyYXdzIHBlZXJzIGZyb20gZmlyc3QgdG8gbGFzdCBvciBmcm9tIGxhc3QgdG8gZmlyc3RcbiAgICAgICAgICAgICAgICAgICAgLy8gICBpdCBkcmF3cyBjaGlsZHJlbiBiZWZvcmUgYSBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgLy8gc28gSSBjYW4gcmVseSBvbiBteSAqcGFyZW50KiBub3QgYmVpbmcgZHJhd24sIGJ1dCBJIGNhbm5vdCByZWx5IG9uIG15IHByZXZpb3VzIHBlZXIgb3IgbXkgbmV4dCBwZWVyIGJlaW5nIGRyYXduXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgZG8gdGhlIGZvbGxvd2luZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gICAxLSBXZSBhcmUgdGhlIGZpcnN0IGNoaWxkOiBpbnN0YWxsIGFmdGVyIHRoZSBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgLy8gICAyLSBPdXIgcHJldmlvdXMgcGVlciBpcyBhbHJlYWR5IGRyYXduOiBpbnN0YWxsIGFmdGVyIHRoZSBwcmV2aW91cyBwZWVyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgMy0gT3VyIHByZXZpb3VzIHBlZXIgaXMgbm90IGRyYXduLCB3ZSBoYXZlIGEgY2hpbGQgdGhhdCBpcyBkcmF3bjogaW5zdGFsbCByaWdodCBiZWZvcmUgb3VyIGZpcnN0IGNoaWxkXG4gICAgICAgICAgICAgICAgICAgIC8vICAgNC0gT3VyIHByZXZpb3VzIHBlZXIgaXMgbm90IGRyYXduLCB3ZSBoYXZlIG5vIGNoaWxkIHRoYXQgaXMgZHJhd24sIG91ciBuZXh0IHBlZXIgaXMgZHJhd246IGluc3RhbGwgcmlnaHQgYmVmb3JlIG91ciBuZXh0IHBlZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gICA1LSBPdXIgcHJldmlvdXMgcGVlciBpcyBub3QgZHJhd24sIHdlIGhhdmUgbm8gY2hpbGQgdGhhdCBpcyBkcmF3biwgb3VyIG5leHQgcGVlciBpcyBub3QgZHJhd246IGluc3RhbGwgcmlnaHQgYWZ0ZXIgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsUHJldklkID0gcG9zIDw9MCA/IG9iakRhdGEucGFyZW50IDogZmluZExhc3RDbG9zZWROb2RlKHRoaXMscGVlcnNbcG9zLTFdKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxQcmV2ID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsUHJldklkKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxOZXh0SWQgPSBwb3MgPj0gcGVlcnMubGVuZ3RoLTEgPyBcIk5VTExcIiA6IHBlZXJzW3BvcysxXTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxOZXh0ID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsTmV4dElkKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxDaGlsZElkID0gb2JqRGF0YS5jaGlsZHJlbiAmJiBvYmpEYXRhLmNoaWxkcmVuLmxlbmd0aCA+IDAgPyBvYmpEYXRhLmNoaWxkcmVuWzBdIDogXCJOVUxMXCI7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsQ2hpbGQgPSBmaW5kRGF0YUNlbGwoZGF0YUNlbGwsZ3JpZENlbGxDaGlsZElkKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxQYXJlbnQgPSBmaW5kRGF0YUNlbGwoZGF0YUNlbGwsZ3JpZENlbGxQYXJlbnRJZCk7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBvdXIgcGFyZW50IGlzIGFscmVhZHkgZHJhd24sIHRoZW4gd2UgcHV0IHRoaXMgaW4gdGhlIHJpZ2h0IG9yZGVyIHVuZGVyIG91ciBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRDZWxsUGFyZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFBhcmVudCAmJiBncmlkQ2VsbFBhcmVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRDZWxsUHJldiAmJiBncmlkQ2VsbFByZXYubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEFmdGVyKGdyaWRDZWxsUHJldik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChncmlkQ2VsbENoaWxkICYmIGdyaWRDZWxsQ2hpbGQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEJlZm9yZShncmlkQ2VsbENoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRDZWxsTmV4dCAmJiBncmlkQ2VsbE5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEJlZm9yZShncmlkQ2VsbE5leHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuaW5zZXJ0QWZ0ZXIoZ3JpZENlbGxQYXJlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhbHdheXMgcHV0IGl0IGluIHRoZSBob2xkaW5nIGNlbGxzLCBhbmQgdGhlbiBzb3J0IHdoZW4gdGhlIHBhcmVudCBjb21lcyBpbiwgaW4gY2FzZSBwYXJlbnQgaXMgKHJlKWRyYXduIGxhdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBoY1tncmlkQ2VsbE5hbWUraV0gPSBsYXN0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRDZWxsUHJldiAmJiBncmlkQ2VsbFByZXYubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuaW5zZXJ0QWZ0ZXIoZ3JpZENlbGxQcmV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ3JpZENlbGxDaGlsZCAmJiBncmlkQ2VsbENoaWxkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEJlZm9yZShncmlkQ2VsbENoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ3JpZENlbGxOZXh0ICYmIGdyaWRDZWxsTmV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxOZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hcHBlbmRUbyhkYXRhQ2VsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZG8gd2UgaGF2ZSBhbnkgY2hpbGRyZW4gd2FpdGluZyBmb3IgdGhpcyBjZWxsPyB3YWxrIGRvd24gdGhyb3VnaCB0aGUgY2hpbGRyZW4vZ3JhbmRjaGlsZHJlbi9ldGMgdHJlZVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuYWZ0ZXIodGhpcy5nZXRIb2xkaW5nQ2VsbHMob2JqRGF0YSxpLGhjKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gbmVlZCB0byBtYWtlIHRoZSBoZWlnaHQgb2YgdGhpcyBtYXRjaCB0aGUgbGluZSBoZWlnaHQgb2YgdGhlIHRyZWUuIEhvdz9cbiAgICAgICAgICAgICAgICAgICAgc3BhbiA9IGxhc3QuY2hpbGRyZW4oXCJzcGFuXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIHNwYW4gaW5zaWRlIHRoZSBkaXYsIHNvIHdlIGNhbiBjb250cm9sIHdoYXQgaGFwcGVucyBpbiB0aGUgd2hvbGUgZGl2IHZlcnN1cyBpbnNpZGUganVzdCB0aGUgdGV4dC9iYWNrZ3JvdW5kXG4gICAgICAgICAgICAgICAgICAgIHNwYW4uYWRkQ2xhc3MoY2wrXCIgXCIrdmFsQ2xhc3MpLmh0bWwoY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBsYXN0LmNzcyhjb25mKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGwganN0cmVlLWdyaWQtY2VsbC1yb290LVwiK3Jvb3RpZCtcIiBqc3RyZWUtZ3JpZC1jZWxsLVwiK2NsYXNzQWRkK1wiIFwiK3djbCsgXCIgXCIgKyB3aWRlVmFsQ2xhc3MgKyAodHI/XCIgdWktc3RhdGUtZGVmYXVsdFwiOlwiXCIpKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNvbC1cIitpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGNsaWNrIGhhbmRsZXIgZm9yIGNsaWNraW5nIGluc2lkZSBhIGdyaWQgY2VsbFxuICAgICAgICAgICAgICAgICAgICBsYXN0LmNsaWNrKGNlbGxDbGlja0hhbmRsZXIodHJlZSx0LHZhbCxjb2wsdGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0Lm9uKFwiY29udGV4dG1lbnVcIixjZWxsUmlnaHRDbGlja0hhbmRsZXIodHJlZSx0LHZhbCxjb2wsdGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0LmhvdmVyKGhvdmVySW5IYW5kbGVyKHQsIHRoaXMpLCBob3Zlck91dEhhbmRsZXIodCwgdGhpcykpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5hdHRyKFwidGl0bGVcIix0aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKFwianN0cmVlLWdyaWQtY2VsbC1sYXN0XCIrKHRyP1wiIHVpLXN0YXRlLWRlZmF1bHRcIjpcIlwiKSk7XG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gd2lkdGggZ2l2ZW4gZm9yIHRoZSBsYXN0IGNvbHVtbiwgZG8gaXQgdmlhIGF1dG9tYXRpY1xuICAgICAgICAgICAgICAgIGlmIChjb2xzW2NvbHMubGVuZ3RoLTFdLndpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdpZHRoLWF1dG9cIikubmV4dChcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3JcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcyh7J292ZXJmbG93LXknOidhdXRvICFpbXBvcnRhbnQnfSk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIGNsZWFuIHVwIGhvbGRpbmcgY2VsbHNcbiAgICAgICAgdGhpcy5ob2xkaW5nQ2VsbHMgPSB7fTtcblxuICAgICAgICAvLyBuZWVkIHRvIGRvIGFsdGVybmF0aW5nIGJhY2tncm91bmQgY29sb3JzIG9yIGJvcmRlcnNcbiAgICB9O1xufSkpO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL2Ntcy9zdGF0aWMvY21zL2pzL2xpYnMvanN0cmVlL2pzdHJlZS5ncmlkLm1pbi5qc1xuICoqIG1vZHVsZSBpZCA9IDEwXG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iLCJ2YXIgJCA9IHJlcXVpcmUoJ2pxdWVyeScpO1xudmFyIENsYXNzID0gcmVxdWlyZSgnY2xhc3NqcycpO1xuXG4vKipcbiAqIERyb3Bkb3ducyBpbiB0aGUgcGFnZXRyZWUuXG4gKiBIYXZlIHRvIGJlIGRlbGVnYXRlZCwgc2luY2UgcGFnZXRyZWUgbm9kZXMgY2FuIGJlXG4gKiBsYXp5IGxvYWRlZC5cbiAqXG4gKiBAY2xhc3MgUGFnZVRyZWVEcm9wZG93bnNcbiAqIEBuYW1lc3BhY2UgQ01TXG4gKi9cbnZhciBQYWdlVHJlZURyb3Bkb3ducyA9IG5ldyBDbGFzcyh7XG4gICAgb3B0aW9uczoge1xuICAgICAgICBkcm9wZG93blNlbGVjdG9yOiAnLmpzLWNtcy1wYWdldHJlZS1kcm9wZG93bicsXG4gICAgICAgIHRyaWdnZXJTZWxlY3RvcjogJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tdHJpZ2dlcicsXG4gICAgICAgIG1lbnVTZWxlY3RvcjogJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tbWVudScsXG4gICAgICAgIG9wZW5DbHM6ICdjbXMtcGFnZXRyZWUtZHJvcGRvd24tbWVudS1vcGVuJ1xuICAgIH0sXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY2xpY2sgPSAnY2xpY2suY21zLnBhZ2V0cmVlLmRyb3Bkb3duJztcblxuICAgICAgICB0aGlzLl9zZXR1cFVJKCk7XG4gICAgICAgIHRoaXMuX2V2ZW50cygpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHRoaXMudWkgPSB7XG4gICAgICAgICAgICBjb250YWluZXI6IHRoaXMub3B0aW9ucy5jb250YWluZXIsXG4gICAgICAgICAgICBkb2N1bWVudDogJChkb2N1bWVudClcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRXZlbnQgaGFuZGxlcnMuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9ldmVudHNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9ldmVudHM6IGZ1bmN0aW9uIF9ldmVudHMoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAvLyBhdHRhY2ggZXZlbnQgdG8gdGhlIHRyaWdnZXJcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgdGhpcy5vcHRpb25zLnRyaWdnZXJTZWxlY3RvciwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHRoYXQuX3RvZ2dsZURyb3Bkb3duKHRoaXMpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzdG9wIHByb3BhZ2F0aW9uIG9uIHRoZSBlbGVtZW50XG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRoYXQub3B0aW9ucy5tZW51U2VsZWN0b3IsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGF0Lm9wdGlvbnMubWVudVNlbGVjdG9yICsgJyBhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhhdC5jbG9zZUFsbERyb3Bkb3ducygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKHRoaXMuY2xpY2ssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuY2xvc2VBbGxEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3RvZ2dsZURyb3Bkb3duXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IHRyaWdnZXIgdHJpZ2dlciBjbGlja2VkXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbnx2b2lkfVxuICAgICAqL1xuICAgIF90b2dnbGVEcm9wZG93bjogZnVuY3Rpb24gX3RvZ2dsZURyb3Bkb3duKHRyaWdnZXIpIHtcbiAgICAgICAgdmFyIGRyb3Bkb3ducyA9ICQodGhpcy5vcHRpb25zLmRyb3Bkb3duU2VsZWN0b3IpO1xuICAgICAgICB2YXIgZHJvcGRvd24gPSAkKHRyaWdnZXIpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmRyb3Bkb3duU2VsZWN0b3IpO1xuXG4gICAgICAgIC8vIGNhbmNlbCBpZiBvcGVuZWQgdG9vbHRpcCBpcyB0cmlnZ2VyZWQgYWdhaW5cbiAgICAgICAgaWYgKGRyb3Bkb3duLmhhc0NsYXNzKHRoaXMub3B0aW9ucy5vcGVuQ2xzKSkge1xuICAgICAgICAgICAgZHJvcGRvd25zLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5vcGVuQ2xzKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG90aGVyd2lzZSBzaG93IHRoZSBkcm9wZG93blxuICAgICAgICBkcm9wZG93bnMucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLm9wZW5DbHMpO1xuICAgICAgICBkcm9wZG93bi5hZGRDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscyk7XG5cbiAgICAgICAgdGhpcy5fbG9hZENvbnRlbnQoZHJvcGRvd24pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9sb2FkQ29udGVudFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IGRyb3Bkb3duXG4gICAgICogQHJldHVybnMge0Jvb2xlYW58JC5EZWZlcnJlZH0gZmFsc2UgaWYgbm90IGxhenkgb3IgYWxyZWFkeSBsb2FkZWQgb3IgcHJvbWlzZVxuICAgICAqL1xuICAgIF9sb2FkQ29udGVudDogZnVuY3Rpb24gX2xvYWRDb250ZW50KGRyb3Bkb3duKSB7XG4gICAgICAgIHZhciBkYXRhID0gZHJvcGRvd24uZGF0YSgpO1xuICAgICAgICB2YXIgTE9BREVSX1NIT1dfVElNRU9VVCA9IDIwMDtcblxuICAgICAgICBpZiAoIWRhdGEubGF6eVVybCB8fCBkYXRhLmxvYWRlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxvYWRlclRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRyb3Bkb3duLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tbG9hZGVyJykuYWRkQ2xhc3MoJ2Ntcy1sb2FkZXInKTtcbiAgICAgICAgfSwgTE9BREVSX1NIT1dfVElNRU9VVCk7XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogZGF0YS5sYXp5VXJsLFxuICAgICAgICAgICAgZGF0YTogZGF0YS5sYXp5VXJsRGF0YVxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgZHJvcGRvd24uZmluZCgnLmpzLWNtcy1wYWdldHJlZS1kcm9wZG93bi1tZW51JykuaHRtbChyZXNwb25zZSk7XG4gICAgICAgICAgICBkcm9wZG93bi5kYXRhKCdsb2FkZWQnLCB0cnVlKTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChsb2FkZXJUaW1lb3V0KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY2xvc2VBbGxEcm9wZG93bnNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgY2xvc2VBbGxEcm9wZG93bnM6IGZ1bmN0aW9uIGNsb3NlQWxsRHJvcGRvd25zKCkge1xuICAgICAgICAkKHRoaXMub3B0aW9ucy5kcm9wZG93blNlbGVjdG9yKS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscyk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFnZVRyZWVEcm9wZG93bnM7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vY21zL3N0YXRpYy9jbXMvanMvbW9kdWxlcy9jbXMucGFnZXRyZWUuZHJvcGRvd24uanNcbiAqKiBtb2R1bGUgaWQgPSAxMVxuICoqIG1vZHVsZSBjaHVua3MgPSAyXG4gKiovIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbnZhciAkID0gcmVxdWlyZSgnanF1ZXJ5Jyk7XG52YXIgQ2xhc3MgPSByZXF1aXJlKCdjbGFzc2pzJyk7XG52YXIgSGVscGVycyA9IHJlcXVpcmUoJy4vY21zLmJhc2UnKS5BUEkuSGVscGVycztcblxuLyoqXG4gKiBTdGlja3kgbGFuZ3VhZ2UgaGVhZGVycyBpbiBwYWdldHJlZVxuICpcbiAqIEBjbGFzcyBQYWdlVHJlZVN0aWNreUhlYWRlclxuICogQG5hbWVzcGFjZSBDTVNcbiAqL1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gbmV3IENsYXNzKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGF0Lm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB0aGF0LnJlc2l6ZSA9ICdyZXNpemUuY21zLnBhZ2V0cmVlLmhlYWRlcic7XG4gICAgICAgIHRoYXQuc2Nyb2xsID0gJ3Njcm9sbC5jbXMucGFnZXRyZWUuaGVhZGVyJztcbiAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IGZhbHNlO1xuXG4gICAgICAgIHRoYXQuX3NldHVwVUkoKTtcbiAgICAgICAgdGhhdC5fc2F2ZVNpemVzKCk7XG4gICAgICAgIHRoYXQuX2V2ZW50cygpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGNvbnRhaW5lci5maW5kKCcuanN0cmVlLWdyaWQtaGVhZGVyJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgd2luZG93OiAkKHdpbmRvdyksXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgY29sdW1uczogY29udGFpbmVyLmZpbmQoJy5qc3RyZWUtZ3JpZC1jb2x1bW4nKS50b0FycmF5KCkubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKGVsKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2xvbmVzOiBoZWFkZXJzLmNsb25lKCkudG9BcnJheSgpLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJChlbCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgcG9zaXRpb25zL3NpemVzIG9mIGVsZW1lbnRzXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zYXZlU2l6ZXNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zYXZlU2l6ZXM6IGZ1bmN0aW9uIF9zYXZlU2l6ZXMoKSB7XG4gICAgICAgIHRoaXMuaGVhZGVyc1RvcE9mZnNldCA9IHRoaXMudWkuaGVhZGVycy5vZmZzZXQoKS50b3A7XG4gICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IDA7XG4gICAgICAgIGlmICh0aGlzLl9pc0luU2lkZWZyYW1lKCkpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IENNUy5BUEkuSGVscGVycy5fZ2V0V2luZG93KCkucGFyZW50LkNNUy4kKCcuY21zLXRvb2xiYXInKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIHZhciBkZWJ1ZyA9IEhlbHBlcnMuX2dldFdpbmRvdygpLnBhcmVudC5DTVMuJCgnLmNtcy1kZWJ1Zy1iYXInKTtcblxuICAgICAgICAgICAgaWYgKGRlYnVnLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCArPSBkZWJ1Zy5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b29sYmFySGVpZ2h0ID0gJCgnI2JyYW5kaW5nJykuaGVpZ2h0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfaXNJblNpZGVmcmFtZVxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBhcmUgd2UgaW4gc2lkZWZyYW1lP1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2lzSW5TaWRlZnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuXG4gICAgICAgIGlmICh3aW4gJiYgd2luLnBhcmVudCAmJiB3aW4ucGFyZW50ICE9PSB3aW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFdmVudCBoYW5kbGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgdGhpcy51aS53aW5kb3cub24oXG4gICAgICAgICAgICBbdGhpcy5yZXNpemUsIHRoaXMuc2Nyb2xsXS5qb2luKCcgJyksXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVSZXNpemVPclNjcm9sbC5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2hhbmRsZVJlc2l6ZU9yU2Nyb2xsXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaGFuZGxlUmVzaXplT3JTY3JvbGw6IGZ1bmN0aW9uIF9oYW5kbGVSZXNpemVPclNjcm9sbCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2Nyb2xsVG9wID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsVG9wKCk7XG4gICAgICAgIHZhciBzY3JvbGxMZWZ0ID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsTGVmdCgpO1xuXG4gICAgICAgIGlmICh0aGF0Ll9zaG91bGRTdGljayhzY3JvbGxUb3ApKSB7XG4gICAgICAgICAgICB0aGF0Ll9zdGlja0hlYWRlcihzY3JvbGxUb3AsIHNjcm9sbExlZnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhhdC5fdW5zdGlja0hlYWRlcigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Nob3VsZFN0aWNrXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcCBwb3NpdGlvbiBpbiBwaXhlbHNcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gc2hvdWxkIGhlYWRlcnMgc3RpY2tcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zaG91bGRTdGljazogZnVuY3Rpb24gKHNjcm9sbFRvcCkge1xuICAgICAgICByZXR1cm4gc2Nyb2xsVG9wICsgdGhpcy50b29sYmFySGVpZ2h0ID49IHRoaXMuaGVhZGVyc1RvcE9mZnNldDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc3RpY2tIZWFkZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2Nyb2xsVG9wIHRvcFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzY3JvbGxMZWZ0IGxlZnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zdGlja0hlYWRlcjogZnVuY3Rpb24gX3N0aWNrSGVhZGVyKHNjcm9sbFRvcCwgc2Nyb2xsTGVmdCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC5faW5zZXJ0Q2xvbmVzKCk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB0aGF0LnVpLmNsb25lc1tpbmRleF0uY3NzKCd3aWR0aCcpO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoYXQudWkuY2xvbmVzW2luZGV4XS5vZmZzZXQoKS5sZWZ0O1xuXG4gICAgICAgICAgICBlbC5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBvZmZzZXQgLSBzY3JvbGxMZWZ0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmFkZENsYXNzKCdqc3RyZWUtZ3JpZC1oZWFkZXItZml4ZWQnKS5jc3Moe1xuICAgICAgICAgICAgdG9wOiB0aGF0LnRvb2xiYXJIZWlnaHRcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Vuc3RpY2tIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91bnN0aWNrSGVhZGVyOiBmdW5jdGlvbiBfdW5zdGlja0hlYWRlcigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQuX2RldGFjaENsb25lcygpO1xuXG4gICAgICAgIHRoYXQudWkuaGVhZGVycy5yZW1vdmVDbGFzcygnanN0cmVlLWdyaWQtaGVhZGVyLWZpeGVkJykuY3NzKHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICBsZWZ0OiAnYXV0bydcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluc2VydHMgY2xvbmVzIG9mIGhlYWRlcnMgc28gd2hlbiBoZWFkZXIgYmVjb21lcyBzdGlja3kgdGhlXG4gICAgICogcGFnZXRyZWUgZG9lc24ndCBqdW1wLiBPbmx5IGRvZXMgaXQgb25jZSBhbmQgc2V0cyB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2luc2VydENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luc2VydENsb25lczogZnVuY3Rpb24gX2luc2VydENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhhdC5hcmVDbG9uZXNJbkRPTSkge1xuICAgICAgICAgICAgdGhhdC51aS5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGVsLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIGVsLnByZXBlbmQodGhhdC51aS5jbG9uZXNbaW5kZXhdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXRhY2hlcyB0aGUgY2xvbmVzIG9mIGhlYWRlcnMgc28gdGhlbiBoZWFkZXJzIFwidW5zdGlja3NcIlxuICAgICAqIHRoZSBwYWdldHJlZSBkb2Vzbid0IGp1bXAuIFJlbGllcyBvbiB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2RldGFjaENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2RldGFjaENsb25lczogZnVuY3Rpb24gX2RldGFjaENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0aGF0LmFyZUNsb25lc0luRE9NKSB7XG4gICAgICAgICAgICB0aGF0LnVpLmNsb25lcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIGVsLmRldGFjaCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGF0LmFyZUNsb25lc0luRE9NID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhZ2VUcmVlU3RpY2t5SGVhZGVyO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLnN0aWNreWhlYWRlci5qc1xuICoqIG1vZHVsZSBpZCA9IDEyXG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9
>>>>>>> 4f78325... wip
=======
t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"===e.id?!1:"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},30:function(e,t,i){var r=i(1),s=i(3),n=i(2).API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a}});
>>>>>>> 046b030... trimmed bundles
=======
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9hZG1pbi5wYWdldHJlZS5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9saWJzL2pzdHJlZS9qc3RyZWUubWluLmpzIiwid2VicGFjazovLy8uL2Ntcy9zdGF0aWMvY21zL2pzL2xpYnMvanN0cmVlL2pzdHJlZS5ncmlkLm1pbi5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5kcm9wZG93bi5qcyIsIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9tb2R1bGVzL2Ntcy5wYWdldHJlZS5zdGlja3loZWFkZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7QUNSQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlDQUF3Qzs7QUFFeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQixjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCLGNBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakIsY0FBYTtBQUNiLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakIsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBLDhCQUE2QixnQ0FBZ0M7QUFDN0QsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSw4QkFBNkIsaUNBQWlDO0FBQzlELFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGdCQUFlLE9BQU87QUFDdEIsZ0JBQWUsT0FBTztBQUN0QjtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCLE1BQU07QUFDdkI7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixnQkFBZSxPQUFPO0FBQ3RCLGdCQUFlLE9BQU87QUFDdEIsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsV0FBVztBQUM1QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsbURBQWtELEdBQUc7QUFDckQ7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxVQUFTO0FBQ1Q7QUFDQSxVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBZ0UsR0FBRztBQUNuRTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQSxjQUFhO0FBQ2I7QUFDQSxjQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGdDQUErQixxQkFBcUI7QUFDcEQ7QUFDQTs7QUFFQTtBQUNBLGNBQWE7QUFDYixVQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEIsa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtREFBa0QsR0FBRztBQUNyRDtBQUNBLFVBQVM7QUFDVDtBQUNBLFVBQVM7QUFDVDtBQUNBLFVBQVM7QUFDVCxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQixPQUFPO0FBQ3hCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVCxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpRUFBZ0U7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2IsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYixVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0EsY0FBYTtBQUNiLFVBQVM7QUFDVCxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBLFVBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFlLE9BQU87QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQSxzREFBcUQ7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUIsSUFBSTtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxpQ0FBZ0MsSUFBSTs7QUFFcEM7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQixTQUFTO0FBQzFCO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxFQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUM7O0FBRUQ7Ozs7Ozs7QUM3L0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhLGFBQWEsMGVBQW9KLGVBQWUsYUFBYSxjQUFjLHlHQUF5RyxnYUFBZ2EsV0FBVyxTQUFTLFlBQVksV0FBVyxXQUFXLDJGQUEyRixXQUFXLGdCQUFnQiwrQkFBK0IsaUNBQWlDLHVCQUF1Qix5RkFBeUYsaUNBQWlDLHNDQUFzQyw2QkFBNkIsMERBQTBELDJCQUEyQixrREFBa0QsTUFBTSxRQUFRLHlCQUF5QiwwQkFBMEIsMkNBQTJDLGdDQUFnQyxrQkFBa0IsZ0VBQWdFLE9BQU8sVUFBVSxxQkFBcUIsNENBQTRDLFVBQVUsMkdBQTJHLDZCQUE2QiwyQ0FBMkMsSUFBSSx5QkFBeUIsMEVBQTBFLGlEQUFpRCxnREFBZ0QsK0lBQStJLDZCQUE2QixvREFBb0QsbUJBQW1CLHlEQUF5RCwwQkFBMEIsb0ZBQW9GLDJFQUEyRSxzRUFBc0UsMEJBQTBCLHFCQUFxQiwwQkFBMEIsMEJBQTBCLHNDQUFzQyxvQkFBb0IsYUFBYSxPQUFPLGtFQUFrRSw2Q0FBNkMsa0NBQWtDLHlFQUF5RSxXQUFXLHNuQkFBc25CLDBFQUEwRSwya0JBQTJrQixxQkFBcUIsaUJBQWlCLHFEQUFxRCxVQUFVLHdDQUF3QyxxQkFBcUIsa0lBQWtJLG9EQUFvRCxvQkFBb0IsaUJBQWlCLG9CQUFvQiw4Q0FBOEMsdUVBQXVFLHNEQUFzRCw2QkFBNkIsNEJBQTRCLElBQUksaUNBQWlDLFlBQVksNENBQTRDLDZEQUE2RCx3REFBd0QsbUJBQW1CLHNEQUFzRCwyQkFBMkIsa0VBQWtFLDBJQUEwSSwrREFBK0QsdUhBQXVILGlFQUFpRSx1RUFBdUUscUZBQXFGLFdBQVcsMEZBQTBGLGtFQUFrRSxNQUFNLHFEQUFxRCxNQUFNLCtNQUErTSxNQUFNLGtIQUFrSCxNQUFNLHNHQUFzRyx1REFBdUQsb0tBQW9LLE1BQU0sa0hBQWtILE1BQU0seUJBQXlCLE1BQU0sd0lBQXdJLE1BQU0saUdBQWlHLE1BQU0sd0RBQXdELG9EQUFvRCwrU0FBK1MsMEVBQTBFLDZEQUE2RCw4Q0FBOEMsYUFBYSwwQ0FBMEMsSUFBSSxzRUFBc0UsOENBQThDLElBQUksOEJBQThCLHdCQUF3QixpREFBaUQsRUFBRSx1QkFBdUIsV0FBVyxpREFBaUQsdUVBQXVFLDJDQUEyQyxLQUFLLE1BQU0sNklBQTZJLG9CQUFvQix5Q0FBeUMsOEVBQThFLGlCQUFpQiwyQ0FBMkMsOEVBQThFLGlCQUFpQixpREFBaUQsMkJBQTJCLDJDQUEyQyw2RUFBNkUsaUJBQWlCLDZDQUE2Qyw2RUFBNkUsa0JBQWtCLDRDQUE0QyxnQ0FBZ0MsMkxBQTJMLCtDQUErQyxnTUFBZ00sOERBQThELHlIQUF5SCwrREFBK0QscUNBQXFDLGtMQUFrTCw2Q0FBNkMsOENBQThDLElBQUksbUVBQW1FLHVDQUF1QyxvRUFBb0UsaUNBQWlDLG9FQUFvRSxtQ0FBbUMsUUFBUSxtQkFBbUIsMERBQTBELHVCQUF1QixRQUFRLG1GQUFtRiwwQkFBMEIsb0JBQW9CLDZCQUE2Qix5REFBeUQsd0JBQXdCLGlDQUFpQyxxREFBcUQseUJBQXlCLHNCQUFzQiwrQ0FBK0MsU0FBUywwQkFBMEIsdUJBQXVCLCtDQUErQyxTQUFTLDhCQUE4QiwyQkFBMkIsbURBQW1ELFNBQVMsd0JBQXdCLGtCQUFrQixNQUFNLElBQUksNkNBQTZDLHdHQUF3RywrTUFBK00sc0pBQXNKLEtBQUssaUVBQWlFLGtDQUFrQyw0R0FBNEcsU0FBUyxVQUFVLDBCQUEwQixnRkFBZ0YsYUFBYSxpREFBaUQsSUFBSSx1REFBdUQsNENBQTRDLDRCQUE0QixNQUFNLGlEQUFpRCwrQ0FBK0MsbURBQW1ELGlCQUFpQiwwQkFBMEIsTUFBTSxPQUFPLDBCQUEwQiw2QkFBNkIsaUJBQWlCLDhCQUE4QixzREFBc0QsbURBQW1ELHdCQUF3QixPQUFPLDBCQUEwQiw2QkFBNkIsc0dBQXNHLDRCQUE0QixNQUFNLGlEQUFpRCx1Q0FBdUMsdURBQXVELGlCQUFpQiwwQkFBMEIsTUFBTSxPQUFPLDhCQUE4Qiw2QkFBNkIsaUJBQWlCLE9BQU8sOEJBQThCLDZCQUE2QixhQUFhLE9BQU8sK0dBQStHLFNBQVMsb0dBQW9HLHdCQUF3Qiw4REFBOEQsOEJBQThCLDRLQUE0Syx1QkFBdUIsd0VBQXdFLHVCQUF1Qiw0Q0FBNEMsd0JBQXdCLHNEQUFzRCxxQkFBcUIsNENBQTRDLHVCQUF1QixnRUFBZ0UscUJBQXFCLHlCQUF5Qix5QkFBeUIsY0FBYyx3REFBd0Qsd0RBQXdELG1CQUFtQiw2Q0FBNkMsSUFBSSwwSEFBMEgscUNBQXFDLEVBQUUsOEJBQThCLElBQUksc0dBQXNHLHdGQUF3RixxQ0FBcUMsNERBQTRELDREQUE0RCxFQUFFLHNKQUFzSiw0RkFBNEYsMERBQTBELDRCQUE0QixJQUFJLHlEQUF5RCxLQUFLLE1BQU0sc1FBQXNRLGdCQUFnQixzQkFBc0IsV0FBVywrQkFBK0Isc0JBQXNCLHlCQUF5Qiw2QkFBNkIsbUJBQW1CLElBQUkseUhBQXlILE1BQU0sbUJBQW1CLElBQUksZ0RBQWdELHdDQUF3Qyx3QkFBd0IsdURBQXVELHFEQUFxRCwwREFBMEQsSUFBSSxnRUFBZ0UsdUNBQXVDLG1CQUFtQiw4Q0FBOEMsT0FBTyxHQUFHLDBCQUEwQixnQ0FBZ0MsMkRBQTJELGlKQUFpSix5QkFBeUIsZ0JBQWdCLGVBQWUsRUFBRSxrREFBa0QsOElBQThJLDBDQUEwQyw0RkFBNEYsZUFBZSw2R0FBNkcseUJBQXlCLGNBQWMsZUFBZSwrQkFBK0IsMEZBQTBGLGNBQWMsRUFBRSxpRkFBaUYsaUNBQWlDLDRDQUE0QywwRkFBMEYsY0FBYyxFQUFFLGdFQUFnRSx5SUFBeUksZUFBZSwrQkFBK0IsNEZBQTRGLFFBQVEsRUFBRSx1TEFBdUwseUJBQXlCLGNBQWMsZUFBZSwrQkFBK0IsNEZBQTRGLFFBQVEsRUFBRSw2TUFBNk0sZUFBZSxrQkFBa0IsMkJBQTJCLHFEQUFxRCxtQ0FBbUMsaURBQWlELG1IQUFtSCxpQ0FBaUMsd0lBQXdJLDJEQUEyRCxJQUFJLG9FQUFvRSxzQkFBc0IsaUJBQWlCLDJNQUEyTSxpREFBaUQsa0JBQWtCLHFDQUFxQyx3QkFBd0IsMEhBQTBILGNBQWMsMEhBQTBILGlCQUFpQixtQkFBbUIsNEdBQTRHLGtDQUFrQyxpQ0FBaUMsMElBQTBJLFVBQVUsTUFBTSxTQUFTLFNBQVMsY0FBYyxrREFBa0QsZ1FBQWdRLG1HQUFtRyw2R0FBNkcsdUlBQXVJLHdIQUF3SCxJQUFJLG1JQUFtSSw4RkFBOEYsbUJBQW1CLGtDQUFrQyxtQkFBbUIsb0JBQW9CLFlBQVksR0FBRyxnSkFBZ0osVUFBVSxNQUFNLFNBQVMsU0FBUyxjQUFjLGtEQUFrRCwyVEFBMlQsbUdBQW1HLDZHQUE2Ryw2TUFBNk0scUNBQXFDLDRCQUE0QixJQUFJLDhIQUE4SCw2Q0FBNkMscUxBQXFMLDJDQUEyQyxtQkFBbUIsSUFBSSxpRUFBaUUsbUJBQW1CLElBQUksc0dBQXNHLDRCQUE0QixJQUFJLCtHQUErRywyQkFBMkIsSUFBSSxvRUFBb0UsR0FBRyxxQ0FBcUMsS0FBSyxtQkFBbUIsSUFBSSxrSEFBa0gsdURBQXVELElBQUksb0VBQW9FLEdBQUcscUNBQXFDLDRGQUE0RixpQkFBaUIsd0JBQXdCLGdCQUFnQix5QkFBeUIsc0dBQXNHLDZCQUE2Qix5REFBeUQsaUdBQWlHLG1CQUFtQixJQUFJLGdGQUFnRixtQkFBbUIsSUFBSSx5REFBeUQsc0dBQXNHLHlCQUF5Qix3SEFBd0gsaURBQWlELG9CQUFvQix5RUFBeUUsNEdBQTRHLHVCQUF1QiwySEFBMkgsdUJBQXVCLElBQUkscUJBQXFCLFVBQVUsdUlBQXVJLG9OQUFvTixTQUFTLDRKQUE0SiwyQkFBMkIsd0NBQXdDLG9DQUFvQyw4QkFBOEIscUZBQXFGLFVBQVUsTUFBTSxTQUFTLFNBQVMsYUFBYSxPQUFPLDBIQUEwSCxzREFBc0Qsb0ZBQW9GLDBGQUEwRixzQ0FBc0MsMk9BQTJPLHVSQUF1Uix3UEFBd1AsbUNBQW1DLFlBQVksMEZBQTBGLDBKQUEwSixrWkFBa1osNkNBQTZDLGtDQUFrQyxnRkFBZ0YsMElBQTBJLFVBQVUsTUFBTSxTQUFTLFNBQVMsY0FBYyxrREFBa0QsZ1FBQWdRLG1HQUFtRyw2R0FBNkcsdUlBQXVJLHdIQUF3SCxJQUFJLGtLQUFrSyxxSEFBcUgsd0NBQXdDLGtDQUFrQyxrRUFBa0UsbUNBQW1DLFlBQVksR0FBRyxnSkFBZ0osVUFBVSxNQUFNLFNBQVMsU0FBUyxjQUFjLGtEQUFrRCwyVEFBMlQsbUdBQW1HLDZHQUE2Ryw2TUFBNk0scUNBQXFDLDRCQUE0QixJQUFJLHdKQUF3Siw2Q0FBNkMsMk1BQTJNLG9CQUFvQiwrS0FBK0ssbUJBQW1CLElBQUksaUhBQWlILGtZQUFrWSxRQUFRLEVBQUUsb0JBQW9CLHFEQUFxRCwyQkFBMkIsMENBQTBDLGVBQWUsK0NBQStDLGdEQUFnRCxxRkFBcUYsaUhBQWlILElBQUkseURBQXlELGtCQUFrQiwrQkFBK0Isb0hBQW9ILGVBQWUsK0NBQStDO0FBQ3RzK0Isc1BBQXFQLGlCQUFpQixzSkFBc0osMEVBQTBFLG1DQUFtQyxtREFBbUQscUJBQXFCLDJEQUEyRCwwUUFBMFEsSUFBSSx1Q0FBdUMsS0FBSyxNQUFNLCtJQUErSSxJQUFJLDJGQUEyRix1VkFBdVYsaURBQWlELDBDQUEwQywyRUFBMkUsb3ZCQUFvdkIsaUhBQWlILElBQUksd0RBQXdELGlCQUFpQiwyQkFBMkIscURBQXFELElBQUksOEdBQThHLGtCQUFrQixNQUFNLHVVQUF1VSx5RkFBeUYsMEJBQTBCLGFBQWEsMkJBQTJCLFlBQVksaUJBQWlCLCtCQUErQixJQUFJLDZCQUE2QixTQUFTLDBYQUEwWCxPQUFPLDJNQUEyTSw4Q0FBOEMsT0FBTyxFQUFFLGdDQUFnQyxPQUFPLDRMQUE0TCxPQUFPLDRCQUE0QixPQUFPLDBDQUEwQyxPQUFPLHVEQUF1RCxzQkFBc0IsZ0RBQWdELHNEQUFzRCxnQ0FBZ0Msc0JBQXNCLHdEQUF3RCxvQkFBb0IsbUJBQW1CLElBQUksa0RBQWtELGlFQUFpRSwwQkFBMEIsWUFBWSxpQkFBaUIsK0JBQStCLElBQUksNEJBQTRCLFNBQVMseUxBQXlMLE9BQU8sNE9BQTRPLHVGQUF1RixPQUFPLEVBQUUscUtBQXFLLE9BQU8sK0JBQStCLE9BQU8sT0FBTyx5QkFBeUIsUUFBUSxpQkFBaUIsK0JBQStCLElBQUksMkJBQTJCLFNBQVMscUZBQXFGLDBCQUEwQix1REFBdUQsNkVBQTZFLGNBQWMsOEJBQThCLElBQUksMkdBQTJHLGdDQUFnQyxPQUFPLEVBQUUsZ0hBQWdILCtCQUErQiwyQ0FBMkMsT0FBTyxnRUFBZ0Usc0JBQXNCLEVBQUUseUJBQXlCLHVEQUF1RCxrRkFBa0YsOEhBQThILHdCQUF3Qiw2QkFBNkIsSUFBSSxzREFBc0QsMEJBQTBCLE9BQU8sRUFBRSx5QkFBeUIsdURBQXVELHlCQUF5QixRQUFRLGlCQUFpQiwrQkFBK0IsSUFBSSwyQkFBMkIsU0FBUywrTUFBK00sT0FBTyxNQUFNLDBCQUEwQixRQUFRLGlCQUFpQiwrQkFBK0IsSUFBSSw0QkFBNEIsU0FBUyw2TUFBNk0sT0FBTyxNQUFNLHVCQUF1Qiw4Q0FBOEMseUJBQXlCLFFBQVEsaUJBQWlCLCtCQUErQixJQUFJLDRCQUE0QiwyQkFBMkIsa0tBQWtLLE9BQU8sT0FBTyx5QkFBeUIsUUFBUSxpQkFBaUIsK0JBQStCLElBQUksNEJBQTRCLDJCQUEyQixrS0FBa0ssT0FBTyxPQUFPLHNCQUFzQiw4QkFBOEIsd0dBQXdHLGtGQUFrRixRQUFRLElBQUksc0JBQXNCLDhCQUE4Qix1R0FBdUcsa0ZBQWtGLFFBQVEsSUFBSSw2QkFBNkIsZ0NBQWdDLCtCQUErQix5bkJBQXluQixtSUFBbUksbUJBQW1CLElBQUkseUtBQXlLLHdCQUF3QixxRkFBcUYsRUFBRSxnRkFBZ0YsdU5BQXVOLDhCQUE4Qiw4QkFBOEIsRUFBRSx3QkFBd0Isc0ZBQXNGLDBEQUEwRCxxSEFBcUgsc0JBQXNCLHdCQUF3Qix3Q0FBd0MsSUFBSSwwQkFBMEIsNktBQTZLLHNCQUFzQixNQUFNLCtCQUErQixZQUFZLGlCQUFpQiwrQkFBK0IsSUFBSSxpQ0FBaUMsU0FBUywyU0FBMlMsaURBQWlELDZCQUE2QixzRUFBc0UsUUFBUSwrQkFBK0IsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksaUNBQWlDLFNBQVMsb1VBQW9VLGlEQUFpRCw2QkFBNkIsd0VBQXdFLFFBQVEsd0JBQXdCLDhDQUE4Qyx1SEFBdUgsSUFBSSxxSEFBcUgsMkNBQTJDLGtDQUFrQyw2QkFBNkIsc0VBQXNFLEVBQUUsMEJBQTBCLDhDQUE4QywwQ0FBMEMsSUFBSSxxSEFBcUgsOEpBQThKLHlDQUF5Qyw2QkFBNkIsd0VBQXdFLEVBQUUseUJBQXlCLHNFQUFzRSwwQkFBMEIsNERBQTRELHdCQUF3Qix5Q0FBeUMsOEJBQThCLGdDQUFnQyxTQUFTLG1CQUFtQixJQUFJLG9CQUFvQixtQkFBbUIsSUFBSSxxQ0FBcUMsSUFBSSx3REFBd0QsS0FBSywwQ0FBMEMscUNBQXFDLHdCQUF3QixVQUFVLGlDQUFpQyxxQ0FBcUMsbUJBQW1CLElBQUksMENBQTBDLHFDQUFxQyx3QkFBd0IsVUFBVSxzQkFBc0IsT0FBTyxNQUFNLGdCQUFnQiw0REFBNEQsY0FBYyxHQUFHLHFNQUFxTSxTQUFTLHlCQUF5QixNQUFNLFdBQVcsY0FBYywwR0FBMEcsOERBQThELGlEQUFpRCx1T0FBdU8sMEZBQTBGLHVCQUF1QixnREFBZ0QsaUdBQWlHLHVFQUF1RSxtRkFBbUYsU0FBUyx1QkFBdUIsK0JBQStCLGdJQUFnSSxrQ0FBa0MseUVBQXlFLFdBQVcsNEZBQTRGLDJDQUEyQyxxY0FBcWMsaU5BQWlOLG1DQUFtQyx3QkFBd0IsOEJBQThCLEVBQUUsMEJBQTBCLHdEQUF3RCxvREFBb0Qsd0dBQXdHLGdDQUFnQyx5Q0FBeUMsd0VBQXdFLGVBQWUsRUFBRSxjQUFjLHNCQUFzQix3REFBd0Qsa0NBQWtDLHVHQUF1RyxJQUFJLDZFQUE2RSw0QkFBNEIsSUFBSSw4QkFBOEIsOEJBQThCLElBQUksNkVBQTZFLDBTQUEwUyx3QkFBd0IsS0FBSyxzQkFBc0IsNERBQTRELHdCQUF3QixRQUFRLGlCQUFpQiwrQkFBK0IsSUFBSSwwQkFBMEIsU0FBUyx3SUFBd0ksYUFBYSxTQUFTLDBCQUEwQixpREFBaUQsc0JBQXNCLE9BQU8sZ0VBQWdFLGlDQUFpQyxtQkFBbUIsb0NBQW9DLFNBQVMsS0FBSyxpSUFBaUksOE1BQThNLElBQUksK0ZBQStGLHFEQUFxRCxpQ0FBaUMsOERBQThELHVIQUF1SCw2QkFBNkIsRUFBRSxPQUFPLGlDQUFpQywwQkFBMEIsT0FBTyxtREFBbUQsWUFBWSxvRkFBb0Ysd0VBQXdFLE1BQU0seUVBQXlFLE1BQU0sNkJBQTZCLE1BQU0sK0JBQStCLE1BQU0saUJBQWlCLHdLQUF3SywrRkFBK0YscUZBQXFGLG9CQUFvQiw2REFBNkQsSUFBSSxrR0FBa0cscUNBQXFDLElBQUksZ0NBQWdDLGtIQUFrSCw2Q0FBNkMsT0FBTywyQkFBMkIsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksNkJBQTZCLFNBQVMsNkpBQTZKLG9CQUFvQiw4RUFBOEUseUJBQXlCLDRCQUE0QixpQkFBaUIsK0JBQStCLElBQUksMkJBQTJCLFNBQVMsd0RBQXdELHlLQUF5SywySEFBMkgsSUFBSSwwSEFBMEgsMEJBQTBCLEVBQUUsbUJBQW1CLElBQUksOENBQThDLEtBQUssTUFBTSw0RkFBNEYsMEJBQTBCLCtCQUErQixtQkFBbUIsNkJBQTZCLDBFQUEwRSxpQkFBaUIsSUFBSSxrQ0FBa0Msc2JBQXNiLDJCQUEyQiwwREFBMEQsNEZBQTRGLDZRQUE2USx1R0FBdUcsb0RBQW9ELEVBQUUsa0hBQWtILGlJQUFpSSxvREFBb0QsRUFBRSxzQ0FBc0Msa0dBQWtHLG9EQUFvRCxFQUFFLEtBQUssdUJBQXVCLGtDQUFrQyxtQ0FBbUMsZ0NBQWdDLDhDQUE4QyxzR0FBc0csZ0NBQWdDLEVBQUUsaUJBQWlCLGlCQUFpQixtQkFBbUIsSUFBSSwyREFBMkQsd0JBQXdCLE9BQU8sa0VBQWtFLDZhQUE2YSxvRkFBb0YsMENBQTBDLE1BQU0sMkNBQTJDLE1BQU0sNkJBQTZCLE1BQU0sK0JBQStCLE1BQU0saUJBQWlCLDZFQUE2RSwyRUFBMkUsMkVBQTJFLG9CQUFvQixrSEFBa0gsSUFBSSx1QkFBdUIsa0ZBQWtGLEtBQUssZ0VBQWdFLElBQUksS0FBSyxpRUFBaUUsSUFBSSx5Q0FBeUMseUNBQXlDLGdIQUFnSCxJQUFJLGtHQUFrRyxpQ0FBaUMsSUFBSSxnQ0FBZ0MsMk5BQTJOLElBQUksOEtBQThLLDZLQUE2Syx1REFBdUQscUpBQXFKLE9BQU8sbUNBQW1DLDBCQUEwQiw4Q0FBOEMsc0dBQXNHLGdDQUFnQyxFQUFFLGlCQUFpQixpQkFBaUIsbUJBQW1CLElBQUksMkRBQTJELHdCQUF3QixPQUFPLGtFQUFrRSxnVkFBZ1YsMENBQTBDLE1BQU0sMkNBQTJDLE1BQU0sNkJBQTZCLE1BQU0sK0JBQStCLE1BQU0saUJBQWlCLDZFQUE2RSwyRUFBMkUsMkVBQTJFLHFCQUFxQixnQ0FBZ0MsZ0JBQWdCLCtGQUErRiwwSUFBMEksb0JBQW9CLHlCQUF5QixJQUFJLGtHQUFrRyxpQ0FBaUMsSUFBSSxnQ0FBZ0MsMlNBQTJTLG9RQUFvUSxPQUFPLGlCQUFpQixxRkFBcUYsZUFBZSxtQkFBbUIsSUFBSSxtRUFBbUUsbUVBQW1FLE9BQU8sTUFBTSxrQkFBa0IscUZBQXFGLGVBQWUsbUJBQW1CLElBQUksbUVBQW1FLG9FQUFvRSxPQUFPLE1BQU0sdUJBQXVCLE9BQU8sc0JBQXNCLHNCQUFzQixzQkFBc0IscUJBQXFCLHdIQUF3SCwwQkFBMEIsMkJBQTJCLHlCQUF5Qiw0Q0FBNEMsc0JBQXNCLDJCQUEyQiwrRkFBK0YsZ0dBQWdHLHlTQUF5UyxLQUFLLDZFQUE2RSxvQ0FBb0MsMkNBQTJDLHFMQUFxTCwwQkFBMEIsZ0RBQWdELHFGQUFxRix1VEFBdVQsNkJBQTZCLDhFQUE4RSx1Q0FBdUMsMkJBQTJCLGNBQWMsa0tBQWtLLG1CQUFtQiw2QkFBNkIsdUJBQXVCLDZCQUE2QixtQkFBbUIscURBQXFELHNCQUFzQiwrQkFBK0IsS0FBSyw4UkFBOFI7QUFDN2grQiw4QkFBNkIsTUFBTSx5QkFBeUIsZUFBZSxXQUFXLG9DQUFvQyxzREFBc0QsOFlBQThZLFFBQVEsRUFBRSxzQkFBc0IsbUNBQW1DLCtCQUErQix1UUFBdVEsOEJBQThCLHNDQUFzQyx5QkFBeUIscUZBQXFGLHlCQUF5Qix3RkFBd0YsMkJBQTJCLHVFQUF1RSxzQkFBc0IscUZBQXFGLHNCQUFzQixrRkFBa0Ysd0JBQXdCLDhEQUE4RCx1QkFBdUIsdUZBQXVGLHVCQUF1QixvRkFBb0YseUJBQXlCLGlFQUFpRSx3QkFBd0IsWUFBWSxpQkFBaUIsK0JBQStCLElBQUksMEJBQTBCLFNBQVMsdXJCQUF1ckIsc0JBQXNCLDREQUE0RCx1QkFBdUIsUUFBUSxpQkFBaUIsK0JBQStCLElBQUkseUJBQXlCLFNBQVMsa0xBQWtMLHVCQUF1QixVQUFVLGlCQUFpQiwrQkFBK0IsSUFBSSx5QkFBeUIsU0FBUyw4UkFBOFIsWUFBWSxtQ0FBbUMsVUFBVSxVQUFVLElBQUksMERBQTBELG1LQUFtSyxJQUFJLG1DQUFtQyxvQkFBb0IsbUJBQW1CLElBQUksMkNBQTJDLFNBQVMscUNBQXFDLHVCQUF1QiwwQ0FBMEMscUJBQXFCLDBDQUEwQywyQ0FBMkMsaUNBQWlDLEtBQUssaUVBQWlFLFNBQVMsd0NBQXdDLFNBQVMsMkJBQTJCLFFBQVEsV0FBVyx1Q0FBdUMsV0FBVywyQkFBMkIsU0FBUyxtQkFBbUIsSUFBSSxjQUFjLDRCQUE0QixJQUFJLCtFQUErRSxtQkFBbUIsSUFBSSxpREFBaUQscUJBQXFCLHlCQUF5Qiw0QkFBNEIsOENBQThDLDJCQUEyQiw0R0FBNEcsMkZBQTJGLHlDQUF5QyxxQkFBcUIsME5BQTBOLG9QQUFvUCwrQ0FBK0Msd0VBQXdFLG9RQUFvUSx1SUFBdUksbUdBQW1HLG1EQUFtRCxtQkFBbUIsSUFBSSx5TEFBeUwscUtBQXFLLHdJQUF3SSw4REFBOEQsbUJBQW1CLElBQUksNkNBQTZDLDRGQUE0Rix3QkFBd0IsSUFBSSw4Q0FBOEMsb0NBQW9DLElBQUksOERBQThELDZHQUE2Ryx5QkFBeUIsOEJBQThCLElBQUksMEVBQTBFLDhDQUE4QyxJQUFJLEtBQUssVUFBVSwrQkFBK0IsZ0NBQWdDLElBQUksc0RBQXNELGVBQWUsMFBBQTBQLHlHQUF5RywrR0FBK0csb0tBQW9LLDRDQUE0QyxtQkFBbUIsSUFBSSxlQUFlLHdEQUF3RCxJQUFJLHFMQUFxTCx1REFBdUQsZ0NBQWdDLElBQUksc0RBQXNELGVBQWUsK01BQStNLEtBQUssMENBQTBDLHNMQUFzTCxpSEFBaUgsNERBQTRELDhCQUE4QixJQUFJLDRIQUE0SCxtSEFBbUgsaUtBQWlLLDJKQUEySixJQUFJLDhLQUE4SyxtREFBbUQsSUFBSSxnVUFBZ1UsUUFBUSxnQkFBZ0IsSUFBSSxrSUFBa0ksS0FBSywwQ0FBMEMseUxBQXlMLHNIQUFzSCxnR0FBZ0csaUVBQWlFLGdDQUFnQyxJQUFJLHNEQUFzRCx1QkFBdUIseVBBQXlQLG9EQUFvRCw4SEFBOEgsT0FBTyxtQkFBbUIsaUVBQWlFLGdDQUFnQyxJQUFJLHNEQUFzRCx1QkFBdUIseVBBQXlQLElBQUksK0JBQStCLGdDQUFnQyxJQUFJLHNEQUFzRCwwUUFBMFEsS0FBSywwQ0FBMEMsZ1NBQWdTLDJCQUEyQixRQUFRLCtCQUErQix3QkFBd0IsZ0JBQWdCLGtIQUFrSCxtQkFBbUIsSUFBSSxpRUFBaUUsSUFBSSxLQUFLLG1DQUFtQywwRkFBMEYsc0ZBQXNGLHlCQUF5QixtQkFBbUIsOEJBQThCLElBQUkscU9BQXFPLElBQUksaUdBQWlHLGdNQUFnTSxJQUFJLGlHQUFpRyw4RkFBOEYsSUFBSSw4S0FBOEssb0NBQW9DLDBDQUEwQyxzQkFBc0IsOEJBQThCLElBQUksNEdBQTRHLGtCQUFrQixNQUFNLGtRQUFrUSxrTkFBa04saUNBQWlDLGlHQUFpRyxpQ0FBaUMsOEZBQThGLG1DQUFtQyxnRkFBZ0Ysa0NBQWtDLG1CQUFtQiw4SUFBOEksbUlBQW1JLGdFQUFnRSw4QkFBOEIsSUFBSSxvSUFBb0ksU0FBUyxtQ0FBbUMsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksZ0NBQWdDLFNBQVMsb1JBQW9SLE9BQU8sUUFBUSxrQ0FBa0MsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksK0JBQStCLFNBQVMsc1JBQXNSLE9BQU8sUUFBUSxrQ0FBa0MsMmNBQTJjLHNCQUFzQixJQUFJLCtCQUErQiwyRUFBMkUsWUFBWSxpQkFBaUIsK0JBQStCLElBQUksNEJBQTRCLFNBQVMsMlBBQTJQLHFEQUFxRCxRQUFRLGlDQUFpQywwRUFBMEUsVUFBVSxpQkFBaUIsK0JBQStCLElBQUksOEJBQThCLFNBQVMsZ1RBQWdULHFEQUFxRCxRQUFRLDJCQUEyQixpRUFBaUUsa0RBQWtELCtIQUErSCxJQUFJLDRIQUE0SCwwQ0FBMEMsc0NBQXNDLEVBQUUsNkJBQTZCLG1FQUFtRSxrREFBa0QsOENBQThDLElBQUksNEhBQTRILCtIQUErSCw2Q0FBNkMsRUFBRSw2QkFBNkIsZ0lBQWdJLDhCQUE4QiwwSEFBMEgsd0JBQXdCLHFDQUFxQyxrQ0FBa0Msd0VBQXdFLCtCQUErQixTQUFTLG1CQUFtQixJQUFJLG9CQUFvQixtQkFBbUIsSUFBSSxxQ0FBcUMsSUFBSSx3REFBd0QsS0FBSywwQ0FBMEMscUNBQXFDLHdCQUF3QixVQUFVLHFDQUFxQywyRUFBMkUsb0NBQW9DLG1CQUFtQixJQUFJLDBDQUEwQyxxQ0FBcUMsd0JBQXdCLFVBQVUsOEJBQThCLGdCQUFnQiw4SEFBOEgsSUFBSSxrS0FBa0sseUNBQXlDLDJCQUEyQix3Q0FBd0Msa0dBQWtHLDhCQUE4Qix3Q0FBd0Msa0JBQWtCLDBDQUEwQyxtQkFBbUIsV0FBVyxnQ0FBZ0MsZ0JBQWdCLEVBQUUsZ0RBQWdELFNBQVMsNEJBQTRCLGdIQUFnSCxnREFBZ0QsU0FBUyxrREFBa0QsaUNBQWlDLCtGQUErRixnQ0FBZ0MsbURBQW1ELE9BQU8sUUFBUSxzRkFBc0YsZ0VBQWdFLGtCQUFrQixvQkFBb0Isc0JBQXNCLFVBQVUsSUFBSSxHQUFHLFNBQVMsc0ZBQXNGLGdFQUFnRSxXQUFXLFNBQVMsOEZBQThGLGdFQUFnRSxtRUFBbUUsTUFBTSwrRUFBK0UsS0FBSyxzRUFBc0UsZ0VBQWdFLHVEQUF1RCxPQUFPLCtFQUErRSxnRUFBZ0UseURBQXlELFFBQVEsa0RBQWtELG1EQUFtRCxxREFBcUQsZ0VBQWdFLGlCQUFpQiw0Q0FBNEMscUJBQXFCLGtCQUFrQixtQkFBbUIsNEVBQTRFLG1MQUFtTCwrREFBK0QsbUZBQW1GLDREQUE0RCxpSUFBaUksNkNBQTZDLE9BQU8sMkNBQTJDLHlKQUF5SiwwQ0FBMEMsbUJBQW1CLDZEQUE2RCw0RUFBNEUsUUFBUSwwQkFBMEIsOEVBQThFLHlDQUF5Qyx3REFBd0QsK0ZBQStGLCtPQUErTyxnQ0FBZ0MsNkRBQTZELDBDQUEwQyx5REFBeUQsNERBQTRELG1FQUFtRSxzREFBc0QsbUVBQW1FLFFBQVEscUNBQXFDLGVBQWUsR0FBRyxhQUFhLFlBQVksa0ZBQWtGLGtCQUFrQixVQUFVLDZCQUE2QixzQkFBc0IsNENBQTRDLGtEQUFrRCwrQkFBK0IsRUFBRSxzQkFBc0IsK0VBQStFLCtDQUErQyxpQ0FBaUMseURBQXlELCtCQUErQixLQUFLLHNCQUFzQixlQUFlLDBCQUEwQixnQkFBZ0IsNkNBQTZDLHNLQUFzSyxZQUFZLDRHQUE0RywrQ0FBK0MsMFlBQTBZLDZDQUE2QywrQ0FBK0Msa1hBQWtYLFlBQVksc0JBQXNCLHNKQUFzSiwyQkFBMkIsNkNBQTZDLDRMQUE0TCwrUkFBK1Isc0JBQXNCLHlCQUF5QiwyREFBMkQsb0JBQW9CLDZEQUE2RCxNQUFNLDhGQUE4RixNQUFNLDhDQUE4QyxxZUFBcWUsYUFBYSxnSUFBZ0ksaUJBQWlCLGlKQUFpSixjQUFjLHFDQUFxQyxTQUFTLDJGQUEyRiw0VUFBNFUsbUNBQW1DLHNIQUFzSCw4QkFBOEIsaUpBQWlKLGtCQUFrQix5QkFBeUIscURBQXFELDZCQUE2Qiw2SkFBNkosK0JBQStCLFdBQVcsZ0JBQWdCLGtGQUFrRixNQUFNLG1RQUFtUSxNQUFNLDZaQUE2WixNQUFNLDhSQUE4UixNQUFNLDhaQUE4WixNQUFNLG9EQUFvRCwyQkFBMkIsbUJBQW1CLHVFQUF1RSxzREFBc0QsZ0RBQWdEO0FBQzl2K0IsRUFBQyxnREFBZ0Qsa0xBQWtMLEVBQUUsRUFBRSwyQkFBMkIsZ0xBQWdMLFFBQVEsbUNBQW1DLHdCQUF3QixxSEFBcUgsc0JBQXNCLDhNQUE4TSwwR0FBMEcsdU1BQXVNLDJMQUEyTCw2VEFBNlQsTUFBTSx1RkFBdUYsd1lBQXdZLGtCQUFrQixpQ0FBaUMsNEJBQTRCLEdBQUcsbUZBQW1GLDBEQUEwRCw0QkFBNEIsS0FBSyx1Q0FBdUMsMERBQTBELDRCQUE0QixLQUFLLFFBQVEsb0NBQW9DLDhJQUE4SSxLQUFLLGVBQWUsOEJBQThCLElBQUksNEdBQTRHLGtCQUFrQixNQUFNLGtDQUFrQyxVQUFVLGNBQWMsMkRBQTJELGdCQUFnQixnREFBZ0QsdURBQXVELDRDQUE0Qyw0S0FBNEssVUFBVSx3RkFBd0YsMmxCQUEybEIsNGFBQTRhLFVBQVUsa0VBQWtFLE1BQU0sd0tBQXdLLE1BQU0sc0VBQXNFLG1DQUFtQyxJQUFJLDBmQUEwZixpSUFBaUksT0FBTyxvQ0FBb0MsTUFBTSx5R0FBeUcsa0JBQWtCLGdCQUFnQiwwQ0FBMEMsb0VBQW9FLFFBQVEsdUJBQXVCLDZOQUE2TixpQkFBaUIsaUJBQWlCLEtBQUssbUNBQW1DLElBQUksd1JBQXdSLHNJQUFzSSxXQUFXLGVBQWUsbUNBQW1DLGdPQUFnTyw4TUFBOE0sOENBQThDLG9JQUFvSSw0Q0FBNEMsZ0RBQWdELGtCQUFrQixhQUFhLE1BQU0sOEJBQThCLElBQUksK0VBQStFLGtNQUFrTSw0SUFBNEksV0FBVyxpREFBaUQseVpBQXlaLEVBQUUsY0FBYyxlQUFlLG9DQUFvQyx3Q0FBd0MsbUJBQW1CLGlFQUFpRSxPQUFPLHFKQUFxSixjQUFjLFVBQVUsK0ZBQStGLDBCQUEwQixtRkFBbUYsaUJBQWlCLE9BQU8sK0NBQStDLG1CQUFtQixxRkFBcUYsb0pBQW9KLDBKQUEwSixxQkFBcUIseUdBQXlHLDBFQUEwRSxtQkFBbUIsdURBQXVELGlQQUFpUCx1QkFBdUIsK1hBQStYLEVBQUUsSUFBSSwyRUFBMkUsU0FBUyx5SkFBeUosVUFBVSw0TUFBNE0sMEdBQTBHLDZKQUE2SixrQkFBa0IsNldBQTZXLGVBQWUsME9BQTBPLHFIQUFxSCxzREFBc0QsK0hBQStILDhIQUE4SCxrQkFBa0IsMkJBQTJCLHNiQUFzYiw0cUJBQTRxQix1QkFBdUIsdUNBQXVDLGtCQUFrQiwyWUFBMlksa0RBQWtELDRCQUE0QixvQkFBb0IsTUFBTSxtQ0FBbUMsbUJBQW1CLEVBQUUsa0NBQWtDLDRFQUE0RSx3QkFBd0Isc0JBQXNCLHVCQUF1QixvQ0FBb0MsK0VBQStFLE9BQU8sbUJBQW1CLElBQUksc0tBQXNLLHlCQUF5QixXQUFXLDREQUE0RCxRQUFRLG1FQUFtRSxtQkFBbUIsSUFBSSwrRkFBK0YsaUNBQWlDLFFBQVEsdURBQXVELDhJQUE4SSxRQUFRLG1FQUFtRSxtQkFBbUIsSUFBSSwrRkFBK0YsaUNBQWlDLGlDQUFpQyxpQ0FBaUMsU0FBUyx3Q0FBd0MsK0JBQStCLHlDQUF5QyxzSUFBc0kseUJBQXlCLGdCQUFnQixlQUFlLDhKQUE4SiwyQkFBMkIsdUpBQXVKLHVDQUF1QyxxQkFBcUIsd1BBQXdQLHdDQUF3QyxvQ0FBb0MsdUJBQXVCLElBQUksZ0tBQWdLLElBQUksZ0hBQWdILG1KQUFtSix1REFBdUQsZ0dBQWdHLFFBQVEsbUNBQW1DLGdFQUFnRSxzREFBc0Qsc0ZBQXNGLG9NQUFvTSxxRkFBcUYsd0JBQXdCLEVBQUUsd0JBQXdCLHNCQUFzQixzRUFBc0UsNEJBQTRCLDBHQUEwRyxnRUFBZ0UsaUNBQWlDLHFGQUFxRix3QkFBd0IsRUFBRSxTQUFTLHdMQUF3TCw2Q0FBNkMsdURBQXVELFdBQVcsZ09BQWdPLFlBQVksOENBQThDLElBQUksc0dBQXNHLDhHQUE4RyxxSUFBcUksaUxBQWlMLHFJQUFxSSxvSEFBb0gsdUJBQXVCLGdGQUFnRixFQUFFLDhCQUE4QixpSEFBaUgsZ0ZBQWdGLHNJQUFzSSxxSUFBcUksb01BQW9NLG9DQUFvQyx3RkFBd0YsZUFBZSw4QkFBOEIsSUFBSSw0R0FBNEcsa0JBQWtCLE1BQU0sbUNBQW1DLFVBQVUsYUFBYSxnQ0FBZ0MsT0FBTyxjQUFjLDRGQUE0RiwrREFBK0QsMERBQTBELFFBQVEsS0FBSyxRQUFRLElBQUkscUJBQXFCLFFBQVEsSUFBSSw2QkFBNkIsU0FBUyxtQkFBbUIsMEJBQTBCLHFCQUFxQixnQkFBZ0IsdUVBQXVFLG9CQUFvQixtQkFBbUIsb0JBQW9CLHFFQUFxRSxrR0FBa0csSUFBSSxLQUFLLFFBQVEsc0RBQXNELHFGQUFxRixLQUFLLGlJQUFpSSxvQ0FBb0Msb0JBQW9CLG9CQUFvQixJQUFJLE9BQU8sc0JBQXNCLFNBQVMsU0FBUyxNQUFNLDJCQUEyQixnRUFBZ0UseUNBQXlDLDhDQUE4QyxxQ0FBcUMscUJBQXFCLHVFQUF1RSx1QkFBdUIseUVBQXlFLG1GQUFtRixxRUFBcUUscURBQXFELFFBQVEseUJBQXlCLFFBQVEsNElBQTRJLElBQUksb0NBQW9DLFNBQVMseUJBQXlCLCtIQUErSCxzQ0FBc0MscUJBQXFCLGtCQUFrQix5QkFBeUIsOERBQThELG1EQUFtRCxrQkFBa0IsWUFBWSxvQ0FBb0MsT0FBTyxxREFBcUQscUVBQXFFLFFBQVEsNEJBQTRCLE9BQU8sa0VBQWtFLGdFQUFnRSwrQkFBK0Isb0RBQW9ELFNBQVMsZ0JBQWdCLFNBQVMsU0FBUyx3TkFBd04sb0NBQW9DLG9CQUFvQixJQUFJLEVBQUUsNEJBQTRCLDZCQUE2QixzREFBc0QsZUFBZSxrQkFBa0Isa0JBQWtCLHdDQUF3QyxpQkFBaUIsc0NBQXNDLGlCQUFpQiwyQ0FBMkMsNkJBQTZCLGFBQWEsMENBQTBDLHNDQUFzQyx3QkFBd0IsUUFBUSw2T0FBNk8seUVBQXlFLDRCQUE0Qiw0RUFBNEUsc0JBQXNCLHFEQUFxRCx5RUFBeUUsbUJBQW1CLElBQUksS0FBSyxzWkFBc1oscUJBQXFCLHFKQUFxSix3R0FBd0cscUJBQXFCLHlOQUF5TixvQ0FBb0MsMEJBQTBCLCtCQUErQiw2Q0FBNkMsSUFBSSxTQUFTLElBQUksK0JBQStCLG1CQUFtQixtQ0FBbUMsSUFBSSxtTkFBbU4sbUdBQW1HLFNBQVMsOEJBQThCLGlCQUFpQix1QkFBdUIsSUFBSSxnQ0FBZ0MsU0FBUyx5TEFBeUwsZ0NBQWdDLDhDQUE4QywwREFBMEQseUVBQXlFLDBEQUEwRCx1R0FBdUcsc0lBQXNJLDRHQUE0RyxvREFBb0QsRUFBRSxJQUFJLHNJQUFzSSw4R0FBOEcsb0RBQW9ELEVBQUUsSUFBSSwrQkFBK0Isa0NBQWtDLElBQUksb0RBQW9ELHVCQUF1QixxQkFBcUIsR0FBRyx1RkFBdUYseUdBQXlHLG9EQUFvRCxFQUFFLElBQUksa0RBQWtELFVBQVUsU0FBUyw0QkFBNEIsa0NBQWtDLDBCQUEwQiwrSEFBK0gsNkJBQTZCLHdDQUF3QyxZQUFZLHdDQUF3Qyw2QkFBNkIsdUNBQXVDLGlCQUFpQiwrQkFBK0IsSUFBSSwwQkFBMEIsU0FBUywrREFBK0QsK1NBQStTLHFCQUFxQix1TkFBdU4sd0dBQXdHLHFCQUFxQiw2UUFBNlEsNEdBQTRHLHFCQUFxQix1UEFBdVAsd0dBQXdHLHFCQUFxQixrV0FBa1csVUFBVSwyQkFBMkIsMENBQTBDLHFCQUFxQix1Q0FBdUMsK0JBQStCLDhDQUE4QyxzRkFBc0YsbUdBQW1HLDRCQUE0QixJQUFJLHdFQUF3RSxpQ0FBaUMsMkJBQTJCLGlJQUFpSSxnSUFBZ0ksb0RBQW9ELEVBQUUsSUFBSSwrRUFBK0UsZ0lBQWdJLG9EQUFvRCxFQUFFLElBQUksNkVBQTZFLGdJQUFnSSxvREFBb0QsRUFBRSxJQUFJLGlIQUFpSCxnSUFBZ0ksb0RBQW9ELEVBQUUsSUFBSSxTQUFTLHNDQUFzQyxtQkFBbUIsK0ZBQStGO0FBQ2xxK0IsU0FBUSxFQUFFLHdHQUF3RyxpRUFBaUUsSUFBSSx3RUFBd0UsSUFBSSw0RUFBNEUsU0FBUyw0Q0FBNEMsNkJBQTZCLDhIQUE4SCwwQ0FBMEMscUJBQXFCLHFGQUFxRixpQkFBaUIsd0VBQXdFLHVEQUF1RCx1REFBdUQscUZBQXFGLGtEQUFrRCxxRkFBcUYsYUFBYSw0QkFBNEIsSUFBSSxzSEFBc0gsb0RBQW9ELDJIQUEySCx5RUFBeUUsa0xBQWtMLHVFQUF1RSwyQkFBMkIsbUJBQW1CLDZCQUE2QixvR0FBb0csRUFBRSwwRkFBMEYseURBQXlELDZCQUE2Qix1QkFBdUIsd0VBQXdFLEVBQUUsaUdBQWlHLHFFQUFxRSw2QkFBNkIsdUJBQXVCLHdFQUF3RSxFQUFFLGlHQUFpRyxtRkFBbUYsMkdBQTJHLGtFQUFrRSxtQ0FBbUMsUUFBUSwwQkFBMEIsNkZBQTZGLG9DQUFvQywwQ0FBMEMsc0JBQXNCLDhOQUE4TixVQUFVLDJDQUEyQywyQ0FBMkMsNkJBQTZCLE9BQU8sT0FBTyxZQUFZLEdBQUcsc01BQXNNLGlLQUFpSyxtQkFBbUIsSUFBSSxtQ0FBbUMsWUFBWSxFQUFFLGFBQWE7Ozs7Ozs7QUNUMzJIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEVBQUM7QUFDRDtBQUNBLDRDQUEyQyxRQUFRO0FBQ25EO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCLDZDQUE2QztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFtQyx5Q0FBeUM7QUFDNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQSwwQkFBeUIsbUJBQW1CO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE0QyxvQkFBb0IsaUJBQWlCLGNBQWMsa0JBQWtCLFlBQVksaUJBQWlCLHFCQUFxQjtBQUNuSyxrREFBaUQsaUJBQWlCLGlCQUFpQixnQkFBZ0IsaUJBQWlCLHFCQUFxQjtBQUN6SSxrREFBaUQsa0JBQWtCLGFBQWEsYUFBYSxrQkFBa0IseUJBQXlCLGlCQUFpQixrQkFBa0Isa0JBQWtCLFdBQVc7QUFDeE0sMENBQXlDLGlCQUFpQixxQkFBcUIsMEJBQTBCO0FBQ3pHLDJEQUEwRCxVQUFVLG1CQUFtQjtBQUN2Rix1REFBc0QsMkJBQTJCO0FBQ2pGLDREQUEyRCxtQkFBbUIsYUFBYTtBQUMzRiwwREFBeUQsc0JBQXNCLHNCQUFzQjtBQUNyRyx5REFBd0Qsd0JBQXdCLHFDQUFxQztBQUNySCxnREFBK0MsWUFBWSxtQkFBbUI7QUFDOUUsbURBQWtELG1CQUFtQixvQkFBb0I7QUFDekYsbURBQWtELFdBQVcsZUFBZTtBQUM1RSwrQ0FBOEMsb0JBQW9CLG1CQUFtQjtBQUNyRiw4Q0FBNkMsYUFBYTtBQUMxRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUIsY0FBYztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBNkIscUJBQXFCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0EsY0FBYTtBQUNiO0FBQ0EsY0FBYTtBQUNiO0FBQ0EsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxzRkFBcUYsZ0NBQWdDOztBQUVySDtBQUNBOztBQUVBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBaUI7O0FBRWpCLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCLGFBQWE7QUFDdEM7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxzQkFBcUI7QUFDckI7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0Esc0JBQXFCLGNBQWM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEwQjtBQUMxQjs7QUFFQTtBQUNBLDhDQUE2QztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXVELHNCQUFzQjtBQUM3RTtBQUNBO0FBQ0E7QUFDQSw0TEFBMkw7QUFDM0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUIsYUFBYTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJEQUEwRCxvSkFBb0o7QUFDOU07QUFDQTtBQUNBLGtDQUFpQyxjQUFjO0FBQy9DO0FBQ0EsMENBQXlDO0FBQ3pDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esd0RBQXVEOztBQUV2RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxrQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCOztBQUVyQjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0JBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFxQixrQkFBa0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBcUIsa0JBQWtCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBb0IsTUFBTTtBQUMxQixxQkFBb0IsSUFBSTtBQUN4QixxQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0EsdUJBQXNCLGNBQWM7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBc0MsUUFBUSx5R0FBeUcsRUFBRTtBQUN6SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQSxpRkFBZ0Ysd0NBQXdDO0FBQ3hIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUF5QjtBQUN6QixpREFBZ0QsOEJBQThCLEVBQUU7QUFDaEYscURBQW9ELDhCQUE4QixFQUFFO0FBQ3BGO0FBQ0E7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSxxREFBb0QsY0FBYztBQUNsRTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUE4RCw0RUFBNEU7QUFDMUk7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EscURBQW9ELCtCQUErQjtBQUNuRixxQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQSxvQ0FBbUMsaUNBQWlDO0FBQ3BFLGNBQWE7QUFDYjtBQUNBLG9DQUFtQyxtQ0FBbUM7QUFDdEUsY0FBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUIsY0FBYztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSwwQkFBeUI7QUFDekI7QUFDQTtBQUNBLHNCQUFxQjtBQUNyQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBOEI7QUFDOUIsc0JBQXFCLE9BQU8sZUFBZTs7QUFFM0M7QUFDQTtBQUNBLDBDQUF5QztBQUN6Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQSw4QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EsMEJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXFCO0FBQ3JCO0FBQ0E7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSwwQkFBeUI7QUFDekI7QUFDQSwwQkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQThCLCtCQUErQjtBQUM3RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUM7Ozs7Ozs7QUM3ekJEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQSx5Q0FBd0M7QUFDeEM7O0FBRUE7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQSxVQUFTOztBQUVUO0FBQ0E7QUFDQSxVQUFTO0FBQ1QsTUFBSzs7QUFFTDtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QjtBQUNBLGtCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixrQkFBaUIsbUJBQW1CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFDOztBQUVEOzs7Ozs7O0FDaklBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlDQUF3QztBQUN4QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2I7QUFDQTtBQUNBLGNBQWE7O0FBRWI7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBLGtCQUFpQixRQUFRO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBUztBQUNUO0FBQ0E7QUFDQSxNQUFLOztBQUVMO0FBQ0E7QUFDQSxnQkFBZSxPQUFPO0FBQ3RCLGtCQUFpQixRQUFRO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBSzs7QUFFTDtBQUNBO0FBQ0EsZ0JBQWUsT0FBTztBQUN0QixnQkFBZSxPQUFPO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxjQUFhO0FBQ2IsVUFBUzs7QUFFVDtBQUNBO0FBQ0EsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBUztBQUNULE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBOztBQUVBLE1BQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGNBQWE7QUFDYjtBQUNBO0FBQ0E7O0FBRUEsRUFBQzs7QUFFRCIsImZpbGUiOiJidW5kbGUuYWRtaW4ucGFnZXRyZWUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gcG9seWZpbGxzXG5yZXF1aXJlKCcuL3BvbHlmaWxscy9mdW5jdGlvbi5wcm90b3R5cGUuYmluZC5qcycpO1xucmVxdWlyZSgnLi9saWJzL3BlcCcpO1xuXG52YXIgQ01TID0gcmVxdWlyZSgnLi9tb2R1bGVzL2Ntcy5iYXNlJyk7XG5cbndpbmRvdy5DTVMgPSBDTVM7XG5cbkNNUy5QYWdlVHJlZSA9IHJlcXVpcmUoJy4vbW9kdWxlcy9jbXMucGFnZXRyZWUnKTtcblxuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogLi9jbXMvc3RhdGljL2Ntcy9qcy9hZG1pbi5wYWdldHJlZS5qc1xuICoqIG1vZHVsZSBpZCA9IDBcbiAqKiBtb2R1bGUgY2h1bmtzID0gMlxuICoqLyIsIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG52YXIgJCA9IHJlcXVpcmUoJ2pxdWVyeScpO1xuXG5yZXF1aXJlKCdqc3RyZWUnKTtcbnJlcXVpcmUoJy4uL2xpYnMvanN0cmVlL2pzdHJlZS5ncmlkLm1pbicpO1xuXG52YXIgQ2xhc3MgPSByZXF1aXJlKCdjbGFzc2pzJyk7XG52YXIgSGVscGVycyA9IHJlcXVpcmUoJy4vY21zLmJhc2UnKS5BUEkuSGVscGVycztcbnZhciBLRVlTID0gcmVxdWlyZSgnLi9jbXMuYmFzZScpLktFWVM7XG52YXIgUGFnZVRyZWVEcm9wZG93bnMgPSByZXF1aXJlKCcuL2Ntcy5wYWdldHJlZS5kcm9wZG93bicpO1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gcmVxdWlyZSgnLi9jbXMucGFnZXRyZWUuc3RpY2t5aGVhZGVyJyk7XG5cbi8qKlxuICogVGhlIHBhZ2V0cmVlIGlzIGxvYWRlZCB2aWEgYC9hZG1pbi9jbXMvcGFnZWAgYW5kIGhhcyBhIGN1c3RvbSBhZG1pblxuICogdGVtcGxhdGVzIHN0b3JlZCB3aXRoaW4gYHRlbXBsYXRlcy9hZG1pbi9jbXMvcGFnZS90cmVlYC5cbiAqXG4gKiBAY2xhc3MgUGFnZVRyZWVcbiAqIEBuYW1lc3BhY2UgQ01TXG4gKi9cbnZhciBQYWdlVHJlZSA9IG5ldyBDbGFzcyh7XG4gICAgb3B0aW9uczoge1xuICAgICAgICBwYXN0ZVNlbGVjdG9yOiAnLmpzLWNtcy10cmVlLWl0ZW0tcGFzdGUnXG4gICAgfSxcbiAgICAvLyBUT0RPIGFkZCBtZWNoYW5pY3MgdG8gc2V0IHRoZSBob21lIHBhZ2VcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgLy8gb3B0aW9ucyBhcmUgbG9hZGVkIGZyb20gdGhlIHBhZ2V0cmVlIGh0bWwgbm9kZVxuICAgICAgICB2YXIgb3B0cyA9ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdqc29uJyk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0cywgb3B0aW9ucyk7XG5cbiAgICAgICAgLy8gc3RhdGVzIGFuZCBldmVudHNcbiAgICAgICAgdGhpcy5jbGljayA9ICdjbGljay5jbXMucGFnZXRyZWUnO1xuICAgICAgICB0aGlzLmNsaXBib2FyZCA9IHtcbiAgICAgICAgICAgIGlkOiBudWxsLFxuICAgICAgICAgICAgb3JpZ2luOiBudWxsLFxuICAgICAgICAgICAgdHlwZTogJydcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdWNjZXNzVGltZXIgPSAxMDAwO1xuXG4gICAgICAgIC8vIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuX3NldHVwVUkoKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzKCk7XG5cbiAgICAgICAgLy8gY2FuY2VsIGlmIHBhZ2V0cmVlIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3Qob3B0cykpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldHVwKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU3RvcmVzIGFsbCBqUXVlcnkgcmVmZXJlbmNlcyB3aXRoaW4gYHRoaXMudWlgLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICB2YXIgcGFnZXRyZWUgPSAkKCcuY21zLXBhZ2V0cmVlJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogcGFnZXRyZWUsXG4gICAgICAgICAgICBkb2N1bWVudDogJChkb2N1bWVudCksXG4gICAgICAgICAgICB0cmVlOiBwYWdldHJlZS5maW5kKCcuanMtY21zLXBhZ2V0cmVlJyksXG4gICAgICAgICAgICBkaWFsb2c6ICQoJy5qcy1jbXMtdHJlZS1kaWFsb2cnKSxcbiAgICAgICAgICAgIHNpdGVGb3JtOiAkKCcuanMtY21zLXBhZ2V0cmVlLXNpdGUtZm9ybScpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldHRpbmcgdXAgdGhlIGpzdHJlZSBhbmQgdGhlIHJlbGF0ZWQgY29sdW1ucy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXA6IGZ1bmN0aW9uIF9zZXR1cCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgY29sdW1ucyA9IFtdO1xuICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMub3B0aW9ucy5sYW5nLmNvZGUsXG4gICAgICAgICAgICBvcGVuTm9kZXM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHZhciBkYXRhID0gZmFsc2U7XG5cbiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgYWpheCByZXF1ZXN0IHNlbmQgdGhlIGNzcmYgdG9rZW5cbiAgICAgICAgSGVscGVycy5jc3JmKHRoaXMub3B0aW9ucy5jc3JmKTtcblxuICAgICAgICAvLyBzZXR1cCBjb2x1bW4gaGVhZGluZ3NcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNoYWRvd1xuICAgICAgICAkLmVhY2godGhpcy5vcHRpb25zLmNvbHVtbnMsIGZ1bmN0aW9uIChpbmRleCwgb2JqKSB7XG4gICAgICAgICAgICBpZiAob2JqLmtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGUgZmlyc3Qgcm93IGlzIGFscmVhZHkgcG9wdWxhdGVkLCB0byBhdm9pZCBvdmVyd3JpdGVzXG4gICAgICAgICAgICAgICAgLy8ganVzdCBsZWF2ZSB0aGUgXCJrZXlcIiBwYXJhbSBlbXB0eVxuICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcjogb2JqLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogb2JqLndpZHRoIHx8ICcxJScsXG4gICAgICAgICAgICAgICAgICAgIHdpZGVDZWxsQ2xhc3M6IG9iai5jbHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiBvYmoudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgbmVlZHMgdG8gaGF2ZSB0aGUgXCJjb2xkZVwiIGZvcm1hdCBhbmQgbm90IFwiY29sLWRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIGpzdHJlZSB3aWxsIGNvbnZlcnQgXCJjb2wtZGVcIiB0byBcImNvbGRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsc28gd2Ugc3RyaXAgZGFzaGVzLCBpbiBjYXNlIGxhbmd1YWdlIGNvZGUgY29udGFpbnMgaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGUuZy4gemgtaGFucywgemgtY24gZXRjXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuZGF0YVsnY29sJyArIG9iai5rZXkucmVwbGFjZSgnLScsICcnKV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG9iai53aWR0aCB8fCAnMSUnLFxuICAgICAgICAgICAgICAgICAgICB3aWRlQ2VsbENsYXNzOiBvYmouY2xzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHByZXBhcmUgZGF0YVxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5maWx0ZXJlZCkge1xuICAgICAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMub3B0aW9ucy51cmxzLnRyZWUsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICcjJyBpcyByZW5kZXJlZCBpZiBpdHMgdGhlIHJvb3Qgbm9kZSwgdGhlcmUgd2Ugb25seVxuICAgICAgICAgICAgICAgICAgICAvLyBjYXJlIGFib3V0IGBvYmoub3Blbk5vZGVzYCwgaW4gdGhlIGZvbGxvd2luZyBjYXNlXG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIGFyZSByZXF1ZXN0aW5nIGEgc3BlY2lmaWMgbm9kZVxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gJyMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucGFnZUlkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5wYWdlSWQgPSB0aGF0Ll9zdG9yZU5vZGVJZChub2RlLmRhdGEuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzdG9yZSB0aGUgb3BlbmVkIGl0ZW1zIGluc2lkZSB0aGUgbG9jYWxzdG9yYWdlXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzIHdlIGhhdmUgdG8gbG9hZCB0aGUgcGFnZXRyZWUgd2l0aCB0aGUgcHJldmlvdXMgb3BlbmVkXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIG9iai5vcGVuTm9kZXMgPSB0aGF0Ll9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzZXQgdGhlIHNpdGUgaWQgdG8gZ2V0IHRoZSBjb3JyZWN0IHRyZWVcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNpdGUgPSB0aGF0Lm9wdGlvbnMuc2l0ZTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBiaW5kIG9wdGlvbnMgdG8gdGhlIGpzdHJlZSBpbnN0YW5jZVxuICAgICAgICB0aGlzLnVpLnRyZWUuanN0cmVlKHtcbiAgICAgICAgICAgIGNvcmU6IHtcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIG9wZW4vY2xvc2UgYW5pbWF0aW9uc1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMCxcbiAgICAgICAgICAgICAgICAvLyBjb3JlIHNldHRpbmcgdG8gYWxsb3cgYWN0aW9uc1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgICAgICAgICAgICAgY2hlY2tfY2FsbGJhY2s6IGZ1bmN0aW9uIChvcGVyYXRpb24sIG5vZGUsIG5vZGVfcGFyZW50LCBub2RlX3Bvc2l0aW9uLCBtb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0aW9uID09PSAnbW92ZV9ub2RlJyB8fCBvcGVyYXRpb24gPT09ICdjb3B5X25vZGUnKSAmJiBtb3JlICYmIG1vcmUucG9zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9yZS5wb3MgPT09ICdpJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNqc3RyZWUtbWFya2VyJykuYWRkQ2xhc3MoJ2pzdHJlZS1tYXJrZXItY2hpbGQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2pzdHJlZS1tYXJrZXInKS5yZW1vdmVDbGFzcygnanN0cmVlLW1hcmtlci1jaGlsZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2hhc1Blcm1pc3Npb24obm9kZV9wYXJlbnQsICdhZGQnKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LmpzdHJlZS5jb20vYXBpLyMvP2Y9JC5qc3RyZWUuZGVmYXVsdHMuY29yZS5kYXRhXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAvLyBzdHJpbmdzIHVzZWQgd2l0aGluIGpzdHJlZSB0aGF0IGFyZSBjYWxsZWQgdXNpbmcgYGdldF9zdHJpbmdgXG4gICAgICAgICAgICAgICAgc3RyaW5nczoge1xuICAgICAgICAgICAgICAgICAgICAnTG9hZGluZyAuLi4nOiB0aGlzLm9wdGlvbnMubGFuZy5sb2FkaW5nLFxuICAgICAgICAgICAgICAgICAgICAnTmV3IG5vZGUnOiB0aGlzLm9wdGlvbnMubGFuZy5uZXdOb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbm9kZXMnOiB0aGlzLm9wdGlvbnMubGFuZy5ub2Rlc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgd2FybmluZ3MgYWJvdXQgZHJhZ2dpbmcgcGFyZW50IGludG8gY2hpbGRcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yRGF0YSA9IEpTT04ucGFyc2UoZXJyb3IuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmVycm9yID09PSAnY2hlY2snICYmIGVycm9yRGF0YSAmJiBlcnJvckRhdGEuY2hrID09PSAnbW92ZV9ub2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnJlYXNvbik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGVtZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2RqYW5nby1jbXMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIHRoZSBtdWx0aSBzZWxlY3Rpb24gb2Ygbm9kZXMgZm9yIG5vd1xuICAgICAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIGFjdGl2YXRlIGRyYWcgYW5kIGRyb3AgcGx1Z2luXG4gICAgICAgICAgICBwbHVnaW5zOiBbJ2RuZCcsICdzZWFyY2gnLCAnZ3JpZCddLFxuICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cuanN0cmVlLmNvbS9hcGkvIy8/Zj0kLmpzdHJlZS5kZWZhdWx0cy5kbmRcbiAgICAgICAgICAgIGRuZDoge1xuICAgICAgICAgICAgICAgIGluc2lkZV9wb3M6ICdsYXN0JyxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIHRoZSBtdWx0aSBzZWxlY3Rpb24gb2Ygbm9kZXMgZm9yIG5vd1xuICAgICAgICAgICAgICAgIGRyYWdfc2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlIGRyYWdnaW5nIGlmIGZpbHRlcmVkXG4gICAgICAgICAgICAgICAgaXNfZHJhZ2dhYmxlOiBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQuX2hhc1Blcm1pc3Npb24obm9kZXNbMF0sICdtb3ZlJykgJiYgIXRoYXQub3B0aW9ucy5maWx0ZXJlZDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhcmdlX2Ryb3BfdGFyZ2V0OiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvcHk6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkXG4gICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgLy8gY29sdW1ucyBhcmUgcHJvdmlkZWQgZnJvbSBiYXNlLmh0bWwgb3B0aW9uc1xuICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgY29sdW1uczogY29sdW1uc1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMsIHN1Y2ggYXMgb3BlbmluZyBhbmQgbW92aW5nLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gc2V0IGV2ZW50cyBmb3IgdGhlIG5vZGVJZCB1cGRhdGVzXG4gICAgICAgIHRoaXMudWkudHJlZS5vbignYWZ0ZXJfY2xvc2UuanN0cmVlJywgZnVuY3Rpb24gKGUsIGVsKSB7XG4gICAgICAgICAgICB0aGF0Ll9yZW1vdmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdhZnRlcl9vcGVuLmpzdHJlZScsIGZ1bmN0aW9uIChlLCBlbCkge1xuICAgICAgICAgICAgdGhhdC5fc3RvcmVOb2RlSWQoZWwubm9kZS5kYXRhLmlkKTtcblxuICAgICAgICAgICAgLy8gYGFmdGVyX29wZW5gIGV2ZW50IGNhbiBiZSB0cmlnZ2VyZWQgd2hlbiBwYXN0aW5nXG4gICAgICAgICAgICAvLyBpcyBpbiBwcm9ncmVzcyAobWVhbmluZyB3ZSBhcmUgcGFzdGluZyBpbnRvIGEgbGVhZiBub2RlXG4gICAgICAgICAgICAvLyBpbiB0aGlzIGNhc2Ugd2UgZG8gbm90IG5lZWQgdG8gdXBkYXRlIGhlbHBlcnMgc3RhdGVcbiAgICAgICAgICAgIGlmICh0aGlzLmNsaXBib2FyZCAmJiAhdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5kb2N1bWVudC5vbigna2V5ZG93bi5wYWdldHJlZS5hbHQtbW9kZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLRVlTLlNISUZUKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5jb250YWluZXIuYWRkQ2xhc3MoJ2Ntcy1wYWdldHJlZS1hbHQtbW9kZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdrZXl1cC5wYWdldHJlZS5hbHQtbW9kZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLRVlTLlNISUZUKSB7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5jb250YWluZXIucmVtb3ZlQ2xhc3MoJ2Ntcy1wYWdldHJlZS1hbHQtbW9kZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfc3RhcnQudmFrYXRhJywgZnVuY3Rpb24gKGUsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChkYXRhLmVsZW1lbnQpO1xuICAgICAgICAgICAgdmFyIG5vZGUgPSBlbGVtZW50LnBhcmVudCgpO1xuXG4gICAgICAgICAgICB0aGF0Ll9kcm9wZG93bnMuY2xvc2VBbGxEcm9wZG93bnMoKTtcblxuICAgICAgICAgICAgbm9kZS5hZGRDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICBkYXRhLmRhdGEubm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlc2NlbmRhbnRJZHMgPSB0aGF0Ll9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpO1xuXG4gICAgICAgICAgICAgICAgW25vZGVJZF0uY29uY2F0KGRlc2NlbmRhbnRJZHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5qc2dyaWRfJyArIGlkICsgJ19jb2wnKS5hZGRDbGFzcygnanN0cmVlLWlzLWRyYWdnaW5nJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFub2RlLmhhc0NsYXNzKCdqc3RyZWUtbGVhZicpKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5oZWxwZXIuYWRkQ2xhc3MoJ2lzLXN0YWNrZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGlzQ29weUNsYXNzQWRkZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfbW92ZS52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGlzTW92aW5nQ29weSA9IGRhdGEuZGF0YS5vcmlnaW4gJiYgKFxuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5IHx8XG4gICAgICAgICAgICAgICAgICAgIChkYXRhLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5ICYmIChkYXRhLmV2ZW50Lm1ldGFLZXkgfHwgZGF0YS5ldmVudC5jdHJsS2V5KSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChpc01vdmluZ0NvcHkpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzQ29weUNsYXNzQWRkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmpzdHJlZS1pcy1kcmFnZ2luZycpLmFkZENsYXNzKCdqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgICAgICAgICBpc0NvcHlDbGFzc0FkZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29weUNsYXNzQWRkZWQpIHtcbiAgICAgICAgICAgICAgICAkKCcuanN0cmVlLWlzLWRyYWdnaW5nJykucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZy1jb3B5Jyk7XG4gICAgICAgICAgICAgICAgaXNDb3B5Q2xhc3NBZGRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKCdkbmRfc3RvcC52YWthdGEnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGRhdGEuZWxlbWVudCk7XG4gICAgICAgICAgICB2YXIgbm9kZSA9IGVsZW1lbnQucGFyZW50KCk7XG5cbiAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZyBqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgZGF0YS5kYXRhLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkZXNjZW5kYW50SWRzID0gdGhhdC5fZ2V0RGVzY2VuZGFudHNJZHMobm9kZUlkKTtcblxuICAgICAgICAgICAgICAgIFtub2RlSWRdLmNvbmNhdChkZXNjZW5kYW50SWRzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcuanNncmlkXycgKyBpZCArICdfY29sJykucmVtb3ZlQ2xhc3MoJ2pzdHJlZS1pcy1kcmFnZ2luZyBqc3RyZWUtaXMtZHJhZ2dpbmctY29weScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHN0b3JlIG1vdmVkIHBvc2l0aW9uIG5vZGVcbiAgICAgICAgdGhpcy51aS50cmVlLm9uKCdtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUnLCBmdW5jdGlvbiAoZSwgb2JqKSB7XG4gICAgICAgICAgICBpZiAoIXRoYXQuY2xpcGJvYXJkLnR5cGUgJiYgZS50eXBlICE9PSAnY29weV9ub2RlJyB8fCB0aGF0LmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgICAgIHRoYXQuX21vdmVOb2RlKHRoYXQuX2dldE5vZGVQb3NpdGlvbihvYmopKS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhhdC51aS50cmVlLmpzdHJlZSh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5faGlkZV9ncmlkKGluc3RhbmNlLmdldF9ub2RlKG9iai5wYXJlbnQpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5wYXJlbnQgPT09ICcjJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSB0byByZWZyZXNoIHBhcmVudCwgYmVjYXVzZSByZWZyZXNoIG9ubHlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZnJlc2hlcyBjaGlsZHJlbiBvZiB0aGUgbm9kZSwgbmV2ZXIgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5yZWZyZXNoX25vZGUob2JqLnBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fY29weU5vZGUob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gb3BlbiB0aGUgcGFyZW50IG5vZGUgaWYgd2UgdHJpZ2dlciBhbiBlbGVtZW50XG4gICAgICAgICAgICAvLyBpZiBub3QgYWxyZWFkeSBvcGVuZWRcbiAgICAgICAgICAgIHRoYXQudWkudHJlZS5qc3RyZWUoJ29wZW5fbm9kZScsIG9iai5wYXJlbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgZXZlbnQgZm9yIGN1dCBhbmQgcGFzdGVcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1pdGVtLWN1dCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGF0Ll9jdXRPckNvcHkoeyB0eXBlOiAnY3V0JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc2V0IGV2ZW50IGZvciBjdXQgYW5kIHBhc3RlXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssICcuanMtY21zLXRyZWUtaXRlbS1jb3B5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoYXQuX2N1dE9yQ29weSh7IHR5cGU6ICdjb3B5JywgZWxlbWVudDogJCh0aGlzKSB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byBwYXN0ZVxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvciwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdjbXMtcGFnZXRyZWUtZHJvcGRvd24taXRlbS1kaXNhYmxlZCcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhhdC5fcGFzdGUoZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkdmFuY2VkIHNldHRpbmdzIGxpbmsgaGFuZGxpbmdcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtdHJlZS1hZHZhbmNlZC1zZXR0aW5ncycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgbGluayA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAobGluay5kYXRhKCd1cmwnKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGxpbmsuZGF0YSgndXJsJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBhZGQgZXZlbnRzIGZvciBlcnJvciByZWxvYWQgKG1lc3NhZ2VsaXN0KVxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKHRoaXMuY2xpY2ssICcubWVzc2FnZWxpc3QgLmNtcy10cmVlLXJlbG9hZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJvcGFnYXRlIHRoZSBzaXRlcyBkcm9wZG93biBcImxpID4gYVwiIGVudHJpZXMgdG8gdGhlIGhpZGRlbiBzaXRlcyBmb3JtXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtc2l0ZS10cmlnZ2VyJykub24odGhpcy5jbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgIC8vIHByZXZlbnQgaWYgcGFyZW50IGlzIGFjdGl2ZVxuICAgICAgICAgICAgaWYgKGVsLnBhcmVudCgpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoYXQudWkuc2l0ZUZvcm0uZmluZCgnc2VsZWN0JylcbiAgICAgICAgICAgICAgICAudmFsKGVsLmRhdGEoKS5pZCkuZW5kKCkuc3VibWl0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZGl0aW9uYWwgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgdGhpcy5fc2V0dXBEcm9wZG93bnMoKTtcbiAgICAgICAgdGhpcy5fc2V0dXBTZWFyY2goKTtcblxuICAgICAgICAvLyBtYWtlIHN1cmUgYWpheCBwb3N0IHJlcXVlc3RzIGFyZSB3b3JraW5nXG4gICAgICAgIHRoaXMuX3NldEFqYXhQb3N0KCcuanMtY21zLXRyZWUtaXRlbS1tZW51IGEnKTtcbiAgICAgICAgdGhpcy5fc2V0QWpheFBvc3QoJy5qcy1jbXMtdHJlZS1sYW5nLXRyaWdnZXInKTtcblxuICAgICAgICB0aGlzLl9zZXR1cFBhZ2VWaWV3KCk7XG4gICAgICAgIHRoYXQuX3NldHVwU3RpY2t5SGVhZGVyKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhlbHBlciB0byBwcm9jZXNzIHRoZSBjdXQgYW5kIGNvcHkgZXZlbnRzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfY3V0T3JDb3B5XG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvYmpdXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvYmoudHlwZV0gZWl0aGVyICdjdXQnIG9yICdjb3B5J1xuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLmVsZW1lbnRdIG9yaWdpbmF0ZWQgdHJpZ2dlciBlbGVtZW50XG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbnx2b2lkfVxuICAgICAqL1xuICAgIF9jdXRPckNvcHk6IGZ1bmN0aW9uIF9jdXRPckNvcHkob2JqKSB7XG4gICAgICAgIC8vIHByZXZlbnQgYWN0aW9ucyBpZiB5b3UgdHJ5IHRvIGNvcHkgYSBwYWdlIHdpdGggYW4gYXBwaG9va1xuICAgICAgICBpZiAob2JqLnR5cGUgPT09ICdjb3B5JyAmJiBvYmouZWxlbWVudC5kYXRhKCkuYXBwaG9vaykge1xuICAgICAgICAgICAgdGhpcy5zaG93RXJyb3IodGhpcy5vcHRpb25zLmxhbmcuYXBwaG9vayk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIganNUcmVlSWQgPSB0aGlzLl9nZXROb2RlSWQob2JqLmVsZW1lbnQuY2xvc2VzdCgnLmpzdHJlZS1ncmlkLWNlbGwnKSk7XG5cbiAgICAgICAgLy8gcmVzZXRzIGlmIHdlIGNsaWNrIGFnYWluXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSBvYmoudHlwZSAmJiBqc1RyZWVJZCA9PT0gdGhpcy5jbGlwYm9hcmQuaWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2xpcGJvYXJkLnR5cGUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQuaWQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gb2JqLmVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC50eXBlID0gb2JqLnR5cGU7XG4gICAgICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IGpzVHJlZUlkO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgdG8gcHJvY2VzcyB0aGUgcGFzdGUgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9wYXN0ZVxuICAgICAqIEBwYXJhbSB7JC5FdmVudH0gZXZlbnQgY2xpY2sgZXZlbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9wYXN0ZTogZnVuY3Rpb24gX3Bhc3RlKGV2ZW50KSB7XG4gICAgICAgIC8vIGhpZGUgaGVscGVycyBhZnRlciB3ZSBwaWNrZWQgb25lXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuXG4gICAgICAgIHZhciBjb3B5RnJvbUlkID0gdGhpcy5fZ2V0Tm9kZUlkKHRoaXMuY2xpcGJvYXJkLm9yaWdpbik7XG4gICAgICAgIHZhciBjb3B5VG9JZCA9IHRoaXMuX2dldE5vZGVJZCgkKGV2ZW50LmN1cnJlbnRUYXJnZXQpKTtcblxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSA9PT0gJ2N1dCcpIHtcbiAgICAgICAgICAgIHRoaXMudWkudHJlZS5qc3RyZWUoJ2N1dCcsIGNvcHlGcm9tSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgnY29weScsIGNvcHlGcm9tSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy51aS50cmVlLmpzdHJlZSgncGFzdGUnLCBjb3B5VG9JZCwgJ2xhc3QnKTtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaWQgPSBudWxsO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC50eXBlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQub3JpZ2luID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlwYm9hcmQuaXNQYXN0aW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJldHJlaXZlcyBhIGxpc3Qgb2Ygbm9kZXMgZnJvbSBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0U3RvcmVkTm9kZUlkc1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge0FycmF5fSBsaXN0IG9mIGlkc1xuICAgICAqL1xuICAgIF9nZXRTdG9yZWROb2RlSWRzOiBmdW5jdGlvbiBfZ2V0U3RvcmVkTm9kZUlkcygpIHtcbiAgICAgICAgcmV0dXJuIENNUy5zZXR0aW5ncy5wYWdldHJlZSB8fCBbXTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU3RvcmVzIGEgbm9kZSBpbiBsb2NhbCBzdG9yYWdlLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc3RvcmVOb2RlSWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZCB0byBiZSBzdG9yZWRcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBpZCB0aGF0IGhhcyBiZWVuIHN0b3JlZFxuICAgICAqL1xuICAgIF9zdG9yZU5vZGVJZDogZnVuY3Rpb24gX3N0b3JlTm9kZUlkKGlkKSB7XG4gICAgICAgIHZhciBudW1iZXIgPSBpZDtcbiAgICAgICAgdmFyIHN0b3JhZ2UgPSB0aGlzLl9nZXRTdG9yZWROb2RlSWRzKCk7XG5cbiAgICAgICAgLy8gc3RvcmUgdmFsdWUgb25seSBpZiBpdCBpc24ndCB0aGVyZSB5ZXRcbiAgICAgICAgaWYgKHN0b3JhZ2UuaW5kZXhPZihudW1iZXIpID09PSAtMSkge1xuICAgICAgICAgICAgc3RvcmFnZS5wdXNoKG51bWJlcik7XG4gICAgICAgIH1cblxuICAgICAgICBDTVMuc2V0dGluZ3MucGFnZXRyZWUgPSBzdG9yYWdlO1xuICAgICAgICBIZWxwZXJzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG5cbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIG5vZGUgaW4gbG9jYWwgc3RvcmFnZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3JlbW92ZU5vZGVJZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIHRvIGJlIHN0b3JlZFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGlkIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZFxuICAgICAqL1xuICAgIF9yZW1vdmVOb2RlSWQ6IGZ1bmN0aW9uIF9yZW1vdmVOb2RlSWQoaWQpIHtcbiAgICAgICAgdmFyIG51bWJlciA9IGlkO1xuICAgICAgICB2YXIgc3RvcmFnZSA9IHRoaXMuX2dldFN0b3JlZE5vZGVJZHMoKTtcbiAgICAgICAgdmFyIGluZGV4ID0gc3RvcmFnZS5pbmRleE9mKG51bWJlcik7XG5cbiAgICAgICAgLy8gcmVtb3ZlIGdpdmVuIGlkIGZyb20gc3RvcmFnZVxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBzdG9yYWdlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBDTVMuc2V0dGluZ3MucGFnZXRyZWUgPSBzdG9yYWdlO1xuICAgICAgICBIZWxwZXJzLnNldFNldHRpbmdzKENNUy5zZXR0aW5ncyk7XG5cbiAgICAgICAgcmV0dXJuIG51bWJlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTW92ZXMgYSBub2RlIGFmdGVyIGRyYWcgJiBkcm9wLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfbW92ZU5vZGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29ial1cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai5pZF0gY3VycmVudCBlbGVtZW50IGlkIGZvciB1cmwgbWF0Y2hpbmdcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29iai50YXJnZXRdIHRhcmdldCBzaWJsaW5nIG9yIHBhcmVudFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb2JqLnBvc2l0aW9uXSBlaXRoZXIgYGxlZnRgLCBgcmlnaHRgIG9yIGBsYXN0LWNoaWxkYFxuICAgICAqIEByZXR1cm5zIHskLkRlZmVycmVkfSBhamF4IHJlcXVlc3Qgb2JqZWN0XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbW92ZU5vZGU6IGZ1bmN0aW9uIF9tb3ZlTm9kZShvYmopIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIG9iai5zaXRlID0gdGhhdC5vcHRpb25zLnNpdGU7XG5cbiAgICAgICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMubW92ZS5yZXBsYWNlKCd7aWR9Jywgb2JqLmlkKSxcbiAgICAgICAgICAgIGRhdGE6IG9ialxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuX3Nob3dTdWNjZXNzKG9iai5pZCk7XG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvcGllcyBhIG5vZGUgaW50byB0aGUgc2VsZWN0ZWQgbm9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2NvcHlOb2RlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBwYWdlIG9ialxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NvcHlOb2RlOiBmdW5jdGlvbiBfY29weU5vZGUob2JqKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgdmFyIG5vZGUgPSB0aGF0Ll9nZXROb2RlUG9zaXRpb24ob2JqKTtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICBzaXRlOiB0aGlzLm9wdGlvbnMuc2l0ZSxcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcmVmZXIgdG8gdGhlIG9yaWdpbmFsIGl0ZW0gaGVyZSwgYXMgdGhlIGNvcGllZFxuICAgICAgICAgICAgLy8gbm9kZSB3aWxsIGhhdmUgbm8gZGF0YSBhdHRyaWJ1dGVzIHN0b3JlZCBhdCBpdCAobm90IGEgY2xvbmUpXG4gICAgICAgICAgICBpZDogb2JqLm9yaWdpbmFsLmRhdGEuaWQsXG4gICAgICAgICAgICBwb3NpdGlvbjogbm9kZS5wb3NpdGlvblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRhcmdldCBwcm92aWRlZCwgdGhlIG5vZGUgbGFuZHMgaW4gcm9vdFxuICAgICAgICBpZiAobm9kZS50YXJnZXQpIHtcbiAgICAgICAgICAgIGRhdGEudGFyZ2V0ID0gbm9kZS50YXJnZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhhdC5vcHRpb25zLnBlcm1pc3Npb24pIHtcbiAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gbG9hZCBhIGRpYWxvZyBmaXJzdCwgdG8gY2hlY2sgaWYgcGVybWlzc2lvbnMgc2hvdWxkXG4gICAgICAgICAgICAvLyBiZSBjb3BpZWQgb3Igbm90XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogdGhhdC5vcHRpb25zLnVybHMuY29weVBlcm1pc3Npb24ucmVwbGFjZSgne2lkfScsIGRhdGEuaWQpLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIC8vIHRoZSBkaWFsb2cgaXMgbG9hZGVkIHZpYSB0aGUgYWpheCByZXNwb25zIG9yaWdpbmF0aW5nIGZyb21cbiAgICAgICAgICAgIC8vIGB0ZW1wbGF0ZXMvYWRtaW4vY21zL3BhZ2UvdHJlZS9jb3B5X3ByZW1pc3Npb25zLmh0bWxgXG4gICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChkaWFsb2cpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRpYWxvZy5hcHBlbmQoZGlhbG9nKTtcbiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5zaG93RXJyb3IoZXJyb3Iuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gYXR0YWNoIGV2ZW50cyB0byB0aGUgcGVybWlzc2lvbiBkaWFsb2dcbiAgICAgICAgICAgIHRoaXMudWkuZGlhbG9nLm9mZih0aGlzLmNsaWNrLCAnLmNhbmNlbCcpLm9uKHRoaXMuY2xpY2ssICcuY2FuY2VsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGp1c3QgY29waWVkIG5vZGVcbiAgICAgICAgICAgICAgICB0aGF0LnVpLnRyZWUuanN0cmVlKCdkZWxldGVfbm9kZScsIG9iai5ub2RlLmlkKTtcbiAgICAgICAgICAgICAgICAkKCcuanMtY21zLWRpYWxvZycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJy5qcy1jbXMtZGlhbG9nLWRpbW1lcicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSkub2ZmKHRoaXMuY2xpY2ssICcuc3VibWl0Jykub24odGhpcy5jbGljaywgJy5zdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VibWl0QnV0dG9uID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBzdWJtaXRCdXR0b24uY2xvc2VzdCgnZm9ybScpLnNlcmlhbGl6ZSgpLnNwbGl0KCcmJyk7XG5cbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24ucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBmb3JtIGRhdGEgYW5kIGF0dGFjaCB0byBvYmpcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZvcm1EYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFbZm9ybURhdGFbaV0uc3BsaXQoJz0nKVswXV0gPSBmb3JtRGF0YVtpXS5zcGxpdCgnPScpWzFdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoYXQuX3NhdmVDb3BpZWROb2RlKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9zYXZlQ29waWVkTm9kZShkYXRhKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZW5kcyB0aGUgcmVxdWVzdCB0byBjb3B5IGEgbm9kZS5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NhdmVDb3BpZWROb2RlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBub2RlIHBvc2l0aW9uIGluZm9ybWF0aW9uXG4gICAgICogQHJldHVybnMgeyQuRGVmZXJyZWR9XG4gICAgICovXG4gICAgX3NhdmVDb3BpZWROb2RlOiBmdW5jdGlvbiBfc2F2ZUNvcGllZE5vZGUoZGF0YSkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gc2VuZCB0aGUgcmVhbCBhamF4IHJlcXVlc3QgZm9yIGNvcHlpbmcgdGhlIHBsdWdpblxuICAgICAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgdXJsOiB0aGF0Lm9wdGlvbnMudXJscy5jb3B5LnJlcGxhY2UoJ3tpZH0nLCBkYXRhLmlkKSxcbiAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0Ll9yZWxvYWRIZWxwZXIoKTtcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoYXQuc2hvd0Vycm9yKGVycm9yLnN0YXR1c1RleHQpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBlbGVtZW50IGZyb20gYW55IHN1YiBub2Rlcy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2dldEVsZW1lbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbCBqUXVlcnkgbm9kZSBmb3JtIHdoZXJlIHRvIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGpzVHJlZSBub2RlIGVsZW1lbnQgaWRcbiAgICAgKi9cbiAgICBfZ2V0Tm9kZUlkOiBmdW5jdGlvbiBfZ2V0Tm9kZUlkKGVsKSB7XG4gICAgICAgIHZhciBjbHMgPSBlbC5jbG9zZXN0KCcuanN0cmVlLWdyaWQtY2VsbCcpLmF0dHIoJ2NsYXNzJyk7XG5cbiAgICAgICAgLy8gaWYgaXQncyBub3QgYSBjZWxsLCBhc3N1bWUgaXQncyB0aGUgcm9vdCBub2RlXG4gICAgICAgIHJldHVybiBjbHMgPyBjbHMucmVwbGFjZSgvLipqc2dyaWRfKC4rPylfY29sLiovLCAnJDEnKSA6ICcjJztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgbmV3IG5vZGUgcG9zaXRpb24gYWZ0ZXIgbW92aW5nLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZ2V0Tm9kZVBvc2l0aW9uXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIGpzdHJlZSBtb3ZlIG9iamVjdFxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9IGV2YWx1YXRlZCBvYmplY3Qgd2l0aCBwYXJhbXNcbiAgICAgKi9cbiAgICBfZ2V0Tm9kZVBvc2l0aW9uOiBmdW5jdGlvbiBfZ2V0Tm9kZVBvc2l0aW9uKG9iaikge1xuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMudWkudHJlZS5qc3RyZWUoJ2dldF9ub2RlJywgb2JqLm5vZGUucGFyZW50KTtcblxuICAgICAgICBkYXRhLnBvc2l0aW9uID0gb2JqLnBvc2l0aW9uO1xuXG4gICAgICAgIC8vIGpzdHJlZSBpbmRpY2F0ZXMgbm8gcGFyZW50IHdpdGggYCNgLCBpbiB0aGlzIGNhc2Ugd2UgZG8gbm90XG4gICAgICAgIC8vIG5lZWQgdG8gc2V0IHRoZSB0YXJnZXQgYXR0cmlidXRlIGF0IGFsbFxuICAgICAgICBpZiAob2JqLnBhcmVudCAhPT0gJyMnKSB7XG4gICAgICAgICAgICBkYXRhLnRhcmdldCA9IG5vZGUuZGF0YS5pZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWUgZnVuY3Rpb25zIGxpa2UgY29weSBjcmVhdGUgYSBuZXcgZWxlbWVudCB3aXRoIGEgbmV3IGlkLFxuICAgICAgICAvLyBpbiB0aGlzIGNhc2Ugd2UgbmVlZCB0byBzZXQgYGRhdGEuaWRgIG1hbnVhbGx5XG4gICAgICAgIGlmIChvYmoubm9kZSAmJiBvYmoubm9kZS5kYXRhKSB7XG4gICAgICAgICAgICBkYXRhLmlkID0gb2JqLm5vZGUuZGF0YS5pZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGdlbmVyYWwgdG9vbHRpcHMgdGhhdCBjYW4gaGF2ZSBhIGxpc3Qgb2YgbGlua3Mgb3IgY29udGVudC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwRHJvcGRvd25zXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBEcm9wZG93bnM6IGZ1bmN0aW9uIF9zZXR1cERyb3Bkb3ducygpIHtcbiAgICAgICAgdGhpcy5fZHJvcGRvd25zID0gbmV3IFBhZ2VUcmVlRHJvcGRvd25zKHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy51aS5jb250YWluZXJcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZXMgcGFnZSB2aWV3IGNsaWNrLiBVc3VhbCB1c2UgY2FzZSBpcyB0aGF0IGFmdGVyIHlvdSBjbGlja1xuICAgICAqIG9uIHZpZXcgcGFnZSBpbiB0aGUgcGFnZXRyZWUgLSBzaWRlZnJhbWUgaXMgbm8gbG9uZ2VyIG5lZWRlZCxcbiAgICAgKiBzbyB3ZSBjbG9zZSBpdC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwUGFnZVZpZXdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFBhZ2VWaWV3OiBmdW5jdGlvbiBfc2V0dXBQYWdlVmlldygpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuICAgICAgICB2YXIgcGFyZW50ID0gd2luLnBhcmVudCA/IHdpbi5wYXJlbnQgOiB3aW47XG5cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgJy5qcy1jbXMtcGFnZXRyZWUtcGFnZS12aWV3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcGFyZW50LkNNUy5BUEkuSGVscGVycy5zZXRTZXR0aW5ncygkLmV4dGVuZCh0cnVlLCB7fSwgQ01TLnNldHRpbmdzLCB7XG4gICAgICAgICAgICAgICAgc2lkZWZyYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaGlkZGVuOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc2V0dXBTdGlja3lIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zZXR1cFN0aWNreUhlYWRlcjogZnVuY3Rpb24gX3NldHVwU3RpY2t5SGVhZGVyKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC51aS50cmVlLm9uKCdyZWFkeS5qc3RyZWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LmhlYWRlciA9IG5ldyBQYWdlVHJlZVN0aWNreUhlYWRlcih7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiB0aGF0LnVpLmNvbnRhaW5lclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VycyB0aGUgbGlua3MgYGhyZWZgIGFzIGFqYXggcG9zdCByZXF1ZXN0LlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfc2V0QWpheFBvc3RcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSB0cmlnZ2VyIGpRdWVyeSBsaW5rIHRhcmdldFxuICAgICAqL1xuICAgIF9zZXRBamF4UG9zdDogZnVuY3Rpb24gX3NldEFqYXhQb3N0KHRyaWdnZXIpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRyaWdnZXIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogJCh0aGlzKS5hdHRyKCdocmVmJylcbiAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc2VsZiA9PT0gd2luZG93LnRvcCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzaW1wbHkgcmVsb2FkIHRoZSBwYWdlXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuX3JlbG9hZEhlbHBlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGluIHRoZSBzaWRlZnJhbWUgd2UgaGF2ZSB0byBhY3R1YWxseVxuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgcHVibGlzaGluZyBhIHBhZ2Ugd2UncmUgY3VycmVudGx5IGluXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgaWYgdGhlIHNsdWcgZGlkIGNoYW5nZSB3ZSB3b3VsZCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIHRoYXQgbmV3IHNsdWdcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJvYmxlbSBoZXJlIGlzIHRoYXQgaW4gY2FzZSBvZiB0aGUgYXBwaG9va2VkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG1vZGVsIGFuZCBwayBhcmUgZW1wdHkgYW5kIHJlbG9hZEJyb3dzZXIgZG9lc24ndCByZWFsbHlcbiAgICAgICAgICAgICAgICAgICAgLy8gZG8gYW55dGhpbmcgLSBzbyBoZXJlIHdlIHNwZWNpZmljYWxseSBmb3JjZSB0aGUgZGF0YVxuICAgICAgICAgICAgICAgICAgICAvLyB0byBiZSB0aGUgZGF0YSBhYm91dCB0aGUgcGFnZSBhbmQgbm90IHRoZSBtb2RlbFxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gd2luZG93LnBhcmVudCA/IHdpbmRvdy5wYXJlbnQgOiB3aW5kb3c7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRklYTUUgc2hvdWxkbid0IGJlIGhhcmRjb2RlZFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6ICdjbXMucGFnZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwazogcGFyZW50LkNNUy5jb25maWcucmVxdWVzdC5wYWdlX2lkXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgSGVscGVycy5yZWxvYWRCcm93c2VyKCdSRUZSRVNIX1BBR0UnLCBmYWxzZSwgdHJ1ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dFcnJvcihlcnJvci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0cyBldmVudHMgZm9yIHRoZSBzZWFyY2ggb24gdGhlIGhlYWRlci5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3NldHVwU2VhcmNoXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBTZWFyY2g6IGZ1bmN0aW9uIF9zZXR1cFNlYXJjaCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgY2xpY2sgPSB0aGlzLmNsaWNrICsgJy5zZWFyY2gnO1xuXG4gICAgICAgIHZhciBmaWx0ZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZpbHRlclRyaWdnZXIgPSB0aGlzLnVpLmNvbnRhaW5lci5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWhlYWRlci1maWx0ZXItdHJpZ2dlcicpO1xuICAgICAgICB2YXIgZmlsdGVyQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyLWNvbnRhaW5lcicpO1xuICAgICAgICB2YXIgZmlsdGVyQ2xvc2UgPSBmaWx0ZXJDb250YWluZXIuZmluZCgnLmpzLWNtcy1wYWdldHJlZS1oZWFkZXItc2VhcmNoLWNsb3NlJyk7XG4gICAgICAgIHZhciBmaWx0ZXJDbGFzcyA9ICdjbXMtcGFnZXRyZWUtaGVhZGVyLWZpbHRlci1hY3RpdmUnO1xuICAgICAgICB2YXIgcGFnZVRyZWVIZWFkZXIgPSAkKCcuY21zLXBhZ2V0cmVlLWhlYWRlcicpO1xuXG4gICAgICAgIHZhciB2aXNpYmxlRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaCcpO1xuICAgICAgICB2YXIgaGlkZGVuRm9ybSA9IHRoaXMudWkuY29udGFpbmVyLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtaGVhZGVyLXNlYXJjaC1jb3B5IGZvcm0nKTtcblxuICAgICAgICB2YXIgc2VhcmNoQ29udGFpbmVyID0gdGhpcy51aS5jb250YWluZXIuZmluZCgnLmNtcy1wYWdldHJlZS1oZWFkZXItZmlsdGVyJyk7XG4gICAgICAgIHZhciBzZWFyY2hGaWVsZCA9IHNlYXJjaENvbnRhaW5lci5maW5kKCcjZmllbGQtc2VhcmNoYmFyJyk7XG4gICAgICAgIHZhciB0aW1lb3V0ID0gMjAwO1xuXG4gICAgICAgIC8vIGFkZCBhY3RpdmUgY2xhc3Mgd2hlbiBmb2N1c2luZyB0aGUgc2VhcmNoIGZpZWxkXG4gICAgICAgIHNlYXJjaEZpZWxkLm9uKCdmb2N1cycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIuYWRkQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VhcmNoRmllbGQub24oJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgaXMgcmVxdWlyZWQgdG8gcHJldmVudCB0aGUgc2VhcmNoIGZpZWxkIGZyb20ganVtcGluZ1xuICAgICAgICAgICAgLy8gYmV0d2VlbiBlbmxhcmdpbmcgYW5kIHNocmlua2luZ1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXJBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZVRyZWVIZWFkZXIucmVtb3ZlQ2xhc3MoZmlsdGVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYoY2xpY2spO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzaG93cy9oaWRlcyBmaWx0ZXIgYm94XG4gICAgICAgIGZpbHRlclRyaWdnZXIuYWRkKGZpbHRlckNsb3NlKS5vbihjbGljaywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBpZiAoZmlsdGVyQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyQ29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBwYWdlVHJlZUhlYWRlci5yZW1vdmVDbGFzcyhmaWx0ZXJDbGFzcyk7XG4gICAgICAgICAgICAgICAgdGhhdC51aS5kb2N1bWVudC5vZmYoY2xpY2spO1xuICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJDb250YWluZXIuc2hvdygpO1xuICAgICAgICAgICAgICAgIHBhZ2VUcmVlSGVhZGVyLmFkZENsYXNzKGZpbHRlckNsYXNzKTtcbiAgICAgICAgICAgICAgICB0aGF0LnVpLmRvY3VtZW50Lm9uKGNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclRyaWdnZXIudHJpZ2dlcihjbGljayk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZmlsdGVyQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcHJldmVudCBjbG9zaW5nIHdoZW4gb24gZmlsdGVyIGNvbnRhaW5lclxuICAgICAgICBmaWx0ZXJDb250YWluZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZCBoaWRkZW4gZmllbGRzIHRvIHRoZSBmb3JtIHRvIG1haW50YWluIGZpbHRlciBwYXJhbXNcbiAgICAgICAgdmlzaWJsZUZvcm0uYXBwZW5kKGhpZGRlbkZvcm0uZmluZCgnaW5wdXRbdHlwZT1cImhpZGRlblwiXScpKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvd3MgcGFzdGUgaGVscGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2VuYWJsZVBhc3RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWxlY3Rvcj10aGlzLm9wdGlvbnMucGFzdGVTZWxlY3Rvcl0ganF1ZXJ5IHNlbGVjdG9yXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZW5hYmxlUGFzdGU6IGZ1bmN0aW9uIF9lbmFibGVQYXN0ZShzZWxlY3Rvcikge1xuICAgICAgICB2YXIgc2VsID0gdHlwZW9mIHNlbGVjdG9yID09PSAndW5kZWZpbmVkJyA/XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucGFzdGVTZWxlY3RvciA6XG4gICAgICAgICAgICBzZWxlY3RvciArICcgJyArIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yO1xuICAgICAgICB2YXIgZHJvcGRvd25TZWwgPSAnLmpzLWNtcy1wYWdldHJlZS1hY3Rpb25zLWRyb3Bkb3duJztcblxuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgZHJvcGRvd25TZWwgPSBzZWxlY3RvciArICcgLmpzLWNtcy1wYWdldHJlZS1hY3Rpb25zLWRyb3Bkb3duJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhlbHBlcnMgYXJlIGdlbmVyYXRlZCBvbiB0aGUgZmx5LCBzbyB3ZSBuZWVkIHRvIHJlZmVyZW5jZVxuICAgICAgICAvLyB0aGVtIGV2ZXJ5IHNpbmdsZSB0aW1lXG4gICAgICAgICQoc2VsKS5yZW1vdmVDbGFzcygnY21zLXBhZ2V0cmVlLWRyb3Bkb3duLWl0ZW0tZGlzYWJsZWQnKTtcblxuICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgIGlmICh0aGlzLmNsaXBib2FyZC50eXBlID09PSAnY3V0Jykge1xuICAgICAgICAgICAgZGF0YS5oYXNfY3V0ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGEuaGFzX2NvcHkgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vdCBsb2FkZWQgYWN0aW9ucyBkcm9wZG93biBoYXZlIHRvIGJlIHVwZGF0ZWQgYXMgd2VsbFxuICAgICAgICAkKGRyb3Bkb3duU2VsKS5kYXRhKCdsYXp5VXJsRGF0YScsIGRhdGEpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaWRlcyBwYXN0ZSBoZWxwZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZGlzYWJsZVBhc3RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWxlY3Rvcj10aGlzLm9wdGlvbnMucGFzdGVTZWxlY3Rvcl0ganF1ZXJ5IHNlbGVjdG9yXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZGlzYWJsZVBhc3RlOiBmdW5jdGlvbiBfZGlzYWJsZVBhc3RlKHNlbGVjdG9yKSB7XG4gICAgICAgIHZhciBzZWwgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICd1bmRlZmluZWQnID9cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5wYXN0ZVNlbGVjdG9yIDpcbiAgICAgICAgICAgIHNlbGVjdG9yICsgJyAnICsgdGhpcy5vcHRpb25zLnBhc3RlU2VsZWN0b3I7XG4gICAgICAgIHZhciBkcm9wZG93blNlbCA9ICcuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBkcm9wZG93blNlbCA9IHNlbGVjdG9yICsgJyAuanMtY21zLXBhZ2V0cmVlLWFjdGlvbnMtZHJvcGRvd24nO1xuICAgICAgICB9XG5cblxuICAgICAgICAvLyBoZWxwZXJzIGFyZSBnZW5lcmF0ZWQgb24gdGhlIGZseSwgc28gd2UgbmVlZCB0byByZWZlcmVuY2VcbiAgICAgICAgLy8gdGhlbSBldmVyeSBzaW5nbGUgdGltZVxuICAgICAgICAkKHNlbCkuYWRkQ2xhc3MoJ2Ntcy1wYWdldHJlZS1kcm9wZG93bi1pdGVtLWRpc2FibGVkJyk7XG5cbiAgICAgICAgLy8gbm90IGxvYWRlZCBhY3Rpb25zIGRyb3Bkb3duIGhhdmUgdG8gYmUgdXBkYXRlZCBhcyB3ZWxsXG4gICAgICAgICQoZHJvcGRvd25TZWwpLnJlbW92ZURhdGEoJ2xhenlVcmxEYXRhJyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGhlbHBlcnMgYWZ0ZXIgYGFmdGVyX29wZW4uanN0cmVlYFxuICAgICAqIG9yIGBfY3V0T3JDb3B5YCBpcyB0cmlnZ2VyZWQuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF91cGRhdGVQYXN0ZUhlbHBlcnNTdGF0ZVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3VwZGF0ZVBhc3RlSGVscGVyc1N0YXRlOiBmdW5jdGlvbiBfdXBkYXRlUGFzdGVIZWxwZXJzU3RhdGUoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSAmJiB0aGlzLmNsaXBib2FyZC5pZCkge1xuICAgICAgICAgICAgdGhpcy5fZW5hYmxlUGFzdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhpZGUgY3V0IGVsZW1lbnQgYW5kIGl0J3MgZGVzY2VuZGFudHMnIHBhc3RlIGhlbHBlcnMgaWYgaXQgaXMgdmlzaWJsZVxuICAgICAgICBpZiAodGhpcy5jbGlwYm9hcmQudHlwZSA9PT0gJ2N1dCcgJiYgdGhpcy5jbGlwYm9hcmQub3JpZ2luKSB7XG4gICAgICAgICAgICB2YXIgZGVzY2VuZGFudElkcyA9IHRoaXMuX2dldERlc2NlbmRhbnRzSWRzKHRoaXMuY2xpcGJvYXJkLmlkKTtcbiAgICAgICAgICAgIHZhciBub2RlcyA9IFt0aGlzLmNsaXBib2FyZC5pZF07XG5cbiAgICAgICAgICAgIGlmIChkZXNjZW5kYW50SWRzICYmIGRlc2NlbmRhbnRJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbm9kZXMgPSBub2Rlcy5jb25jYXQoZGVzY2VuZGFudElkcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5fZGlzYWJsZVBhc3RlKCcuanNncmlkXycgKyBpZCArICdfY29sJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93cyBzdWNjZXNzIG1lc3NhZ2Ugb24gbm9kZSBhZnRlciBzdWNjZXNzZnVsIGFjdGlvbi5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3Nob3dTdWNjZXNzXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIGlkIG9mIHRoZSBlbGVtZW50IHRvIGFkZCB0aGUgc3VjY2VzcyBjbGFzc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3Nob3dTdWNjZXNzOiBmdW5jdGlvbiBfc2hvd1N1Y2Nlc3MoaWQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLnVpLnRyZWUuZmluZCgnbGlbZGF0YS1pZD1cIicgKyBpZCArICdcIl0nKTtcblxuICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdjbXMtdHJlZS1ub2RlLXN1Y2Nlc3MnKTtcbiAgICAgICAgfSwgdGhpcy5zdWNjZXNzVGltZXIpO1xuICAgICAgICAvLyBoaWRlIGVsZW1lbnRzXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQYXN0ZSgpO1xuICAgICAgICB0aGlzLmNsaXBib2FyZC5pZCA9IG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB3ZSBzaG91bGQgcmVsb2FkIHRoZSBpZnJhbWUgb3IgZW50aXJlIHdpbmRvdy4gRm9yIHRoaXMgd2VcbiAgICAgKiBuZWVkIHRvIHNraXAgYENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7YC5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX3JlbG9hZEhlbHBlclxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlbG9hZEhlbHBlcjogZnVuY3Rpb24gX3JlbG9hZEhlbHBlcigpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5zZWxmID09PSB3aW5kb3cudG9wKSB7XG4gICAgICAgICAgICBIZWxwZXJzLnJlbG9hZEJyb3dzZXIoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5cyBhbiBlcnJvciB3aXRoaW4gdGhlIGRqYW5nbyBVSS5cbiAgICAgKlxuICAgICAqIEBtZXRob2Qgc2hvd0Vycm9yXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2Ugc3RyaW5nIG1lc3NhZ2UgdG8gZGlzcGxheVxuICAgICAqL1xuICAgIHNob3dFcnJvcjogZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIG1lc3NhZ2VzID0gJCgnLm1lc3NhZ2VsaXN0Jyk7XG4gICAgICAgIHZhciBicmVhZGNydW1iID0gJCgnLmJyZWFkY3J1bWJzJyk7XG4gICAgICAgIHZhciByZWxvYWQgPSB0aGlzLm9wdGlvbnMubGFuZy5yZWxvYWQ7XG4gICAgICAgIHZhciB0cGwgPSAnJyArXG4gICAgICAgICAgICAnPHVsIGNsYXNzPVwibWVzc2FnZWxpc3RcIj4nICtcbiAgICAgICAgICAgICcgICA8bGkgY2xhc3M9XCJlcnJvclwiPicgK1xuICAgICAgICAgICAgJyAgICAgICB7bXNnfSAnICtcbiAgICAgICAgICAgICcgICAgICAgPGEgaHJlZj1cIiNyZWxvYWRcIiBjbGFzcz1cImNtcy10cmVlLXJlbG9hZFwiPiAnICsgcmVsb2FkICsgJyA8L2E+JyArXG4gICAgICAgICAgICAnICAgPC9saT4nICtcbiAgICAgICAgICAgICc8L3VsPic7XG4gICAgICAgIHZhciBtc2cgPSB0cGwucmVwbGFjZSgne21zZ30nLCAnPHN0cm9uZz4nICsgdGhpcy5vcHRpb25zLmxhbmcuZXJyb3IgKyAnPC9zdHJvbmc+ICcgKyBtZXNzYWdlKTtcblxuICAgICAgICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBtZXNzYWdlcy5yZXBsYWNlV2l0aChtc2cpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnJlYWRjcnVtYi5hZnRlcihtc2cpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2dldERlc2NlbmRhbnRzSWRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZUlkIGpzdHJlZSBpZCBvZiB0aGUgbm9kZSwgZS5nLiBqMV8zXG4gICAgICogQHJldHVybnMge1N0cmluZ1tdfSBhcnJheSBvZiBpZHNcbiAgICAgKi9cbiAgICBfZ2V0RGVzY2VuZGFudHNJZHM6IGZ1bmN0aW9uIF9nZXREZXNjZW5kYW50c0lkcyhub2RlSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudWkudHJlZS5qc3RyZWUodHJ1ZSkuZ2V0X25vZGUobm9kZUlkKS5jaGlsZHJlbl9kO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9oYXNQZXJtaXNpb25cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlIGpzdHJlZSBub2RlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBlcm1pc3Npb24gbW92ZSAvIGFkZFxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgICAqL1xuICAgIF9oYXNQZXJtaXNzaW9uOiBmdW5jdGlvbiBfaGFzUGVybWlzaW9uKG5vZGUsIHBlcm1pc3Npb24pIHtcbiAgICAgICAgaWYgKG5vZGUuaWQgPT09ICcjJyAmJiBwZXJtaXNzaW9uID09PSAnYWRkJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5oYXNBZGRSb290UGVybWlzc2lvbjtcbiAgICAgICAgfSBlbHNlIGlmIChub2RlLmlkID09PSAnIycpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub2RlLmxpX2F0dHJbJ2RhdGEtJyArIHBlcm1pc3Npb24gKyAnLXBlcm1pc3Npb24nXSA9PT0gJ3RydWUnO1xuICAgIH1cbn0pO1xuXG4vLyBzaG9ydGhhbmQgZm9yIGpRdWVyeShkb2N1bWVudCkucmVhZHkoKTtcbiQoZnVuY3Rpb24gKCkge1xuICAgIC8vIGxvYWQgY21zIHNldHRpbmdzIGJlZm9yZWhhbmRcbiAgICAvLyBoYXZlIHRvIHNldCB0b29sYmFyIHRvIFwiZXhwYW5kZWRcIiBieSBkZWZhdWx0XG4gICAgLy8gb3RoZXJ3aXNlIGluaXRpYWxpemF0aW9uIHdpbGwgYmUgaW5jb3JyZWN0IHdoZW4geW91XG4gICAgLy8gZ28gZmlyc3QgdG8gcGFnZXMgYW5kIHRoZW4gdG8gbm9ybWFsIHBhZ2VcbiAgICB3aW5kb3cuQ01TLmNvbmZpZyA9IHtcbiAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHRvb2xiYXI6ICdleHBhbmRlZCdcbiAgICAgICAgfSxcbiAgICAgICAgdXJsczoge1xuICAgICAgICAgICAgc2V0dGluZ3M6ICQoJy5qcy1jbXMtcGFnZXRyZWUnKS5kYXRhKCdzZXR0aW5ncy11cmwnKVxuICAgICAgICB9XG4gICAgfTtcbiAgICB3aW5kb3cuQ01TLnNldHRpbmdzID0gSGVscGVycy5nZXRTZXR0aW5ncygpO1xuICAgIC8vIGF1dG9sb2FkIHRoZSBwYWdldHJlZVxuICAgIG5ldyBQYWdlVHJlZSgpO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFnZVRyZWU7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vY21zL3N0YXRpYy9jbXMvanMvbW9kdWxlcy9jbXMucGFnZXRyZWUuanNcbiAqKiBtb2R1bGUgaWQgPSA4XG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iLCIvKiFcbiAqIFRISVMgRklMRSBIQVMgQkVFTiBNQU5VQUxMWSBQQVRDSEVEIFRPIEFMTE9XIENPUFlJTkcgSU5UTyBTRUxGL0NISUxEUkVOXG4gKiBodHRwczovL2dpdGh1Yi5jb20vRmluYWxBbmdlbC9qc3RyZWVcbiAqL1xuLyohIGpzVHJlZSAtIHYzLjMuMCAtIDIwMTYtMDQtMjUgLSAoTUlUKSAqL1xuIWZ1bmN0aW9uKGEpe1widXNlIHN0cmljdFwiO1wiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wianF1ZXJ5XCJdLGEpOlwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPWEocmVxdWlyZShcImpxdWVyeVwiKSk6YShqUXVlcnkpfShmdW5jdGlvbihhLGIpe1widXNlIHN0cmljdFwiO2lmKCFhLmpzdHJlZSl7dmFyIGM9MCxkPSExLGU9ITEsZj0hMSxnPVtdLGg9YShcInNjcmlwdDpsYXN0XCIpLmF0dHIoXCJzcmNcIiksaT13aW5kb3cuZG9jdW1lbnQsaj1pLmNyZWF0ZUVsZW1lbnQoXCJMSVwiKSxrLGw7ai5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJ0cmVlaXRlbVwiKSxrPWkuY3JlYXRlRWxlbWVudChcIklcIiksay5jbGFzc05hbWU9XCJqc3RyZWUtaWNvbiBqc3RyZWUtb2NsXCIsay5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksai5hcHBlbmRDaGlsZChrKSxrPWkuY3JlYXRlRWxlbWVudChcIkFcIiksay5jbGFzc05hbWU9XCJqc3RyZWUtYW5jaG9yXCIsay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsXCIjXCIpLGsuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIixcIi0xXCIpLGw9aS5jcmVhdGVFbGVtZW50KFwiSVwiKSxsLmNsYXNzTmFtZT1cImpzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb25cIixsLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxrLmFwcGVuZENoaWxkKGwpLGouYXBwZW5kQ2hpbGQoayksaz1sPW51bGwsYS5qc3RyZWU9e3ZlcnNpb246XCJ7e1ZFUlNJT059fVwiLGRlZmF1bHRzOntwbHVnaW5zOltdfSxwbHVnaW5zOnt9LHBhdGg6aCYmLTEhPT1oLmluZGV4T2YoXCIvXCIpP2gucmVwbGFjZSgvXFwvW15cXC9dKyQvLFwiXCIpOlwiXCIsaWRyZWdleDovW1xcXFw6JiFefCgpXFxbXFxdPD5AKicrfiNcIjsuLD1cXC0gXFwvJHt9JT9gXS9nLHJvb3Q6XCIjXCJ9LGEuanN0cmVlLmNyZWF0ZT1mdW5jdGlvbihiLGQpe3ZhciBlPW5ldyBhLmpzdHJlZS5jb3JlKCsrYyksZj1kO3JldHVybiBkPWEuZXh0ZW5kKCEwLHt9LGEuanN0cmVlLmRlZmF1bHRzLGQpLGYmJmYucGx1Z2lucyYmKGQucGx1Z2lucz1mLnBsdWdpbnMpLGEuZWFjaChkLnBsdWdpbnMsZnVuY3Rpb24oYSxiKXtcImNvcmVcIiE9PWEmJihlPWUucGx1Z2luKGIsZFtiXSkpfSksYShiKS5kYXRhKFwianN0cmVlXCIsZSksZS5pbml0KGIsZCksZX0sYS5qc3RyZWUuZGVzdHJveT1mdW5jdGlvbigpe2EoXCIuanN0cmVlOmpzdHJlZVwiKS5qc3RyZWUoXCJkZXN0cm95XCIpLGEoaSkub2ZmKFwiLmpzdHJlZVwiKX0sYS5qc3RyZWUuY29yZT1mdW5jdGlvbihhKXt0aGlzLl9pZD1hLHRoaXMuX2NudD0wLHRoaXMuX3dyaz1udWxsLHRoaXMuX2RhdGE9e2NvcmU6e3RoZW1lczp7bmFtZTohMSxkb3RzOiExLGljb25zOiExfSxzZWxlY3RlZDpbXSxsYXN0X2Vycm9yOnt9LHdvcmtpbmc6ITEsd29ya2VyX3F1ZXVlOltdLGZvY3VzZWQ6bnVsbH19fSxhLmpzdHJlZS5yZWZlcmVuY2U9ZnVuY3Rpb24oYil7dmFyIGM9bnVsbCxkPW51bGw7aWYoIWJ8fCFiLmlkfHxiLnRhZ05hbWUmJmIubm9kZVR5cGV8fChiPWIuaWQpLCFkfHwhZC5sZW5ndGgpdHJ5e2Q9YShiKX1jYXRjaChlKXt9aWYoIWR8fCFkLmxlbmd0aCl0cnl7ZD1hKFwiI1wiK2IucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpKX1jYXRjaChlKXt9cmV0dXJuIGQmJmQubGVuZ3RoJiYoZD1kLmNsb3Nlc3QoXCIuanN0cmVlXCIpKS5sZW5ndGgmJihkPWQuZGF0YShcImpzdHJlZVwiKSk/Yz1kOmEoXCIuanN0cmVlXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLmRhdGEoXCJqc3RyZWVcIik7cmV0dXJuIGQmJmQuX21vZGVsLmRhdGFbYl0/KGM9ZCwhMSk6dm9pZCAwfSksY30sYS5mbi5qc3RyZWU9ZnVuY3Rpb24oYyl7dmFyIGQ9XCJzdHJpbmdcIj09dHlwZW9mIGMsZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksZj1udWxsO3JldHVybiBjIT09ITB8fHRoaXMubGVuZ3RoPyh0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZz1hLmpzdHJlZS5yZWZlcmVuY2UodGhpcyksaD1kJiZnP2dbY106bnVsbDtyZXR1cm4gZj1kJiZoP2guYXBwbHkoZyxlKTpudWxsLGd8fGR8fGMhPT1iJiYhYS5pc1BsYWluT2JqZWN0KGMpfHxhLmpzdHJlZS5jcmVhdGUodGhpcyxjKSwoZyYmIWR8fGM9PT0hMCkmJihmPWd8fCExKSxudWxsIT09ZiYmZiE9PWI/ITE6dm9pZCAwfSksbnVsbCE9PWYmJmYhPT1iP2Y6dGhpcyk6ITF9LGEuZXhwcltcIjpcIl0uanN0cmVlPWEuZXhwci5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24oYyl7cmV0dXJuIGZ1bmN0aW9uKGMpe3JldHVybiBhKGMpLmhhc0NsYXNzKFwianN0cmVlXCIpJiZhKGMpLmRhdGEoXCJqc3RyZWVcIikhPT1ifX0pLGEuanN0cmVlLmRlZmF1bHRzLmNvcmU9e2RhdGE6ITEsc3RyaW5nczohMSxjaGVja19jYWxsYmFjazohMSxlcnJvcjphLm5vb3AsYW5pbWF0aW9uOjIwMCxtdWx0aXBsZTohMCx0aGVtZXM6e25hbWU6ITEsdXJsOiExLGRpcjohMSxkb3RzOiEwLGljb25zOiEwLHN0cmlwZXM6ITEsdmFyaWFudDohMSxyZXNwb25zaXZlOiExfSxleHBhbmRfc2VsZWN0ZWRfb25sb2FkOiEwLHdvcmtlcjohMCxmb3JjZV90ZXh0OiExLGRibGNsaWNrX3RvZ2dsZTohMH0sYS5qc3RyZWUuY29yZS5wcm90b3R5cGU9e3BsdWdpbjpmdW5jdGlvbihiLGMpe3ZhciBkPWEuanN0cmVlLnBsdWdpbnNbYl07cmV0dXJuIGQ/KHRoaXMuX2RhdGFbYl09e30sZC5wcm90b3R5cGU9dGhpcyxuZXcgZChjLHRoaXMpKTp0aGlzfSxpbml0OmZ1bmN0aW9uKGIsYyl7dGhpcy5fbW9kZWw9e2RhdGE6e30sY2hhbmdlZDpbXSxmb3JjZV9mdWxsX3JlZHJhdzohMSxyZWRyYXdfdGltZW91dDohMSxkZWZhdWx0X3N0YXRlOntsb2FkZWQ6ITAsb3BlbmVkOiExLHNlbGVjdGVkOiExLGRpc2FibGVkOiExfX0sdGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XT17aWQ6YS5qc3RyZWUucm9vdCxwYXJlbnQ6bnVsbCxwYXJlbnRzOltdLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sc3RhdGU6e2xvYWRlZDohMX19LHRoaXMuZWxlbWVudD1hKGIpLmFkZENsYXNzKFwianN0cmVlIGpzdHJlZS1cIit0aGlzLl9pZCksdGhpcy5zZXR0aW5ncz1jLHRoaXMuX2RhdGEuY29yZS5yZWFkeT0hMSx0aGlzLl9kYXRhLmNvcmUubG9hZGVkPSExLHRoaXMuX2RhdGEuY29yZS5ydGw9XCJydGxcIj09PXRoaXMuZWxlbWVudC5jc3MoXCJkaXJlY3Rpb25cIiksdGhpcy5lbGVtZW50W3RoaXMuX2RhdGEuY29yZS5ydGw/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJqc3RyZWUtcnRsXCIpLHRoaXMuZWxlbWVudC5hdHRyKFwicm9sZVwiLFwidHJlZVwiKSx0aGlzLnNldHRpbmdzLmNvcmUubXVsdGlwbGUmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1tdWx0aXNlbGVjdGFibGVcIiwhMCksdGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiKXx8dGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiLFwiMFwiKSx0aGlzLmJpbmQoKSx0aGlzLnRyaWdnZXIoXCJpbml0XCIpLHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbD10aGlzLmVsZW1lbnQuZmluZChcIiA+IHVsID4gbGlcIikuY2xvbmUoITApLHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbC5maW5kKFwibGlcIikuYWRkQmFjaygpLmNvbnRlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDM9PT10aGlzLm5vZGVUeXBlJiYoIXRoaXMubm9kZVZhbHVlfHwvXlxccyskLy50ZXN0KHRoaXMubm9kZVZhbHVlKSl9KS5yZW1vdmUoKSx0aGlzLmVsZW1lbnQuaHRtbChcIjx1bCBjbGFzcz0nanN0cmVlLWNvbnRhaW5lci11bCBqc3RyZWUtY2hpbGRyZW4nIHJvbGU9J2dyb3VwJz48bGkgaWQ9J2pcIit0aGlzLl9pZCtcIl9sb2FkaW5nJyBjbGFzcz0nanN0cmVlLWluaXRpYWwtbm9kZSBqc3RyZWUtbG9hZGluZyBqc3RyZWUtbGVhZiBqc3RyZWUtbGFzdCcgcm9sZT0ndHJlZS1pdGVtJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLW9jbCc+PC9pPjxhIGNsYXNzPSdqc3RyZWUtYW5jaG9yJyBocmVmPScjJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLXRoZW1laWNvbi1oaWRkZW4nPjwvaT5cIit0aGlzLmdldF9zdHJpbmcoXCJMb2FkaW5nIC4uLlwiKStcIjwvYT48L2xpPjwvdWw+XCIpLHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsXCJqXCIrdGhpcy5faWQrXCJfbG9hZGluZ1wiKSx0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0PXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmNoaWxkcmVuKFwibGlcIikuZmlyc3QoKS5oZWlnaHQoKXx8MjQsdGhpcy50cmlnZ2VyKFwibG9hZGluZ1wiKSx0aGlzLmxvYWRfbm9kZShhLmpzdHJlZS5yb290KX0sZGVzdHJveTpmdW5jdGlvbihhKXtpZih0aGlzLl93cmspdHJ5e3dpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHRoaXMuX3dyayksdGhpcy5fd3JrPW51bGx9Y2F0Y2goYil7fWF8fHRoaXMuZWxlbWVudC5lbXB0eSgpLHRoaXMudGVhcmRvd24oKX0sdGVhcmRvd246ZnVuY3Rpb24oKXt0aGlzLnVuYmluZCgpLHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImpzdHJlZVwiKS5yZW1vdmVEYXRhKFwianN0cmVlXCIpLmZpbmQoXCJbY2xhc3NePSdqc3RyZWUnXVwiKS5hZGRCYWNrKCkuYXR0cihcImNsYXNzXCIsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jbGFzc05hbWUucmVwbGFjZSgvanN0cmVlW14gXSp8JC9naSxcIlwiKX0pLHRoaXMuZWxlbWVudD1udWxsfSxiaW5kOmZ1bmN0aW9uKCl7dmFyIGI9XCJcIixjPW51bGwsZD0wO3RoaXMuZWxlbWVudC5vbihcImRibGNsaWNrLmpzdHJlZVwiLGZ1bmN0aW9uKGEpe2lmKGEudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWEudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtpZihpLnNlbGVjdGlvbiYmaS5zZWxlY3Rpb24uZW1wdHkpaS5zZWxlY3Rpb24uZW1wdHkoKTtlbHNlIGlmKHdpbmRvdy5nZXRTZWxlY3Rpb24pe3ZhciBiPXdpbmRvdy5nZXRTZWxlY3Rpb24oKTt0cnl7Yi5yZW1vdmVBbGxSYW5nZXMoKSxiLmNvbGxhcHNlKCl9Y2F0Y2goYyl7fX19KS5vbihcIm1vdXNlZG93bi5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEpe2EudGFyZ2V0PT09dGhpcy5lbGVtZW50WzBdJiYoYS5wcmV2ZW50RGVmYXVsdCgpLGQ9K25ldyBEYXRlKX0sdGhpcykpLm9uKFwibW91c2Vkb3duLmpzdHJlZVwiLFwiLmpzdHJlZS1vY2xcIixmdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCl9KS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1vY2xcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMudG9nZ2xlX25vZGUoYS50YXJnZXQpfSx0aGlzKSkub24oXCJkYmxjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gYS50YXJnZXQudGFnTmFtZSYmXCJpbnB1dFwiPT09YS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpPyEwOnZvaWQodGhpcy5zZXR0aW5ncy5jb3JlLmRibGNsaWNrX3RvZ2dsZSYmdGhpcy50b2dnbGVfbm9kZShhLnRhcmdldCkpfSx0aGlzKSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXtiLnByZXZlbnREZWZhdWx0KCksYi5jdXJyZW50VGFyZ2V0IT09aS5hY3RpdmVFbGVtZW50JiZhKGIuY3VycmVudFRhcmdldCkuZm9jdXMoKSx0aGlzLmFjdGl2YXRlX25vZGUoYi5jdXJyZW50VGFyZ2V0LGIpfSx0aGlzKSkub24oXCJrZXlkb3duLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2lmKGIudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWIudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtpZigzMiE9PWIud2hpY2gmJjEzIT09Yi53aGljaCYmKGIuc2hpZnRLZXl8fGIuY3RybEtleXx8Yi5hbHRLZXl8fGIubWV0YUtleSkpcmV0dXJuITA7dmFyIGM9bnVsbDtzd2l0Y2godGhpcy5fZGF0YS5jb3JlLnJ0bCYmKDM3PT09Yi53aGljaD9iLndoaWNoPTM5OjM5PT09Yi53aGljaCYmKGIud2hpY2g9MzcpKSxiLndoaWNoKXtjYXNlIDMyOmIuY3RybEtleSYmKGIudHlwZT1cImNsaWNrXCIsYShiLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoYikpO2JyZWFrO2Nhc2UgMTM6Yi50eXBlPVwiY2xpY2tcIixhKGIuY3VycmVudFRhcmdldCkudHJpZ2dlcihiKTticmVhaztjYXNlIDM3OmIucHJldmVudERlZmF1bHQoKSx0aGlzLmlzX29wZW4oYi5jdXJyZW50VGFyZ2V0KT90aGlzLmNsb3NlX25vZGUoYi5jdXJyZW50VGFyZ2V0KTooYz10aGlzLmdldF9wYXJlbnQoYi5jdXJyZW50VGFyZ2V0KSxjJiZjLmlkIT09YS5qc3RyZWUucm9vdCYmdGhpcy5nZXRfbm9kZShjLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpO2JyZWFrO2Nhc2UgMzg6Yi5wcmV2ZW50RGVmYXVsdCgpLGM9dGhpcy5nZXRfcHJldl9kb20oYi5jdXJyZW50VGFyZ2V0KSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAzOTpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5pc19jbG9zZWQoYi5jdXJyZW50VGFyZ2V0KT90aGlzLm9wZW5fbm9kZShiLmN1cnJlbnRUYXJnZXQsZnVuY3Rpb24oYSl7dGhpcy5nZXRfbm9kZShhLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCl9KTp0aGlzLmlzX29wZW4oYi5jdXJyZW50VGFyZ2V0KSYmKGM9dGhpcy5nZXRfbm9kZShiLmN1cnJlbnRUYXJnZXQsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKVswXSxjJiZhKHRoaXMuX2ZpcnN0Q2hpbGQoYykpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSk7YnJlYWs7Y2FzZSA0MDpiLnByZXZlbnREZWZhdWx0KCksYz10aGlzLmdldF9uZXh0X2RvbShiLmN1cnJlbnRUYXJnZXQpLGMmJmMubGVuZ3RoJiZjLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTticmVhaztjYXNlIDEwNjp0aGlzLm9wZW5fYWxsKCk7YnJlYWs7Y2FzZSAzNjpiLnByZXZlbnREZWZhdWx0KCksYz10aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSxjJiZhKGMpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZmlsdGVyKFwiOnZpc2libGVcIikuZm9jdXMoKTticmVhaztjYXNlIDM1OmIucHJldmVudERlZmF1bHQoKSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmxhc3QoKS5mb2N1cygpO2JyZWFrO2Nhc2UgMTEzOmIucHJldmVudERlZmF1bHQoKSx0aGlzLmVkaXQoYi5jdXJyZW50VGFyZ2V0KX19LHRoaXMpKS5vbihcImxvYWRfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7Yy5zdGF0dXMmJihjLm5vZGUuaWQhPT1hLmpzdHJlZS5yb290fHx0aGlzLl9kYXRhLmNvcmUubG9hZGVkfHwodGhpcy5fZGF0YS5jb3JlLmxvYWRlZD0hMCx0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKS5pZCksdGhpcy50cmlnZ2VyKFwibG9hZGVkXCIpKSx0aGlzLl9kYXRhLmNvcmUucmVhZHl8fHNldFRpbWVvdXQoYS5wcm94eShmdW5jdGlvbigpe2lmKHRoaXMuZWxlbWVudCYmIXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmZpbmQoXCIuanN0cmVlLWxvYWRpbmdcIikubGVuZ3RoKXtpZih0aGlzLl9kYXRhLmNvcmUucmVhZHk9ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCl7aWYodGhpcy5zZXR0aW5ncy5jb3JlLmV4cGFuZF9zZWxlY3RlZF9vbmxvYWQpe3ZhciBiPVtdLGMsZDtmb3IoYz0wLGQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtkPmM7YysrKWI9Yi5jb25jYXQodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbY11dLnBhcmVudHMpO2ZvcihiPWEudmFrYXRhLmFycmF5X3VuaXF1ZShiKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMub3Blbl9ub2RlKGJbY10sITEsMCl9dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJyZWFkeVwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pfXRoaXMudHJpZ2dlcihcInJlYWR5XCIpfX0sdGhpcyksMCkpfSx0aGlzKSkub24oXCJrZXlwcmVzcy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGQpe2lmKGQudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWQudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSlyZXR1cm4hMDtjJiZjbGVhclRpbWVvdXQoYyksYz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yj1cIlwifSw1MDApO3ZhciBlPVN0cmluZy5mcm9tQ2hhckNvZGUoZC53aGljaCkudG9Mb3dlckNhc2UoKSxmPXRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1hbmNob3JcIikuZmlsdGVyKFwiOnZpc2libGVcIiksZz1mLmluZGV4KGkuYWN0aXZlRWxlbWVudCl8fDAsaD0hMTtpZihiKz1lLGIubGVuZ3RoPjEpe2lmKGYuc2xpY2UoZykuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGMsZCl7cmV0dXJuIDA9PT1hKGQpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoYik/KGEoZCkuZm9jdXMoKSxoPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxoKXJldHVybjtpZihmLnNsaWNlKDAsZykuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGMsZCl7cmV0dXJuIDA9PT1hKGQpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoYik/KGEoZCkuZm9jdXMoKSxoPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxoKXJldHVybn1pZihuZXcgUmVnRXhwKFwiXlwiK2UucmVwbGFjZSgvWy1cXC9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLFwiXFxcXCQmXCIpK1wiKyRcIikudGVzdChiKSl7aWYoZi5zbGljZShnKzEpLmVhY2goYS5wcm94eShmdW5jdGlvbihiLGMpe3JldHVybiBhKGMpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmNoYXJBdCgwKT09PWU/KGEoYykuZm9jdXMoKSxoPSEwLCExKTp2b2lkIDB9LHRoaXMpKSxoKXJldHVybjtpZihmLnNsaWNlKDAsZysxKS5lYWNoKGEucHJveHkoZnVuY3Rpb24oYixjKXtyZXR1cm4gYShjKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCk9PT1lPyhhKGMpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm59fSx0aGlzKSkub24oXCJpbml0LmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt2YXIgYT10aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzO3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz1hLmRvdHMsdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPWEuc3RyaXBlcyx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPWEuaWNvbnMsdGhpcy5zZXRfdGhlbWUoYS5uYW1lfHxcImRlZmF1bHRcIixhLnVybCksdGhpcy5zZXRfdGhlbWVfdmFyaWFudChhLnZhcmlhbnQpfSx0aGlzKSkub24oXCJsb2FkaW5nLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt0aGlzW3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz9cInNob3dfZG90c1wiOlwiaGlkZV9kb3RzXCJdKCksdGhpc1t0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zP1wic2hvd19pY29uc1wiOlwiaGlkZV9pY29uc1wiXSgpLHRoaXNbdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzP1wic2hvd19zdHJpcGVzXCI6XCJoaWRlX3N0cmlwZXNcIl0oKX0sdGhpcykpLm9uKFwiYmx1ci5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXt0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsLGEoYi5jdXJyZW50VGFyZ2V0KS5maWx0ZXIoXCIuanN0cmVlLWhvdmVyZWRcIikubW91c2VsZWF2ZSgpLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIjBcIil9LHRoaXMpKS5vbihcImZvY3VzLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X25vZGUoYi5jdXJyZW50VGFyZ2V0KTtjJiZjLmlkJiYodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9Yy5pZCksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWhvdmVyZWRcIikubm90KGIuY3VycmVudFRhcmdldCkubW91c2VsZWF2ZSgpLGEoYi5jdXJyZW50VGFyZ2V0KS5tb3VzZWVudGVyKCksdGhpcy5lbGVtZW50LmF0dHIoXCJ0YWJpbmRleFwiLFwiLTFcIil9LHRoaXMpKS5vbihcImZvY3VzLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXtpZigrbmV3IERhdGUtZD41MDAmJiF0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCl7ZD0wO3ZhciBhPXRoaXMuZ2V0X25vZGUodGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIiksITApO2EmJmEuZmluZChcIj4gLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKX19LHRoaXMpKS5vbihcIm1vdXNlZW50ZXIuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5ob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCl9LHRoaXMpKS5vbihcIm1vdXNlbGVhdmUuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5kZWhvdmVyX25vZGUoYS5jdXJyZW50VGFyZ2V0KX0sdGhpcykpfSx1bmJpbmQ6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub2ZmKFwiLmpzdHJlZVwiKSxhKGkpLm9mZihcIi5qc3RyZWUtXCIrdGhpcy5faWQpfSx0cmlnZ2VyOmZ1bmN0aW9uKGEsYil7Ynx8KGI9e30pLGIuaW5zdGFuY2U9dGhpcyx0aGlzLmVsZW1lbnQudHJpZ2dlckhhbmRsZXIoYS5yZXBsYWNlKFwiLmpzdHJlZVwiLFwiXCIpK1wiLmpzdHJlZVwiLGIpfSxnZXRfY29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudH0sZ2V0X2NvbnRhaW5lcl91bDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmZpcnN0KCl9LGdldF9zdHJpbmc6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5zZXR0aW5ncy5jb3JlLnN0cmluZ3M7cmV0dXJuIGEuaXNGdW5jdGlvbihjKT9jLmNhbGwodGhpcyxiKTpjJiZjW2JdP2NbYl06Yn0sX2ZpcnN0Q2hpbGQ6ZnVuY3Rpb24oYSl7YT1hP2EuZmlyc3RDaGlsZDpudWxsO3doaWxlKG51bGwhPT1hJiYxIT09YS5ub2RlVHlwZSlhPWEubmV4dFNpYmxpbmc7cmV0dXJuIGF9LF9uZXh0U2libGluZzpmdW5jdGlvbihhKXthPWE/YS5uZXh0U2libGluZzpudWxsO3doaWxlKG51bGwhPT1hJiYxIT09YS5ub2RlVHlwZSlhPWEubmV4dFNpYmxpbmc7cmV0dXJuIGF9LF9wcmV2aW91c1NpYmxpbmc6ZnVuY3Rpb24oYSl7YT1hP2EucHJldmlvdXNTaWJsaW5nOm51bGw7d2hpbGUobnVsbCE9PWEmJjEhPT1hLm5vZGVUeXBlKWE9YS5wcmV2aW91c1NpYmxpbmc7cmV0dXJuIGF9LGdldF9ub2RlOmZ1bmN0aW9uKGIsYyl7YiYmYi5pZCYmKGI9Yi5pZCk7dmFyIGQ7dHJ5e2lmKHRoaXMuX21vZGVsLmRhdGFbYl0pYj10aGlzLl9tb2RlbC5kYXRhW2JdO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJnRoaXMuX21vZGVsLmRhdGFbYi5yZXBsYWNlKC9eIy8sXCJcIildKWI9dGhpcy5fbW9kZWwuZGF0YVtiLnJlcGxhY2UoL14jLyxcIlwiKV07ZWxzZSBpZihcInN0cmluZ1wiPT10eXBlb2YgYiYmKGQ9YShcIiNcIitiLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpKS5sZW5ndGgmJnRoaXMuX21vZGVsLmRhdGFbZC5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV0pYj10aGlzLl9tb2RlbC5kYXRhW2QuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildO2Vsc2UgaWYoKGQ9YShiLHRoaXMuZWxlbWVudCkpLmxlbmd0aCYmdGhpcy5fbW9kZWwuZGF0YVtkLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuYXR0cihcImlkXCIpXSliPXRoaXMuX21vZGVsLmRhdGFbZC5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV07ZWxzZXtpZighKGQ9YShiLHRoaXMuZWxlbWVudCkpLmxlbmd0aHx8IWQuaGFzQ2xhc3MoXCJqc3RyZWVcIikpcmV0dXJuITE7Yj10aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdfXJldHVybiBjJiYoYj1iLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLmVsZW1lbnQ6YShcIiNcIitiLmlkLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpKSxifWNhdGNoKGUpe3JldHVybiExfX0sZ2V0X3BhdGg6ZnVuY3Rpb24oYixjLGQpe2lmKGI9Yi5wYXJlbnRzP2I6dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3R8fCFiLnBhcmVudHMpcmV0dXJuITE7dmFyIGUsZixnPVtdO2ZvcihnLnB1c2goZD9iLmlkOmIudGV4dCksZT0wLGY9Yi5wYXJlbnRzLmxlbmd0aDtmPmU7ZSsrKWcucHVzaChkP2IucGFyZW50c1tlXTp0aGlzLmdldF90ZXh0KGIucGFyZW50c1tlXSkpO3JldHVybiBnPWcucmV2ZXJzZSgpLnNsaWNlKDEpLGM/Zy5qb2luKGMpOmd9LGdldF9uZXh0X2RvbTpmdW5jdGlvbihiLGMpe3ZhciBkO2lmKGI9dGhpcy5nZXRfbm9kZShiLCEwKSxiWzBdPT09dGhpcy5lbGVtZW50WzBdKXtkPXRoaXMuX2ZpcnN0Q2hpbGQodGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0pO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodClkPXRoaXMuX25leHRTaWJsaW5nKGQpO3JldHVybiBkP2EoZCk6ITF9aWYoIWJ8fCFiLmxlbmd0aClyZXR1cm4hMTtpZihjKXtkPWJbMF07ZG8gZD10aGlzLl9uZXh0U2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO3JldHVybiBkP2EoZCk6ITF9aWYoYi5oYXNDbGFzcyhcImpzdHJlZS1vcGVuXCIpKXtkPXRoaXMuX2ZpcnN0Q2hpbGQoYi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodClkPXRoaXMuX25leHRTaWJsaW5nKGQpO2lmKG51bGwhPT1kKXJldHVybiBhKGQpfWQ9YlswXTtkbyBkPXRoaXMuX25leHRTaWJsaW5nKGQpO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodCk7cmV0dXJuIG51bGwhPT1kP2EoZCk6Yi5wYXJlbnRzVW50aWwoXCIuanN0cmVlXCIsXCIuanN0cmVlLW5vZGVcIikubmV4dEFsbChcIi5qc3RyZWUtbm9kZTp2aXNpYmxlXCIpLmZpcnN0KCl9LGdldF9wcmV2X2RvbTpmdW5jdGlvbihiLGMpe3ZhciBkO2lmKGI9dGhpcy5nZXRfbm9kZShiLCEwKSxiWzBdPT09dGhpcy5lbGVtZW50WzBdKXtkPXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdLmxhc3RDaGlsZDt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpZD10aGlzLl9wcmV2aW91c1NpYmxpbmcoZCk7cmV0dXJuIGQ/YShkKTohMX1pZighYnx8IWIubGVuZ3RoKXJldHVybiExO2lmKGMpe2Q9YlswXTtkbyBkPXRoaXMuX3ByZXZpb3VzU2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO3JldHVybiBkP2EoZCk6ITF9ZD1iWzBdO2RvIGQ9dGhpcy5fcHJldmlvdXNTaWJsaW5nKGQpO3doaWxlKGQmJjA9PT1kLm9mZnNldEhlaWdodCk7aWYobnVsbCE9PWQpe2I9YShkKTt3aGlsZShiLmhhc0NsYXNzKFwianN0cmVlLW9wZW5cIikpYj1iLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5maXJzdCgpLmNoaWxkcmVuKFwiLmpzdHJlZS1ub2RlOnZpc2libGU6bGFzdFwiKTtyZXR1cm4gYn1yZXR1cm4gZD1iWzBdLnBhcmVudE5vZGUucGFyZW50Tm9kZSxkJiZkLmNsYXNzTmFtZSYmLTEhPT1kLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLW5vZGVcIik/YShkKTohMX0sZ2V0X3BhcmVudDpmdW5jdGlvbihiKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2IucGFyZW50OiExfSxnZXRfY2hpbGRyZW5fZG9tOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSwhMCksYVswXT09PXRoaXMuZWxlbWVudFswXT90aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZVwiKTphJiZhLmxlbmd0aD9hLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZVwiKTohMX0saXNfcGFyZW50OmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmKGEuc3RhdGUubG9hZGVkPT09ITF8fGEuY2hpbGRyZW4ubGVuZ3RoPjApfSxpc19sb2FkZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZhLnN0YXRlLmxvYWRlZH0saXNfbG9hZGluZzpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmEuc3RhdGUmJmEuc3RhdGUubG9hZGluZ30saXNfb3BlbjpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmEuc3RhdGUub3BlbmVkfSxpc19jbG9zZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZ0aGlzLmlzX3BhcmVudChhKSYmIWEuc3RhdGUub3BlbmVkfSxpc19sZWFmOmZ1bmN0aW9uKGEpe3JldHVybiF0aGlzLmlzX3BhcmVudChhKX0sbG9hZF9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZSxmLGcsaDtpZihhLmlzQXJyYXkoYikpcmV0dXJuIHRoaXMuX2xvYWRfbm9kZXMoYi5zbGljZSgpLGMpLCEwO2lmKGI9dGhpcy5nZXRfbm9kZShiKSwhYilyZXR1cm4gYyYmYy5jYWxsKHRoaXMsYiwhMSksITE7aWYoYi5zdGF0ZS5sb2FkZWQpe2ZvcihiLnN0YXRlLmxvYWRlZD0hMSxmPTAsZz1iLnBhcmVudHMubGVuZ3RoO2c+ZjtmKyspdGhpcy5fbW9kZWwuZGF0YVtiLnBhcmVudHNbZl1dLmNoaWxkcmVuX2Q9YS52YWthdGEuYXJyYXlfZmlsdGVyKHRoaXMuX21vZGVsLmRhdGFbYi5wYXJlbnRzW2ZdXS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGMpe3JldHVybi0xPT09YS5pbkFycmF5KGMsYi5jaGlsZHJlbl9kKX0pO2ZvcihkPTAsZT1iLmNoaWxkcmVuX2QubGVuZ3RoO2U+ZDtkKyspdGhpcy5fbW9kZWwuZGF0YVtiLmNoaWxkcmVuX2RbZF1dLnN0YXRlLnNlbGVjdGVkJiYoaD0hMCksZGVsZXRlIHRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2RdXTtoJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X2ZpbHRlcih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oYyl7cmV0dXJuLTE9PT1hLmluQXJyYXkoYyxiLmNoaWxkcmVuX2QpfSkpLGIuY2hpbGRyZW49W10sYi5jaGlsZHJlbl9kPVtdLGgmJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwibG9hZF9ub2RlXCIsbm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pfXJldHVybiBiLnN0YXRlLmZhaWxlZD0hMSxiLnN0YXRlLmxvYWRpbmc9ITAsdGhpcy5nZXRfbm9kZShiLCEwKS5hZGRDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMCksdGhpcy5fbG9hZF9ub2RlKGIsYS5wcm94eShmdW5jdGlvbihhKXtiPXRoaXMuX21vZGVsLmRhdGFbYi5pZF0sYi5zdGF0ZS5sb2FkaW5nPSExLGIuc3RhdGUubG9hZGVkPWEsYi5zdGF0ZS5mYWlsZWQ9IWIuc3RhdGUubG9hZGVkO3ZhciBkPXRoaXMuZ2V0X25vZGUoYiwhMCksZT0wLGY9MCxnPXRoaXMuX21vZGVsLmRhdGEsaD0hMTtmb3IoZT0wLGY9Yi5jaGlsZHJlbi5sZW5ndGg7Zj5lO2UrKylpZihnW2IuY2hpbGRyZW5bZV1dJiYhZ1tiLmNoaWxkcmVuW2VdXS5zdGF0ZS5oaWRkZW4pe2g9ITA7YnJlYWt9Yi5zdGF0ZS5sb2FkZWQmJmQmJmQubGVuZ3RoJiYoZC5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbG9zZWQganN0cmVlLW9wZW4ganN0cmVlLWxlYWZcIiksaD9cIiNcIiE9PWIuaWQmJmQuYWRkQ2xhc3MoYi5zdGF0ZS5vcGVuZWQ/XCJqc3RyZWUtb3BlblwiOlwianN0cmVlLWNsb3NlZFwiKTpkLmFkZENsYXNzKFwianN0cmVlLWxlYWZcIikpLGQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITEpLHRoaXMudHJpZ2dlcihcImxvYWRfbm9kZVwiLHtub2RlOmIsc3RhdHVzOmF9KSxjJiZjLmNhbGwodGhpcyxiLGEpfSx0aGlzKSksITB9LF9sb2FkX25vZGVzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlPSEwLGY9ZnVuY3Rpb24oKXt0aGlzLl9sb2FkX25vZGVzKGEsYiwhMCl9LGc9dGhpcy5fbW9kZWwuZGF0YSxoLGksaj1bXTtmb3IoaD0wLGk9YS5sZW5ndGg7aT5oO2grKylnW2FbaF1dJiYoIWdbYVtoXV0uc3RhdGUubG9hZGVkJiYhZ1thW2hdXS5zdGF0ZS5mYWlsZWR8fCFjJiZkKSYmKHRoaXMuaXNfbG9hZGluZyhhW2hdKXx8dGhpcy5sb2FkX25vZGUoYVtoXSxmKSxlPSExKTtpZihlKXtmb3IoaD0wLGk9YS5sZW5ndGg7aT5oO2grKylnW2FbaF1dJiZnW2FbaF1dLnN0YXRlLmxvYWRlZCYmai5wdXNoKGFbaF0pO2ImJiFiLmRvbmUmJihiLmNhbGwodGhpcyxqKSxiLmRvbmU9ITApfX0sbG9hZF9hbGw6ZnVuY3Rpb24oYixjKXtpZihifHwoYj1hLmpzdHJlZS5yb290KSxiPXRoaXMuZ2V0X25vZGUoYiksIWIpcmV0dXJuITE7dmFyIGQ9W10sZT10aGlzLl9tb2RlbC5kYXRhLGY9ZVtiLmlkXS5jaGlsZHJlbl9kLGcsaDtmb3IoYi5zdGF0ZSYmIWIuc3RhdGUubG9hZGVkJiZkLnB1c2goYi5pZCksZz0wLGg9Zi5sZW5ndGg7aD5nO2crKyllW2ZbZ11dJiZlW2ZbZ11dLnN0YXRlJiYhZVtmW2ddXS5zdGF0ZS5sb2FkZWQmJmQucHVzaChmW2ddKTtkLmxlbmd0aD90aGlzLl9sb2FkX25vZGVzKGQsZnVuY3Rpb24oKXt0aGlzLmxvYWRfYWxsKGIsYyl9KTooYyYmYy5jYWxsKHRoaXMsYiksdGhpcy50cmlnZ2VyKFwibG9hZF9hbGxcIix7bm9kZTpifSkpfSxfbG9hZF9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5zZXR0aW5ncy5jb3JlLmRhdGEsZTtyZXR1cm4gZD9hLmlzRnVuY3Rpb24oZCk/ZC5jYWxsKHRoaXMsYixhLnByb3h5KGZ1bmN0aW9uKGQpe2Q9PT0hMT9jLmNhbGwodGhpcywhMSk6dGhpc1tcInN0cmluZ1wiPT10eXBlb2YgZD9cIl9hcHBlbmRfaHRtbF9kYXRhXCI6XCJfYXBwZW5kX2pzb25fZGF0YVwiXShiLFwic3RyaW5nXCI9PXR5cGVvZiBkP2EoYS5wYXJzZUhUTUwoZCkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pOmQsZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KX0sdGhpcykpOlwib2JqZWN0XCI9PXR5cGVvZiBkP2QudXJsPyhkPWEuZXh0ZW5kKCEwLHt9LGQpLGEuaXNGdW5jdGlvbihkLnVybCkmJihkLnVybD1kLnVybC5jYWxsKHRoaXMsYikpLGEuaXNGdW5jdGlvbihkLmRhdGEpJiYoZC5kYXRhPWQuZGF0YS5jYWxsKHRoaXMsYikpLGEuYWpheChkKS5kb25lKGEucHJveHkoZnVuY3Rpb24oZCxlLGYpe3ZhciBnPWYuZ2V0UmVzcG9uc2VIZWFkZXIoXCJDb250ZW50LVR5cGVcIik7cmV0dXJuIGcmJi0xIT09Zy5pbmRleE9mKFwianNvblwiKXx8XCJvYmplY3RcIj09dHlwZW9mIGQ/dGhpcy5fYXBwZW5kX2pzb25fZGF0YShiLGQsZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KTpnJiYtMSE9PWcuaW5kZXhPZihcImh0bWxcIil8fFwic3RyaW5nXCI9PXR5cGVvZiBkP3RoaXMuX2FwcGVuZF9odG1sX2RhdGEoYixhKGEucGFyc2VIVE1MKGQpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNFwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDpiLmlkLHhocjpmfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLGMuY2FsbCh0aGlzLCExKSl9LHRoaXMpKS5mYWlsKGEucHJveHkoZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsITEpLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImFqYXhcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA0XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOmIuaWQseGhyOmF9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcil9LHRoaXMpKSk6KGU9YS5pc0FycmF5KGQpfHxhLmlzUGxhaW5PYmplY3QoZCk/SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkKSk6ZCxiLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLl9hcHBlbmRfanNvbl9kYXRhKGIsZSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJub2RhdGFcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA1XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOmIuaWR9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksYy5jYWxsKHRoaXMsITEpKSk6XCJzdHJpbmdcIj09dHlwZW9mIGQ/Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2h0bWxfZGF0YShiLGEoYS5wYXJzZUhUTUwoZCkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pLGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLGEpfSk6KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcIm5vZGF0YVwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDZcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6Yi5pZH0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSxjLmNhbGwodGhpcywhMSkpOmMuY2FsbCh0aGlzLCExKTpiLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLl9hcHBlbmRfaHRtbF9kYXRhKGIsdGhpcy5fZGF0YS5jb3JlLm9yaWdpbmFsX2NvbnRhaW5lcl9odG1sLmNsb25lKCEwKSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOmMuY2FsbCh0aGlzLCExKX0sX25vZGVfY2hhbmdlZDpmdW5jdGlvbihhKXthPXRoaXMuZ2V0X25vZGUoYSksYSYmdGhpcy5fbW9kZWwuY2hhbmdlZC5wdXNoKGEuaWQpfSxfYXBwZW5kX2h0bWxfZGF0YTpmdW5jdGlvbihiLGMsZCl7Yj10aGlzLmdldF9ub2RlKGIpLGIuY2hpbGRyZW49W10sYi5jaGlsZHJlbl9kPVtdO3ZhciBlPWMuaXMoXCJ1bFwiKT9jLmNoaWxkcmVuKCk6YyxmPWIuaWQsZz1bXSxoPVtdLGk9dGhpcy5fbW9kZWwuZGF0YSxqPWlbZl0saz10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoLGwsbSxuO2ZvcihlLmVhY2goYS5wcm94eShmdW5jdGlvbihiLGMpe2w9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9odG1sKGEoYyksZixqLnBhcmVudHMuY29uY2F0KCkpLGwmJihnLnB1c2gobCksaC5wdXNoKGwpLGlbbF0uY2hpbGRyZW5fZC5sZW5ndGgmJihoPWguY29uY2F0KGlbbF0uY2hpbGRyZW5fZCkpKX0sdGhpcykpLGouY2hpbGRyZW49ZyxqLmNoaWxkcmVuX2Q9aCxtPTAsbj1qLnBhcmVudHMubGVuZ3RoO24+bTttKyspaVtqLnBhcmVudHNbbV1dLmNoaWxkcmVuX2Q9aVtqLnBhcmVudHNbbV1dLmNoaWxkcmVuX2QuY29uY2F0KGgpO3RoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmgscGFyZW50OmZ9KSxmIT09YS5qc3RyZWUucm9vdD8odGhpcy5fbm9kZV9jaGFuZ2VkKGYpLHRoaXMucmVkcmF3KCkpOih0aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcIi5qc3RyZWUtaW5pdGlhbC1ub2RlXCIpLnJlbW92ZSgpLHRoaXMucmVkcmF3KCEwKSksdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCE9PWsmJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwibW9kZWxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KSxkLmNhbGwodGhpcywhMCl9LF9hcHBlbmRfanNvbl9kYXRhOmZ1bmN0aW9uKGIsYyxkLGUpe2lmKG51bGwhPT10aGlzLmVsZW1lbnQpe2I9dGhpcy5nZXRfbm9kZShiKSxiLmNoaWxkcmVuPVtdLGIuY2hpbGRyZW5fZD1bXSxjLmQmJihjPWMuZCxcInN0cmluZ1wiPT10eXBlb2YgYyYmKGM9SlNPTi5wYXJzZShjKSkpLGEuaXNBcnJheShjKXx8KGM9W2NdKTt2YXIgZj1udWxsLGc9e2RmOnRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsZGF0OmMscGFyOmIuaWQsbTp0aGlzLl9tb2RlbC5kYXRhLHRfaWQ6dGhpcy5faWQsdF9jbnQ6dGhpcy5fY250LHNlbDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9LGg9ZnVuY3Rpb24oYSxiKXthLmRhdGEmJihhPWEuZGF0YSk7dmFyIGM9YS5kYXQsZD1hLnBhcixlPVtdLGY9W10sZz1bXSxoPWEuZGYsaT1hLnRfaWQsaj1hLnRfY250LGs9YS5tLGw9a1tkXSxtPWEuc2VsLG4sbyxwLHEscj1mdW5jdGlvbihhLGMsZCl7ZD1kP2QuY29uY2F0KCk6W10sYyYmZC51bnNoaWZ0KGMpO3ZhciBlPWEuaWQudG9TdHJpbmcoKSxmLGksaixsLG09e2lkOmUsdGV4dDphLnRleHR8fFwiXCIsaWNvbjphLmljb24hPT1iP2EuaWNvbjohMCxwYXJlbnQ6YyxwYXJlbnRzOmQsY2hpbGRyZW46YS5jaGlsZHJlbnx8W10sY2hpbGRyZW5fZDphLmNoaWxkcmVuX2R8fFtdLGRhdGE6YS5kYXRhLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoZiBpbiBoKWguaGFzT3duUHJvcGVydHkoZikmJihtLnN0YXRlW2ZdPWhbZl0pO2lmKGEmJmEuZGF0YSYmYS5kYXRhLmpzdHJlZSYmYS5kYXRhLmpzdHJlZS5pY29uJiYobS5pY29uPWEuZGF0YS5qc3RyZWUuaWNvbiksbS5pY29uIT09YiYmbnVsbCE9PW0uaWNvbiYmXCJcIiE9PW0uaWNvbnx8KG0uaWNvbj0hMCksYSYmYS5kYXRhJiYobS5kYXRhPWEuZGF0YSxhLmRhdGEuanN0cmVlKSlmb3IoZiBpbiBhLmRhdGEuanN0cmVlKWEuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkoZikmJihtLnN0YXRlW2ZdPWEuZGF0YS5qc3RyZWVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLnN0YXRlKWZvcihmIGluIGEuc3RhdGUpYS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShmKSYmKG0uc3RhdGVbZl09YS5zdGF0ZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEubGlfYXR0cilmb3IoZiBpbiBhLmxpX2F0dHIpYS5saV9hdHRyLmhhc093blByb3BlcnR5KGYpJiYobS5saV9hdHRyW2ZdPWEubGlfYXR0cltmXSk7aWYobS5saV9hdHRyLmlkfHwobS5saV9hdHRyLmlkPWUpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoZiBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKG0uYV9hdHRyW2ZdPWEuYV9hdHRyW2ZdKTtmb3IoYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbj09PSEwJiYobS5zdGF0ZS5sb2FkZWQ9ITEsbS5jaGlsZHJlbj1bXSxtLmNoaWxkcmVuX2Q9W10pLGtbbS5pZF09bSxmPTAsaT1tLmNoaWxkcmVuLmxlbmd0aDtpPmY7ZisrKWo9cihrW20uY2hpbGRyZW5bZl1dLG0uaWQsZCksbD1rW2pdLG0uY2hpbGRyZW5fZC5wdXNoKGopLGwuY2hpbGRyZW5fZC5sZW5ndGgmJihtLmNoaWxkcmVuX2Q9bS5jaGlsZHJlbl9kLmNvbmNhdChsLmNoaWxkcmVuX2QpKTtyZXR1cm4gZGVsZXRlIGEuZGF0YSxkZWxldGUgYS5jaGlsZHJlbixrW20uaWRdLm9yaWdpbmFsPWEsbS5zdGF0ZS5zZWxlY3RlZCYmZy5wdXNoKG0uaWQpLG0uaWR9LHM9ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT0hMSxmLGwsbSxuLG87ZG8gZT1cImpcIitpK1wiX1wiKyArK2o7d2hpbGUoa1tlXSk7bz17aWQ6ITEsdGV4dDpcInN0cmluZ1wiPT10eXBlb2YgYT9hOlwiXCIsaWNvbjpcIm9iamVjdFwiPT10eXBlb2YgYSYmYS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoZiBpbiBoKWguaGFzT3duUHJvcGVydHkoZikmJihvLnN0YXRlW2ZdPWhbZl0pO2lmKGEmJmEuaWQmJihvLmlkPWEuaWQudG9TdHJpbmcoKSksYSYmYS50ZXh0JiYoby50ZXh0PWEudGV4dCksYSYmYS5kYXRhJiZhLmRhdGEuanN0cmVlJiZhLmRhdGEuanN0cmVlLmljb24mJihvLmljb249YS5kYXRhLmpzdHJlZS5pY29uKSxvLmljb24hPT1iJiZudWxsIT09by5pY29uJiZcIlwiIT09by5pY29ufHwoby5pY29uPSEwKSxhJiZhLmRhdGEmJihvLmRhdGE9YS5kYXRhLGEuZGF0YS5qc3RyZWUpKWZvcihmIGluIGEuZGF0YS5qc3RyZWUpYS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShmKSYmKG8uc3RhdGVbZl09YS5kYXRhLmpzdHJlZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEuc3RhdGUpZm9yKGYgaW4gYS5zdGF0ZSlhLnN0YXRlLmhhc093blByb3BlcnR5KGYpJiYoby5zdGF0ZVtmXT1hLnN0YXRlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5saV9hdHRyKWZvcihmIGluIGEubGlfYXR0cilhLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihvLmxpX2F0dHJbZl09YS5saV9hdHRyW2ZdKTtpZihvLmxpX2F0dHIuaWQmJiFvLmlkJiYoby5pZD1vLmxpX2F0dHIuaWQudG9TdHJpbmcoKSksby5pZHx8KG8uaWQ9ZSksby5saV9hdHRyLmlkfHwoby5saV9hdHRyLmlkPW8uaWQpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoZiBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKG8uYV9hdHRyW2ZdPWEuYV9hdHRyW2ZdKTtpZihhJiZhLmNoaWxkcmVuJiZhLmNoaWxkcmVuLmxlbmd0aCl7Zm9yKGY9MCxsPWEuY2hpbGRyZW4ubGVuZ3RoO2w+ZjtmKyspbT1zKGEuY2hpbGRyZW5bZl0sby5pZCxkKSxuPWtbbV0sby5jaGlsZHJlbi5wdXNoKG0pLG4uY2hpbGRyZW5fZC5sZW5ndGgmJihvLmNoaWxkcmVuX2Q9by5jaGlsZHJlbl9kLmNvbmNhdChuLmNoaWxkcmVuX2QpKTtvLmNoaWxkcmVuX2Q9by5jaGlsZHJlbl9kLmNvbmNhdChvLmNoaWxkcmVuKX1yZXR1cm4gYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbj09PSEwJiYoby5zdGF0ZS5sb2FkZWQ9ITEsby5jaGlsZHJlbj1bXSxvLmNoaWxkcmVuX2Q9W10pLGRlbGV0ZSBhLmRhdGEsZGVsZXRlIGEuY2hpbGRyZW4sby5vcmlnaW5hbD1hLGtbby5pZF09byxvLnN0YXRlLnNlbGVjdGVkJiZnLnB1c2goby5pZCksby5pZH07aWYoYy5sZW5ndGgmJmNbMF0uaWQhPT1iJiZjWzBdLnBhcmVudCE9PWIpe2ZvcihvPTAscD1jLmxlbmd0aDtwPm87bysrKWNbb10uY2hpbGRyZW58fChjW29dLmNoaWxkcmVuPVtdKSxrW2Nbb10uaWQudG9TdHJpbmcoKV09Y1tvXTtmb3Iobz0wLHA9Yy5sZW5ndGg7cD5vO28rKylrW2Nbb10ucGFyZW50LnRvU3RyaW5nKCldLmNoaWxkcmVuLnB1c2goY1tvXS5pZC50b1N0cmluZygpKSxsLmNoaWxkcmVuX2QucHVzaChjW29dLmlkLnRvU3RyaW5nKCkpO2ZvcihvPTAscD1sLmNoaWxkcmVuLmxlbmd0aDtwPm87bysrKW49cihrW2wuY2hpbGRyZW5bb11dLGQsbC5wYXJlbnRzLmNvbmNhdCgpKSxmLnB1c2gobiksa1tuXS5jaGlsZHJlbl9kLmxlbmd0aCYmKGY9Zi5jb25jYXQoa1tuXS5jaGlsZHJlbl9kKSk7Zm9yKG89MCxwPWwucGFyZW50cy5sZW5ndGg7cD5vO28rKylrW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZD1rW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZC5jb25jYXQoZik7cT17Y250OmosbW9kOmssc2VsOm0scGFyOmQsZHBjOmYsYWRkOmd9fWVsc2V7Zm9yKG89MCxwPWMubGVuZ3RoO3A+bztvKyspbj1zKGNbb10sZCxsLnBhcmVudHMuY29uY2F0KCkpLG4mJihlLnB1c2gobiksZi5wdXNoKG4pLGtbbl0uY2hpbGRyZW5fZC5sZW5ndGgmJihmPWYuY29uY2F0KGtbbl0uY2hpbGRyZW5fZCkpKTtmb3IobC5jaGlsZHJlbj1lLGwuY2hpbGRyZW5fZD1mLG89MCxwPWwucGFyZW50cy5sZW5ndGg7cD5vO28rKylrW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZD1rW2wucGFyZW50c1tvXV0uY2hpbGRyZW5fZC5jb25jYXQoZik7cT17Y250OmosbW9kOmssc2VsOm0scGFyOmQsZHBjOmYsYWRkOmd9fXJldHVyblwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cuZG9jdW1lbnQ/cTp2b2lkIHBvc3RNZXNzYWdlKHEpfSxpPWZ1bmN0aW9uKGIsYyl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7dGhpcy5fY250PWIuY250O3ZhciBlLGY9dGhpcy5fbW9kZWwuZGF0YTtmb3IoZSBpbiBmKWYuaGFzT3duUHJvcGVydHkoZSkmJmZbZV0uc3RhdGUmJmZbZV0uc3RhdGUubG9hZGluZyYmYi5tb2RbZV0mJihiLm1vZFtlXS5zdGF0ZS5sb2FkaW5nPSEwKTtpZih0aGlzLl9tb2RlbC5kYXRhPWIubW9kLGMpe3ZhciBnLGg9Yi5hZGQsaT1iLnNlbCxqPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5zbGljZSgpO2lmKGY9dGhpcy5fbW9kZWwuZGF0YSxpLmxlbmd0aCE9PWoubGVuZ3RofHxhLnZha2F0YS5hcnJheV91bmlxdWUoaS5jb25jYXQoaikpLmxlbmd0aCE9PWkubGVuZ3RoKXtmb3IoZT0wLGc9aS5sZW5ndGg7Zz5lO2UrKyktMT09PWEuaW5BcnJheShpW2VdLGgpJiYtMT09PWEuaW5BcnJheShpW2VdLGopJiYoZltpW2VdXS5zdGF0ZS5zZWxlY3RlZD0hMSk7Zm9yKGU9MCxnPWoubGVuZ3RoO2c+ZTtlKyspLTE9PT1hLmluQXJyYXkoaltlXSxpKSYmKGZbaltlXV0uc3RhdGUuc2VsZWN0ZWQ9ITApfX1iLmFkZC5sZW5ndGgmJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChiLmFkZCkpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmIuZHBjLHBhcmVudDpiLnBhcn0pLGIucGFyIT09YS5qc3RyZWUucm9vdD8odGhpcy5fbm9kZV9jaGFuZ2VkKGIucGFyKSx0aGlzLnJlZHJhdygpKTp0aGlzLnJlZHJhdyghMCksYi5hZGQubGVuZ3RoJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcIm1vZGVsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksZC5jYWxsKHRoaXMsITApfX07aWYodGhpcy5zZXR0aW5ncy5jb3JlLndvcmtlciYmd2luZG93LkJsb2ImJndpbmRvdy5VUkwmJndpbmRvdy5Xb3JrZXIpdHJ5e251bGw9PT10aGlzLl93cmsmJih0aGlzLl93cms9d2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IHdpbmRvdy5CbG9iKFtcInNlbGYub25tZXNzYWdlID0gXCIraC50b1N0cmluZygpXSx7dHlwZTpcInRleHQvamF2YXNjcmlwdFwifSkpKSwhdGhpcy5fZGF0YS5jb3JlLndvcmtpbmd8fGU/KHRoaXMuX2RhdGEuY29yZS53b3JraW5nPSEwLGY9bmV3IHdpbmRvdy5Xb3JrZXIodGhpcy5fd3JrKSxmLm9ubWVzc2FnZT1hLnByb3h5KGZ1bmN0aW9uKGEpe2kuY2FsbCh0aGlzLGEuZGF0YSwhMCk7dHJ5e2YudGVybWluYXRlKCksZj1udWxsfWNhdGNoKGIpe310aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMX0sdGhpcyksZy5wYXI/Zi5wb3N0TWVzc2FnZShnKTp0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMSk6dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5wdXNoKFtiLGMsZCwhMF0pfWNhdGNoKGope2kuY2FsbCh0aGlzLGgoZyksITEpLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUubGVuZ3RoP3RoaXMuX2FwcGVuZF9qc29uX2RhdGEuYXBwbHkodGhpcyx0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLnNoaWZ0KCkpOnRoaXMuX2RhdGEuY29yZS53b3JraW5nPSExfWVsc2UgaS5jYWxsKHRoaXMsaChnKSwhMSl9fSxfcGFyc2VfbW9kZWxfZnJvbV9odG1sOmZ1bmN0aW9uKGMsZCxlKXtlPWU/W10uY29uY2F0KGUpOltdLGQmJmUudW5zaGlmdChkKTt2YXIgZixnLGg9dGhpcy5fbW9kZWwuZGF0YSxpPXtpZDohMSx0ZXh0OiExLGljb246ITAscGFyZW50OmQscGFyZW50czplLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfSxqLGssbDtmb3IoaiBpbiB0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlKXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUuaGFzT3duUHJvcGVydHkoaikmJihpLnN0YXRlW2pdPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGVbal0pO2lmKGs9YS52YWthdGEuYXR0cmlidXRlcyhjLCEwKSxhLmVhY2goayxmdW5jdGlvbihiLGMpe3JldHVybiBjPWEudHJpbShjKSxjLmxlbmd0aD8oaS5saV9hdHRyW2JdPWMsdm9pZChcImlkXCI9PT1iJiYoaS5pZD1jLnRvU3RyaW5nKCkpKSk6ITB9KSxrPWMuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCksay5sZW5ndGgmJihrPWEudmFrYXRhLmF0dHJpYnV0ZXMoaywhMCksYS5lYWNoKGssZnVuY3Rpb24oYixjKXtjPWEudHJpbShjKSxjLmxlbmd0aCYmKGkuYV9hdHRyW2JdPWMpfSkpLGs9Yy5jaGlsZHJlbihcImFcIikuZmlyc3QoKS5sZW5ndGg/Yy5jaGlsZHJlbihcImFcIikuZmlyc3QoKS5jbG9uZSgpOmMuY2xvbmUoKSxrLmNoaWxkcmVuKFwiaW5zLCBpLCB1bFwiKS5yZW1vdmUoKSxrPWsuaHRtbCgpLGs9YShcIjxkaXYgLz5cIikuaHRtbChrKSxpLnRleHQ9dGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQ/ay50ZXh0KCk6ay5odG1sKCksaz1jLmRhdGEoKSxpLmRhdGE9az9hLmV4dGVuZCghMCx7fSxrKTpudWxsLGkuc3RhdGUub3BlbmVkPWMuaGFzQ2xhc3MoXCJqc3RyZWUtb3BlblwiKSxpLnN0YXRlLnNlbGVjdGVkPWMuY2hpbGRyZW4oXCJhXCIpLmhhc0NsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksaS5zdGF0ZS5kaXNhYmxlZD1jLmNoaWxkcmVuKFwiYVwiKS5oYXNDbGFzcyhcImpzdHJlZS1kaXNhYmxlZFwiKSxpLmRhdGEmJmkuZGF0YS5qc3RyZWUpZm9yKGogaW4gaS5kYXRhLmpzdHJlZSlpLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGopJiYoaS5zdGF0ZVtqXT1pLmRhdGEuanN0cmVlW2pdKTtrPWMuY2hpbGRyZW4oXCJhXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIiksay5sZW5ndGgmJihpLmljb249ay5oYXNDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpPyExOmsuYXR0cihcInJlbFwiKSksaS5zdGF0ZS5pY29uIT09YiYmKGkuaWNvbj1pLnN0YXRlLmljb24pLGkuaWNvbiE9PWImJm51bGwhPT1pLmljb24mJlwiXCIhPT1pLmljb258fChpLmljb249ITApLGs9Yy5jaGlsZHJlbihcInVsXCIpLmNoaWxkcmVuKFwibGlcIik7ZG8gbD1cImpcIit0aGlzLl9pZCtcIl9cIisgKyt0aGlzLl9jbnQ7d2hpbGUoaFtsXSk7cmV0dXJuIGkuaWQ9aS5saV9hdHRyLmlkP2kubGlfYXR0ci5pZC50b1N0cmluZygpOmwsay5sZW5ndGg/KGsuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGIsYyl7Zj10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2h0bWwoYShjKSxpLmlkLGUpLGc9dGhpcy5fbW9kZWwuZGF0YVtmXSxpLmNoaWxkcmVuLnB1c2goZiksZy5jaGlsZHJlbl9kLmxlbmd0aCYmKGkuY2hpbGRyZW5fZD1pLmNoaWxkcmVuX2QuY29uY2F0KGcuY2hpbGRyZW5fZCkpfSx0aGlzKSksaS5jaGlsZHJlbl9kPWkuY2hpbGRyZW5fZC5jb25jYXQoaS5jaGlsZHJlbikpOmMuaGFzQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpJiYoaS5zdGF0ZS5sb2FkZWQ9ITEpLGkubGlfYXR0cltcImNsYXNzXCJdJiYoaS5saV9hdHRyW1wiY2xhc3NcIl09aS5saV9hdHRyW1wiY2xhc3NcIl0ucmVwbGFjZShcImpzdHJlZS1jbG9zZWRcIixcIlwiKS5yZXBsYWNlKFwianN0cmVlLW9wZW5cIixcIlwiKSksaS5hX2F0dHJbXCJjbGFzc1wiXSYmKGkuYV9hdHRyW1wiY2xhc3NcIl09aS5hX2F0dHJbXCJjbGFzc1wiXS5yZXBsYWNlKFwianN0cmVlLWNsaWNrZWRcIixcIlwiKS5yZXBsYWNlKFwianN0cmVlLWRpc2FibGVkXCIsXCJcIikpLGhbaS5pZF09aSxpLnN0YXRlLnNlbGVjdGVkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQucHVzaChpLmlkKSxpLmlkfSxfcGFyc2VfbW9kZWxfZnJvbV9mbGF0X2pzb246ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT1hLmlkLnRvU3RyaW5nKCksZj10aGlzLl9tb2RlbC5kYXRhLGc9dGhpcy5fbW9kZWwuZGVmYXVsdF9zdGF0ZSxoLGksaixrLGw9e2lkOmUsdGV4dDphLnRleHR8fFwiXCIsaWNvbjphLmljb24hPT1iP2EuaWNvbjohMCxwYXJlbnQ6YyxwYXJlbnRzOmQsY2hpbGRyZW46YS5jaGlsZHJlbnx8W10sY2hpbGRyZW5fZDphLmNoaWxkcmVuX2R8fFtdLGRhdGE6YS5kYXRhLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoaCBpbiBnKWcuaGFzT3duUHJvcGVydHkoaCkmJihsLnN0YXRlW2hdPWdbaF0pO2lmKGEmJmEuZGF0YSYmYS5kYXRhLmpzdHJlZSYmYS5kYXRhLmpzdHJlZS5pY29uJiYobC5pY29uPWEuZGF0YS5qc3RyZWUuaWNvbiksbC5pY29uIT09YiYmbnVsbCE9PWwuaWNvbiYmXCJcIiE9PWwuaWNvbnx8KGwuaWNvbj0hMCksYSYmYS5kYXRhJiYobC5kYXRhPWEuZGF0YSxhLmRhdGEuanN0cmVlKSlmb3IoaCBpbiBhLmRhdGEuanN0cmVlKWEuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkoaCkmJihsLnN0YXRlW2hdPWEuZGF0YS5qc3RyZWVbaF0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLnN0YXRlKWZvcihoIGluIGEuc3RhdGUpYS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShoKSYmKGwuc3RhdGVbaF09YS5zdGF0ZVtoXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEubGlfYXR0cilmb3IoaCBpbiBhLmxpX2F0dHIpYS5saV9hdHRyLmhhc093blByb3BlcnR5KGgpJiYobC5saV9hdHRyW2hdPWEubGlfYXR0cltoXSk7aWYobC5saV9hdHRyLmlkfHwobC5saV9hdHRyLmlkPWUpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoaCBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShoKSYmKGwuYV9hdHRyW2hdPWEuYV9hdHRyW2hdKTtmb3IoYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbj09PSEwJiYobC5zdGF0ZS5sb2FkZWQ9ITEsbC5jaGlsZHJlbj1bXSxsLmNoaWxkcmVuX2Q9W10pLGZbbC5pZF09bCxoPTAsaT1sLmNoaWxkcmVuLmxlbmd0aDtpPmg7aCsrKWo9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9mbGF0X2pzb24oZltsLmNoaWxkcmVuW2hdXSxsLmlkLGQpLGs9ZltqXSxsLmNoaWxkcmVuX2QucHVzaChqKSxrLmNoaWxkcmVuX2QubGVuZ3RoJiYobC5jaGlsZHJlbl9kPWwuY2hpbGRyZW5fZC5jb25jYXQoay5jaGlsZHJlbl9kKSk7cmV0dXJuIGRlbGV0ZSBhLmRhdGEsZGVsZXRlIGEuY2hpbGRyZW4sZltsLmlkXS5vcmlnaW5hbD1hLGwuc3RhdGUuc2VsZWN0ZWQmJnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGwuaWQpLGwuaWR9LF9wYXJzZV9tb2RlbF9mcm9tX2pzb246ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT0hMSxmLGcsaCxpLGo9dGhpcy5fbW9kZWwuZGF0YSxrPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsbDtkbyBlPVwialwiK3RoaXMuX2lkK1wiX1wiKyArK3RoaXMuX2NudDt3aGlsZShqW2VdKTtsPXtpZDohMSx0ZXh0Olwic3RyaW5nXCI9PXR5cGVvZiBhP2E6XCJcIixpY29uOlwib2JqZWN0XCI9PXR5cGVvZiBhJiZhLmljb24hPT1iP2EuaWNvbjohMCxwYXJlbnQ6YyxwYXJlbnRzOmQsY2hpbGRyZW46W10sY2hpbGRyZW5fZDpbXSxkYXRhOm51bGwsc3RhdGU6e30sbGlfYXR0cjp7aWQ6ITF9LGFfYXR0cjp7aHJlZjpcIiNcIn0sb3JpZ2luYWw6ITF9O2ZvcihmIGluIGspay5oYXNPd25Qcm9wZXJ0eShmKSYmKGwuc3RhdGVbZl09a1tmXSk7aWYoYSYmYS5pZCYmKGwuaWQ9YS5pZC50b1N0cmluZygpKSxhJiZhLnRleHQmJihsLnRleHQ9YS50ZXh0KSxhJiZhLmRhdGEmJmEuZGF0YS5qc3RyZWUmJmEuZGF0YS5qc3RyZWUuaWNvbiYmKGwuaWNvbj1hLmRhdGEuanN0cmVlLmljb24pLGwuaWNvbiE9PWImJm51bGwhPT1sLmljb24mJlwiXCIhPT1sLmljb258fChsLmljb249ITApLGEmJmEuZGF0YSYmKGwuZGF0YT1hLmRhdGEsYS5kYXRhLmpzdHJlZSkpZm9yKGYgaW4gYS5kYXRhLmpzdHJlZSlhLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGYpJiYobC5zdGF0ZVtmXT1hLmRhdGEuanN0cmVlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5zdGF0ZSlmb3IoZiBpbiBhLnN0YXRlKWEuc3RhdGUuaGFzT3duUHJvcGVydHkoZikmJihsLnN0YXRlW2ZdPWEuc3RhdGVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmxpX2F0dHIpZm9yKGYgaW4gYS5saV9hdHRyKWEubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKGwubGlfYXR0cltmXT1hLmxpX2F0dHJbZl0pO2lmKGwubGlfYXR0ci5pZCYmIWwuaWQmJihsLmlkPWwubGlfYXR0ci5pZC50b1N0cmluZygpKSxsLmlkfHwobC5pZD1lKSxsLmxpX2F0dHIuaWR8fChsLmxpX2F0dHIuaWQ9bC5pZCksYSYmXCJvYmplY3RcIj09dHlwZW9mIGEuYV9hdHRyKWZvcihmIGluIGEuYV9hdHRyKWEuYV9hdHRyLmhhc093blByb3BlcnR5KGYpJiYobC5hX2F0dHJbZl09YS5hX2F0dHJbZl0pO2lmKGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW4ubGVuZ3RoKXtmb3IoZj0wLGc9YS5jaGlsZHJlbi5sZW5ndGg7Zz5mO2YrKyloPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihhLmNoaWxkcmVuW2ZdLGwuaWQsZCksaT1qW2hdLGwuY2hpbGRyZW4ucHVzaChoKSxpLmNoaWxkcmVuX2QubGVuZ3RoJiYobC5jaGlsZHJlbl9kPWwuY2hpbGRyZW5fZC5jb25jYXQoaS5jaGlsZHJlbl9kKSk7bC5jaGlsZHJlbl9kPWwuY2hpbGRyZW5fZC5jb25jYXQobC5jaGlsZHJlbil9cmV0dXJuIGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKGwuc3RhdGUubG9hZGVkPSExLGwuY2hpbGRyZW49W10sbC5jaGlsZHJlbl9kPVtdKSxkZWxldGUgYS5kYXRhLGRlbGV0ZSBhLmNoaWxkcmVuLGwub3JpZ2luYWw9YSxqW2wuaWRdPWwsbC5zdGF0ZS5zZWxlY3RlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2gobC5pZCksbC5pZH0sX3JlZHJhdzpmdW5jdGlvbigpe3ZhciBiPXRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3P3RoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW4uY29uY2F0KFtdKTp0aGlzLl9tb2RlbC5jaGFuZ2VkLmNvbmNhdChbXSksYz1pLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSxkLGUsZixnPXRoaXMuX2RhdGEuY29yZS5mb2N1c2VkO2ZvcihlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKWQ9dGhpcy5yZWRyYXdfbm9kZShiW2VdLCEwLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3KSxkJiZ0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyYmYy5hcHBlbmRDaGlsZChkKTt0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyYmKGMuY2xhc3NOYW1lPXRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdLmNsYXNzTmFtZSxjLnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLHRoaXMuZWxlbWVudC5lbXB0eSgpLmFwcGVuZChjKSksbnVsbCE9PWcmJihkPXRoaXMuZ2V0X25vZGUoZywhMCksZCYmZC5sZW5ndGgmJmQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKVswXSE9PWkuYWN0aXZlRWxlbWVudD9kLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKTp0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsKSx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMSx0aGlzLl9tb2RlbC5jaGFuZ2VkPVtdLHRoaXMudHJpZ2dlcihcInJlZHJhd1wiLHtub2RlczpifSl9LHJlZHJhdzpmdW5jdGlvbihhKXthJiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX3JlZHJhdygpfSxkcmF3X2NoaWxkcmVuOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X25vZGUoYiksZD0hMSxlPSExLGY9ITEsZz1pO2lmKCFjKXJldHVybiExO2lmKGMuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiB0aGlzLnJlZHJhdyghMCk7aWYoYj10aGlzLmdldF9ub2RlKGIsITApLCFifHwhYi5sZW5ndGgpcmV0dXJuITE7aWYoYi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikucmVtb3ZlKCksYj1iWzBdLGMuY2hpbGRyZW4ubGVuZ3RoJiZjLnN0YXRlLmxvYWRlZCl7Zm9yKGY9Zy5jcmVhdGVFbGVtZW50KFwiVUxcIiksZi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSxmLmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGQ9MCxlPWMuY2hpbGRyZW4ubGVuZ3RoO2U+ZDtkKyspZi5hcHBlbmRDaGlsZCh0aGlzLnJlZHJhd19ub2RlKGMuY2hpbGRyZW5bZF0sITAsITApKTtiLmFwcGVuZENoaWxkKGYpfX0scmVkcmF3X25vZGU6ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGY9dGhpcy5nZXRfbm9kZShiKSxnPSExLGg9ITEsaz0hMSxsPSExLG09ITEsbj0hMSxvPVwiXCIscD1pLHE9dGhpcy5fbW9kZWwuZGF0YSxyPSExLHM9ITEsdD1udWxsLHU9MCx2PTAsdz0hMSx4PSExO2lmKCFmKXJldHVybiExO2lmKGYuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiB0aGlzLnJlZHJhdyghMCk7aWYoYz1jfHwwPT09Zi5jaGlsZHJlbi5sZW5ndGgsYj1pLnF1ZXJ5U2VsZWN0b3I/dGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoXCIjXCIrKC0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZihmLmlkWzBdKT9cIlxcXFwzXCIrZi5pZFswXStcIiBcIitmLmlkLnN1YnN0cigxKS5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6Zi5pZC5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIikpKTppLmdldEVsZW1lbnRCeUlkKGYuaWQpKWI9YShiKSxcbmR8fChnPWIucGFyZW50KCkucGFyZW50KClbMF0sZz09PXRoaXMuZWxlbWVudFswXSYmKGc9bnVsbCksaD1iLmluZGV4KCkpLGN8fCFmLmNoaWxkcmVuLmxlbmd0aHx8Yi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikubGVuZ3RofHwoYz0hMCksY3x8KGs9Yi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pLHI9Yi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpWzBdPT09aS5hY3RpdmVFbGVtZW50LGIucmVtb3ZlKCk7ZWxzZSBpZihjPSEwLCFkKXtpZihnPWYucGFyZW50IT09YS5qc3RyZWUucm9vdD9hKFwiI1wiK2YucGFyZW50LnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpWzBdOm51bGwsIShudWxsPT09Z3x8ZyYmcVtmLnBhcmVudF0uc3RhdGUub3BlbmVkKSlyZXR1cm4hMTtoPWEuaW5BcnJheShmLmlkLG51bGw9PT1nP3FbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW46cVtmLnBhcmVudF0uY2hpbGRyZW4pfWI9ai5jbG9uZU5vZGUoITApLG89XCJqc3RyZWUtbm9kZSBcIjtmb3IobCBpbiBmLmxpX2F0dHIpaWYoZi5saV9hdHRyLmhhc093blByb3BlcnR5KGwpKXtpZihcImlkXCI9PT1sKWNvbnRpbnVlO1wiY2xhc3NcIiE9PWw/Yi5zZXRBdHRyaWJ1dGUobCxmLmxpX2F0dHJbbF0pOm8rPWYubGlfYXR0cltsXX1mb3IoZi5hX2F0dHIuaWR8fChmLmFfYXR0ci5pZD1mLmlkK1wiX2FuY2hvclwiKSxiLnNldEF0dHJpYnV0ZShcImFyaWEtc2VsZWN0ZWRcIiwhIWYuc3RhdGUuc2VsZWN0ZWQpLGIuc2V0QXR0cmlidXRlKFwiYXJpYS1sZXZlbFwiLGYucGFyZW50cy5sZW5ndGgpLGIuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbGxlZGJ5XCIsZi5hX2F0dHIuaWQpLGYuc3RhdGUuZGlzYWJsZWQmJmIuc2V0QXR0cmlidXRlKFwiYXJpYS1kaXNhYmxlZFwiLCEwKSxsPTAsbT1mLmNoaWxkcmVuLmxlbmd0aDttPmw7bCsrKWlmKCFxW2YuY2hpbGRyZW5bbF1dLnN0YXRlLmhpZGRlbil7dz0hMDticmVha31pZihudWxsIT09Zi5wYXJlbnQmJnFbZi5wYXJlbnRdJiYhZi5zdGF0ZS5oaWRkZW4mJihsPWEuaW5BcnJheShmLmlkLHFbZi5wYXJlbnRdLmNoaWxkcmVuKSx4PWYuaWQsLTEhPT1sKSlmb3IobCsrLG09cVtmLnBhcmVudF0uY2hpbGRyZW4ubGVuZ3RoO20+bDtsKyspaWYocVtxW2YucGFyZW50XS5jaGlsZHJlbltsXV0uc3RhdGUuaGlkZGVufHwoeD1xW2YucGFyZW50XS5jaGlsZHJlbltsXSkseCE9PWYuaWQpYnJlYWs7Zi5zdGF0ZS5oaWRkZW4mJihvKz1cIiBqc3RyZWUtaGlkZGVuXCIpLGYuc3RhdGUubG9hZGVkJiYhdz9vKz1cIiBqc3RyZWUtbGVhZlwiOihvKz1mLnN0YXRlLm9wZW5lZCYmZi5zdGF0ZS5sb2FkZWQ/XCIganN0cmVlLW9wZW5cIjpcIiBqc3RyZWUtY2xvc2VkXCIsYi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWV4cGFuZGVkXCIsZi5zdGF0ZS5vcGVuZWQmJmYuc3RhdGUubG9hZGVkKSkseD09PWYuaWQmJihvKz1cIiBqc3RyZWUtbGFzdFwiKSxiLmlkPWYuaWQsYi5jbGFzc05hbWU9byxvPShmLnN0YXRlLnNlbGVjdGVkP1wiIGpzdHJlZS1jbGlja2VkXCI6XCJcIikrKGYuc3RhdGUuZGlzYWJsZWQ/XCIganN0cmVlLWRpc2FibGVkXCI6XCJcIik7Zm9yKG0gaW4gZi5hX2F0dHIpaWYoZi5hX2F0dHIuaGFzT3duUHJvcGVydHkobSkpe2lmKFwiaHJlZlwiPT09bSYmXCIjXCI9PT1mLmFfYXR0clttXSljb250aW51ZTtcImNsYXNzXCIhPT1tP2IuY2hpbGROb2Rlc1sxXS5zZXRBdHRyaWJ1dGUobSxmLmFfYXR0clttXSk6bys9XCIgXCIrZi5hX2F0dHJbbV19aWYoby5sZW5ndGgmJihiLmNoaWxkTm9kZXNbMV0uY2xhc3NOYW1lPVwianN0cmVlLWFuY2hvciBcIitvKSwoZi5pY29uJiZmLmljb24hPT0hMHx8Zi5pY29uPT09ITEpJiYoZi5pY29uPT09ITE/Yi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiOi0xPT09Zi5pY29uLmluZGV4T2YoXCIvXCIpJiYtMT09PWYuaWNvbi5pbmRleE9mKFwiLlwiKT9iLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIFwiK2YuaWNvbitcIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiOihiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2U9J3VybChcIicrZi5pY29uKydcIiknLGIuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbj1cImNlbnRlciBjZW50ZXJcIixiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kU2l6ZT1cImF1dG9cIixiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUrPVwiIGpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpKSx0aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dD9iLmNoaWxkTm9kZXNbMV0uYXBwZW5kQ2hpbGQocC5jcmVhdGVUZXh0Tm9kZShmLnRleHQpKTpiLmNoaWxkTm9kZXNbMV0uaW5uZXJIVE1MKz1mLnRleHQsYyYmZi5jaGlsZHJlbi5sZW5ndGgmJihmLnN0YXRlLm9wZW5lZHx8ZSkmJmYuc3RhdGUubG9hZGVkKXtmb3Iobj1wLmNyZWF0ZUVsZW1lbnQoXCJVTFwiKSxuLnNldEF0dHJpYnV0ZShcInJvbGVcIixcImdyb3VwXCIpLG4uY2xhc3NOYW1lPVwianN0cmVlLWNoaWxkcmVuXCIsbD0wLG09Zi5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKyluLmFwcGVuZENoaWxkKHRoaXMucmVkcmF3X25vZGUoZi5jaGlsZHJlbltsXSxjLCEwKSk7Yi5hcHBlbmRDaGlsZChuKX1pZihrJiZiLmFwcGVuZENoaWxkKGspLCFkKXtmb3IoZ3x8KGc9dGhpcy5lbGVtZW50WzBdKSxsPTAsbT1nLmNoaWxkTm9kZXMubGVuZ3RoO20+bDtsKyspaWYoZy5jaGlsZE5vZGVzW2xdJiZnLmNoaWxkTm9kZXNbbF0uY2xhc3NOYW1lJiYtMSE9PWcuY2hpbGROb2Rlc1tsXS5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1jaGlsZHJlblwiKSl7dD1nLmNoaWxkTm9kZXNbbF07YnJlYWt9dHx8KHQ9cC5jcmVhdGVFbGVtZW50KFwiVUxcIiksdC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSx0LmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGcuYXBwZW5kQ2hpbGQodCkpLGc9dCxoPGcuY2hpbGROb2Rlcy5sZW5ndGg/Zy5pbnNlcnRCZWZvcmUoYixnLmNoaWxkTm9kZXNbaF0pOmcuYXBwZW5kQ2hpbGQoYiksciYmKHU9dGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcCx2PXRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0LGIuY2hpbGROb2Rlc1sxXS5mb2N1cygpLHRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3A9dSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdD12KX1yZXR1cm4gZi5zdGF0ZS5vcGVuZWQmJiFmLnN0YXRlLmxvYWRlZCYmKGYuc3RhdGUub3BlbmVkPSExLHNldFRpbWVvdXQoYS5wcm94eShmdW5jdGlvbigpe3RoaXMub3Blbl9ub2RlKGYuaWQsITEsMCl9LHRoaXMpLDApKSxifSxvcGVuX25vZGU6ZnVuY3Rpb24oYyxkLGUpe3ZhciBmLGcsaCxpO2lmKGEuaXNBcnJheShjKSl7Zm9yKGM9Yy5zbGljZSgpLGY9MCxnPWMubGVuZ3RoO2c+ZjtmKyspdGhpcy5vcGVuX25vZGUoY1tmXSxkLGUpO3JldHVybiEwfXJldHVybiBjPXRoaXMuZ2V0X25vZGUoYyksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3Q/KGU9ZT09PWI/dGhpcy5zZXR0aW5ncy5jb3JlLmFuaW1hdGlvbjplLHRoaXMuaXNfY2xvc2VkKGMpP3RoaXMuaXNfbG9hZGVkKGMpPyhoPXRoaXMuZ2V0X25vZGUoYywhMCksaT10aGlzLGgubGVuZ3RoJiYoZSYmaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikubGVuZ3RoJiZoLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKSxjLmNoaWxkcmVuLmxlbmd0aCYmIXRoaXMuX2ZpcnN0Q2hpbGQoaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0pJiZ0aGlzLmRyYXdfY2hpbGRyZW4oYyksZT8odGhpcy50cmlnZ2VyKFwiYmVmb3JlX29wZW5cIix7bm9kZTpjfSksaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKS5lbmQoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikuYWRkQ2xhc3MoXCJqc3RyZWUtb3BlblwiKS5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuc3RvcCghMCwhMCkuc2xpZGVEb3duKGUsZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9XCJcIixpLnRyaWdnZXIoXCJhZnRlcl9vcGVuXCIse25vZGU6Y30pfSkpOih0aGlzLnRyaWdnZXIoXCJiZWZvcmVfb3BlblwiLHtub2RlOmN9KSxoWzBdLmNsYXNzTmFtZT1oWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwianN0cmVlLWNsb3NlZFwiLFwianN0cmVlLW9wZW5cIiksaFswXS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWV4cGFuZGVkXCIsITApKSksYy5zdGF0ZS5vcGVuZWQ9ITAsZCYmZC5jYWxsKHRoaXMsYywhMCksaC5sZW5ndGh8fHRoaXMudHJpZ2dlcihcImJlZm9yZV9vcGVuXCIse25vZGU6Y30pLHRoaXMudHJpZ2dlcihcIm9wZW5fbm9kZVwiLHtub2RlOmN9KSxlJiZoLmxlbmd0aHx8dGhpcy50cmlnZ2VyKFwiYWZ0ZXJfb3BlblwiLHtub2RlOmN9KSwhMCk6dGhpcy5pc19sb2FkaW5nKGMpP3NldFRpbWVvdXQoYS5wcm94eShmdW5jdGlvbigpe3RoaXMub3Blbl9ub2RlKGMsZCxlKX0sdGhpcyksNTAwKTp2b2lkIHRoaXMubG9hZF9ub2RlKGMsZnVuY3Rpb24oYSxiKXtyZXR1cm4gYj90aGlzLm9wZW5fbm9kZShhLGQsZSk6ZD9kLmNhbGwodGhpcyxhLCExKTohMX0pOihkJiZkLmNhbGwodGhpcyxjLCExKSwhMSkpOiExfSxfb3Blbl90bzpmdW5jdGlvbihiKXtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBjLGQsZT1iLnBhcmVudHM7Zm9yKGM9MCxkPWUubGVuZ3RoO2Q+YztjKz0xKWMhPT1hLmpzdHJlZS5yb290JiZ0aGlzLm9wZW5fbm9kZShlW2NdLCExLDApO3JldHVybiBhKFwiI1wiK2IuaWQucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpLHRoaXMuZWxlbWVudCl9LGNsb3NlX25vZGU6ZnVuY3Rpb24oYyxkKXt2YXIgZSxmLGcsaDtpZihhLmlzQXJyYXkoYykpe2ZvcihjPWMuc2xpY2UoKSxlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKXRoaXMuY2xvc2Vfbm9kZShjW2VdLGQpO3JldHVybiEwfXJldHVybiBjPXRoaXMuZ2V0X25vZGUoYyksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3Q/dGhpcy5pc19jbG9zZWQoYyk/ITE6KGQ9ZD09PWI/dGhpcy5zZXR0aW5ncy5jb3JlLmFuaW1hdGlvbjpkLGc9dGhpcyxoPXRoaXMuZ2V0X25vZGUoYywhMCksYy5zdGF0ZS5vcGVuZWQ9ITEsdGhpcy50cmlnZ2VyKFwiY2xvc2Vfbm9kZVwiLHtub2RlOmN9KSx2b2lkKGgubGVuZ3RoP2Q/aC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuYXR0cihcInN0eWxlXCIsXCJkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnRcIikuZW5kKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb3BlblwiKS5hZGRDbGFzcyhcImpzdHJlZS1jbG9zZWRcIikuYXR0cihcImFyaWEtZXhwYW5kZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnN0b3AoITAsITApLnNsaWRlVXAoZCxmdW5jdGlvbigpe3RoaXMuc3R5bGUuZGlzcGxheT1cIlwiLGguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnJlbW92ZSgpLGcudHJpZ2dlcihcImFmdGVyX2Nsb3NlXCIse25vZGU6Y30pfSk6KGhbMF0uY2xhc3NOYW1lPWhbMF0uY2xhc3NOYW1lLnJlcGxhY2UoXCJqc3RyZWUtb3BlblwiLFwianN0cmVlLWNsb3NlZFwiKSxoLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5yZW1vdmUoKSx0aGlzLnRyaWdnZXIoXCJhZnRlcl9jbG9zZVwiLHtub2RlOmN9KSk6dGhpcy50cmlnZ2VyKFwiYWZ0ZXJfY2xvc2VcIix7bm9kZTpjfSkpKTohMX0sdG9nZ2xlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMudG9nZ2xlX25vZGUoYltjXSk7cmV0dXJuITB9cmV0dXJuIHRoaXMuaXNfY2xvc2VkKGIpP3RoaXMub3Blbl9ub2RlKGIpOnRoaXMuaXNfb3BlbihiKT90aGlzLmNsb3NlX25vZGUoYik6dm9pZCAwfSxvcGVuX2FsbDpmdW5jdGlvbihiLGMsZCl7aWYoYnx8KGI9YS5qc3RyZWUucm9vdCksYj10aGlzLmdldF9ub2RlKGIpLCFiKXJldHVybiExO3ZhciBlPWIuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpOnRoaXMuZ2V0X25vZGUoYiwhMCksZixnLGg7aWYoIWUubGVuZ3RoKXtmb3IoZj0wLGc9Yi5jaGlsZHJlbl9kLmxlbmd0aDtnPmY7ZisrKXRoaXMuaXNfY2xvc2VkKHRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2ZdXSkmJih0aGlzLl9tb2RlbC5kYXRhW2IuY2hpbGRyZW5fZFtmXV0uc3RhdGUub3BlbmVkPSEwKTtyZXR1cm4gdGhpcy50cmlnZ2VyKFwib3Blbl9hbGxcIix7bm9kZTpifSl9ZD1kfHxlLGg9dGhpcyxlPXRoaXMuaXNfY2xvc2VkKGIpP2UuZmluZChcIi5qc3RyZWUtY2xvc2VkXCIpLmFkZEJhY2soKTplLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKSxlLmVhY2goZnVuY3Rpb24oKXtoLm9wZW5fbm9kZSh0aGlzLGZ1bmN0aW9uKGEsYil7YiYmdGhpcy5pc19wYXJlbnQoYSkmJnRoaXMub3Blbl9hbGwoYSxjLGQpfSxjfHwwKX0pLDA9PT1kLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5sZW5ndGgmJnRoaXMudHJpZ2dlcihcIm9wZW5fYWxsXCIse25vZGU6dGhpcy5nZXRfbm9kZShkKX0pfSxjbG9zZV9hbGw6ZnVuY3Rpb24oYixjKXtpZihifHwoYj1hLmpzdHJlZS5yb290KSxiPXRoaXMuZ2V0X25vZGUoYiksIWIpcmV0dXJuITE7dmFyIGQ9Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5nZXRfY29udGFpbmVyX3VsKCk6dGhpcy5nZXRfbm9kZShiLCEwKSxlPXRoaXMsZixnO2ZvcihkLmxlbmd0aCYmKGQ9dGhpcy5pc19vcGVuKGIpP2QuZmluZChcIi5qc3RyZWUtb3BlblwiKS5hZGRCYWNrKCk6ZC5maW5kKFwiLmpzdHJlZS1vcGVuXCIpLGEoZC5nZXQoKS5yZXZlcnNlKCkpLmVhY2goZnVuY3Rpb24oKXtlLmNsb3NlX25vZGUodGhpcyxjfHwwKX0pKSxmPTAsZz1iLmNoaWxkcmVuX2QubGVuZ3RoO2c+ZjtmKyspdGhpcy5fbW9kZWwuZGF0YVtiLmNoaWxkcmVuX2RbZl1dLnN0YXRlLm9wZW5lZD0hMTt0aGlzLnRyaWdnZXIoXCJjbG9zZV9hbGxcIix7bm9kZTpifSl9LGlzX2Rpc2FibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmYS5zdGF0ZSYmYS5zdGF0ZS5kaXNhYmxlZH0sZW5hYmxlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZW5hYmxlX25vZGUoYltjXSk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oYi5zdGF0ZS5kaXNhYmxlZD0hMSx0aGlzLmdldF9ub2RlKGIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIiwhMSksdm9pZCB0aGlzLnRyaWdnZXIoXCJlbmFibGVfbm9kZVwiLHtub2RlOmJ9KSk6ITF9LGRpc2FibGVfbm9kZTpmdW5jdGlvbihiKXt2YXIgYyxkO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspdGhpcy5kaXNhYmxlX25vZGUoYltjXSk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oYi5zdGF0ZS5kaXNhYmxlZD0hMCx0aGlzLmdldF9ub2RlKGIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIikuYXR0cihcImFyaWEtZGlzYWJsZWRcIiwhMCksdm9pZCB0aGlzLnRyaWdnZXIoXCJkaXNhYmxlX25vZGVcIix7bm9kZTpifSkpOiExfSxpc19oaWRkZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhLnN0YXRlLmhpZGRlbj09PSEwfSxoaWRlX25vZGU6ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy5oaWRlX25vZGUoYltkXSwhMCk7cmV0dXJuIGN8fHRoaXMucmVkcmF3KCksITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD92b2lkKGIuc3RhdGUuaGlkZGVufHwoYi5zdGF0ZS5oaWRkZW49ITAsdGhpcy5fbm9kZV9jaGFuZ2VkKGIucGFyZW50KSxjfHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcImhpZGVfbm9kZVwiLHtub2RlOmJ9KSkpOiExfSxzaG93X25vZGU6ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy5zaG93X25vZGUoYltkXSwhMCk7cmV0dXJuIGN8fHRoaXMucmVkcmF3KCksITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD92b2lkKGIuc3RhdGUuaGlkZGVuJiYoYi5zdGF0ZS5oaWRkZW49ITEsdGhpcy5fbm9kZV9jaGFuZ2VkKGIucGFyZW50KSxjfHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcInNob3dfbm9kZVwiLHtub2RlOmJ9KSkpOiExfSxoaWRlX2FsbDpmdW5jdGlvbihiKXt2YXIgYyxkPXRoaXMuX21vZGVsLmRhdGEsZT1bXTtmb3IoYyBpbiBkKWQuaGFzT3duUHJvcGVydHkoYykmJmMhPT1hLmpzdHJlZS5yb290JiYhZFtjXS5zdGF0ZS5oaWRkZW4mJihkW2NdLnN0YXRlLmhpZGRlbj0hMCxlLnB1c2goYykpO3JldHVybiB0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCxifHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcImhpZGVfYWxsXCIse25vZGVzOmV9KSxlfSxzaG93X2FsbDpmdW5jdGlvbihiKXt2YXIgYyxkPXRoaXMuX21vZGVsLmRhdGEsZT1bXTtmb3IoYyBpbiBkKWQuaGFzT3duUHJvcGVydHkoYykmJmMhPT1hLmpzdHJlZS5yb290JiZkW2NdLnN0YXRlLmhpZGRlbiYmKGRbY10uc3RhdGUuaGlkZGVuPSExLGUucHVzaChjKSk7cmV0dXJuIHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwLGJ8fHRoaXMucmVkcmF3KCksdGhpcy50cmlnZ2VyKFwic2hvd19hbGxcIix7bm9kZXM6ZX0pLGV9LGFjdGl2YXRlX25vZGU6ZnVuY3Rpb24oYSxjKXtpZih0aGlzLmlzX2Rpc2FibGVkKGEpKXJldHVybiExO2lmKGMmJlwib2JqZWN0XCI9PXR5cGVvZiBjfHwoYz17fSksdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkIT09Yj90aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuaWQpOm51bGwsdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmIXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQuc3RhdGUuc2VsZWN0ZWQmJih0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPW51bGwpLCF0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLmdldF9ub2RlKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoLTFdKSksdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiYoYy5tZXRhS2V5fHxjLmN0cmxLZXl8fGMuc2hpZnRLZXkpJiYoIWMuc2hpZnRLZXl8fHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQmJnRoaXMuZ2V0X3BhcmVudChhKSYmdGhpcy5nZXRfcGFyZW50KGEpPT09dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5wYXJlbnQpKWlmKGMuc2hpZnRLZXkpe3ZhciBkPXRoaXMuZ2V0X25vZGUoYSkuaWQsZT10aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkLGY9dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLnBhcmVudCkuY2hpbGRyZW4sZz0hMSxoLGk7Zm9yKGg9MCxpPWYubGVuZ3RoO2k+aDtoKz0xKWZbaF09PT1kJiYoZz0hZyksZltoXT09PWUmJihnPSFnKSx0aGlzLmlzX2Rpc2FibGVkKGZbaF0pfHwhZyYmZltoXSE9PWQmJmZbaF0hPT1lP3RoaXMuZGVzZWxlY3Rfbm9kZShmW2hdLCEwLGMpOnRoaXMuaXNfaGlkZGVuKGZbaF0pfHx0aGlzLnNlbGVjdF9ub2RlKGZbaF0sITAsITEsYyk7dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJzZWxlY3Rfbm9kZVwiLG5vZGU6dGhpcy5nZXRfbm9kZShhKSxzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6Y30pfWVsc2UgdGhpcy5pc19zZWxlY3RlZChhKT90aGlzLmRlc2VsZWN0X25vZGUoYSwhMSxjKTp0aGlzLnNlbGVjdF9ub2RlKGEsITEsITEsYyk7ZWxzZSF0aGlzLnNldHRpbmdzLmNvcmUubXVsdGlwbGUmJihjLm1ldGFLZXl8fGMuY3RybEtleXx8Yy5zaGlmdEtleSkmJnRoaXMuaXNfc2VsZWN0ZWQoYSk/dGhpcy5kZXNlbGVjdF9ub2RlKGEsITEsYyk6KHRoaXMuZGVzZWxlY3RfYWxsKCEwKSx0aGlzLnNlbGVjdF9ub2RlKGEsITEsITEsYyksdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD10aGlzLmdldF9ub2RlKGEpKTt0aGlzLnRyaWdnZXIoXCJhY3RpdmF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShhKSxldmVudDpjfSl9LGhvdmVyX25vZGU6ZnVuY3Rpb24oYSl7aWYoYT10aGlzLmdldF9ub2RlKGEsITApLCFhfHwhYS5sZW5ndGh8fGEuY2hpbGRyZW4oXCIuanN0cmVlLWhvdmVyZWRcIikubGVuZ3RoKXJldHVybiExO3ZhciBiPXRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLGM9dGhpcy5lbGVtZW50O2ImJmIubGVuZ3RoJiZ0aGlzLmRlaG92ZXJfbm9kZShiKSxhLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKSx0aGlzLnRyaWdnZXIoXCJob3Zlcl9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShhKX0pLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIixhWzBdLmlkKX0sMCl9LGRlaG92ZXJfbm9kZTpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEsITApLGEmJmEubGVuZ3RoJiZhLmNoaWxkcmVuKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLmxlbmd0aD8oYS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIiksdm9pZCB0aGlzLnRyaWdnZXIoXCJkZWhvdmVyX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGEpfSkpOiExfSxzZWxlY3Rfbm9kZTpmdW5jdGlvbihiLGMsZCxlKXt2YXIgZixnLGgsaTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxnPTAsaD1iLmxlbmd0aDtoPmc7ZysrKXRoaXMuc2VsZWN0X25vZGUoYltnXSxjLGQsZSk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZj10aGlzLmdldF9ub2RlKGIsITApLHZvaWQoYi5zdGF0ZS5zZWxlY3RlZHx8KGIuc3RhdGUuc2VsZWN0ZWQ9ITAsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2goYi5pZCksZHx8KGY9dGhpcy5fb3Blbl90byhiKSksZiYmZi5sZW5ndGgmJmYuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLHRoaXMudHJpZ2dlcihcInNlbGVjdF9ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6ZX0pLGN8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwic2VsZWN0X25vZGVcIixub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmV9KSkpKTohMX0sZGVzZWxlY3Rfbm9kZTpmdW5jdGlvbihiLGMsZCl7dmFyIGUsZixnO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGU9MCxmPWIubGVuZ3RoO2Y+ZTtlKyspdGhpcy5kZXNlbGVjdF9ub2RlKGJbZV0sYyxkKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhnPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLnNlbGVjdGVkJiYoYi5zdGF0ZS5zZWxlY3RlZD0hMSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGIuaWQpLGcubGVuZ3RoJiZnLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJkZXNlbGVjdF9ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6ZH0pLGN8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVzZWxlY3Rfbm9kZVwiLG5vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZXZlbnQ6ZH0pKSkpOiExfSxzZWxlY3RfYWxsOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoW10pLGQsZTtmb3IodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPXRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW5fZC5jb25jYXQoKSxkPTAsZT10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoO2U+ZDtkKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbZF1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbZF1dLnN0YXRlLnNlbGVjdGVkPSEwKTt0aGlzLnJlZHJhdyghMCksdGhpcy50cmlnZ2VyKFwic2VsZWN0X2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KSxifHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9hbGxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsb2xkX3NlbGVjdGlvbjpjfSl9LGRlc2VsZWN0X2FsbDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKSxjLGQ7Zm9yKGM9MCxkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7ZD5jO2MrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtjXV0mJih0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtjXV0uc3RhdGUuc2VsZWN0ZWQ9ITEpO3RoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1bXSx0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpLHRoaXMudHJpZ2dlcihcImRlc2VsZWN0X2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsbm9kZTpifSksYXx8dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJkZXNlbGVjdF9hbGxcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsb2xkX3NlbGVjdGlvbjpifSl9LGlzX3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi5zdGF0ZS5zZWxlY3RlZDohMX0sZ2V0X3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3JldHVybiBiP2EubWFwKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnNsaWNlKCl9LGdldF90b3Bfc2VsZWN0ZWQ6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5nZXRfc2VsZWN0ZWQoITApLGQ9e30sZSxmLGcsaDtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylkW2NbZV0uaWRdPWNbZV07Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZm9yKGc9MCxoPWNbZV0uY2hpbGRyZW5fZC5sZW5ndGg7aD5nO2crKylkW2NbZV0uY2hpbGRyZW5fZFtnXV0mJmRlbGV0ZSBkW2NbZV0uY2hpbGRyZW5fZFtnXV07Yz1bXTtmb3IoZSBpbiBkKWQuaGFzT3duUHJvcGVydHkoZSkmJmMucHVzaChlKTtyZXR1cm4gYj9hLm1hcChjLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoYSl9LHRoaXMpKTpjfSxnZXRfYm90dG9tX3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X3NlbGVjdGVkKCEwKSxkPVtdLGUsZjtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyljW2VdLmNoaWxkcmVuLmxlbmd0aHx8ZC5wdXNoKGNbZV0uaWQpO3JldHVybiBiP2EubWFwKGQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOmR9LGdldF9zdGF0ZTpmdW5jdGlvbigpe3ZhciBiPXtjb3JlOntvcGVuOltdLHNjcm9sbDp7bGVmdDp0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdCgpLHRvcDp0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKCl9LHNlbGVjdGVkOltdfX0sYztmb3IoYyBpbiB0aGlzLl9tb2RlbC5kYXRhKXRoaXMuX21vZGVsLmRhdGEuaGFzT3duUHJvcGVydHkoYykmJmMhPT1hLmpzdHJlZS5yb290JiYodGhpcy5fbW9kZWwuZGF0YVtjXS5zdGF0ZS5vcGVuZWQmJmIuY29yZS5vcGVuLnB1c2goYyksdGhpcy5fbW9kZWwuZGF0YVtjXS5zdGF0ZS5zZWxlY3RlZCYmYi5jb3JlLnNlbGVjdGVkLnB1c2goYykpO3JldHVybiBifSxzZXRfc3RhdGU6ZnVuY3Rpb24oYyxkKXtpZihjKXtpZihjLmNvcmUpe3ZhciBlLGYsZyxoLGk7aWYoYy5jb3JlLm9wZW4pcmV0dXJuIGEuaXNBcnJheShjLmNvcmUub3BlbikmJmMuY29yZS5vcGVuLmxlbmd0aD90aGlzLl9sb2FkX25vZGVzKGMuY29yZS5vcGVuLGZ1bmN0aW9uKGEpe3RoaXMub3Blbl9ub2RlKGEsITEsMCksZGVsZXRlIGMuY29yZS5vcGVuLHRoaXMuc2V0X3N0YXRlKGMsZCl9LCEwKTooZGVsZXRlIGMuY29yZS5vcGVuLHRoaXMuc2V0X3N0YXRlKGMsZCkpLCExO2lmKGMuY29yZS5zY3JvbGwpcmV0dXJuIGMuY29yZS5zY3JvbGwmJmMuY29yZS5zY3JvbGwubGVmdCE9PWImJnRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0KGMuY29yZS5zY3JvbGwubGVmdCksYy5jb3JlLnNjcm9sbCYmYy5jb3JlLnNjcm9sbC50b3AhPT1iJiZ0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKGMuY29yZS5zY3JvbGwudG9wKSxkZWxldGUgYy5jb3JlLnNjcm9sbCx0aGlzLnNldF9zdGF0ZShjLGQpLCExO2lmKGMuY29yZS5zZWxlY3RlZClyZXR1cm4gaD10aGlzLHRoaXMuZGVzZWxlY3RfYWxsKCksYS5lYWNoKGMuY29yZS5zZWxlY3RlZCxmdW5jdGlvbihhLGIpe2guc2VsZWN0X25vZGUoYiwhMSwhMCl9KSxkZWxldGUgYy5jb3JlLnNlbGVjdGVkLHRoaXMuc2V0X3N0YXRlKGMsZCksITE7Zm9yKGkgaW4gYyljLmhhc093blByb3BlcnR5KGkpJiZcImNvcmVcIiE9PWkmJi0xPT09YS5pbkFycmF5KGksdGhpcy5zZXR0aW5ncy5wbHVnaW5zKSYmZGVsZXRlIGNbaV07aWYoYS5pc0VtcHR5T2JqZWN0KGMuY29yZSkpcmV0dXJuIGRlbGV0ZSBjLmNvcmUsdGhpcy5zZXRfc3RhdGUoYyxkKSwhMX1yZXR1cm4gYS5pc0VtcHR5T2JqZWN0KGMpPyhjPW51bGwsZCYmZC5jYWxsKHRoaXMpLHRoaXMudHJpZ2dlcihcInNldF9zdGF0ZVwiKSwhMSk6ITB9cmV0dXJuITF9LHJlZnJlc2g6ZnVuY3Rpb24oYixjKXt0aGlzLl9kYXRhLmNvcmUuc3RhdGU9Yz09PSEwP3t9OnRoaXMuZ2V0X3N0YXRlKCksYyYmYS5pc0Z1bmN0aW9uKGMpJiYodGhpcy5fZGF0YS5jb3JlLnN0YXRlPWMuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5zdGF0ZSkpLHRoaXMuX2NudD0wLHRoaXMuX21vZGVsLmRhdGE9e30sdGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XT17aWQ6YS5qc3RyZWUucm9vdCxwYXJlbnQ6bnVsbCxwYXJlbnRzOltdLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sc3RhdGU6e2xvYWRlZDohMX19LHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1bXSx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkPW51bGwsdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbDt2YXIgZD10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWU7Ynx8KHRoaXMuZWxlbWVudC5odG1sKFwiPHVsIGNsYXNzPSdcIitkK1wiJyByb2xlPSdncm91cCc+PGxpIGNsYXNzPSdqc3RyZWUtaW5pdGlhbC1ub2RlIGpzdHJlZS1sb2FkaW5nIGpzdHJlZS1sZWFmIGpzdHJlZS1sYXN0JyByb2xlPSd0cmVlaXRlbScgaWQ9J2pcIit0aGlzLl9pZCtcIl9sb2FkaW5nJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLW9jbCc+PC9pPjxhIGNsYXNzPSdqc3RyZWUtYW5jaG9yJyBocmVmPScjJz48aSBjbGFzcz0nanN0cmVlLWljb24ganN0cmVlLXRoZW1laWNvbi1oaWRkZW4nPjwvaT5cIit0aGlzLmdldF9zdHJpbmcoXCJMb2FkaW5nIC4uLlwiKStcIjwvYT48L2xpPjwvdWw+XCIpLHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsXCJqXCIrdGhpcy5faWQrXCJfbG9hZGluZ1wiKSksdGhpcy5sb2FkX25vZGUoYS5qc3RyZWUucm9vdCxmdW5jdGlvbihiLGMpe2MmJih0aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWU9ZCx0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKSYmdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIix0aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKS5pZCksdGhpcy5zZXRfc3RhdGUoYS5leHRlbmQoITAse30sdGhpcy5fZGF0YS5jb3JlLnN0YXRlKSxmdW5jdGlvbigpe3RoaXMudHJpZ2dlcihcInJlZnJlc2hcIil9KSksdGhpcy5fZGF0YS5jb3JlLnN0YXRlPW51bGx9KX0scmVmcmVzaF9ub2RlOmZ1bmN0aW9uKGIpe2lmKGI9dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGM9W10sZD1bXSxlPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoW10pO2QucHVzaChiLmlkKSxiLnN0YXRlLm9wZW5lZD09PSEwJiZjLnB1c2goYi5pZCksdGhpcy5nZXRfbm9kZShiLCEwKS5maW5kKFwiLmpzdHJlZS1vcGVuXCIpLmVhY2goZnVuY3Rpb24oKXtkLnB1c2godGhpcy5pZCksYy5wdXNoKHRoaXMuaWQpfSksdGhpcy5fbG9hZF9ub2RlcyhkLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5vcGVuX25vZGUoYywhMSwwKSx0aGlzLnNlbGVjdF9ub2RlKGUpLHRoaXMudHJpZ2dlcihcInJlZnJlc2hfbm9kZVwiLHtub2RlOmIsbm9kZXM6YX0pfSx0aGlzKSwhMSwhMCl9LHNldF9pZDpmdW5jdGlvbihiLGMpe2lmKGI9dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGQsZSxmPXRoaXMuX21vZGVsLmRhdGEsZz1iLmlkO2ZvcihjPWMudG9TdHJpbmcoKSxmW2IucGFyZW50XS5jaGlsZHJlblthLmluQXJyYXkoYi5pZCxmW2IucGFyZW50XS5jaGlsZHJlbildPWMsZD0wLGU9Yi5wYXJlbnRzLmxlbmd0aDtlPmQ7ZCsrKWZbYi5wYXJlbnRzW2RdXS5jaGlsZHJlbl9kW2EuaW5BcnJheShiLmlkLGZbYi5wYXJlbnRzW2RdXS5jaGlsZHJlbl9kKV09Yztmb3IoZD0wLGU9Yi5jaGlsZHJlbi5sZW5ndGg7ZT5kO2QrKylmW2IuY2hpbGRyZW5bZF1dLnBhcmVudD1jO2ZvcihkPTAsZT1iLmNoaWxkcmVuX2QubGVuZ3RoO2U+ZDtkKyspZltiLmNoaWxkcmVuX2RbZF1dLnBhcmVudHNbYS5pbkFycmF5KGIuaWQsZltiLmNoaWxkcmVuX2RbZF1dLnBhcmVudHMpXT1jO3JldHVybiBkPWEuaW5BcnJheShiLmlkLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCksLTEhPT1kJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2RdPWMpLGQ9dGhpcy5nZXRfbm9kZShiLmlkLCEwKSxkJiYoZC5hdHRyKFwiaWRcIixjKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiKT09PWIuaWQmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsYykpLGRlbGV0ZSBmW2IuaWRdLGIuaWQ9YyxiLmxpX2F0dHIuaWQ9YyxmW2NdPWIsdGhpcy50cmlnZ2VyKFwic2V0X2lkXCIse25vZGU6YixcIm5ld1wiOmIuaWQsb2xkOmd9KSwhMH0sZ2V0X3RleHQ6ZnVuY3Rpb24oYil7cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD9iLnRleHQ6ITF9LHNldF90ZXh0OmZ1bmN0aW9uKGIsYyl7dmFyIGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuc2V0X3RleHQoYltkXSxjKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhiLnRleHQ9Yyx0aGlzLmdldF9ub2RlKGIsITApLmxlbmd0aCYmdGhpcy5yZWRyYXdfbm9kZShiLmlkKSx0aGlzLnRyaWdnZXIoXCJzZXRfdGV4dFwiLHtvYmo6Yix0ZXh0OmN9KSwhMCk6ITF9LGdldF9qc29uOmZ1bmN0aW9uKGIsYyxkKXtpZihiPXRoaXMuZ2V0X25vZGUoYnx8YS5qc3RyZWUucm9vdCksIWIpcmV0dXJuITE7YyYmYy5mbGF0JiYhZCYmKGQ9W10pO3ZhciBlPXtpZDpiLmlkLHRleHQ6Yi50ZXh0LGljb246dGhpcy5nZXRfaWNvbihiKSxsaV9hdHRyOmEuZXh0ZW5kKCEwLHt9LGIubGlfYXR0ciksYV9hdHRyOmEuZXh0ZW5kKCEwLHt9LGIuYV9hdHRyKSxzdGF0ZTp7fSxkYXRhOmMmJmMubm9fZGF0YT8hMTphLmV4dGVuZCghMCx7fSxiLmRhdGEpfSxmLGc7aWYoYyYmYy5mbGF0P2UucGFyZW50PWIucGFyZW50OmUuY2hpbGRyZW49W10sIWN8fCFjLm5vX3N0YXRlKWZvcihmIGluIGIuc3RhdGUpYi5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShmKSYmKGUuc3RhdGVbZl09Yi5zdGF0ZVtmXSk7aWYoYyYmYy5ub19pZCYmKGRlbGV0ZSBlLmlkLGUubGlfYXR0ciYmZS5saV9hdHRyLmlkJiZkZWxldGUgZS5saV9hdHRyLmlkLGUuYV9hdHRyJiZlLmFfYXR0ci5pZCYmZGVsZXRlIGUuYV9hdHRyLmlkKSxjJiZjLmZsYXQmJmIuaWQhPT1hLmpzdHJlZS5yb290JiZkLnB1c2goZSksIWN8fCFjLm5vX2NoaWxkcmVuKWZvcihmPTAsZz1iLmNoaWxkcmVuLmxlbmd0aDtnPmY7ZisrKWMmJmMuZmxhdD90aGlzLmdldF9qc29uKGIuY2hpbGRyZW5bZl0sYyxkKTplLmNoaWxkcmVuLnB1c2godGhpcy5nZXRfanNvbihiLmNoaWxkcmVuW2ZdLGMpKTtyZXR1cm4gYyYmYy5mbGF0P2Q6Yi5pZD09PWEuanN0cmVlLnJvb3Q/ZS5jaGlsZHJlbjplfSxjcmVhdGVfbm9kZTpmdW5jdGlvbihjLGQsZSxmLGcpe2lmKG51bGw9PT1jJiYoYz1hLmpzdHJlZS5yb290KSxjPXRoaXMuZ2V0X25vZGUoYyksIWMpcmV0dXJuITE7aWYoZT1lPT09Yj9cImxhc3RcIjplLCFlLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmIWcmJiF0aGlzLmlzX2xvYWRlZChjKSlyZXR1cm4gdGhpcy5sb2FkX25vZGUoYyxmdW5jdGlvbigpe3RoaXMuY3JlYXRlX25vZGUoYyxkLGUsZiwhMCl9KTtkfHwoZD17dGV4dDp0aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKX0pLFwic3RyaW5nXCI9PXR5cGVvZiBkJiYoZD17dGV4dDpkfSksZC50ZXh0PT09YiYmKGQudGV4dD10aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKSk7dmFyIGgsaSxqLGs7c3dpdGNoKGMuaWQ9PT1hLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PWUmJihlPVwiZmlyc3RcIiksXCJhZnRlclwiPT09ZSYmKGU9XCJsYXN0XCIpKSxlKXtjYXNlXCJiZWZvcmVcIjpoPXRoaXMuZ2V0X25vZGUoYy5wYXJlbnQpLGU9YS5pbkFycmF5KGMuaWQsaC5jaGlsZHJlbiksYz1oO2JyZWFrO2Nhc2VcImFmdGVyXCI6aD10aGlzLmdldF9ub2RlKGMucGFyZW50KSxlPWEuaW5BcnJheShjLmlkLGguY2hpbGRyZW4pKzEsYz1oO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6ZT0wO2JyZWFrO2Nhc2VcImxhc3RcIjplPWMuY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6ZXx8KGU9MCl9aWYoZT5jLmNoaWxkcmVuLmxlbmd0aCYmKGU9Yy5jaGlsZHJlbi5sZW5ndGgpLGQuaWR8fChkLmlkPSEwKSwhdGhpcy5jaGVjayhcImNyZWF0ZV9ub2RlXCIsZCxjLGUpKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtpZihkLmlkPT09ITAmJmRlbGV0ZSBkLmlkLGQ9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9qc29uKGQsYy5pZCxjLnBhcmVudHMuY29uY2F0KCkpLCFkKXJldHVybiExO2ZvcihoPXRoaXMuZ2V0X25vZGUoZCksaT1bXSxpLnB1c2goZCksaT1pLmNvbmNhdChoLmNoaWxkcmVuX2QpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmkscGFyZW50OmMuaWR9KSxjLmNoaWxkcmVuX2Q9Yy5jaGlsZHJlbl9kLmNvbmNhdChpKSxqPTAsaz1jLnBhcmVudHMubGVuZ3RoO2s+ajtqKyspdGhpcy5fbW9kZWwuZGF0YVtjLnBhcmVudHNbal1dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtjLnBhcmVudHNbal1dLmNoaWxkcmVuX2QuY29uY2F0KGkpO2ZvcihkPWgsaD1bXSxqPTAsaz1jLmNoaWxkcmVuLmxlbmd0aDtrPmo7aisrKWhbaj49ZT9qKzE6al09Yy5jaGlsZHJlbltqXTtyZXR1cm4gaFtlXT1kLmlkLGMuY2hpbGRyZW49aCx0aGlzLnJlZHJhd19ub2RlKGMsITApLGYmJmYuY2FsbCh0aGlzLHRoaXMuZ2V0X25vZGUoZCkpLHRoaXMudHJpZ2dlcihcImNyZWF0ZV9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShkKSxwYXJlbnQ6Yy5pZCxwb3NpdGlvbjplfSksZC5pZH0scmVuYW1lX25vZGU6ZnVuY3Rpb24oYixjKXt2YXIgZCxlLGY7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrKyl0aGlzLnJlbmFtZV9ub2RlKGJbZF0sYyk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZj1iLnRleHQsdGhpcy5jaGVjayhcInJlbmFtZV9ub2RlXCIsYix0aGlzLmdldF9wYXJlbnQoYiksYyk/KHRoaXMuc2V0X3RleHQoYixjKSx0aGlzLnRyaWdnZXIoXCJyZW5hbWVfbm9kZVwiLHtub2RlOmIsdGV4dDpjLG9sZDpmfSksITApOih0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMSkpOiExfSxkZWxldGVfbm9kZTpmdW5jdGlvbihiKXt2YXIgYyxkLGUsZixnLGgsaSxqLGssbCxtLG47aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmRlbGV0ZV9ub2RlKGJbY10pO3JldHVybiEwfWlmKGI9dGhpcy5nZXRfbm9kZShiKSwhYnx8Yi5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7aWYoZT10aGlzLmdldF9ub2RlKGIucGFyZW50KSxmPWEuaW5BcnJheShiLmlkLGUuY2hpbGRyZW4pLGw9ITEsIXRoaXMuY2hlY2soXCJkZWxldGVfbm9kZVwiLGIsZSxmKSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7Zm9yKC0xIT09ZiYmKGUuY2hpbGRyZW49YS52YWthdGEuYXJyYXlfcmVtb3ZlKGUuY2hpbGRyZW4sZikpLGc9Yi5jaGlsZHJlbl9kLmNvbmNhdChbXSksZy5wdXNoKGIuaWQpLGg9MCxpPWIucGFyZW50cy5sZW5ndGg7aT5oO2grKyl0aGlzLl9tb2RlbC5kYXRhW2IucGFyZW50c1toXV0uY2hpbGRyZW5fZD1hLnZha2F0YS5hcnJheV9maWx0ZXIodGhpcy5fbW9kZWwuZGF0YVtiLnBhcmVudHNbaF1dLmNoaWxkcmVuX2QsZnVuY3Rpb24oYil7cmV0dXJuLTE9PT1hLmluQXJyYXkoYixnKX0pO2ZvcihqPTAsaz1nLmxlbmd0aDtrPmo7aisrKWlmKHRoaXMuX21vZGVsLmRhdGFbZ1tqXV0uc3RhdGUuc2VsZWN0ZWQpe2w9ITA7YnJlYWt9Zm9yKGwmJih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfZmlsdGVyKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxmdW5jdGlvbihiKXtyZXR1cm4tMT09PWEuaW5BcnJheShiLGcpfSkpLHRoaXMudHJpZ2dlcihcImRlbGV0ZV9ub2RlXCIse25vZGU6YixwYXJlbnQ6ZS5pZH0pLGwmJnRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVsZXRlX25vZGVcIixub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLHBhcmVudDplLmlkfSksaj0wLGs9Zy5sZW5ndGg7az5qO2orKylkZWxldGUgdGhpcy5fbW9kZWwuZGF0YVtnW2pdXTtyZXR1cm4tMSE9PWEuaW5BcnJheSh0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCxnKSYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW51bGwsbT10aGlzLmVsZW1lbnRbMF0uc2Nyb2xsVG9wLG49dGhpcy5lbGVtZW50WzBdLnNjcm9sbExlZnQsZS5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS5jaGlsZHJlblswXSYmdGhpcy5nZXRfbm9kZSh0aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuWzBdLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk6dGhpcy5nZXRfbm9kZShlLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCksdGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcD1tLHRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0PW4pLHRoaXMucmVkcmF3X25vZGUoZSwhMCksITB9LGNoZWNrOmZ1bmN0aW9uKGIsYyxkLGUsZil7Yz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSxkPWQmJmQuaWQ/ZDp0aGlzLmdldF9ub2RlKGQpO3ZhciBnPWIubWF0Y2goL15tb3ZlX25vZGV8Y29weV9ub2RlfGNyZWF0ZV9ub2RlJC9pKT9kOmMsaD10aGlzLnNldHRpbmdzLmNvcmUuY2hlY2tfY2FsbGJhY2s7cmV0dXJuXCJtb3ZlX25vZGVcIiE9PWJ8fGYmJmYuaXNfbXVsdGl8fGMuaWQhPT1kLmlkJiYoXCJtb3ZlX25vZGVcIiE9PWJ8fGEuaW5BcnJheShjLmlkLGQuY2hpbGRyZW4pIT09ZSkmJi0xPT09YS5pbkFycmF5KGQuaWQsYy5jaGlsZHJlbl9kKT8oZyYmZy5kYXRhJiYoZz1nLmRhdGEpLGcmJmcuZnVuY3Rpb25zJiYoZy5mdW5jdGlvbnNbYl09PT0hMXx8Zy5mdW5jdGlvbnNbYl09PT0hMCk/KGcuZnVuY3Rpb25zW2JdPT09ITEmJih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDJcIixyZWFzb246XCJOb2RlIGRhdGEgcHJldmVudHMgZnVuY3Rpb246IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmUsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZCYmZC5pZD9kLmlkOiExfSl9KSxnLmZ1bmN0aW9uc1tiXSk6aD09PSExfHxhLmlzRnVuY3Rpb24oaCkmJmguY2FsbCh0aGlzLGIsYyxkLGUsZik9PT0hMXx8aCYmaFtiXT09PSExPyh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDNcIixyZWFzb246XCJVc2VyIGNvbmZpZyBmb3IgY29yZS5jaGVja19jYWxsYmFjayBwcmV2ZW50cyBmdW5jdGlvbjogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZSxvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjpkJiZkLmlkP2QuaWQ6ITF9KX0sITEpOiEwKToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAxXCIscmVhc29uOlwiTW92aW5nIHBhcmVudCBpbnNpZGUgY2hpbGRcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZSxvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjpkJiZkLmlkP2QuaWQ6ITF9KX0sITEpfSxsYXN0X2Vycm9yOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yfSxtb3ZlX25vZGU6ZnVuY3Rpb24oYyxkLGUsZixnLGgsaSl7dmFyIGosayxsLG0sbixvLHAscSxyLHMsdCx1LHYsdztpZihkPXRoaXMuZ2V0X25vZGUoZCksZT1lPT09Yj8wOmUsIWQpcmV0dXJuITE7aWYoIWUudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhZyYmIXRoaXMuaXNfbG9hZGVkKGQpKXJldHVybiB0aGlzLmxvYWRfbm9kZShkLGZ1bmN0aW9uKCl7dGhpcy5tb3ZlX25vZGUoYyxkLGUsZiwhMCwhMSxpKX0pO2lmKGEuaXNBcnJheShjKSl7aWYoMSE9PWMubGVuZ3RoKXtmb3Ioaj0wLGs9Yy5sZW5ndGg7az5qO2orKykocj10aGlzLm1vdmVfbm9kZShjW2pdLGQsZSxmLGcsITEsaSkpJiYoZD1yLGU9XCJhZnRlclwiKTtyZXR1cm4gdGhpcy5yZWRyYXcoKSwhMH1jPWNbMF19aWYoYz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSwhY3x8Yy5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7aWYobD0oYy5wYXJlbnR8fGEuanN0cmVlLnJvb3QpLnRvU3RyaW5nKCksbj1lLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmZC5pZCE9PWEuanN0cmVlLnJvb3Q/dGhpcy5nZXRfbm9kZShkLnBhcmVudCk6ZCxvPWk/aTp0aGlzLl9tb2RlbC5kYXRhW2MuaWRdP3RoaXM6YS5qc3RyZWUucmVmZXJlbmNlKGMuaWQpLHA9IW98fCFvLl9pZHx8dGhpcy5faWQhPT1vLl9pZCxtPW8mJm8uX2lkJiZsJiZvLl9tb2RlbC5kYXRhW2xdJiZvLl9tb2RlbC5kYXRhW2xdLmNoaWxkcmVuP2EuaW5BcnJheShjLmlkLG8uX21vZGVsLmRhdGFbbF0uY2hpbGRyZW4pOi0xLG8mJm8uX2lkJiYoYz1vLl9tb2RlbC5kYXRhW2MuaWRdKSxwKXJldHVybihyPXRoaXMuY29weV9ub2RlKGMsZCxlLGYsZywhMSxpKSk/KG8mJm8uZGVsZXRlX25vZGUoYykscik6ITE7c3dpdGNoKGQuaWQ9PT1hLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PWUmJihlPVwiZmlyc3RcIiksXCJhZnRlclwiPT09ZSYmKGU9XCJsYXN0XCIpKSxlKXtjYXNlXCJiZWZvcmVcIjplPWEuaW5BcnJheShkLmlkLG4uY2hpbGRyZW4pO2JyZWFrO2Nhc2VcImFmdGVyXCI6ZT1hLmluQXJyYXkoZC5pZCxuLmNoaWxkcmVuKSsxO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6ZT0wO2JyZWFrO2Nhc2VcImxhc3RcIjplPW4uY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6ZXx8KGU9MCl9aWYoZT5uLmNoaWxkcmVuLmxlbmd0aCYmKGU9bi5jaGlsZHJlbi5sZW5ndGgpLCF0aGlzLmNoZWNrKFwibW92ZV9ub2RlXCIsYyxuLGUse2NvcmU6ITAsb3JpZ2luOmksaXNfbXVsdGk6byYmby5faWQmJm8uX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohb3x8IW8uX2lkfSkpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKGMucGFyZW50PT09bi5pZCl7Zm9yKHE9bi5jaGlsZHJlbi5jb25jYXQoKSxyPWEuaW5BcnJheShjLmlkLHEpLC0xIT09ciYmKHE9YS52YWthdGEuYXJyYXlfcmVtb3ZlKHEsciksZT5yJiZlLS0pLHI9W10scz0wLHQ9cS5sZW5ndGg7dD5zO3MrKylyW3M+PWU/cysxOnNdPXFbc107cltlXT1jLmlkLG4uY2hpbGRyZW49cix0aGlzLl9ub2RlX2NoYW5nZWQobi5pZCksdGhpcy5yZWRyYXcobi5pZD09PWEuanN0cmVlLnJvb3QpfWVsc2V7Zm9yKHI9Yy5jaGlsZHJlbl9kLmNvbmNhdCgpLHIucHVzaChjLmlkKSxzPTAsdD1jLnBhcmVudHMubGVuZ3RoO3Q+cztzKyspe2ZvcihxPVtdLHc9by5fbW9kZWwuZGF0YVtjLnBhcmVudHNbc11dLmNoaWxkcmVuX2QsdT0wLHY9dy5sZW5ndGg7dj51O3UrKyktMT09PWEuaW5BcnJheSh3W3VdLHIpJiZxLnB1c2god1t1XSk7by5fbW9kZWwuZGF0YVtjLnBhcmVudHNbc11dLmNoaWxkcmVuX2Q9cX1mb3Ioby5fbW9kZWwuZGF0YVtsXS5jaGlsZHJlbj1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbShvLl9tb2RlbC5kYXRhW2xdLmNoaWxkcmVuLGMuaWQpLHM9MCx0PW4ucGFyZW50cy5sZW5ndGg7dD5zO3MrKyl0aGlzLl9tb2RlbC5kYXRhW24ucGFyZW50c1tzXV0uY2hpbGRyZW5fZD10aGlzLl9tb2RlbC5kYXRhW24ucGFyZW50c1tzXV0uY2hpbGRyZW5fZC5jb25jYXQocik7Zm9yKHE9W10scz0wLHQ9bi5jaGlsZHJlbi5sZW5ndGg7dD5zO3MrKylxW3M+PWU/cysxOnNdPW4uY2hpbGRyZW5bc107Zm9yKHFbZV09Yy5pZCxuLmNoaWxkcmVuPXEsbi5jaGlsZHJlbl9kLnB1c2goYy5pZCksbi5jaGlsZHJlbl9kPW4uY2hpbGRyZW5fZC5jb25jYXQoYy5jaGlsZHJlbl9kKSxjLnBhcmVudD1uLmlkLHI9bi5wYXJlbnRzLmNvbmNhdCgpLHIudW5zaGlmdChuLmlkKSx3PWMucGFyZW50cy5sZW5ndGgsYy5wYXJlbnRzPXIscj1yLmNvbmNhdCgpLHM9MCx0PWMuY2hpbGRyZW5fZC5sZW5ndGg7dD5zO3MrKyl0aGlzLl9tb2RlbC5kYXRhW2MuY2hpbGRyZW5fZFtzXV0ucGFyZW50cz10aGlzLl9tb2RlbC5kYXRhW2MuY2hpbGRyZW5fZFtzXV0ucGFyZW50cy5zbGljZSgwLC0xKncpLEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHRoaXMuX21vZGVsLmRhdGFbYy5jaGlsZHJlbl9kW3NdXS5wYXJlbnRzLHIpO2whPT1hLmpzdHJlZS5yb290JiZuLmlkIT09YS5qc3RyZWUucm9vdHx8KHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwKSx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhd3x8KHRoaXMuX25vZGVfY2hhbmdlZChsKSx0aGlzLl9ub2RlX2NoYW5nZWQobi5pZCkpLGh8fHRoaXMucmVkcmF3KCl9cmV0dXJuIGYmJmYuY2FsbCh0aGlzLGMsbixlKSx0aGlzLnRyaWdnZXIoXCJtb3ZlX25vZGVcIix7bm9kZTpjLHBhcmVudDpuLmlkLHBvc2l0aW9uOmUsb2xkX3BhcmVudDpsLG9sZF9wb3NpdGlvbjptLGlzX211bHRpOm8mJm8uX2lkJiZvLl9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IW98fCFvLl9pZCxvbGRfaW5zdGFuY2U6byxuZXdfaW5zdGFuY2U6dGhpc30pLGMuaWR9LGNvcHlfbm9kZTpmdW5jdGlvbihjLGQsZSxmLGcsaCxpKXt2YXIgaixrLGwsbSxuLG8scCxxLHIscyx0O2lmKGQ9dGhpcy5nZXRfbm9kZShkKSxlPWU9PT1iPzA6ZSwhZClyZXR1cm4hMTtpZighZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFnJiYhdGhpcy5pc19sb2FkZWQoZCkpcmV0dXJuIHRoaXMubG9hZF9ub2RlKGQsZnVuY3Rpb24oKXt0aGlzLmNvcHlfbm9kZShjLGQsZSxmLCEwLCExLGkpfSk7aWYoYS5pc0FycmF5KGMpKXtpZigxIT09Yy5sZW5ndGgpe2ZvcihqPTAsaz1jLmxlbmd0aDtrPmo7aisrKShtPXRoaXMuY29weV9ub2RlKGNbal0sZCxlLGYsZywhMCxpKSkmJihkPW0sZT1cImFmdGVyXCIpO3JldHVybiB0aGlzLnJlZHJhdygpLCEwfWM9Y1swXX1pZihjPWMmJmMuaWQ/Yzp0aGlzLmdldF9ub2RlKGMpLCFjfHxjLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4hMTtzd2l0Y2gocT0oYy5wYXJlbnR8fGEuanN0cmVlLnJvb3QpLnRvU3RyaW5nKCkscj1lLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmZC5pZCE9PWEuanN0cmVlLnJvb3Q/dGhpcy5nZXRfbm9kZShkLnBhcmVudCk6ZCxzPWk/aTp0aGlzLl9tb2RlbC5kYXRhW2MuaWRdP3RoaXM6YS5qc3RyZWUucmVmZXJlbmNlKGMuaWQpLHQ9IXN8fCFzLl9pZHx8dGhpcy5faWQhPT1zLl9pZCxzJiZzLl9pZCYmKGM9cy5fbW9kZWwuZGF0YVtjLmlkXSksZC5pZD09PWEuanN0cmVlLnJvb3QmJihcImJlZm9yZVwiPT09ZSYmKGU9XCJmaXJzdFwiKSxcImFmdGVyXCI9PT1lJiYoZT1cImxhc3RcIikpLGUpe2Nhc2VcImJlZm9yZVwiOmU9YS5pbkFycmF5KGQuaWQsci5jaGlsZHJlbik7YnJlYWs7Y2FzZVwiYWZ0ZXJcIjplPWEuaW5BcnJheShkLmlkLHIuY2hpbGRyZW4pKzE7YnJlYWs7Y2FzZVwiaW5zaWRlXCI6Y2FzZVwiZmlyc3RcIjplPTA7YnJlYWs7Y2FzZVwibGFzdFwiOmU9ci5jaGlsZHJlbi5sZW5ndGg7YnJlYWs7ZGVmYXVsdDplfHwoZT0wKX1pZihlPnIuY2hpbGRyZW4ubGVuZ3RoJiYoZT1yLmNoaWxkcmVuLmxlbmd0aCksIXRoaXMuY2hlY2soXCJjb3B5X25vZGVcIixjLHIsZSx7Y29yZTohMCxvcmlnaW46aSxpc19tdWx0aTpzJiZzLl9pZCYmcy5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiFzfHwhcy5faWR9KSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7aWYocD1zP3MuZ2V0X2pzb24oYyx7bm9faWQ6ITAsbm9fZGF0YTohMCxub19zdGF0ZTohMH0pOmMsIXApcmV0dXJuITE7aWYocC5pZD09PSEwJiZkZWxldGUgcC5pZCxwPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihwLHIuaWQsci5wYXJlbnRzLmNvbmNhdCgpKSwhcClyZXR1cm4hMTtmb3IobT10aGlzLmdldF9ub2RlKHApLGMmJmMuc3RhdGUmJmMuc3RhdGUubG9hZGVkPT09ITEmJihtLnN0YXRlLmxvYWRlZD0hMSksbD1bXSxsLnB1c2gocCksbD1sLmNvbmNhdChtLmNoaWxkcmVuX2QpLHRoaXMudHJpZ2dlcihcIm1vZGVsXCIse25vZGVzOmwscGFyZW50OnIuaWR9KSxuPTAsbz1yLnBhcmVudHMubGVuZ3RoO28+bjtuKyspdGhpcy5fbW9kZWwuZGF0YVtyLnBhcmVudHNbbl1dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtyLnBhcmVudHNbbl1dLmNoaWxkcmVuX2QuY29uY2F0KGwpO2ZvcihsPVtdLG49MCxvPXIuY2hpbGRyZW4ubGVuZ3RoO28+bjtuKyspbFtuPj1lP24rMTpuXT1yLmNoaWxkcmVuW25dO3JldHVybiBsW2VdPW0uaWQsci5jaGlsZHJlbj1sLHIuY2hpbGRyZW5fZC5wdXNoKG0uaWQpLHIuY2hpbGRyZW5fZD1yLmNoaWxkcmVuX2QuY29uY2F0KG0uY2hpbGRyZW5fZCksci5pZD09PWEuanN0cmVlLnJvb3QmJih0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXd8fHRoaXMuX25vZGVfY2hhbmdlZChyLmlkKSxofHx0aGlzLnJlZHJhdyhyLmlkPT09YS5qc3RyZWUucm9vdCksZiYmZi5jYWxsKHRoaXMsbSxyLGUpLHRoaXMudHJpZ2dlcihcImNvcHlfbm9kZVwiLHtub2RlOm0sb3JpZ2luYWw6YyxwYXJlbnQ6ci5pZCxwb3NpdGlvbjplLG9sZF9wYXJlbnQ6cSxvbGRfcG9zaXRpb246cyYmcy5faWQmJnEmJnMuX21vZGVsLmRhdGFbcV0mJnMuX21vZGVsLmRhdGFbcV0uY2hpbGRyZW4/YS5pbkFycmF5KGMuaWQscy5fbW9kZWwuZGF0YVtxXS5jaGlsZHJlbik6LTEsaXNfbXVsdGk6cyYmcy5faWQmJnMuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohc3x8IXMuX2lkLG9sZF9pbnN0YW5jZTpzLG5ld19pbnN0YW5jZTp0aGlzfSksbS5pZH0sY3V0OmZ1bmN0aW9uKGIpe2lmKGJ8fChiPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoKSksYS5pc0FycmF5KGIpfHwoYj1bYl0pLCFiLmxlbmd0aClyZXR1cm4hMTt2YXIgYz1bXSxnLGgsaTtmb3IoaD0wLGk9Yi5sZW5ndGg7aT5oO2grKylnPXRoaXMuZ2V0X25vZGUoYltoXSksZyYmZy5pZCYmZy5pZCE9PWEuanN0cmVlLnJvb3QmJmMucHVzaChnKTtyZXR1cm4gYy5sZW5ndGg/KGQ9YyxmPXRoaXMsZT1cIm1vdmVfbm9kZVwiLHZvaWQgdGhpcy50cmlnZ2VyKFwiY3V0XCIse25vZGU6Yn0pKTohMX0sY29weTpmdW5jdGlvbihiKXtpZihifHwoYj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KCkpLGEuaXNBcnJheShiKXx8KGI9W2JdKSwhYi5sZW5ndGgpcmV0dXJuITE7dmFyIGM9W10sZyxoLGk7Zm9yKGg9MCxpPWIubGVuZ3RoO2k+aDtoKyspZz10aGlzLmdldF9ub2RlKGJbaF0pLGcmJmcuaWQmJmcuaWQhPT1hLmpzdHJlZS5yb290JiZjLnB1c2goZyk7cmV0dXJuIGMubGVuZ3RoPyhkPWMsZj10aGlzLGU9XCJjb3B5X25vZGVcIix2b2lkIHRoaXMudHJpZ2dlcihcImNvcHlcIix7bm9kZTpifSkpOiExfSxnZXRfYnVmZmVyOmZ1bmN0aW9uKCl7cmV0dXJue21vZGU6ZSxub2RlOmQsaW5zdDpmfX0sY2FuX3Bhc3RlOmZ1bmN0aW9uKCl7cmV0dXJuIGUhPT0hMSYmZCE9PSExfSxwYXN0ZTpmdW5jdGlvbihhLGIpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmZSYmZS5tYXRjaCgvXihjb3B5X25vZGV8bW92ZV9ub2RlKSQvKSYmZD8odGhpc1tlXShkLGEsYiwhMSwhMSwhMSxmKSYmdGhpcy50cmlnZ2VyKFwicGFzdGVcIix7cGFyZW50OmEuaWQsbm9kZTpkLG1vZGU6ZX0pLGQ9ITEsZT0hMSx2b2lkKGY9ITEpKTohMX0sY2xlYXJfYnVmZmVyOmZ1bmN0aW9uKCl7ZD0hMSxlPSExLGY9ITEsdGhpcy50cmlnZ2VyKFwiY2xlYXJfYnVmZmVyXCIpfSxlZGl0OmZ1bmN0aW9uKGIsYyxkKXt2YXIgZSxmLGcsaCxqLGssbCxtLG4sbz0hMTtyZXR1cm4oYj10aGlzLmdldF9ub2RlKGIpKT90aGlzLnNldHRpbmdzLmNvcmUuY2hlY2tfY2FsbGJhY2s9PT0hMT8odGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA3XCIscmVhc29uOlwiQ291bGQgbm90IGVkaXQgbm9kZSBiZWNhdXNlIG9mIGNoZWNrX2NhbGxiYWNrXCJ9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExKToobj1iLGM9XCJzdHJpbmdcIj09dHlwZW9mIGM/YzpiLnRleHQsdGhpcy5zZXRfdGV4dChiLFwiXCIpLGI9dGhpcy5fb3Blbl90byhiKSxuLnRleHQ9YyxlPXRoaXMuX2RhdGEuY29yZS5ydGwsZj10aGlzLmVsZW1lbnQud2lkdGgoKSx0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1uLmlkLGc9Yi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCksaD1hKFwiPHNwYW4+XCIpLGo9YyxrPWEoXCI8ZGl2IC8+XCIse2Nzczp7cG9zaXRpb246XCJhYnNvbHV0ZVwiLHRvcDpcIi0yMDBweFwiLGxlZnQ6ZT9cIjBweFwiOlwiLTEwMDBweFwiLHZpc2liaWxpdHk6XCJoaWRkZW5cIn19KS5hcHBlbmRUbyhcImJvZHlcIiksbD1hKFwiPGlucHV0IC8+XCIse3ZhbHVlOmosXCJjbGFzc1wiOlwianN0cmVlLXJlbmFtZS1pbnB1dFwiLGNzczp7cGFkZGluZzpcIjBcIixib3JkZXI6XCIxcHggc29saWQgc2lsdmVyXCIsXCJib3gtc2l6aW5nXCI6XCJib3JkZXItYm94XCIsZGlzcGxheTpcImlubGluZS1ibG9ja1wiLGhlaWdodDp0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0K1wicHhcIixsaW5lSGVpZ2h0OnRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQrXCJweFwiLHdpZHRoOlwiMTUwcHhcIn0sYmx1cjphLnByb3h5KGZ1bmN0aW9uKGMpe2Muc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYy5wcmV2ZW50RGVmYXVsdCgpO3ZhciBlPWguY2hpbGRyZW4oXCIuanN0cmVlLXJlbmFtZS1pbnB1dFwiKSxmPWUudmFsKCksaT10aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dCxtO1wiXCI9PT1mJiYoZj1qKSxrLnJlbW92ZSgpLGgucmVwbGFjZVdpdGgoZyksaC5yZW1vdmUoKSxqPWk/ajphKFwiPGRpdj48L2Rpdj5cIikuYXBwZW5kKGEucGFyc2VIVE1MKGopKS5odG1sKCksdGhpcy5zZXRfdGV4dChiLGopLG09ISF0aGlzLnJlbmFtZV9ub2RlKGIsaT9hKFwiPGRpdj48L2Rpdj5cIikudGV4dChmKS50ZXh0KCk6YShcIjxkaXY+PC9kaXY+XCIpLmFwcGVuZChhLnBhcnNlSFRNTChmKSkuaHRtbCgpKSxtfHx0aGlzLnNldF90ZXh0KGIsaiksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bi5pZCxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt2YXIgYT10aGlzLmdldF9ub2RlKG4uaWQsITApO2EubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bi5pZCxhLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZm9jdXMoKSl9LHRoaXMpLDApLGQmJmQuY2FsbCh0aGlzLG4sbSxvKSxsPW51bGx9LHRoaXMpLGtleWRvd246ZnVuY3Rpb24oYSl7dmFyIGI9YS53aGljaDsyNz09PWImJihvPSEwLHRoaXMudmFsdWU9aiksMjchPT1iJiYxMyE9PWImJjM3IT09YiYmMzghPT1iJiYzOSE9PWImJjQwIT09YiYmMzIhPT1ifHxhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLDI3IT09YiYmMTMhPT1ifHwoYS5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuYmx1cigpKX0sY2xpY2s6ZnVuY3Rpb24oYSl7YS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKX0sbW91c2Vkb3duOmZ1bmN0aW9uKGEpe2Euc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9LGtleXVwOmZ1bmN0aW9uKGEpe2wud2lkdGgoTWF0aC5taW4oay50ZXh0KFwicFdcIit0aGlzLnZhbHVlKS53aWR0aCgpLGYpKX0sa2V5cHJlc3M6ZnVuY3Rpb24oYSl7cmV0dXJuIDEzPT09YS53aGljaD8hMTp2b2lkIDB9fSksbT17Zm9udEZhbWlseTpnLmNzcyhcImZvbnRGYW1pbHlcIil8fFwiXCIsZm9udFNpemU6Zy5jc3MoXCJmb250U2l6ZVwiKXx8XCJcIixmb250V2VpZ2h0OmcuY3NzKFwiZm9udFdlaWdodFwiKXx8XCJcIixmb250U3R5bGU6Zy5jc3MoXCJmb250U3R5bGVcIil8fFwiXCIsZm9udFN0cmV0Y2g6Zy5jc3MoXCJmb250U3RyZXRjaFwiKXx8XCJcIixmb250VmFyaWFudDpnLmNzcyhcImZvbnRWYXJpYW50XCIpfHxcIlwiLGxldHRlclNwYWNpbmc6Zy5jc3MoXCJsZXR0ZXJTcGFjaW5nXCIpfHxcIlwiLHdvcmRTcGFjaW5nOmcuY3NzKFwid29yZFNwYWNpbmdcIil8fFwiXCJ9LGguYXR0cihcImNsYXNzXCIsZy5hdHRyKFwiY2xhc3NcIikpLmFwcGVuZChnLmNvbnRlbnRzKCkuY2xvbmUoKSkuYXBwZW5kKGwpLGcucmVwbGFjZVdpdGgoaCksay5jc3MobSksbC5jc3MobSkud2lkdGgoTWF0aC5taW4oay50ZXh0KFwicFdcIitsWzBdLnZhbHVlKS53aWR0aCgpLGYpKVswXS5zZWxlY3QoKSx2b2lkIGEoaSkub25lKFwibW91c2Vkb3duLmpzdHJlZSB0b3VjaHN0YXJ0LmpzdHJlZSBkbmRfc3RhcnQudmFrYXRhXCIsZnVuY3Rpb24oYil7XG5sJiZiLnRhcmdldCE9PWwmJmEobCkuYmx1cigpfSkpOiExfSxzZXRfdGhlbWU6ZnVuY3Rpb24oYixjKXtpZighYilyZXR1cm4hMTtpZihjPT09ITApe3ZhciBkPXRoaXMuc2V0dGluZ3MuY29yZS50aGVtZXMuZGlyO2R8fChkPWEuanN0cmVlLnBhdGgrXCIvdGhlbWVzXCIpLGM9ZCtcIi9cIitiK1wiL3N0eWxlLmNzc1wifWMmJi0xPT09YS5pbkFycmF5KGMsZykmJihhKFwiaGVhZFwiKS5hcHBlbmQoJzxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiBocmVmPVwiJytjKydcIiB0eXBlPVwidGV4dC9jc3NcIiAvPicpLGcucHVzaChjKSksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lKSx0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWU9Yix0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJqc3RyZWUtXCIrYiksdGhpcy5lbGVtZW50W3RoaXMuc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcImpzdHJlZS1cIitiK1wiLXJlc3BvbnNpdmVcIiksdGhpcy50cmlnZ2VyKFwic2V0X3RoZW1lXCIse3RoZW1lOmJ9KX0sZ2V0X3RoZW1lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZX0sc2V0X3RoZW1lX3ZhcmlhbnQ6ZnVuY3Rpb24oYSl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50JiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lK1wiLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudCksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50PWEsYSYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZStcIi1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQpfSxnZXRfdGhlbWVfdmFyaWFudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnR9LHNob3dfc3RyaXBlczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz0hMCx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1zdHJpcGVkXCIpfSxoaWRlX3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM9ITEsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtc3RyaXBlZFwiKX0sdG9nZ2xlX3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM/dGhpcy5oaWRlX3N0cmlwZXMoKTp0aGlzLnNob3dfc3RyaXBlcygpfSxzaG93X2RvdHM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbm8tZG90c1wiKX0saGlkZV9kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWRvdHNcIil9LHRvZ2dsZV9kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzP3RoaXMuaGlkZV9kb3RzKCk6dGhpcy5zaG93X2RvdHMoKX0sc2hvd19pY29uczpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuaWNvbnM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbm8taWNvbnNcIil9LGhpZGVfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWljb25zXCIpfSx0b2dnbGVfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zP3RoaXMuaGlkZV9pY29ucygpOnRoaXMuc2hvd19pY29ucygpfSxzZXRfaWNvbjpmdW5jdGlvbihjLGQpe3ZhciBlLGYsZyxoO2lmKGEuaXNBcnJheShjKSl7Zm9yKGM9Yy5zbGljZSgpLGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspdGhpcy5zZXRfaWNvbihjW2VdLGQpO3JldHVybiEwfXJldHVybiBjPXRoaXMuZ2V0X25vZGUoYyksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3Q/KGg9Yy5pY29uLGMuaWNvbj1kPT09ITB8fG51bGw9PT1kfHxkPT09Ynx8XCJcIj09PWQ/ITA6ZCxnPXRoaXMuZ2V0X25vZGUoYywhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLGQ9PT0hMT90aGlzLmhpZGVfaWNvbihjKTpkPT09ITB8fG51bGw9PT1kfHxkPT09Ynx8XCJcIj09PWQ/KGcucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWN1c3RvbSBcIitoKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJcIikucmVtb3ZlQXR0cihcInJlbFwiKSxoPT09ITEmJnRoaXMuc2hvd19pY29uKGMpKTotMT09PWQuaW5kZXhPZihcIi9cIikmJi0xPT09ZC5pbmRleE9mKFwiLlwiKT8oZy5yZW1vdmVDbGFzcyhoKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJcIiksZy5hZGRDbGFzcyhkK1wiIGpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpLmF0dHIoXCJyZWxcIixkKSxoPT09ITEmJnRoaXMuc2hvd19pY29uKGMpKTooZy5yZW1vdmVDbGFzcyhoKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJcIiksZy5hZGRDbGFzcyhcImpzdHJlZS10aGVtZWljb24tY3VzdG9tXCIpLmNzcyhcImJhY2tncm91bmRcIixcInVybCgnXCIrZCtcIicpIGNlbnRlciBjZW50ZXIgbm8tcmVwZWF0XCIpLmF0dHIoXCJyZWxcIixkKSxoPT09ITEmJnRoaXMuc2hvd19pY29uKGMpKSwhMCk6ITF9LGdldF9pY29uOmZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi5pY29uOiExfSxoaWRlX2ljb246ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuaGlkZV9pY29uKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYiE9PWEuanN0cmVlLnJvb3Q/KGIuaWNvbj0hMSx0aGlzLmdldF9ub2RlKGIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKS5hZGRDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpLCEwKTohMX0sc2hvd19pY29uOmZ1bmN0aW9uKGIpe3ZhciBjLGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuc2hvd19pY29uKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYiE9PWEuanN0cmVlLnJvb3Q/KGU9dGhpcy5nZXRfbm9kZShiLCEwKSxiLmljb249ZS5sZW5ndGg/ZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikuYXR0cihcInJlbFwiKTohMCxiLmljb258fChiLmljb249ITApLGUuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXRoZW1laWNvbi1oaWRkZW5cIiksITApOiExfX0sYS52YWthdGE9e30sYS52YWthdGEuYXR0cmlidXRlcz1mdW5jdGlvbihiLGMpe2I9YShiKVswXTt2YXIgZD1jP3t9OltdO3JldHVybiBiJiZiLmF0dHJpYnV0ZXMmJmEuZWFjaChiLmF0dHJpYnV0ZXMsZnVuY3Rpb24oYixlKXstMT09PWEuaW5BcnJheShlLm5hbWUudG9Mb3dlckNhc2UoKSxbXCJzdHlsZVwiLFwiY29udGVudGVkaXRhYmxlXCIsXCJoYXNmb2N1c1wiLFwidGFiaW5kZXhcIl0pJiZudWxsIT09ZS52YWx1ZSYmXCJcIiE9PWEudHJpbShlLnZhbHVlKSYmKGM/ZFtlLm5hbWVdPWUudmFsdWU6ZC5wdXNoKGUubmFtZSkpfSksZH0sYS52YWthdGEuYXJyYXlfdW5pcXVlPWZ1bmN0aW9uKGEpe3ZhciBjPVtdLGQsZSxmLGc9e307Zm9yKGQ9MCxmPWEubGVuZ3RoO2Y+ZDtkKyspZ1thW2RdXT09PWImJihjLnB1c2goYVtkXSksZ1thW2RdXT0hMCk7cmV0dXJuIGN9LGEudmFrYXRhLmFycmF5X3JlbW92ZT1mdW5jdGlvbihhLGIpe3JldHVybiBhLnNwbGljZShiLDEpLGF9LGEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS5pbkFycmF5KGMsYik7cmV0dXJuLTEhPT1kP2EudmFrYXRhLmFycmF5X3JlbW92ZShiLGQpOmJ9LGEudmFrYXRhLmFycmF5X2ZpbHRlcj1mdW5jdGlvbihhLGIsYyxkLGUpe2lmKGEuZmlsdGVyKXJldHVybiBhLmZpbHRlcihiLGMpO2Q9W107Zm9yKGUgaW4gYSl+fmUrXCJcIj09ZStcIlwiJiZlPj0wJiZiLmNhbGwoYyxhW2VdLCtlLGEpJiZkLnB1c2goYVtlXSk7cmV0dXJuIGR9LGEuanN0cmVlLnBsdWdpbnMuY2hhbmdlZD1mdW5jdGlvbihhLGIpe3ZhciBjPVtdO3RoaXMudHJpZ2dlcj1mdW5jdGlvbihhLGQpe3ZhciBlLGY7aWYoZHx8KGQ9e30pLFwiY2hhbmdlZFwiPT09YS5yZXBsYWNlKFwiLmpzdHJlZVwiLFwiXCIpKXtkLmNoYW5nZWQ9e3NlbGVjdGVkOltdLGRlc2VsZWN0ZWQ6W119O3ZhciBnPXt9O2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWdbY1tlXV09MTtmb3IoZT0wLGY9ZC5zZWxlY3RlZC5sZW5ndGg7Zj5lO2UrKylnW2Quc2VsZWN0ZWRbZV1dP2dbZC5zZWxlY3RlZFtlXV09MjpkLmNoYW5nZWQuc2VsZWN0ZWQucHVzaChkLnNlbGVjdGVkW2VdKTtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKykxPT09Z1tjW2VdXSYmZC5jaGFuZ2VkLmRlc2VsZWN0ZWQucHVzaChjW2VdKTtjPWQuc2VsZWN0ZWQuc2xpY2UoKX1iLnRyaWdnZXIuY2FsbCh0aGlzLGEsZCl9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihhLGQpe3JldHVybiBjPVtdLGIucmVmcmVzaC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fTt2YXIgbT1pLmNyZWF0ZUVsZW1lbnQoXCJJXCIpO20uY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLWNoZWNrYm94XCIsbS5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksYS5qc3RyZWUuZGVmYXVsdHMuY2hlY2tib3g9e3Zpc2libGU6ITAsdGhyZWVfc3RhdGU6ITAsd2hvbGVfbm9kZTohMCxrZWVwX3NlbGVjdGVkX3N0eWxlOiEwLGNhc2NhZGU6XCJcIix0aWVfc2VsZWN0aW9uOiEwfSxhLmpzdHJlZS5wbHVnaW5zLmNoZWNrYm94PWZ1bmN0aW9uKGMsZCl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ZC5iaW5kLmNhbGwodGhpcyksdGhpcy5fZGF0YS5jaGVja2JveC51dG89ITEsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRocmVlX3N0YXRlJiYodGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlPVwidXArZG93bit1bmRldGVybWluZWRcIiksdGhpcy5lbGVtZW50Lm9uKFwiaW5pdC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jaGVja2JveC52aXNpYmxlPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudmlzaWJsZSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LmtlZXBfc2VsZWN0ZWRfc3R5bGV8fHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1uby1jbGlja2VkXCIpLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LXNlbGVjdGlvblwiKX0sdGhpcykpLm9uKFwibG9hZGluZy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpc1t0aGlzLl9kYXRhLmNoZWNrYm94LnZpc2libGU/XCJzaG93X2NoZWNrYm94ZXNcIjpcImhpZGVfY2hlY2tib3hlc1wiXSgpfSx0aGlzKSksLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVuZGV0ZXJtaW5lZFwiKSYmdGhpcy5lbGVtZW50Lm9uKFwiY2hhbmdlZC5qc3RyZWUgdW5jaGVja19ub2RlLmpzdHJlZSBjaGVja19ub2RlLmpzdHJlZSB1bmNoZWNrX2FsbC5qc3RyZWUgY2hlY2tfYWxsLmpzdHJlZSBtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWUgcmVkcmF3LmpzdHJlZSBvcGVuX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY2hlY2tib3gudXRvJiZjbGVhclRpbWVvdXQodGhpcy5fZGF0YS5jaGVja2JveC51dG8pLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPXNldFRpbWVvdXQoYS5wcm94eSh0aGlzLl91bmRldGVybWluZWQsdGhpcyksNTApfSx0aGlzKSksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHx0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fbW9kZWwuZGF0YSxkPWNbYi5wYXJlbnRdLGU9Yi5ub2RlcyxmLGc7Zm9yKGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspY1tlW2ZdXS5zdGF0ZS5jaGVja2VkPWNbZVtmXV0uc3RhdGUuY2hlY2tlZHx8Y1tlW2ZdXS5vcmlnaW5hbCYmY1tlW2ZdXS5vcmlnaW5hbC5zdGF0ZSYmY1tlW2ZdXS5vcmlnaW5hbC5zdGF0ZS5jaGVja2VkLGNbZVtmXV0uc3RhdGUuY2hlY2tlZCYmdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5wdXNoKGVbZl0pfSx0aGlzKSksLTE9PT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVwXCIpJiYtMT09PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwiZG93blwiKXx8dGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuX21vZGVsLmRhdGEsZT1kW2MucGFyZW50XSxmPWMubm9kZXMsZz1bXSxoLGksaixrLGwsbSxuPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxvPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjtpZigtMSE9PW4uaW5kZXhPZihcImRvd25cIikpaWYoZS5zdGF0ZVtvP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl0pe2ZvcihpPTAsaj1mLmxlbmd0aDtqPmk7aSsrKWRbZltpXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwO3RoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPXRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLmNvbmNhdChmKX1lbHNlIGZvcihpPTAsaj1mLmxlbmd0aDtqPmk7aSsrKWlmKGRbZltpXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3Ioaz0wLGw9ZFtmW2ldXS5jaGlsZHJlbl9kLmxlbmd0aDtsPms7aysrKWRbZFtmW2ldXS5jaGlsZHJlbl9kW2tdXS5zdGF0ZVtvP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITA7dGhpcy5fZGF0YVtvP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9dGhpcy5fZGF0YVtvP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQuY29uY2F0KGRbZltpXV0uY2hpbGRyZW5fZCl9aWYoLTEhPT1uLmluZGV4T2YoXCJ1cFwiKSl7Zm9yKGk9MCxqPWUuY2hpbGRyZW5fZC5sZW5ndGg7aj5pO2krKylkW2UuY2hpbGRyZW5fZFtpXV0uY2hpbGRyZW4ubGVuZ3RofHxnLnB1c2goZFtlLmNoaWxkcmVuX2RbaV1dLnBhcmVudCk7Zm9yKGc9YS52YWthdGEuYXJyYXlfdW5pcXVlKGcpLGs9MCxsPWcubGVuZ3RoO2w+aztrKyspe2U9ZFtnW2tdXTt3aGlsZShlJiZlLmlkIT09YS5qc3RyZWUucm9vdCl7Zm9yKGg9MCxpPTAsaj1lLmNoaWxkcmVuLmxlbmd0aDtqPmk7aSsrKWgrPWRbZS5jaGlsZHJlbltpXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKGghPT1qKWJyZWFrO2Uuc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLHRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLnB1c2goZS5pZCksbT10aGlzLmdldF9ub2RlKGUsITApLG0mJm0ubGVuZ3RoJiZtLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3Mobz9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSxlPXRoaXMuZ2V0X25vZGUoZS5wYXJlbnQpfX19dGhpcy5fZGF0YVtvP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfdW5pcXVlKHRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkKX0sdGhpcykpLm9uKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj9cInNlbGVjdF9ub2RlLmpzdHJlZVwiOlwiY2hlY2tfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yy5ub2RlLGU9dGhpcy5fbW9kZWwuZGF0YSxmPXRoaXMuZ2V0X25vZGUoZC5wYXJlbnQpLGc9dGhpcy5nZXRfbm9kZShkLCEwKSxoLGksaixrLGw9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLG09dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLG49e30sbz10aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZDtmb3IoaD0wLGk9by5sZW5ndGg7aT5oO2grKyluW29baF1dPSEwO2lmKC0xIT09bC5pbmRleE9mKFwiZG93blwiKSlmb3IoaD0wLGk9ZC5jaGlsZHJlbl9kLmxlbmd0aDtpPmg7aCsrKW5bZC5jaGlsZHJlbl9kW2hdXT0hMCxrPWVbZC5jaGlsZHJlbl9kW2hdXSxrLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCxrJiZrLm9yaWdpbmFsJiZrLm9yaWdpbmFsLnN0YXRlJiZrLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGsub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKTtpZigtMSE9PWwuaW5kZXhPZihcInVwXCIpKXdoaWxlKGYmJmYuaWQhPT1hLmpzdHJlZS5yb290KXtmb3Ioaj0wLGg9MCxpPWYuY2hpbGRyZW4ubGVuZ3RoO2k+aDtoKyspais9ZVtmLmNoaWxkcmVuW2hdXS5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoaiE9PWkpYnJlYWs7Zi5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsbltmLmlkXT0hMCxrPXRoaXMuZ2V0X25vZGUoZiwhMCksayYmay5sZW5ndGgmJmsuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGY9dGhpcy5nZXRfbm9kZShmLnBhcmVudCl9bz1bXTtmb3IoaCBpbiBuKW4uaGFzT3duUHJvcGVydHkoaCkmJm8ucHVzaChoKTt0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1vLC0xIT09bC5pbmRleE9mKFwiZG93blwiKSYmZy5sZW5ndGgmJmcuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikucGFyZW50KCkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJkZXNlbGVjdF9hbGwuanN0cmVlXCI6XCJ1bmNoZWNrX2FsbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5nZXRfbm9kZShhLmpzdHJlZS5yb290KSxlPXRoaXMuX21vZGVsLmRhdGEsZixnLGg7Zm9yKGY9MCxnPWQuY2hpbGRyZW5fZC5sZW5ndGg7Zz5mO2YrKyloPWVbZC5jaGlsZHJlbl9kW2ZdXSxoJiZoLm9yaWdpbmFsJiZoLm9yaWdpbmFsLnN0YXRlJiZoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKX0sdGhpcykpLm9uKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj9cImRlc2VsZWN0X25vZGUuanN0cmVlXCI6XCJ1bmNoZWNrX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPWMubm9kZSxlPXRoaXMuZ2V0X25vZGUoZCwhMCksZixnLGgsaT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUsaj10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24saz10aGlzLl9kYXRhW2o/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxsPXt9O2lmKGQmJmQub3JpZ2luYWwmJmQub3JpZ2luYWwuc3RhdGUmJmQub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYoZC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpLC0xIT09aS5pbmRleE9mKFwiZG93blwiKSlmb3IoZj0wLGc9ZC5jaGlsZHJlbl9kLmxlbmd0aDtnPmY7ZisrKWg9dGhpcy5fbW9kZWwuZGF0YVtkLmNoaWxkcmVuX2RbZl1dLGguc3RhdGVbaj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSExLGgmJmgub3JpZ2luYWwmJmgub3JpZ2luYWwuc3RhdGUmJmgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiYoaC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9ITEpO2lmKC0xIT09aS5pbmRleE9mKFwidXBcIikpZm9yKGY9MCxnPWQucGFyZW50cy5sZW5ndGg7Zz5mO2YrKyloPXRoaXMuX21vZGVsLmRhdGFbZC5wYXJlbnRzW2ZdXSxoLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSxoJiZoLm9yaWdpbmFsJiZoLm9yaWdpbmFsLnN0YXRlJiZoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKSxoPXRoaXMuZ2V0X25vZGUoZC5wYXJlbnRzW2ZdLCEwKSxoJiZoLmxlbmd0aCYmaC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKGo/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIik7Zm9yKGw9e30sZj0wLGc9ay5sZW5ndGg7Zz5mO2YrKyktMSE9PWkuaW5kZXhPZihcImRvd25cIikmJi0xIT09YS5pbkFycmF5KGtbZl0sZC5jaGlsZHJlbl9kKXx8LTEhPT1pLmluZGV4T2YoXCJ1cFwiKSYmLTEhPT1hLmluQXJyYXkoa1tmXSxkLnBhcmVudHMpfHwobFtrW2ZdXT0hMCk7az1bXTtmb3IoZiBpbiBsKWwuaGFzT3duUHJvcGVydHkoZikmJmsucHVzaChmKTt0aGlzLl9kYXRhW2o/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1rLC0xIT09aS5pbmRleE9mKFwiZG93blwiKSYmZS5sZW5ndGgmJmUuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKGo/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikucGFyZW50KCkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSl9LHRoaXMpKSwtMSE9PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwidXBcIikmJnRoaXMuZWxlbWVudC5vbihcImRlbGV0ZV9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzLmdldF9ub2RlKGMucGFyZW50KSxlPXRoaXMuX21vZGVsLmRhdGEsZixnLGgsaSxqPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbjt3aGlsZShkJiZkLmlkIT09YS5qc3RyZWUucm9vdCYmIWQuc3RhdGVbaj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3IoaD0wLGY9MCxnPWQuY2hpbGRyZW4ubGVuZ3RoO2c+ZjtmKyspaCs9ZVtkLmNoaWxkcmVuW2ZdXS5zdGF0ZVtqP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoIShnPjAmJmg9PT1nKSlicmVhaztkLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW2o/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGQuaWQpLGk9dGhpcy5nZXRfbm9kZShkLCEwKSxpJiZpLmxlbmd0aCYmaS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKGo/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksZD10aGlzLmdldF9ub2RlKGQucGFyZW50KX19LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9Yy5pc19tdWx0aSxlPWMub2xkX3BhcmVudCxmPXRoaXMuZ2V0X25vZGUoYy5wYXJlbnQpLGc9dGhpcy5fbW9kZWwuZGF0YSxoLGksaixrLGwsbT10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoIWQpe2g9dGhpcy5nZXRfbm9kZShlKTt3aGlsZShoJiZoLmlkIT09YS5qc3RyZWUucm9vdCYmIWguc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3IoaT0wLGo9MCxrPWguY2hpbGRyZW4ubGVuZ3RoO2s+ajtqKyspaSs9Z1toLmNoaWxkcmVuW2pdXS5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoIShrPjAmJmk9PT1rKSlicmVhaztoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGguaWQpLGw9dGhpcy5nZXRfbm9kZShoLCEwKSxsJiZsLmxlbmd0aCYmbC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksaD10aGlzLmdldF9ub2RlKGgucGFyZW50KX19aD1mO3doaWxlKGgmJmguaWQhPT1hLmpzdHJlZS5yb290KXtmb3IoaT0wLGo9MCxrPWguY2hpbGRyZW4ubGVuZ3RoO2s+ajtqKyspaSs9Z1toLmNoaWxkcmVuW2pdXS5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl07aWYoaT09PWspaC5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl18fChoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGguaWQpLGw9dGhpcy5nZXRfbm9kZShoLCEwKSxsJiZsLmxlbmd0aCYmbC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIikpO2Vsc2V7aWYoIWguc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKWJyZWFrO2guc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSExLHRoaXMuX2RhdGFbbT9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGFbbT9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLGguaWQpLGw9dGhpcy5nZXRfbm9kZShoLCEwKSxsJiZsLmxlbmd0aCYmbC5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKG0/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIil9aD10aGlzLmdldF9ub2RlKGgucGFyZW50KX19LHRoaXMpKX0sdGhpcy5fdW5kZXRlcm1pbmVkPWZ1bmN0aW9uKCl7aWYobnVsbCE9PXRoaXMuZWxlbWVudCl7dmFyIGMsZCxlLGYsZz17fSxoPXRoaXMuX21vZGVsLmRhdGEsaT10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24saj10aGlzLl9kYXRhW2k/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxrPVtdLGw9dGhpcztmb3IoYz0wLGQ9ai5sZW5ndGg7ZD5jO2MrKylpZihoW2pbY11dJiZoW2pbY11dLnBhcmVudHMpZm9yKGU9MCxmPWhbaltjXV0ucGFyZW50cy5sZW5ndGg7Zj5lO2UrKyl7aWYoZ1toW2pbY11dLnBhcmVudHNbZV1dIT09YilicmVhaztoW2pbY11dLnBhcmVudHNbZV0hPT1hLmpzdHJlZS5yb290JiYoZ1toW2pbY11dLnBhcmVudHNbZV1dPSEwLGsucHVzaChoW2pbY11dLnBhcmVudHNbZV0pKX1mb3IodGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5ub3QoXCI6aGFzKC5qc3RyZWUtY2hpbGRyZW4pXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1sLmdldF9ub2RlKHRoaXMpLGo7aWYoaS5zdGF0ZS5sb2FkZWQpe2ZvcihjPTAsZD1pLmNoaWxkcmVuX2QubGVuZ3RoO2Q+YztjKyspaWYoaj1oW2kuY2hpbGRyZW5fZFtjXV0sIWouc3RhdGUubG9hZGVkJiZqLm9yaWdpbmFsJiZqLm9yaWdpbmFsLnN0YXRlJiZqLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmai5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9PT0hMClmb3IoZ1tqLmlkXT09PWImJmouaWQhPT1hLmpzdHJlZS5yb290JiYoZ1tqLmlkXT0hMCxrLnB1c2goai5pZCkpLGU9MCxmPWoucGFyZW50cy5sZW5ndGg7Zj5lO2UrKylnW2oucGFyZW50c1tlXV09PT1iJiZqLnBhcmVudHNbZV0hPT1hLmpzdHJlZS5yb290JiYoZ1tqLnBhcmVudHNbZV1dPSEwLGsucHVzaChqLnBhcmVudHNbZV0pKX1lbHNlIGlmKGkub3JpZ2luYWwmJmkub3JpZ2luYWwuc3RhdGUmJmkub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkJiZpLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD09PSEwKWZvcihnW2kuaWRdPT09YiYmaS5pZCE9PWEuanN0cmVlLnJvb3QmJihnW2kuaWRdPSEwLGsucHVzaChpLmlkKSksZT0wLGY9aS5wYXJlbnRzLmxlbmd0aDtmPmU7ZSsrKWdbaS5wYXJlbnRzW2VdXT09PWImJmkucGFyZW50c1tlXSE9PWEuanN0cmVlLnJvb3QmJihnW2kucGFyZW50c1tlXV09ITAsay5wdXNoKGkucGFyZW50c1tlXSkpfSksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLXVuZGV0ZXJtaW5lZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS11bmRldGVybWluZWRcIiksYz0wLGQ9ay5sZW5ndGg7ZD5jO2MrKyloW2tbY11dLnN0YXRlW2k/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXXx8KGo9dGhpcy5nZXRfbm9kZShrW2NdLCEwKSxqJiZqLmxlbmd0aCYmai5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5hZGRDbGFzcyhcImpzdHJlZS11bmRldGVybWluZWRcIikpfX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbihiLGMsZSxmKXtpZihiPWQucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpKXt2YXIgZyxoLGk9bnVsbCxqPW51bGw7Zm9yKGc9MCxoPWIuY2hpbGROb2Rlcy5sZW5ndGg7aD5nO2crKylpZihiLmNoaWxkTm9kZXNbZ10mJmIuY2hpbGROb2Rlc1tnXS5jbGFzc05hbWUmJi0xIT09Yi5jaGlsZE5vZGVzW2ddLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7aT1iLmNoaWxkTm9kZXNbZ107YnJlYWt9aSYmKCF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJnRoaXMuX21vZGVsLmRhdGFbYi5pZF0uc3RhdGUuY2hlY2tlZCYmKGkuY2xhc3NOYW1lKz1cIiBqc3RyZWUtY2hlY2tlZFwiKSxqPW0uY2xvbmVOb2RlKCExKSx0aGlzLl9tb2RlbC5kYXRhW2IuaWRdLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkJiYoai5jbGFzc05hbWUrPVwiIGpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSxpLmluc2VydEJlZm9yZShqLGkuY2hpbGROb2Rlc1swXSkpfXJldHVybiBlfHwtMT09PXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZS5pbmRleE9mKFwidW5kZXRlcm1pbmVkXCIpfHwodGhpcy5fZGF0YS5jaGVja2JveC51dG8mJmNsZWFyVGltZW91dCh0aGlzLl9kYXRhLmNoZWNrYm94LnV0byksdGhpcy5fZGF0YS5jaGVja2JveC51dG89c2V0VGltZW91dChhLnByb3h5KHRoaXMuX3VuZGV0ZXJtaW5lZCx0aGlzKSw1MCkpLGJ9LHRoaXMuc2hvd19jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWNoZWNrYm94ZXNcIil9LHRoaXMuaGlkZV9jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLW5vLWNoZWNrYm94ZXNcIil9LHRoaXMudG9nZ2xlX2NoZWNrYm94ZXM9ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmNoZWNrYm94ZXM/dGhpcy5oaWRlX2NoZWNrYm94ZXMoKTp0aGlzLnNob3dfY2hlY2tib3hlcygpfSx0aGlzLmlzX3VuZGV0ZXJtaW5lZD1mdW5jdGlvbihiKXtiPXRoaXMuZ2V0X25vZGUoYik7dmFyIGM9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLGQsZSxmPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbixnPXRoaXMuX2RhdGFbZj9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLGg9dGhpcy5fbW9kZWwuZGF0YTtpZighYnx8Yi5zdGF0ZVtmP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09PT0hMHx8LTE9PT1jLmluZGV4T2YoXCJ1bmRldGVybWluZWRcIil8fC0xPT09Yy5pbmRleE9mKFwiZG93blwiKSYmLTE9PT1jLmluZGV4T2YoXCJ1cFwiKSlyZXR1cm4hMTtpZighYi5zdGF0ZS5sb2FkZWQmJmIub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPT09ITApcmV0dXJuITA7Zm9yKGQ9MCxlPWIuY2hpbGRyZW5fZC5sZW5ndGg7ZT5kO2QrKylpZigtMSE9PWEuaW5BcnJheShiLmNoaWxkcmVuX2RbZF0sZyl8fCFoW2IuY2hpbGRyZW5fZFtkXV0uc3RhdGUubG9hZGVkJiZoW2IuY2hpbGRyZW5fZFtkXV0ub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkKXJldHVybiEwO3JldHVybiExfSx0aGlzLmRpc2FibGVfY2hlY2tib3g9ZnVuY3Rpb24oYil7dmFyIGMsZCxlO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspdGhpcy5kaXNhYmxlX2NoZWNrYm94KGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGU9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWR8fChiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkPSEwLGUmJmUubGVuZ3RoJiZlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLmFkZENsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLHRoaXMudHJpZ2dlcihcImRpc2FibGVfY2hlY2tib3hcIix7bm9kZTpifSkpKSk6ITF9LHRoaXMuZW5hYmxlX2NoZWNrYm94PWZ1bmN0aW9uKGIpe3ZhciBjLGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZW5hYmxlX2NoZWNrYm94KGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGU9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuY2hlY2tib3hfZGlzYWJsZWQmJihiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkPSExLGUmJmUubGVuZ3RoJiZlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLWNoZWNrYm94XCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpLHRoaXMudHJpZ2dlcihcImVuYWJsZV9jaGVja2JveFwiLHtub2RlOmJ9KSkpKTohMX0sdGhpcy5hY3RpdmF0ZV9ub2RlPWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEoYy50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94LWRpc2FibGVkXCIpPyExOih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJih0aGlzLnNldHRpbmdzLmNoZWNrYm94Lndob2xlX25vZGV8fGEoYy50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94XCIpKSYmKGMuY3RybEtleT0hMCksdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHwhdGhpcy5zZXR0aW5ncy5jaGVja2JveC53aG9sZV9ub2RlJiYhYShjLnRhcmdldCkuaGFzQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3hcIik/ZC5hY3RpdmF0ZV9ub2RlLmNhbGwodGhpcyxiLGMpOnRoaXMuaXNfZGlzYWJsZWQoYik/ITE6KHRoaXMuaXNfY2hlY2tlZChiKT90aGlzLnVuY2hlY2tfbm9kZShiLGMpOnRoaXMuY2hlY2tfbm9kZShiLGMpLHZvaWQgdGhpcy50cmlnZ2VyKFwiYWN0aXZhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoYil9KSkpfSx0aGlzLmNoZWNrX25vZGU9ZnVuY3Rpb24oYixjKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuc2VsZWN0X25vZGUoYiwhMSwhMCxjKTt2YXIgZCxlLGYsZztpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKXRoaXMuY2hlY2tfbm9kZShiW2VdLGMpO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGQ9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuY2hlY2tlZHx8KGIuc3RhdGUuY2hlY2tlZD0hMCx0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnB1c2goYi5pZCksZCYmZC5sZW5ndGgmJmQuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2VkXCIpLHRoaXMudHJpZ2dlcihcImNoZWNrX25vZGVcIix7bm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZXZlbnQ6Y30pKSkpOiExfSx0aGlzLnVuY2hlY2tfbm9kZT1mdW5jdGlvbihiLGMpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5kZXNlbGVjdF9ub2RlKGIsITEsYyk7dmFyIGQsZSxmO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy51bmNoZWNrX25vZGUoYltkXSxjKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhmPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrZWQmJihiLnN0YXRlLmNoZWNrZWQ9ITEsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGIuaWQpLGYubGVuZ3RoJiZmLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJ1bmNoZWNrX25vZGVcIix7bm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsZXZlbnQ6Y30pKSkpOiExfSx0aGlzLmNoZWNrX2FsbD1mdW5jdGlvbigpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5zZWxlY3RfYWxsKCk7dmFyIGI9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5jb25jYXQoW10pLGMsZDtmb3IodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD10aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuX2QuY29uY2F0KCksYz0wLGQ9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5sZW5ndGg7ZD5jO2MrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbY11dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2NdXS5zdGF0ZS5jaGVja2VkPSEwKTt0aGlzLnJlZHJhdyghMCksdGhpcy50cmlnZ2VyKFwiY2hlY2tfYWxsXCIse3NlbGVjdGVkOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWR9KX0sdGhpcy51bmNoZWNrX2FsbD1mdW5jdGlvbigpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5kZXNlbGVjdF9hbGwoKTt2YXIgYT10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmNvbmNhdChbXSksYixjO2ZvcihiPTAsYz10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLmxlbmd0aDtjPmI7YisrKXRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFtiXV0mJih0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbYl1dLnN0YXRlLmNoZWNrZWQ9ITEpO3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9W10sdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNoZWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJ1bmNoZWNrX2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLG5vZGU6YX0pfSx0aGlzLmlzX2NoZWNrZWQ9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj90aGlzLmlzX3NlbGVjdGVkKGIpOihiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi5zdGF0ZS5jaGVja2VkOiExKX0sdGhpcy5nZXRfY2hlY2tlZD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP3RoaXMuZ2V0X3NlbGVjdGVkKGIpOmI/YS5tYXAodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZH0sdGhpcy5nZXRfdG9wX2NoZWNrZWQ9ZnVuY3Rpb24oYil7aWYodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXJldHVybiB0aGlzLmdldF90b3Bfc2VsZWN0ZWQoYik7dmFyIGM9dGhpcy5nZXRfY2hlY2tlZCghMCksZD17fSxlLGYsZyxoO2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWRbY1tlXS5pZF09Y1tlXTtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylmb3IoZz0wLGg9Y1tlXS5jaGlsZHJlbl9kLmxlbmd0aDtoPmc7ZysrKWRbY1tlXS5jaGlsZHJlbl9kW2ddXSYmZGVsZXRlIGRbY1tlXS5jaGlsZHJlbl9kW2ddXTtjPVtdO2ZvcihlIGluIGQpZC5oYXNPd25Qcm9wZXJ0eShlKSYmYy5wdXNoKGUpO3JldHVybiBiP2EubWFwKGMsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOmN9LHRoaXMuZ2V0X2JvdHRvbV9jaGVja2VkPWZ1bmN0aW9uKGIpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5nZXRfYm90dG9tX3NlbGVjdGVkKGIpO3ZhciBjPXRoaXMuZ2V0X2NoZWNrZWQoITApLGQ9W10sZSxmO2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWNbZV0uY2hpbGRyZW4ubGVuZ3RofHxkLnB1c2goY1tlXS5pZCk7cmV0dXJuIGI/YS5tYXAoZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6ZH0sdGhpcy5sb2FkX25vZGU9ZnVuY3Rpb24oYixjKXt2YXIgZSxmLGcsaCxpLGo7aWYoIWEuaXNBcnJheShiKSYmIXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbiYmKGo9dGhpcy5nZXRfbm9kZShiKSxqJiZqLnN0YXRlLmxvYWRlZCkpZm9yKGU9MCxmPWouY2hpbGRyZW5fZC5sZW5ndGg7Zj5lO2UrKyl0aGlzLl9tb2RlbC5kYXRhW2ouY2hpbGRyZW5fZFtlXV0uc3RhdGUuY2hlY2tlZCYmKGk9ITAsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGouY2hpbGRyZW5fZFtlXSkpO3JldHVybiBkLmxvYWRfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHRoaXMuZ2V0X3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGE9ZC5nZXRfc3RhdGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/YTooYS5jaGVja2JveD10aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLnNsaWNlKCksYSl9LHRoaXMuc2V0X3N0YXRlPWZ1bmN0aW9uKGIsYyl7dmFyIGU9ZC5zZXRfc3RhdGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKGUmJmIuY2hlY2tib3gpe2lmKCF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pe3RoaXMudW5jaGVja19hbGwoKTt2YXIgZj10aGlzO2EuZWFjaChiLmNoZWNrYm94LGZ1bmN0aW9uKGEsYil7Zi5jaGVja19ub2RlKGIpfSl9cmV0dXJuIGRlbGV0ZSBiLmNoZWNrYm94LHRoaXMuc2V0X3N0YXRlKGIsYyksITF9cmV0dXJuIGV9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb258fCh0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdKSxkLnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpfX0sYS5qc3RyZWUuZGVmYXVsdHMuY29uZGl0aW9uYWxzZWxlY3Q9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sYS5qc3RyZWUucGx1Z2lucy5jb25kaXRpb25hbHNlbGVjdD1mdW5jdGlvbihhLGIpe3RoaXMuYWN0aXZhdGVfbm9kZT1mdW5jdGlvbihhLGMpe3RoaXMuc2V0dGluZ3MuY29uZGl0aW9uYWxzZWxlY3QuY2FsbCh0aGlzLHRoaXMuZ2V0X25vZGUoYSksYykmJmIuYWN0aXZhdGVfbm9kZS5jYWxsKHRoaXMsYSxjKX19LGEuanN0cmVlLmRlZmF1bHRzLmNvbnRleHRtZW51PXtzZWxlY3Rfbm9kZTohMCxzaG93X2F0X25vZGU6ITAsaXRlbXM6ZnVuY3Rpb24oYixjKXtyZXR1cm57Y3JlYXRlOntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMCxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJDcmVhdGVcIixhY3Rpb246ZnVuY3Rpb24oYil7dmFyIGM9YS5qc3RyZWUucmVmZXJlbmNlKGIucmVmZXJlbmNlKSxkPWMuZ2V0X25vZGUoYi5yZWZlcmVuY2UpO2MuY3JlYXRlX25vZGUoZCx7fSxcImxhc3RcIixmdW5jdGlvbihhKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5lZGl0KGEpfSwwKX0pfX0scmVuYW1lOntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMSxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJSZW5hbWVcIixhY3Rpb246ZnVuY3Rpb24oYil7dmFyIGM9YS5qc3RyZWUucmVmZXJlbmNlKGIucmVmZXJlbmNlKSxkPWMuZ2V0X25vZGUoYi5yZWZlcmVuY2UpO2MuZWRpdChkKX19LHJlbW92ZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxpY29uOiExLHNlcGFyYXRvcl9hZnRlcjohMSxfZGlzYWJsZWQ6ITEsbGFiZWw6XCJEZWxldGVcIixhY3Rpb246ZnVuY3Rpb24oYil7dmFyIGM9YS5qc3RyZWUucmVmZXJlbmNlKGIucmVmZXJlbmNlKSxkPWMuZ2V0X25vZGUoYi5yZWZlcmVuY2UpO2MuaXNfc2VsZWN0ZWQoZCk/Yy5kZWxldGVfbm9kZShjLmdldF9zZWxlY3RlZCgpKTpjLmRlbGV0ZV9ub2RlKGQpfX0sY2NwOntzZXBhcmF0b3JfYmVmb3JlOiEwLGljb246ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiRWRpdFwiLGFjdGlvbjohMSxzdWJtZW51OntjdXQ6e3NlcGFyYXRvcl9iZWZvcmU6ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiQ3V0XCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmlzX3NlbGVjdGVkKGQpP2MuY3V0KGMuZ2V0X3RvcF9zZWxlY3RlZCgpKTpjLmN1dChkKX19LGNvcHk6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsbGFiZWw6XCJDb3B5XCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmlzX3NlbGVjdGVkKGQpP2MuY29weShjLmdldF90b3Bfc2VsZWN0ZWQoKSk6Yy5jb3B5KGQpfX0scGFzdGU6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxfZGlzYWJsZWQ6ZnVuY3Rpb24oYil7cmV0dXJuIWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSkuY2FuX3Bhc3RlKCl9LHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIlBhc3RlXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLnBhc3RlKGQpfX19fX19fSxhLmpzdHJlZS5wbHVnaW5zLmNvbnRleHRtZW51PWZ1bmN0aW9uKGMsZCl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7ZC5iaW5kLmNhbGwodGhpcyk7dmFyIGI9MCxjPW51bGwsZSxmO3RoaXMuZWxlbWVudC5vbihcImNvbnRleHRtZW51LmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGEsZCl7YS5wcmV2ZW50RGVmYXVsdCgpLGI9YS5jdHJsS2V5PytuZXcgRGF0ZTowLChkfHxjKSYmKGI9K25ldyBEYXRlKzFlNCksYyYmY2xlYXJUaW1lb3V0KGMpLHRoaXMuaXNfbG9hZGluZyhhLmN1cnJlbnRUYXJnZXQpfHx0aGlzLnNob3dfY29udGV4dG1lbnUoYS5jdXJyZW50VGFyZ2V0LGEucGFnZVgsYS5wYWdlWSxhKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYyl7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlJiYoIWJ8fCtuZXcgRGF0ZS1iPjI1MCkmJmEudmFrYXRhLmNvbnRleHQuaGlkZSgpLGI9MH0sdGhpcykpLm9uKFwidG91Y2hzdGFydC5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsZnVuY3Rpb24oYil7Yi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGU9Yi5wYWdlWCxmPWIucGFnZVksYz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YShiLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoXCJjb250ZXh0bWVudVwiLCEwKX0sNzUwKSl9KS5vbihcInRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSl7YyYmYS5vcmlnaW5hbEV2ZW50JiZhLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmEub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKE1hdGguYWJzKGUtYS5wYWdlWCk+NTB8fE1hdGguYWJzKGYtYS5wYWdlWSk+NTApJiZjbGVhclRpbWVvdXQoYyl9KS5vbihcInRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhKXtjJiZjbGVhclRpbWVvdXQoYyl9KSxhKGkpLm9uKFwiY29udGV4dF9oaWRlLnZha2F0YS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlPSExLGIucmVmZXJlbmNlLnJlbW92ZUNsYXNzKFwianN0cmVlLWNvbnRleHRcIil9LHRoaXMpKX0sdGhpcy50ZWFyZG93bj1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZSYmYS52YWthdGEuY29udGV4dC5oaWRlKCksZC50ZWFyZG93bi5jYWxsKHRoaXMpfSx0aGlzLnNob3dfY29udGV4dG1lbnU9ZnVuY3Rpb24oYyxkLGUsZil7aWYoYz10aGlzLmdldF9ub2RlKGMpLCFjfHxjLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4hMTt2YXIgZz10aGlzLnNldHRpbmdzLmNvbnRleHRtZW51LGg9dGhpcy5nZXRfbm9kZShjLCEwKSxpPWguY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKSxqPSExLGs9ITE7KGcuc2hvd19hdF9ub2RlfHxkPT09Ynx8ZT09PWIpJiYoaj1pLm9mZnNldCgpLGQ9ai5sZWZ0LGU9ai50b3ArdGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCksdGhpcy5zZXR0aW5ncy5jb250ZXh0bWVudS5zZWxlY3Rfbm9kZSYmIXRoaXMuaXNfc2VsZWN0ZWQoYykmJnRoaXMuYWN0aXZhdGVfbm9kZShjLGYpLGs9Zy5pdGVtcyxhLmlzRnVuY3Rpb24oaykmJihrPWsuY2FsbCh0aGlzLGMsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLl9zaG93X2NvbnRleHRtZW51KGMsZCxlLGEpfSx0aGlzKSkpLGEuaXNQbGFpbk9iamVjdChrKSYmdGhpcy5fc2hvd19jb250ZXh0bWVudShjLGQsZSxrKX0sdGhpcy5fc2hvd19jb250ZXh0bWVudT1mdW5jdGlvbihiLGMsZCxlKXt2YXIgZj10aGlzLmdldF9ub2RlKGIsITApLGc9Zi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpO2EoaSkub25lKFwiY29udGV4dF9zaG93LnZha2F0YS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9XCJqc3RyZWUtY29udGV4dG1lbnUganN0cmVlLVwiK3RoaXMuZ2V0X3RoZW1lKCkrXCItY29udGV4dG1lbnVcIjthKGMuZWxlbWVudCkuYWRkQ2xhc3MoZCksZy5hZGRDbGFzcyhcImpzdHJlZS1jb250ZXh0XCIpfSx0aGlzKSksdGhpcy5fZGF0YS5jb250ZXh0bWVudS52aXNpYmxlPSEwLGEudmFrYXRhLmNvbnRleHQuc2hvdyhnLHt4OmMseTpkfSxlKSx0aGlzLnRyaWdnZXIoXCJzaG93X2NvbnRleHRtZW51XCIse25vZGU6Yix4OmMseTpkfSl9fSxmdW5jdGlvbihhKXt2YXIgYj0hMSxjPXtlbGVtZW50OiExLHJlZmVyZW5jZTohMSxwb3NpdGlvbl94OjAscG9zaXRpb25feTowLGl0ZW1zOltdLGh0bWw6XCJcIixpc192aXNpYmxlOiExfTthLnZha2F0YS5jb250ZXh0PXtzZXR0aW5nczp7aGlkZV9vbm1vdXNlbGVhdmU6MCxpY29uczohMH0sX3RyaWdnZXI6ZnVuY3Rpb24oYil7YShpKS50cmlnZ2VySGFuZGxlcihcImNvbnRleHRfXCIrYitcIi52YWthdGFcIix7cmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50LHBvc2l0aW9uOnt4OmMucG9zaXRpb25feCx5OmMucG9zaXRpb25feX19KX0sX2V4ZWN1dGU6ZnVuY3Rpb24oYil7cmV0dXJuIGI9Yy5pdGVtc1tiXSxiJiYoIWIuX2Rpc2FibGVkfHxhLmlzRnVuY3Rpb24oYi5fZGlzYWJsZWQpJiYhYi5fZGlzYWJsZWQoe2l0ZW06YixyZWZlcmVuY2U6Yy5yZWZlcmVuY2UsZWxlbWVudDpjLmVsZW1lbnR9KSkmJmIuYWN0aW9uP2IuYWN0aW9uLmNhbGwobnVsbCx7aXRlbTpiLHJlZmVyZW5jZTpjLnJlZmVyZW5jZSxlbGVtZW50OmMuZWxlbWVudCxwb3NpdGlvbjp7eDpjLnBvc2l0aW9uX3gseTpjLnBvc2l0aW9uX3l9fSk6ITF9LF9wYXJzZTpmdW5jdGlvbihiLGQpe2lmKCFiKXJldHVybiExO2R8fChjLmh0bWw9XCJcIixjLml0ZW1zPVtdKTt2YXIgZT1cIlwiLGY9ITEsZztyZXR1cm4gZCYmKGUrPVwiPHVsPlwiKSxhLmVhY2goYixmdW5jdGlvbihiLGQpe3JldHVybiBkPyhjLml0ZW1zLnB1c2goZCksIWYmJmQuc2VwYXJhdG9yX2JlZm9yZSYmKGUrPVwiPGxpIGNsYXNzPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InPjxhIGhyZWY9JyMnIFwiKyhhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zP1wiXCI6J3N0eWxlPVwibWFyZ2luLWxlZnQ6MHB4O1wiJykrXCI+JiMxNjA7PC9hPjwvbGk+XCIpLGY9ITEsZSs9XCI8bGkgY2xhc3M9J1wiKyhkLl9jbGFzc3x8XCJcIikrKGQuX2Rpc2FibGVkPT09ITB8fGEuaXNGdW5jdGlvbihkLl9kaXNhYmxlZCkmJmQuX2Rpc2FibGVkKHtpdGVtOmQscmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50fSk/XCIgdmFrYXRhLWNvbnRleHRtZW51LWRpc2FibGVkIFwiOlwiXCIpK1wiJyBcIisoZC5zaG9ydGN1dD9cIiBkYXRhLXNob3J0Y3V0PSdcIitkLnNob3J0Y3V0K1wiJyBcIjpcIlwiKStcIj5cIixlKz1cIjxhIGhyZWY9JyMnIHJlbD0nXCIrKGMuaXRlbXMubGVuZ3RoLTEpK1wiJz5cIixhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zJiYoZSs9XCI8aSBcIixkLmljb24mJihlKz0tMSE9PWQuaWNvbi5pbmRleE9mKFwiL1wiKXx8LTEhPT1kLmljb24uaW5kZXhPZihcIi5cIik/XCIgc3R5bGU9J2JhY2tncm91bmQ6dXJsKFxcXCJcIitkLmljb24rXCJcXFwiKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdCcgXCI6XCIgY2xhc3M9J1wiK2QuaWNvbitcIicgXCIpLGUrPVwiPjwvaT48c3BhbiBjbGFzcz0ndmFrYXRhLWNvbnRleHRtZW51LXNlcCc+JiMxNjA7PC9zcGFuPlwiKSxlKz0oYS5pc0Z1bmN0aW9uKGQubGFiZWwpP2QubGFiZWwoe2l0ZW06YixyZWZlcmVuY2U6Yy5yZWZlcmVuY2UsZWxlbWVudDpjLmVsZW1lbnR9KTpkLmxhYmVsKSsoZC5zaG9ydGN1dD8nIDxzcGFuIGNsYXNzPVwidmFrYXRhLWNvbnRleHRtZW51LXNob3J0Y3V0IHZha2F0YS1jb250ZXh0bWVudS1zaG9ydGN1dC0nK2Quc2hvcnRjdXQrJ1wiPicrKGQuc2hvcnRjdXRfbGFiZWx8fFwiXCIpK1wiPC9zcGFuPlwiOlwiXCIpK1wiPC9hPlwiLGQuc3VibWVudSYmKGc9YS52YWthdGEuY29udGV4dC5fcGFyc2UoZC5zdWJtZW51LCEwKSxnJiYoZSs9ZykpLGUrPVwiPC9saT5cIix2b2lkKGQuc2VwYXJhdG9yX2FmdGVyJiYoZSs9XCI8bGkgY2xhc3M9J3Zha2F0YS1jb250ZXh0LXNlcGFyYXRvcic+PGEgaHJlZj0nIycgXCIrKGEudmFrYXRhLmNvbnRleHQuc2V0dGluZ3MuaWNvbnM/XCJcIjonc3R5bGU9XCJtYXJnaW4tbGVmdDowcHg7XCInKStcIj4mIzE2MDs8L2E+PC9saT5cIixmPSEwKSkpOiEwfSksZT1lLnJlcGxhY2UoLzxsaSBjbGFzc1xcPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InXFw+PFxcL2xpXFw+JC8sXCJcIiksZCYmKGUrPVwiPC91bD5cIiksZHx8KGMuaHRtbD1lLGEudmFrYXRhLmNvbnRleHQuX3RyaWdnZXIoXCJwYXJzZVwiKSksZS5sZW5ndGg+MTA/ZTohMX0sX3Nob3dfc3VibWVudTpmdW5jdGlvbihjKXtpZihjPWEoYyksYy5sZW5ndGgmJmMuY2hpbGRyZW4oXCJ1bFwiKS5sZW5ndGgpe3ZhciBkPWMuY2hpbGRyZW4oXCJ1bFwiKSxlPWMub2Zmc2V0KCkubGVmdCxmPWUrYy5vdXRlcldpZHRoKCksZz1jLm9mZnNldCgpLnRvcCxoPWQud2lkdGgoKSxpPWQuaGVpZ2h0KCksaj1hKHdpbmRvdykud2lkdGgoKSthKHdpbmRvdykuc2Nyb2xsTGVmdCgpLGs9YSh3aW5kb3cpLmhlaWdodCgpK2Eod2luZG93KS5zY3JvbGxUb3AoKTtiP2NbZi0oaCsxMCtjLm91dGVyV2lkdGgoKSk8MD9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcInZha2F0YS1jb250ZXh0LWxlZnRcIik6Y1tmK2g+aiYmZT5qLWY/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ2YWthdGEtY29udGV4dC1yaWdodFwiKSxnK2krMTA+ayYmZC5jc3MoXCJib3R0b21cIixcIi0xcHhcIiksYy5oYXNDbGFzcyhcInZha2F0YS1jb250ZXh0LXJpZ2h0XCIpP2g+ZSYmZC5jc3MoXCJtYXJnaW4tcmlnaHRcIixlLWgpOmg+ai1mJiZkLmNzcyhcIm1hcmdpbi1sZWZ0XCIsai1mLWgpLGQuc2hvdygpfX0sc2hvdzpmdW5jdGlvbihkLGUsZil7dmFyIGcsaCxpLGosayxsLG0sbixvPSEwO3N3aXRjaChjLmVsZW1lbnQmJmMuZWxlbWVudC5sZW5ndGgmJmMuZWxlbWVudC53aWR0aChcIlwiKSxvKXtjYXNlIWUmJiFkOnJldHVybiExO2Nhc2UhIWUmJiEhZDpjLnJlZmVyZW5jZT1kLGMucG9zaXRpb25feD1lLngsYy5wb3NpdGlvbl95PWUueTticmVhaztjYXNlIWUmJiEhZDpjLnJlZmVyZW5jZT1kLGc9ZC5vZmZzZXQoKSxjLnBvc2l0aW9uX3g9Zy5sZWZ0K2Qub3V0ZXJIZWlnaHQoKSxjLnBvc2l0aW9uX3k9Zy50b3A7YnJlYWs7Y2FzZSEhZSYmIWQ6Yy5wb3NpdGlvbl94PWUueCxjLnBvc2l0aW9uX3k9ZS55fWQmJiFmJiZhKGQpLmRhdGEoXCJ2YWthdGFfY29udGV4dG1lbnVcIikmJihmPWEoZCkuZGF0YShcInZha2F0YV9jb250ZXh0bWVudVwiKSksYS52YWthdGEuY29udGV4dC5fcGFyc2UoZikmJmMuZWxlbWVudC5odG1sKGMuaHRtbCksYy5pdGVtcy5sZW5ndGgmJihjLmVsZW1lbnQuYXBwZW5kVG8oXCJib2R5XCIpLGg9Yy5lbGVtZW50LGk9Yy5wb3NpdGlvbl94LGo9Yy5wb3NpdGlvbl95LGs9aC53aWR0aCgpLGw9aC5oZWlnaHQoKSxtPWEod2luZG93KS53aWR0aCgpK2Eod2luZG93KS5zY3JvbGxMZWZ0KCksbj1hKHdpbmRvdykuaGVpZ2h0KCkrYSh3aW5kb3cpLnNjcm9sbFRvcCgpLGImJihpLT1oLm91dGVyV2lkdGgoKS1hKGQpLm91dGVyV2lkdGgoKSxpPGEod2luZG93KS5zY3JvbGxMZWZ0KCkrMjAmJihpPWEod2luZG93KS5zY3JvbGxMZWZ0KCkrMjApKSxpK2srMjA+bSYmKGk9bS0oaysyMCkpLGorbCsyMD5uJiYoaj1uLShsKzIwKSksYy5lbGVtZW50LmNzcyh7bGVmdDppLHRvcDpqfSkuc2hvdygpLmZpbmQoXCJhXCIpLmZpcnN0KCkuZm9jdXMoKS5wYXJlbnQoKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGMuaXNfdmlzaWJsZT0hMCxhLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwic2hvd1wiKSl9LGhpZGU6ZnVuY3Rpb24oKXtjLmlzX3Zpc2libGUmJihjLmVsZW1lbnQuaGlkZSgpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCkuZmluZChcIjpmb2N1c1wiKS5ibHVyKCkuZW5kKCkuZGV0YWNoKCksYy5pc192aXNpYmxlPSExLGEudmFrYXRhLmNvbnRleHQuX3RyaWdnZXIoXCJoaWRlXCIpKX19LGEoZnVuY3Rpb24oKXtiPVwicnRsXCI9PT1hKFwiYm9keVwiKS5jc3MoXCJkaXJlY3Rpb25cIik7dmFyIGQ9ITE7Yy5lbGVtZW50PWEoXCI8dWwgY2xhc3M9J3Zha2F0YS1jb250ZXh0Jz48L3VsPlwiKSxjLmVsZW1lbnQub24oXCJtb3VzZWVudGVyXCIsXCJsaVwiLGZ1bmN0aW9uKGIpe2Iuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYS5jb250YWlucyh0aGlzLGIucmVsYXRlZFRhcmdldCl8fChkJiZjbGVhclRpbWVvdXQoZCksYy5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5lbmQoKSxhKHRoaXMpLnNpYmxpbmdzKCkuZmluZChcInVsXCIpLmhpZGUoKS5lbmQoKS5lbmQoKS5wYXJlbnRzVW50aWwoXCIudmFrYXRhLWNvbnRleHRcIixcImxpXCIpLmFkZEJhY2soKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGEudmFrYXRhLmNvbnRleHQuX3Nob3dfc3VibWVudSh0aGlzKSl9KS5vbihcIm1vdXNlbGVhdmVcIixcImxpXCIsZnVuY3Rpb24oYil7YS5jb250YWlucyh0aGlzLGIucmVsYXRlZFRhcmdldCl8fGEodGhpcykuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5hZGRCYWNrKCkucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKX0pLm9uKFwibW91c2VsZWF2ZVwiLGZ1bmN0aW9uKGIpe2EodGhpcykuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLGEudmFrYXRhLmNvbnRleHQuc2V0dGluZ3MuaGlkZV9vbm1vdXNlbGVhdmUmJihkPXNldFRpbWVvdXQoZnVuY3Rpb24oYil7cmV0dXJuIGZ1bmN0aW9uKCl7YS52YWthdGEuY29udGV4dC5oaWRlKCl9fSh0aGlzKSxhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmhpZGVfb25tb3VzZWxlYXZlKSl9KS5vbihcImNsaWNrXCIsXCJhXCIsZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpLGEodGhpcykuYmx1cigpLnBhcmVudCgpLmhhc0NsYXNzKFwidmFrYXRhLWNvbnRleHQtZGlzYWJsZWRcIil8fGEudmFrYXRhLmNvbnRleHQuX2V4ZWN1dGUoYSh0aGlzKS5hdHRyKFwicmVsXCIpKT09PSExfHxhLnZha2F0YS5jb250ZXh0LmhpZGUoKX0pLm9uKFwia2V5ZG93blwiLFwiYVwiLGZ1bmN0aW9uKGIpe3ZhciBkPW51bGw7c3dpdGNoKGIud2hpY2gpe2Nhc2UgMTM6Y2FzZSAzMjpiLnR5cGU9XCJtb3VzZXVwXCIsYi5wcmV2ZW50RGVmYXVsdCgpLGEoYi5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKGIpO2JyZWFrO2Nhc2UgMzc6Yy5pc192aXNpYmxlJiYoYy5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikubGFzdCgpLmNsb3Nlc3QoXCJsaVwiKS5maXJzdCgpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmVuZCgpLmVuZCgpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYi5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDM4OmMuaXNfdmlzaWJsZSYmKGQ9Yy5lbGVtZW50LmZpbmQoXCJ1bDp2aXNpYmxlXCIpLmFkZEJhY2soKS5sYXN0KCkuY2hpbGRyZW4oXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5wcmV2QWxsKFwibGk6bm90KC52YWthdGEtY29udGV4dC1zZXBhcmF0b3IpXCIpLmZpcnN0KCksZC5sZW5ndGh8fChkPWMuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwibGk6bm90KC52YWthdGEtY29udGV4dC1zZXBhcmF0b3IpXCIpLmxhc3QoKSksZC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYi5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDM5OmMuaXNfdmlzaWJsZSYmKGMuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmxhc3QoKS5jaGlsZHJlbihcInVsXCIpLnNob3coKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmZpcnN0KCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSxiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGIucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSA0MDpjLmlzX3Zpc2libGUmJihkPWMuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikubmV4dEFsbChcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpLGQubGVuZ3RofHwoZD1jLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpKSxkLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuY2hpbGRyZW4oXCJhXCIpLmZvY3VzKCksYi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSxiLnByZXZlbnREZWZhdWx0KCkpO2JyZWFrO2Nhc2UgMjc6YS52YWthdGEuY29udGV4dC5oaWRlKCksYi5wcmV2ZW50RGVmYXVsdCgpfX0pLm9uKFwia2V5ZG93blwiLGZ1bmN0aW9uKGEpe2EucHJldmVudERlZmF1bHQoKTt2YXIgYj1jLmVsZW1lbnQuZmluZChcIi52YWthdGEtY29udGV4dG1lbnUtc2hvcnRjdXQtXCIrYS53aGljaCkucGFyZW50KCk7Yi5wYXJlbnQoKS5ub3QoXCIudmFrYXRhLWNvbnRleHQtZGlzYWJsZWRcIikmJmIuY2xpY2soKX0pLGEoaSkub24oXCJtb3VzZWRvd24udmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGIpe2MuaXNfdmlzaWJsZSYmIWEuY29udGFpbnMoYy5lbGVtZW50WzBdLGIudGFyZ2V0KSYmYS52YWthdGEuY29udGV4dC5oaWRlKCk7XG59KS5vbihcImNvbnRleHRfc2hvdy52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSxkKXtjLmVsZW1lbnQuZmluZChcImxpOmhhcyh1bClcIikuY2hpbGRyZW4oXCJhXCIpLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtcGFyZW50XCIpLGImJmMuZWxlbWVudC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LXJ0bFwiKS5jc3MoXCJkaXJlY3Rpb25cIixcInJ0bFwiKSxjLmVsZW1lbnQuZmluZChcInVsXCIpLmhpZGUoKS5lbmQoKX0pfSl9KGEpLGEuanN0cmVlLmRlZmF1bHRzLmRuZD17Y29weTohMCxvcGVuX3RpbWVvdXQ6NTAwLGlzX2RyYWdnYWJsZTohMCxjaGVja193aGlsZV9kcmFnZ2luZzohMCxhbHdheXNfY29weTohMSxpbnNpZGVfcG9zOjAsZHJhZ19zZWxlY3Rpb246ITAsdG91Y2g6ITAsbGFyZ2VfZHJvcF90YXJnZXQ6ITEsbGFyZ2VfZHJhZ190YXJnZXQ6ITEsdXNlX2h0bWw1OiExfTt2YXIgbixvO2EuanN0cmVlLnBsdWdpbnMuZG5kPWZ1bmN0aW9uKGIsYyl7dGhpcy5pbml0PWZ1bmN0aW9uKGEsYil7Yy5pbml0LmNhbGwodGhpcyxhLGIpLHRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNT10aGlzLnNldHRpbmdzLmRuZC51c2VfaHRtbDUmJlwiZHJhZ2dhYmxlXCJpbiBpLmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpfSx0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtjLmJpbmQuY2FsbCh0aGlzKSx0aGlzLmVsZW1lbnQub24odGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1P1wiZHJhZ3N0YXJ0LmpzdHJlZVwiOlwibW91c2Vkb3duLmpzdHJlZSB0b3VjaHN0YXJ0LmpzdHJlZVwiLHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0P1wiLmpzdHJlZS1ub2RlXCI6XCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYil7aWYodGhpcy5zZXR0aW5ncy5kbmQubGFyZ2VfZHJhZ190YXJnZXQmJmEoYi50YXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIilbMF0hPT1iLmN1cnJlbnRUYXJnZXQpcmV0dXJuITA7aWYoXCJ0b3VjaHN0YXJ0XCI9PT1iLnR5cGUmJighdGhpcy5zZXR0aW5ncy5kbmQudG91Y2h8fFwic2VsZWN0ZWRcIj09PXRoaXMuc2V0dGluZ3MuZG5kLnRvdWNoJiYhYShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5oYXNDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpKSlyZXR1cm4hMDt2YXIgYz10aGlzLmdldF9ub2RlKGIudGFyZ2V0KSxkPXRoaXMuaXNfc2VsZWN0ZWQoYykmJnRoaXMuc2V0dGluZ3MuZG5kLmRyYWdfc2VsZWN0aW9uP3RoaXMuZ2V0X3RvcF9zZWxlY3RlZCgpLmxlbmd0aDoxLGU9ZD4xP2QrXCIgXCIrdGhpcy5nZXRfc3RyaW5nKFwibm9kZXNcIik6dGhpcy5nZXRfdGV4dChiLmN1cnJlbnRUYXJnZXQpO2lmKHRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0JiYoZT1hLnZha2F0YS5odG1sLmVzY2FwZShlKSksYyYmYy5pZCYmYy5pZCE9PWEuanN0cmVlLnJvb3QmJigxPT09Yi53aGljaHx8XCJ0b3VjaHN0YXJ0XCI9PT1iLnR5cGV8fFwiZHJhZ3N0YXJ0XCI9PT1iLnR5cGUpJiYodGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlPT09ITB8fGEuaXNGdW5jdGlvbih0aGlzLnNldHRpbmdzLmRuZC5pc19kcmFnZ2FibGUpJiZ0aGlzLnNldHRpbmdzLmRuZC5pc19kcmFnZ2FibGUuY2FsbCh0aGlzLGQ+MT90aGlzLmdldF90b3Bfc2VsZWN0ZWQoITApOltjXSxiKSkpe2lmKG49e2pzdHJlZTohMCxvcmlnaW46dGhpcyxvYmo6dGhpcy5nZXRfbm9kZShjLCEwKSxub2RlczpkPjE/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCk6W2MuaWRdfSxvPWIuY3VycmVudFRhcmdldCwhdGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1KXJldHVybiB0aGlzLmVsZW1lbnQudHJpZ2dlcihcIm1vdXNlZG93bi5qc3RyZWVcIiksYS52YWthdGEuZG5kLnN0YXJ0KGIsbiwnPGRpdiBpZD1cImpzdHJlZS1kbmRcIiBjbGFzcz1cImpzdHJlZS0nK3RoaXMuZ2V0X3RoZW1lKCkrXCIganN0cmVlLVwiK3RoaXMuZ2V0X3RoZW1lKCkrXCItXCIrdGhpcy5nZXRfdGhlbWVfdmFyaWFudCgpK1wiIFwiKyh0aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikrJ1wiPjxpIGNsYXNzPVwianN0cmVlLWljb24ganN0cmVlLWVyXCI+PC9pPicrZSsnPGlucyBjbGFzcz1cImpzdHJlZS1jb3B5XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+KzwvaW5zPjwvZGl2PicpO2EudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0YXJ0XCIsYix7aGVscGVyOmEoKSxlbGVtZW50Om8sZGF0YTpufSl9fSx0aGlzKSksdGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1JiZ0aGlzLmVsZW1lbnQub24oXCJkcmFnb3Zlci5qc3RyZWVcIixmdW5jdGlvbihiKXtyZXR1cm4gYi5wcmV2ZW50RGVmYXVsdCgpLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixiLHtoZWxwZXI6YSgpLGVsZW1lbnQ6byxkYXRhOm59KSwhMX0pLm9uKFwiZHJvcC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIpe3JldHVybiBiLnByZXZlbnREZWZhdWx0KCksYS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RvcFwiLGIse2hlbHBlcjphKCksZWxlbWVudDpvLGRhdGE6bn0pLCExfSx0aGlzKSl9LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oYSxiLGQsZSl7aWYoYT1jLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxhJiZ0aGlzLnNldHRpbmdzLmRuZC51c2VfaHRtbDUpaWYodGhpcy5zZXR0aW5ncy5kbmQubGFyZ2VfZHJhZ190YXJnZXQpYS5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwhMCk7ZWxzZXt2YXIgZixnLGg9bnVsbDtmb3IoZj0wLGc9YS5jaGlsZE5vZGVzLmxlbmd0aDtnPmY7ZisrKWlmKGEuY2hpbGROb2Rlc1tmXSYmYS5jaGlsZE5vZGVzW2ZdLmNsYXNzTmFtZSYmLTEhPT1hLmNoaWxkTm9kZXNbZl0uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtYW5jaG9yXCIpKXtoPWEuY2hpbGROb2Rlc1tmXTticmVha31oJiZoLnNldEF0dHJpYnV0ZShcImRyYWdnYWJsZVwiLCEwKX1yZXR1cm4gYX19LGEoZnVuY3Rpb24oKXt2YXIgYz0hMSxkPSExLGU9ITEsZj0hMSxnPWEoJzxkaXYgaWQ9XCJqc3RyZWUtbWFya2VyXCI+JiMxNjA7PC9kaXY+JykuaGlkZSgpO2EoaSkub24oXCJkbmRfc3RhcnQudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsYil7Yz0hMSxlPSExLGImJmIuZGF0YSYmYi5kYXRhLmpzdHJlZSYmZy5hcHBlbmRUbyhcImJvZHlcIil9KS5vbihcImRuZF9tb3ZlLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihoLGkpe2lmKGYmJihpLmV2ZW50JiZcImRyYWdvdmVyXCI9PT1pLmV2ZW50LnR5cGUmJmkuZXZlbnQudGFyZ2V0PT09ZS50YXJnZXR8fGNsZWFyVGltZW91dChmKSksaSYmaS5kYXRhJiZpLmRhdGEuanN0cmVlJiYoIWkuZXZlbnQudGFyZ2V0LmlkfHxcImpzdHJlZS1tYXJrZXJcIiE9PWkuZXZlbnQudGFyZ2V0LmlkKSl7ZT1pLmV2ZW50O3ZhciBqPWEuanN0cmVlLnJlZmVyZW5jZShpLmV2ZW50LnRhcmdldCksaz0hMSxsPSExLG09ITEsbixvLHAscSxyLHMsdCx1LHYsdyx4LHkseixBLEIsQztpZihqJiZqLl9kYXRhJiZqLl9kYXRhLmRuZClpZihnLmF0dHIoXCJjbGFzc1wiLFwianN0cmVlLVwiK2ouZ2V0X3RoZW1lKCkrKGouc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSksQz1pLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihpLmV2ZW50Lm1ldGFLZXl8fGkuZXZlbnQuY3RybEtleSkpLGkuaGVscGVyLmNoaWxkcmVuKCkuYXR0cihcImNsYXNzXCIsXCJqc3RyZWUtXCIrai5nZXRfdGhlbWUoKStcIiBqc3RyZWUtXCIrai5nZXRfdGhlbWUoKStcIi1cIitqLmdldF90aGVtZV92YXJpYW50KCkrXCIgXCIrKGouc2V0dGluZ3MuY29yZS50aGVtZXMucmVzcG9uc2l2ZT9cIiBqc3RyZWUtZG5kLXJlc3BvbnNpdmVcIjpcIlwiKSkuZmluZChcIi5qc3RyZWUtY29weVwiKS5maXJzdCgpW0M/XCJzaG93XCI6XCJoaWRlXCJdKCksaS5ldmVudC50YXJnZXQhPT1qLmVsZW1lbnRbMF0mJmkuZXZlbnQudGFyZ2V0IT09ai5nZXRfY29udGFpbmVyX3VsKClbMF18fDAhPT1qLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbigpLmxlbmd0aCl7aWYoaz1qLnNldHRpbmdzLmRuZC5sYXJnZV9kcm9wX3RhcmdldD9hKGkuZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIik6YShpLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtYW5jaG9yXCIpLGsmJmsubGVuZ3RoJiZrLnBhcmVudCgpLmlzKFwiLmpzdHJlZS1jbG9zZWQsIC5qc3RyZWUtb3BlbiwgLmpzdHJlZS1sZWFmXCIpJiYobD1rLm9mZnNldCgpLG09KGkuZXZlbnQucGFnZVkhPT1iP2kuZXZlbnQucGFnZVk6aS5ldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZKS1sLnRvcCxxPWsub3V0ZXJIZWlnaHQoKSx0PXEvMz5tP1tcImJcIixcImlcIixcImFcIl06bT5xLXEvMz9bXCJhXCIsXCJpXCIsXCJiXCJdOm0+cS8yP1tcImlcIixcImFcIixcImJcIl06W1wiaVwiLFwiYlwiLFwiYVwiXSxhLmVhY2godCxmdW5jdGlvbihiLGUpe3N3aXRjaChlKXtjYXNlXCJiXCI6bz1sLmxlZnQtNixwPWwudG9wLHI9ai5nZXRfcGFyZW50KGspLHM9ay5wYXJlbnQoKS5pbmRleCgpO2JyZWFrO2Nhc2VcImlcIjpBPWouc2V0dGluZ3MuZG5kLmluc2lkZV9wb3MsQj1qLmdldF9ub2RlKGsucGFyZW50KCkpLG89bC5sZWZ0LTIscD1sLnRvcCtxLzIrMSxyPUIuaWQscz1cImZpcnN0XCI9PT1BPzA6XCJsYXN0XCI9PT1BP0IuY2hpbGRyZW4ubGVuZ3RoOk1hdGgubWluKEEsQi5jaGlsZHJlbi5sZW5ndGgpO2JyZWFrO2Nhc2VcImFcIjpvPWwubGVmdC02LHA9bC50b3ArcSxyPWouZ2V0X3BhcmVudChrKSxzPWsucGFyZW50KCkuaW5kZXgoKSsxfWZvcih1PSEwLHY9MCx3PWkuZGF0YS5ub2Rlcy5sZW5ndGg7dz52O3YrKylpZih4PWkuZGF0YS5vcmlnaW4mJihpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8aS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKGkuZXZlbnQubWV0YUtleXx8aS5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiLHk9cyxcIm1vdmVfbm9kZVwiPT09eCYmXCJhXCI9PT1lJiZpLmRhdGEub3JpZ2luJiZpLmRhdGEub3JpZ2luPT09aiYmcj09PWouZ2V0X3BhcmVudChpLmRhdGEubm9kZXNbdl0pJiYoej1qLmdldF9ub2RlKHIpLHk+YS5pbkFycmF5KGkuZGF0YS5ub2Rlc1t2XSx6LmNoaWxkcmVuKSYmKHktPTEpKSx1PXUmJihqJiZqLnNldHRpbmdzJiZqLnNldHRpbmdzLmRuZCYmai5zZXR0aW5ncy5kbmQuY2hlY2tfd2hpbGVfZHJhZ2dpbmc9PT0hMXx8ai5jaGVjayh4LGkuZGF0YS5vcmlnaW4mJmkuZGF0YS5vcmlnaW4hPT1qP2kuZGF0YS5vcmlnaW4uZ2V0X25vZGUoaS5kYXRhLm5vZGVzW3ZdKTppLmRhdGEubm9kZXNbdl0scix5LHtkbmQ6ITAscmVmOmouZ2V0X25vZGUoay5wYXJlbnQoKSkscG9zOmUsb3JpZ2luOmkuZGF0YS5vcmlnaW4saXNfbXVsdGk6aS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbiE9PWosaXNfZm9yZWlnbjohaS5kYXRhLm9yaWdpbn0pKSwhdSl7aiYmai5sYXN0X2Vycm9yJiYoZD1qLmxhc3RfZXJyb3IoKSk7YnJlYWt9cmV0dXJuXCJpXCI9PT1lJiZrLnBhcmVudCgpLmlzKFwiLmpzdHJlZS1jbG9zZWRcIikmJmouc2V0dGluZ3MuZG5kLm9wZW5fdGltZW91dCYmKGY9c2V0VGltZW91dChmdW5jdGlvbihhLGIpe3JldHVybiBmdW5jdGlvbigpe2Eub3Blbl9ub2RlKGIpfX0oaixrKSxqLnNldHRpbmdzLmRuZC5vcGVuX3RpbWVvdXQpKSx1PyhjPXtpbnM6aixwYXI6cixwb3M6XCJpXCIhPT1lfHxcImxhc3RcIiE9PUF8fDAhPT1zfHxqLmlzX2xvYWRlZChCKT9zOlwibGFzdFwifSxnLmNzcyh7bGVmdDpvK1wicHhcIix0b3A6cCtcInB4XCJ9KS5zaG93KCksaS5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5maXJzdCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWVyXCIpLmFkZENsYXNzKFwianN0cmVlLW9rXCIpLGkuZXZlbnQub3JpZ2luYWxFdmVudCYmaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciYmKGkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdD1DP1wiY29weVwiOlwibW92ZVwiKSxkPXt9LHQ9ITAsITEpOnZvaWQgMH0pLHQ9PT0hMCkpcmV0dXJufWVsc2V7Zm9yKHU9ITAsdj0wLHc9aS5kYXRhLm5vZGVzLmxlbmd0aDt3PnY7disrKWlmKHU9dSYmai5jaGVjayhpLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihpLmV2ZW50Lm1ldGFLZXl8fGkuZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIixpLmRhdGEub3JpZ2luJiZpLmRhdGEub3JpZ2luIT09aj9pLmRhdGEub3JpZ2luLmdldF9ub2RlKGkuZGF0YS5ub2Rlc1t2XSk6aS5kYXRhLm5vZGVzW3ZdLGEuanN0cmVlLnJvb3QsXCJsYXN0XCIse2RuZDohMCxyZWY6ai5nZXRfbm9kZShhLmpzdHJlZS5yb290KSxwb3M6XCJpXCIsb3JpZ2luOmkuZGF0YS5vcmlnaW4saXNfbXVsdGk6aS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbiE9PWosaXNfZm9yZWlnbjohaS5kYXRhLm9yaWdpbn0pLCF1KWJyZWFrO2lmKHUpcmV0dXJuIGM9e2luczpqLHBhcjphLmpzdHJlZS5yb290LHBvczpcImxhc3RcIn0sZy5oaWRlKCksaS5oZWxwZXIuZmluZChcIi5qc3RyZWUtaWNvblwiKS5maXJzdCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLWVyXCIpLmFkZENsYXNzKFwianN0cmVlLW9rXCIpLHZvaWQoaS5ldmVudC5vcmlnaW5hbEV2ZW50JiZpLmV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyJiYoaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0PUM/XCJjb3B5XCI6XCJtb3ZlXCIpKX1jPSExLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb2tcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZXJcIiksaS5ldmVudC5vcmlnaW5hbEV2ZW50JiZpLmV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyJiYoaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0PVwibm9uZVwiKSxnLmhpZGUoKX19KS5vbihcImRuZF9zY3JvbGwudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsYil7YiYmYi5kYXRhJiZiLmRhdGEuanN0cmVlJiYoZy5oaWRlKCksYz0hMSxlPSExLGIuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1va1wiKS5hZGRDbGFzcyhcImpzdHJlZS1lclwiKSl9KS5vbihcImRuZF9zdG9wLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihiLGgpe2lmKGYmJmNsZWFyVGltZW91dChmKSxoJiZoLmRhdGEmJmguZGF0YS5qc3RyZWUpe2cuaGlkZSgpLmRldGFjaCgpO3ZhciBpLGosaz1bXTtpZihjKXtmb3IoaT0wLGo9aC5kYXRhLm5vZGVzLmxlbmd0aDtqPmk7aSsrKWtbaV09aC5kYXRhLm9yaWdpbj9oLmRhdGEub3JpZ2luLmdldF9ub2RlKGguZGF0YS5ub2Rlc1tpXSk6aC5kYXRhLm5vZGVzW2ldO2MuaW5zW2guZGF0YS5vcmlnaW4mJihoLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8aC5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKGguZXZlbnQubWV0YUtleXx8aC5ldmVudC5jdHJsS2V5KSk/XCJjb3B5X25vZGVcIjpcIm1vdmVfbm9kZVwiXShrLGMucGFyLGMucG9zLCExLCExLCExLGguZGF0YS5vcmlnaW4pfWVsc2UgaT1hKGguZXZlbnQudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZVwiKSxpLmxlbmd0aCYmZCYmZC5lcnJvciYmXCJjaGVja1wiPT09ZC5lcnJvciYmKGk9aS5qc3RyZWUoITApLGkmJmkuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsZCkpO2U9ITEsYz0hMX19KS5vbihcImtleXVwLmpzdHJlZSBrZXlkb3duLmpzdHJlZVwiLGZ1bmN0aW9uKGIsaCl7aD1hLnZha2F0YS5kbmQuX2dldCgpLGgmJmguZGF0YSYmaC5kYXRhLmpzdHJlZSYmKFwia2V5dXBcIj09PWIudHlwZSYmMjc9PT1iLndoaWNoPyhmJiZjbGVhclRpbWVvdXQoZiksYz0hMSxkPSExLGU9ITEsZj0hMSxnLmhpZGUoKS5kZXRhY2goKSxhLnZha2F0YS5kbmQuX2NsZWFuKCkpOihoLmhlbHBlci5maW5kKFwiLmpzdHJlZS1jb3B5XCIpLmZpcnN0KClbaC5kYXRhLm9yaWdpbiYmKGguZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxoLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoYi5tZXRhS2V5fHxiLmN0cmxLZXkpKT9cInNob3dcIjpcImhpZGVcIl0oKSxlJiYoZS5tZXRhS2V5PWIubWV0YUtleSxlLmN0cmxLZXk9Yi5jdHJsS2V5LGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixlKSkpKX0pfSksZnVuY3Rpb24oYSl7YS52YWthdGEuaHRtbD17ZGl2OmEoXCI8ZGl2IC8+XCIpLGVzY2FwZTpmdW5jdGlvbihiKXtyZXR1cm4gYS52YWthdGEuaHRtbC5kaXYudGV4dChiKS5odG1sKCl9LHN0cmlwOmZ1bmN0aW9uKGIpe3JldHVybiBhLnZha2F0YS5odG1sLmRpdi5lbXB0eSgpLmFwcGVuZChhLnBhcnNlSFRNTChiKSkudGV4dCgpfX07dmFyIGM9e2VsZW1lbnQ6ITEsdGFyZ2V0OiExLGlzX2Rvd246ITEsaXNfZHJhZzohMSxoZWxwZXI6ITEsaGVscGVyX3c6MCxkYXRhOiExLGluaXRfeDowLGluaXRfeTowLHNjcm9sbF9sOjAsc2Nyb2xsX3Q6MCxzY3JvbGxfZTohMSxzY3JvbGxfaTohMSxpc190b3VjaDohMX07YS52YWthdGEuZG5kPXtzZXR0aW5nczp7c2Nyb2xsX3NwZWVkOjEwLHNjcm9sbF9wcm94aW1pdHk6MjAsaGVscGVyX2xlZnQ6NSxoZWxwZXJfdG9wOjEwLHRocmVzaG9sZDo1LHRocmVzaG9sZF90b3VjaDo1MH0sX3RyaWdnZXI6ZnVuY3Rpb24oYyxkLGUpe2U9PT1iJiYoZT1hLnZha2F0YS5kbmQuX2dldCgpKSxlLmV2ZW50PWQsYShpKS50cmlnZ2VySGFuZGxlcihcImRuZF9cIitjK1wiLnZha2F0YVwiLGUpfSxfZ2V0OmZ1bmN0aW9uKCl7cmV0dXJue2RhdGE6Yy5kYXRhLGVsZW1lbnQ6Yy5lbGVtZW50LGhlbHBlcjpjLmhlbHBlcn19LF9jbGVhbjpmdW5jdGlvbigpe2MuaGVscGVyJiZjLmhlbHBlci5yZW1vdmUoKSxjLnNjcm9sbF9pJiYoY2xlYXJJbnRlcnZhbChjLnNjcm9sbF9pKSxjLnNjcm9sbF9pPSExKSxjPXtlbGVtZW50OiExLHRhcmdldDohMSxpc19kb3duOiExLGlzX2RyYWc6ITEsaGVscGVyOiExLGhlbHBlcl93OjAsZGF0YTohMSxpbml0X3g6MCxpbml0X3k6MCxzY3JvbGxfbDowLHNjcm9sbF90OjAsc2Nyb2xsX2U6ITEsc2Nyb2xsX2k6ITEsaXNfdG91Y2g6ITF9LGEoaSkub2ZmKFwibW91c2Vtb3ZlLnZha2F0YS5qc3RyZWUgdG91Y2htb3ZlLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuZHJhZyksYShpKS5vZmYoXCJtb3VzZXVwLnZha2F0YS5qc3RyZWUgdG91Y2hlbmQudmFrYXRhLmpzdHJlZVwiLGEudmFrYXRhLmRuZC5zdG9wKX0sX3Njcm9sbDpmdW5jdGlvbihiKXtpZighYy5zY3JvbGxfZXx8IWMuc2Nyb2xsX2wmJiFjLnNjcm9sbF90KXJldHVybiBjLnNjcm9sbF9pJiYoY2xlYXJJbnRlcnZhbChjLnNjcm9sbF9pKSxjLnNjcm9sbF9pPSExKSwhMTtpZighYy5zY3JvbGxfaSlyZXR1cm4gYy5zY3JvbGxfaT1zZXRJbnRlcnZhbChhLnZha2F0YS5kbmQuX3Njcm9sbCwxMDApLCExO2lmKGI9PT0hMClyZXR1cm4hMTt2YXIgZD1jLnNjcm9sbF9lLnNjcm9sbFRvcCgpLGU9Yy5zY3JvbGxfZS5zY3JvbGxMZWZ0KCk7Yy5zY3JvbGxfZS5zY3JvbGxUb3AoZCtjLnNjcm9sbF90KmEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfc3BlZWQpLGMuc2Nyb2xsX2Uuc2Nyb2xsTGVmdChlK2Muc2Nyb2xsX2wqYS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9zcGVlZCksZD09PWMuc2Nyb2xsX2Uuc2Nyb2xsVG9wKCkmJmU9PT1jLnNjcm9sbF9lLnNjcm9sbExlZnQoKXx8YS52YWthdGEuZG5kLl90cmlnZ2VyKFwic2Nyb2xsXCIsYy5zY3JvbGxfZSl9LHN0YXJ0OmZ1bmN0aW9uKGIsZCxlKXtcInRvdWNoc3RhcnRcIj09PWIudHlwZSYmYi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGIucGFnZVg9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGIucGFnZVk9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGIudGFyZ2V0PWkuZWxlbWVudEZyb21Qb2ludChiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSxjLmlzX2RyYWcmJmEudmFrYXRhLmRuZC5zdG9wKHt9KTt0cnl7Yi5jdXJyZW50VGFyZ2V0LnVuc2VsZWN0YWJsZT1cIm9uXCIsYi5jdXJyZW50VGFyZ2V0Lm9uc2VsZWN0c3RhcnQ9ZnVuY3Rpb24oKXtyZXR1cm4hMX0sYi5jdXJyZW50VGFyZ2V0LnN0eWxlJiYoYi5jdXJyZW50VGFyZ2V0LnN0eWxlLnRvdWNoQWN0aW9uPVwibm9uZVwiLGIuY3VycmVudFRhcmdldC5zdHlsZS5tc1RvdWNoQWN0aW9uPVwibm9uZVwiLGIuY3VycmVudFRhcmdldC5zdHlsZS5Nb3pVc2VyU2VsZWN0PVwibm9uZVwiKX1jYXRjaChmKXt9cmV0dXJuIGMuaW5pdF94PWIucGFnZVgsYy5pbml0X3k9Yi5wYWdlWSxjLmRhdGE9ZCxjLmlzX2Rvd249ITAsYy5lbGVtZW50PWIuY3VycmVudFRhcmdldCxjLnRhcmdldD1iLnRhcmdldCxjLmlzX3RvdWNoPVwidG91Y2hzdGFydFwiPT09Yi50eXBlLGUhPT0hMSYmKGMuaGVscGVyPWEoXCI8ZGl2IGlkPSd2YWthdGEtZG5kJz48L2Rpdj5cIikuaHRtbChlKS5jc3Moe2Rpc3BsYXk6XCJibG9ja1wiLG1hcmdpbjpcIjBcIixwYWRkaW5nOlwiMFwiLHBvc2l0aW9uOlwiYWJzb2x1dGVcIix0b3A6XCItMjAwMHB4XCIsbGluZUhlaWdodDpcIjE2cHhcIix6SW5kZXg6XCIxMDAwMFwifSkpLGEoaSkub24oXCJtb3VzZW1vdmUudmFrYXRhLmpzdHJlZSB0b3VjaG1vdmUudmFrYXRhLmpzdHJlZVwiLGEudmFrYXRhLmRuZC5kcmFnKSxhKGkpLm9uKFwibW91c2V1cC52YWthdGEuanN0cmVlIHRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuc3RvcCksITF9LGRyYWc6ZnVuY3Rpb24oYil7aWYoXCJ0b3VjaG1vdmVcIj09PWIudHlwZSYmYi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGIucGFnZVg9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGIucGFnZVk9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGIudGFyZ2V0PWkuZWxlbWVudEZyb21Qb2ludChiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSxjLmlzX2Rvd24pe2lmKCFjLmlzX2RyYWcpe2lmKCEoTWF0aC5hYnMoYi5wYWdlWC1jLmluaXRfeCk+KGMuaXNfdG91Y2g/YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZF90b3VjaDphLnZha2F0YS5kbmQuc2V0dGluZ3MudGhyZXNob2xkKXx8TWF0aC5hYnMoYi5wYWdlWS1jLmluaXRfeSk+KGMuaXNfdG91Y2g/YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZF90b3VjaDphLnZha2F0YS5kbmQuc2V0dGluZ3MudGhyZXNob2xkKSkpcmV0dXJuO2MuaGVscGVyJiYoYy5oZWxwZXIuYXBwZW5kVG8oXCJib2R5XCIpLGMuaGVscGVyX3c9Yy5oZWxwZXIub3V0ZXJXaWR0aCgpKSxjLmlzX2RyYWc9ITAsYS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RhcnRcIixiKX12YXIgZD0hMSxlPSExLGY9ITEsZz0hMSxoPSExLGo9ITEsaz0hMSxsPSExLG09ITEsbj0hMTtyZXR1cm4gYy5zY3JvbGxfdD0wLGMuc2Nyb2xsX2w9MCxjLnNjcm9sbF9lPSExLGEoYShiLnRhcmdldCkucGFyZW50c1VudGlsKFwiYm9keVwiKS5hZGRCYWNrKCkuZ2V0KCkucmV2ZXJzZSgpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vXmF1dG98c2Nyb2xsJC8udGVzdChhKHRoaXMpLmNzcyhcIm92ZXJmbG93XCIpKSYmKHRoaXMuc2Nyb2xsSGVpZ2h0PnRoaXMub2Zmc2V0SGVpZ2h0fHx0aGlzLnNjcm9sbFdpZHRoPnRoaXMub2Zmc2V0V2lkdGgpfSkuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLm9mZnNldCgpO3JldHVybiB0aGlzLnNjcm9sbEhlaWdodD50aGlzLm9mZnNldEhlaWdodCYmKGUudG9wK2QuaGVpZ2h0KCktYi5wYWdlWTxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9MSksYi5wYWdlWS1lLnRvcDxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9LTEpKSx0aGlzLnNjcm9sbFdpZHRoPnRoaXMub2Zmc2V0V2lkdGgmJihlLmxlZnQrZC53aWR0aCgpLWIucGFnZVg8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF9sPTEpLGIucGFnZVgtZS5sZWZ0PGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfbD0tMSkpLGMuc2Nyb2xsX3R8fGMuc2Nyb2xsX2w/KGMuc2Nyb2xsX2U9YSh0aGlzKSwhMSk6dm9pZCAwfSksYy5zY3JvbGxfZXx8KGQ9YShpKSxlPWEod2luZG93KSxmPWQuaGVpZ2h0KCksZz1lLmhlaWdodCgpLGg9ZC53aWR0aCgpLGo9ZS53aWR0aCgpLGs9ZC5zY3JvbGxUb3AoKSxsPWQuc2Nyb2xsTGVmdCgpLGY+ZyYmYi5wYWdlWS1rPGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfdD0tMSksZj5nJiZnLShiLnBhZ2VZLWspPGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfdD0xKSxoPmomJmIucGFnZVgtbDxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX2w9LTEpLGg+aiYmai0oYi5wYWdlWC1sKTxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX2w9MSksKGMuc2Nyb2xsX3R8fGMuc2Nyb2xsX2wpJiYoYy5zY3JvbGxfZT1kKSksYy5zY3JvbGxfZSYmYS52YWthdGEuZG5kLl9zY3JvbGwoITApLGMuaGVscGVyJiYobT1wYXJzZUludChiLnBhZ2VZK2EudmFrYXRhLmRuZC5zZXR0aW5ncy5oZWxwZXJfdG9wLDEwKSxuPXBhcnNlSW50KGIucGFnZVgrYS52YWthdGEuZG5kLnNldHRpbmdzLmhlbHBlcl9sZWZ0LDEwKSxmJiZtKzI1PmYmJihtPWYtNTApLGgmJm4rYy5oZWxwZXJfdz5oJiYobj1oLShjLmhlbHBlcl93KzIpKSxjLmhlbHBlci5jc3Moe2xlZnQ6bitcInB4XCIsdG9wOm0rXCJweFwifSkpLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcIm1vdmVcIixiKSwhMX19LHN0b3A6ZnVuY3Rpb24oYil7aWYoXCJ0b3VjaGVuZFwiPT09Yi50eXBlJiZiLm9yaWdpbmFsRXZlbnQmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcyYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdJiYoYi5wYWdlWD1iLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgsYi5wYWdlWT1iLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVksYi50YXJnZXQ9aS5lbGVtZW50RnJvbVBvaW50KGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWC13aW5kb3cucGFnZVhPZmZzZXQsYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLXdpbmRvdy5wYWdlWU9mZnNldCkpLGMuaXNfZHJhZylhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJzdG9wXCIsYik7ZWxzZSBpZihcInRvdWNoZW5kXCI9PT1iLnR5cGUmJmIudGFyZ2V0PT09Yy50YXJnZXQpe3ZhciBkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXthKGIudGFyZ2V0KS5jbGljaygpfSwxMDApO2EoYi50YXJnZXQpLm9uZShcImNsaWNrXCIsZnVuY3Rpb24oKXtkJiZjbGVhclRpbWVvdXQoZCl9KX1yZXR1cm4gYS52YWthdGEuZG5kLl9jbGVhbigpLCExfX19KGEpLGEuanN0cmVlLmRlZmF1bHRzLm1hc3Nsb2FkPW51bGwsYS5qc3RyZWUucGx1Z2lucy5tYXNzbG9hZD1mdW5jdGlvbihiLGMpe3RoaXMuaW5pdD1mdW5jdGlvbihhLGIpe3RoaXMuX2RhdGEubWFzc2xvYWQ9e30sYy5pbml0LmNhbGwodGhpcyxhLGIpfSx0aGlzLl9sb2FkX25vZGVzPWZ1bmN0aW9uKGIsZCxlLGYpe3ZhciBnPXRoaXMuc2V0dGluZ3MubWFzc2xvYWQsaD1KU09OLnN0cmluZ2lmeShiKSxpPVtdLGo9dGhpcy5fbW9kZWwuZGF0YSxrLGwsbTtpZighZSl7Zm9yKGs9MCxsPWIubGVuZ3RoO2w+aztrKyspaltiW2tdXSYmKGpbYltrXV0uc3RhdGUubG9hZGVkfHxqW2Jba11dLnN0YXRlLmZhaWxlZCkmJiFmfHwoaS5wdXNoKGJba10pLG09dGhpcy5nZXRfbm9kZShiW2tdLCEwKSxtJiZtLmxlbmd0aCYmbS5hZGRDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMCkpO2lmKHRoaXMuX2RhdGEubWFzc2xvYWQ9e30saS5sZW5ndGgpe2lmKGEuaXNGdW5jdGlvbihnKSlyZXR1cm4gZy5jYWxsKHRoaXMsaSxhLnByb3h5KGZ1bmN0aW9uKGEpe3ZhciBnLGg7aWYoYSlmb3IoZyBpbiBhKWEuaGFzT3duUHJvcGVydHkoZykmJih0aGlzLl9kYXRhLm1hc3Nsb2FkW2ddPWFbZ10pO2ZvcihnPTAsaD1iLmxlbmd0aDtoPmc7ZysrKW09dGhpcy5nZXRfbm9kZShiW2ddLCEwKSxtJiZtLmxlbmd0aCYmbS5yZW1vdmVDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMSk7Yy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMpKTtpZihcIm9iamVjdFwiPT10eXBlb2YgZyYmZyYmZy51cmwpcmV0dXJuIGc9YS5leHRlbmQoITAse30sZyksYS5pc0Z1bmN0aW9uKGcudXJsKSYmKGcudXJsPWcudXJsLmNhbGwodGhpcyxpKSksYS5pc0Z1bmN0aW9uKGcuZGF0YSkmJihnLmRhdGE9Zy5kYXRhLmNhbGwodGhpcyxpKSksYS5hamF4KGcpLmRvbmUoYS5wcm94eShmdW5jdGlvbihhLGcsaCl7dmFyIGksajtpZihhKWZvcihpIGluIGEpYS5oYXNPd25Qcm9wZXJ0eShpKSYmKHRoaXMuX2RhdGEubWFzc2xvYWRbaV09YVtpXSk7Zm9yKGk9MCxqPWIubGVuZ3RoO2o+aTtpKyspbT10aGlzLmdldF9ub2RlKGJbaV0sITApLG0mJm0ubGVuZ3RoJiZtLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKTtjLl9sb2FkX25vZGVzLmNhbGwodGhpcyxiLGQsZSxmKX0sdGhpcykpLmZhaWwoYS5wcm94eShmdW5jdGlvbihhKXtjLl9sb2FkX25vZGVzLmNhbGwodGhpcyxiLGQsZSxmKX0sdGhpcykpfX1yZXR1cm4gYy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMuX2xvYWRfbm9kZT1mdW5jdGlvbihiLGQpe3ZhciBlPXRoaXMuX2RhdGEubWFzc2xvYWRbYi5pZF0sZj1udWxsLGc7cmV0dXJuIGU/KGY9dGhpc1tcInN0cmluZ1wiPT10eXBlb2YgZT9cIl9hcHBlbmRfaHRtbF9kYXRhXCI6XCJfYXBwZW5kX2pzb25fZGF0YVwiXShiLFwic3RyaW5nXCI9PXR5cGVvZiBlP2EoYS5wYXJzZUhUTUwoZSkpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzIT09dGhpcy5ub2RlVHlwZX0pOmUsZnVuY3Rpb24oYSl7ZC5jYWxsKHRoaXMsYSl9KSxnPXRoaXMuZ2V0X25vZGUoYi5pZCwhMCksZyYmZy5sZW5ndGgmJmcucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITEpLGRlbGV0ZSB0aGlzLl9kYXRhLm1hc3Nsb2FkW2IuaWRdLGYpOmMuX2xvYWRfbm9kZS5jYWxsKHRoaXMsYixkKX19LGEuanN0cmVlLmRlZmF1bHRzLnNlYXJjaD17YWpheDohMSxmdXp6eTohMSxjYXNlX3NlbnNpdGl2ZTohMSxzaG93X29ubHlfbWF0Y2hlczohMSxzaG93X29ubHlfbWF0Y2hlc19jaGlsZHJlbjohMSxjbG9zZV9vcGVuZWRfb25jbGVhcjohMCxzZWFyY2hfbGVhdmVzX29ubHk6ITEsc2VhcmNoX2NhbGxiYWNrOiExfSxhLmpzdHJlZS5wbHVnaW5zLnNlYXJjaD1mdW5jdGlvbihjLGQpe3RoaXMuYmluZD1mdW5jdGlvbigpe2QuYmluZC5jYWxsKHRoaXMpLHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1cIlwiLHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1hKCksdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5zb209ITEsdGhpcy5fZGF0YS5zZWFyY2guc21jPSExLHRoaXMuX2RhdGEuc2VhcmNoLmhkbj1bXSx0aGlzLmVsZW1lbnQub24oXCJzZWFyY2guanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe2lmKHRoaXMuX2RhdGEuc2VhcmNoLnNvbSYmYy5yZXMubGVuZ3RoKXt2YXIgZD10aGlzLl9tb2RlbC5kYXRhLGUsZixnPVtdLGgsaTtmb3IoZT0wLGY9Yy5yZXMubGVuZ3RoO2Y+ZTtlKyspaWYoZFtjLnJlc1tlXV0mJiFkW2MucmVzW2VdXS5zdGF0ZS5oaWRkZW4mJihnLnB1c2goYy5yZXNbZV0pLGc9Zy5jb25jYXQoZFtjLnJlc1tlXV0ucGFyZW50cyksdGhpcy5fZGF0YS5zZWFyY2guc21jKSlmb3IoaD0wLGk9ZFtjLnJlc1tlXV0uY2hpbGRyZW5fZC5sZW5ndGg7aT5oO2grKylkW2RbYy5yZXNbZV1dLmNoaWxkcmVuX2RbaF1dJiYhZFtkW2MucmVzW2VdXS5jaGlsZHJlbl9kW2hdXS5zdGF0ZS5oaWRkZW4mJmcucHVzaChkW2MucmVzW2VdXS5jaGlsZHJlbl9kW2hdKTtnPWEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKGEudmFrYXRhLmFycmF5X3VuaXF1ZShnKSxhLmpzdHJlZS5yb290KSx0aGlzLl9kYXRhLnNlYXJjaC5oZG49dGhpcy5oaWRlX2FsbCghMCksdGhpcy5zaG93X25vZGUoZywhMCksdGhpcy5yZWRyYXcoITApfX0sdGhpcykpLm9uKFwiY2xlYXJfc2VhcmNoLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLl9kYXRhLnNlYXJjaC5zb20mJmIucmVzLmxlbmd0aCYmKHRoaXMuc2hvd19ub2RlKHRoaXMuX2RhdGEuc2VhcmNoLmhkbiwhMCksdGhpcy5yZWRyYXcoITApKX0sdGhpcykpfSx0aGlzLnNlYXJjaD1mdW5jdGlvbihjLGQsZSxmLGcsaCl7aWYoYz09PSExfHxcIlwiPT09YS50cmltKGMudG9TdHJpbmcoKSkpcmV0dXJuIHRoaXMuY2xlYXJfc2VhcmNoKCk7Zj10aGlzLmdldF9ub2RlKGYpLGY9ZiYmZi5pZD9mLmlkOm51bGwsYz1jLnRvU3RyaW5nKCk7dmFyIGk9dGhpcy5zZXR0aW5ncy5zZWFyY2gsaj1pLmFqYXg/aS5hamF4OiExLGs9dGhpcy5fbW9kZWwuZGF0YSxsPW51bGwsbT1bXSxuPVtdLG8scDtpZih0aGlzLl9kYXRhLnNlYXJjaC5yZXMubGVuZ3RoJiYhZyYmdGhpcy5jbGVhcl9zZWFyY2goKSxlPT09YiYmKGU9aS5zaG93X29ubHlfbWF0Y2hlcyksaD09PWImJihoPWkuc2hvd19vbmx5X21hdGNoZXNfY2hpbGRyZW4pLCFkJiZqIT09ITEpcmV0dXJuIGEuaXNGdW5jdGlvbihqKT9qLmNhbGwodGhpcyxjLGEucHJveHkoZnVuY3Rpb24oYil7YiYmYi5kJiYoYj1iLmQpLHRoaXMuX2xvYWRfbm9kZXMoYS5pc0FycmF5KGIpP2EudmFrYXRhLmFycmF5X3VuaXF1ZShiKTpbXSxmdW5jdGlvbigpe3RoaXMuc2VhcmNoKGMsITAsZSxmLGcpfSl9LHRoaXMpLGYpOihqPWEuZXh0ZW5kKHt9LGopLGouZGF0YXx8KGouZGF0YT17fSksai5kYXRhLnN0cj1jLGYmJihqLmRhdGEuaW5zaWRlPWYpLGEuYWpheChqKS5mYWlsKGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwic2VhcmNoXCIsaWQ6XCJzZWFyY2hfMDFcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBzZWFyY2ggcGFyZW50c1wiLGRhdGE6SlNPTi5zdHJpbmdpZnkoail9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpfSx0aGlzKSkuZG9uZShhLnByb3h5KGZ1bmN0aW9uKGIpe2ImJmIuZCYmKGI9Yi5kKSx0aGlzLl9sb2FkX25vZGVzKGEuaXNBcnJheShiKT9hLnZha2F0YS5hcnJheV91bmlxdWUoYik6W10sZnVuY3Rpb24oKXt0aGlzLnNlYXJjaChjLCEwLGUsZixnKX0pfSx0aGlzKSkpO2lmKGd8fCh0aGlzLl9kYXRhLnNlYXJjaC5zdHI9Yyx0aGlzLl9kYXRhLnNlYXJjaC5kb209YSgpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guc29tPWUsdGhpcy5fZGF0YS5zZWFyY2guc21jPWgpLGw9bmV3IGEudmFrYXRhLnNlYXJjaChjLCEwLHtjYXNlU2Vuc2l0aXZlOmkuY2FzZV9zZW5zaXRpdmUsZnV6enk6aS5mdXp6eX0pLGEuZWFjaChrW2Y/ZjphLmpzdHJlZS5yb290XS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGEsYil7dmFyIGQ9a1tiXTtkLnRleHQmJiFkLnN0YXRlLmhpZGRlbiYmKCFpLnNlYXJjaF9sZWF2ZXNfb25seXx8ZC5zdGF0ZS5sb2FkZWQmJjA9PT1kLmNoaWxkcmVuLmxlbmd0aCkmJihpLnNlYXJjaF9jYWxsYmFjayYmaS5zZWFyY2hfY2FsbGJhY2suY2FsbCh0aGlzLGMsZCl8fCFpLnNlYXJjaF9jYWxsYmFjayYmbC5zZWFyY2goZC50ZXh0KS5pc01hdGNoKSYmKG0ucHVzaChiKSxuPW4uY29uY2F0KGQucGFyZW50cykpfSksbS5sZW5ndGgpe2ZvcihuPWEudmFrYXRhLmFycmF5X3VuaXF1ZShuKSxvPTAscD1uLmxlbmd0aDtwPm87bysrKW5bb10hPT1hLmpzdHJlZS5yb290JiZrW25bb11dJiZ0aGlzLm9wZW5fbm9kZShuW29dLG51bGwsMCk9PT0hMCYmdGhpcy5fZGF0YS5zZWFyY2gub3BuLnB1c2gobltvXSk7Zz8odGhpcy5fZGF0YS5zZWFyY2guZG9tPXRoaXMuX2RhdGEuc2VhcmNoLmRvbS5hZGQoYSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIithLm1hcChtLGZ1bmN0aW9uKGIpe3JldHVybi0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZihiWzBdKT9cIlxcXFwzXCIrYlswXStcIiBcIitiLnN1YnN0cigxKS5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6Yi5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIil9KS5qb2luKFwiLCAjXCIpKSkpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1hLnZha2F0YS5hcnJheV91bmlxdWUodGhpcy5fZGF0YS5zZWFyY2gucmVzLmNvbmNhdChtKSkpOih0aGlzLl9kYXRhLnNlYXJjaC5kb209YSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIithLm1hcChtLGZ1bmN0aW9uKGIpe3JldHVybi0xIT09XCIwMTIzNDU2Nzg5XCIuaW5kZXhPZihiWzBdKT9cIlxcXFwzXCIrYlswXStcIiBcIitiLnN1YnN0cigxKS5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIik6Yi5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIil9KS5qb2luKFwiLCAjXCIpKSksdGhpcy5fZGF0YS5zZWFyY2gucmVzPW0pLHRoaXMuX2RhdGEuc2VhcmNoLmRvbS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLXNlYXJjaFwiKX10aGlzLnRyaWdnZXIoXCJzZWFyY2hcIix7bm9kZXM6dGhpcy5fZGF0YS5zZWFyY2guZG9tLHN0cjpjLHJlczp0aGlzLl9kYXRhLnNlYXJjaC5yZXMsc2hvd19vbmx5X21hdGNoZXM6ZX0pfSx0aGlzLmNsZWFyX3NlYXJjaD1mdW5jdGlvbigpe3RoaXMuc2V0dGluZ3Muc2VhcmNoLmNsb3NlX29wZW5lZF9vbmNsZWFyJiZ0aGlzLmNsb3NlX25vZGUodGhpcy5fZGF0YS5zZWFyY2gub3BuLDApLHRoaXMudHJpZ2dlcihcImNsZWFyX3NlYXJjaFwiLHtub2Rlczp0aGlzLl9kYXRhLnNlYXJjaC5kb20sc3RyOnRoaXMuX2RhdGEuc2VhcmNoLnN0cixyZXM6dGhpcy5fZGF0YS5zZWFyY2gucmVzfSksdGhpcy5fZGF0YS5zZWFyY2gucmVzLmxlbmd0aCYmKHRoaXMuX2RhdGEuc2VhcmNoLmRvbT1hKHRoaXMuZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yQWxsKFwiI1wiK2EubWFwKHRoaXMuX2RhdGEuc2VhcmNoLnJlcyxmdW5jdGlvbihiKXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoYlswXSk/XCJcXFxcM1wiK2JbMF0rXCIgXCIrYi5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmIucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpLHRoaXMuX2RhdGEuc2VhcmNoLmRvbS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXNlYXJjaFwiKSksdGhpcy5fZGF0YS5zZWFyY2guc3RyPVwiXCIsdGhpcy5fZGF0YS5zZWFyY2gucmVzPVtdLHRoaXMuX2RhdGEuc2VhcmNoLm9wbj1bXSx0aGlzLl9kYXRhLnNlYXJjaC5kb209YSgpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGIsYyxlLGYpe2lmKGI9ZC5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYiYmLTEhPT1hLmluQXJyYXkoYi5pZCx0aGlzLl9kYXRhLnNlYXJjaC5yZXMpKXt2YXIgZyxoLGk9bnVsbDtmb3IoZz0wLGg9Yi5jaGlsZE5vZGVzLmxlbmd0aDtoPmc7ZysrKWlmKGIuY2hpbGROb2Rlc1tnXSYmYi5jaGlsZE5vZGVzW2ddLmNsYXNzTmFtZSYmLTEhPT1iLmNoaWxkTm9kZXNbZ10uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtYW5jaG9yXCIpKXtpPWIuY2hpbGROb2Rlc1tnXTticmVha31pJiYoaS5jbGFzc05hbWUrPVwiIGpzdHJlZS1zZWFyY2hcIil9cmV0dXJuIGJ9fSxmdW5jdGlvbihhKXthLnZha2F0YS5zZWFyY2g9ZnVuY3Rpb24oYixjLGQpe2Q9ZHx8e30sZD1hLmV4dGVuZCh7fSxhLnZha2F0YS5zZWFyY2guZGVmYXVsdHMsZCksZC5mdXp6eSE9PSExJiYoZC5mdXp6eT0hMCksYj1kLmNhc2VTZW5zaXRpdmU/YjpiLnRvTG93ZXJDYXNlKCk7dmFyIGU9ZC5sb2NhdGlvbixmPWQuZGlzdGFuY2UsZz1kLnRocmVzaG9sZCxoPWIubGVuZ3RoLGksaixrLGw7cmV0dXJuIGg+MzImJihkLmZ1enp5PSExKSxkLmZ1enp5JiYoaT0xPDxoLTEsaj1mdW5jdGlvbigpe3ZhciBhPXt9LGM9MDtmb3IoYz0wO2g+YztjKyspYVtiLmNoYXJBdChjKV09MDtmb3IoYz0wO2g+YztjKyspYVtiLmNoYXJBdChjKV18PTE8PGgtYy0xO3JldHVybiBhfSgpLGs9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hL2gsZD1NYXRoLmFicyhlLWIpO3JldHVybiBmP2MrZC9mOmQ/MTpjfSksbD1mdW5jdGlvbihhKXtpZihhPWQuY2FzZVNlbnNpdGl2ZT9hOmEudG9Mb3dlckNhc2UoKSxiPT09YXx8LTEhPT1hLmluZGV4T2YoYikpcmV0dXJue2lzTWF0Y2g6ITAsc2NvcmU6MH07aWYoIWQuZnV6enkpcmV0dXJue2lzTWF0Y2g6ITEsc2NvcmU6MX07dmFyIGMsZixsPWEubGVuZ3RoLG09ZyxuPWEuaW5kZXhPZihiLGUpLG8scCxxPWgrbCxyLHMsdCx1LHYsdz0xLHg9W107Zm9yKC0xIT09biYmKG09TWF0aC5taW4oaygwLG4pLG0pLG49YS5sYXN0SW5kZXhPZihiLGUraCksLTEhPT1uJiYobT1NYXRoLm1pbihrKDAsbiksbSkpKSxuPS0xLGM9MDtoPmM7YysrKXtvPTAscD1xO3doaWxlKHA+bylrKGMsZStwKTw9bT9vPXA6cT1wLHA9TWF0aC5mbG9vcigocS1vKS8yK28pO2ZvcihxPXAscz1NYXRoLm1heCgxLGUtcCsxKSx0PU1hdGgubWluKGUrcCxsKStoLHU9bmV3IEFycmF5KHQrMiksdVt0KzFdPSgxPDxjKS0xLGY9dDtmPj1zO2YtLSlpZih2PWpbYS5jaGFyQXQoZi0xKV0sMD09PWM/dVtmXT0odVtmKzFdPDwxfDEpJnY6dVtmXT0odVtmKzFdPDwxfDEpJnZ8KChyW2YrMV18cltmXSk8PDF8MSl8cltmKzFdLHVbZl0maSYmKHc9ayhjLGYtMSksbT49dykpe2lmKG09dyxuPWYtMSx4LnB1c2gobiksIShuPmUpKWJyZWFrO3M9TWF0aC5tYXgoMSwyKmUtbil9aWYoayhjKzEsZSk+bSlicmVhaztyPXV9cmV0dXJue2lzTWF0Y2g6bj49MCxzY29yZTp3fX0sYz09PSEwP3tzZWFyY2g6bH06bChjKX0sYS52YWthdGEuc2VhcmNoLmRlZmF1bHRzPXtsb2NhdGlvbjowLGRpc3RhbmNlOjEwMCx0aHJlc2hvbGQ6LjYsZnV6enk6ITEsY2FzZVNlbnNpdGl2ZTohMX19KGEpLGEuanN0cmVlLmRlZmF1bHRzLnNvcnQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5nZXRfdGV4dChhKT50aGlzLmdldF90ZXh0KGIpPzE6LTF9LGEuanN0cmVlLnBsdWdpbnMuc29ydD1mdW5jdGlvbihiLGMpe3RoaXMuYmluZD1mdW5jdGlvbigpe2MuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLnNvcnQoYi5wYXJlbnQsITApfSx0aGlzKSkub24oXCJyZW5hbWVfbm9kZS5qc3RyZWUgY3JlYXRlX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuc29ydChiLnBhcmVudHx8Yi5ub2RlLnBhcmVudCwhMSksdGhpcy5yZWRyYXdfbm9kZShiLnBhcmVudHx8Yi5ub2RlLnBhcmVudCwhMCl9LHRoaXMpKS5vbihcIm1vdmVfbm9kZS5qc3RyZWUgY29weV9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLnNvcnQoYi5wYXJlbnQsITEpLHRoaXMucmVkcmF3X25vZGUoYi5wYXJlbnQsITApfSx0aGlzKSl9LHRoaXMuc29ydD1mdW5jdGlvbihiLGMpe3ZhciBkLGU7aWYoYj10aGlzLmdldF9ub2RlKGIpLGImJmIuY2hpbGRyZW4mJmIuY2hpbGRyZW4ubGVuZ3RoJiYoYi5jaGlsZHJlbi5zb3J0KGEucHJveHkodGhpcy5zZXR0aW5ncy5zb3J0LHRoaXMpKSxjKSlmb3IoZD0wLGU9Yi5jaGlsZHJlbl9kLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuc29ydChiLmNoaWxkcmVuX2RbZF0sITEpfX07dmFyIHA9ITE7YS5qc3RyZWUuZGVmYXVsdHMuc3RhdGU9e2tleTpcImpzdHJlZVwiLGV2ZW50czpcImNoYW5nZWQuanN0cmVlIG9wZW5fbm9kZS5qc3RyZWUgY2xvc2Vfbm9kZS5qc3RyZWUgY2hlY2tfbm9kZS5qc3RyZWUgdW5jaGVja19ub2RlLmpzdHJlZVwiLHR0bDohMSxmaWx0ZXI6ITF9LGEuanN0cmVlLnBsdWdpbnMuc3RhdGU9ZnVuY3Rpb24oYixjKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtjLmJpbmQuY2FsbCh0aGlzKTt2YXIgYj1hLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9uKHRoaXMuc2V0dGluZ3Muc3RhdGUuZXZlbnRzLGEucHJveHkoZnVuY3Rpb24oKXtwJiZjbGVhclRpbWVvdXQocCkscD1zZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLnNhdmVfc3RhdGUoKX0sdGhpcyksMTAwKX0sdGhpcykpLHRoaXMudHJpZ2dlcihcInN0YXRlX3JlYWR5XCIpfSx0aGlzKTt0aGlzLmVsZW1lbnQub24oXCJyZWFkeS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYyl7dGhpcy5lbGVtZW50Lm9uZShcInJlc3RvcmVfc3RhdGUuanN0cmVlXCIsYiksdGhpcy5yZXN0b3JlX3N0YXRlKCl8fGIoKX0sdGhpcykpfSx0aGlzLnNhdmVfc3RhdGU9ZnVuY3Rpb24oKXt2YXIgYj17c3RhdGU6dGhpcy5nZXRfc3RhdGUoKSx0dGw6dGhpcy5zZXR0aW5ncy5zdGF0ZS50dGwsc2VjOituZXcgRGF0ZX07YS52YWthdGEuc3RvcmFnZS5zZXQodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXksSlNPTi5zdHJpbmdpZnkoYikpfSx0aGlzLnJlc3RvcmVfc3RhdGU9ZnVuY3Rpb24oKXt2YXIgYj1hLnZha2F0YS5zdG9yYWdlLmdldCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSk7aWYoYil0cnl7Yj1KU09OLnBhcnNlKGIpfWNhdGNoKGMpe3JldHVybiExfXJldHVybiBiJiZiLnR0bCYmYi5zZWMmJituZXcgRGF0ZS1iLnNlYz5iLnR0bD8hMTooYiYmYi5zdGF0ZSYmKGI9Yi5zdGF0ZSksYiYmYS5pc0Z1bmN0aW9uKHRoaXMuc2V0dGluZ3Muc3RhdGUuZmlsdGVyKSYmKGI9dGhpcy5zZXR0aW5ncy5zdGF0ZS5maWx0ZXIuY2FsbCh0aGlzLGIpKSxiPyh0aGlzLmVsZW1lbnQub25lKFwic2V0X3N0YXRlLmpzdHJlZVwiLGZ1bmN0aW9uKGMsZCl7ZC5pbnN0YW5jZS50cmlnZ2VyKFwicmVzdG9yZV9zdGF0ZVwiLHtzdGF0ZTphLmV4dGVuZCghMCx7fSxiKX0pfSksdGhpcy5zZXRfc3RhdGUoYiksITApOiExKX0sdGhpcy5jbGVhcl9zdGF0ZT1mdW5jdGlvbigpe3JldHVybiBhLnZha2F0YS5zdG9yYWdlLmRlbCh0aGlzLnNldHRpbmdzLnN0YXRlLmtleSl9fSxmdW5jdGlvbihhLGIpe2EudmFrYXRhLnN0b3JhZ2U9e3NldDpmdW5jdGlvbihhLGIpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oYSxiKX0sZ2V0OmZ1bmN0aW9uKGEpe3JldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oYSl9LGRlbDpmdW5jdGlvbihhKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGEpfX19KGEpLGEuanN0cmVlLmRlZmF1bHRzLnR5cGVzPXtcImRlZmF1bHRcIjp7fX0sYS5qc3RyZWUuZGVmYXVsdHMudHlwZXNbYS5qc3RyZWUucm9vdF09e30sYS5qc3RyZWUucGx1Z2lucy50eXBlcz1mdW5jdGlvbihjLGQpe3RoaXMuaW5pdD1mdW5jdGlvbihjLGUpe3ZhciBmLGc7aWYoZSYmZS50eXBlcyYmZS50eXBlc1tcImRlZmF1bHRcIl0pZm9yKGYgaW4gZS50eXBlcylpZihcImRlZmF1bHRcIiE9PWYmJmYhPT1hLmpzdHJlZS5yb290JiZlLnR5cGVzLmhhc093blByb3BlcnR5KGYpKWZvcihnIGluIGUudHlwZXNbXCJkZWZhdWx0XCJdKWUudHlwZXNbXCJkZWZhdWx0XCJdLmhhc093blByb3BlcnR5KGcpJiZlLnR5cGVzW2ZdW2ddPT09YiYmKGUudHlwZXNbZl1bZ109ZS50eXBlc1tcImRlZmF1bHRcIl1bZ10pO2QuaW5pdC5jYWxsKHRoaXMsYyxlKSx0aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLnR5cGU9YS5qc3RyZWUucm9vdH0sdGhpcy5yZWZyZXNoPWZ1bmN0aW9uKGIsYyl7ZC5yZWZyZXNoLmNhbGwodGhpcyxiLGMpLHRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0udHlwZT1hLmpzdHJlZS5yb290fSx0aGlzLmJpbmQ9ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGMsZCl7dmFyIGU9dGhpcy5fbW9kZWwuZGF0YSxmPWQubm9kZXMsZz10aGlzLnNldHRpbmdzLnR5cGVzLGgsaSxqPVwiZGVmYXVsdFwiLGs7Zm9yKGg9MCxpPWYubGVuZ3RoO2k+aDtoKyspe2lmKGo9XCJkZWZhdWx0XCIsZVtmW2hdXS5vcmlnaW5hbCYmZVtmW2hdXS5vcmlnaW5hbC50eXBlJiZnW2VbZltoXV0ub3JpZ2luYWwudHlwZV0mJihqPWVbZltoXV0ub3JpZ2luYWwudHlwZSksZVtmW2hdXS5kYXRhJiZlW2ZbaF1dLmRhdGEuanN0cmVlJiZlW2ZbaF1dLmRhdGEuanN0cmVlLnR5cGUmJmdbZVtmW2hdXS5kYXRhLmpzdHJlZS50eXBlXSYmKGo9ZVtmW2hdXS5kYXRhLmpzdHJlZS50eXBlKSxlW2ZbaF1dLnR5cGU9aixlW2ZbaF1dLmljb249PT0hMCYmZ1tqXS5pY29uIT09YiYmKGVbZltoXV0uaWNvbj1nW2pdLmljb24pLGdbal0ubGlfYXR0ciE9PWImJlwib2JqZWN0XCI9PXR5cGVvZiBnW2pdLmxpX2F0dHIpZm9yKGsgaW4gZ1tqXS5saV9hdHRyKWlmKGdbal0ubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShrKSl7aWYoXCJpZFwiPT09ayljb250aW51ZTtlW2ZbaF1dLmxpX2F0dHJba109PT1iP2VbZltoXV0ubGlfYXR0cltrXT1nW2pdLmxpX2F0dHJba106XCJjbGFzc1wiPT09ayYmKGVbZltoXV0ubGlfYXR0cltcImNsYXNzXCJdPWdbal0ubGlfYXR0cltcImNsYXNzXCJdK1wiIFwiK2VbZltoXV0ubGlfYXR0cltcImNsYXNzXCJdKX1pZihnW2pdLmFfYXR0ciE9PWImJlwib2JqZWN0XCI9PXR5cGVvZiBnW2pdLmFfYXR0cilmb3IoayBpbiBnW2pdLmFfYXR0cilpZihnW2pdLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShrKSl7aWYoXCJpZFwiPT09ayljb250aW51ZTtlW2ZbaF1dLmFfYXR0cltrXT09PWI/ZVtmW2hdXS5hX2F0dHJba109Z1tqXS5hX2F0dHJba106XCJocmVmXCI9PT1rJiZcIiNcIj09PWVbZltoXV0uYV9hdHRyW2tdP2VbZltoXV0uYV9hdHRyLmhyZWY9Z1tqXS5hX2F0dHIuaHJlZjpcImNsYXNzXCI9PT1rJiYoZVtmW2hdXS5hX2F0dHJbXCJjbGFzc1wiXT1nW2pdLmFfYXR0cltcImNsYXNzXCJdK1wiIFwiK2VbZltoXV0uYV9hdHRyW1wiY2xhc3NcIl0pfX1lW2EuanN0cmVlLnJvb3RdLnR5cGU9YS5qc3RyZWUucm9vdH0sdGhpcykpLGQuYmluZC5jYWxsKHRoaXMpfSx0aGlzLmdldF9qc29uPWZ1bmN0aW9uKGIsYyxlKXt2YXIgZixnLGg9dGhpcy5fbW9kZWwuZGF0YSxpPWM/YS5leHRlbmQoITAse30sYyx7bm9faWQ6ITF9KTp7fSxqPWQuZ2V0X2pzb24uY2FsbCh0aGlzLGIsaSxlKTtpZihqPT09ITEpcmV0dXJuITE7aWYoYS5pc0FycmF5KGopKWZvcihmPTAsZz1qLmxlbmd0aDtnPmY7ZisrKWpbZl0udHlwZT1qW2ZdLmlkJiZoW2pbZl0uaWRdJiZoW2pbZl0uaWRdLnR5cGU/aFtqW2ZdLmlkXS50eXBlOlwiZGVmYXVsdFwiLGMmJmMubm9faWQmJihkZWxldGUgaltmXS5pZCxqW2ZdLmxpX2F0dHImJmpbZl0ubGlfYXR0ci5pZCYmZGVsZXRlIGpbZl0ubGlfYXR0ci5pZCxqW2ZdLmFfYXR0ciYmaltmXS5hX2F0dHIuaWQmJmRlbGV0ZSBqW2ZdLmFfYXR0ci5pZCk7ZWxzZSBqLnR5cGU9ai5pZCYmaFtqLmlkXSYmaFtqLmlkXS50eXBlP2hbai5pZF0udHlwZTpcImRlZmF1bHRcIixjJiZjLm5vX2lkJiYoaj10aGlzLl9kZWxldGVfaWRzKGopKTtyZXR1cm4gan0sdGhpcy5fZGVsZXRlX2lkcz1mdW5jdGlvbihiKXtpZihhLmlzQXJyYXkoYikpe2Zvcih2YXIgYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyliW2NdPXRoaXMuX2RlbGV0ZV9pZHMoYltjXSk7cmV0dXJuIGJ9cmV0dXJuIGRlbGV0ZSBiLmlkLGIubGlfYXR0ciYmYi5saV9hdHRyLmlkJiZkZWxldGUgYi5saV9hdHRyLmlkLGIuYV9hdHRyJiZiLmFfYXR0ci5pZCYmZGVsZXRlIGIuYV9hdHRyLmlkLGIuY2hpbGRyZW4mJmEuaXNBcnJheShiLmNoaWxkcmVuKSYmKGIuY2hpbGRyZW49dGhpcy5fZGVsZXRlX2lkcyhiLmNoaWxkcmVuKSksYn0sdGhpcy5jaGVjaz1mdW5jdGlvbihjLGUsZixnLGgpe2lmKGQuY2hlY2suY2FsbCh0aGlzLGMsZSxmLGcsaCk9PT0hMSlyZXR1cm4hMTtlPWUmJmUuaWQ/ZTp0aGlzLmdldF9ub2RlKGUpLGY9ZiYmZi5pZD9mOnRoaXMuZ2V0X25vZGUoZik7dmFyIGk9ZSYmZS5pZD9oJiZoLm9yaWdpbj9oLm9yaWdpbjphLmpzdHJlZS5yZWZlcmVuY2UoZS5pZCk6bnVsbCxqLGssbCxtO3N3aXRjaChpPWkmJmkuX21vZGVsJiZpLl9tb2RlbC5kYXRhP2kuX21vZGVsLmRhdGE6bnVsbCxjKXtjYXNlXCJjcmVhdGVfbm9kZVwiOmNhc2VcIm1vdmVfbm9kZVwiOmNhc2VcImNvcHlfbm9kZVwiOmlmKFwibW92ZV9ub2RlXCIhPT1jfHwtMT09PWEuaW5BcnJheShlLmlkLGYuY2hpbGRyZW4pKXtpZihqPXRoaXMuZ2V0X3J1bGVzKGYpLGoubWF4X2NoaWxkcmVuIT09YiYmLTEhPT1qLm1heF9jaGlsZHJlbiYmai5tYXhfY2hpbGRyZW49PT1mLmNoaWxkcmVuLmxlbmd0aClyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ0eXBlc1wiLGlkOlwidHlwZXNfMDFcIixyZWFzb246XCJtYXhfY2hpbGRyZW4gcHJldmVudHMgZnVuY3Rpb246IFwiK2MsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmMscG9zOmcsb2JqOmUmJmUuaWQ/ZS5pZDohMSxwYXI6ZiYmZi5pZD9mLmlkOiExfSl9LCExO2lmKGoudmFsaWRfY2hpbGRyZW4hPT1iJiYtMSE9PWoudmFsaWRfY2hpbGRyZW4mJi0xPT09YS5pbkFycmF5KGUudHlwZXx8XCJkZWZhdWx0XCIsai52YWxpZF9jaGlsZHJlbikpcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAyXCIscmVhc29uOlwidmFsaWRfY2hpbGRyZW4gcHJldmVudHMgZnVuY3Rpb246IFwiK2MsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmMscG9zOmcsb2JqOmUmJmUuaWQ/ZS5pZDohMSxwYXI6ZiYmZi5pZD9mLmlkOiExfSl9LCExO2lmKGkmJmUuY2hpbGRyZW5fZCYmZS5wYXJlbnRzKXtmb3Ioaz0wLGw9MCxtPWUuY2hpbGRyZW5fZC5sZW5ndGg7bT5sO2wrKylrPU1hdGgubWF4KGssaVtlLmNoaWxkcmVuX2RbbF1dLnBhcmVudHMubGVuZ3RoKTtrPWstZS5wYXJlbnRzLmxlbmd0aCsxfSgwPj1rfHxrPT09YikmJihrPTEpO2Rve2lmKGoubWF4X2RlcHRoIT09YiYmLTEhPT1qLm1heF9kZXB0aCYmai5tYXhfZGVwdGg8aylyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ0eXBlc1wiLGlkOlwidHlwZXNfMDNcIixyZWFzb246XCJtYXhfZGVwdGggcHJldmVudHMgZnVuY3Rpb246IFwiK2MsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmMscG9zOmcsb2JqOmUmJmUuaWQ/ZS5pZDohMSxwYXI6ZiYmZi5pZD9mLmlkOiExfSl9LCExO2Y9dGhpcy5nZXRfbm9kZShmLnBhcmVudCksaj10aGlzLmdldF9ydWxlcyhmKSxrKyt9d2hpbGUoZil9fXJldHVybiEwfSx0aGlzLmdldF9ydWxlcz1mdW5jdGlvbihhKXtpZihhPXRoaXMuZ2V0X25vZGUoYSksIWEpcmV0dXJuITE7dmFyIGM9dGhpcy5nZXRfdHlwZShhLCEwKTtyZXR1cm4gYy5tYXhfZGVwdGg9PT1iJiYoYy5tYXhfZGVwdGg9LTEpLGMubWF4X2NoaWxkcmVuPT09YiYmKGMubWF4X2NoaWxkcmVuPS0xKSxjLnZhbGlkX2NoaWxkcmVuPT09YiYmKGMudmFsaWRfY2hpbGRyZW49LTEpLGN9LHRoaXMuZ2V0X3R5cGU9ZnVuY3Rpb24oYixjKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGI/Yz9hLmV4dGVuZCh7dHlwZTpiLnR5cGV9LHRoaXMuc2V0dGluZ3MudHlwZXNbYi50eXBlXSk6Yi50eXBlOiExfSx0aGlzLnNldF90eXBlPWZ1bmN0aW9uKGMsZCl7dmFyIGU9dGhpcy5fbW9kZWwuZGF0YSxmLGcsaCxpLGosayxsLG07aWYoYS5pc0FycmF5KGMpKXtmb3IoYz1jLnNsaWNlKCksZz0wLGg9Yy5sZW5ndGg7aD5nO2crKyl0aGlzLnNldF90eXBlKGNbZ10sZCk7cmV0dXJuITB9aWYoZj10aGlzLnNldHRpbmdzLnR5cGVzLGM9dGhpcy5nZXRfbm9kZShjKSwhZltkXXx8IWMpcmV0dXJuITE7aWYobD10aGlzLmdldF9ub2RlKGMsITApLGwmJmwubGVuZ3RoJiYobT1sLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikpLGk9Yy50eXBlLGo9dGhpcy5nZXRfaWNvbihjKSxjLnR5cGU9ZCwoaj09PSEwfHxmW2ldJiZmW2ldLmljb24hPT1iJiZqPT09ZltpXS5pY29uKSYmdGhpcy5zZXRfaWNvbihjLGZbZF0uaWNvbiE9PWI/ZltkXS5pY29uOiEwKSxmW2ldLmxpX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltpXS5saV9hdHRyKWZvcihrIGluIGZbaV0ubGlfYXR0cilpZihmW2ldLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7XCJjbGFzc1wiPT09az8oZVtjLmlkXS5saV9hdHRyW1wiY2xhc3NcIl09KGVbYy5pZF0ubGlfYXR0cltcImNsYXNzXCJdfHxcIlwiKS5yZXBsYWNlKGZbaV0ubGlfYXR0cltrXSxcIlwiKSxsJiZsLnJlbW92ZUNsYXNzKGZbaV0ubGlfYXR0cltrXSkpOmVbYy5pZF0ubGlfYXR0cltrXT09PWZbaV0ubGlfYXR0cltrXSYmKGVbYy5pZF0ubGlfYXR0cltrXT1udWxsLGwmJmwucmVtb3ZlQXR0cihrKSl9aWYoZltpXS5hX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltpXS5hX2F0dHIpZm9yKGsgaW4gZltpXS5hX2F0dHIpaWYoZltpXS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7XCJjbGFzc1wiPT09az8oZVtjLmlkXS5hX2F0dHJbXCJjbGFzc1wiXT0oZVtjLmlkXS5hX2F0dHJbXCJjbGFzc1wiXXx8XCJcIikucmVwbGFjZShmW2ldLmFfYXR0cltrXSxcIlwiKSxtJiZtLnJlbW92ZUNsYXNzKGZbaV0uYV9hdHRyW2tdKSk6ZVtjLmlkXS5hX2F0dHJba109PT1mW2ldLmFfYXR0cltrXSYmKFwiaHJlZlwiPT09az8oZVtjLmlkXS5hX2F0dHJba109XCIjXCIsbSYmbS5hdHRyKFwiaHJlZlwiLFwiI1wiKSk6KGRlbGV0ZSBlW2MuaWRdLmFfYXR0cltrXSxtJiZtLnJlbW92ZUF0dHIoaykpKX1pZihmW2RdLmxpX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltkXS5saV9hdHRyKWZvcihrIGluIGZbZF0ubGlfYXR0cilpZihmW2RdLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtjLmlkXS5saV9hdHRyW2tdPT09Yj8oZVtjLmlkXS5saV9hdHRyW2tdPWZbZF0ubGlfYXR0cltrXSxsJiYoXCJjbGFzc1wiPT09az9sLmFkZENsYXNzKGZbZF0ubGlfYXR0cltrXSk6bC5hdHRyKGssZltkXS5saV9hdHRyW2tdKSkpOlwiY2xhc3NcIj09PWsmJihlW2MuaWRdLmxpX2F0dHJbXCJjbGFzc1wiXT1mW2RdLmxpX2F0dHJba10rXCIgXCIrZVtjLmlkXS5saV9hdHRyW1wiY2xhc3NcIl0sbCYmbC5hZGRDbGFzcyhmW2RdLmxpX2F0dHJba10pKX1pZihmW2RdLmFfYXR0ciE9PWImJlwib2JqZWN0XCI9PXR5cGVvZiBmW2RdLmFfYXR0cilmb3IoayBpbiBmW2RdLmFfYXR0cilpZihmW2RdLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShrKSl7aWYoXCJpZFwiPT09ayljb250aW51ZTtlW2MuaWRdLmFfYXR0cltrXT09PWI/KGVbYy5pZF0uYV9hdHRyW2tdPWZbZF0uYV9hdHRyW2tdLG0mJihcImNsYXNzXCI9PT1rP20uYWRkQ2xhc3MoZltkXS5hX2F0dHJba10pOm0uYXR0cihrLGZbZF0uYV9hdHRyW2tdKSkpOlwiaHJlZlwiPT09ayYmXCIjXCI9PT1lW2MuaWRdLmFfYXR0cltrXT8oZVtjLmlkXS5hX2F0dHIuaHJlZj1mW2RdLmFfYXR0ci5ocmVmLG0mJm0uYXR0cihcImhyZWZcIixmW2RdLmFfYXR0ci5ocmVmKSk6XCJjbGFzc1wiPT09ayYmKGVbYy5pZF0uYV9hdHRyW1wiY2xhc3NcIl09ZltkXS5hX2F0dHJbXCJjbGFzc1wiXStcIiBcIitlW2MuaWRdLmFfYXR0cltcImNsYXNzXCJdLG0mJm0uYWRkQ2xhc3MoZltkXS5hX2F0dHJba10pKX1yZXR1cm4hMH19LGEuanN0cmVlLmRlZmF1bHRzLnVuaXF1ZT17Y2FzZV9zZW5zaXRpdmU6ITEsZHVwbGljYXRlOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGErXCIgKFwiK2IrXCIpXCJ9fSxhLmpzdHJlZS5wbHVnaW5zLnVuaXF1ZT1mdW5jdGlvbihjLGQpe3RoaXMuY2hlY2s9ZnVuY3Rpb24oYixjLGUsZixnKXtpZihkLmNoZWNrLmNhbGwodGhpcyxiLGMsZSxmLGcpPT09ITEpcmV0dXJuITE7aWYoYz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSxlPWUmJmUuaWQ/ZTp0aGlzLmdldF9ub2RlKGUpLCFlfHwhZS5jaGlsZHJlbilyZXR1cm4hMDt2YXIgaD1cInJlbmFtZV9ub2RlXCI9PT1iP2Y6Yy50ZXh0LGk9W10saj10aGlzLnNldHRpbmdzLnVuaXF1ZS5jYXNlX3NlbnNpdGl2ZSxrPXRoaXMuX21vZGVsLmRhdGEsbCxtO2ZvcihsPTAsbT1lLmNoaWxkcmVuLmxlbmd0aDttPmw7bCsrKWkucHVzaChqP2tbZS5jaGlsZHJlbltsXV0udGV4dDprW2UuY2hpbGRyZW5bbF1dLnRleHQudG9Mb3dlckNhc2UoKSk7c3dpdGNoKGp8fChoPWgudG9Mb3dlckNhc2UoKSksYil7Y2FzZVwiZGVsZXRlX25vZGVcIjpyZXR1cm4hMDtjYXNlXCJyZW5hbWVfbm9kZVwiOnJldHVybiBsPS0xPT09YS5pbkFycmF5KGgsaSl8fGMudGV4dCYmYy50ZXh0W2o/XCJ0b1N0cmluZ1wiOlwidG9Mb3dlckNhc2VcIl0oKT09PWgsbHx8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDFcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIraCtcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZixvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjplJiZlLmlkP2UuaWQ6ITF9KX0pLGw7Y2FzZVwiY3JlYXRlX25vZGVcIjpyZXR1cm4gbD0tMT09PWEuaW5BcnJheShoLGkpLGx8fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzA0XCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2grXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmYsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZSYmZS5pZD9lLmlkOiExfSl9KSxsO2Nhc2VcImNvcHlfbm9kZVwiOnJldHVybiBsPS0xPT09YS5pbkFycmF5KGgsaSksbHx8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDJcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIraCtcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZixvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjplJiZlLmlkP2UuaWQ6ITF9KX0pLGw7Y2FzZVwibW92ZV9ub2RlXCI6cmV0dXJuIGw9Yy5wYXJlbnQ9PT1lLmlkJiYoIWd8fCFnLmlzX211bHRpKXx8LTE9PT1hLmluQXJyYXkoaCxpKSxsfHwodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ1bmlxdWVcIixpZDpcInVuaXF1ZV8wM1wiLHJlYXNvbjpcIkNoaWxkIHdpdGggbmFtZSBcIitoK1wiIGFscmVhZHkgZXhpc3RzLiBQcmV2ZW50aW5nOiBcIitiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpiLHBvczpmLG9iajpjJiZjLmlkP2MuaWQ6ITEscGFyOmUmJmUuaWQ/ZS5pZDohMX0pfSksbH1yZXR1cm4hMH0sdGhpcy5jcmVhdGVfbm9kZT1mdW5jdGlvbihjLGUsZixnLGgpe2lmKCFlfHxlLnRleHQ9PT1iKXtpZihudWxsPT09YyYmKGM9YS5qc3RyZWUucm9vdCksYz10aGlzLmdldF9ub2RlKGMpLCFjKXJldHVybiBkLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxjLGUsZixnLGgpO2lmKGY9Zj09PWI/XCJsYXN0XCI6ZiwhZi50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFoJiYhdGhpcy5pc19sb2FkZWQoYykpcmV0dXJuIGQuY3JlYXRlX25vZGUuY2FsbCh0aGlzLGMsZSxmLGcsaCk7XG5lfHwoZT17fSk7dmFyIGksaixrLGwsbSxuPXRoaXMuX21vZGVsLmRhdGEsbz10aGlzLnNldHRpbmdzLnVuaXF1ZS5jYXNlX3NlbnNpdGl2ZSxwPXRoaXMuc2V0dGluZ3MudW5pcXVlLmR1cGxpY2F0ZTtmb3Ioaj1pPXRoaXMuZ2V0X3N0cmluZyhcIk5ldyBub2RlXCIpLGs9W10sbD0wLG09Yy5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKylrLnB1c2gobz9uW2MuY2hpbGRyZW5bbF1dLnRleHQ6bltjLmNoaWxkcmVuW2xdXS50ZXh0LnRvTG93ZXJDYXNlKCkpO2w9MTt3aGlsZSgtMSE9PWEuaW5BcnJheShvP2o6ai50b0xvd2VyQ2FzZSgpLGspKWo9cC5jYWxsKHRoaXMsaSwrK2wpLnRvU3RyaW5nKCk7ZS50ZXh0PWp9cmV0dXJuIGQuY3JlYXRlX25vZGUuY2FsbCh0aGlzLGMsZSxmLGcsaCl9fTt2YXIgcT1pLmNyZWF0ZUVsZW1lbnQoXCJESVZcIik7aWYocS5zZXRBdHRyaWJ1dGUoXCJ1bnNlbGVjdGFibGVcIixcIm9uXCIpLHEuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLHEuY2xhc3NOYW1lPVwianN0cmVlLXdob2xlcm93XCIscS5pbm5lckhUTUw9XCImIzE2MDtcIixhLmpzdHJlZS5wbHVnaW5zLndob2xlcm93PWZ1bmN0aW9uKGIsYyl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7Yy5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKFwicmVhZHkuanN0cmVlIHNldF9zdGF0ZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5oaWRlX2RvdHMoKX0sdGhpcykpLm9uKFwiaW5pdC5qc3RyZWUgbG9hZGluZy5qc3RyZWUgcmVhZHkuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LXVsXCIpfSx0aGlzKSkub24oXCJkZXNlbGVjdF9hbGwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImNoYW5nZWQuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIik7dmFyIGM9ITEsZCxlO2ZvcihkPTAsZT1iLnNlbGVjdGVkLmxlbmd0aDtlPmQ7ZCsrKWM9dGhpcy5nZXRfbm9kZShiLnNlbGVjdGVkW2RdLCEwKSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtd2hvbGVyb3dcIikuYWRkQ2xhc3MoXCJqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwib3Blbl9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLmdldF9ub2RlKGIubm9kZSwhMCkuZmluZChcIi5qc3RyZWUtY2xpY2tlZFwiKS5wYXJlbnQoKS5jaGlsZHJlbihcIi5qc3RyZWUtd2hvbGVyb3dcIikuYWRkQ2xhc3MoXCJqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKX0sdGhpcykpLm9uKFwiaG92ZXJfbm9kZS5qc3RyZWUgZGVob3Zlcl9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXtcImhvdmVyX25vZGVcIj09PWEudHlwZSYmdGhpcy5pc19kaXNhYmxlZChiLm5vZGUpfHx0aGlzLmdldF9ub2RlKGIubm9kZSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpW1wiaG92ZXJfbm9kZVwiPT09YS50eXBlP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLXdob2xlcm93LWhvdmVyZWRcIil9LHRoaXMpKS5vbihcImNvbnRleHRtZW51LmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvd1wiLGEucHJveHkoZnVuY3Rpb24oYil7aWYodGhpcy5fZGF0YS5jb250ZXh0bWVudSl7Yi5wcmV2ZW50RGVmYXVsdCgpO3ZhciBjPWEuRXZlbnQoXCJjb250ZXh0bWVudVwiLHttZXRhS2V5OmIubWV0YUtleSxjdHJsS2V5OmIuY3RybEtleSxhbHRLZXk6Yi5hbHRLZXksc2hpZnRLZXk6Yi5zaGlmdEtleSxwYWdlWDpiLnBhZ2VYLHBhZ2VZOmIucGFnZVl9KTthKGIuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihjKX19LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvd1wiLGZ1bmN0aW9uKGIpe2Iuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7dmFyIGM9YS5FdmVudChcImNsaWNrXCIse21ldGFLZXk6Yi5tZXRhS2V5LGN0cmxLZXk6Yi5jdHJsS2V5LGFsdEtleTpiLmFsdEtleSxzaGlmdEtleTpiLnNoaWZ0S2V5fSk7YShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoYykuZm9jdXMoKX0pLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWxlYWYgPiAuanN0cmVlLW9jbFwiLGEucHJveHkoZnVuY3Rpb24oYil7Yi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTt2YXIgYz1hLkV2ZW50KFwiY2xpY2tcIix7bWV0YUtleTpiLm1ldGFLZXksY3RybEtleTpiLmN0cmxLZXksYWx0S2V5OmIuYWx0S2V5LHNoaWZ0S2V5OmIuc2hpZnRLZXl9KTthKGIuY3VycmVudFRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpcnN0KCkudHJpZ2dlcihjKS5mb2N1cygpfSx0aGlzKSkub24oXCJtb3VzZW92ZXIuanN0cmVlXCIsXCIuanN0cmVlLXdob2xlcm93LCAuanN0cmVlLWljb25cIixhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiBhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHRoaXMuaXNfZGlzYWJsZWQoYS5jdXJyZW50VGFyZ2V0KXx8dGhpcy5ob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCksITF9LHRoaXMpKS5vbihcIm1vdXNlbGVhdmUuanN0cmVlXCIsXCIuanN0cmVlLW5vZGVcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuZGVob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCl9LHRoaXMpKX0sdGhpcy50ZWFyZG93bj1mdW5jdGlvbigpe3RoaXMuc2V0dGluZ3Mud2hvbGVyb3cmJnRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS13aG9sZXJvd1wiKS5yZW1vdmUoKSxjLnRlYXJkb3duLmNhbGwodGhpcyl9LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oYixkLGUsZil7aWYoYj1jLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl7dmFyIGc9cS5jbG9uZU5vZGUoITApOy0xIT09YS5pbkFycmF5KGIuaWQsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkKSYmKGcuY2xhc3NOYW1lKz1cIiBqc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKSx0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZCYmdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9PT1iLmlkJiYoZy5jbGFzc05hbWUrPVwiIGpzdHJlZS13aG9sZXJvdy1ob3ZlcmVkXCIpLGIuaW5zZXJ0QmVmb3JlKGcsYi5jaGlsZE5vZGVzWzBdKX1yZXR1cm4gYn19LGkucmVnaXN0ZXJFbGVtZW50JiZPYmplY3QmJk9iamVjdC5jcmVhdGUpe3ZhciByPU9iamVjdC5jcmVhdGUoSFRNTEVsZW1lbnQucHJvdG90eXBlKTtyLmNyZWF0ZWRDYWxsYmFjaz1mdW5jdGlvbigpe3ZhciBiPXtjb3JlOnt9LHBsdWdpbnM6W119LGM7Zm9yKGMgaW4gYS5qc3RyZWUucGx1Z2lucylhLmpzdHJlZS5wbHVnaW5zLmhhc093blByb3BlcnR5KGMpJiZ0aGlzLmF0dHJpYnV0ZXNbY10mJihiLnBsdWdpbnMucHVzaChjKSx0aGlzLmdldEF0dHJpYnV0ZShjKSYmSlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZShjKSkmJihiW2NdPUpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoYykpKSk7Zm9yKGMgaW4gYS5qc3RyZWUuZGVmYXVsdHMuY29yZSlhLmpzdHJlZS5kZWZhdWx0cy5jb3JlLmhhc093blByb3BlcnR5KGMpJiZ0aGlzLmF0dHJpYnV0ZXNbY10mJihiLmNvcmVbY109SlNPTi5wYXJzZSh0aGlzLmdldEF0dHJpYnV0ZShjKSl8fHRoaXMuZ2V0QXR0cmlidXRlKGMpKTthKHRoaXMpLmpzdHJlZShiKX07dHJ5e2kucmVnaXN0ZXJFbGVtZW50KFwidmFrYXRhLWpzdHJlZVwiLHtwcm90b3R5cGU6cn0pfWNhdGNoKHMpe319fX0pO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL2Ntcy9zdGF0aWMvY21zL2pzL2xpYnMvanN0cmVlL2pzdHJlZS5taW4uanNcbiAqKiBtb2R1bGUgaWQgPSA5XG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iLCIvKlxuICogaHR0cHM6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZFxuICpcbiAqIFRoaXMgcGx1Z2luIGhhbmRsZXMgYWRkaW5nIGEgZ3JpZCB0byBhIHRyZWUgdG8gZGlzcGxheSBhZGRpdGlvbmFsIGRhdGFcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2U6XG4gKiAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG4gKlxuICogV29ya3Mgb25seSB3aXRoIGpzdHJlZSB2ZXJzaW9uID49IDMuMC4wXG4gKlxuICogJERhdGU6IDIwMTUtMTEtMjkgJFxuICogJFJldmlzaW9uOiAgMy40LjIgJFxuICpcbiAqICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISFcbiAqICEhISAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhISFcbiAqICEhISAgIElNUE9SVEFOVCBpdCBzYXlzIDMuNC4yIGJ1dCBpdCdzIGFjdHVhbGx5IDMuNC40LCBhbmQgaXQncyBtb2RpZmllZCEgICAhISFcbiAqICEhISAgIGxpbmUgNjQ2LCBzYW1lIGFzOiBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkL3B1bGwvMTY1ICAgICAhISFcbiAqICEhISAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhISFcbiAqICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISFcbiAqL1xuXG4vKmpzbGludCBub21lbjp0cnVlICovXG4vKmpzaGludCB1bnVzZWQ6dmFycyAqL1xuLypnbG9iYWwgbmF2aWdhdG9yLCBkb2N1bWVudCwgalF1ZXJ5LCBkZWZpbmUgKi9cblxuLyogQU1EIHN1cHBvcnQgYWRkZWQgYnkgam9jaGVuYmVyZ2VyIHBlciBodHRwczovL2dpdGh1Yi5jb20vZGVpdGNoL2pzdHJlZS1ncmlkL3B1bGwvNDlcbiAqXG4gKi9cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLlxuICAgICAgICBkZWZpbmUoWydqcXVlcnknLCAnanN0cmVlJ10sIGZhY3RvcnkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEJyb3dzZXIgZ2xvYmFsc1xuICAgICAgICBmYWN0b3J5KGpRdWVyeSk7XG4gICAgfVxufShmdW5jdGlvbiAoJCkge1xuICAgIHZhciByZW5kZXJBV2lkdGgsIHJlbmRlckFUaXRsZSwgZ2V0SW5kZW50LCBodG1sc3RyaXByZSwgZmluZExhc3RDbG9zZWROb2RlLCBCTEFOS1JFID0gL15cXHMqJC9nLFxuICAgICAgICBJRFJFR0VYID0gL1tcXFxcOiYhXnwoKVxcW1xcXTw+QConK34jXCI7LD0gXFwvJHt9JV0vZywgZXNjYXBlSWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHJldHVybiAoaWR8fFwiXCIpLnJlcGxhY2UoSURSRUdFWCwnXFxcXCQmJyk7XG4gICAgICAgIH0sIE5PREVfREFUQV9BVFRSID0gXCJkYXRhLWpzdHJlZWdyaWRcIixcbiAgICBTUEVDSUFMX1RJVExFID0gXCJfREFUQV9cIiwgTEVWRUxJTkRFTlQgPSAyNCwgc3R5bGVkID0gZmFsc2UsIEdSSURDRUxMSURfUFJFRklYID0gXCJqc2dyaWRfXCIsR1JJRENFTExJRF9QT1NURklYID0gXCJfY29sXCIsXG4gICAgICAgIGZpbmREYXRhQ2VsbCA9IGZ1bmN0aW9uIChmcm9tLGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZnJvbS5maW5kKFwiZGl2W1wiK05PREVfREFUQV9BVFRSK1wiPSdcIitpZCtcIiddXCIpO1xuICAgICAgICB9LFxuICAgICAgICBpc0NsaWNrZWRTZXAgPSBmYWxzZSwgdG9SZXNpemUgPSBudWxsLCBvbGRNb3VzZVggPSAwLCBuZXdNb3VzZVggPSAwO1xuXG4gICAgLypqc2xpbnQgcmVnZXhwOnRydWUgKi9cbiAgICBodG1sc3RyaXByZSA9IC88XFwvP1tePl0rPi9naTtcbiAgICAvKmpzbGludCByZWdleHA6ZmFsc2UgKi9cblxuICAgIGdldEluZGVudCA9IGZ1bmN0aW9uKG5vZGUsdHJlZSkge1xuICAgICAgICB2YXIgZGl2LCBpLCBsaSwgd2lkdGg7XG5cbiAgICAgICAgLy8gZGlkIHdlIGFscmVhZHkgc2F2ZSBpdCBmb3IgdGhpcyB0cmVlP1xuICAgICAgICB0cmVlLl9ncmlkU2V0dGluZ3MgPSB0cmVlLl9ncmlkU2V0dGluZ3MgfHwge307XG4gICAgICAgIGlmICh0cmVlLl9ncmlkU2V0dGluZ3MuaW5kZW50ID4gMCkge1xuICAgICAgICAgICAgd2lkdGggPSB0cmVlLl9ncmlkU2V0dGluZ3MuaW5kZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY3JlYXRlIGEgbmV3IGRpdiBvbiB0aGUgRE9NIGJ1dCBub3QgdmlzaWJsZSBvbiB0aGUgcGFnZVxuICAgICAgICAgICAgZGl2ID0gJChcIjxkaXY+PC9kaXY+XCIpO1xuICAgICAgICAgICAgaSA9IG5vZGUucHJldihcImlcIik7XG4gICAgICAgICAgICBsaSA9IGkucGFyZW50KCk7XG4gICAgICAgICAgICAvLyBhZGQgdG8gdGhhdCBkaXYgYWxsIG9mIHRoZSBjbGFzc2VzIG9uIHRoZSB0cmVlIHJvb3RcbiAgICAgICAgICAgIGRpdi5hZGRDbGFzcyh0cmVlLmdldF9ub2RlKFwiI1wiLHRydWUpLmF0dHIoXCJjbGFzc1wiKSk7XG5cbiAgICAgICAgICAgIC8vIG1vdmUgdGhlIGxpIHRvIHRoZSB0ZW1wb3JhcnkgZGl2IHJvb3RcbiAgICAgICAgICAgIGxpLmFwcGVuZFRvKGRpdik7XG5cbiAgICAgICAgICAgIC8vIGF0dGFjaCB0byB0aGUgYm9keSBxdWlja2x5XG4gICAgICAgICAgICBkaXYuYXBwZW5kVG8oJChcImJvZHlcIikpO1xuXG4gICAgICAgICAgICAvLyBnZXQgdGhlIHdpZHRoXG4gICAgICAgICAgICB3aWR0aCA9IGkud2lkdGgoKSB8fCBMRVZFTElOREVOVDtcblxuICAgICAgICAgICAgLy8gZGV0YWNoIHRoZSBsaSBmcm9tIHRoZSBuZXcgZGl2IGFuZCBkZXN0cm95IHRoZSBuZXcgZGl2XG4gICAgICAgICAgICBsaS5kZXRhY2goKTtcbiAgICAgICAgICAgIGRpdi5yZW1vdmUoKTtcblxuICAgICAgICAgICAgLy8gc2F2ZSBpdCBmb3IgdGhlIGZ1dHVyZVxuICAgICAgICAgICAgdHJlZS5fZ3JpZFNldHRpbmdzLmluZGVudCA9IHdpZHRoO1xuICAgICAgICB9XG5cblxuICAgICAgICByZXR1cm4od2lkdGgpO1xuXG4gICAgfTtcblxuICAgIGZpbmRMYXN0Q2xvc2VkTm9kZSA9IGZ1bmN0aW9uICh0cmVlLGlkKSB7XG4gICAgICAgIC8vIGZpcnN0IGdldCBvdXIgbm9kZVxuICAgICAgICB2YXIgcmV0LCBub2RlID0gdHJlZS5nZXRfbm9kZShpZCksIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjtcbiAgICAgICAgLy8gaXMgaXQgY2xvc2VkP1xuICAgICAgICBpZiAoIWNoaWxkcmVuIHx8IGNoaWxkcmVuLmxlbmd0aCA8PSAwIHx8ICFub2RlLnN0YXRlLm9wZW5lZCkge1xuICAgICAgICAgICAgcmV0ID0gaWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXQgPSBmaW5kTGFzdENsb3NlZE5vZGUodHJlZSxjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGgtMV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybihyZXQpO1xuICAgIH07XG5cbiAgICByZW5kZXJBV2lkdGggPSBmdW5jdGlvbihub2RlLHRyZWUpIHtcbiAgICAgICAgdmFyIGRlcHRoLCB3aWR0aCxcbiAgICAgICAgZnVsbFdpZHRoID0gcGFyc2VJbnQodHJlZS5zZXR0aW5ncy5ncmlkLmNvbHVtbnNbMF0ud2lkdGgsMTApICsgcGFyc2VJbnQodHJlZS5fZ3JpZFNldHRpbmdzLnRyZWVXaWR0aERpZmYsMTApO1xuICAgICAgICAvLyBuZWVkIHRvIHVzZSBhIHNlbGVjdG9yIGluIGpxdWVyeSAxLjQuNCtcbiAgICAgICAgZGVwdGggPSB0cmVlLmdldF9ub2RlKG5vZGUpLnBhcmVudHMubGVuZ3RoO1xuICAgICAgICB3aWR0aCA9IGZ1bGxXaWR0aCAtIGRlcHRoKmdldEluZGVudChub2RlLHRyZWUpO1xuICAgICAgICAvLyB0aGUgZm9sbG93aW5nIGxpbmUgaXMgbm8gbG9uZ2VyIG5lZWRlZCwgc2luY2Ugd2UgYXJlIGRvaW5nIHRoaXMgaW5zaWRlIGEgPHRkPlxuICAgICAgICAvL2EuY3NzKHtcInZlcnRpY2FsLWFsaWduXCI6IFwidG9wXCIsIFwib3ZlcmZsb3dcIjpcImhpZGRlblwifSk7XG4gICAgICAgIHJldHVybihmdWxsV2lkdGgpO1xuICAgIH07XG4gICAgcmVuZGVyQVRpdGxlID0gZnVuY3Rpb24obm9kZSx0LHRyZWUpIHtcbiAgICAgICAgdmFyIGEgPSBub2RlLmdldCgwKS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiYVwiID8gbm9kZSA6IG5vZGUuY2hpbGRyZW4oXCJhXCIpLCB0aXRsZSwgY29sID0gdHJlZS5zZXR0aW5ncy5ncmlkLmNvbHVtbnNbMF07XG4gICAgICAgIC8vIGdldCB0aGUgdGl0bGVcbiAgICAgICAgdGl0bGUgPSBcIlwiO1xuICAgICAgICBpZiAoY29sLnRpdGxlKSB7XG4gICAgICAgICAgICBpZiAoY29sLnRpdGxlID09PSBTUEVDSUFMX1RJVExFKSB7XG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0cmVlLmdldF90ZXh0KHQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0LmF0dHIoY29sLnRpdGxlKSkge1xuICAgICAgICAgICAgICAgIHRpdGxlID0gdC5hdHRyKGNvbC50aXRsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3RyaXAgb3V0IEhUTUxcbiAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKGh0bWxzdHJpcHJlLCAnJyk7XG4gICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgYS5hdHRyKFwidGl0bGVcIix0aXRsZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5qc3RyZWUuZGVmYXVsdHMuZ3JpZCA9IHtcbiAgICAgICAgd2lkdGg6ICdhdXRvJ1xuICAgIH07XG5cbiAgICAkLmpzdHJlZS5wbHVnaW5zLmdyaWQgPSBmdW5jdGlvbihvcHRpb25zLHBhcmVudCkge1xuICAgICAgICB0aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gdGhpcy5zZXR0aW5ncy5ncmlkIHx8IHt9LCBzdHlsZXMsICAgIGNvbnRhaW5lciA9IHRoaXMuZWxlbWVudCwgZ3JpZHBhcmVudCA9IGNvbnRhaW5lci5wYXJlbnQoKSwgaSxcbiAgICAgICAgICAgICAgICBncyA9IHRoaXMuX2dyaWRTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucyA6IHMuY29sdW1ucyB8fCBbXSxcbiAgICAgICAgICAgICAgICAgICAgdHJlZUNsYXNzIDogXCJqc3RyZWUtZ3JpZC1jb2wtMFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBzLmNvbnRleHRtZW51IHx8IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5XaWR0aCA6IHMuY29sdW1uV2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRDb25mIDoge1wiKmRpc3BsYXlcIjpcImlubGluZVwiLFwiKitkaXNwbGF5XCI6XCJpbmxpbmVcIn0sXG4gICAgICAgICAgICAgICAgICAgIGlzVGhlbWVyb2xsZXIgOiAhIXRoaXMuX2RhdGEudGhlbWVyb2xsZXIsXG4gICAgICAgICAgICAgICAgICAgIHRyZWVXaWR0aERpZmYgOiAwLFxuICAgICAgICAgICAgICAgICAgICByZXNpemFibGUgOiBzLnJlc2l6YWJsZSxcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50OiAwXG4gICAgICAgICAgICAgICAgfSwgY29scyA9IGdzLmNvbHVtbnMsIHRyZWVjb2wgPSAwO1xuICAgICAgICAgICAgICAgIC8vIGZpbmQgd2hpY2ggY29sdW1uIG91ciB0cmVlIHNodWxkIGdvIGluXG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTxzLmNvbHVtbnMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocy5jb2x1bW5zW2ldLnRyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNhdmUgd2hpY2ggY29sdW1uIGl0IHdhc1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJlZWNvbCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3QgY2hlY2sgYW55IG90aGVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gc2V0IGEgdW5pcXVlIElEIGZvciB0aGlzIHRhYmxlXG4gICAgICAgICAgICAgICAgdGhpcy51bmlxID0gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkqMTAwMCk7XG4gICAgICAgICAgICAgICAgdGhpcy50cmVlY29sID0gdHJlZWNvbDtcbiAgICAgICAgICAgICAgICB0aGlzLnJvb3RpZCA9IGNvbnRhaW5lci5hdHRyKFwiaWRcIik7XG5cbiAgICAgICAgICAgICAgICB2YXIgbXNpZSA9IC9tc2llLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgaWYgKG1zaWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZUZsb2F0KG5hdmlnYXRvci5hcHBWZXJzaW9uLnNwbGl0KFwiTVNJRVwiKVsxXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uIDwgOCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3MuZGVmYXVsdENvbmYuZGlzcGxheSA9IFwiaW5saW5lXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBncy5kZWZhdWx0Q29uZi56b29tID0gXCIxXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgdGhlIGNsYXNzZXMgd2UgbmVlZFxuICAgICAgICAgICAgICAgIGlmICghc3R5bGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtY2VsbCB7dmVydGljYWwtYWxpZ246IHRvcDsgb3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1sZWZ0OjA7cG9zaXRpb246cmVsYXRpdmU7d2lkdGg6IDEwMCU7cGFkZGluZy1sZWZ0OjdweDt3aGl0ZS1zcGFjZTogbm93cmFwO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jZWxsIHNwYW4ge21hcmdpbi1yaWdodDowcHg7bWFyZ2luLXJpZ2h0OjBweDsqZGlzcGxheTppbmxpbmU7KitkaXNwbGF5OmlubGluZTt3aGl0ZS1zcGFjZTogbm93cmFwO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1zZXBhcmF0b3Ige3Bvc2l0aW9uOnJlbGF0aXZlOyBoZWlnaHQ6MjRweDsgZmxvYXQ6cmlnaHQ7bWFyZ2luLWxlZnQ6IC0ycHg7IGJvcmRlci13aWR0aDogMCAycHggMCAwOyAqZGlzcGxheTppbmxpbmU7ICorZGlzcGxheTppbmxpbmU7IG1hcmdpbi1yaWdodDowcHg7d2lkdGg6MHB4O30nLFxuICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWhlYWRlci1jZWxsIHtvdmVyZmxvdzogaGlkZGVuOyB3aGl0ZS1zcGFjZTogbm93cmFwO3BhZGRpbmc6IDFweCAzcHggMnB4IDVweDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtaGVhZGVyLXRoZW1lcm9sbGVyIHtib3JkZXI6IDA7IHBhZGRpbmc6IDFweCAzcHg7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWhlYWRlci1yZWd1bGFyIHtiYWNrZ3JvdW5kLWNvbG9yOiAjRUJGM0ZEO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yIHtjdXJzb3I6IGNvbC1yZXNpemU7IHdpZHRoOiAycHg7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLXNlcGFyYXRvci1yZWd1bGFyIHtib3JkZXItY29sb3I6ICNkMGQwZDA7IGJvcmRlci1zdHlsZTogc29saWQ7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWNlbGwtdGhlbWVyb2xsZXIge2JvcmRlcjogbm9uZSAhaW1wb3J0YW50OyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudCAhaW1wb3J0YW50O30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC13cmFwcGVyIHt3aWR0aDogMTAwJTsgb3ZlcmZsb3cteDogYXV0bzt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtbWlkd3JhcHBlciB7ZGlzcGxheTogdGFibGUtcm93OyBvdmVyZmxvdzogdmlzaWJsZTt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtd2lkdGgtYXV0byB7d2lkdGg6YXV0bztkaXNwbGF5OmJsb2NrO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jb2x1bW4ge2Rpc3BsYXk6IHRhYmxlLWNlbGw7IG92ZXJmbG93OiBoaWRkZW47fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWNvbC0wIHt3aWR0aDogMTAwJTt9J1xuICAgICAgICAgICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICAgICAgICAgICQoJzxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj4nK3N0eWxlcy5qb2luKFwiXFxuXCIpKyc8L3N0eWxlPicpLmFwcGVuZFRvKFwiaGVhZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlciA9ICQoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdyYXBwZXJcIikuYXBwZW5kVG8oZ3JpZHBhcmVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5taWRXcmFwcGVyID0gJChcIjxkaXY+PC9kaXY+XCIpLmFkZENsYXNzKFwianN0cmVlLWdyaWQtbWlkd3JhcHBlclwiKS5hcHBlbmRUbyh0aGlzLmdyaWRXcmFwcGVyKTtcbiAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHdyYXBwZXIgd2lkdGhcbiAgICAgICAgICAgICAgICBpZiAocy53aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRXcmFwcGVyLndpZHRoKHMud2lkdGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGRhdGEgY29sdW1uc1xuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgY29sdW1uXG4gICAgICAgICAgICAgICAgICAgICQoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNvbHVtbiBqc3RyZWUtZ3JpZC1jb2x1bW4tXCIraStcIiBqc3RyZWUtZ3JpZC1jb2x1bW4tcm9vdC1cIit0aGlzLnJvb3RpZCkuYXBwZW5kVG8odGhpcy5taWRXcmFwcGVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5taWRXcmFwcGVyLmNoaWxkcmVuKFwiZGl2OmVxKFwiK3RyZWVjb2wrXCIpXCIpLmFwcGVuZChjb250YWluZXIpO1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGxcIik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaW5pdCA9IGZ1bmN0aW9uIChlbCxvcHRpb25zKSB7XG4gICAgICAgICAgICBwYXJlbnQuaW5pdC5jYWxsKHRoaXMsZWwsb3B0aW9ucyk7XG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYmluZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHBhcmVudC5iaW5kLmNhbGwodGhpcyk7XG4gICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplKCk7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIC5vbihcIm1vdmVfbm9kZS5qc3RyZWUgY3JlYXRlX25vZGUuanN0cmVlIGNsZWFuX25vZGUuanN0cmVlIGNoYW5nZV9ub2RlLmpzdHJlZVwiLCAkLnByb3h5KGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0X25vZGUoZGF0YSB8fCBcIiNcIix0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlX2dyaWQodGFyZ2V0KTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVsZXRlX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubm9kZS5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBncmlkID0gdGhpcy5ncmlkV3JhcHBlciwgcmVtb3ZlTm9kZXMgPSBbZGF0YS5ub2RlLmlkXSwgaTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGNoaWxkcmVuIHRvIHJlbW92ZSBsaXN0XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm5vZGUgJiYgZGF0YS5ub2RlLmNoaWxkcmVuX2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZU5vZGVzID0gcmVtb3ZlTm9kZXMuY29uY2F0KGRhdGEubm9kZS5jaGlsZHJlbl9kKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPHJlbW92ZU5vZGVzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbChncmlkLHJlbW92ZU5vZGVzW2ldKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiY2xvc2Vfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uIChlLGRhdGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlX2dyaWQoZGF0YS5ub2RlKTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwib3Blbl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgfSwgdGhpcykpXG4gICAgICAgICAgICAub24oXCJsb2FkX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImxvYWRlZC5qc3RyZWVcIiwgJC5wcm94eShmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3ByZXBhcmVfaGVhZGVycygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKFwibG9hZGVkX2dyaWQuanN0cmVlXCIpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwicmVhZHkuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgbGluZS1oZWlnaHQgb2YgdGhlIGZpcnN0IGtub3duIG5vZGVcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9ySGVpZ2h0ID0gdGhpcy5lbGVtZW50LmZpbmQoXCJsaSBhOmZpcnN0XCIpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgJCgnPHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPmRpdi5qc3RyZWUtZ3JpZC1jZWxsLXJvb3QtJyt0aGlzLnJvb3RpZCsnIHtsaW5lLWhlaWdodDogJythbmNob3JIZWlnaHQrJ3B4fTwvc3R5bGU+JykuYXBwZW5kVG8oXCJoZWFkXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gYWRkIGNvbnRhaW5lciBjbGFzc2VzIHRvIHRoZSB3cmFwcGVyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQuYXR0cihcImNsYXNzXCIpKTtcblxuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcIm1vdmVfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBkYXRhLm5ld19pbnN0YW5jZS5lbGVtZW50O1xuICAgICAgICAgICAgICAgIC8vcmVuZGVyQVdpZHRoKG5vZGUsdGhpcyk7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgYWxsIHRoZSBjaGlsZHJlbiwgYmVjYXVzZSB3ZSBjb3VsZCBkcmFnIGEgdHJlZSBvdmVyXG4gICAgICAgICAgICAgICAgbm9kZS5maW5kKFwibGkgPiBhXCIpLmVhY2goJC5wcm94eShmdW5jdGlvbihpLGVsbSl7XG4gICAgICAgICAgICAgICAgICAgIC8vcmVuZGVyQVdpZHRoKCQoZWxtKSx0aGlzKTtcbiAgICAgICAgICAgICAgICB9LHRoaXMpKTtcblxuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImhvdmVyX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihub2RlLHNlbGVjdGVkLGV2ZW50KXtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBzZWxlY3RlZC5ub2RlLmlkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ob3Zlcl9ub2RlICE9PSBudWxsICYmIHRoaXMuX2hvdmVyX25vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcix0aGlzLl9ob3Zlcl9ub2RlKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9ob3Zlcl9ub2RlID0gaWQ7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLmFkZENsYXNzKFwianN0cmVlLWhvdmVyZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc2VsZWN0ZWQubm9kZS5pZDtcbiAgICAgICAgICAgICAgICB0aGlzLl9ob3Zlcl9ub2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixpZCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKTtcbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKG5vZGUsc2VsZWN0ZWQsZXZlbnQpe1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHNlbGVjdGVkLm5vZGUuaWQ7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLmFkZENsYXNzKFwianN0cmVlLWNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRfbm9kZShzZWxlY3RlZC5ub2RlLmlkLHRydWUpLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGxcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKTtcbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJkZXNlbGVjdF9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc2VsZWN0ZWQubm9kZS5pZDtcbiAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixpZCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKTtcbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJkZXNlbGVjdF9hbGwuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihub2RlLHNlbGVjdGVkLGV2ZW50KXtcbiAgICAgICAgICAgICAgICAvLyBnZXQgYWxsIG9mIHRoZSBpZHMgdGhhdCB3ZXJlIHVuc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICB2YXIgaWRzID0gc2VsZWN0ZWQubm9kZSB8fCBbXSwgaTtcbiAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPGlkcy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGlkc1tpXSkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwic2VhcmNoLmpzdHJlZVwiLCAkLnByb3h5KGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gc2VhcmNoIHNvbWV0aW1lcyBmaWx0ZXJzLCBzbyB3ZSBuZWVkIHRvIGhpZGUgYWxsIG9mIHRoZSBhcHByb3ByaWF0ZSBncmlkIGNlbGxzIGFzIHdlbGwsIGFuZCBzaG93IG9ubHkgdGhlIG1hdGNoZXNcbiAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZFdyYXBwZXI7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5fZGF0YS5zZWFyY2guc29tKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEubm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIGFsbCBvZiB0aGUgZ3JpZCBjZWxsc1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5maW5kKCdkaXYuanN0cmVlLWdyaWQtY2VsbDpub3QoOmZpcnN0KScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3cgb25seSB0aG9zZSB0aGF0IG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm5vZGVzLmFkZChkYXRhLm5vZGVzLnBhcmVudHNVbnRpbChcIi5qc3RyZWVcIikpLmZpbHRlcihcIi5qc3RyZWUtbm9kZVwiKS5lYWNoKGZ1bmN0aW9uIChpLG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBub2RlLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwoZ3JpZCxpZCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSwgdGhpcykpXG4gICAgICAgICAgICAub24oXCJjbGVhcl9zZWFyY2guanN0cmVlXCIsICQucHJveHkoZnVuY3Rpb24gKGUsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAvLyBzZWFyY2ggaGFzIGJlZW4gY2xlYXJlZCwgc28gd2UgbmVlZCB0byBzaG93IGFsbCByb3dzXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci5maW5kKCdkaXYuanN0cmVlLWdyaWQtY2VsbCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2dyaWRTZXR0aW5ncy5pc1RoZW1lcm9sbGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIC5vbihcInNlbGVjdF9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24oZSxkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImRlc2VsZWN0X25vZGUuanN0cmVlIGRlc2VsZWN0X2FsbC5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24oZSxkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiZGVob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24oZSxkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucnNsdC5vYmouY2hpbGRyZW4oXCJhXCIpLm5leHRBbGwoXCJkaXZcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSx0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIHRlYXIgZG93biB0aGUgdHJlZSBlbnRpcmVseVxuICAgICAgICB0aGlzLnRlYXJkb3duID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZ3cgPSB0aGlzLmdyaWRXcmFwcGVyLCBjb250YWluZXIgPSB0aGlzLmVsZW1lbnQsIGdyaWRwYXJlbnQgPSBndy5wYXJlbnQoKTtcbiAgICAgICAgICAgIGNvbnRhaW5lci5kZXRhY2goKTtcbiAgICAgICAgICAgIGd3LnJlbW92ZSgpO1xuICAgICAgICAgICAgZ3JpZHBhcmVudC5hcHBlbmQoY29udGFpbmVyKTtcbiAgICAgICAgICAgIHBhcmVudC50ZWFyZG93bi5jYWxsKHRoaXMpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBjbGVhbiB0aGUgZ3JpZCBpbiBjYXNlIG9mIHJlZHJhdyBvciByZWZyZXNoIGVudGlyZSB0cmVlXG4gICAgICAgIHRoaXMuX2NsZWFuX2dyaWQgPSBmdW5jdGlvbiAodGFyZ2V0LGlkKSB7XG4gICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZFdyYXBwZXI7XG4gICAgICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKGdyaWQsaWQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgYWxsIG9mIHRoZSBgZGl2YCBjaGlsZHJlbiBpbiBhbGwgb2YgdGhlIGB0ZGAgaW4gZGF0YVJvdyBleGNlcHQgZm9yIDpmaXJzdCAodGhhdCBpcyB0aGUgdHJlZSBpdHNlbGYpIGFuZCByZW1vdmVcbiAgICAgICAgICAgICAgICBncmlkLmZpbmQoXCJkaXYuanN0cmVlLWdyaWQtY2VsbDpub3QoOmZpcnN0KVwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gcHJlcGFyZSB0aGUgaGVhZGVyc1xuICAgICAgICB0aGlzLl9wcmVwYXJlX2hlYWRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXIsIGksIGNvbCwgZ3MgPSB0aGlzLl9ncmlkU2V0dGluZ3MsY29scyA9IGdzLmNvbHVtbnMgfHwgW10sIHdpZHRoLCBkZWZhdWx0V2lkdGggPSBncy5jb2x1bW5XaWR0aCwgcmVzaXphYmxlID0gZ3MucmVzaXphYmxlIHx8IGZhbHNlLFxuICAgICAgICAgICAgY2wsIGNjbCwgdmFsLCBtYXJnaW4sIGxhc3QsIHRyID0gZ3MuaXNUaGVtZXJvbGxlciwgY2xhc3NBZGQgPSAodHI/XCJ0aGVtZXJvbGxlclwiOlwicmVndWxhclwiKSwgcHVsbGVyLFxuICAgICAgICAgICAgaGFzSGVhZGVycyA9IGZhbHNlLCBncmlkcGFyZW50ID0gdGhpcy5ncmlkcGFyZW50LFxuICAgICAgICAgICAgY29uZiA9IGdzLmRlZmF1bHRDb25mLFxuICAgICAgICAgICAgY29sTnVtID0gMCwgYm9yUGFkV2lkdGggPSAwLCB0b3RhbFdpZHRoID0gMDtcbiAgICAgICAgICAgIC8vIHNhdmUgdGhlIG9yaWdpbmFsIHBhcmVudCBzbyB3ZSBjYW4gcmVwYXJlbnQgb24gZGVzdHJveVxuICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBncmlkcGFyZW50O1xuXG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgaGVhZGVyc1xuICAgICAgICAgICAgZm9yIChpPTA7aTxjb2xzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAvL2NvbCA9ICQoXCI8Y29sLz5cIik7XG4gICAgICAgICAgICAgICAgLy9jb2wuYXBwZW5kVG8oY29sZ3JvdXApO1xuICAgICAgICAgICAgICAgIGNsID0gY29sc1tpXS5oZWFkZXJDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGNjbCA9IGNvbHNbaV0uY29sdW1uQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICB2YWwgPSBjb2xzW2ldLmhlYWRlciB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICh2YWwpIHtoYXNIZWFkZXJzID0gdHJ1ZTt9XG4gICAgICAgICAgICAgICAgd2lkdGggPSBjb2xzW2ldLndpZHRoIHx8IGRlZmF1bHRXaWR0aDtcblxuICAgICAgICAgICAgICAgIC8vIHdlIG9ubHkgZGVhbCB3aXRoIGJvcmRlcnMgaWYgd2lkdGggaXMgbm90IGF1dG8gYW5kIG5vdCBwZXJjZW50YWdlc1xuICAgICAgICAgICAgICAgIGJvclBhZFdpZHRoID0gdHIgPyAxKzYgOiAyKzg7IC8vIGFjY291bnQgZm9yIHRoZSBib3JkZXJzIGFuZCBwYWRkaW5nXG4gICAgICAgICAgICAgICAgaWYgKHdpZHRoICE9PSAnYXV0bycgJiYgdHlwZW9mKHdpZHRoKSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aCAtPSBib3JQYWRXaWR0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWFyZ2luID0gaSA9PT0gMCA/IDMgOiAwO1xuICAgICAgICAgICAgICAgIGNvbCA9IHRoaXMubWlkV3JhcHBlci5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW4tXCIraSk7XG4gICAgICAgICAgICAgICAgbGFzdCA9ICQoXCI8ZGl2PjwvZGl2PlwiKS5jc3MoY29uZikuY3NzKHtcIm1hcmdpbi1sZWZ0XCI6IG1hcmdpbn0pLmFkZENsYXNzKFwianN0cmVlLWdyaWQtZGl2LVwiK3RoaXMudW5pcStcIi1cIitpK1wiIFwiKyh0cj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCIganN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1jZWxsIGpzdHJlZS1ncmlkLWhlYWRlci1cIitjbGFzc0FkZCtcIiBcIitjbCtcIiBcIitjY2wpLmh0bWwodmFsKTtcbiAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKCh0cj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCJqc3RyZWUtZ3JpZC1oZWFkZXIganN0cmVlLWdyaWQtaGVhZGVyLVwiK2NsYXNzQWRkKTtcbiAgICAgICAgICAgICAgICBsYXN0LnByZXBlbmRUbyhjb2wpO1xuICAgICAgICAgICAgICAgIHRvdGFsV2lkdGggKz0gbGFzdC5vdXRlcldpZHRoKCk7XG4gICAgICAgICAgICAgICAgcHVsbGVyID0gJChcIjxkaXYgY2xhc3M9J2pzdHJlZS1ncmlkLXNlcGFyYXRvciBqc3RyZWUtZ3JpZC1zZXBhcmF0b3ItXCIrY2xhc3NBZGQrKHRyID8gXCIgdWktd2lkZ2V0LWhlYWRlclwiIDogXCJcIikrKHJlc2l6YWJsZT8gXCIganN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiOlwiXCIpK1wiJz4mbmJzcDs8L2Rpdj5cIikuYXBwZW5kVG8obGFzdCk7XG4gICAgICAgICAgICAgICAgY29sLndpZHRoKHdpZHRoKTtcbiAgICAgICAgICAgICAgICBjb2wuY3NzKFwibWluLXdpZHRoXCIsd2lkdGgpO1xuICAgICAgICAgICAgICAgIGNvbC5jc3MoXCJtYXgtd2lkdGhcIix3aWR0aCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxhc3QuYWRkQ2xhc3MoKHRyP1widWktd2lkZ2V0LWhlYWRlciBcIjpcIlwiKStcImpzdHJlZS1ncmlkLWhlYWRlciBqc3RyZWUtZ3JpZC1oZWFkZXItbGFzdCBqc3RyZWUtZ3JpZC1oZWFkZXItXCIrY2xhc3NBZGQpO1xuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gd2lkdGggZ2l2ZW4gZm9yIHRoZSBsYXN0IGNvbHVtbiwgZG8gaXQgdmlhIGF1dG9tYXRpY1xuICAgICAgICAgICAgaWYgKGNvbHNbY29scy5sZW5ndGgtMV0ud2lkdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRvdGFsV2lkdGggLT0gd2lkdGg7XG4gICAgICAgICAgICAgICAgY29sLmNzcyh7d2lkdGg6XCJhdXRvXCJ9KTtcbiAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKFwianN0cmVlLWdyaWQtd2lkdGgtYXV0b1wiKS5uZXh0KFwiLmpzdHJlZS1ncmlkLXNlcGFyYXRvclwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNIZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgb2Zmc2V0IG9mIHRoZSBkaXYgZnJvbSB0aGUgYm9keVxuICAgICAgICAgICAgICAgIC8vZ3MuZGl2T2Zmc2V0ID0gaGVhZGVyLnBhcmVudCgpLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgICAgICAgZ3MuaGVhZGVyID0gaGVhZGVyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKFwiZGl2LmpzdHJlZS1ncmlkLWhlYWRlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5ib3VuZCAmJiByZXNpemFibGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICBpLCByZWYsIGNvbHMsIHdpZHRocywgaGVhZGVycywgdywgY3VycmVudFRyZWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0NsaWNrZWRTZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUcmVlID0gdG9SZXNpemUuY2xvc2VzdChcIi5qc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmZpbmQoXCIuanN0cmVlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmID0gJC5qc3RyZWUucmVmZXJlbmNlKGN1cnJlbnRUcmVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHMgPSByZWYuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycyA9IHRvUmVzaXplLnBhcmVudCgpLmNoaWxkcmVuKFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRocyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGNvbE51bSkgfHwgY29sTnVtIDwgMCkgeyByZWYuX2dyaWRTZXR0aW5ncy50cmVlV2lkdGhEaWZmID0gY3VycmVudFRyZWUuZmluZChcImluczplcSgwKVwiKS53aWR0aCgpICsgY3VycmVudFRyZWUuZmluZChcImE6ZXEoMClcIikud2lkdGgoKSAtIHJlZi5fZ3JpZFNldHRpbmdzLmNvbHVtbnNbMF0ud2lkdGg7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xpY2tlZFNlcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTxjb2xzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gcGFyc2VGbG9hdChoZWFkZXJzW2ldLnN0eWxlLndpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aHNbaV0gPSB7dzogdywgcjogaT09PWNvbE51bSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZi5fZ3JpZFNldHRpbmdzLmNvbHVtbnNbaV0ud2lkdGggPSB3O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VHJlZS50cmlnZ2VyKFwicmVzaXplX2NvbHVtbi5qc3RyZWUtZ3JpZFwiLCB3aWR0aHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkubW91c2Vtb3ZlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbGlja2VkU2VwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3TW91c2VYID0gZS5wYWdlWDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IG5ld01vdXNlWCAtIG9sZE1vdXNlWCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmV2SGVhZGVySW5uZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkUHJldkNvbFdpZHRoLCBuZXdQcmV2Q29sV2lkdGg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPT0gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByZXZIZWFkZXJJbm5lciA9IHRvUmVzaXplLndpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByZXZDb2xXaWR0aCA9IHBhcnNlRmxvYXQodG9SZXNpemUuY3NzKFwid2lkdGhcIikpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBhIENocm9tZSBpc3N1ZSB3aXRoIGNvbHVtbnMgc2V0IHRvIGF1dG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhhbmtzIHRvIEJyYWJ1cyBodHRwczovL2dpdGh1Yi5jb20vc2lkZS1ieS1zaWRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb2xkUHJldkNvbFdpZHRoKSB7b2xkUHJldkNvbFdpZHRoID0gdG9SZXNpemUuaW5uZXJXaWR0aCgpO31cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBkaWZmIGNhbm5vdCBiZSBiZXlvbmQgdGhlIGxlZnQvcmlnaHQgbGltaXRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmYgPSBkaWZmIDwgMCA/IE1hdGgubWF4KGRpZmYsLW9sZFByZXZIZWFkZXJJbm5lcikgOiBkaWZmO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQcmV2Q29sV2lkdGggPSAob2xkUHJldkNvbFdpZHRoK2RpZmYpK1wicHhcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGRvIHRoaXMgaWYgd2UgYXJlIG5vdCBzaHJpbmtpbmcgcGFzdCAwIG9uIGxlZnQgLSBhbmQgbGltaXQgaXQgdG8gdGhhdCBhbW91bnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgPiAwIHx8IG9sZFByZXZIZWFkZXJJbm5lciA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVzaXplLndpZHRoKG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Jlc2l6ZS5jc3MoXCJtaW4td2lkdGhcIixuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUuY3NzKFwibWF4LXdpZHRoXCIsbmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZE1vdXNlWCA9IG5ld01vdXNlWDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci5vbihcInNlbGVjdHN0YXJ0XCIsIFwiLmpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSkub24oXCJtb3VzZWRvd25cIiwgXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpc0NsaWNrZWRTZXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBvbGRNb3VzZVggPSBlLnBhZ2VYO1xuICAgICAgICAgICAgICAgICAgICB0b1Jlc2l6ZSA9ICQodGhpcykuY2xvc2VzdChcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSBtYXggcmlnaHRtb3N0IHBvc2l0aW9uIHdlIHdpbGwgYWxsb3cgaXMgdGhlIHJpZ2h0LW1vc3Qgb2YgdGhlIHdyYXBwZXIgbWludXMgYSBidWZmZXIgKDEwKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oXCJkYmxjbGlja1wiLCBcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGlja2VkU2VwID0gJCh0aGlzKSwgY29sID0gY2xpY2tlZFNlcC5jbG9zZXN0KFwiZGl2LmpzdHJlZS1ncmlkLWNvbHVtblwiKSxcbiAgICAgICAgICAgICAgICAgICAgb2xkUHJldkNvbFdpZHRoID0gcGFyc2VGbG9hdChjb2wuY3NzKFwid2lkdGhcIikpLCBuZXdXaWR0aCA9IDAsIGRpZmYsXG4gICAgICAgICAgICAgICAgICAgIG9sZFByZXZIZWFkZXJJbm5lciA9IGNvbC53aWR0aCgpLCBuZXdQcmV2Q29sV2lkdGg7XG5cblxuICAgICAgICAgICAgICAgICAgICAvL2ZpbmQgbGFyZ2VzdCB3aWR0aFxuICAgICAgICAgICAgICAgICAgICBjb2wuZmluZChcIi5qc3RyZWUtZ3JpZC1jZWxsXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQodGhpcyksIHdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jc3MoXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jc3MoXCJ3aWR0aFwiLCBcImF1dG9cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGl0ZW0ub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jc3MoXCJwb3NpdGlvblwiLCBcInJlbGF0aXZlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkdGg+bmV3V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdXaWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBkaWZmID0gbmV3V2lkdGgtb2xkUHJldkNvbFdpZHRoO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IGRpZmYgY2Fubm90IGJlIGJleW9uZCB0aGUgbGVmdCBsaW1pdHNcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IGRpZmYgPCAwID8gTWF0aC5tYXgoZGlmZiwtb2xkUHJldkhlYWRlcklubmVyKSA6IGRpZmY7XG4gICAgICAgICAgICAgICAgICAgIG5ld1ByZXZDb2xXaWR0aCA9IChvbGRQcmV2Q29sV2lkdGgrZGlmZikrXCJweFwiO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbC53aWR0aChuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICBjb2wuY3NzKFwibWluLXdpZHRoXCIsbmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNzcyhcIm1heC13aWR0aFwiLG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qXG4gICAgICAgICAqIE92ZXJyaWRlIHJlZHJhd19ub2RlIHRvIGNvcnJlY3RseSBpbnNlcnQgdGhlIGdyaWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVkcmF3X25vZGUgPSBmdW5jdGlvbihvYmosIGRlZXAsIGlzX2NhbGxiYWNrLCBmb3JjZV9yZW5kZXIpIHtcbiAgICAgICAgICAgIC8vIGZpcnN0IGFsbG93IHRoZSBwYXJlbnQgdG8gcmVkcmF3IHRoZSBub2RlXG4gICAgICAgICAgICBvYmogPSBwYXJlbnQucmVkcmF3X25vZGUuY2FsbCh0aGlzLCBvYmosIGRlZXAsIGlzX2NhbGxiYWNrLCBmb3JjZV9yZW5kZXIpO1xuICAgICAgICAgICAgLy8gbmV4dCBwcmVwYXJlIHRoZSBncmlkXG4gICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlX2dyaWQob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFuX2dyaWQoKTtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQucmVmcmVzaC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2hpZGVfZ3JpZCA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlICYmIG5vZGUuY2hpbGRyZW5fZCA/IG5vZGUuY2hpbGRyZW5fZCA6IFtdLCBpO1xuICAgICAgICAgICAgLy8gZ28gdGhyb3VnaCBlYWNoIGNvbHVtbiwgcmVtb3ZlIGFsbCBjaGlsZHJlbiB3aXRoIHRoZSBjb3JyZWN0IElEIG5hbWVcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y2hpbGRyZW4ubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGNoaWxkcmVuW2ldKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ob2xkaW5nQ2VsbHMgPSB7fTtcbiAgICAgICAgdGhpcy5nZXRIb2xkaW5nQ2VsbHMgPSBmdW5jdGlvbiAob2JqLGNvbCxoYykge1xuICAgICAgICAgICAgdmFyIHJldCA9ICQoKSwgY2hpbGRyZW4gPSBvYmouY2hpbGRyZW58fFtdLCBjaGlsZCwgaTtcbiAgICAgICAgICAgIC8vIHJ1biB0aHJvdWdoIGVhY2ggY2hpbGQsIHJlbmRlciBpdCwgYW5kIHRoZW4gcmVuZGVyIGl0cyBjaGlsZHJlbiByZWN1cnNpdmVseVxuICAgICAgICAgICAgZm9yIChpPTA7aTxjaGlsZHJlbi5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgY2hpbGQgPSBHUklEQ0VMTElEX1BSRUZJWCtlc2NhcGVJZChjaGlsZHJlbltpXSkrR1JJRENFTExJRF9QT1NURklYK2NvbDtcbiAgICAgICAgICAgICAgICBpZiAoaGNbY2hpbGRdICYmIG9iai5zdGF0ZS5vcGVuZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0LmFkZChoY1tjaGlsZF0pLmFkZCh0aGlzLmdldEhvbGRpbmdDZWxscyh0aGlzLmdldF9ub2RlKGNoaWxkcmVuW2ldKSxjb2wsaGMpKTtcbiAgICAgICAgICAgICAgICAgICAgLy9kZWxldGUgaGNbY2hpbGRdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybihyZXQpO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogcHV0IGEgZ3JpZCBjZWxsIGluIGVkaXQgbW9kZSAoaW5wdXQgZmllbGQgdG8gZWRpdCB0aGUgZGF0YSlcbiAgICAgICAgICogQG5hbWUgZWRpdChvYmosIGNvbClcbiAgICAgICAgICogQHBhcmFtICB7bWl4ZWR9IG9ialxuICAgICAgICAgKiBAcGFyYW0gIHtvYmp9IGNvbCBkZWZpbml0aW9uXG4gICAgICAgICAqIEBwYXJhbSAge2VsZW1lbnR9IGNlbGwgZWxlbWVudCwgZWl0aGVyIHNwYW4gb3Igd3JhcHBpbmcgZGl2XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9lZGl0ID0gZnVuY3Rpb24gKG9iaiwgY29sLCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZighb2JqKSB7IHJldHVybiBmYWxzZTsgfVxuICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5wcm9wKFwidGFnTmFtZVwiKS50b0xvd2VyQ2FzZSgpID09PSBcImRpdlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LmNoaWxkcmVuKFwic3BhbjpmaXJzdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gZmluZCB0aGUgZWxlbWVudCAtIGxhdGVyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJ0bCA9IHRoaXMuX2RhdGEuY29yZS5ydGwsXG4gICAgICAgICAgICAgICAgdyAgPSB0aGlzLmVsZW1lbnQud2lkdGgoKSxcbiAgICAgICAgICAgICAgICB0ID0gb2JqLmRhdGFbY29sLnZhbHVlXSxcbiAgICAgICAgICAgICAgICBoMSA9ICQoXCI8XCIrXCJkaXYgLz5cIiwgeyBjc3MgOiB7IFwicG9zaXRpb25cIiA6IFwiYWJzb2x1dGVcIiwgXCJ0b3BcIiA6IFwiLTIwMHB4XCIsIFwibGVmdFwiIDogKHJ0bCA/IFwiMHB4XCIgOiBcIi0xMDAwcHhcIiksIFwidmlzaWJpbGl0eVwiIDogXCJoaWRkZW5cIiB9IH0pLmFwcGVuZFRvKFwiYm9keVwiKSxcbiAgICAgICAgICAgICAgICBoMiA9ICQoXCI8XCIrXCJpbnB1dCAvPlwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCIgOiB0LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGFzc1wiIDogXCJqc3RyZWUtcmVuYW1lLWlucHV0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNzc1wiIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFkZGluZ1wiIDogXCIwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJib3JkZXJcIiA6IFwiMXB4IHNvbGlkIHNpbHZlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYm94LXNpemluZ1wiIDogXCJib3JkZXItYm94XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkaXNwbGF5XCIgOiBcImlubGluZS1ibG9ja1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVpZ2h0XCIgOiAodGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCkgKyBcInB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsaW5lSGVpZ2h0XCIgOiAodGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCkgKyBcInB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3aWR0aFwiIDogXCIxNTBweFwiIC8vIHdpbGwgYmUgc2V0IGEgYml0IGZ1cnRoZXIgZG93blxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYmx1clwiIDogJC5wcm94eShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSBoMi52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHRoZSB2YWx1ZSBpZiBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodiA9PT0gXCJcIiB8fCB2ID09PSB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgPSB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhW2NvbC52YWx1ZV0gPSB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcigndXBkYXRlX2NlbGwuanN0cmVlLWdyaWQnLHtub2RlOm9iaiwgY29sOmNvbC52YWx1ZSwgdmFsdWU6diwgb2xkOnR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkKHRoaXMuZ2V0X25vZGUob2JqLHRydWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDIucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwia2V5ZG93blwiIDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGV2ZW50LndoaWNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gMjcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gMjcgfHwga2V5ID09PSAxMyB8fCBrZXkgPT09IDM3IHx8IGtleSA9PT0gMzggfHwga2V5ID09PSAzOSB8fCBrZXkgPT09IDQwIHx8IGtleSA9PT0gMzIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PT0gMjcgfHwga2V5ID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGlja1wiIDogZnVuY3Rpb24gKGUpIHsgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibW91c2Vkb3duXCIgOiBmdW5jdGlvbiAoZSkgeyBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJrZXl1cFwiIDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaDIud2lkdGgoTWF0aC5taW4oaDEudGV4dChcInBXXCIgKyB0aGlzLnZhbHVlKS53aWR0aCgpLHcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImtleXByZXNzXCIgOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LndoaWNoID09PSAxMykgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZm4gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb250RmFtaWx5ICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250RmFtaWx5JykgICAgICAgIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemUgICAgICAgIDogZWxlbWVudC5jc3MoJ2ZvbnRTaXplJykgICAgICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQgICAgICAgIDogZWxlbWVudC5jc3MoJ2ZvbnRXZWlnaHQnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250U3R5bGUgICAgICAgIDogZWxlbWVudC5jc3MoJ2ZvbnRTdHlsZScpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTdHJldGNoICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250U3RyZXRjaCcpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRWYXJpYW50ICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250VmFyaWFudCcpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldHRlclNwYWNpbmcgICAgOiBlbGVtZW50LmNzcygnbGV0dGVyU3BhY2luZycpICAgIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZFNwYWNpbmcgICAgICAgIDogZWxlbWVudC5jc3MoJ3dvcmRTcGFjaW5nJykgICAgICAgIHx8ICcnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGVsZW1lbnQuaGlkZSgpO1xuICAgICAgICAgICAgZWxlbWVudC5wYXJlbnQoKS5hcHBlbmQoaDIpO1xuICAgICAgICAgICAgaDIuY3NzKGZuKS53aWR0aChNYXRoLm1pbihoMS50ZXh0KFwicFdcIiArIGgyWzBdLnZhbHVlKS53aWR0aCgpLHcpKVswXS5zZWxlY3QoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgdmFyIGdzID0gdGhpcy5fZ3JpZFNldHRpbmdzLCBjID0gZ3MudHJlZUNsYXNzLCBfdGhpcyA9IHRoaXMsIHQsIGNvbHMgPSBncy5jb2x1bW5zIHx8IFtdLCB3aWR0aCwgdHIgPSBncy5pc1RoZW1lcm9sbGVyLFxuICAgICAgICAgICAgdHJlZSA9IHRoaXMuZWxlbWVudCwgcm9vdGlkID0gdGhpcy5yb290aWQsXG4gICAgICAgICAgICBjbGFzc0FkZCA9ICh0cj9cInRoZW1lcm9sbGVyXCI6XCJyZWd1bGFyXCIpLCBpbWcsIG9iakRhdGEgPSB0aGlzLmdldF9ub2RlKG9iaiksXG4gICAgICAgICAgICBkZWZhdWx0V2lkdGggPSBncy5jb2x1bW5XaWR0aCwgY29uZiA9IGdzLmRlZmF1bHRDb25mLCBjZWxsQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKHRyZWUsbm9kZSx2YWwsY29sLHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAvL25vZGUgPSB0cmVlLmZpbmQoXCIjXCIrbm9kZS5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikudHJpZ2dlcihcImNsaWNrLmpzdHJlZVwiLGUpO1xuICAgICAgICAgICAgICAgICAgICB0cmVlLnRyaWdnZXIoXCJzZWxlY3RfY2VsbC5qc3RyZWUtZ3JpZFwiLCBbe3ZhbHVlOiB2YWwsY29sdW1uOiBjb2wuaGVhZGVyLG5vZGU6IG5vZGUsZ3JpZDokKHRoaXMpLHNvdXJjZU5hbWU6IGNvbC52YWx1ZX1dKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSwgY2VsbFJpZ2h0Q2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKHRyZWUsbm9kZSx2YWwsY29sLHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdzLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQudmFrYXRhLmNvbnRleHQuc2hvdyh0aGlzLHsgJ3gnIDogZS5wYWdlWCwgJ3knIDogZS5wYWdlWSB9LHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVkaXRcIjp7bGFiZWw6XCJFZGl0XCIsXCJhY3Rpb25cIjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHQuZ2V0X25vZGUobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9lZGl0KG9iaixjb2wsZS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaG92ZXJJbkhhbmRsZXIgPSBmdW5jdGlvbiAobm9kZSwganNUcmVlSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7IGpzVHJlZUluc3RhbmNlLmhvdmVyX25vZGUobm9kZSk7IH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaG92ZXJPdXRIYW5kbGVyID0gZnVuY3Rpb24gKG5vZGUsIGpzVHJlZUluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyBqc1RyZWVJbnN0YW5jZS5kZWhvdmVyX25vZGUobm9kZSk7IH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaSwgdmFsLCBjbCwgd2NsLCBjY2wsIGEsIGxhc3QsIHZhbENsYXNzLCB3aWRlVmFsQ2xhc3MsIHNwYW4sIHBhZGRpbmdsZWZ0LCB0aXRsZSwgZ3JpZENlbGxOYW1lLCBncmlkQ2VsbFBhcmVudElkLCBncmlkQ2VsbFBhcmVudCxcbiAgICAgICAgICAgIGdyaWRDZWxsUHJldiwgZ3JpZENlbGxQcmV2SWQsIGdyaWRDZWxsTmV4dCwgZ3JpZENlbGxOZXh0SWQsIGdyaWRDZWxsQ2hpbGQsIGdyaWRDZWxsQ2hpbGRJZCxcbiAgICAgICAgICAgIGNvbCwgY29udGVudCwgdG1wV2lkdGgsIG13ID0gdGhpcy5taWRXcmFwcGVyLCBkYXRhQ2VsbCwgbGlkID0gb2JqRGF0YS5pZCxcbiAgICAgICAgICAgIHBlZXJzID0gdGhpcy5nZXRfbm9kZShvYmpEYXRhLnBhcmVudCkuY2hpbGRyZW4sXG4gICAgICAgICAgICAvLyBmaW5kIG15IHBvc2l0aW9uIGluIHRoZSBsaXN0IG9mIHBlZXJzLiBcInBlZXJzXCIgaXMgdGhlIGxpc3Qgb2YgZXZlcnlvbmUgYXQgbXkgbGV2ZWwgdW5kZXIgbXkgcGFyZW50LCBpbiBvcmRlclxuICAgICAgICAgICAgcG9zID0gJC5pbkFycmF5KGxpZCxwZWVycyksXG4gICAgICAgICAgICBoYyA9IHRoaXMuaG9sZGluZ0NlbGxzLCByZW5kZXJlZCA9IGZhbHNlLCBjbG9zZWQ7XG4gICAgICAgICAgICAvLyBnZXQgb3VyIGNvbHVtbiBkZWZpbml0aW9uXG4gICAgICAgICAgICB0ID0gJChvYmopO1xuXG4gICAgICAgICAgICAvLyBmaW5kIHRoZSBhIGNoaWxkcmVuXG4gICAgICAgICAgICBhID0gdC5jaGlsZHJlbihcImFcIik7XG5cbiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNsb3NlZCA9ICFvYmpEYXRhLnN0YXRlLm9wZW5lZDtcbiAgICAgICAgICAgICAgICBncmlkQ2VsbE5hbWUgPSBHUklEQ0VMTElEX1BSRUZJWCtlc2NhcGVJZChsaWQpK0dSSURDRUxMSURfUE9TVEZJWDtcbiAgICAgICAgICAgICAgICBncmlkQ2VsbFBhcmVudElkID0gb2JqRGF0YS5wYXJlbnQgPT09IFwiI1wiID8gbnVsbCA6IG9iakRhdGEucGFyZW50O1xuICAgICAgICAgICAgICAgIGEuYWRkQ2xhc3MoYyk7XG4gICAgICAgICAgICAgICAgLy9yZW5kZXJBV2lkdGgoYSxfdGhpcyk7XG4gICAgICAgICAgICAgICAgcmVuZGVyQVRpdGxlKGEsdCxfdGhpcyk7XG4gICAgICAgICAgICAgICAgbGFzdCA9IGE7XG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTxjb2xzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJlZWNvbCA9PT0gaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29sID0gY29sc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YUNlbGwgPSBtdy5jaGlsZHJlbihcImRpdjplcShcIitpK1wiKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBjZWxsQ2xhc3MsIHRoZSB3aWRlQ2VsbENsYXNzLCBhbmQgdGhlIGNvbHVtbkNsYXNzXG4gICAgICAgICAgICAgICAgICAgIGNsID0gY29sLmNlbGxDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB3Y2wgPSBjb2wud2lkZUNlbGxDbGFzcyB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBjY2wgPSBjb2wuY29sdW1uQ2xhc3MgfHwgXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBjb2x1bW4gY2xhc3MgdG8gdGhlIGRhdGFDZWxsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFDZWxsLmFkZENsYXNzKGNjbCk7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGNvbnRlbnRzIG9mIHRoZSBjZWxsIC0gdmFsdWUgY291bGQgYmUgYSBzdHJpbmcgb3IgYSBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgY29sLnZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGNvbC52YWx1ZSkgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGNvbC52YWx1ZShvYmpEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkICYmIG9iakRhdGEuZGF0YVtjb2wudmFsdWVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBvYmpEYXRhLmRhdGFbY29sLnZhbHVlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGNvbC5mb3JtYXQpID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGNvbC5mb3JtYXQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHB1dCBpbWFnZXMgaW5zdGVhZCBvZiB0ZXh0IGlmIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmltYWdlcykge1xuICAgICAgICAgICAgICAgICAgICBpbWcgPSBjb2wuaW1hZ2VzW3ZhbF0gfHwgY29sLmltYWdlc1tcImRlZmF1bHRcIl07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbWcpIHtjb250ZW50ID0gaW1nWzBdID09PSBcIipcIiA/ICc8c3BhbiBjbGFzcz1cIicraW1nLnN1YnN0cigxKSsnXCI+PC9zcGFuPicgOiAnPGltZyBzcmM9XCInK2ltZysnXCI+Jzt9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IGNvbnRlbnQgPSB2YWw7IH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBjb250ZW50IGNhbm5vdCBiZSBibGFuaywgb3IgaXQgbWVzc2VzIHVwIGhlaWdodHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQgPT09IHVuZGVmaW5lZCB8fCBjb250ZW50ID09PSBudWxsIHx8IEJMQU5LUkUudGVzdChjb250ZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IFwiJm5ic3A7XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHZhbHVlQ2xhc3NcbiAgICAgICAgICAgICAgICAgICAgdmFsQ2xhc3MgPSBjb2wudmFsdWVDbGFzcyAmJiBvYmpEYXRhLmRhdGEgIT09IG51bGwgJiYgb2JqRGF0YS5kYXRhICE9PSB1bmRlZmluZWQgPyBvYmpEYXRhLmRhdGFbY29sLnZhbHVlQ2xhc3NdIHx8IFwiXCIgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsQ2xhc3MgJiYgY29sLnZhbHVlQ2xhc3NQcmVmaXggJiYgY29sLnZhbHVlQ2xhc3NQcmVmaXggIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbENsYXNzID0gY29sLnZhbHVlQ2xhc3NQcmVmaXggKyB2YWxDbGFzcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHdpZGVWYWx1ZUNsYXNzXG4gICAgICAgICAgICAgICAgICAgIHdpZGVWYWxDbGFzcyA9IGNvbC53aWRlVmFsdWVDbGFzcyAmJiBvYmpEYXRhLmRhdGEgIT09IG51bGwgJiYgb2JqRGF0YS5kYXRhICE9PSB1bmRlZmluZWQgPyBvYmpEYXRhLmRhdGFbY29sLndpZGVWYWx1ZUNsYXNzXSB8fCBcIlwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGVWYWxDbGFzcyAmJiBjb2wud2lkZVZhbHVlQ2xhc3NQcmVmaXggJiYgY29sLndpZGVWYWx1ZUNsYXNzUHJlZml4ICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRlVmFsQ2xhc3MgPSBjb2wud2lkZVZhbHVlQ2xhc3NQcmVmaXggKyB3aWRlVmFsQ2xhc3M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB0aXRsZVxuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IGNvbC50aXRsZSAmJiBvYmpEYXRhLmRhdGEgIT09IG51bGwgJiYgb2JqRGF0YS5kYXRhICE9PSB1bmRlZmluZWQgPyBvYmpEYXRhLmRhdGFbY29sLnRpdGxlXSB8fCBcIlwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgLy8gc3RyaXAgb3V0IEhUTUxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKGh0bWxzdHJpcHJlLCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB3aWR0aFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nbGVmdCA9IDc7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoID0gY29sLndpZHRoIHx8IGRlZmF1bHRXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpZHRoICE9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gdG1wV2lkdGggfHwgKHdpZHRoIC0gcGFkZGluZ2xlZnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGFzdCA9IGRhdGFDZWxsLmNoaWxkcmVuKFwiZGl2I1wiK2dyaWRDZWxsTmFtZStpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFsYXN0IHx8IGxhc3QubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCA9ICQoXCI8ZGl2PjwvZGl2PlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCI8c3Bhbj48L3NwYW4+XCIpLmFwcGVuZFRvKGxhc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hdHRyKFwiaWRcIixncmlkQ2VsbE5hbWUraSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKGdyaWRDZWxsTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LmF0dHIoTk9ERV9EQVRBX0FUVFIsbGlkKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gcHV0IGl0IGluIHRoZSBkYXRhQ2VsbCAtIGFmdGVyIHRoZSBwYXJlbnQsIGJ1dCB0aGUgcG9zaXRpb24gbWF0dGVyc1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vIHBhcmVudCwgdGhlbiB3ZSBhcmUgb25lIG9mIHRoZSByb290IG5vZGVzLCBidXQgc3RpbGwgbmVlZCB0byBsb29rIGF0IHBlZXJzXG5cblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBhcmUgZmlyc3QsIGkuZS4gcG9zID09PSAwLCB3ZSBnbyByaWdodCBhZnRlciB0aGUgcGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBhcmUgbm90IGZpcnN0LCBhbmQgb3VyIHByZXZpb3VzIHBlZXIgKG9uZSBiZWZvcmUgdXMpIGlzIGNsb3NlZCwgd2UgZ28gcmlnaHQgYWZ0ZXIgdGhlIHByZXZpb3VzIHBlZXIgY2VsbFxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBhcmUgbm90IGZpcnN0LCBhbmQgb3VyIHByZXZpb3VzIHBlZXIgaXMgb3BlbmVkLCB0aGVuIHdlIGhhdmUgdG8gZmluZCBpdHMgeW91bmdlc3QgJiBsb3dlc3QgY2xvc2VkIGNoaWxkIChpbmNsLiBsZWFmKVxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBwcm9iYWJseSBiZSBtdWNoIGVhc2llciB0byBnbyAqYmVmb3JlKiBvdXIgbmV4dCBvbmVcbiAgICAgICAgICAgICAgICAgICAgLy8gYnV0IHRoYXQgb25lIG1pZ2h0IG5vdCBiZSBkcmF3biB5ZXRcbiAgICAgICAgICAgICAgICAgICAgLy8gaGVyZSBpcyB0aGUgbG9naWMgZm9yIGpzdHJlZSBkcmF3aW5nOlxuICAgICAgICAgICAgICAgICAgICAvLyAgIGl0IGRyYXdzIHBlZXJzIGZyb20gZmlyc3QgdG8gbGFzdCBvciBmcm9tIGxhc3QgdG8gZmlyc3RcbiAgICAgICAgICAgICAgICAgICAgLy8gICBpdCBkcmF3cyBjaGlsZHJlbiBiZWZvcmUgYSBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgLy8gc28gSSBjYW4gcmVseSBvbiBteSAqcGFyZW50KiBub3QgYmVpbmcgZHJhd24sIGJ1dCBJIGNhbm5vdCByZWx5IG9uIG15IHByZXZpb3VzIHBlZXIgb3IgbXkgbmV4dCBwZWVyIGJlaW5nIGRyYXduXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgZG8gdGhlIGZvbGxvd2luZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gICAxLSBXZSBhcmUgdGhlIGZpcnN0IGNoaWxkOiBpbnN0YWxsIGFmdGVyIHRoZSBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgLy8gICAyLSBPdXIgcHJldmlvdXMgcGVlciBpcyBhbHJlYWR5IGRyYXduOiBpbnN0YWxsIGFmdGVyIHRoZSBwcmV2aW91cyBwZWVyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgMy0gT3VyIHByZXZpb3VzIHBlZXIgaXMgbm90IGRyYXduLCB3ZSBoYXZlIGEgY2hpbGQgdGhhdCBpcyBkcmF3bjogaW5zdGFsbCByaWdodCBiZWZvcmUgb3VyIGZpcnN0IGNoaWxkXG4gICAgICAgICAgICAgICAgICAgIC8vICAgNC0gT3VyIHByZXZpb3VzIHBlZXIgaXMgbm90IGRyYXduLCB3ZSBoYXZlIG5vIGNoaWxkIHRoYXQgaXMgZHJhd24sIG91ciBuZXh0IHBlZXIgaXMgZHJhd246IGluc3RhbGwgcmlnaHQgYmVmb3JlIG91ciBuZXh0IHBlZXJcbiAgICAgICAgICAgICAgICAgICAgLy8gICA1LSBPdXIgcHJldmlvdXMgcGVlciBpcyBub3QgZHJhd24sIHdlIGhhdmUgbm8gY2hpbGQgdGhhdCBpcyBkcmF3biwgb3VyIG5leHQgcGVlciBpcyBub3QgZHJhd246IGluc3RhbGwgcmlnaHQgYWZ0ZXIgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsUHJldklkID0gcG9zIDw9MCA/IG9iakRhdGEucGFyZW50IDogZmluZExhc3RDbG9zZWROb2RlKHRoaXMscGVlcnNbcG9zLTFdKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxQcmV2ID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsUHJldklkKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxOZXh0SWQgPSBwb3MgPj0gcGVlcnMubGVuZ3RoLTEgPyBcIk5VTExcIiA6IHBlZXJzW3BvcysxXTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxOZXh0ID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsTmV4dElkKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxDaGlsZElkID0gb2JqRGF0YS5jaGlsZHJlbiAmJiBvYmpEYXRhLmNoaWxkcmVuLmxlbmd0aCA+IDAgPyBvYmpEYXRhLmNoaWxkcmVuWzBdIDogXCJOVUxMXCI7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsQ2hpbGQgPSBmaW5kRGF0YUNlbGwoZGF0YUNlbGwsZ3JpZENlbGxDaGlsZElkKTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZENlbGxQYXJlbnQgPSBmaW5kRGF0YUNlbGwoZGF0YUNlbGwsZ3JpZENlbGxQYXJlbnRJZCk7XG5cblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBvdXIgcGFyZW50IGlzIGFscmVhZHkgZHJhd24sIHRoZW4gd2UgcHV0IHRoaXMgaW4gdGhlIHJpZ2h0IG9yZGVyIHVuZGVyIG91ciBwYXJlbnRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRDZWxsUGFyZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFBhcmVudCAmJiBncmlkQ2VsbFBhcmVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRDZWxsUHJldiAmJiBncmlkQ2VsbFByZXYubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEFmdGVyKGdyaWRDZWxsUHJldik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChncmlkQ2VsbENoaWxkICYmIGdyaWRDZWxsQ2hpbGQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEJlZm9yZShncmlkQ2VsbENoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRDZWxsTmV4dCAmJiBncmlkQ2VsbE5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEJlZm9yZShncmlkQ2VsbE5leHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuaW5zZXJ0QWZ0ZXIoZ3JpZENlbGxQYXJlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhbHdheXMgcHV0IGl0IGluIHRoZSBob2xkaW5nIGNlbGxzLCBhbmQgdGhlbiBzb3J0IHdoZW4gdGhlIHBhcmVudCBjb21lcyBpbiwgaW4gY2FzZSBwYXJlbnQgaXMgKHJlKWRyYXduIGxhdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBoY1tncmlkQ2VsbE5hbWUraV0gPSBsYXN0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRDZWxsUHJldiAmJiBncmlkQ2VsbFByZXYubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuaW5zZXJ0QWZ0ZXIoZ3JpZENlbGxQcmV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ3JpZENlbGxDaGlsZCAmJiBncmlkQ2VsbENoaWxkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEJlZm9yZShncmlkQ2VsbENoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ3JpZENlbGxOZXh0ICYmIGdyaWRDZWxsTmV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxOZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hcHBlbmRUbyhkYXRhQ2VsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZG8gd2UgaGF2ZSBhbnkgY2hpbGRyZW4gd2FpdGluZyBmb3IgdGhpcyBjZWxsPyB3YWxrIGRvd24gdGhyb3VnaCB0aGUgY2hpbGRyZW4vZ3JhbmRjaGlsZHJlbi9ldGMgdHJlZVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVuZGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuYWZ0ZXIodGhpcy5nZXRIb2xkaW5nQ2VsbHMob2JqRGF0YSxpLGhjKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gbmVlZCB0byBtYWtlIHRoZSBoZWlnaHQgb2YgdGhpcyBtYXRjaCB0aGUgbGluZSBoZWlnaHQgb2YgdGhlIHRyZWUuIEhvdz9cbiAgICAgICAgICAgICAgICAgICAgc3BhbiA9IGxhc3QuY2hpbGRyZW4oXCJzcGFuXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIHNwYW4gaW5zaWRlIHRoZSBkaXYsIHNvIHdlIGNhbiBjb250cm9sIHdoYXQgaGFwcGVucyBpbiB0aGUgd2hvbGUgZGl2IHZlcnN1cyBpbnNpZGUganVzdCB0aGUgdGV4dC9iYWNrZ3JvdW5kXG4gICAgICAgICAgICAgICAgICAgIHNwYW4uYWRkQ2xhc3MoY2wrXCIgXCIrdmFsQ2xhc3MpLmh0bWwoY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBsYXN0LmNzcyhjb25mKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGwganN0cmVlLWdyaWQtY2VsbC1yb290LVwiK3Jvb3RpZCtcIiBqc3RyZWUtZ3JpZC1jZWxsLVwiK2NsYXNzQWRkK1wiIFwiK3djbCsgXCIgXCIgKyB3aWRlVmFsQ2xhc3MgKyAodHI/XCIgdWktc3RhdGUtZGVmYXVsdFwiOlwiXCIpKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNvbC1cIitpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGNsaWNrIGhhbmRsZXIgZm9yIGNsaWNraW5nIGluc2lkZSBhIGdyaWQgY2VsbFxuICAgICAgICAgICAgICAgICAgICBsYXN0LmNsaWNrKGNlbGxDbGlja0hhbmRsZXIodHJlZSx0LHZhbCxjb2wsdGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0Lm9uKFwiY29udGV4dG1lbnVcIixjZWxsUmlnaHRDbGlja0hhbmRsZXIodHJlZSx0LHZhbCxjb2wsdGhpcykpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0LmhvdmVyKGhvdmVySW5IYW5kbGVyKHQsIHRoaXMpLCBob3Zlck91dEhhbmRsZXIodCwgdGhpcykpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5hdHRyKFwidGl0bGVcIix0aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsYXN0LmFkZENsYXNzKFwianN0cmVlLWdyaWQtY2VsbC1sYXN0XCIrKHRyP1wiIHVpLXN0YXRlLWRlZmF1bHRcIjpcIlwiKSk7XG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gd2lkdGggZ2l2ZW4gZm9yIHRoZSBsYXN0IGNvbHVtbiwgZG8gaXQgdmlhIGF1dG9tYXRpY1xuICAgICAgICAgICAgICAgIGlmIChjb2xzW2NvbHMubGVuZ3RoLTFdLndpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdpZHRoLWF1dG9cIikubmV4dChcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3JcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcyh7J292ZXJmbG93LXknOidhdXRvICFpbXBvcnRhbnQnfSk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIGNsZWFuIHVwIGhvbGRpbmcgY2VsbHNcbiAgICAgICAgdGhpcy5ob2xkaW5nQ2VsbHMgPSB7fTtcblxuICAgICAgICAvLyBuZWVkIHRvIGRvIGFsdGVybmF0aW5nIGJhY2tncm91bmQgY29sb3JzIG9yIGJvcmRlcnNcbiAgICB9O1xufSkpO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL2Ntcy9zdGF0aWMvY21zL2pzL2xpYnMvanN0cmVlL2pzdHJlZS5ncmlkLm1pbi5qc1xuICoqIG1vZHVsZSBpZCA9IDEwXG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iLCJ2YXIgJCA9IHJlcXVpcmUoJ2pxdWVyeScpO1xudmFyIENsYXNzID0gcmVxdWlyZSgnY2xhc3NqcycpO1xuXG4vKipcbiAqIERyb3Bkb3ducyBpbiB0aGUgcGFnZXRyZWUuXG4gKiBIYXZlIHRvIGJlIGRlbGVnYXRlZCwgc2luY2UgcGFnZXRyZWUgbm9kZXMgY2FuIGJlXG4gKiBsYXp5IGxvYWRlZC5cbiAqXG4gKiBAY2xhc3MgUGFnZVRyZWVEcm9wZG93bnNcbiAqIEBuYW1lc3BhY2UgQ01TXG4gKi9cbnZhciBQYWdlVHJlZURyb3Bkb3ducyA9IG5ldyBDbGFzcyh7XG4gICAgb3B0aW9uczoge1xuICAgICAgICBkcm9wZG93blNlbGVjdG9yOiAnLmpzLWNtcy1wYWdldHJlZS1kcm9wZG93bicsXG4gICAgICAgIHRyaWdnZXJTZWxlY3RvcjogJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tdHJpZ2dlcicsXG4gICAgICAgIG1lbnVTZWxlY3RvcjogJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tbWVudScsXG4gICAgICAgIG9wZW5DbHM6ICdjbXMtcGFnZXRyZWUtZHJvcGRvd24tbWVudS1vcGVuJ1xuICAgIH0sXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY2xpY2sgPSAnY2xpY2suY21zLnBhZ2V0cmVlLmRyb3Bkb3duJztcblxuICAgICAgICB0aGlzLl9zZXR1cFVJKCk7XG4gICAgICAgIHRoaXMuX2V2ZW50cygpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHRoaXMudWkgPSB7XG4gICAgICAgICAgICBjb250YWluZXI6IHRoaXMub3B0aW9ucy5jb250YWluZXIsXG4gICAgICAgICAgICBkb2N1bWVudDogJChkb2N1bWVudClcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRXZlbnQgaGFuZGxlcnMuXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9ldmVudHNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9ldmVudHM6IGZ1bmN0aW9uIF9ldmVudHMoKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAvLyBhdHRhY2ggZXZlbnQgdG8gdGhlIHRyaWdnZXJcbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgdGhpcy5vcHRpb25zLnRyaWdnZXJTZWxlY3RvciwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHRoYXQuX3RvZ2dsZURyb3Bkb3duKHRoaXMpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzdG9wIHByb3BhZ2F0aW9uIG9uIHRoZSBlbGVtZW50XG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRoYXQub3B0aW9ucy5tZW51U2VsZWN0b3IsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGF0Lm9wdGlvbnMubWVudVNlbGVjdG9yICsgJyBhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhhdC5jbG9zZUFsbERyb3Bkb3ducygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnVpLmRvY3VtZW50Lm9uKHRoaXMuY2xpY2ssIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuY2xvc2VBbGxEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3RvZ2dsZURyb3Bkb3duXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IHRyaWdnZXIgdHJpZ2dlciBjbGlja2VkXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbnx2b2lkfVxuICAgICAqL1xuICAgIF90b2dnbGVEcm9wZG93bjogZnVuY3Rpb24gX3RvZ2dsZURyb3Bkb3duKHRyaWdnZXIpIHtcbiAgICAgICAgdmFyIGRyb3Bkb3ducyA9ICQodGhpcy5vcHRpb25zLmRyb3Bkb3duU2VsZWN0b3IpO1xuICAgICAgICB2YXIgZHJvcGRvd24gPSAkKHRyaWdnZXIpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmRyb3Bkb3duU2VsZWN0b3IpO1xuXG4gICAgICAgIC8vIGNhbmNlbCBpZiBvcGVuZWQgdG9vbHRpcCBpcyB0cmlnZ2VyZWQgYWdhaW5cbiAgICAgICAgaWYgKGRyb3Bkb3duLmhhc0NsYXNzKHRoaXMub3B0aW9ucy5vcGVuQ2xzKSkge1xuICAgICAgICAgICAgZHJvcGRvd25zLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5vcGVuQ2xzKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG90aGVyd2lzZSBzaG93IHRoZSBkcm9wZG93blxuICAgICAgICBkcm9wZG93bnMucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLm9wZW5DbHMpO1xuICAgICAgICBkcm9wZG93bi5hZGRDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscyk7XG5cbiAgICAgICAgdGhpcy5fbG9hZENvbnRlbnQoZHJvcGRvd24pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9sb2FkQ29udGVudFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IGRyb3Bkb3duXG4gICAgICogQHJldHVybnMge0Jvb2xlYW58JC5EZWZlcnJlZH0gZmFsc2UgaWYgbm90IGxhenkgb3IgYWxyZWFkeSBsb2FkZWQgb3IgcHJvbWlzZVxuICAgICAqL1xuICAgIF9sb2FkQ29udGVudDogZnVuY3Rpb24gX2xvYWRDb250ZW50KGRyb3Bkb3duKSB7XG4gICAgICAgIHZhciBkYXRhID0gZHJvcGRvd24uZGF0YSgpO1xuICAgICAgICB2YXIgTE9BREVSX1NIT1dfVElNRU9VVCA9IDIwMDtcblxuICAgICAgICBpZiAoIWRhdGEubGF6eVVybCB8fCBkYXRhLmxvYWRlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGxvYWRlclRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRyb3Bkb3duLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tbG9hZGVyJykuYWRkQ2xhc3MoJ2Ntcy1sb2FkZXInKTtcbiAgICAgICAgfSwgTE9BREVSX1NIT1dfVElNRU9VVCk7XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogZGF0YS5sYXp5VXJsLFxuICAgICAgICAgICAgZGF0YTogZGF0YS5sYXp5VXJsRGF0YVxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgZHJvcGRvd24uZmluZCgnLmpzLWNtcy1wYWdldHJlZS1kcm9wZG93bi1tZW51JykuaHRtbChyZXNwb25zZSk7XG4gICAgICAgICAgICBkcm9wZG93bi5kYXRhKCdsb2FkZWQnLCB0cnVlKTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChsb2FkZXJUaW1lb3V0KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY2xvc2VBbGxEcm9wZG93bnNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgY2xvc2VBbGxEcm9wZG93bnM6IGZ1bmN0aW9uIGNsb3NlQWxsRHJvcGRvd25zKCkge1xuICAgICAgICAkKHRoaXMub3B0aW9ucy5kcm9wZG93blNlbGVjdG9yKS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscyk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gUGFnZVRyZWVEcm9wZG93bnM7XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vY21zL3N0YXRpYy9jbXMvanMvbW9kdWxlcy9jbXMucGFnZXRyZWUuZHJvcGRvd24uanNcbiAqKiBtb2R1bGUgaWQgPSAxMVxuICoqIG1vZHVsZSBjaHVua3MgPSAyXG4gKiovIiwiLypcbiAqIENvcHlyaWdodCBodHRwczovL2dpdGh1Yi5jb20vZGl2aW8vZGphbmdvLWNtc1xuICovXG5cbnZhciAkID0gcmVxdWlyZSgnanF1ZXJ5Jyk7XG52YXIgQ2xhc3MgPSByZXF1aXJlKCdjbGFzc2pzJyk7XG52YXIgSGVscGVycyA9IHJlcXVpcmUoJy4vY21zLmJhc2UnKS5BUEkuSGVscGVycztcblxuLyoqXG4gKiBTdGlja3kgbGFuZ3VhZ2UgaGVhZGVycyBpbiBwYWdldHJlZVxuICpcbiAqIEBjbGFzcyBQYWdlVHJlZVN0aWNreUhlYWRlclxuICogQG5hbWVzcGFjZSBDTVNcbiAqL1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gbmV3IENsYXNzKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGF0Lm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB0aGF0LnJlc2l6ZSA9ICdyZXNpemUuY21zLnBhZ2V0cmVlLmhlYWRlcic7XG4gICAgICAgIHRoYXQuc2Nyb2xsID0gJ3Njcm9sbC5jbXMucGFnZXRyZWUuaGVhZGVyJztcbiAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IGZhbHNlO1xuXG4gICAgICAgIHRoYXQuX3NldHVwVUkoKTtcbiAgICAgICAgdGhhdC5fc2F2ZVNpemVzKCk7XG4gICAgICAgIHRoYXQuX2V2ZW50cygpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGNvbnRhaW5lci5maW5kKCcuanN0cmVlLWdyaWQtaGVhZGVyJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgd2luZG93OiAkKHdpbmRvdyksXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgY29sdW1uczogY29udGFpbmVyLmZpbmQoJy5qc3RyZWUtZ3JpZC1jb2x1bW4nKS50b0FycmF5KCkubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKGVsKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2xvbmVzOiBoZWFkZXJzLmNsb25lKCkudG9BcnJheSgpLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJChlbCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgcG9zaXRpb25zL3NpemVzIG9mIGVsZW1lbnRzXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zYXZlU2l6ZXNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zYXZlU2l6ZXM6IGZ1bmN0aW9uIF9zYXZlU2l6ZXMoKSB7XG4gICAgICAgIHRoaXMuaGVhZGVyc1RvcE9mZnNldCA9IHRoaXMudWkuaGVhZGVycy5vZmZzZXQoKS50b3A7XG4gICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IDA7XG4gICAgICAgIGlmICh0aGlzLl9pc0luU2lkZWZyYW1lKCkpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IENNUy5BUEkuSGVscGVycy5fZ2V0V2luZG93KCkucGFyZW50LkNNUy4kKCcuY21zLXRvb2xiYXInKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIHZhciBkZWJ1ZyA9IEhlbHBlcnMuX2dldFdpbmRvdygpLnBhcmVudC5DTVMuJCgnLmNtcy1kZWJ1Zy1iYXInKTtcblxuICAgICAgICAgICAgaWYgKGRlYnVnLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCArPSBkZWJ1Zy5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b29sYmFySGVpZ2h0ID0gJCgnI2JyYW5kaW5nJykuaGVpZ2h0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfaXNJblNpZGVmcmFtZVxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBhcmUgd2UgaW4gc2lkZWZyYW1lP1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2lzSW5TaWRlZnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuXG4gICAgICAgIGlmICh3aW4gJiYgd2luLnBhcmVudCAmJiB3aW4ucGFyZW50ICE9PSB3aW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFdmVudCBoYW5kbGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgdGhpcy51aS53aW5kb3cub24oXG4gICAgICAgICAgICBbdGhpcy5yZXNpemUsIHRoaXMuc2Nyb2xsXS5qb2luKCcgJyksXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVSZXNpemVPclNjcm9sbC5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2hhbmRsZVJlc2l6ZU9yU2Nyb2xsXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaGFuZGxlUmVzaXplT3JTY3JvbGw6IGZ1bmN0aW9uIF9oYW5kbGVSZXNpemVPclNjcm9sbCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2Nyb2xsVG9wID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsVG9wKCk7XG4gICAgICAgIHZhciBzY3JvbGxMZWZ0ID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsTGVmdCgpO1xuXG4gICAgICAgIGlmICh0aGF0Ll9zaG91bGRTdGljayhzY3JvbGxUb3ApKSB7XG4gICAgICAgICAgICB0aGF0Ll9zdGlja0hlYWRlcihzY3JvbGxUb3AsIHNjcm9sbExlZnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhhdC5fdW5zdGlja0hlYWRlcigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Nob3VsZFN0aWNrXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcCBwb3NpdGlvbiBpbiBwaXhlbHNcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gc2hvdWxkIGhlYWRlcnMgc3RpY2tcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zaG91bGRTdGljazogZnVuY3Rpb24gKHNjcm9sbFRvcCkge1xuICAgICAgICByZXR1cm4gc2Nyb2xsVG9wICsgdGhpcy50b29sYmFySGVpZ2h0ID49IHRoaXMuaGVhZGVyc1RvcE9mZnNldDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc3RpY2tIZWFkZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2Nyb2xsVG9wIHRvcFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzY3JvbGxMZWZ0IGxlZnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zdGlja0hlYWRlcjogZnVuY3Rpb24gX3N0aWNrSGVhZGVyKHNjcm9sbFRvcCwgc2Nyb2xsTGVmdCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC5faW5zZXJ0Q2xvbmVzKCk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB0aGF0LnVpLmNsb25lc1tpbmRleF0uY3NzKCd3aWR0aCcpO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoYXQudWkuY2xvbmVzW2luZGV4XS5vZmZzZXQoKS5sZWZ0O1xuXG4gICAgICAgICAgICBlbC5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBvZmZzZXQgLSBzY3JvbGxMZWZ0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmFkZENsYXNzKCdqc3RyZWUtZ3JpZC1oZWFkZXItZml4ZWQnKS5jc3Moe1xuICAgICAgICAgICAgdG9wOiB0aGF0LnRvb2xiYXJIZWlnaHRcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Vuc3RpY2tIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91bnN0aWNrSGVhZGVyOiBmdW5jdGlvbiBfdW5zdGlja0hlYWRlcigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQuX2RldGFjaENsb25lcygpO1xuXG4gICAgICAgIHRoYXQudWkuaGVhZGVycy5yZW1vdmVDbGFzcygnanN0cmVlLWdyaWQtaGVhZGVyLWZpeGVkJykuY3NzKHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICBsZWZ0OiAnYXV0bydcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluc2VydHMgY2xvbmVzIG9mIGhlYWRlcnMgc28gd2hlbiBoZWFkZXIgYmVjb21lcyBzdGlja3kgdGhlXG4gICAgICogcGFnZXRyZWUgZG9lc24ndCBqdW1wLiBPbmx5IGRvZXMgaXQgb25jZSBhbmQgc2V0cyB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2luc2VydENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luc2VydENsb25lczogZnVuY3Rpb24gX2luc2VydENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhhdC5hcmVDbG9uZXNJbkRPTSkge1xuICAgICAgICAgICAgdGhhdC51aS5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGVsLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIGVsLnByZXBlbmQodGhhdC51aS5jbG9uZXNbaW5kZXhdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXRhY2hlcyB0aGUgY2xvbmVzIG9mIGhlYWRlcnMgc28gdGhlbiBoZWFkZXJzIFwidW5zdGlja3NcIlxuICAgICAqIHRoZSBwYWdldHJlZSBkb2Vzbid0IGp1bXAuIFJlbGllcyBvbiB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2RldGFjaENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2RldGFjaENsb25lczogZnVuY3Rpb24gX2RldGFjaENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0aGF0LmFyZUNsb25lc0luRE9NKSB7XG4gICAgICAgICAgICB0aGF0LnVpLmNsb25lcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIGVsLmRldGFjaCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGF0LmFyZUNsb25lc0luRE9NID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhZ2VUcmVlU3RpY2t5SGVhZGVyO1xuXG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiAuL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLnN0aWNreWhlYWRlci5qc1xuICoqIG1vZHVsZSBpZCA9IDEyXG4gKiogbW9kdWxlIGNodW5rcyA9IDJcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9
>>>>>>> 344010a... adding, editing, removing in structureboard
=======
/***/ })

},[108]);
>>>>>>> bce127b... webpack setup
=======
cmsWebpackJsonp([1],{105:function(e,t,i){var r,s,n;!function(a){s=[i(0),i(85)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e){var t,i,r,s,n=/^\s*$/g,a=function(e){return(e||"").replace(/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,"\\$&")},o=!1,d=function(e,t){return e.find("div[data-jstreegrid='"+t+"']")},l=!1,c=null,h=0,_=0;r=/<\/?[^>]+>/gi,i=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||24,n.detach(),r.remove(),i._gridSettings.indent=a),a},s=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:s(e,r[r.length-1])},t=function(e,t,i){var s,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];s="",a.title&&("_DATA_"===a.title?s=i.get_text(t):t.attr(a.title)&&(s=t.attr(a.title))),(s=s.replace(r,""))&&n.attr("title",s)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,u){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},d=a.columns,l=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){l=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=l,this.rootid=s.attr("id");if(/msie/.test(navigator.userAgent.toLowerCase())){parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<d.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+l+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){u.init.call(this,e,t),this._initialize()},this.bind=function(){u.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)d(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&d(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,d(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)d(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&d(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),u.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?d(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,u=this._gridSettings,g=u.columns||[],f=u.columnWidth,p=u.resizable||!1,m=u.isThemeroller,v=m?"themeroller":"regular",j=!1,y=this.gridparent,k=u.defaultConf,x=0,b=0;for(this.parent=y,t=0;t<g.length;t++)s=g[t].headerClass||"",n=g[t].columnClass||"",a=g[t].header||"",a&&(j=!0),r=g[t].width||f,x=m?7:10,"auto"!==r&&"string"!=typeof r&&(r-=x),o=0===t?3:0,i=this.midWrapper.children("div.jstree-grid-column-"+t),d=e("<div></div>").css(k).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(m?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+v+" "+s+" "+n).html(a),d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+v),d.prependTo(i),b+=d.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+v+(m?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),i.width(r),i.css("min-width",r),i.css("max-width",r);d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+v),void 0===g[g.length-1].width&&(b-=r,i.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?u.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&p&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(l){for(o=c.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=c.parent().children("div.jstree-grid-column"),s=[],isNaN(0)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),l=!1,c=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:0===t},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(l){_=e.pageX;var t,i,r,s=_-h;0!==s&&(t=c.width(),i=parseFloat(c.css("width")),i||(i=c.innerWidth()),s=s<0?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(c.width(r),c.css("min-width",r),c.css("max-width",r),h=_))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return l=!0,h=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=i<0?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,r){return e=u.redraw_node.call(this,e,t,i,r),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),u.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)d(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,o=e(),d=t.children||[];for(n=0;n<d.length;n++)s="jsgrid_"+a(d[n])+"_col"+i,r[s]&&t.state.opened&&(o=o.add(r[s]).add(this.getHoldingCells(this.get_node(d[n]),i,r)));return o},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(i){var o,l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L=this._gridSettings,H=L.treeClass,z=this,M=L.columns||[],W=L.isThemeroller,K=this.element,q=this.rootid,$=W?"themeroller":"regular",F=this.get_node(i),U=L.columnWidth,Y=L.defaultConf,X=this.midWrapper,J=F.id,B=this.get_node(F.parent).children,V=e.inArray(J,B),R=this.holdingCells,G=!1;if(o=e(i),p=o.children("a"),1===p.length){for(!F.state.opened,b="jsgrid_"+a(J)+"_col",w="#"===F.parent?null:F.parent,p.addClass(H),t(p,o,z),m=p,h=0;h<M.length;h++)this.treecol!==h&&(E=M[h],D=X.children("div:eq("+h+")"),u=E.cellClass||"",g=E.wideCellClass||"",f=E.columnClass||"",D.addClass(f),_=void 0!==E.value&&null!==E.value?"function"==typeof E.value?E.value(F):null!==F.data&&void 0!==F.data&&void 0!==F.data[E.value]?F.data[E.value]:"":"","function"==typeof E.format&&(_=E.format(_)),E.images?(c=E.images[_]||E.images.default)&&(I="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">'):I=_,(void 0===I||null===I||n.test(I))&&(I="&nbsp;"),v=E.valueClass&&null!==F.data&&void 0!==F.data?F.data[E.valueClass]||"":"",v&&E.valueClassPrefix&&""!==E.valueClassPrefix&&(v=E.valueClassPrefix+v),j=E.wideValueClass&&null!==F.data&&void 0!==F.data?F.data[E.wideValueClass]||"":"",j&&E.wideValueClassPrefix&&""!==E.wideValueClassPrefix&&(j=E.wideValueClassPrefix+j),x=E.title&&null!==F.data&&void 0!==F.data?F.data[E.title]||"":"",x=x.replace(r,""),k=7,l=E.width||U,"auto"!==l&&(l-=k),m=D.children("div#"+b+h),(!m||m.length<1)&&(m=e("<div></div>"),e("<span></span>").appendTo(m),m.attr("id",b+h),m.addClass(b),m.attr("data-jstreegrid",J)),T=V<=0?F.parent:s(this,B[V-1]),S=d(D,T),A=V>=B.length-1?"NULL":B[V+1],N=d(D,A),P=F.children&&F.children.length>0?F.children[0]:"NULL",O=d(D,P),C=d(D,w),w?(C&&C.length>0?(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.insertAfter(C),G=!0):G=!1,R[b+h]=m):(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.appendTo(D),G=!0),G&&m.after(this.getHoldingCells(F,h,R)),y=m.children("span"),y.addClass(u+" "+v).html(I),m=m.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+q+" jstree-grid-cell-"+$+" "+g+" "+j+(W?" ui-state-default":"")).addClass("jstree-grid-col-"+h),m.click(function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}}(K,o,_,E)),m.on("contextmenu",function(t,i,r,s,n){return function(t){L.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);z._edit(r,s,t.target)}}}))}}(0,o,0,E,this)),m.hover(function(e,t){return function(){t.hover_node(e)}}(o,this),function(e,t){return function(){t.dehover_node(e)}}(o,this)),x&&y.attr("title",x));m.addClass("jstree-grid-cell-last"+(W?" ui-state-default":"")),void 0===M[M.length-1].width&&m.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},108:function(e,t,i){i(18),i(19);var r=i(1).default;window.CMS=r,r.PageTree=i(99).default},109:function(e,t,i){var r=i(0),s=i(4),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);if(i.hasClass(this.options.openCls))return t.removeClass(this.options.openCls),!1;t.removeClass(this.options.openCls),i.addClass(this.options.openCls),this._loadContent(i)},_loadContent:function(e){var t=e.data();if(!t.lazyUrl||t.loaded)return!1;var i=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},200);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(i)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},110:function(e,t,i){var r=i(0),s=i(4),n=i(1).default.API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a},85:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(0)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||!0===i)&&(n=a||!1),(null===n||n===t)&&void 0}),null!==n&&n!==t?n:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,r){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){!1===r?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(s=this._parse_model_from_html(e(i),d,_.parents.concat()))&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do{l="j"+_+"_"+ ++u}while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&void 0!==window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=!d.hasClass("jstree-themeicon-hidden")&&d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)(t=this.redraw_node(s[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):!!r&&r.call(this,e,!1)}):(r&&r.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),!0===e.state.hidden},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))))},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,s,n)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return!!(m=this.copy_node(i,r,s,n,a,!1,d))&&(g&&g.delete_node(i),m);switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,m.id,m.parents.concat())))return!1;for(_=this.get_node(f),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1))},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=i.icon,i.icon=!0===r||null===r||r===t||""===r||r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===r?this.hide_icon(i):!0===r||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),!1===o&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),!1===o&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),!1===o&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)(n=o[a.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[r],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(s=0,n=a.children_d.length;n>s;s++)this._model.data[a.children_d[s]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0))&&(n+=s),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"))&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})))){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),!0===g))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}));p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0))&&d.settings.core.error.call(this,r);s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==s&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),(d=this.get_node(t[a],!0))&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)(d=this.get_node(t[a],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)(d=this.get_node(t[l],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(!1===i||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=!!c.ajax&&c.ajax,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&!0===this.open_node(f[d],null,0)&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=r.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),!1!==r.fuzzy&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),-1!==(y=e.lastIndexOf(t,d+h))&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],p[o]=0===i?(p[o+1]<<1|1)&m:(p[o+1]<<1|1)&m|(u[o+1]|u[o])<<1|1|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},!0===i?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types.default)s.types.default.hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types.default[a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,!0===o[d[s]].icon&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr.class=l[c].li_attr.class+" "+o[d[s]].li_attr.class)}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr.class=l[c].a_attr.class+" "+o[d[s]].a_attr.class)}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(!1===l)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(!1===r.check.call(this,i,s,n,a,o))return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(!0===d||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon===t||s[r].icon),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr.class=s[r].li_attr[l]+" "+_[i.id].li_attr.class,c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr.class=s[r].a_attr.class+" "+_[i.id].a_attr.class,h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(!1===r.check.call(this,t,i,s,n,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}})},99:function(e,t,i){var r=i(0);i(85),i(105);var s=i(4),n=i(1).default.API.Helpers,a=i(1).default.KEYS,o=i(109),d=i(110),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){r(i.element).parent().removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);if(i.parent().hasClass("active"))return!1;e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar");_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},200),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"!==e.id&&"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l}},[108]);
>>>>>>> c82ee45... production bundles
=======
cmsWebpackJsonp([1],{100:function(e,t,i){var r=i(0);i(86),i(106);var s=i(4),n=i(1).default.API.Helpers,a=i(1).default.KEYS,o=i(110),d=i(111),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){r(i.element).parent().removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);if(i.parent().hasClass("active"))return!1;e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar");_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},200),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"!==e.id&&"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},106:function(e,t,i){var r,s,n;!function(a){s=[i(0),i(86)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e){var t,i,r,s,n=/^\s*$/g,a=function(e){return(e||"").replace(/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,"\\$&")},o=!1,d=function(e,t){return e.find("div[data-jstreegrid='"+t+"']")},l=!1,c=null,h=0,_=0;r=/<\/?[^>]+>/gi,i=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||24,n.detach(),r.remove(),i._gridSettings.indent=a),a},s=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:s(e,r[r.length-1])},t=function(e,t,i){var s,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];s="",a.title&&("_DATA_"===a.title?s=i.get_text(t):t.attr(a.title)&&(s=t.attr(a.title))),(s=s.replace(r,""))&&n.attr("title",s)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,u){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},d=a.columns,l=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){l=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=l,this.rootid=s.attr("id");if(/msie/.test(navigator.userAgent.toLowerCase())){parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<d.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+l+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){u.init.call(this,e,t),this._initialize()},this.bind=function(){u.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)d(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&d(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,d(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)d(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&d(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),u.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?d(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,u=this._gridSettings,g=u.columns||[],f=u.columnWidth,p=u.resizable||!1,m=u.isThemeroller,v=m?"themeroller":"regular",j=!1,y=this.gridparent,k=u.defaultConf,x=0,b=0;for(this.parent=y,t=0;t<g.length;t++)s=g[t].headerClass||"",n=g[t].columnClass||"",a=g[t].header||"",a&&(j=!0),r=g[t].width||f,x=m?7:10,"auto"!==r&&"string"!=typeof r&&(r-=x),o=0===t?3:0,i=this.midWrapper.children("div.jstree-grid-column-"+t),d=e("<div></div>").css(k).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(m?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+v+" "+s+" "+n).html(a),d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+v),d.prependTo(i),b+=d.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+v+(m?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),i.width(r),i.css("min-width",r),i.css("max-width",r);d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+v),void 0===g[g.length-1].width&&(b-=r,i.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?u.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&p&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(l){for(o=c.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=c.parent().children("div.jstree-grid-column"),s=[],isNaN(0)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),l=!1,c=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:0===t},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(l){_=e.pageX;var t,i,r,s=_-h;0!==s&&(t=c.width(),i=parseFloat(c.css("width")),i||(i=c.innerWidth()),s=s<0?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(c.width(r),c.css("min-width",r),c.css("max-width",r),h=_))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return l=!0,h=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=i<0?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,r){return e=u.redraw_node.call(this,e,t,i,r),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),u.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)d(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,o=e(),d=t.children||[];for(n=0;n<d.length;n++)s="jsgrid_"+a(d[n])+"_col"+i,r[s]&&t.state.opened&&(o=o.add(r[s]).add(this.getHoldingCells(this.get_node(d[n]),i,r)));return o},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(i){var o,l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L=this._gridSettings,H=L.treeClass,z=this,M=L.columns||[],W=L.isThemeroller,K=this.element,q=this.rootid,$=W?"themeroller":"regular",F=this.get_node(i),U=L.columnWidth,Y=L.defaultConf,X=this.midWrapper,J=F.id,B=this.get_node(F.parent).children,V=e.inArray(J,B),R=this.holdingCells,G=!1;if(o=e(i),p=o.children("a"),1===p.length){for(!F.state.opened,b="jsgrid_"+a(J)+"_col",w="#"===F.parent?null:F.parent,p.addClass(H),t(p,o,z),m=p,h=0;h<M.length;h++)this.treecol!==h&&(E=M[h],D=X.children("div:eq("+h+")"),u=E.cellClass||"",g=E.wideCellClass||"",f=E.columnClass||"",D.addClass(f),_=void 0!==E.value&&null!==E.value?"function"==typeof E.value?E.value(F):null!==F.data&&void 0!==F.data&&void 0!==F.data[E.value]?F.data[E.value]:"":"","function"==typeof E.format&&(_=E.format(_)),E.images?(c=E.images[_]||E.images.default)&&(I="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">'):I=_,(void 0===I||null===I||n.test(I))&&(I="&nbsp;"),v=E.valueClass&&null!==F.data&&void 0!==F.data?F.data[E.valueClass]||"":"",v&&E.valueClassPrefix&&""!==E.valueClassPrefix&&(v=E.valueClassPrefix+v),j=E.wideValueClass&&null!==F.data&&void 0!==F.data?F.data[E.wideValueClass]||"":"",j&&E.wideValueClassPrefix&&""!==E.wideValueClassPrefix&&(j=E.wideValueClassPrefix+j),x=E.title&&null!==F.data&&void 0!==F.data?F.data[E.title]||"":"",x=x.replace(r,""),k=7,l=E.width||U,"auto"!==l&&(l-=k),m=D.children("div#"+b+h),(!m||m.length<1)&&(m=e("<div></div>"),e("<span></span>").appendTo(m),m.attr("id",b+h),m.addClass(b),m.attr("data-jstreegrid",J)),T=V<=0?F.parent:s(this,B[V-1]),S=d(D,T),A=V>=B.length-1?"NULL":B[V+1],N=d(D,A),P=F.children&&F.children.length>0?F.children[0]:"NULL",O=d(D,P),C=d(D,w),w?(C&&C.length>0?(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.insertAfter(C),G=!0):G=!1,R[b+h]=m):(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.appendTo(D),G=!0),G&&m.after(this.getHoldingCells(F,h,R)),y=m.children("span"),y.addClass(u+" "+v).html(I),m=m.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+q+" jstree-grid-cell-"+$+" "+g+" "+j+(W?" ui-state-default":"")).addClass("jstree-grid-col-"+h),m.click(function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}}(K,o,_,E)),m.on("contextmenu",function(t,i,r,s,n){return function(t){L.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);z._edit(r,s,t.target)}}}))}}(0,o,0,E,this)),m.hover(function(e,t){return function(){t.hover_node(e)}}(o,this),function(e,t){return function(){t.dehover_node(e)}}(o,this)),x&&y.attr("title",x));m.addClass("jstree-grid-cell-last"+(W?" ui-state-default":"")),void 0===M[M.length-1].width&&m.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},109:function(e,t,i){i(18),i(19);var r=i(1).default;window.CMS=r,r.PageTree=i(100).default},110:function(e,t,i){var r=i(0),s=i(4),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);if(i.hasClass(this.options.openCls))return t.removeClass(this.options.openCls),!1;t.removeClass(this.options.openCls),i.addClass(this.options.openCls),this._loadContent(i)},_loadContent:function(e){var t=e.data();if(!t.lazyUrl||t.loaded)return!1;var i=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},200);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(i)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},111:function(e,t,i){var r=i(0),s=i(4),n=i(1).default.API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a},86:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(0)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||!0===i)&&(n=a||!1),(null===n||n===t)&&void 0}),null!==n&&n!==t?n:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,r){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){!1===r?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(s=this._parse_model_from_html(e(i),d,_.parents.concat()))&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do{l="j"+_+"_"+ ++u}while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&void 0!==window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=!d.hasClass("jstree-themeicon-hidden")&&d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)(t=this.redraw_node(s[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):!!r&&r.call(this,e,!1)}):(r&&r.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),!0===e.state.hidden},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))))},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,s,n)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return!!(m=this.copy_node(i,r,s,n,a,!1,d))&&(g&&g.delete_node(i),m);switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,m.id,m.parents.concat())))return!1;for(_=this.get_node(f),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1))},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=i.icon,i.icon=!0===r||null===r||r===t||""===r||r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===r?this.hide_icon(i):!0===r||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),!1===o&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),!1===o&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),!1===o&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)(n=o[a.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[r],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(s=0,n=a.children_d.length;n>s;s++)this._model.data[a.children_d[s]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0))&&(n+=s),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"))&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})))){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),!0===g))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}));p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0))&&d.settings.core.error.call(this,r);s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==s&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),(d=this.get_node(t[a],!0))&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)(d=this.get_node(t[a],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)(d=this.get_node(t[l],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(!1===i||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=!!c.ajax&&c.ajax,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&!0===this.open_node(f[d],null,0)&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=r.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),!1!==r.fuzzy&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),-1!==(y=e.lastIndexOf(t,d+h))&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],p[o]=0===i?(p[o+1]<<1|1)&m:(p[o+1]<<1|1)&m|(u[o+1]|u[o])<<1|1|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},!0===i?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types.default)s.types.default.hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types.default[a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,!0===o[d[s]].icon&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr.class=l[c].li_attr.class+" "+o[d[s]].li_attr.class)}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr.class=l[c].a_attr.class+" "+o[d[s]].a_attr.class)}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(!1===l)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(!1===r.check.call(this,i,s,n,a,o))return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(!0===d||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon===t||s[r].icon),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr.class=s[r].li_attr[l]+" "+_[i.id].li_attr.class,c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr.class=s[r].a_attr.class+" "+_[i.id].a_attr.class,h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(!1===r.check.call(this,t,i,s,n,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}})}},[109]);
>>>>>>> 4929218... structureboard state
=======
eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*\n * https://github.com/deitch/jstree-grid\n *\n * This plugin handles adding a grid to a tree to display additional data\n *\n * Licensed under the MIT license:\n *   http://www.opensource.org/licenses/mit-license.php\n *\n * Works only with jstree version >= 3.0.0\n *\n * $Date: 2015-11-29 $\n * $Revision:  3.4.2 $\n *\n * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n * !!!                                                                         !!!\n * !!!   IMPORTANT it says 3.4.2 but it's actually 3.4.4, and it's modified!   !!!\n * !!!   line 646, same as: https://github.com/deitch/jstree-grid/pull/165     !!!\n * !!!                                                                         !!!\n * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n */\n\n/*jslint nomen:true */\n/*jshint unused:vars */\n/*global navigator, document, jQuery, define */\n\n/* AMD support added by jochenberger per https://github.com/deitch/jstree-grid/pull/49\n *\n */\n(function (factory) {\n    if (true) {\n        // AMD. Register as an anonymous module.\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0), __webpack_require__(86)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n}(function ($) {\n    var renderAWidth, renderATitle, getIndent, htmlstripre, findLastClosedNode, BLANKRE = /^\\s*$/g,\n        IDREGEX = /[\\\\:&!^|()\\[\\]<>@*'+~#\";,= \\/${}%]/g, escapeId = function (id) {\n            return (id||\"\").replace(IDREGEX,'\\\\$&');\n        }, NODE_DATA_ATTR = \"data-jstreegrid\",\n    SPECIAL_TITLE = \"_DATA_\", LEVELINDENT = 24, styled = false, GRIDCELLID_PREFIX = \"jsgrid_\",GRIDCELLID_POSTFIX = \"_col\",\n        findDataCell = function (from,id) {\n            return from.find(\"div[\"+NODE_DATA_ATTR+\"='\"+id+\"']\");\n        },\n        isClickedSep = false, toResize = null, oldMouseX = 0, newMouseX = 0;\n\n    /*jslint regexp:true */\n    htmlstripre = /<\\/?[^>]+>/gi;\n    /*jslint regexp:false */\n\n    getIndent = function(node,tree) {\n        var div, i, li, width;\n\n        // did we already save it for this tree?\n        tree._gridSettings = tree._gridSettings || {};\n        if (tree._gridSettings.indent > 0) {\n            width = tree._gridSettings.indent;\n        } else {\n            // create a new div on the DOM but not visible on the page\n            div = $(\"<div></div>\");\n            i = node.prev(\"i\");\n            li = i.parent();\n            // add to that div all of the classes on the tree root\n            div.addClass(tree.get_node(\"#\",true).attr(\"class\"));\n\n            // move the li to the temporary div root\n            li.appendTo(div);\n\n            // attach to the body quickly\n            div.appendTo($(\"body\"));\n\n            // get the width\n            width = i.width() || LEVELINDENT;\n\n            // detach the li from the new div and destroy the new div\n            li.detach();\n            div.remove();\n\n            // save it for the future\n            tree._gridSettings.indent = width;\n        }\n\n\n        return(width);\n\n    };\n\n    findLastClosedNode = function (tree,id) {\n        // first get our node\n        var ret, node = tree.get_node(id), children = node.children;\n        // is it closed?\n        if (!children || children.length <= 0 || !node.state.opened) {\n            ret = id;\n        } else {\n            ret = findLastClosedNode(tree,children[children.length-1]);\n        }\n        return(ret);\n    };\n\n    renderAWidth = function(node,tree) {\n        var depth, width,\n        fullWidth = parseInt(tree.settings.grid.columns[0].width,10) + parseInt(tree._gridSettings.treeWidthDiff,10);\n        // need to use a selector in jquery 1.4.4+\n        depth = tree.get_node(node).parents.length;\n        width = fullWidth - depth*getIndent(node,tree);\n        // the following line is no longer needed, since we are doing this inside a <td>\n        //a.css({\"vertical-align\": \"top\", \"overflow\":\"hidden\"});\n        return(fullWidth);\n    };\n    renderATitle = function(node,t,tree) {\n        var a = node.get(0).tagName.toLowerCase() === \"a\" ? node : node.children(\"a\"), title, col = tree.settings.grid.columns[0];\n        // get the title\n        title = \"\";\n        if (col.title) {\n            if (col.title === SPECIAL_TITLE) {\n                title = tree.get_text(t);\n            } else if (t.attr(col.title)) {\n                title = t.attr(col.title);\n            }\n        }\n        // strip out HTML\n        title = title.replace(htmlstripre, '');\n        if (title) {\n            a.attr(\"title\",title);\n        }\n    };\n\n    $.jstree.defaults.grid = {\n        width: 'auto'\n    };\n\n    $.jstree.plugins.grid = function(options,parent) {\n        this._initialize = function () {\n            if (!this._initialized) {\n                var s = this.settings.grid || {}, styles,    container = this.element, gridparent = container.parent(), i,\n                gs = this._gridSettings = {\n                    columns : s.columns || [],\n                    treeClass : \"jstree-grid-col-0\",\n                    context: s.contextmenu || false,\n                    columnWidth : s.columnWidth,\n                    defaultConf : {\"*display\":\"inline\",\"*+display\":\"inline\"},\n                    isThemeroller : !!this._data.themeroller,\n                    treeWidthDiff : 0,\n                    resizable : s.resizable,\n                    indent: 0\n                }, cols = gs.columns, treecol = 0;\n                // find which column our tree shuld go in\n                for (i=0;i<s.columns.length;i++) {\n                    if (s.columns[i].tree) {\n                        // save which column it was\n                        treecol = i;\n                        // do not check any others\n                        break;\n                    }\n                }\n                // set a unique ID for this table\n                this.uniq = Math.ceil(Math.random()*1000);\n                this.treecol = treecol;\n                this.rootid = container.attr(\"id\");\n\n                var msie = /msie/.test(navigator.userAgent.toLowerCase());\n                if (msie) {\n                    var version = parseFloat(navigator.appVersion.split(\"MSIE\")[1]);\n                    if (version < 8) {\n                        gs.defaultConf.display = \"inline\";\n                        gs.defaultConf.zoom = \"1\";\n                    }\n                }\n\n                // set up the classes we need\n                if (!styled) {\n                    styled = true;\n                    styles = [\n                        '.jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}',\n                        '.jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}',\n                        '.jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}',\n              '.jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}',\n                        '.jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}',\n                        '.jstree-grid-header-regular {background-color: #EBF3FD;}',\n                        '.jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}',\n                        '.jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}',\n                        '.jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}',\n                        '.jstree-grid-wrapper {width: 100%; overflow-x: auto;}',\n                        '.jstree-grid-midwrapper {display: table-row; overflow: visible;}',\n                        '.jstree-grid-width-auto {width:auto;display:block;}',\n                        '.jstree-grid-column {display: table-cell; overflow: hidden;}',\n                        '.jstree-grid-col-0 {width: 100%;}'\n                    ];\n\n                    $('<style type=\"text/css\">'+styles.join(\"\\n\")+'</style>').appendTo(\"head\");\n                }\n                this.gridWrapper = $(\"<div></div>\").addClass(\"jstree-grid-wrapper\").appendTo(gridparent);\n                this.midWrapper = $(\"<div></div>\").addClass(\"jstree-grid-midwrapper\").appendTo(this.gridWrapper);\n                // set the wrapper width\n                if (s.width) {\n                    this.gridWrapper.width(s.width);\n                }\n                // create the data columns\n                for (i=0;i<cols.length;i++) {\n                    // create the column\n                    $(\"<div></div>\").addClass(\"jstree-grid-column jstree-grid-column-\"+i+\" jstree-grid-column-root-\"+this.rootid).appendTo(this.midWrapper);\n                }\n                this.midWrapper.children(\"div:eq(\"+treecol+\")\").append(container);\n                container.addClass(\"jstree-grid-cell\");\n\n                this._initialized = true;\n            }\n        };\n        this.init = function (el,options) {\n            parent.init.call(this,el,options);\n            this._initialize();\n        };\n        this.bind = function () {\n            parent.bind.call(this);\n            this._initialize();\n            this.element\n            .on(\"move_node.jstree create_node.jstree clean_node.jstree change_node.jstree\", $.proxy(function (e, data) {\n                var target = this.get_node(data || \"#\",true);\n                this._prepare_grid(target);\n            }, this))\n            .on(\"delete_node.jstree\",$.proxy(function (e,data) {\n                if (data.node.id !== undefined) {\n                    var grid = this.gridWrapper, removeNodes = [data.node.id], i;\n                    // add children to remove list\n                    if (data.node && data.node.children_d) {\n                        removeNodes = removeNodes.concat(data.node.children_d);\n                    }\n                    for (i=0;i<removeNodes.length;i++) {\n                        findDataCell(grid,removeNodes[i]).remove();\n                    }\n                }\n            }, this))\n            .on(\"close_node.jstree\",$.proxy(function (e,data) {\n                this._hide_grid(data.node);\n            }, this))\n            .on(\"open_node.jstree\",$.proxy(function (e,data) {\n            }, this))\n            .on(\"load_node.jstree\",$.proxy(function (e,data) {\n            }, this))\n            .on(\"loaded.jstree\", $.proxy(function (e) {\n                this._prepare_headers();\n                this.element.trigger(\"loaded_grid.jstree\");\n                }, this))\n            .on(\"ready.jstree\",$.proxy(function (e,data) {\n                // find the line-height of the first known node\n                var anchorHeight = this.element.find(\"li a:first\").outerHeight();\n                $('<style type=\"text/css\">div.jstree-grid-cell-root-'+this.rootid+' {line-height: '+anchorHeight+'px}</style>').appendTo(\"head\");\n\n                // add container classes to the wrapper\n                this.gridWrapper.addClass(this.element.attr(\"class\"));\n\n            },this))\n            .on(\"move_node.jstree\",$.proxy(function(e,data){\n                var node = data.new_instance.element;\n                //renderAWidth(node,this);\n                // check all the children, because we could drag a tree over\n                node.find(\"li > a\").each($.proxy(function(i,elm){\n                    //renderAWidth($(elm),this);\n                },this));\n\n            },this))\n            .on(\"hover_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                if (this._hover_node !== null && this._hover_node !== undefined) {\n                    findDataCell(this.gridWrapper,this._hover_node).removeClass(\"jstree-hovered\");\n                }\n                this._hover_node = id;\n                findDataCell(this.gridWrapper,id).addClass(\"jstree-hovered\");\n            },this))\n            .on(\"dehover_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                this._hover_node = null;\n                findDataCell(this.gridWrapper,id).removeClass(\"jstree-hovered\");\n            },this))\n            .on(\"select_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                findDataCell(this.gridWrapper,id).addClass(\"jstree-clicked\");\n                this.get_node(selected.node.id,true).children(\"div.jstree-grid-cell\").addClass(\"jstree-clicked\");\n            },this))\n            .on(\"deselect_node.jstree\",$.proxy(function(node,selected,event){\n                var id = selected.node.id;\n                findDataCell(this.gridWrapper,id).removeClass(\"jstree-hovered\");\n            },this))\n            .on(\"deselect_all.jstree\",$.proxy(function(node,selected,event){\n                // get all of the ids that were unselected\n                var ids = selected.node || [], i;\n                for (i=0;i<ids.length;i++) {\n                    findDataCell(this.gridWrapper,ids[i]).removeClass(\"jstree-clicked\");\n                }\n            },this))\n            .on(\"search.jstree\", $.proxy(function (e, data) {\n                // search sometimes filters, so we need to hide all of the appropriate grid cells as well, and show only the matches\n                var grid = this.gridWrapper;\n                if(this._data.search.som) {\n                    if(data.nodes.length) {\n                        // hide all of the grid cells\n                        grid.find('div.jstree-grid-cell:not(:first)').hide();\n                        // show only those that match\n                        data.nodes.add(data.nodes.parentsUntil(\".jstree\")).filter(\".jstree-node\").each(function (i,node) {\n                            var id = node.id;\n                            if (id) {\n                                findDataCell(grid,id).show();\n                            }\n                        });\n                    }\n                }\n                return true;\n            }, this))\n            .on(\"clear_search.jstree\", $.proxy(function (e, data) {\n                // search has been cleared, so we need to show all rows\n                this.gridWrapper.find('div.jstree-grid-cell').show();\n                return true;\n            }, this))\n            ;\n            if (this._gridSettings.isThemeroller) {\n                this.element\n                    .on(\"select_node.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").addClass(\"ui-state-active\");\n                    },this))\n                    .on(\"deselect_node.jstree deselect_all.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").removeClass(\"ui-state-active\");\n                    },this))\n                    .on(\"hover_node.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").addClass(\"ui-state-hover\");\n                    },this))\n                    .on(\"dehover_node.jstree\",$.proxy(function(e,data){\n                        data.rslt.obj.children(\"a\").nextAll(\"div\").removeClass(\"ui-state-hover\");\n                    },this));\n            }\n        };\n        // tear down the tree entirely\n        this.teardown = function() {\n            var gw = this.gridWrapper, container = this.element, gridparent = gw.parent();\n            container.detach();\n            gw.remove();\n            gridparent.append(container);\n            parent.teardown.call(this);\n        };\n        // clean the grid in case of redraw or refresh entire tree\n        this._clean_grid = function (target,id) {\n            var grid = this.gridWrapper;\n            if (target) {\n                findDataCell(grid,id).remove();\n            } else {\n                // get all of the `div` children in all of the `td` in dataRow except for :first (that is the tree itself) and remove\n                grid.find(\"div.jstree-grid-cell:not(:first)\").remove();\n            }\n        };\n        // prepare the headers\n        this._prepare_headers = function() {\n            var header, i, col, gs = this._gridSettings,cols = gs.columns || [], width, defaultWidth = gs.columnWidth, resizable = gs.resizable || false,\n            cl, ccl, val, margin, last, tr = gs.isThemeroller, classAdd = (tr?\"themeroller\":\"regular\"), puller,\n            hasHeaders = false, gridparent = this.gridparent,\n            conf = gs.defaultConf,\n            colNum = 0, borPadWidth = 0, totalWidth = 0;\n            // save the original parent so we can reparent on destroy\n            this.parent = gridparent;\n\n\n            // create the headers\n            for (i=0;i<cols.length;i++) {\n                //col = $(\"<col/>\");\n                //col.appendTo(colgroup);\n                cl = cols[i].headerClass || \"\";\n                ccl = cols[i].columnClass || \"\";\n                val = cols[i].header || \"\";\n                if (val) {hasHeaders = true;}\n                width = cols[i].width || defaultWidth;\n\n                // we only deal with borders if width is not auto and not percentages\n                borPadWidth = tr ? 1+6 : 2+8; // account for the borders and padding\n                if (width !== 'auto' && typeof(width) !== \"string\") {\n                    width -= borPadWidth;\n                }\n                margin = i === 0 ? 3 : 0;\n                col = this.midWrapper.children(\"div.jstree-grid-column-\"+i);\n                last = $(\"<div></div>\").css(conf).css({\"margin-left\": margin}).addClass(\"jstree-grid-div-\"+this.uniq+\"-\"+i+\" \"+(tr?\"ui-widget-header \":\"\")+\" jstree-grid-header jstree-grid-header-cell jstree-grid-header-\"+classAdd+\" \"+cl+\" \"+ccl).html(val);\n                last.addClass((tr?\"ui-widget-header \":\"\")+\"jstree-grid-header jstree-grid-header-\"+classAdd);\n                last.prependTo(col);\n                totalWidth += last.outerWidth();\n                puller = $(\"<div class='jstree-grid-separator jstree-grid-separator-\"+classAdd+(tr ? \" ui-widget-header\" : \"\")+(resizable? \" jstree-grid-resizable-separator\":\"\")+\"'>&nbsp;</div>\").appendTo(last);\n                col.width(width);\n                col.css(\"min-width\",width);\n                col.css(\"max-width\",width);\n            }\n\n            last.addClass((tr?\"ui-widget-header \":\"\")+\"jstree-grid-header jstree-grid-header-last jstree-grid-header-\"+classAdd);\n            // if there is no width given for the last column, do it via automatic\n            if (cols[cols.length-1].width === undefined) {\n                totalWidth -= width;\n                col.css({width:\"auto\"});\n                last.addClass(\"jstree-grid-width-auto\").next(\".jstree-grid-separator\").remove();\n            }\n            if (hasHeaders) {\n                // save the offset of the div from the body\n                //gs.divOffset = header.parent().offset().left;\n                gs.header = header;\n            } else {\n                $(\"div.jstree-grid-header\").hide();\n            }\n\n            if (!this.bound && resizable) {\n                this.bound = true;\n                $(document).mouseup(function () {\n                    var  i, ref, cols, widths, headers, w, currentTree;\n                    if (isClickedSep) {\n                        currentTree = toResize.closest(\".jstree-grid-wrapper\").find(\".jstree\");\n                        ref = $.jstree.reference(currentTree);\n                        cols = ref.settings.grid.columns;\n                        headers = toResize.parent().children(\"div.jstree-grid-column\");\n                        widths = [];\n                        if (isNaN(colNum) || colNum < 0) { ref._gridSettings.treeWidthDiff = currentTree.find(\"ins:eq(0)\").width() + currentTree.find(\"a:eq(0)\").width() - ref._gridSettings.columns[0].width; }\n                        isClickedSep = false;\n                        toResize = null;\n                        for (i=0;i<cols.length;i++) {\n                            w = parseFloat(headers[i].style.width);\n                            widths[i] = {w: w, r: i===colNum };\n                            ref._gridSettings.columns[i].width = w;\n                        }\n\n                        currentTree.trigger(\"resize_column.jstree-grid\", widths);\n                    }\n                }).mousemove(function (e) {\n                        if (isClickedSep) {\n                            newMouseX = e.pageX;\n                            var diff = newMouseX - oldMouseX,\n                            oldPrevHeaderInner,\n                            oldPrevColWidth, newPrevColWidth;\n\n                            if (diff !== 0){\n                                oldPrevHeaderInner = toResize.width();\n                                oldPrevColWidth = parseFloat(toResize.css(\"width\"));\n\n                                // handle a Chrome issue with columns set to auto\n                                // thanks to Brabus https://github.com/side-by-side\n                                if (!oldPrevColWidth) {oldPrevColWidth = toResize.innerWidth();}\n\n                                // make sure that diff cannot be beyond the left/right limits\n                                diff = diff < 0 ? Math.max(diff,-oldPrevHeaderInner) : diff;\n                                newPrevColWidth = (oldPrevColWidth+diff)+\"px\";\n\n                                // only do this if we are not shrinking past 0 on left - and limit it to that amount\n                                if (diff > 0 || oldPrevHeaderInner > 0) {\n                                    toResize.width(newPrevColWidth);\n                                    toResize.css(\"min-width\",newPrevColWidth);\n                                    toResize.css(\"max-width\",newPrevColWidth);\n                                    oldMouseX = newMouseX;\n                                }\n                            }\n                        }\n                    });\n                this.gridWrapper.on(\"selectstart\", \".jstree-grid-resizable-separator\", function () {\n                    return false;\n                }).on(\"mousedown\", \".jstree-grid-resizable-separator\", function (e) {\n                    isClickedSep = true;\n                    oldMouseX = e.pageX;\n                    toResize = $(this).closest(\"div.jstree-grid-column\");\n                    // the max rightmost position we will allow is the right-most of the wrapper minus a buffer (10)\n                    return false;\n                })\n                .on(\"dblclick\", \".jstree-grid-resizable-separator\", function (e) {\n                    var clickedSep = $(this), col = clickedSep.closest(\"div.jstree-grid-column\"),\n                    oldPrevColWidth = parseFloat(col.css(\"width\")), newWidth = 0, diff,\n                    oldPrevHeaderInner = col.width(), newPrevColWidth;\n\n\n                    //find largest width\n                    col.find(\".jstree-grid-cell\").each(function() {\n                        var item = $(this), width;\n                        item.css(\"position\", \"absolute\");\n                        item.css(\"width\", \"auto\");\n                        width = item.outerWidth();\n                        item.css(\"position\", \"relative\");\n\n                        if (width>newWidth) {\n                            newWidth = width;\n                        }\n                    });\n\n                    diff = newWidth-oldPrevColWidth;\n\n                    // make sure that diff cannot be beyond the left limits\n                    diff = diff < 0 ? Math.max(diff,-oldPrevHeaderInner) : diff;\n                    newPrevColWidth = (oldPrevColWidth+diff)+\"px\";\n\n                    col.width(newPrevColWidth);\n                    col.css(\"min-width\",newPrevColWidth);\n                    col.css(\"max-width\",newPrevColWidth);\n                });\n            }\n        };\n        /*\n         * Override redraw_node to correctly insert the grid\n         */\n        this.redraw_node = function(obj, deep, is_callback, force_render) {\n            // first allow the parent to redraw the node\n            obj = parent.redraw_node.call(this, obj, deep, is_callback, force_render);\n            // next prepare the grid\n            if(obj) {\n                this._prepare_grid(obj);\n            }\n            return obj;\n        };\n        this.refresh = function () {\n            this._clean_grid();\n            return parent.refresh.apply(this,arguments);\n        };\n        this._hide_grid = function (node) {\n            var children = node && node.children_d ? node.children_d : [], i;\n            // go through each column, remove all children with the correct ID name\n            for (i=0;i<children.length;i++) {\n                findDataCell(this.gridWrapper,children[i]).remove();\n            }\n        };\n        this.holdingCells = {};\n        this.getHoldingCells = function (obj,col,hc) {\n            var ret = $(), children = obj.children||[], child, i;\n            // run through each child, render it, and then render its children recursively\n            for (i=0;i<children.length;i++) {\n                child = GRIDCELLID_PREFIX+escapeId(children[i])+GRIDCELLID_POSTFIX+col;\n                if (hc[child] && obj.state.opened) {\n                    ret = ret.add(hc[child]).add(this.getHoldingCells(this.get_node(children[i]),col,hc));\n                    //delete hc[child];\n                }\n            }\n            return(ret);\n        };\n        /**\n         * put a grid cell in edit mode (input field to edit the data)\n         * @name edit(obj, col)\n         * @param  {mixed} obj\n         * @param  {obj} col definition\n         * @param  {element} cell element, either span or wrapping div\n         */\n        this._edit = function (obj, col, element) {\n            if(!obj) { return false; }\n            if (element) {\n                element = $(element);\n                if (element.prop(\"tagName\").toLowerCase() === \"div\") {\n                    element = element.children(\"span:first\");\n                }\n            } else {\n                // need to find the element - later\n                return false;\n            }\n            var rtl = this._data.core.rtl,\n                w  = this.element.width(),\n                t = obj.data[col.value],\n                h1 = $(\"<\"+\"div />\", { css : { \"position\" : \"absolute\", \"top\" : \"-200px\", \"left\" : (rtl ? \"0px\" : \"-1000px\"), \"visibility\" : \"hidden\" } }).appendTo(\"body\"),\n                h2 = $(\"<\"+\"input />\", {\n                        \"value\" : t,\n                        \"class\" : \"jstree-rename-input\",\n                        \"css\" : {\n                            \"padding\" : \"0\",\n                            \"border\" : \"1px solid silver\",\n                            \"box-sizing\" : \"border-box\",\n                            \"display\" : \"inline-block\",\n                            \"height\" : (this._data.core.li_height) + \"px\",\n                            \"lineHeight\" : (this._data.core.li_height) + \"px\",\n                            \"width\" : \"150px\" // will be set a bit further down\n                        },\n                        \"blur\" : $.proxy(function () {\n                            var v = h2.val();\n                            // save the value if changed\n                            if(v === \"\" || v === t) {\n                                v = t;\n                            } else {\n                                obj.data[col.value] = v;\n                                this.element.trigger('update_cell.jstree-grid',{node:obj, col:col.value, value:v, old:t});\n                                this._prepare_grid(this.get_node(obj,true));\n                            }\n                            h2.remove();\n                            element.show();\n                        }, this),\n                        \"keydown\" : function (event) {\n                            var key = event.which;\n                            if(key === 27) {\n                                this.value = t;\n                            }\n                            if(key === 27 || key === 13 || key === 37 || key === 38 || key === 39 || key === 40 || key === 32) {\n                                event.stopImmediatePropagation();\n                            }\n                            if(key === 27 || key === 13) {\n                                event.preventDefault();\n                                this.blur();\n                            }\n                        },\n                        \"click\" : function (e) { e.stopImmediatePropagation(); },\n                        \"mousedown\" : function (e) { e.stopImmediatePropagation(); },\n                        \"keyup\" : function (event) {\n                            h2.width(Math.min(h1.text(\"pW\" + this.value).width(),w));\n                        },\n                        \"keypress\" : function(event) {\n                            if(event.which === 13) { return false; }\n                        }\n                    }),\n                fn = {\n                        fontFamily        : element.css('fontFamily')        || '',\n                        fontSize        : element.css('fontSize')            || '',\n                        fontWeight        : element.css('fontWeight')        || '',\n                        fontStyle        : element.css('fontStyle')        || '',\n                        fontStretch        : element.css('fontStretch')        || '',\n                        fontVariant        : element.css('fontVariant')        || '',\n                        letterSpacing    : element.css('letterSpacing')    || '',\n                        wordSpacing        : element.css('wordSpacing')        || ''\n                };\n            element.hide();\n            element.parent().append(h2);\n            h2.css(fn).width(Math.min(h1.text(\"pW\" + h2[0].value).width(),w))[0].select();\n        };\n        this._prepare_grid = function (obj) {\n            var gs = this._gridSettings, c = gs.treeClass, _this = this, t, cols = gs.columns || [], width, tr = gs.isThemeroller,\n            tree = this.element, rootid = this.rootid,\n            classAdd = (tr?\"themeroller\":\"regular\"), img, objData = this.get_node(obj),\n            defaultWidth = gs.columnWidth, conf = gs.defaultConf, cellClickHandler = function (tree,node,val,col,t) {\n                return function(e) {\n                    //node = tree.find(\"#\"+node.attr(\"id\"));\n                    node.children(\".jstree-anchor\").trigger(\"click.jstree\",e);\n                    tree.trigger(\"select_cell.jstree-grid\", [{value: val,column: col.header,node: node,grid:$(this),sourceName: col.value}]);\n                };\n            }, cellRightClickHandler = function (tree,node,val,col,t) {\n                return function (e) {\n                    if (gs.context) {\n                        e.preventDefault();\n                        $.vakata.context.show(this,{ 'x' : e.pageX, 'y' : e.pageY },{\n                            \"edit\":{label:\"Edit\",\"action\": function (data) {\n                                var obj = t.get_node(node);\n                                _this._edit(obj,col,e.target);\n                            }}\n                        });\n                    }\n                };\n            },\n            hoverInHandler = function (node, jsTreeInstance) {\n                return function() { jsTreeInstance.hover_node(node); };\n            },\n            hoverOutHandler = function (node, jsTreeInstance) {\n                return function() { jsTreeInstance.dehover_node(node); };\n            },\n            i, val, cl, wcl, ccl, a, last, valClass, wideValClass, span, paddingleft, title, gridCellName, gridCellParentId, gridCellParent,\n            gridCellPrev, gridCellPrevId, gridCellNext, gridCellNextId, gridCellChild, gridCellChildId,\n            col, content, tmpWidth, mw = this.midWrapper, dataCell, lid = objData.id,\n            peers = this.get_node(objData.parent).children,\n            // find my position in the list of peers. \"peers\" is the list of everyone at my level under my parent, in order\n            pos = $.inArray(lid,peers),\n            hc = this.holdingCells, rendered = false, closed;\n            // get our column definition\n            t = $(obj);\n\n            // find the a children\n            a = t.children(\"a\");\n\n            if (a.length === 1) {\n                closed = !objData.state.opened;\n                gridCellName = GRIDCELLID_PREFIX+escapeId(lid)+GRIDCELLID_POSTFIX;\n                gridCellParentId = objData.parent === \"#\" ? null : objData.parent;\n                a.addClass(c);\n                //renderAWidth(a,_this);\n                renderATitle(a,t,_this);\n                last = a;\n                for (i=0;i<cols.length;i++) {\n                    if (this.treecol === i) {\n                        continue;\n                    }\n                    col = cols[i];\n                    dataCell = mw.children(\"div:eq(\"+i+\")\");\n                    // get the cellClass, the wideCellClass, and the columnClass\n                    cl = col.cellClass || \"\";\n                    wcl = col.wideCellClass || \"\";\n                    ccl = col.columnClass || \"\";\n\n                    // add a column class to the dataCell\n                    dataCell.addClass(ccl);\n\n\n                    // get the contents of the cell - value could be a string or a function\n                    if (col.value !== undefined && col.value !== null) {\n                        if (typeof(col.value) === \"function\") {\n                            val = col.value(objData);\n                        } else if (objData.data !== null && objData.data !== undefined && objData.data[col.value] !== undefined) {\n                            val = objData.data[col.value];\n                        } else {\n                            val = \"\";\n                        }\n                    } else {\n                        val = \"\";\n                    }\n\n                    if (typeof(col.format) === \"function\") {\n                        val = col.format(val);\n                    }\n\n                    // put images instead of text if needed\n                    if (col.images) {\n                    img = col.images[val] || col.images[\"default\"];\n                    if (img) {content = img[0] === \"*\" ? '<span class=\"'+img.substr(1)+'\"></span>' : '<img src=\"'+img+'\">';}\n                    } else { content = val; }\n\n                    // content cannot be blank, or it messes up heights\n                    if (content === undefined || content === null || BLANKRE.test(content)) {\n                        content = \"&nbsp;\";\n                    }\n\n                    // get the valueClass\n                    valClass = col.valueClass && objData.data !== null && objData.data !== undefined ? objData.data[col.valueClass] || \"\" : \"\";\n                    if (valClass && col.valueClassPrefix && col.valueClassPrefix !== \"\") {\n                        valClass = col.valueClassPrefix + valClass;\n                    }\n                    // get the wideValueClass\n                    wideValClass = col.wideValueClass && objData.data !== null && objData.data !== undefined ? objData.data[col.wideValueClass] || \"\" : \"\";\n                    if (wideValClass && col.wideValueClassPrefix && col.wideValueClassPrefix !== \"\") {\n                        wideValClass = col.wideValueClassPrefix + wideValClass;\n                    }\n                    // get the title\n                    title = col.title && objData.data !== null && objData.data !== undefined ? objData.data[col.title] || \"\" : \"\";\n                    // strip out HTML\n                    title = title.replace(htmlstripre, '');\n\n                    // get the width\n                    paddingleft = 7;\n                    width = col.width || defaultWidth;\n                    if (width !== 'auto') {\n                        width = tmpWidth || (width - paddingleft);\n                    }\n\n                    last = dataCell.children(\"div#\"+gridCellName+i);\n                    if (!last || last.length < 1) {\n                        last = $(\"<div></div>\");\n                        $(\"<span></span>\").appendTo(last);\n                        last.attr(\"id\",gridCellName+i);\n                        last.addClass(gridCellName);\n                        last.attr(NODE_DATA_ATTR,lid);\n\n                    }\n                    // we need to put it in the dataCell - after the parent, but the position matters\n                    // if we have no parent, then we are one of the root nodes, but still need to look at peers\n\n\n                    // if we are first, i.e. pos === 0, we go right after the parent;\n                    // if we are not first, and our previous peer (one before us) is closed, we go right after the previous peer cell\n                    // if we are not first, and our previous peer is opened, then we have to find its youngest & lowest closed child (incl. leaf)\n                    //\n                    // probably be much easier to go *before* our next one\n                    // but that one might not be drawn yet\n                    // here is the logic for jstree drawing:\n                    //   it draws peers from first to last or from last to first\n                    //   it draws children before a parent\n                    //\n                    // so I can rely on my *parent* not being drawn, but I cannot rely on my previous peer or my next peer being drawn\n\n                    // so we do the following:\n                    //   1- We are the first child: install after the parent\n                    //   2- Our previous peer is already drawn: install after the previous peer\n                    //   3- Our previous peer is not drawn, we have a child that is drawn: install right before our first child\n                    //   4- Our previous peer is not drawn, we have no child that is drawn, our next peer is drawn: install right before our next peer\n                    //   5- Our previous peer is not drawn, we have no child that is drawn, our next peer is not drawn: install right after parent\n                    gridCellPrevId = pos <=0 ? objData.parent : findLastClosedNode(this,peers[pos-1]);\n                    gridCellPrev = findDataCell(dataCell,gridCellPrevId);\n                    gridCellNextId = pos >= peers.length-1 ? \"NULL\" : peers[pos+1];\n                    gridCellNext = findDataCell(dataCell,gridCellNextId);\n                    gridCellChildId = objData.children && objData.children.length > 0 ? objData.children[0] : \"NULL\";\n                    gridCellChild = findDataCell(dataCell,gridCellChildId);\n                    gridCellParent = findDataCell(dataCell,gridCellParentId);\n\n\n                    // if our parent is already drawn, then we put this in the right order under our parent\n                    if (gridCellParentId) {\n                        if (gridCellParent && gridCellParent.length > 0) {\n                            if (gridCellPrev && gridCellPrev.length > 0) {\n                                last.insertAfter(gridCellPrev);\n                            } else if (gridCellChild && gridCellChild.length > 0) {\n                                last.insertBefore(gridCellChild);\n                            } else if (gridCellNext && gridCellNext.length > 0) {\n                                last.insertBefore(gridCellNext);\n                            } else {\n                                last.insertAfter(gridCellParent);\n                            }\n                            rendered = true;\n                        } else {\n                            rendered = false;\n                        }\n                        // always put it in the holding cells, and then sort when the parent comes in, in case parent is (re)drawn later\n                        hc[gridCellName+i] = last;\n                    } else {\n                        if (gridCellPrev && gridCellPrev.length > 0) {\n                            last.insertAfter(gridCellPrev);\n                        } else if (gridCellChild && gridCellChild.length > 0) {\n                            last.insertBefore(gridCellChild);\n                        } else if (gridCellNext && gridCellNext.length > 0) {\n                            last.insertBefore(gridCellNext);\n                        } else {\n                            last.appendTo(dataCell);\n                        }\n                        rendered = true;\n                    }\n                    // do we have any children waiting for this cell? walk down through the children/grandchildren/etc tree\n                    if (rendered) {\n                        last.after(this.getHoldingCells(objData,i,hc));\n                    }\n                    // need to make the height of this match the line height of the tree. How?\n                    span = last.children(\"span\");\n\n                    // create a span inside the div, so we can control what happens in the whole div versus inside just the text/background\n                    span.addClass(cl+\" \"+valClass).html(content);\n                    last = last.css(conf).addClass(\"jstree-grid-cell jstree-grid-cell-root-\"+rootid+\" jstree-grid-cell-\"+classAdd+\" \"+wcl+ \" \" + wideValClass + (tr?\" ui-state-default\":\"\")).addClass(\"jstree-grid-col-\"+i);\n                    // add click handler for clicking inside a grid cell\n                    last.click(cellClickHandler(tree,t,val,col,this));\n                    last.on(\"contextmenu\",cellRightClickHandler(tree,t,val,col,this));\n                    last.hover(hoverInHandler(t, this), hoverOutHandler(t, this));\n\n                    if (title) {\n                        span.attr(\"title\",title);\n                    }\n\n                }\n                last.addClass(\"jstree-grid-cell-last\"+(tr?\" ui-state-default\":\"\"));\n                // if there is no width given for the last column, do it via automatic\n                if (cols[cols.length-1].width === undefined) {\n                    last.addClass(\"jstree-grid-width-auto\").next(\".jstree-grid-separator\").remove();\n                }\n            }\n            this.element.css({'overflow-y':'auto !important'});\n        };\n        // clean up holding cells\n        this.holdingCells = {};\n\n        // need to do alternating background colors or borders\n    };\n}));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTA4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vY21zL3N0YXRpYy9jbXMvanMvbGlicy9qc3RyZWUvanN0cmVlLmdyaWQubWluLmpzPzY3NzAiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9kZWl0Y2gvanN0cmVlLWdyaWRcbiAqXG4gKiBUaGlzIHBsdWdpbiBoYW5kbGVzIGFkZGluZyBhIGdyaWQgdG8gYSB0cmVlIHRvIGRpc3BsYXkgYWRkaXRpb25hbCBkYXRhXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlOlxuICogICBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICpcbiAqIFdvcmtzIG9ubHkgd2l0aCBqc3RyZWUgdmVyc2lvbiA+PSAzLjAuMFxuICpcbiAqICREYXRlOiAyMDE1LTExLTI5ICRcbiAqICRSZXZpc2lvbjogIDMuNC4yICRcbiAqXG4gKiAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhXG4gKiAhISEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISEhXG4gKiAhISEgICBJTVBPUlRBTlQgaXQgc2F5cyAzLjQuMiBidXQgaXQncyBhY3R1YWxseSAzLjQuNCwgYW5kIGl0J3MgbW9kaWZpZWQhICAgISEhXG4gKiAhISEgICBsaW5lIDY0Niwgc2FtZSBhczogaHR0cHM6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZC9wdWxsLzE2NSAgICAgISEhXG4gKiAhISEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISEhXG4gKiAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhXG4gKi9cblxuLypqc2xpbnQgbm9tZW46dHJ1ZSAqL1xuLypqc2hpbnQgdW51c2VkOnZhcnMgKi9cbi8qZ2xvYmFsIG5hdmlnYXRvciwgZG9jdW1lbnQsIGpRdWVyeSwgZGVmaW5lICovXG5cbi8qIEFNRCBzdXBwb3J0IGFkZGVkIGJ5IGpvY2hlbmJlcmdlciBwZXIgaHR0cHM6Ly9naXRodWIuY29tL2RlaXRjaC9qc3RyZWUtZ3JpZC9wdWxsLzQ5XG4gKlxuICovXG4oZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5JywgJ2pzdHJlZSddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHNcbiAgICAgICAgZmFjdG9yeShqUXVlcnkpO1xuICAgIH1cbn0oZnVuY3Rpb24gKCQpIHtcbiAgICB2YXIgcmVuZGVyQVdpZHRoLCByZW5kZXJBVGl0bGUsIGdldEluZGVudCwgaHRtbHN0cmlwcmUsIGZpbmRMYXN0Q2xvc2VkTm9kZSwgQkxBTktSRSA9IC9eXFxzKiQvZyxcbiAgICAgICAgSURSRUdFWCA9IC9bXFxcXDomIV58KClcXFtcXF08PkAqJyt+I1wiOyw9IFxcLyR7fSVdL2csIGVzY2FwZUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gKGlkfHxcIlwiKS5yZXBsYWNlKElEUkVHRVgsJ1xcXFwkJicpO1xuICAgICAgICB9LCBOT0RFX0RBVEFfQVRUUiA9IFwiZGF0YS1qc3RyZWVncmlkXCIsXG4gICAgU1BFQ0lBTF9USVRMRSA9IFwiX0RBVEFfXCIsIExFVkVMSU5ERU5UID0gMjQsIHN0eWxlZCA9IGZhbHNlLCBHUklEQ0VMTElEX1BSRUZJWCA9IFwianNncmlkX1wiLEdSSURDRUxMSURfUE9TVEZJWCA9IFwiX2NvbFwiLFxuICAgICAgICBmaW5kRGF0YUNlbGwgPSBmdW5jdGlvbiAoZnJvbSxpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZyb20uZmluZChcImRpdltcIitOT0RFX0RBVEFfQVRUUitcIj0nXCIraWQrXCInXVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXNDbGlja2VkU2VwID0gZmFsc2UsIHRvUmVzaXplID0gbnVsbCwgb2xkTW91c2VYID0gMCwgbmV3TW91c2VYID0gMDtcblxuICAgIC8qanNsaW50IHJlZ2V4cDp0cnVlICovXG4gICAgaHRtbHN0cmlwcmUgPSAvPFxcLz9bXj5dKz4vZ2k7XG4gICAgLypqc2xpbnQgcmVnZXhwOmZhbHNlICovXG5cbiAgICBnZXRJbmRlbnQgPSBmdW5jdGlvbihub2RlLHRyZWUpIHtcbiAgICAgICAgdmFyIGRpdiwgaSwgbGksIHdpZHRoO1xuXG4gICAgICAgIC8vIGRpZCB3ZSBhbHJlYWR5IHNhdmUgaXQgZm9yIHRoaXMgdHJlZT9cbiAgICAgICAgdHJlZS5fZ3JpZFNldHRpbmdzID0gdHJlZS5fZ3JpZFNldHRpbmdzIHx8IHt9O1xuICAgICAgICBpZiAodHJlZS5fZ3JpZFNldHRpbmdzLmluZGVudCA+IDApIHtcbiAgICAgICAgICAgIHdpZHRoID0gdHJlZS5fZ3JpZFNldHRpbmdzLmluZGVudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBkaXYgb24gdGhlIERPTSBidXQgbm90IHZpc2libGUgb24gdGhlIHBhZ2VcbiAgICAgICAgICAgIGRpdiA9ICQoXCI8ZGl2PjwvZGl2PlwiKTtcbiAgICAgICAgICAgIGkgPSBub2RlLnByZXYoXCJpXCIpO1xuICAgICAgICAgICAgbGkgPSBpLnBhcmVudCgpO1xuICAgICAgICAgICAgLy8gYWRkIHRvIHRoYXQgZGl2IGFsbCBvZiB0aGUgY2xhc3NlcyBvbiB0aGUgdHJlZSByb290XG4gICAgICAgICAgICBkaXYuYWRkQ2xhc3ModHJlZS5nZXRfbm9kZShcIiNcIix0cnVlKS5hdHRyKFwiY2xhc3NcIikpO1xuXG4gICAgICAgICAgICAvLyBtb3ZlIHRoZSBsaSB0byB0aGUgdGVtcG9yYXJ5IGRpdiByb290XG4gICAgICAgICAgICBsaS5hcHBlbmRUbyhkaXYpO1xuXG4gICAgICAgICAgICAvLyBhdHRhY2ggdG8gdGhlIGJvZHkgcXVpY2tseVxuICAgICAgICAgICAgZGl2LmFwcGVuZFRvKCQoXCJib2R5XCIpKTtcblxuICAgICAgICAgICAgLy8gZ2V0IHRoZSB3aWR0aFxuICAgICAgICAgICAgd2lkdGggPSBpLndpZHRoKCkgfHwgTEVWRUxJTkRFTlQ7XG5cbiAgICAgICAgICAgIC8vIGRldGFjaCB0aGUgbGkgZnJvbSB0aGUgbmV3IGRpdiBhbmQgZGVzdHJveSB0aGUgbmV3IGRpdlxuICAgICAgICAgICAgbGkuZGV0YWNoKCk7XG4gICAgICAgICAgICBkaXYucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIHNhdmUgaXQgZm9yIHRoZSBmdXR1cmVcbiAgICAgICAgICAgIHRyZWUuX2dyaWRTZXR0aW5ncy5pbmRlbnQgPSB3aWR0aDtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmV0dXJuKHdpZHRoKTtcblxuICAgIH07XG5cbiAgICBmaW5kTGFzdENsb3NlZE5vZGUgPSBmdW5jdGlvbiAodHJlZSxpZCkge1xuICAgICAgICAvLyBmaXJzdCBnZXQgb3VyIG5vZGVcbiAgICAgICAgdmFyIHJldCwgbm9kZSA9IHRyZWUuZ2V0X25vZGUoaWQpLCBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47XG4gICAgICAgIC8vIGlzIGl0IGNsb3NlZD9cbiAgICAgICAgaWYgKCFjaGlsZHJlbiB8fCBjaGlsZHJlbi5sZW5ndGggPD0gMCB8fCAhbm9kZS5zdGF0ZS5vcGVuZWQpIHtcbiAgICAgICAgICAgIHJldCA9IGlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0ID0gZmluZExhc3RDbG9zZWROb2RlKHRyZWUsY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoLTFdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ocmV0KTtcbiAgICB9O1xuXG4gICAgcmVuZGVyQVdpZHRoID0gZnVuY3Rpb24obm9kZSx0cmVlKSB7XG4gICAgICAgIHZhciBkZXB0aCwgd2lkdGgsXG4gICAgICAgIGZ1bGxXaWR0aCA9IHBhcnNlSW50KHRyZWUuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zWzBdLndpZHRoLDEwKSArIHBhcnNlSW50KHRyZWUuX2dyaWRTZXR0aW5ncy50cmVlV2lkdGhEaWZmLDEwKTtcbiAgICAgICAgLy8gbmVlZCB0byB1c2UgYSBzZWxlY3RvciBpbiBqcXVlcnkgMS40LjQrXG4gICAgICAgIGRlcHRoID0gdHJlZS5nZXRfbm9kZShub2RlKS5wYXJlbnRzLmxlbmd0aDtcbiAgICAgICAgd2lkdGggPSBmdWxsV2lkdGggLSBkZXB0aCpnZXRJbmRlbnQobm9kZSx0cmVlKTtcbiAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBsaW5lIGlzIG5vIGxvbmdlciBuZWVkZWQsIHNpbmNlIHdlIGFyZSBkb2luZyB0aGlzIGluc2lkZSBhIDx0ZD5cbiAgICAgICAgLy9hLmNzcyh7XCJ2ZXJ0aWNhbC1hbGlnblwiOiBcInRvcFwiLCBcIm92ZXJmbG93XCI6XCJoaWRkZW5cIn0pO1xuICAgICAgICByZXR1cm4oZnVsbFdpZHRoKTtcbiAgICB9O1xuICAgIHJlbmRlckFUaXRsZSA9IGZ1bmN0aW9uKG5vZGUsdCx0cmVlKSB7XG4gICAgICAgIHZhciBhID0gbm9kZS5nZXQoMCkudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImFcIiA/IG5vZGUgOiBub2RlLmNoaWxkcmVuKFwiYVwiKSwgdGl0bGUsIGNvbCA9IHRyZWUuc2V0dGluZ3MuZ3JpZC5jb2x1bW5zWzBdO1xuICAgICAgICAvLyBnZXQgdGhlIHRpdGxlXG4gICAgICAgIHRpdGxlID0gXCJcIjtcbiAgICAgICAgaWYgKGNvbC50aXRsZSkge1xuICAgICAgICAgICAgaWYgKGNvbC50aXRsZSA9PT0gU1BFQ0lBTF9USVRMRSkge1xuICAgICAgICAgICAgICAgIHRpdGxlID0gdHJlZS5nZXRfdGV4dCh0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodC5hdHRyKGNvbC50aXRsZSkpIHtcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHQuYXR0cihjb2wudGl0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHN0cmlwIG91dCBIVE1MXG4gICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZShodG1sc3RyaXByZSwgJycpO1xuICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgIGEuYXR0cihcInRpdGxlXCIsdGl0bGUpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuanN0cmVlLmRlZmF1bHRzLmdyaWQgPSB7XG4gICAgICAgIHdpZHRoOiAnYXV0bydcbiAgICB9O1xuXG4gICAgJC5qc3RyZWUucGx1Z2lucy5ncmlkID0gZnVuY3Rpb24ob3B0aW9ucyxwYXJlbnQpIHtcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IHRoaXMuc2V0dGluZ3MuZ3JpZCB8fCB7fSwgc3R5bGVzLCAgICBjb250YWluZXIgPSB0aGlzLmVsZW1lbnQsIGdyaWRwYXJlbnQgPSBjb250YWluZXIucGFyZW50KCksIGksXG4gICAgICAgICAgICAgICAgZ3MgPSB0aGlzLl9ncmlkU2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnMgOiBzLmNvbHVtbnMgfHwgW10sXG4gICAgICAgICAgICAgICAgICAgIHRyZWVDbGFzcyA6IFwianN0cmVlLWdyaWQtY29sLTBcIixcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dDogcy5jb250ZXh0bWVudSB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uV2lkdGggOiBzLmNvbHVtbldpZHRoLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZiA6IHtcIipkaXNwbGF5XCI6XCJpbmxpbmVcIixcIiorZGlzcGxheVwiOlwiaW5saW5lXCJ9LFxuICAgICAgICAgICAgICAgICAgICBpc1RoZW1lcm9sbGVyIDogISF0aGlzLl9kYXRhLnRoZW1lcm9sbGVyLFxuICAgICAgICAgICAgICAgICAgICB0cmVlV2lkdGhEaWZmIDogMCxcbiAgICAgICAgICAgICAgICAgICAgcmVzaXphYmxlIDogcy5yZXNpemFibGUsXG4gICAgICAgICAgICAgICAgICAgIGluZGVudDogMFxuICAgICAgICAgICAgICAgIH0sIGNvbHMgPSBncy5jb2x1bW5zLCB0cmVlY29sID0gMDtcbiAgICAgICAgICAgICAgICAvLyBmaW5kIHdoaWNoIGNvbHVtbiBvdXIgdHJlZSBzaHVsZCBnbyBpblxuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8cy5jb2x1bW5zLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHMuY29sdW1uc1tpXS50cmVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzYXZlIHdoaWNoIGNvbHVtbiBpdCB3YXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVjb2wgPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90IGNoZWNrIGFueSBvdGhlcnNcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHNldCBhIHVuaXF1ZSBJRCBmb3IgdGhpcyB0YWJsZVxuICAgICAgICAgICAgICAgIHRoaXMudW5pcSA9IE1hdGguY2VpbChNYXRoLnJhbmRvbSgpKjEwMDApO1xuICAgICAgICAgICAgICAgIHRoaXMudHJlZWNvbCA9IHRyZWVjb2w7XG4gICAgICAgICAgICAgICAgdGhpcy5yb290aWQgPSBjb250YWluZXIuYXR0cihcImlkXCIpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1zaWUgPSAvbXNpZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgICAgIGlmIChtc2llKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gcGFyc2VGbG9hdChuYXZpZ2F0b3IuYXBwVmVyc2lvbi5zcGxpdChcIk1TSUVcIilbMV0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmVyc2lvbiA8IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdzLmRlZmF1bHRDb25mLmRpc3BsYXkgPSBcImlubGluZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3MuZGVmYXVsdENvbmYuem9vbSA9IFwiMVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gc2V0IHVwIHRoZSBjbGFzc2VzIHdlIG5lZWRcbiAgICAgICAgICAgICAgICBpZiAoIXN0eWxlZCkge1xuICAgICAgICAgICAgICAgICAgICBzdHlsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzdHlsZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWNlbGwge3ZlcnRpY2FsLWFsaWduOiB0b3A7IG92ZXJmbG93OmhpZGRlbjttYXJnaW4tbGVmdDowO3Bvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOiAxMDAlO3BhZGRpbmctbGVmdDo3cHg7d2hpdGUtc3BhY2U6IG5vd3JhcDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtY2VsbCBzcGFuIHttYXJnaW4tcmlnaHQ6MHB4O21hcmdpbi1yaWdodDowcHg7KmRpc3BsYXk6aW5saW5lOyorZGlzcGxheTppbmxpbmU7d2hpdGUtc3BhY2U6IG5vd3JhcDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtc2VwYXJhdG9yIHtwb3NpdGlvbjpyZWxhdGl2ZTsgaGVpZ2h0OjI0cHg7IGZsb2F0OnJpZ2h0O21hcmdpbi1sZWZ0OiAtMnB4OyBib3JkZXItd2lkdGg6IDAgMnB4IDAgMDsgKmRpc3BsYXk6aW5saW5lOyAqK2Rpc3BsYXk6aW5saW5lOyBtYXJnaW4tcmlnaHQ6MHB4O3dpZHRoOjBweDt9JyxcbiAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1oZWFkZXItY2VsbCB7b3ZlcmZsb3c6IGhpZGRlbjsgd2hpdGUtc3BhY2U6IG5vd3JhcDtwYWRkaW5nOiAxcHggM3B4IDJweCA1cHg7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLWhlYWRlci10aGVtZXJvbGxlciB7Ym9yZGVyOiAwOyBwYWRkaW5nOiAxcHggM3B4O30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1oZWFkZXItcmVndWxhciB7YmFja2dyb3VuZC1jb2xvcjogI0VCRjNGRDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvciB7Y3Vyc29yOiBjb2wtcmVzaXplOyB3aWR0aDogMnB4O30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1zZXBhcmF0b3ItcmVndWxhciB7Ym9yZGVyLWNvbG9yOiAjZDBkMGQwOyBib3JkZXItc3R5bGU6IHNvbGlkO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jZWxsLXRoZW1lcm9sbGVyIHtib3JkZXI6IG5vbmUgIWltcG9ydGFudDsgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQgIWltcG9ydGFudDt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtd3JhcHBlciB7d2lkdGg6IDEwMCU7IG92ZXJmbG93LXg6IGF1dG87fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLW1pZHdyYXBwZXIge2Rpc3BsYXk6IHRhYmxlLXJvdzsgb3ZlcmZsb3c6IHZpc2libGU7fScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnLmpzdHJlZS1ncmlkLXdpZHRoLWF1dG8ge3dpZHRoOmF1dG87ZGlzcGxheTpibG9jazt9JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICcuanN0cmVlLWdyaWQtY29sdW1uIHtkaXNwbGF5OiB0YWJsZS1jZWxsOyBvdmVyZmxvdzogaGlkZGVuO30nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJy5qc3RyZWUtZ3JpZC1jb2wtMCB7d2lkdGg6IDEwMCU7fSdcbiAgICAgICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgICAgICAkKCc8c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+JytzdHlsZXMuam9pbihcIlxcblwiKSsnPC9zdHlsZT4nKS5hcHBlbmRUbyhcImhlYWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIgPSAkKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmFwcGVuZFRvKGdyaWRwYXJlbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMubWlkV3JhcHBlciA9ICQoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLW1pZHdyYXBwZXJcIikuYXBwZW5kVG8odGhpcy5ncmlkV3JhcHBlcik7XG4gICAgICAgICAgICAgICAgLy8gc2V0IHRoZSB3cmFwcGVyIHdpZHRoXG4gICAgICAgICAgICAgICAgaWYgKHMud2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkV3JhcHBlci53aWR0aChzLndpZHRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBkYXRhIGNvbHVtbnNcbiAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPGNvbHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGNvbHVtblxuICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdj48L2Rpdj5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jb2x1bW4ganN0cmVlLWdyaWQtY29sdW1uLVwiK2krXCIganN0cmVlLWdyaWQtY29sdW1uLXJvb3QtXCIrdGhpcy5yb290aWQpLmFwcGVuZFRvKHRoaXMubWlkV3JhcHBlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubWlkV3JhcHBlci5jaGlsZHJlbihcImRpdjplcShcIit0cmVlY29sK1wiKVwiKS5hcHBlbmQoY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jZWxsXCIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbiAoZWwsb3B0aW9ucykge1xuICAgICAgICAgICAgcGFyZW50LmluaXQuY2FsbCh0aGlzLGVsLG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJpbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwYXJlbnQuYmluZC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAub24oXCJtb3ZlX25vZGUuanN0cmVlIGNyZWF0ZV9ub2RlLmpzdHJlZSBjbGVhbl9ub2RlLmpzdHJlZSBjaGFuZ2Vfbm9kZS5qc3RyZWVcIiwgJC5wcm94eShmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldF9ub2RlKGRhdGEgfHwgXCIjXCIsdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkKHRhcmdldCk7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImRlbGV0ZV9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLm5vZGUuaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JpZCA9IHRoaXMuZ3JpZFdyYXBwZXIsIHJlbW92ZU5vZGVzID0gW2RhdGEubm9kZS5pZF0sIGk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjaGlsZHJlbiB0byByZW1vdmUgbGlzdFxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5ub2RlICYmIGRhdGEubm9kZS5jaGlsZHJlbl9kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVOb2RlcyA9IHJlbW92ZU5vZGVzLmNvbmNhdChkYXRhLm5vZGUuY2hpbGRyZW5fZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTxyZW1vdmVOb2Rlcy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwoZ3JpZCxyZW1vdmVOb2Rlc1tpXSkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImNsb3NlX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbiAoZSxkYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGlkZV9ncmlkKGRhdGEubm9kZSk7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcIm9wZW5fbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uIChlLGRhdGEpIHtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwibG9hZF9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgfSwgdGhpcykpXG4gICAgICAgICAgICAub24oXCJsb2FkZWQuanN0cmVlXCIsICQucHJveHkoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmVwYXJlX2hlYWRlcnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcihcImxvYWRlZF9ncmlkLmpzdHJlZVwiKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIC5vbihcInJlYWR5LmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24gKGUsZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIGxpbmUtaGVpZ2h0IG9mIHRoZSBmaXJzdCBrbm93biBub2RlXG4gICAgICAgICAgICAgICAgdmFyIGFuY2hvckhlaWdodCA9IHRoaXMuZWxlbWVudC5maW5kKFwibGkgYTpmaXJzdFwiKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgICQoJzxzdHlsZSB0eXBlPVwidGV4dC9jc3NcIj5kaXYuanN0cmVlLWdyaWQtY2VsbC1yb290LScrdGhpcy5yb290aWQrJyB7bGluZS1oZWlnaHQ6ICcrYW5jaG9ySGVpZ2h0KydweH08L3N0eWxlPicpLmFwcGVuZFRvKFwiaGVhZFwiKTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCBjb250YWluZXIgY2xhc3NlcyB0byB0aGUgd3JhcHBlclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50LmF0dHIoXCJjbGFzc1wiKSk7XG5cbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJtb3ZlX25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihlLGRhdGEpe1xuICAgICAgICAgICAgICAgIHZhciBub2RlID0gZGF0YS5uZXdfaW5zdGFuY2UuZWxlbWVudDtcbiAgICAgICAgICAgICAgICAvL3JlbmRlckFXaWR0aChub2RlLHRoaXMpO1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGFsbCB0aGUgY2hpbGRyZW4sIGJlY2F1c2Ugd2UgY291bGQgZHJhZyBhIHRyZWUgb3ZlclxuICAgICAgICAgICAgICAgIG5vZGUuZmluZChcImxpID4gYVwiKS5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSxlbG0pe1xuICAgICAgICAgICAgICAgICAgICAvL3JlbmRlckFXaWR0aCgkKGVsbSksdGhpcyk7XG4gICAgICAgICAgICAgICAgfSx0aGlzKSk7XG5cbiAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAub24oXCJob3Zlcl9ub2RlLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc2VsZWN0ZWQubm9kZS5pZDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faG92ZXJfbm9kZSAhPT0gbnVsbCAmJiB0aGlzLl9ob3Zlcl9ub2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsdGhpcy5faG92ZXJfbm9kZSkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtaG92ZXJlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5faG92ZXJfbm9kZSA9IGlkO1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGlkKS5hZGRDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpO1xuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcImRlaG92ZXJfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKG5vZGUsc2VsZWN0ZWQsZXZlbnQpe1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHNlbGVjdGVkLm5vZGUuaWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5faG92ZXJfbm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwic2VsZWN0X25vZGUuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihub2RlLHNlbGVjdGVkLGV2ZW50KXtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBzZWxlY3RlZC5ub2RlLmlkO1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbCh0aGlzLmdyaWRXcmFwcGVyLGlkKS5hZGRDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0X25vZGUoc2VsZWN0ZWQubm9kZS5pZCx0cnVlKS5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jZWxsXCIpLmFkZENsYXNzKFwianN0cmVlLWNsaWNrZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVzZWxlY3Rfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKG5vZGUsc2VsZWN0ZWQsZXZlbnQpe1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHNlbGVjdGVkLm5vZGUuaWQ7XG4gICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKHRoaXMuZ3JpZFdyYXBwZXIsaWQpLnJlbW92ZUNsYXNzKFwianN0cmVlLWhvdmVyZWRcIik7XG4gICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiZGVzZWxlY3RfYWxsLmpzdHJlZVwiLCQucHJveHkoZnVuY3Rpb24obm9kZSxzZWxlY3RlZCxldmVudCl7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IGFsbCBvZiB0aGUgaWRzIHRoYXQgd2VyZSB1bnNlbGVjdGVkXG4gICAgICAgICAgICAgICAgdmFyIGlkcyA9IHNlbGVjdGVkLm5vZGUgfHwgW10sIGk7XG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTxpZHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixpZHNbaV0pLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgIC5vbihcInNlYXJjaC5qc3RyZWVcIiwgJC5wcm94eShmdW5jdGlvbiAoZSwgZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIHNlYXJjaCBzb21ldGltZXMgZmlsdGVycywgc28gd2UgbmVlZCB0byBoaWRlIGFsbCBvZiB0aGUgYXBwcm9wcmlhdGUgZ3JpZCBjZWxscyBhcyB3ZWxsLCBhbmQgc2hvdyBvbmx5IHRoZSBtYXRjaGVzXG4gICAgICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRXcmFwcGVyO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuX2RhdGEuc2VhcmNoLnNvbSkge1xuICAgICAgICAgICAgICAgICAgICBpZihkYXRhLm5vZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgb2YgdGhlIGdyaWQgY2VsbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWQuZmluZCgnZGl2LmpzdHJlZS1ncmlkLWNlbGw6bm90KDpmaXJzdCknKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IG9ubHkgdGhvc2UgdGhhdCBtYXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5ub2Rlcy5hZGQoZGF0YS5ub2Rlcy5wYXJlbnRzVW50aWwoXCIuanN0cmVlXCIpKS5maWx0ZXIoXCIuanN0cmVlLW5vZGVcIikuZWFjaChmdW5jdGlvbiAoaSxub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gbm9kZS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluZERhdGFDZWxsKGdyaWQsaWQpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICAgICAgLm9uKFwiY2xlYXJfc2VhcmNoLmpzdHJlZVwiLCAkLnByb3h5KGZ1bmN0aW9uIChlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gc2VhcmNoIGhhcyBiZWVuIGNsZWFyZWQsIHNvIHdlIG5lZWQgdG8gc2hvdyBhbGwgcm93c1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIuZmluZCgnZGl2LmpzdHJlZS1ncmlkLWNlbGwnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LCB0aGlzKSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmICh0aGlzLl9ncmlkU2V0dGluZ3MuaXNUaGVtZXJvbGxlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAub24oXCJzZWxlY3Rfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLmFkZENsYXNzKFwidWktc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9LHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAub24oXCJkZXNlbGVjdF9ub2RlLmpzdHJlZSBkZXNlbGVjdF9hbGwuanN0cmVlXCIsJC5wcm94eShmdW5jdGlvbihlLGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yc2x0Lm9iai5jaGlsZHJlbihcImFcIikubmV4dEFsbChcImRpdlwiKS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSx0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKFwiaG92ZXJfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sdGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5vbihcImRlaG92ZXJfbm9kZS5qc3RyZWVcIiwkLnByb3h5KGZ1bmN0aW9uKGUsZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJzbHQub2JqLmNoaWxkcmVuKFwiYVwiKS5uZXh0QWxsKFwiZGl2XCIpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sdGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvLyB0ZWFyIGRvd24gdGhlIHRyZWUgZW50aXJlbHlcbiAgICAgICAgdGhpcy50ZWFyZG93biA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGd3ID0gdGhpcy5ncmlkV3JhcHBlciwgY29udGFpbmVyID0gdGhpcy5lbGVtZW50LCBncmlkcGFyZW50ID0gZ3cucGFyZW50KCk7XG4gICAgICAgICAgICBjb250YWluZXIuZGV0YWNoKCk7XG4gICAgICAgICAgICBndy5yZW1vdmUoKTtcbiAgICAgICAgICAgIGdyaWRwYXJlbnQuYXBwZW5kKGNvbnRhaW5lcik7XG4gICAgICAgICAgICBwYXJlbnQudGVhcmRvd24uY2FsbCh0aGlzKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gY2xlYW4gdGhlIGdyaWQgaW4gY2FzZSBvZiByZWRyYXcgb3IgcmVmcmVzaCBlbnRpcmUgdHJlZVxuICAgICAgICB0aGlzLl9jbGVhbl9ncmlkID0gZnVuY3Rpb24gKHRhcmdldCxpZCkge1xuICAgICAgICAgICAgdmFyIGdyaWQgPSB0aGlzLmdyaWRXcmFwcGVyO1xuICAgICAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgICAgIGZpbmREYXRhQ2VsbChncmlkLGlkKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IGFsbCBvZiB0aGUgYGRpdmAgY2hpbGRyZW4gaW4gYWxsIG9mIHRoZSBgdGRgIGluIGRhdGFSb3cgZXhjZXB0IGZvciA6Zmlyc3QgKHRoYXQgaXMgdGhlIHRyZWUgaXRzZWxmKSBhbmQgcmVtb3ZlXG4gICAgICAgICAgICAgICAgZ3JpZC5maW5kKFwiZGl2LmpzdHJlZS1ncmlkLWNlbGw6bm90KDpmaXJzdClcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIHByZXBhcmUgdGhlIGhlYWRlcnNcbiAgICAgICAgdGhpcy5fcHJlcGFyZV9oZWFkZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVyLCBpLCBjb2wsIGdzID0gdGhpcy5fZ3JpZFNldHRpbmdzLGNvbHMgPSBncy5jb2x1bW5zIHx8IFtdLCB3aWR0aCwgZGVmYXVsdFdpZHRoID0gZ3MuY29sdW1uV2lkdGgsIHJlc2l6YWJsZSA9IGdzLnJlc2l6YWJsZSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGNsLCBjY2wsIHZhbCwgbWFyZ2luLCBsYXN0LCB0ciA9IGdzLmlzVGhlbWVyb2xsZXIsIGNsYXNzQWRkID0gKHRyP1widGhlbWVyb2xsZXJcIjpcInJlZ3VsYXJcIiksIHB1bGxlcixcbiAgICAgICAgICAgIGhhc0hlYWRlcnMgPSBmYWxzZSwgZ3JpZHBhcmVudCA9IHRoaXMuZ3JpZHBhcmVudCxcbiAgICAgICAgICAgIGNvbmYgPSBncy5kZWZhdWx0Q29uZixcbiAgICAgICAgICAgIGNvbE51bSA9IDAsIGJvclBhZFdpZHRoID0gMCwgdG90YWxXaWR0aCA9IDA7XG4gICAgICAgICAgICAvLyBzYXZlIHRoZSBvcmlnaW5hbCBwYXJlbnQgc28gd2UgY2FuIHJlcGFyZW50IG9uIGRlc3Ryb3lcbiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gZ3JpZHBhcmVudDtcblxuXG4gICAgICAgICAgICAvLyBjcmVhdGUgdGhlIGhlYWRlcnNcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgLy9jb2wgPSAkKFwiPGNvbC8+XCIpO1xuICAgICAgICAgICAgICAgIC8vY29sLmFwcGVuZFRvKGNvbGdyb3VwKTtcbiAgICAgICAgICAgICAgICBjbCA9IGNvbHNbaV0uaGVhZGVyQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBjY2wgPSBjb2xzW2ldLmNvbHVtbkNsYXNzIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgdmFsID0gY29sc1tpXS5oZWFkZXIgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpZiAodmFsKSB7aGFzSGVhZGVycyA9IHRydWU7fVxuICAgICAgICAgICAgICAgIHdpZHRoID0gY29sc1tpXS53aWR0aCB8fCBkZWZhdWx0V2lkdGg7XG5cbiAgICAgICAgICAgICAgICAvLyB3ZSBvbmx5IGRlYWwgd2l0aCBib3JkZXJzIGlmIHdpZHRoIGlzIG5vdCBhdXRvIGFuZCBub3QgcGVyY2VudGFnZXNcbiAgICAgICAgICAgICAgICBib3JQYWRXaWR0aCA9IHRyID8gMSs2IDogMis4OyAvLyBhY2NvdW50IGZvciB0aGUgYm9yZGVycyBhbmQgcGFkZGluZ1xuICAgICAgICAgICAgICAgIGlmICh3aWR0aCAhPT0gJ2F1dG8nICYmIHR5cGVvZih3aWR0aCkgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggLT0gYm9yUGFkV2lkdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1hcmdpbiA9IGkgPT09IDAgPyAzIDogMDtcbiAgICAgICAgICAgICAgICBjb2wgPSB0aGlzLm1pZFdyYXBwZXIuY2hpbGRyZW4oXCJkaXYuanN0cmVlLWdyaWQtY29sdW1uLVwiK2kpO1xuICAgICAgICAgICAgICAgIGxhc3QgPSAkKFwiPGRpdj48L2Rpdj5cIikuY3NzKGNvbmYpLmNzcyh7XCJtYXJnaW4tbGVmdFwiOiBtYXJnaW59KS5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWRpdi1cIit0aGlzLnVuaXErXCItXCIraStcIiBcIisodHI/XCJ1aS13aWRnZXQtaGVhZGVyIFwiOlwiXCIpK1wiIGpzdHJlZS1ncmlkLWhlYWRlciBqc3RyZWUtZ3JpZC1oZWFkZXItY2VsbCBqc3RyZWUtZ3JpZC1oZWFkZXItXCIrY2xhc3NBZGQrXCIgXCIrY2wrXCIgXCIrY2NsKS5odG1sKHZhbCk7XG4gICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcygodHI/XCJ1aS13aWRnZXQtaGVhZGVyIFwiOlwiXCIpK1wianN0cmVlLWdyaWQtaGVhZGVyIGpzdHJlZS1ncmlkLWhlYWRlci1cIitjbGFzc0FkZCk7XG4gICAgICAgICAgICAgICAgbGFzdC5wcmVwZW5kVG8oY29sKTtcbiAgICAgICAgICAgICAgICB0b3RhbFdpZHRoICs9IGxhc3Qub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgIHB1bGxlciA9ICQoXCI8ZGl2IGNsYXNzPSdqc3RyZWUtZ3JpZC1zZXBhcmF0b3IganN0cmVlLWdyaWQtc2VwYXJhdG9yLVwiK2NsYXNzQWRkKyh0ciA/IFwiIHVpLXdpZGdldC1oZWFkZXJcIiA6IFwiXCIpKyhyZXNpemFibGU/IFwiIGpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIjpcIlwiKStcIic+Jm5ic3A7PC9kaXY+XCIpLmFwcGVuZFRvKGxhc3QpO1xuICAgICAgICAgICAgICAgIGNvbC53aWR0aCh3aWR0aCk7XG4gICAgICAgICAgICAgICAgY29sLmNzcyhcIm1pbi13aWR0aFwiLHdpZHRoKTtcbiAgICAgICAgICAgICAgICBjb2wuY3NzKFwibWF4LXdpZHRoXCIsd2lkdGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsYXN0LmFkZENsYXNzKCh0cj9cInVpLXdpZGdldC1oZWFkZXIgXCI6XCJcIikrXCJqc3RyZWUtZ3JpZC1oZWFkZXIganN0cmVlLWdyaWQtaGVhZGVyLWxhc3QganN0cmVlLWdyaWQtaGVhZGVyLVwiK2NsYXNzQWRkKTtcbiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdpZHRoIGdpdmVuIGZvciB0aGUgbGFzdCBjb2x1bW4sIGRvIGl0IHZpYSBhdXRvbWF0aWNcbiAgICAgICAgICAgIGlmIChjb2xzW2NvbHMubGVuZ3RoLTFdLndpZHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0b3RhbFdpZHRoIC09IHdpZHRoO1xuICAgICAgICAgICAgICAgIGNvbC5jc3Moe3dpZHRoOlwiYXV0b1wifSk7XG4gICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLXdpZHRoLWF1dG9cIikubmV4dChcIi5qc3RyZWUtZ3JpZC1zZXBhcmF0b3JcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGFzSGVhZGVycykge1xuICAgICAgICAgICAgICAgIC8vIHNhdmUgdGhlIG9mZnNldCBvZiB0aGUgZGl2IGZyb20gdGhlIGJvZHlcbiAgICAgICAgICAgICAgICAvL2dzLmRpdk9mZnNldCA9IGhlYWRlci5wYXJlbnQoKS5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgICAgICAgIGdzLmhlYWRlciA9IGhlYWRlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJChcImRpdi5qc3RyZWUtZ3JpZC1oZWFkZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuYm91bmQgJiYgcmVzaXphYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgJChkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAgaSwgcmVmLCBjb2xzLCB3aWR0aHMsIGhlYWRlcnMsIHcsIGN1cnJlbnRUcmVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDbGlja2VkU2VwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VHJlZSA9IHRvUmVzaXplLmNsb3Nlc3QoXCIuanN0cmVlLWdyaWQtd3JhcHBlclwiKS5maW5kKFwiLmpzdHJlZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZiA9ICQuanN0cmVlLnJlZmVyZW5jZShjdXJyZW50VHJlZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xzID0gcmVmLnNldHRpbmdzLmdyaWQuY29sdW1ucztcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB0b1Jlc2l6ZS5wYXJlbnQoKS5jaGlsZHJlbihcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihjb2xOdW0pIHx8IGNvbE51bSA8IDApIHsgcmVmLl9ncmlkU2V0dGluZ3MudHJlZVdpZHRoRGlmZiA9IGN1cnJlbnRUcmVlLmZpbmQoXCJpbnM6ZXEoMClcIikud2lkdGgoKSArIGN1cnJlbnRUcmVlLmZpbmQoXCJhOmVxKDApXCIpLndpZHRoKCkgLSByZWYuX2dyaWRTZXR0aW5ncy5jb2x1bW5zWzBdLndpZHRoOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpc0NsaWNrZWRTZXAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVzaXplID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdyA9IHBhcnNlRmxvYXQoaGVhZGVyc1tpXS5zdHlsZS53aWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGhzW2ldID0ge3c6IHcsIHI6IGk9PT1jb2xOdW0gfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYuX2dyaWRTZXR0aW5ncy5jb2x1bW5zW2ldLndpZHRoID0gdztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFRyZWUudHJpZ2dlcihcInJlc2l6ZV9jb2x1bW4uanN0cmVlLWdyaWRcIiwgd2lkdGhzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLm1vdXNlbW92ZShmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2xpY2tlZFNlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld01vdXNlWCA9IGUucGFnZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmYgPSBuZXdNb3VzZVggLSBvbGRNb3VzZVgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkUHJldkhlYWRlcklubmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByZXZDb2xXaWR0aCwgbmV3UHJldkNvbFdpZHRoO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgIT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmV2SGVhZGVySW5uZXIgPSB0b1Jlc2l6ZS53aWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmV2Q29sV2lkdGggPSBwYXJzZUZsb2F0KHRvUmVzaXplLmNzcyhcIndpZHRoXCIpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgYSBDaHJvbWUgaXNzdWUgd2l0aCBjb2x1bW5zIHNldCB0byBhdXRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoYW5rcyB0byBCcmFidXMgaHR0cHM6Ly9naXRodWIuY29tL3NpZGUtYnktc2lkZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9sZFByZXZDb2xXaWR0aCkge29sZFByZXZDb2xXaWR0aCA9IHRvUmVzaXplLmlubmVyV2lkdGgoKTt9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgZGlmZiBjYW5ub3QgYmUgYmV5b25kIHRoZSBsZWZ0L3JpZ2h0IGxpbWl0c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmID0gZGlmZiA8IDAgPyBNYXRoLm1heChkaWZmLC1vbGRQcmV2SGVhZGVySW5uZXIpIDogZGlmZjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UHJldkNvbFdpZHRoID0gKG9sZFByZXZDb2xXaWR0aCtkaWZmKStcInB4XCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25seSBkbyB0aGlzIGlmIHdlIGFyZSBub3Qgc2hyaW5raW5nIHBhc3QgMCBvbiBsZWZ0IC0gYW5kIGxpbWl0IGl0IHRvIHRoYXQgYW1vdW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaWZmID4gMCB8fCBvbGRQcmV2SGVhZGVySW5uZXIgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Jlc2l6ZS53aWR0aChuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUuY3NzKFwibWluLXdpZHRoXCIsbmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVzaXplLmNzcyhcIm1heC13aWR0aFwiLG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRNb3VzZVggPSBuZXdNb3VzZVg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFdyYXBwZXIub24oXCJzZWxlY3RzdGFydFwiLCBcIi5qc3RyZWUtZ3JpZC1yZXNpemFibGUtc2VwYXJhdG9yXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pLm9uKFwibW91c2Vkb3duXCIsIFwiLmpzdHJlZS1ncmlkLXJlc2l6YWJsZS1zZXBhcmF0b3JcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNDbGlja2VkU2VwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgb2xkTW91c2VYID0gZS5wYWdlWDtcbiAgICAgICAgICAgICAgICAgICAgdG9SZXNpemUgPSAkKHRoaXMpLmNsb3Nlc3QoXCJkaXYuanN0cmVlLWdyaWQtY29sdW1uXCIpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbWF4IHJpZ2h0bW9zdCBwb3NpdGlvbiB3ZSB3aWxsIGFsbG93IGlzIHRoZSByaWdodC1tb3N0IG9mIHRoZSB3cmFwcGVyIG1pbnVzIGEgYnVmZmVyICgxMClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKFwiZGJsY2xpY2tcIiwgXCIuanN0cmVlLWdyaWQtcmVzaXphYmxlLXNlcGFyYXRvclwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2tlZFNlcCA9ICQodGhpcyksIGNvbCA9IGNsaWNrZWRTZXAuY2xvc2VzdChcImRpdi5qc3RyZWUtZ3JpZC1jb2x1bW5cIiksXG4gICAgICAgICAgICAgICAgICAgIG9sZFByZXZDb2xXaWR0aCA9IHBhcnNlRmxvYXQoY29sLmNzcyhcIndpZHRoXCIpKSwgbmV3V2lkdGggPSAwLCBkaWZmLFxuICAgICAgICAgICAgICAgICAgICBvbGRQcmV2SGVhZGVySW5uZXIgPSBjb2wud2lkdGgoKSwgbmV3UHJldkNvbFdpZHRoO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy9maW5kIGxhcmdlc3Qgd2lkdGhcbiAgICAgICAgICAgICAgICAgICAgY29sLmZpbmQoXCIuanN0cmVlLWdyaWQtY2VsbFwiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMpLCB3aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3NzKFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3NzKFwid2lkdGhcIiwgXCJhdXRvXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBpdGVtLm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY3NzKFwicG9zaXRpb25cIiwgXCJyZWxhdGl2ZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpZHRoPm5ld1dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3V2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IG5ld1dpZHRoLW9sZFByZXZDb2xXaWR0aDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBkaWZmIGNhbm5vdCBiZSBiZXlvbmQgdGhlIGxlZnQgbGltaXRzXG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSBkaWZmIDwgMCA/IE1hdGgubWF4KGRpZmYsLW9sZFByZXZIZWFkZXJJbm5lcikgOiBkaWZmO1xuICAgICAgICAgICAgICAgICAgICBuZXdQcmV2Q29sV2lkdGggPSAob2xkUHJldkNvbFdpZHRoK2RpZmYpK1wicHhcIjtcblxuICAgICAgICAgICAgICAgICAgICBjb2wud2lkdGgobmV3UHJldkNvbFdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNzcyhcIm1pbi13aWR0aFwiLG5ld1ByZXZDb2xXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbC5jc3MoXCJtYXgtd2lkdGhcIixuZXdQcmV2Q29sV2lkdGgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKlxuICAgICAgICAgKiBPdmVycmlkZSByZWRyYXdfbm9kZSB0byBjb3JyZWN0bHkgaW5zZXJ0IHRoZSBncmlkXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlZHJhd19ub2RlID0gZnVuY3Rpb24ob2JqLCBkZWVwLCBpc19jYWxsYmFjaywgZm9yY2VfcmVuZGVyKSB7XG4gICAgICAgICAgICAvLyBmaXJzdCBhbGxvdyB0aGUgcGFyZW50IHRvIHJlZHJhdyB0aGUgbm9kZVxuICAgICAgICAgICAgb2JqID0gcGFyZW50LnJlZHJhd19ub2RlLmNhbGwodGhpcywgb2JqLCBkZWVwLCBpc19jYWxsYmFjaywgZm9yY2VfcmVuZGVyKTtcbiAgICAgICAgICAgIC8vIG5leHQgcHJlcGFyZSB0aGUgZ3JpZFxuICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJlcGFyZV9ncmlkKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhbl9ncmlkKCk7XG4gICAgICAgICAgICByZXR1cm4gcGFyZW50LnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9oaWRlX2dyaWQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZSAmJiBub2RlLmNoaWxkcmVuX2QgPyBub2RlLmNoaWxkcmVuX2QgOiBbXSwgaTtcbiAgICAgICAgICAgIC8vIGdvIHRocm91Z2ggZWFjaCBjb2x1bW4sIHJlbW92ZSBhbGwgY2hpbGRyZW4gd2l0aCB0aGUgY29ycmVjdCBJRCBuYW1lXG4gICAgICAgICAgICBmb3IgKGk9MDtpPGNoaWxkcmVuLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICBmaW5kRGF0YUNlbGwodGhpcy5ncmlkV3JhcHBlcixjaGlsZHJlbltpXSkucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaG9sZGluZ0NlbGxzID0ge307XG4gICAgICAgIHRoaXMuZ2V0SG9sZGluZ0NlbGxzID0gZnVuY3Rpb24gKG9iaixjb2wsaGMpIHtcbiAgICAgICAgICAgIHZhciByZXQgPSAkKCksIGNoaWxkcmVuID0gb2JqLmNoaWxkcmVufHxbXSwgY2hpbGQsIGk7XG4gICAgICAgICAgICAvLyBydW4gdGhyb3VnaCBlYWNoIGNoaWxkLCByZW5kZXIgaXQsIGFuZCB0aGVuIHJlbmRlciBpdHMgY2hpbGRyZW4gcmVjdXJzaXZlbHlcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y2hpbGRyZW4ubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIGNoaWxkID0gR1JJRENFTExJRF9QUkVGSVgrZXNjYXBlSWQoY2hpbGRyZW5baV0pK0dSSURDRUxMSURfUE9TVEZJWCtjb2w7XG4gICAgICAgICAgICAgICAgaWYgKGhjW2NoaWxkXSAmJiBvYmouc3RhdGUub3BlbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldCA9IHJldC5hZGQoaGNbY2hpbGRdKS5hZGQodGhpcy5nZXRIb2xkaW5nQ2VsbHModGhpcy5nZXRfbm9kZShjaGlsZHJlbltpXSksY29sLGhjKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vZGVsZXRlIGhjW2NoaWxkXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ocmV0KTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHB1dCBhIGdyaWQgY2VsbCBpbiBlZGl0IG1vZGUgKGlucHV0IGZpZWxkIHRvIGVkaXQgdGhlIGRhdGEpXG4gICAgICAgICAqIEBuYW1lIGVkaXQob2JqLCBjb2wpXG4gICAgICAgICAqIEBwYXJhbSAge21peGVkfSBvYmpcbiAgICAgICAgICogQHBhcmFtICB7b2JqfSBjb2wgZGVmaW5pdGlvblxuICAgICAgICAgKiBAcGFyYW0gIHtlbGVtZW50fSBjZWxsIGVsZW1lbnQsIGVpdGhlciBzcGFuIG9yIHdyYXBwaW5nIGRpdlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fZWRpdCA9IGZ1bmN0aW9uIChvYmosIGNvbCwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYoIW9iaikgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucHJvcChcInRhZ05hbWVcIikudG9Mb3dlckNhc2UoKSA9PT0gXCJkaXZcIikge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5jaGlsZHJlbihcInNwYW46Zmlyc3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBuZWVkIHRvIGZpbmQgdGhlIGVsZW1lbnQgLSBsYXRlclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBydGwgPSB0aGlzLl9kYXRhLmNvcmUucnRsLFxuICAgICAgICAgICAgICAgIHcgID0gdGhpcy5lbGVtZW50LndpZHRoKCksXG4gICAgICAgICAgICAgICAgdCA9IG9iai5kYXRhW2NvbC52YWx1ZV0sXG4gICAgICAgICAgICAgICAgaDEgPSAkKFwiPFwiK1wiZGl2IC8+XCIsIHsgY3NzIDogeyBcInBvc2l0aW9uXCIgOiBcImFic29sdXRlXCIsIFwidG9wXCIgOiBcIi0yMDBweFwiLCBcImxlZnRcIiA6IChydGwgPyBcIjBweFwiIDogXCItMTAwMHB4XCIpLCBcInZpc2liaWxpdHlcIiA6IFwiaGlkZGVuXCIgfSB9KS5hcHBlbmRUbyhcImJvZHlcIiksXG4gICAgICAgICAgICAgICAgaDIgPSAkKFwiPFwiK1wiaW5wdXQgLz5cIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiIDogdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIiA6IFwianN0cmVlLXJlbmFtZS1pbnB1dFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjc3NcIiA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhZGRpbmdcIiA6IFwiMFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYm9yZGVyXCIgOiBcIjFweCBzb2xpZCBzaWx2ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJveC1zaXppbmdcIiA6IFwiYm9yZGVyLWJveFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGlzcGxheVwiIDogXCJpbmxpbmUtYmxvY2tcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhlaWdodFwiIDogKHRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpICsgXCJweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGluZUhlaWdodFwiIDogKHRoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpICsgXCJweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2lkdGhcIiA6IFwiMTUwcHhcIiAvLyB3aWxsIGJlIHNldCBhIGJpdCBmdXJ0aGVyIGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcImJsdXJcIiA6ICQucHJveHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gaDIudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2F2ZSB0aGUgdmFsdWUgaWYgY2hhbmdlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHYgPT09IFwiXCIgfHwgdiA9PT0gdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVtjb2wudmFsdWVdID0gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoJ3VwZGF0ZV9jZWxsLmpzdHJlZS1ncmlkJyx7bm9kZTpvYmosIGNvbDpjb2wudmFsdWUsIHZhbHVlOnYsIG9sZDp0fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXBhcmVfZ3JpZCh0aGlzLmdldF9ub2RlKG9iaix0cnVlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBcImtleWRvd25cIiA6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldmVudC53aGljaDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09IDI3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09IDI3IHx8IGtleSA9PT0gMTMgfHwga2V5ID09PSAzNyB8fCBrZXkgPT09IDM4IHx8IGtleSA9PT0gMzkgfHwga2V5ID09PSA0MCB8fCBrZXkgPT09IDMyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihrZXkgPT09IDI3IHx8IGtleSA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xpY2tcIiA6IGZ1bmN0aW9uIChlKSB7IGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm1vdXNlZG93blwiIDogZnVuY3Rpb24gKGUpIHsgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwia2V5dXBcIiA6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgyLndpZHRoKE1hdGgubWluKGgxLnRleHQoXCJwV1wiICsgdGhpcy52YWx1ZSkud2lkdGgoKSx3KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJrZXlwcmVzc1wiIDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihldmVudC53aGljaCA9PT0gMTMpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZuID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9udEZhbWlseSAgICAgICAgOiBlbGVtZW50LmNzcygnZm9udEZhbWlseScpICAgICAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250U2l6ZScpICAgICAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0ICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250V2VpZ2h0JykgICAgICAgIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFN0eWxlICAgICAgICA6IGVsZW1lbnQuY3NzKCdmb250U3R5bGUnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250U3RyZXRjaCAgICAgICAgOiBlbGVtZW50LmNzcygnZm9udFN0cmV0Y2gnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb250VmFyaWFudCAgICAgICAgOiBlbGVtZW50LmNzcygnZm9udFZhcmlhbnQnKSAgICAgICAgfHwgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nICAgIDogZWxlbWVudC5jc3MoJ2xldHRlclNwYWNpbmcnKSAgICB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmRTcGFjaW5nICAgICAgICA6IGVsZW1lbnQuY3NzKCd3b3JkU3BhY2luZycpICAgICAgICB8fCAnJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBlbGVtZW50LmhpZGUoKTtcbiAgICAgICAgICAgIGVsZW1lbnQucGFyZW50KCkuYXBwZW5kKGgyKTtcbiAgICAgICAgICAgIGgyLmNzcyhmbikud2lkdGgoTWF0aC5taW4oaDEudGV4dChcInBXXCIgKyBoMlswXS52YWx1ZSkud2lkdGgoKSx3KSlbMF0uc2VsZWN0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3ByZXBhcmVfZ3JpZCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHZhciBncyA9IHRoaXMuX2dyaWRTZXR0aW5ncywgYyA9IGdzLnRyZWVDbGFzcywgX3RoaXMgPSB0aGlzLCB0LCBjb2xzID0gZ3MuY29sdW1ucyB8fCBbXSwgd2lkdGgsIHRyID0gZ3MuaXNUaGVtZXJvbGxlcixcbiAgICAgICAgICAgIHRyZWUgPSB0aGlzLmVsZW1lbnQsIHJvb3RpZCA9IHRoaXMucm9vdGlkLFxuICAgICAgICAgICAgY2xhc3NBZGQgPSAodHI/XCJ0aGVtZXJvbGxlclwiOlwicmVndWxhclwiKSwgaW1nLCBvYmpEYXRhID0gdGhpcy5nZXRfbm9kZShvYmopLFxuICAgICAgICAgICAgZGVmYXVsdFdpZHRoID0gZ3MuY29sdW1uV2lkdGgsIGNvbmYgPSBncy5kZWZhdWx0Q29uZiwgY2VsbENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICh0cmVlLG5vZGUsdmFsLGNvbCx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9ub2RlID0gdHJlZS5maW5kKFwiI1wiK25vZGUuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnRyaWdnZXIoXCJjbGljay5qc3RyZWVcIixlKTtcbiAgICAgICAgICAgICAgICAgICAgdHJlZS50cmlnZ2VyKFwic2VsZWN0X2NlbGwuanN0cmVlLWdyaWRcIiwgW3t2YWx1ZTogdmFsLGNvbHVtbjogY29sLmhlYWRlcixub2RlOiBub2RlLGdyaWQ6JCh0aGlzKSxzb3VyY2VOYW1lOiBjb2wudmFsdWV9XSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sIGNlbGxSaWdodENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICh0cmVlLG5vZGUsdmFsLGNvbCx0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChncy5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLnZha2F0YS5jb250ZXh0LnNob3codGhpcyx7ICd4JyA6IGUucGFnZVgsICd5JyA6IGUucGFnZVkgfSx7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlZGl0XCI6e2xhYmVsOlwiRWRpdFwiLFwiYWN0aW9uXCI6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB0LmdldF9ub2RlKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZWRpdChvYmosY29sLGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvdmVySW5IYW5kbGVyID0gZnVuY3Rpb24gKG5vZGUsIGpzVHJlZUluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgeyBqc1RyZWVJbnN0YW5jZS5ob3Zlcl9ub2RlKG5vZGUpOyB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvdmVyT3V0SGFuZGxlciA9IGZ1bmN0aW9uIChub2RlLCBqc1RyZWVJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsganNUcmVlSW5zdGFuY2UuZGVob3Zlcl9ub2RlKG5vZGUpOyB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGksIHZhbCwgY2wsIHdjbCwgY2NsLCBhLCBsYXN0LCB2YWxDbGFzcywgd2lkZVZhbENsYXNzLCBzcGFuLCBwYWRkaW5nbGVmdCwgdGl0bGUsIGdyaWRDZWxsTmFtZSwgZ3JpZENlbGxQYXJlbnRJZCwgZ3JpZENlbGxQYXJlbnQsXG4gICAgICAgICAgICBncmlkQ2VsbFByZXYsIGdyaWRDZWxsUHJldklkLCBncmlkQ2VsbE5leHQsIGdyaWRDZWxsTmV4dElkLCBncmlkQ2VsbENoaWxkLCBncmlkQ2VsbENoaWxkSWQsXG4gICAgICAgICAgICBjb2wsIGNvbnRlbnQsIHRtcFdpZHRoLCBtdyA9IHRoaXMubWlkV3JhcHBlciwgZGF0YUNlbGwsIGxpZCA9IG9iakRhdGEuaWQsXG4gICAgICAgICAgICBwZWVycyA9IHRoaXMuZ2V0X25vZGUob2JqRGF0YS5wYXJlbnQpLmNoaWxkcmVuLFxuICAgICAgICAgICAgLy8gZmluZCBteSBwb3NpdGlvbiBpbiB0aGUgbGlzdCBvZiBwZWVycy4gXCJwZWVyc1wiIGlzIHRoZSBsaXN0IG9mIGV2ZXJ5b25lIGF0IG15IGxldmVsIHVuZGVyIG15IHBhcmVudCwgaW4gb3JkZXJcbiAgICAgICAgICAgIHBvcyA9ICQuaW5BcnJheShsaWQscGVlcnMpLFxuICAgICAgICAgICAgaGMgPSB0aGlzLmhvbGRpbmdDZWxscywgcmVuZGVyZWQgPSBmYWxzZSwgY2xvc2VkO1xuICAgICAgICAgICAgLy8gZ2V0IG91ciBjb2x1bW4gZGVmaW5pdGlvblxuICAgICAgICAgICAgdCA9ICQob2JqKTtcblxuICAgICAgICAgICAgLy8gZmluZCB0aGUgYSBjaGlsZHJlblxuICAgICAgICAgICAgYSA9IHQuY2hpbGRyZW4oXCJhXCIpO1xuXG4gICAgICAgICAgICBpZiAoYS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjbG9zZWQgPSAhb2JqRGF0YS5zdGF0ZS5vcGVuZWQ7XG4gICAgICAgICAgICAgICAgZ3JpZENlbGxOYW1lID0gR1JJRENFTExJRF9QUkVGSVgrZXNjYXBlSWQobGlkKStHUklEQ0VMTElEX1BPU1RGSVg7XG4gICAgICAgICAgICAgICAgZ3JpZENlbGxQYXJlbnRJZCA9IG9iakRhdGEucGFyZW50ID09PSBcIiNcIiA/IG51bGwgOiBvYmpEYXRhLnBhcmVudDtcbiAgICAgICAgICAgICAgICBhLmFkZENsYXNzKGMpO1xuICAgICAgICAgICAgICAgIC8vcmVuZGVyQVdpZHRoKGEsX3RoaXMpO1xuICAgICAgICAgICAgICAgIHJlbmRlckFUaXRsZShhLHQsX3RoaXMpO1xuICAgICAgICAgICAgICAgIGxhc3QgPSBhO1xuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8Y29scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyZWVjb2wgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbCA9IGNvbHNbaV07XG4gICAgICAgICAgICAgICAgICAgIGRhdGFDZWxsID0gbXcuY2hpbGRyZW4oXCJkaXY6ZXEoXCIraStcIilcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgY2VsbENsYXNzLCB0aGUgd2lkZUNlbGxDbGFzcywgYW5kIHRoZSBjb2x1bW5DbGFzc1xuICAgICAgICAgICAgICAgICAgICBjbCA9IGNvbC5jZWxsQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgd2NsID0gY29sLndpZGVDZWxsQ2xhc3MgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgY2NsID0gY29sLmNvbHVtbkNsYXNzIHx8IFwiXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGEgY29sdW1uIGNsYXNzIHRvIHRoZSBkYXRhQ2VsbFxuICAgICAgICAgICAgICAgICAgICBkYXRhQ2VsbC5hZGRDbGFzcyhjY2wpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBjb250ZW50cyBvZiB0aGUgY2VsbCAtIHZhbHVlIGNvdWxkIGJlIGEgc3RyaW5nIG9yIGEgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIGNvbC52YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihjb2wudmFsdWUpID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBjb2wudmFsdWUob2JqRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iakRhdGEuZGF0YSAhPT0gbnVsbCAmJiBvYmpEYXRhLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBvYmpEYXRhLmRhdGFbY29sLnZhbHVlXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gb2JqRGF0YS5kYXRhW2NvbC52YWx1ZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihjb2wuZm9ybWF0KSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBjb2wuZm9ybWF0KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBwdXQgaW1hZ2VzIGluc3RlYWQgb2YgdGV4dCBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC5pbWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaW1nID0gY29sLmltYWdlc1t2YWxdIHx8IGNvbC5pbWFnZXNbXCJkZWZhdWx0XCJdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW1nKSB7Y29udGVudCA9IGltZ1swXSA9PT0gXCIqXCIgPyAnPHNwYW4gY2xhc3M9XCInK2ltZy5zdWJzdHIoMSkrJ1wiPjwvc3Bhbj4nIDogJzxpbWcgc3JjPVwiJytpbWcrJ1wiPic7fVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyBjb250ZW50ID0gdmFsOyB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGVudCBjYW5ub3QgYmUgYmxhbmssIG9yIGl0IG1lc3NlcyB1cCBoZWlnaHRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb250ZW50ID09PSB1bmRlZmluZWQgfHwgY29udGVudCA9PT0gbnVsbCB8fCBCTEFOS1JFLnRlc3QoY29udGVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBcIiZuYnNwO1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB2YWx1ZUNsYXNzXG4gICAgICAgICAgICAgICAgICAgIHZhbENsYXNzID0gY29sLnZhbHVlQ2xhc3MgJiYgb2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkID8gb2JqRGF0YS5kYXRhW2NvbC52YWx1ZUNsYXNzXSB8fCBcIlwiIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbENsYXNzICYmIGNvbC52YWx1ZUNsYXNzUHJlZml4ICYmIGNvbC52YWx1ZUNsYXNzUHJlZml4ICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxDbGFzcyA9IGNvbC52YWx1ZUNsYXNzUHJlZml4ICsgdmFsQ2xhc3M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSB3aWRlVmFsdWVDbGFzc1xuICAgICAgICAgICAgICAgICAgICB3aWRlVmFsQ2xhc3MgPSBjb2wud2lkZVZhbHVlQ2xhc3MgJiYgb2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkID8gb2JqRGF0YS5kYXRhW2NvbC53aWRlVmFsdWVDbGFzc10gfHwgXCJcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWRlVmFsQ2xhc3MgJiYgY29sLndpZGVWYWx1ZUNsYXNzUHJlZml4ICYmIGNvbC53aWRlVmFsdWVDbGFzc1ByZWZpeCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkZVZhbENsYXNzID0gY29sLndpZGVWYWx1ZUNsYXNzUHJlZml4ICsgd2lkZVZhbENsYXNzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgdGl0bGVcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSBjb2wudGl0bGUgJiYgb2JqRGF0YS5kYXRhICE9PSBudWxsICYmIG9iakRhdGEuZGF0YSAhPT0gdW5kZWZpbmVkID8gb2JqRGF0YS5kYXRhW2NvbC50aXRsZV0gfHwgXCJcIiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0cmlwIG91dCBIVE1MXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZShodG1sc3RyaXByZSwgJycpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgd2lkdGhcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZ2xlZnQgPSA3O1xuICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGNvbC53aWR0aCB8fCBkZWZhdWx0V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWR0aCAhPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHRtcFdpZHRoIHx8ICh3aWR0aCAtIHBhZGRpbmdsZWZ0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBkYXRhQ2VsbC5jaGlsZHJlbihcImRpdiNcIitncmlkQ2VsbE5hbWUraSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbGFzdCB8fCBsYXN0Lmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgPSAkKFwiPGRpdj48L2Rpdj5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiPHNwYW4+PC9zcGFuPlwiKS5hcHBlbmRUbyhsYXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuYXR0cihcImlkXCIsZ3JpZENlbGxOYW1lK2kpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhncmlkQ2VsbE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5hdHRyKE5PREVfREFUQV9BVFRSLGxpZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHB1dCBpdCBpbiB0aGUgZGF0YUNlbGwgLSBhZnRlciB0aGUgcGFyZW50LCBidXQgdGhlIHBvc2l0aW9uIG1hdHRlcnNcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBubyBwYXJlbnQsIHRoZW4gd2UgYXJlIG9uZSBvZiB0aGUgcm9vdCBub2RlcywgYnV0IHN0aWxsIG5lZWQgdG8gbG9vayBhdCBwZWVyc1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGZpcnN0LCBpLmUuIHBvcyA9PT0gMCwgd2UgZ28gcmlnaHQgYWZ0ZXIgdGhlIHBhcmVudDtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIG5vdCBmaXJzdCwgYW5kIG91ciBwcmV2aW91cyBwZWVyIChvbmUgYmVmb3JlIHVzKSBpcyBjbG9zZWQsIHdlIGdvIHJpZ2h0IGFmdGVyIHRoZSBwcmV2aW91cyBwZWVyIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgYXJlIG5vdCBmaXJzdCwgYW5kIG91ciBwcmV2aW91cyBwZWVyIGlzIG9wZW5lZCwgdGhlbiB3ZSBoYXZlIHRvIGZpbmQgaXRzIHlvdW5nZXN0ICYgbG93ZXN0IGNsb3NlZCBjaGlsZCAoaW5jbC4gbGVhZilcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgLy8gcHJvYmFibHkgYmUgbXVjaCBlYXNpZXIgdG8gZ28gKmJlZm9yZSogb3VyIG5leHQgb25lXG4gICAgICAgICAgICAgICAgICAgIC8vIGJ1dCB0aGF0IG9uZSBtaWdodCBub3QgYmUgZHJhd24geWV0XG4gICAgICAgICAgICAgICAgICAgIC8vIGhlcmUgaXMgdGhlIGxvZ2ljIGZvciBqc3RyZWUgZHJhd2luZzpcbiAgICAgICAgICAgICAgICAgICAgLy8gICBpdCBkcmF3cyBwZWVycyBmcm9tIGZpcnN0IHRvIGxhc3Qgb3IgZnJvbSBsYXN0IHRvIGZpcnN0XG4gICAgICAgICAgICAgICAgICAgIC8vICAgaXQgZHJhd3MgY2hpbGRyZW4gYmVmb3JlIGEgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIEkgY2FuIHJlbHkgb24gbXkgKnBhcmVudCogbm90IGJlaW5nIGRyYXduLCBidXQgSSBjYW5ub3QgcmVseSBvbiBteSBwcmV2aW91cyBwZWVyIG9yIG15IG5leHQgcGVlciBiZWluZyBkcmF3blxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGRvIHRoZSBmb2xsb3dpbmc6XG4gICAgICAgICAgICAgICAgICAgIC8vICAgMS0gV2UgYXJlIHRoZSBmaXJzdCBjaGlsZDogaW5zdGFsbCBhZnRlciB0aGUgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIC8vICAgMi0gT3VyIHByZXZpb3VzIHBlZXIgaXMgYWxyZWFkeSBkcmF3bjogaW5zdGFsbCBhZnRlciB0aGUgcHJldmlvdXMgcGVlclxuICAgICAgICAgICAgICAgICAgICAvLyAgIDMtIE91ciBwcmV2aW91cyBwZWVyIGlzIG5vdCBkcmF3biwgd2UgaGF2ZSBhIGNoaWxkIHRoYXQgaXMgZHJhd246IGluc3RhbGwgcmlnaHQgYmVmb3JlIG91ciBmaXJzdCBjaGlsZFxuICAgICAgICAgICAgICAgICAgICAvLyAgIDQtIE91ciBwcmV2aW91cyBwZWVyIGlzIG5vdCBkcmF3biwgd2UgaGF2ZSBubyBjaGlsZCB0aGF0IGlzIGRyYXduLCBvdXIgbmV4dCBwZWVyIGlzIGRyYXduOiBpbnN0YWxsIHJpZ2h0IGJlZm9yZSBvdXIgbmV4dCBwZWVyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgNS0gT3VyIHByZXZpb3VzIHBlZXIgaXMgbm90IGRyYXduLCB3ZSBoYXZlIG5vIGNoaWxkIHRoYXQgaXMgZHJhd24sIG91ciBuZXh0IHBlZXIgaXMgbm90IGRyYXduOiBpbnN0YWxsIHJpZ2h0IGFmdGVyIHBhcmVudFxuICAgICAgICAgICAgICAgICAgICBncmlkQ2VsbFByZXZJZCA9IHBvcyA8PTAgPyBvYmpEYXRhLnBhcmVudCA6IGZpbmRMYXN0Q2xvc2VkTm9kZSh0aGlzLHBlZXJzW3Bvcy0xXSk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsUHJldiA9IGZpbmREYXRhQ2VsbChkYXRhQ2VsbCxncmlkQ2VsbFByZXZJZCk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsTmV4dElkID0gcG9zID49IHBlZXJzLmxlbmd0aC0xID8gXCJOVUxMXCIgOiBwZWVyc1twb3MrMV07XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsTmV4dCA9IGZpbmREYXRhQ2VsbChkYXRhQ2VsbCxncmlkQ2VsbE5leHRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsQ2hpbGRJZCA9IG9iakRhdGEuY2hpbGRyZW4gJiYgb2JqRGF0YS5jaGlsZHJlbi5sZW5ndGggPiAwID8gb2JqRGF0YS5jaGlsZHJlblswXSA6IFwiTlVMTFwiO1xuICAgICAgICAgICAgICAgICAgICBncmlkQ2VsbENoaWxkID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsQ2hpbGRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRDZWxsUGFyZW50ID0gZmluZERhdGFDZWxsKGRhdGFDZWxsLGdyaWRDZWxsUGFyZW50SWQpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgb3VyIHBhcmVudCBpcyBhbHJlYWR5IGRyYXduLCB0aGVuIHdlIHB1dCB0aGlzIGluIHRoZSByaWdodCBvcmRlciB1bmRlciBvdXIgcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFBhcmVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZENlbGxQYXJlbnQgJiYgZ3JpZENlbGxQYXJlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFByZXYgJiYgZ3JpZENlbGxQcmV2Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRBZnRlcihncmlkQ2VsbFByZXYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ3JpZENlbGxDaGlsZCAmJiBncmlkQ2VsbENoaWxkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChncmlkQ2VsbE5leHQgJiYgZ3JpZENlbGxOZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxOZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEFmdGVyKGdyaWRDZWxsUGFyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWx3YXlzIHB1dCBpdCBpbiB0aGUgaG9sZGluZyBjZWxscywgYW5kIHRoZW4gc29ydCB3aGVuIHRoZSBwYXJlbnQgY29tZXMgaW4sIGluIGNhc2UgcGFyZW50IGlzIChyZSlkcmF3biBsYXRlclxuICAgICAgICAgICAgICAgICAgICAgICAgaGNbZ3JpZENlbGxOYW1lK2ldID0gbGFzdDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChncmlkQ2VsbFByZXYgJiYgZ3JpZENlbGxQcmV2Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Lmluc2VydEFmdGVyKGdyaWRDZWxsUHJldik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRDZWxsQ2hpbGQgJiYgZ3JpZENlbGxDaGlsZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdC5pbnNlcnRCZWZvcmUoZ3JpZENlbGxDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRDZWxsTmV4dCAmJiBncmlkQ2VsbE5leHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuaW5zZXJ0QmVmb3JlKGdyaWRDZWxsTmV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QuYXBwZW5kVG8oZGF0YUNlbGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGRvIHdlIGhhdmUgYW55IGNoaWxkcmVuIHdhaXRpbmcgZm9yIHRoaXMgY2VsbD8gd2FsayBkb3duIHRocm91Z2ggdGhlIGNoaWxkcmVuL2dyYW5kY2hpbGRyZW4vZXRjIHRyZWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0LmFmdGVyKHRoaXMuZ2V0SG9sZGluZ0NlbGxzKG9iakRhdGEsaSxoYykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gbWFrZSB0aGUgaGVpZ2h0IG9mIHRoaXMgbWF0Y2ggdGhlIGxpbmUgaGVpZ2h0IG9mIHRoZSB0cmVlLiBIb3c/XG4gICAgICAgICAgICAgICAgICAgIHNwYW4gPSBsYXN0LmNoaWxkcmVuKFwic3BhblwiKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBzcGFuIGluc2lkZSB0aGUgZGl2LCBzbyB3ZSBjYW4gY29udHJvbCB3aGF0IGhhcHBlbnMgaW4gdGhlIHdob2xlIGRpdiB2ZXJzdXMgaW5zaWRlIGp1c3QgdGhlIHRleHQvYmFja2dyb3VuZFxuICAgICAgICAgICAgICAgICAgICBzcGFuLmFkZENsYXNzKGNsK1wiIFwiK3ZhbENsYXNzKS5odG1sKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICBsYXN0ID0gbGFzdC5jc3MoY29uZikuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jZWxsIGpzdHJlZS1ncmlkLWNlbGwtcm9vdC1cIityb290aWQrXCIganN0cmVlLWdyaWQtY2VsbC1cIitjbGFzc0FkZCtcIiBcIit3Y2wrIFwiIFwiICsgd2lkZVZhbENsYXNzICsgKHRyP1wiIHVpLXN0YXRlLWRlZmF1bHRcIjpcIlwiKSkuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC1jb2wtXCIraSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjbGljayBoYW5kbGVyIGZvciBjbGlja2luZyBpbnNpZGUgYSBncmlkIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5jbGljayhjZWxsQ2xpY2tIYW5kbGVyKHRyZWUsdCx2YWwsY29sLHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5vbihcImNvbnRleHRtZW51XCIsY2VsbFJpZ2h0Q2xpY2tIYW5kbGVyKHRyZWUsdCx2YWwsY29sLHRoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgbGFzdC5ob3Zlcihob3ZlckluSGFuZGxlcih0LCB0aGlzKSwgaG92ZXJPdXRIYW5kbGVyKHQsIHRoaXMpKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uYXR0cihcInRpdGxlXCIsdGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGFzdC5hZGRDbGFzcyhcImpzdHJlZS1ncmlkLWNlbGwtbGFzdFwiKyh0cj9cIiB1aS1zdGF0ZS1kZWZhdWx0XCI6XCJcIikpO1xuICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdpZHRoIGdpdmVuIGZvciB0aGUgbGFzdCBjb2x1bW4sIGRvIGl0IHZpYSBhdXRvbWF0aWNcbiAgICAgICAgICAgICAgICBpZiAoY29sc1tjb2xzLmxlbmd0aC0xXS53aWR0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QuYWRkQ2xhc3MoXCJqc3RyZWUtZ3JpZC13aWR0aC1hdXRvXCIpLm5leHQoXCIuanN0cmVlLWdyaWQtc2VwYXJhdG9yXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3MoeydvdmVyZmxvdy15JzonYXV0byAhaW1wb3J0YW50J30pO1xuICAgICAgICB9O1xuICAgICAgICAvLyBjbGVhbiB1cCBob2xkaW5nIGNlbGxzXG4gICAgICAgIHRoaXMuaG9sZGluZ0NlbGxzID0ge307XG5cbiAgICAgICAgLy8gbmVlZCB0byBkbyBhbHRlcm5hdGluZyBiYWNrZ3JvdW5kIGNvbG9ycyBvciBib3JkZXJzXG4gICAgfTtcbn0pKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY21zL3N0YXRpYy9jbXMvanMvbGlicy9qc3RyZWUvanN0cmVlLmdyaWQubWluLmpzXG4vLyBtb2R1bGUgaWQgPSAxMDhcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ 111:
/***/ (function(module, exports, __webpack_require__) {

eval("// polyfills\n__webpack_require__(18);\n__webpack_require__(19);\n\nvar CMS = __webpack_require__(1).default;\n\nwindow.CMS = CMS;\n\nCMS.PageTree = __webpack_require__(102).default;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTExLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL2FkbWluLnBhZ2V0cmVlLmpzPzhiMWQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcG9seWZpbGxzXG5yZXF1aXJlKCcuL3BvbHlmaWxscy9mdW5jdGlvbi5wcm90b3R5cGUuYmluZC5qcycpO1xucmVxdWlyZSgnLi9saWJzL3BlcCcpO1xuXG52YXIgQ01TID0gcmVxdWlyZSgnLi9tb2R1bGVzL2Ntcy5iYXNlJykuZGVmYXVsdDtcblxud2luZG93LkNNUyA9IENNUztcblxuQ01TLlBhZ2VUcmVlID0gcmVxdWlyZSgnLi9tb2R1bGVzL2Ntcy5wYWdldHJlZScpLmRlZmF1bHQ7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gY21zL3N0YXRpYy9jbXMvanMvYWRtaW4ucGFnZXRyZWUuanMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),

/***/ 112:
/***/ (function(module, exports, __webpack_require__) {

eval("var $ = __webpack_require__(0);\nvar Class = __webpack_require__(4);\n\n/**\n                                 * Dropdowns in the pagetree.\n                                 * Have to be delegated, since pagetree nodes can be\n                                 * lazy loaded.\n                                 *\n                                 * @class PageTreeDropdowns\n                                 * @namespace CMS\n                                 */\nvar PageTreeDropdowns = new Class({\n    options: {\n        dropdownSelector: '.js-cms-pagetree-dropdown',\n        triggerSelector: '.js-cms-pagetree-dropdown-trigger',\n        menuSelector: '.js-cms-pagetree-dropdown-menu',\n        openCls: 'cms-pagetree-dropdown-menu-open' },\n\n\n    initialize: function initialize(options) {\n        this.options = $.extend(true, {}, this.options, options);\n        this.click = 'click.cms.pagetree.dropdown';\n\n        this._setupUI();\n        this._events();\n    },\n\n    /**\n        * @method _setupUI\n        * @private\n        */\n    _setupUI: function _setupUI() {\n        this.ui = {\n            container: this.options.container,\n            document: $(document) };\n\n    },\n\n    /**\n        * Event handlers.\n        *\n        * @method _events\n        * @private\n        */\n    _events: function _events() {\n        var that = this;\n\n        // attach event to the trigger\n        this.ui.container.on(this.click, this.options.triggerSelector, function (e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n\n            that._toggleDropdown(this);\n        });\n\n        // stop propagation on the element\n        this.ui.container.on(this.click, that.options.menuSelector, function (e) {\n            e.stopImmediatePropagation();\n        });\n\n        this.ui.container.on(this.click, that.options.menuSelector + ' a', function () {\n            that.closeAllDropdowns();\n        });\n\n        this.ui.document.on(this.click, function () {\n            that.closeAllDropdowns();\n        });\n    },\n\n    /**\n        * @method _toggleDropdown\n        * @param {jQuery} trigger trigger clicked\n        * @private\n        * @returns {Boolean|void}\n        */\n    _toggleDropdown: function _toggleDropdown(trigger) {\n        var dropdowns = $(this.options.dropdownSelector);\n        var dropdown = $(trigger).closest(this.options.dropdownSelector);\n\n        // cancel if opened tooltip is triggered again\n        if (dropdown.hasClass(this.options.openCls)) {\n            dropdowns.removeClass(this.options.openCls);\n            return false;\n        }\n\n        // otherwise show the dropdown\n        dropdowns.removeClass(this.options.openCls);\n        dropdown.addClass(this.options.openCls);\n\n        this._loadContent(dropdown);\n    },\n\n    /**\n        * @method _loadContent\n        * @private\n        * @param {jQuery} dropdown\n        * @returns {Boolean|$.Deferred} false if not lazy or already loaded or promise\n        */\n    _loadContent: function _loadContent(dropdown) {\n        var data = dropdown.data();\n        var LOADER_SHOW_TIMEOUT = 200;\n\n        if (!data.lazyUrl || data.loaded) {\n            return false;\n        }\n\n        var loaderTimeout = setTimeout(function () {\n            dropdown.find('.js-cms-pagetree-dropdown-loader').addClass('cms-loader');\n        }, LOADER_SHOW_TIMEOUT);\n\n        $.ajax({\n            url: data.lazyUrl,\n            data: data.lazyUrlData }).\n        done(function (response) {\n            dropdown.find('.js-cms-pagetree-dropdown-menu').html(response);\n            dropdown.data('loaded', true);\n            clearTimeout(loaderTimeout);\n        });\n    },\n\n    /**\n        * @method closeAllDropdowns\n        * @public\n        */\n    closeAllDropdowns: function closeAllDropdowns() {\n        $(this.options.dropdownSelector).removeClass(this.options.openCls);\n    } });\n\n\nmodule.exports = PageTreeDropdowns;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEyLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLmRyb3Bkb3duLmpzPzI1ODAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyICQgPSByZXF1aXJlKCdqcXVlcnknKTtcbnZhciBDbGFzcyA9IHJlcXVpcmUoJ2NsYXNzanMnKTtcblxuLyoqXG4gKiBEcm9wZG93bnMgaW4gdGhlIHBhZ2V0cmVlLlxuICogSGF2ZSB0byBiZSBkZWxlZ2F0ZWQsIHNpbmNlIHBhZ2V0cmVlIG5vZGVzIGNhbiBiZVxuICogbGF6eSBsb2FkZWQuXG4gKlxuICogQGNsYXNzIFBhZ2VUcmVlRHJvcGRvd25zXG4gKiBAbmFtZXNwYWNlIENNU1xuICovXG52YXIgUGFnZVRyZWVEcm9wZG93bnMgPSBuZXcgQ2xhc3Moe1xuICAgIG9wdGlvbnM6IHtcbiAgICAgICAgZHJvcGRvd25TZWxlY3RvcjogJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24nLFxuICAgICAgICB0cmlnZ2VyU2VsZWN0b3I6ICcuanMtY21zLXBhZ2V0cmVlLWRyb3Bkb3duLXRyaWdnZXInLFxuICAgICAgICBtZW51U2VsZWN0b3I6ICcuanMtY21zLXBhZ2V0cmVlLWRyb3Bkb3duLW1lbnUnLFxuICAgICAgICBvcGVuQ2xzOiAnY21zLXBhZ2V0cmVlLWRyb3Bkb3duLW1lbnUtb3BlbidcbiAgICB9LFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmNsaWNrID0gJ2NsaWNrLmNtcy5wYWdldHJlZS5kcm9wZG93bic7XG5cbiAgICAgICAgdGhpcy5fc2V0dXBVSSgpO1xuICAgICAgICB0aGlzLl9ldmVudHMoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc2V0dXBVSVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3NldHVwVUk6IGZ1bmN0aW9uIF9zZXR1cFVJKCkge1xuICAgICAgICB0aGlzLnVpID0ge1xuICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLm9wdGlvbnMuY29udGFpbmVyLFxuICAgICAgICAgICAgZG9jdW1lbnQ6ICQoZG9jdW1lbnQpXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEV2ZW50IGhhbmRsZXJzLlxuICAgICAqXG4gICAgICogQG1ldGhvZCBfZXZlbnRzXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZXZlbnRzOiBmdW5jdGlvbiBfZXZlbnRzKCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgLy8gYXR0YWNoIGV2ZW50IHRvIHRoZSB0cmlnZ2VyXG4gICAgICAgIHRoaXMudWkuY29udGFpbmVyLm9uKHRoaXMuY2xpY2ssIHRoaXMub3B0aW9ucy50cmlnZ2VyU2VsZWN0b3IsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICB0aGF0Ll90b2dnbGVEcm9wZG93bih0aGlzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc3RvcCBwcm9wYWdhdGlvbiBvbiB0aGUgZWxlbWVudFxuICAgICAgICB0aGlzLnVpLmNvbnRhaW5lci5vbih0aGlzLmNsaWNrLCB0aGF0Lm9wdGlvbnMubWVudVNlbGVjdG9yLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5jb250YWluZXIub24odGhpcy5jbGljaywgdGhhdC5vcHRpb25zLm1lbnVTZWxlY3RvciArICcgYScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoYXQuY2xvc2VBbGxEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51aS5kb2N1bWVudC5vbih0aGlzLmNsaWNrLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGF0LmNsb3NlQWxsRHJvcGRvd25zKCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF90b2dnbGVEcm9wZG93blxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSB0cmlnZ2VyIHRyaWdnZXIgY2xpY2tlZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge0Jvb2xlYW58dm9pZH1cbiAgICAgKi9cbiAgICBfdG9nZ2xlRHJvcGRvd246IGZ1bmN0aW9uIF90b2dnbGVEcm9wZG93bih0cmlnZ2VyKSB7XG4gICAgICAgIHZhciBkcm9wZG93bnMgPSAkKHRoaXMub3B0aW9ucy5kcm9wZG93blNlbGVjdG9yKTtcbiAgICAgICAgdmFyIGRyb3Bkb3duID0gJCh0cmlnZ2VyKS5jbG9zZXN0KHRoaXMub3B0aW9ucy5kcm9wZG93blNlbGVjdG9yKTtcblxuICAgICAgICAvLyBjYW5jZWwgaWYgb3BlbmVkIHRvb2x0aXAgaXMgdHJpZ2dlcmVkIGFnYWluXG4gICAgICAgIGlmIChkcm9wZG93bi5oYXNDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscykpIHtcbiAgICAgICAgICAgIGRyb3Bkb3ducy5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMub3BlbkNscyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBvdGhlcndpc2Ugc2hvdyB0aGUgZHJvcGRvd25cbiAgICAgICAgZHJvcGRvd25zLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5vcGVuQ2xzKTtcbiAgICAgICAgZHJvcGRvd24uYWRkQ2xhc3ModGhpcy5vcHRpb25zLm9wZW5DbHMpO1xuXG4gICAgICAgIHRoaXMuX2xvYWRDb250ZW50KGRyb3Bkb3duKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfbG9hZENvbnRlbnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBkcm9wZG93blxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufCQuRGVmZXJyZWR9IGZhbHNlIGlmIG5vdCBsYXp5IG9yIGFscmVhZHkgbG9hZGVkIG9yIHByb21pc2VcbiAgICAgKi9cbiAgICBfbG9hZENvbnRlbnQ6IGZ1bmN0aW9uIF9sb2FkQ29udGVudChkcm9wZG93bikge1xuICAgICAgICB2YXIgZGF0YSA9IGRyb3Bkb3duLmRhdGEoKTtcbiAgICAgICAgdmFyIExPQURFUl9TSE9XX1RJTUVPVVQgPSAyMDA7XG5cbiAgICAgICAgaWYgKCFkYXRhLmxhenlVcmwgfHwgZGF0YS5sb2FkZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsb2FkZXJUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5maW5kKCcuanMtY21zLXBhZ2V0cmVlLWRyb3Bkb3duLWxvYWRlcicpLmFkZENsYXNzKCdjbXMtbG9hZGVyJyk7XG4gICAgICAgIH0sIExPQURFUl9TSE9XX1RJTUVPVVQpO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IGRhdGEubGF6eVVybCxcbiAgICAgICAgICAgIGRhdGE6IGRhdGEubGF6eVVybERhdGFcbiAgICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGRyb3Bkb3duLmZpbmQoJy5qcy1jbXMtcGFnZXRyZWUtZHJvcGRvd24tbWVudScpLmh0bWwocmVzcG9uc2UpO1xuICAgICAgICAgICAgZHJvcGRvd24uZGF0YSgnbG9hZGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobG9hZGVyVGltZW91dCk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNsb3NlQWxsRHJvcGRvd25zXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIGNsb3NlQWxsRHJvcGRvd25zOiBmdW5jdGlvbiBjbG9zZUFsbERyb3Bkb3ducygpIHtcbiAgICAgICAgJCh0aGlzLm9wdGlvbnMuZHJvcGRvd25TZWxlY3RvcikucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLm9wZW5DbHMpO1xuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhZ2VUcmVlRHJvcGRvd25zO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGNtcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLmRyb3Bkb3duLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),

/***/ 113:
/***/ (function(module, exports, __webpack_require__) {

eval("/*\n * Copyright https://github.com/divio/django-cms\n */\n\nvar $ = __webpack_require__(0);\nvar Class = __webpack_require__(4);\nvar Helpers = __webpack_require__(1).default.API.Helpers;\n\n/**\n                                                          * Sticky language headers in pagetree\n                                                          *\n                                                          * @class PageTreeStickyHeader\n                                                          * @namespace CMS\n                                                          */\nvar PageTreeStickyHeader = new Class({\n    initialize: function initialize(options) {\n        var that = this;\n\n        that.options = $.extend(true, {}, that.options, options);\n        that.resize = 'resize.cms.pagetree.header';\n        that.scroll = 'scroll.cms.pagetree.header';\n        that.areClonesInDOM = false;\n\n        that._setupUI();\n        that._saveSizes();\n        that._events();\n    },\n\n    /**\n        * @method _setupUI\n        * @private\n        */\n    _setupUI: function _setupUI() {\n        var container = this.options.container;\n        var headers = container.find('.jstree-grid-header');\n\n        this.ui = {\n            container: container,\n            window: $(window),\n            headers: headers,\n            columns: container.find('.jstree-grid-column').toArray().map(function (el) {\n                return $(el);\n            }),\n            clones: headers.clone().toArray().map(function (el) {\n                return $(el);\n            }) };\n\n\n    },\n\n    /**\n        * Determines positions/sizes of elements\n        *\n        * @method _saveSizes\n        * @private\n        */\n    _saveSizes: function _saveSizes() {\n        this.headersTopOffset = this.ui.headers.offset().top;\n        this.toolbarHeight = 0;\n        if (this._isInSideframe()) {\n            this.toolbarHeight = CMS.API.Helpers._getWindow().parent.CMS.$('.cms-toolbar').height();\n            var debug = Helpers._getWindow().parent.CMS.$('.cms-debug-bar');\n\n            if (debug.length) {\n                this.toolbarHeight += debug.outerHeight();\n            }\n        } else {\n            this.toolbarHeight = $('#branding').height();\n        }\n    },\n\n    /**\n        * @method _isInSideframe\n        * @returns {Boolean} are we in sideframe?\n        * @private\n        */\n    _isInSideframe: function _isInSideframe() {\n        var win = Helpers._getWindow();\n\n        if (win && win.parent && win.parent !== win) {\n            return true;\n        }\n\n        return false;\n    },\n\n    /**\n        * Event handlers.\n        *\n        * @method _events\n        * @private\n        */\n    _events: function _events() {\n        this.ui.window.on(\n        [this.resize, this.scroll].join(' '),\n        this._handleResizeOrScroll.bind(this));\n\n    },\n\n    /**\n        * @method _handleResizeOrScroll\n        * @private\n        */\n    _handleResizeOrScroll: function _handleResizeOrScroll() {\n        var that = this;\n        var scrollTop = that.ui.window.scrollTop();\n        var scrollLeft = that.ui.window.scrollLeft();\n\n        if (that._shouldStick(scrollTop)) {\n            that._stickHeader(scrollTop, scrollLeft);\n        } else {\n            that._unstickHeader();\n        }\n    },\n\n    /**\n        * @method _shouldStick\n        * @param {Number} scrollTop position in pixels\n        * @returns {Boolean} should headers stick\n        * @private\n        */\n    _shouldStick: function _shouldStick(scrollTop) {\n        return scrollTop + this.toolbarHeight >= this.headersTopOffset;\n    },\n\n    /**\n        * @method _stickHeader\n        * @param {Number} scrollTop top\n        * @param {Number} scrollLeft left\n        * @private\n        */\n    _stickHeader: function _stickHeader(scrollTop, scrollLeft) {\n        var that = this;\n\n        that._insertClones();\n\n        that.ui.headers.each(function (index) {\n            var el = $(this);\n\n            var width = that.ui.clones[index].css('width');\n            var offset = that.ui.clones[index].offset().left;\n\n            el.css({\n                width: width,\n                left: offset - scrollLeft });\n\n        });\n\n        that.ui.headers.addClass('jstree-grid-header-fixed').css({\n            top: that.toolbarHeight });\n\n    },\n\n    /**\n        * @method _unstickHeader\n        * @private\n        */\n    _unstickHeader: function _unstickHeader() {\n        var that = this;\n\n        that._detachClones();\n\n        that.ui.headers.removeClass('jstree-grid-header-fixed').css({\n            top: 0,\n            width: 'auto',\n            left: 'auto' });\n\n    },\n\n    /**\n        * Inserts clones of headers so when header becomes sticky the\n        * pagetree doesn't jump. Only does it once and sets the flag.\n        *\n        * @method _insertClones\n        * @private\n        */\n    _insertClones: function _insertClones() {\n        var that = this;\n\n        if (!that.areClonesInDOM) {\n            that.ui.columns.forEach(function (el, index) {\n                el.prepend(that.ui.clones[index]);\n            });\n            that.areClonesInDOM = true;\n        }\n\n    },\n\n    /**\n        * Detaches the clones of headers so then headers \"unsticks\"\n        * the pagetree doesn't jump. Relies on the flag.\n        *\n        * @method _detachClones\n        * @private\n        */\n    _detachClones: function _detachClones() {\n        var that = this;\n\n        if (that.areClonesInDOM) {\n            that.ui.clones.forEach(function (el) {\n                el.detach();\n            });\n            that.areClonesInDOM = false;\n        }\n    } });\n\n\n\nmodule.exports = PageTreeStickyHeader;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTEzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2Ntcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLnN0aWNreWhlYWRlci5qcz85YTI3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgaHR0cHM6Ly9naXRodWIuY29tL2RpdmlvL2RqYW5nby1jbXNcbiAqL1xuXG52YXIgJCA9IHJlcXVpcmUoJ2pxdWVyeScpO1xudmFyIENsYXNzID0gcmVxdWlyZSgnY2xhc3NqcycpO1xudmFyIEhlbHBlcnMgPSByZXF1aXJlKCcuL2Ntcy5iYXNlJykuZGVmYXVsdC5BUEkuSGVscGVycztcblxuLyoqXG4gKiBTdGlja3kgbGFuZ3VhZ2UgaGVhZGVycyBpbiBwYWdldHJlZVxuICpcbiAqIEBjbGFzcyBQYWdlVHJlZVN0aWNreUhlYWRlclxuICogQG5hbWVzcGFjZSBDTVNcbiAqL1xudmFyIFBhZ2VUcmVlU3RpY2t5SGVhZGVyID0gbmV3IENsYXNzKHtcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGF0Lm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB0aGF0LnJlc2l6ZSA9ICdyZXNpemUuY21zLnBhZ2V0cmVlLmhlYWRlcic7XG4gICAgICAgIHRoYXQuc2Nyb2xsID0gJ3Njcm9sbC5jbXMucGFnZXRyZWUuaGVhZGVyJztcbiAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IGZhbHNlO1xuXG4gICAgICAgIHRoYXQuX3NldHVwVUkoKTtcbiAgICAgICAgdGhhdC5fc2F2ZVNpemVzKCk7XG4gICAgICAgIHRoYXQuX2V2ZW50cygpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIF9zZXR1cFVJXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0dXBVSTogZnVuY3Rpb24gX3NldHVwVUkoKSB7XG4gICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyO1xuICAgICAgICB2YXIgaGVhZGVycyA9IGNvbnRhaW5lci5maW5kKCcuanN0cmVlLWdyaWQtaGVhZGVyJyk7XG5cbiAgICAgICAgdGhpcy51aSA9IHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICAgICAgd2luZG93OiAkKHdpbmRvdyksXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICAgICAgY29sdW1uczogY29udGFpbmVyLmZpbmQoJy5qc3RyZWUtZ3JpZC1jb2x1bW4nKS50b0FycmF5KCkubWFwKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKGVsKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2xvbmVzOiBoZWFkZXJzLmNsb25lKCkudG9BcnJheSgpLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJChlbCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgcG9zaXRpb25zL3NpemVzIG9mIGVsZW1lbnRzXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIF9zYXZlU2l6ZXNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zYXZlU2l6ZXM6IGZ1bmN0aW9uIF9zYXZlU2l6ZXMoKSB7XG4gICAgICAgIHRoaXMuaGVhZGVyc1RvcE9mZnNldCA9IHRoaXMudWkuaGVhZGVycy5vZmZzZXQoKS50b3A7XG4gICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IDA7XG4gICAgICAgIGlmICh0aGlzLl9pc0luU2lkZWZyYW1lKCkpIHtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCA9IENNUy5BUEkuSGVscGVycy5fZ2V0V2luZG93KCkucGFyZW50LkNNUy4kKCcuY21zLXRvb2xiYXInKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIHZhciBkZWJ1ZyA9IEhlbHBlcnMuX2dldFdpbmRvdygpLnBhcmVudC5DTVMuJCgnLmNtcy1kZWJ1Zy1iYXInKTtcblxuICAgICAgICAgICAgaWYgKGRlYnVnLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG9vbGJhckhlaWdodCArPSBkZWJ1Zy5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b29sYmFySGVpZ2h0ID0gJCgnI2JyYW5kaW5nJykuaGVpZ2h0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfaXNJblNpZGVmcmFtZVxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBhcmUgd2UgaW4gc2lkZWZyYW1lP1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2lzSW5TaWRlZnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHdpbiA9IEhlbHBlcnMuX2dldFdpbmRvdygpO1xuXG4gICAgICAgIGlmICh3aW4gJiYgd2luLnBhcmVudCAmJiB3aW4ucGFyZW50ICE9PSB3aW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFdmVudCBoYW5kbGVycy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2V2ZW50c1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2V2ZW50czogZnVuY3Rpb24gX2V2ZW50cygpIHtcbiAgICAgICAgdGhpcy51aS53aW5kb3cub24oXG4gICAgICAgICAgICBbdGhpcy5yZXNpemUsIHRoaXMuc2Nyb2xsXS5qb2luKCcgJyksXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVSZXNpemVPclNjcm9sbC5iaW5kKHRoaXMpXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2hhbmRsZVJlc2l6ZU9yU2Nyb2xsXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaGFuZGxlUmVzaXplT3JTY3JvbGw6IGZ1bmN0aW9uIF9oYW5kbGVSZXNpemVPclNjcm9sbCgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICB2YXIgc2Nyb2xsVG9wID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsVG9wKCk7XG4gICAgICAgIHZhciBzY3JvbGxMZWZ0ID0gdGhhdC51aS53aW5kb3cuc2Nyb2xsTGVmdCgpO1xuXG4gICAgICAgIGlmICh0aGF0Ll9zaG91bGRTdGljayhzY3JvbGxUb3ApKSB7XG4gICAgICAgICAgICB0aGF0Ll9zdGlja0hlYWRlcihzY3JvbGxUb3AsIHNjcm9sbExlZnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhhdC5fdW5zdGlja0hlYWRlcigpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Nob3VsZFN0aWNrXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcCBwb3NpdGlvbiBpbiBwaXhlbHNcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gc2hvdWxkIGhlYWRlcnMgc3RpY2tcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zaG91bGRTdGljazogZnVuY3Rpb24gKHNjcm9sbFRvcCkge1xuICAgICAgICByZXR1cm4gc2Nyb2xsVG9wICsgdGhpcy50b29sYmFySGVpZ2h0ID49IHRoaXMuaGVhZGVyc1RvcE9mZnNldDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBfc3RpY2tIZWFkZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2Nyb2xsVG9wIHRvcFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzY3JvbGxMZWZ0IGxlZnRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zdGlja0hlYWRlcjogZnVuY3Rpb24gX3N0aWNrSGVhZGVyKHNjcm9sbFRvcCwgc2Nyb2xsTGVmdCkge1xuICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgdGhhdC5faW5zZXJ0Q2xvbmVzKCk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICB2YXIgd2lkdGggPSB0aGF0LnVpLmNsb25lc1tpbmRleF0uY3NzKCd3aWR0aCcpO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoYXQudWkuY2xvbmVzW2luZGV4XS5vZmZzZXQoKS5sZWZ0O1xuXG4gICAgICAgICAgICBlbC5jc3Moe1xuICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBvZmZzZXQgLSBzY3JvbGxMZWZ0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhhdC51aS5oZWFkZXJzLmFkZENsYXNzKCdqc3RyZWUtZ3JpZC1oZWFkZXItZml4ZWQnKS5jc3Moe1xuICAgICAgICAgICAgdG9wOiB0aGF0LnRvb2xiYXJIZWlnaHRcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX3Vuc3RpY2tIZWFkZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91bnN0aWNrSGVhZGVyOiBmdW5jdGlvbiBfdW5zdGlja0hlYWRlcigpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIHRoYXQuX2RldGFjaENsb25lcygpO1xuXG4gICAgICAgIHRoYXQudWkuaGVhZGVycy5yZW1vdmVDbGFzcygnanN0cmVlLWdyaWQtaGVhZGVyLWZpeGVkJykuY3NzKHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsXG4gICAgICAgICAgICBsZWZ0OiAnYXV0bydcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluc2VydHMgY2xvbmVzIG9mIGhlYWRlcnMgc28gd2hlbiBoZWFkZXIgYmVjb21lcyBzdGlja3kgdGhlXG4gICAgICogcGFnZXRyZWUgZG9lc24ndCBqdW1wLiBPbmx5IGRvZXMgaXQgb25jZSBhbmQgc2V0cyB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2luc2VydENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luc2VydENsb25lczogZnVuY3Rpb24gX2luc2VydENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICghdGhhdC5hcmVDbG9uZXNJbkRPTSkge1xuICAgICAgICAgICAgdGhhdC51aS5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGVsLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIGVsLnByZXBlbmQodGhhdC51aS5jbG9uZXNbaW5kZXhdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhhdC5hcmVDbG9uZXNJbkRPTSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXRhY2hlcyB0aGUgY2xvbmVzIG9mIGhlYWRlcnMgc28gdGhlbiBoZWFkZXJzIFwidW5zdGlja3NcIlxuICAgICAqIHRoZSBwYWdldHJlZSBkb2Vzbid0IGp1bXAuIFJlbGllcyBvbiB0aGUgZmxhZy5cbiAgICAgKlxuICAgICAqIEBtZXRob2QgX2RldGFjaENsb25lc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2RldGFjaENsb25lczogZnVuY3Rpb24gX2RldGFjaENsb25lcygpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGlmICh0aGF0LmFyZUNsb25lc0luRE9NKSB7XG4gICAgICAgICAgICB0aGF0LnVpLmNsb25lcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgICAgIGVsLmRldGFjaCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGF0LmFyZUNsb25lc0luRE9NID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBhZ2VUcmVlU3RpY2t5SGVhZGVyO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGNtcy9zdGF0aWMvY21zL2pzL21vZHVsZXMvY21zLnBhZ2V0cmVlLnN0aWNreWhlYWRlci5qcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }),

/***/ 86:
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!\n * THIS FILE HAS BEEN MANUALLY PATCHED TO ALLOW COPYING INTO SELF/CHILDREN\n * https://github.com/FinalAngel/jstree\n */\n/*! jsTree - v3.3.0 - 2016-04-25 - (MIT) */\n!function(a){\"use strict\"; true?!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0)], __WEBPACK_AMD_DEFINE_FACTORY__ = (a),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)):\"undefined\"!=typeof module&&module.exports?module.exports=a(require(\"jquery\")):a(jQuery)}(function(a,b){\"use strict\";if(!a.jstree){var c=0,d=!1,e=!1,f=!1,g=[],h=a(\"script:last\").attr(\"src\"),i=window.document,j=i.createElement(\"LI\"),k,l;j.setAttribute(\"role\",\"treeitem\"),k=i.createElement(\"I\"),k.className=\"jstree-icon jstree-ocl\",k.setAttribute(\"role\",\"presentation\"),j.appendChild(k),k=i.createElement(\"A\"),k.className=\"jstree-anchor\",k.setAttribute(\"href\",\"#\"),k.setAttribute(\"tabindex\",\"-1\"),l=i.createElement(\"I\"),l.className=\"jstree-icon jstree-themeicon\",l.setAttribute(\"role\",\"presentation\"),k.appendChild(l),j.appendChild(k),k=l=null,a.jstree={version:\"{{VERSION}}\",defaults:{plugins:[]},plugins:{},path:h&&-1!==h.indexOf(\"/\")?h.replace(/\\/[^\\/]+$/,\"\"):\"\",idregex:/[\\\\:&!^|()\\[\\]<>@*'+~#\";.,=\\- \\/${}%?`]/g,root:\"#\"},a.jstree.create=function(b,d){var e=new a.jstree.core(++c),f=d;return d=a.extend(!0,{},a.jstree.defaults,d),f&&f.plugins&&(d.plugins=f.plugins),a.each(d.plugins,function(a,b){\"core\"!==a&&(e=e.plugin(b,d[b]))}),a(b).data(\"jstree\",e),e.init(b,d),e},a.jstree.destroy=function(){a(\".jstree:jstree\").jstree(\"destroy\"),a(i).off(\".jstree\")},a.jstree.core=function(a){this._id=a,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},a.jstree.reference=function(b){var c=null,d=null;if(!b||!b.id||b.tagName&&b.nodeType||(b=b.id),!d||!d.length)try{d=a(b)}catch(e){}if(!d||!d.length)try{d=a(\"#\"+b.replace(a.jstree.idregex,\"\\\\$&\"))}catch(e){}return d&&d.length&&(d=d.closest(\".jstree\")).length&&(d=d.data(\"jstree\"))?c=d:a(\".jstree\").each(function(){var d=a(this).data(\"jstree\");return d&&d._model.data[b]?(c=d,!1):void 0}),c},a.fn.jstree=function(c){var d=\"string\"==typeof c,e=Array.prototype.slice.call(arguments,1),f=null;return c!==!0||this.length?(this.each(function(){var g=a.jstree.reference(this),h=d&&g?g[c]:null;return f=d&&h?h.apply(g,e):null,g||d||c!==b&&!a.isPlainObject(c)||a.jstree.create(this,c),(g&&!d||c===!0)&&(f=g||!1),null!==f&&f!==b?!1:void 0}),null!==f&&f!==b?f:this):!1},a.expr[\":\"].jstree=a.expr.createPseudo(function(c){return function(c){return a(c).hasClass(\"jstree\")&&a(c).data(\"jstree\")!==b}}),a.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:a.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},a.jstree.core.prototype={plugin:function(b,c){var d=a.jstree.plugins[b];return d?(this._data[b]={},d.prototype=this,new d(c,this)):this},init:function(b,c){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=a(b).addClass(\"jstree jstree-\"+this._id),this.settings=c,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl=\"rtl\"===this.element.css(\"direction\"),this.element[this._data.core.rtl?\"addClass\":\"removeClass\"](\"jstree-rtl\"),this.element.attr(\"role\",\"tree\"),this.settings.core.multiple&&this.element.attr(\"aria-multiselectable\",!0),this.element.attr(\"tabindex\")||this.element.attr(\"tabindex\",\"0\"),this.bind(),this.trigger(\"init\"),this._data.core.original_container_html=this.element.find(\" > ul > li\").clone(!0),this._data.core.original_container_html.find(\"li\").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\\s+$/.test(this.nodeValue))}).remove(),this.element.html(\"<ul class='jstree-container-ul jstree-children' role='group'><li id='j\"+this._id+\"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>\"+this.get_string(\"Loading ...\")+\"</a></li></ul>\"),this.element.attr(\"aria-activedescendant\",\"j\"+this._id+\"_loading\"),this._data.core.li_height=this.get_container_ul().children(\"li\").first().height()||24,this.trigger(\"loading\"),this.load_node(a.jstree.root)},destroy:function(a){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass(\"jstree\").removeData(\"jstree\").find(\"[class^='jstree']\").addBack().attr(\"class\",function(){return this.className.replace(/jstree[^ ]*|$/gi,\"\")}),this.element=null},bind:function(){var b=\"\",c=null,d=0;this.element.on(\"dblclick.jstree\",function(a){if(a.target.tagName&&\"input\"===a.target.tagName.toLowerCase())return!0;if(i.selection&&i.selection.empty)i.selection.empty();else if(window.getSelection){var b=window.getSelection();try{b.removeAllRanges(),b.collapse()}catch(c){}}}).on(\"mousedown.jstree\",a.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),d=+new Date)},this)).on(\"mousedown.jstree\",\".jstree-ocl\",function(a){a.preventDefault()}).on(\"click.jstree\",\".jstree-ocl\",a.proxy(function(a){this.toggle_node(a.target)},this)).on(\"dblclick.jstree\",\".jstree-anchor\",a.proxy(function(a){return a.target.tagName&&\"input\"===a.target.tagName.toLowerCase()?!0:void(this.settings.core.dblclick_toggle&&this.toggle_node(a.target))},this)).on(\"click.jstree\",\".jstree-anchor\",a.proxy(function(b){b.preventDefault(),b.currentTarget!==i.activeElement&&a(b.currentTarget).focus(),this.activate_node(b.currentTarget,b)},this)).on(\"keydown.jstree\",\".jstree-anchor\",a.proxy(function(b){if(b.target.tagName&&\"input\"===b.target.tagName.toLowerCase())return!0;if(32!==b.which&&13!==b.which&&(b.shiftKey||b.ctrlKey||b.altKey||b.metaKey))return!0;var c=null;switch(this._data.core.rtl&&(37===b.which?b.which=39:39===b.which&&(b.which=37)),b.which){case 32:b.ctrlKey&&(b.type=\"click\",a(b.currentTarget).trigger(b));break;case 13:b.type=\"click\",a(b.currentTarget).trigger(b);break;case 37:b.preventDefault(),this.is_open(b.currentTarget)?this.close_node(b.currentTarget):(c=this.get_parent(b.currentTarget),c&&c.id!==a.jstree.root&&this.get_node(c,!0).children(\".jstree-anchor\").focus());break;case 38:b.preventDefault(),c=this.get_prev_dom(b.currentTarget),c&&c.length&&c.children(\".jstree-anchor\").focus();break;case 39:b.preventDefault(),this.is_closed(b.currentTarget)?this.open_node(b.currentTarget,function(a){this.get_node(a,!0).children(\".jstree-anchor\").focus()}):this.is_open(b.currentTarget)&&(c=this.get_node(b.currentTarget,!0).children(\".jstree-children\")[0],c&&a(this._firstChild(c)).children(\".jstree-anchor\").focus());break;case 40:b.preventDefault(),c=this.get_next_dom(b.currentTarget),c&&c.length&&c.children(\".jstree-anchor\").focus();break;case 106:this.open_all();break;case 36:b.preventDefault(),c=this._firstChild(this.get_container_ul()[0]),c&&a(c).children(\".jstree-anchor\").filter(\":visible\").focus();break;case 35:b.preventDefault(),this.element.find(\".jstree-anchor\").filter(\":visible\").last().focus();break;case 113:b.preventDefault(),this.edit(b.currentTarget)}},this)).on(\"load_node.jstree\",a.proxy(function(b,c){c.status&&(c.node.id!==a.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr(\"aria-activedescendant\",this._firstChild(this.get_container_ul()[0]).id),this.trigger(\"loaded\")),this._data.core.ready||setTimeout(a.proxy(function(){if(this.element&&!this.get_container_ul().find(\".jstree-loading\").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var b=[],c,d;for(c=0,d=this._data.core.selected.length;d>c;c++)b=b.concat(this._model.data[this._data.core.selected[c]].parents);for(b=a.vakata.array_unique(b),c=0,d=b.length;d>c;c++)this.open_node(b[c],!1,0)}this.trigger(\"changed\",{action:\"ready\",selected:this._data.core.selected})}this.trigger(\"ready\")}},this),0))},this)).on(\"keypress.jstree\",a.proxy(function(d){if(d.target.tagName&&\"input\"===d.target.tagName.toLowerCase())return!0;c&&clearTimeout(c),c=setTimeout(function(){b=\"\"},500);var e=String.fromCharCode(d.which).toLowerCase(),f=this.element.find(\".jstree-anchor\").filter(\":visible\"),g=f.index(i.activeElement)||0,h=!1;if(b+=e,b.length>1){if(f.slice(g).each(a.proxy(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g).each(a.proxy(function(c,d){return 0===a(d).text().toLowerCase().indexOf(b)?(a(d).focus(),h=!0,!1):void 0},this)),h)return}if(new RegExp(\"^\"+e.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g,\"\\\\$&\")+\"+$\").test(b)){if(f.slice(g+1).each(a.proxy(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).focus(),h=!0,!1):void 0},this)),h)return;if(f.slice(0,g+1).each(a.proxy(function(b,c){return a(c).text().toLowerCase().charAt(0)===e?(a(c).focus(),h=!0,!1):void 0},this)),h)return}},this)).on(\"init.jstree\",a.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots,this._data.core.themes.stripes=a.stripes,this._data.core.themes.icons=a.icons,this.set_theme(a.name||\"default\",a.url),this.set_theme_variant(a.variant)},this)).on(\"loading.jstree\",a.proxy(function(){this[this._data.core.themes.dots?\"show_dots\":\"hide_dots\"](),this[this._data.core.themes.icons?\"show_icons\":\"hide_icons\"](),this[this._data.core.themes.stripes?\"show_stripes\":\"hide_stripes\"]()},this)).on(\"blur.jstree\",\".jstree-anchor\",a.proxy(function(b){this._data.core.focused=null,a(b.currentTarget).filter(\".jstree-hovered\").mouseleave(),this.element.attr(\"tabindex\",\"0\")},this)).on(\"focus.jstree\",\".jstree-anchor\",a.proxy(function(b){var c=this.get_node(b.currentTarget);c&&c.id&&(this._data.core.focused=c.id),this.element.find(\".jstree-hovered\").not(b.currentTarget).mouseleave(),a(b.currentTarget).mouseenter(),this.element.attr(\"tabindex\",\"-1\")},this)).on(\"focus.jstree\",a.proxy(function(){if(+new Date-d>500&&!this._data.core.focused){d=0;var a=this.get_node(this.element.attr(\"aria-activedescendant\"),!0);a&&a.find(\"> .jstree-anchor\").focus()}},this)).on(\"mouseenter.jstree\",\".jstree-anchor\",a.proxy(function(a){this.hover_node(a.currentTarget)},this)).on(\"mouseleave.jstree\",\".jstree-anchor\",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(\".jstree\"),a(i).off(\".jstree-\"+this._id)},trigger:function(a,b){b||(b={}),b.instance=this,this.element.triggerHandler(a.replace(\".jstree\",\"\")+\".jstree\",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(\".jstree-children\").first()},get_string:function(b){var c=this.settings.core.strings;return a.isFunction(c)?c.call(this,b):c&&c[b]?c[b]:b},_firstChild:function(a){a=a?a.firstChild:null;while(null!==a&&1!==a.nodeType)a=a.nextSibling;return a},_nextSibling:function(a){a=a?a.nextSibling:null;while(null!==a&&1!==a.nodeType)a=a.nextSibling;return a},_previousSibling:function(a){a=a?a.previousSibling:null;while(null!==a&&1!==a.nodeType)a=a.previousSibling;return a},get_node:function(b,c){b&&b.id&&(b=b.id);var d;try{if(this._model.data[b])b=this._model.data[b];else if(\"string\"==typeof b&&this._model.data[b.replace(/^#/,\"\")])b=this._model.data[b.replace(/^#/,\"\")];else if(\"string\"==typeof b&&(d=a(\"#\"+b.replace(a.jstree.idregex,\"\\\\$&\"),this.element)).length&&this._model.data[d.closest(\".jstree-node\").attr(\"id\")])b=this._model.data[d.closest(\".jstree-node\").attr(\"id\")];else if((d=a(b,this.element)).length&&this._model.data[d.closest(\".jstree-node\").attr(\"id\")])b=this._model.data[d.closest(\".jstree-node\").attr(\"id\")];else{if(!(d=a(b,this.element)).length||!d.hasClass(\"jstree\"))return!1;b=this._model.data[a.jstree.root]}return c&&(b=b.id===a.jstree.root?this.element:a(\"#\"+b.id.replace(a.jstree.idregex,\"\\\\$&\"),this.element)),b}catch(e){return!1}},get_path:function(b,c,d){if(b=b.parents?b:this.get_node(b),!b||b.id===a.jstree.root||!b.parents)return!1;var e,f,g=[];for(g.push(d?b.id:b.text),e=0,f=b.parents.length;f>e;e++)g.push(d?b.parents[e]:this.get_text(b.parents[e]));return g=g.reverse().slice(1),c?g.join(c):g},get_next_dom:function(b,c){var d;if(b=this.get_node(b,!0),b[0]===this.element[0]){d=this._firstChild(this.get_container_ul()[0]);while(d&&0===d.offsetHeight)d=this._nextSibling(d);return d?a(d):!1}if(!b||!b.length)return!1;if(c){d=b[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return d?a(d):!1}if(b.hasClass(\"jstree-open\")){d=this._firstChild(b.children(\".jstree-children\")[0]);while(d&&0===d.offsetHeight)d=this._nextSibling(d);if(null!==d)return a(d)}d=b[0];do d=this._nextSibling(d);while(d&&0===d.offsetHeight);return null!==d?a(d):b.parentsUntil(\".jstree\",\".jstree-node\").nextAll(\".jstree-node:visible\").first()},get_prev_dom:function(b,c){var d;if(b=this.get_node(b,!0),b[0]===this.element[0]){d=this.get_container_ul()[0].lastChild;while(d&&0===d.offsetHeight)d=this._previousSibling(d);return d?a(d):!1}if(!b||!b.length)return!1;if(c){d=b[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);return d?a(d):!1}d=b[0];do d=this._previousSibling(d);while(d&&0===d.offsetHeight);if(null!==d){b=a(d);while(b.hasClass(\"jstree-open\"))b=b.children(\".jstree-children\").first().children(\".jstree-node:visible:last\");return b}return d=b[0].parentNode.parentNode,d&&d.className&&-1!==d.className.indexOf(\"jstree-node\")?a(d):!1},get_parent:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.parent:!1},get_children_dom:function(a){return a=this.get_node(a,!0),a[0]===this.element[0]?this.get_container_ul().children(\".jstree-node\"):a&&a.length?a.children(\".jstree-children\").children(\".jstree-node\"):!1},is_parent:function(a){return a=this.get_node(a),a&&(a.state.loaded===!1||a.children.length>0)},is_loaded:function(a){return a=this.get_node(a),a&&a.state.loaded},is_loading:function(a){return a=this.get_node(a),a&&a.state&&a.state.loading},is_open:function(a){return a=this.get_node(a),a&&a.state.opened},is_closed:function(a){return a=this.get_node(a),a&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(b,c){var d,e,f,g,h;if(a.isArray(b))return this._load_nodes(b.slice(),c),!0;if(b=this.get_node(b),!b)return c&&c.call(this,b,!1),!1;if(b.state.loaded){for(b.state.loaded=!1,f=0,g=b.parents.length;g>f;f++)this._model.data[b.parents[f]].children_d=a.vakata.array_filter(this._model.data[b.parents[f]].children_d,function(c){return-1===a.inArray(c,b.children_d)});for(d=0,e=b.children_d.length;e>d;d++)this._model.data[b.children_d[d]].state.selected&&(h=!0),delete this._model.data[b.children_d[d]];h&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(c){return-1===a.inArray(c,b.children_d)})),b.children=[],b.children_d=[],h&&this.trigger(\"changed\",{action:\"load_node\",node:b,selected:this._data.core.selected})}return b.state.failed=!1,b.state.loading=!0,this.get_node(b,!0).addClass(\"jstree-loading\").attr(\"aria-busy\",!0),this._load_node(b,a.proxy(function(a){b=this._model.data[b.id],b.state.loading=!1,b.state.loaded=a,b.state.failed=!b.state.loaded;var d=this.get_node(b,!0),e=0,f=0,g=this._model.data,h=!1;for(e=0,f=b.children.length;f>e;e++)if(g[b.children[e]]&&!g[b.children[e]].state.hidden){h=!0;break}b.state.loaded&&d&&d.length&&(d.removeClass(\"jstree-closed jstree-open jstree-leaf\"),h?\"#\"!==b.id&&d.addClass(b.state.opened?\"jstree-open\":\"jstree-closed\"):d.addClass(\"jstree-leaf\")),d.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1),this.trigger(\"load_node\",{node:b,status:a}),c&&c.call(this,b,a)},this)),!0},_load_nodes:function(a,b,c,d){var e=!0,f=function(){this._load_nodes(a,b,!0)},g=this._model.data,h,i,j=[];for(h=0,i=a.length;i>h;h++)g[a[h]]&&(!g[a[h]].state.loaded&&!g[a[h]].state.failed||!c&&d)&&(this.is_loading(a[h])||this.load_node(a[h],f),e=!1);if(e){for(h=0,i=a.length;i>h;h++)g[a[h]]&&g[a[h]].state.loaded&&j.push(a[h]);b&&!b.done&&(b.call(this,j),b.done=!0)}},load_all:function(b,c){if(b||(b=a.jstree.root),b=this.get_node(b),!b)return!1;var d=[],e=this._model.data,f=e[b.id].children_d,g,h;for(b.state&&!b.state.loaded&&d.push(b.id),g=0,h=f.length;h>g;g++)e[f[g]]&&e[f[g]].state&&!e[f[g]].state.loaded&&d.push(f[g]);d.length?this._load_nodes(d,function(){this.load_all(b,c)}):(c&&c.call(this,b),this.trigger(\"load_all\",{node:b}))},_load_node:function(b,c){var d=this.settings.core.data,e;return d?a.isFunction(d)?d.call(this,b,a.proxy(function(d){d===!1?c.call(this,!1):this[\"string\"==typeof d?\"_append_html_data\":\"_append_json_data\"](b,\"string\"==typeof d?a(a.parseHTML(d)).filter(function(){return 3!==this.nodeType}):d,function(a){c.call(this,a)})},this)):\"object\"==typeof d?d.url?(d=a.extend(!0,{},d),a.isFunction(d.url)&&(d.url=d.url.call(this,b)),a.isFunction(d.data)&&(d.data=d.data.call(this,b)),a.ajax(d).done(a.proxy(function(d,e,f){var g=f.getResponseHeader(\"Content-Type\");return g&&-1!==g.indexOf(\"json\")||\"object\"==typeof d?this._append_json_data(b,d,function(a){c.call(this,a)}):g&&-1!==g.indexOf(\"html\")||\"string\"==typeof d?this._append_html_data(b,a(a.parseHTML(d)).filter(function(){return 3!==this.nodeType}),function(a){c.call(this,a)}):(this._data.core.last_error={error:\"ajax\",plugin:\"core\",id:\"core_04\",reason:\"Could not load node\",data:JSON.stringify({id:b.id,xhr:f})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))},this)).fail(a.proxy(function(a){c.call(this,!1),this._data.core.last_error={error:\"ajax\",plugin:\"core\",id:\"core_04\",reason:\"Could not load node\",data:JSON.stringify({id:b.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(e=a.isArray(d)||a.isPlainObject(d)?JSON.parse(JSON.stringify(d)):d,b.id===a.jstree.root?this._append_json_data(b,e,function(a){c.call(this,a)}):(this._data.core.last_error={error:\"nodata\",plugin:\"core\",id:\"core_05\",reason:\"Could not load node\",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1))):\"string\"==typeof d?b.id===a.jstree.root?this._append_html_data(b,a(a.parseHTML(d)).filter(function(){return 3!==this.nodeType}),function(a){c.call(this,a)}):(this._data.core.last_error={error:\"nodata\",plugin:\"core\",id:\"core_06\",reason:\"Could not load node\",data:JSON.stringify({id:b.id})},this.settings.core.error.call(this,this._data.core.last_error),c.call(this,!1)):c.call(this,!1):b.id===a.jstree.root?this._append_html_data(b,this._data.core.original_container_html.clone(!0),function(a){c.call(this,a)}):c.call(this,!1)},_node_changed:function(a){a=this.get_node(a),a&&this._model.changed.push(a.id)},_append_html_data:function(b,c,d){b=this.get_node(b),b.children=[],b.children_d=[];var e=c.is(\"ul\")?c.children():c,f=b.id,g=[],h=[],i=this._model.data,j=i[f],k=this._data.core.selected.length,l,m,n;for(e.each(a.proxy(function(b,c){l=this._parse_model_from_html(a(c),f,j.parents.concat()),l&&(g.push(l),h.push(l),i[l].children_d.length&&(h=h.concat(i[l].children_d)))},this)),j.children=g,j.children_d=h,m=0,n=j.parents.length;n>m;m++)i[j.parents[m]].children_d=i[j.parents[m]].children_d.concat(h);this.trigger(\"model\",{nodes:h,parent:f}),f!==a.jstree.root?(this._node_changed(f),this.redraw()):(this.get_container_ul().children(\".jstree-initial-node\").remove(),this.redraw(!0)),this._data.core.selected.length!==k&&this.trigger(\"changed\",{action:\"model\",selected:this._data.core.selected}),d.call(this,!0)},_append_json_data:function(b,c,d,e){if(null!==this.element){b=this.get_node(b),b.children=[],b.children_d=[],c.d&&(c=c.d,\"string\"==typeof c&&(c=JSON.parse(c))),a.isArray(c)||(c=[c]);var f=null,g={df:this._model.default_state,dat:c,par:b.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},h=function(a,b){a.data&&(a=a.data);var c=a.dat,d=a.par,e=[],f=[],g=[],h=a.df,i=a.t_id,j=a.t_cnt,k=a.m,l=k[d],m=a.sel,n,o,p,q,r=function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=a.id.toString(),f,i,j,l,m={id:e,text:a.text||\"\",icon:a.icon!==b?a.icon:!0,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(f in h)h.hasOwnProperty(f)&&(m.state[f]=h[f]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(m.icon=a.data.jstree.icon),m.icon!==b&&null!==m.icon&&\"\"!==m.icon||(m.icon=!0),a&&a.data&&(m.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(m.state[f]=a.data.jstree[f]);if(a&&\"object\"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(m.state[f]=a.state[f]);if(a&&\"object\"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(m.li_attr[f]=a.li_attr[f]);if(m.li_attr.id||(m.li_attr.id=e),a&&\"object\"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(m.a_attr[f]=a.a_attr[f]);for(a&&a.children&&a.children===!0&&(m.state.loaded=!1,m.children=[],m.children_d=[]),k[m.id]=m,f=0,i=m.children.length;i>f;f++)j=r(k[m.children[f]],m.id,d),l=k[j],m.children_d.push(j),l.children_d.length&&(m.children_d=m.children_d.concat(l.children_d));return delete a.data,delete a.children,k[m.id].original=a,m.state.selected&&g.push(m.id),m.id},s=function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=!1,f,l,m,n,o;do e=\"j\"+i+\"_\"+ ++j;while(k[e]);o={id:!1,text:\"string\"==typeof a?a:\"\",icon:\"object\"==typeof a&&a.icon!==b?a.icon:!0,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(f in h)h.hasOwnProperty(f)&&(o.state[f]=h[f]);if(a&&a.id&&(o.id=a.id.toString()),a&&a.text&&(o.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(o.icon=a.data.jstree.icon),o.icon!==b&&null!==o.icon&&\"\"!==o.icon||(o.icon=!0),a&&a.data&&(o.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(o.state[f]=a.data.jstree[f]);if(a&&\"object\"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(o.state[f]=a.state[f]);if(a&&\"object\"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(o.li_attr[f]=a.li_attr[f]);if(o.li_attr.id&&!o.id&&(o.id=o.li_attr.id.toString()),o.id||(o.id=e),o.li_attr.id||(o.li_attr.id=o.id),a&&\"object\"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(o.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,l=a.children.length;l>f;f++)m=s(a.children[f],o.id,d),n=k[m],o.children.push(m),n.children_d.length&&(o.children_d=o.children_d.concat(n.children_d));o.children_d=o.children_d.concat(o.children)}return a&&a.children&&a.children===!0&&(o.state.loaded=!1,o.children=[],o.children_d=[]),delete a.data,delete a.children,o.original=a,k[o.id]=o,o.state.selected&&g.push(o.id),o.id};if(c.length&&c[0].id!==b&&c[0].parent!==b){for(o=0,p=c.length;p>o;o++)c[o].children||(c[o].children=[]),k[c[o].id.toString()]=c[o];for(o=0,p=c.length;p>o;o++)k[c[o].parent.toString()].children.push(c[o].id.toString()),l.children_d.push(c[o].id.toString());for(o=0,p=l.children.length;p>o;o++)n=r(k[l.children[o]],d,l.parents.concat()),f.push(n),k[n].children_d.length&&(f=f.concat(k[n].children_d));for(o=0,p=l.parents.length;p>o;o++)k[l.parents[o]].children_d=k[l.parents[o]].children_d.concat(f);q={cnt:j,mod:k,sel:m,par:d,dpc:f,add:g}}else{for(o=0,p=c.length;p>o;o++)n=s(c[o],d,l.parents.concat()),n&&(e.push(n),f.push(n),k[n].children_d.length&&(f=f.concat(k[n].children_d)));for(l.children=e,l.children_d=f,o=0,p=l.parents.length;p>o;o++)k[l.parents[o]].children_d=k[l.parents[o]].children_d.concat(f);q={cnt:j,mod:k,sel:m,par:d,dpc:f,add:g}}return\"undefined\"!=typeof window&&\"undefined\"!=typeof window.document?q:void postMessage(q)},i=function(b,c){if(null!==this.element){this._cnt=b.cnt;var e,f=this._model.data;for(e in f)f.hasOwnProperty(e)&&f[e].state&&f[e].state.loading&&b.mod[e]&&(b.mod[e].state.loading=!0);if(this._model.data=b.mod,c){var g,h=b.add,i=b.sel,j=this._data.core.selected.slice();if(f=this._model.data,i.length!==j.length||a.vakata.array_unique(i.concat(j)).length!==i.length){for(e=0,g=i.length;g>e;e++)-1===a.inArray(i[e],h)&&-1===a.inArray(i[e],j)&&(f[i[e]].state.selected=!1);for(e=0,g=j.length;g>e;e++)-1===a.inArray(j[e],i)&&(f[j[e]].state.selected=!0)}}b.add.length&&(this._data.core.selected=this._data.core.selected.concat(b.add)),this.trigger(\"model\",{nodes:b.dpc,parent:b.par}),b.par!==a.jstree.root?(this._node_changed(b.par),this.redraw()):this.redraw(!0),b.add.length&&this.trigger(\"changed\",{action:\"model\",selected:this._data.core.selected}),d.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob([\"self.onmessage = \"+h.toString()],{type:\"text/javascript\"}))),!this._data.core.working||e?(this._data.core.working=!0,f=new window.Worker(this._wrk),f.onmessage=a.proxy(function(a){i.call(this,a.data,!0);try{f.terminate(),f=null}catch(b){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),g.par?f.postMessage(g):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([b,c,d,!0])}catch(j){i.call(this,h(g),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else i.call(this,h(g),!1)}},_parse_model_from_html:function(c,d,e){e=e?[].concat(e):[],d&&e.unshift(d);var f,g,h=this._model.data,i={id:!1,text:!1,icon:!0,parent:d,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1},j,k,l;for(j in this._model.default_state)this._model.default_state.hasOwnProperty(j)&&(i.state[j]=this._model.default_state[j]);if(k=a.vakata.attributes(c,!0),a.each(k,function(b,c){return c=a.trim(c),c.length?(i.li_attr[b]=c,void(\"id\"===b&&(i.id=c.toString()))):!0}),k=c.children(\"a\").first(),k.length&&(k=a.vakata.attributes(k,!0),a.each(k,function(b,c){c=a.trim(c),c.length&&(i.a_attr[b]=c)})),k=c.children(\"a\").first().length?c.children(\"a\").first().clone():c.clone(),k.children(\"ins, i, ul\").remove(),k=k.html(),k=a(\"<div />\").html(k),i.text=this.settings.core.force_text?k.text():k.html(),k=c.data(),i.data=k?a.extend(!0,{},k):null,i.state.opened=c.hasClass(\"jstree-open\"),i.state.selected=c.children(\"a\").hasClass(\"jstree-clicked\"),i.state.disabled=c.children(\"a\").hasClass(\"jstree-disabled\"),i.data&&i.data.jstree)for(j in i.data.jstree)i.data.jstree.hasOwnProperty(j)&&(i.state[j]=i.data.jstree[j]);k=c.children(\"a\").children(\".jstree-themeicon\"),k.length&&(i.icon=k.hasClass(\"jstree-themeicon-hidden\")?!1:k.attr(\"rel\")),i.state.icon!==b&&(i.icon=i.state.icon),i.icon!==b&&null!==i.icon&&\"\"!==i.icon||(i.icon=!0),k=c.children(\"ul\").children(\"li\");do l=\"j\"+this._id+\"_\"+ ++this._cnt;while(h[l]);return i.id=i.li_attr.id?i.li_attr.id.toString():l,k.length?(k.each(a.proxy(function(b,c){f=this._parse_model_from_html(a(c),i.id,e),g=this._model.data[f],i.children.push(f),g.children_d.length&&(i.children_d=i.children_d.concat(g.children_d))},this)),i.children_d=i.children_d.concat(i.children)):c.hasClass(\"jstree-closed\")&&(i.state.loaded=!1),i.li_attr[\"class\"]&&(i.li_attr[\"class\"]=i.li_attr[\"class\"].replace(\"jstree-closed\",\"\").replace(\"jstree-open\",\"\")),i.a_attr[\"class\"]&&(i.a_attr[\"class\"]=i.a_attr[\"class\"].replace(\"jstree-clicked\",\"\").replace(\"jstree-disabled\",\"\")),h[i.id]=i,i.state.selected&&this._data.core.selected.push(i.id),i.id},_parse_model_from_flat_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=a.id.toString(),f=this._model.data,g=this._model.default_state,h,i,j,k,l={id:e,text:a.text||\"\",icon:a.icon!==b?a.icon:!0,parent:c,parents:d,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(h in g)g.hasOwnProperty(h)&&(l.state[h]=g[h]);if(a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),l.icon!==b&&null!==l.icon&&\"\"!==l.icon||(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&(l.state[h]=a.data.jstree[h]);if(a&&\"object\"==typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(l.state[h]=a.state[h]);if(a&&\"object\"==typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(l.li_attr[h]=a.li_attr[h]);if(l.li_attr.id||(l.li_attr.id=e),a&&\"object\"==typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(l.a_attr[h]=a.a_attr[h]);for(a&&a.children&&a.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),f[l.id]=l,h=0,i=l.children.length;i>h;h++)j=this._parse_model_from_flat_json(f[l.children[h]],l.id,d),k=f[j],l.children_d.push(j),k.children_d.length&&(l.children_d=l.children_d.concat(k.children_d));return delete a.data,delete a.children,f[l.id].original=a,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(a,c,d){d=d?d.concat():[],c&&d.unshift(c);var e=!1,f,g,h,i,j=this._model.data,k=this._model.default_state,l;do e=\"j\"+this._id+\"_\"+ ++this._cnt;while(j[e]);l={id:!1,text:\"string\"==typeof a?a:\"\",icon:\"object\"==typeof a&&a.icon!==b?a.icon:!0,parent:c,parents:d,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:\"#\"},original:!1};for(f in k)k.hasOwnProperty(f)&&(l.state[f]=k[f]);if(a&&a.id&&(l.id=a.id.toString()),a&&a.text&&(l.text=a.text),a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(l.icon=a.data.jstree.icon),l.icon!==b&&null!==l.icon&&\"\"!==l.icon||(l.icon=!0),a&&a.data&&(l.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(l.state[f]=a.data.jstree[f]);if(a&&\"object\"==typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(l.state[f]=a.state[f]);if(a&&\"object\"==typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(l.li_attr[f]=a.li_attr[f]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=e),l.li_attr.id||(l.li_attr.id=l.id),a&&\"object\"==typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(l.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){for(f=0,g=a.children.length;g>f;f++)h=this._parse_model_from_json(a.children[f],l.id,d),i=j[h],l.children.push(h),i.children_d.length&&(l.children_d=l.children_d.concat(i.children_d));l.children_d=l.children_d.concat(l.children)}return a&&a.children&&a.children===!0&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete a.data,delete a.children,l.original=a,j[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var b=this._model.force_full_redraw?this._model.data[a.jstree.root].children.concat([]):this._model.changed.concat([]),c=i.createElement(\"UL\"),d,e,f,g=this._data.core.focused;for(e=0,f=b.length;f>e;e++)d=this.redraw_node(b[e],!0,this._model.force_full_redraw),d&&this._model.force_full_redraw&&c.appendChild(d);this._model.force_full_redraw&&(c.className=this.get_container_ul()[0].className,c.setAttribute(\"role\",\"group\"),this.element.empty().append(c)),null!==g&&(d=this.get_node(g,!0),d&&d.length&&d.children(\".jstree-anchor\")[0]!==i.activeElement?d.children(\".jstree-anchor\").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger(\"redraw\",{nodes:b})},redraw:function(a){a&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(b){var c=this.get_node(b),d=!1,e=!1,f=!1,g=i;if(!c)return!1;if(c.id===a.jstree.root)return this.redraw(!0);if(b=this.get_node(b,!0),!b||!b.length)return!1;if(b.children(\".jstree-children\").remove(),b=b[0],c.children.length&&c.state.loaded){for(f=g.createElement(\"UL\"),f.setAttribute(\"role\",\"group\"),f.className=\"jstree-children\",d=0,e=c.children.length;e>d;d++)f.appendChild(this.redraw_node(c.children[d],!0,!0));b.appendChild(f)}},redraw_node:function(b,c,d,e){var f=this.get_node(b),g=!1,h=!1,k=!1,l=!1,m=!1,n=!1,o=\"\",p=i,q=this._model.data,r=!1,s=!1,t=null,u=0,v=0,w=!1,x=!1;if(!f)return!1;if(f.id===a.jstree.root)return this.redraw(!0);if(c=c||0===f.children.length,b=i.querySelector?this.element[0].querySelector(\"#\"+(-1!==\"0123456789\".indexOf(f.id[0])?\"\\\\3\"+f.id[0]+\" \"+f.id.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):f.id.replace(a.jstree.idregex,\"\\\\$&\"))):i.getElementById(f.id))b=a(b),\nd||(g=b.parent().parent()[0],g===this.element[0]&&(g=null),h=b.index()),c||!f.children.length||b.children(\".jstree-children\").length||(c=!0),c||(k=b.children(\".jstree-children\")[0]),r=b.children(\".jstree-anchor\")[0]===i.activeElement,b.remove();else if(c=!0,!d){if(g=f.parent!==a.jstree.root?a(\"#\"+f.parent.replace(a.jstree.idregex,\"\\\\$&\"),this.element)[0]:null,!(null===g||g&&q[f.parent].state.opened))return!1;h=a.inArray(f.id,null===g?q[a.jstree.root].children:q[f.parent].children)}b=j.cloneNode(!0),o=\"jstree-node \";for(l in f.li_attr)if(f.li_attr.hasOwnProperty(l)){if(\"id\"===l)continue;\"class\"!==l?b.setAttribute(l,f.li_attr[l]):o+=f.li_attr[l]}for(f.a_attr.id||(f.a_attr.id=f.id+\"_anchor\"),b.setAttribute(\"aria-selected\",!!f.state.selected),b.setAttribute(\"aria-level\",f.parents.length),b.setAttribute(\"aria-labelledby\",f.a_attr.id),f.state.disabled&&b.setAttribute(\"aria-disabled\",!0),l=0,m=f.children.length;m>l;l++)if(!q[f.children[l]].state.hidden){w=!0;break}if(null!==f.parent&&q[f.parent]&&!f.state.hidden&&(l=a.inArray(f.id,q[f.parent].children),x=f.id,-1!==l))for(l++,m=q[f.parent].children.length;m>l;l++)if(q[q[f.parent].children[l]].state.hidden||(x=q[f.parent].children[l]),x!==f.id)break;f.state.hidden&&(o+=\" jstree-hidden\"),f.state.loaded&&!w?o+=\" jstree-leaf\":(o+=f.state.opened&&f.state.loaded?\" jstree-open\":\" jstree-closed\",b.setAttribute(\"aria-expanded\",f.state.opened&&f.state.loaded)),x===f.id&&(o+=\" jstree-last\"),b.id=f.id,b.className=o,o=(f.state.selected?\" jstree-clicked\":\"\")+(f.state.disabled?\" jstree-disabled\":\"\");for(m in f.a_attr)if(f.a_attr.hasOwnProperty(m)){if(\"href\"===m&&\"#\"===f.a_attr[m])continue;\"class\"!==m?b.childNodes[1].setAttribute(m,f.a_attr[m]):o+=\" \"+f.a_attr[m]}if(o.length&&(b.childNodes[1].className=\"jstree-anchor \"+o),(f.icon&&f.icon!==!0||f.icon===!1)&&(f.icon===!1?b.childNodes[1].childNodes[0].className+=\" jstree-themeicon-hidden\":-1===f.icon.indexOf(\"/\")&&-1===f.icon.indexOf(\".\")?b.childNodes[1].childNodes[0].className+=\" \"+f.icon+\" jstree-themeicon-custom\":(b.childNodes[1].childNodes[0].style.backgroundImage='url(\"'+f.icon+'\")',b.childNodes[1].childNodes[0].style.backgroundPosition=\"center center\",b.childNodes[1].childNodes[0].style.backgroundSize=\"auto\",b.childNodes[1].childNodes[0].className+=\" jstree-themeicon-custom\")),this.settings.core.force_text?b.childNodes[1].appendChild(p.createTextNode(f.text)):b.childNodes[1].innerHTML+=f.text,c&&f.children.length&&(f.state.opened||e)&&f.state.loaded){for(n=p.createElement(\"UL\"),n.setAttribute(\"role\",\"group\"),n.className=\"jstree-children\",l=0,m=f.children.length;m>l;l++)n.appendChild(this.redraw_node(f.children[l],c,!0));b.appendChild(n)}if(k&&b.appendChild(k),!d){for(g||(g=this.element[0]),l=0,m=g.childNodes.length;m>l;l++)if(g.childNodes[l]&&g.childNodes[l].className&&-1!==g.childNodes[l].className.indexOf(\"jstree-children\")){t=g.childNodes[l];break}t||(t=p.createElement(\"UL\"),t.setAttribute(\"role\",\"group\"),t.className=\"jstree-children\",g.appendChild(t)),g=t,h<g.childNodes.length?g.insertBefore(b,g.childNodes[h]):g.appendChild(b),r&&(u=this.element[0].scrollTop,v=this.element[0].scrollLeft,b.childNodes[1].focus(),this.element[0].scrollTop=u,this.element[0].scrollLeft=v)}return f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(a.proxy(function(){this.open_node(f.id,!1,0)},this),0)),b},open_node:function(c,d,e){var f,g,h,i;if(a.isArray(c)){for(c=c.slice(),f=0,g=c.length;g>f;f++)this.open_node(c[f],d,e);return!0}return c=this.get_node(c),c&&c.id!==a.jstree.root?(e=e===b?this.settings.core.animation:e,this.is_closed(c)?this.is_loaded(c)?(h=this.get_node(c,!0),i=this,h.length&&(e&&h.children(\".jstree-children\").length&&h.children(\".jstree-children\").stop(!0,!0),c.children.length&&!this._firstChild(h.children(\".jstree-children\")[0])&&this.draw_children(c),e?(this.trigger(\"before_open\",{node:c}),h.children(\".jstree-children\").css(\"display\",\"none\").end().removeClass(\"jstree-closed\").addClass(\"jstree-open\").attr(\"aria-expanded\",!0).children(\".jstree-children\").stop(!0,!0).slideDown(e,function(){this.style.display=\"\",i.trigger(\"after_open\",{node:c})})):(this.trigger(\"before_open\",{node:c}),h[0].className=h[0].className.replace(\"jstree-closed\",\"jstree-open\"),h[0].setAttribute(\"aria-expanded\",!0))),c.state.opened=!0,d&&d.call(this,c,!0),h.length||this.trigger(\"before_open\",{node:c}),this.trigger(\"open_node\",{node:c}),e&&h.length||this.trigger(\"after_open\",{node:c}),!0):this.is_loading(c)?setTimeout(a.proxy(function(){this.open_node(c,d,e)},this),500):void this.load_node(c,function(a,b){return b?this.open_node(a,d,e):d?d.call(this,a,!1):!1}):(d&&d.call(this,c,!1),!1)):!1},_open_to:function(b){if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;var c,d,e=b.parents;for(c=0,d=e.length;d>c;c+=1)c!==a.jstree.root&&this.open_node(e[c],!1,0);return a(\"#\"+b.id.replace(a.jstree.idregex,\"\\\\$&\"),this.element)},close_node:function(c,d){var e,f,g,h;if(a.isArray(c)){for(c=c.slice(),e=0,f=c.length;f>e;e++)this.close_node(c[e],d);return!0}return c=this.get_node(c),c&&c.id!==a.jstree.root?this.is_closed(c)?!1:(d=d===b?this.settings.core.animation:d,g=this,h=this.get_node(c,!0),c.state.opened=!1,this.trigger(\"close_node\",{node:c}),void(h.length?d?h.children(\".jstree-children\").attr(\"style\",\"display:block !important\").end().removeClass(\"jstree-open\").addClass(\"jstree-closed\").attr(\"aria-expanded\",!1).children(\".jstree-children\").stop(!0,!0).slideUp(d,function(){this.style.display=\"\",h.children(\".jstree-children\").remove(),g.trigger(\"after_close\",{node:c})}):(h[0].className=h[0].className.replace(\"jstree-open\",\"jstree-closed\"),h.attr(\"aria-expanded\",!1).children(\".jstree-children\").remove(),this.trigger(\"after_close\",{node:c})):this.trigger(\"after_close\",{node:c}))):!1},toggle_node:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.toggle_node(b[c]);return!0}return this.is_closed(b)?this.open_node(b):this.is_open(b)?this.close_node(b):void 0},open_all:function(b,c,d){if(b||(b=a.jstree.root),b=this.get_node(b),!b)return!1;var e=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0),f,g,h;if(!e.length){for(f=0,g=b.children_d.length;g>f;f++)this.is_closed(this._model.data[b.children_d[f]])&&(this._model.data[b.children_d[f]].state.opened=!0);return this.trigger(\"open_all\",{node:b})}d=d||e,h=this,e=this.is_closed(b)?e.find(\".jstree-closed\").addBack():e.find(\".jstree-closed\"),e.each(function(){h.open_node(this,function(a,b){b&&this.is_parent(a)&&this.open_all(a,c,d)},c||0)}),0===d.find(\".jstree-closed\").length&&this.trigger(\"open_all\",{node:this.get_node(d)})},close_all:function(b,c){if(b||(b=a.jstree.root),b=this.get_node(b),!b)return!1;var d=b.id===a.jstree.root?this.get_container_ul():this.get_node(b,!0),e=this,f,g;for(d.length&&(d=this.is_open(b)?d.find(\".jstree-open\").addBack():d.find(\".jstree-open\"),a(d.get().reverse()).each(function(){e.close_node(this,c||0)})),f=0,g=b.children_d.length;g>f;f++)this._model.data[b.children_d[f]].state.opened=!1;this.trigger(\"close_all\",{node:b})},is_disabled:function(a){return a=this.get_node(a),a&&a.state&&a.state.disabled},enable_node:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.enable_node(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(b.state.disabled=!1,this.get_node(b,!0).children(\".jstree-anchor\").removeClass(\"jstree-disabled\").attr(\"aria-disabled\",!1),void this.trigger(\"enable_node\",{node:b})):!1},disable_node:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.disable_node(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(b.state.disabled=!0,this.get_node(b,!0).children(\".jstree-anchor\").addClass(\"jstree-disabled\").attr(\"aria-disabled\",!0),void this.trigger(\"disable_node\",{node:b})):!1},is_hidden:function(a){return a=this.get_node(a),a.state.hidden===!0},hide_node:function(b,c){var d,e;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.hide_node(b[d],!0);return c||this.redraw(),!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?void(b.state.hidden||(b.state.hidden=!0,this._node_changed(b.parent),c||this.redraw(),this.trigger(\"hide_node\",{node:b}))):!1},show_node:function(b,c){var d,e;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.show_node(b[d],!0);return c||this.redraw(),!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?void(b.state.hidden&&(b.state.hidden=!1,this._node_changed(b.parent),c||this.redraw(),this.trigger(\"show_node\",{node:b}))):!1},hide_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&!d[c].state.hidden&&(d[c].state.hidden=!0,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger(\"hide_all\",{nodes:e}),e},show_all:function(b){var c,d=this._model.data,e=[];for(c in d)d.hasOwnProperty(c)&&c!==a.jstree.root&&d[c].state.hidden&&(d[c].state.hidden=!1,e.push(c));return this._model.force_full_redraw=!0,b||this.redraw(),this.trigger(\"show_all\",{nodes:e}),e},activate_node:function(a,c){if(this.is_disabled(a))return!1;if(c&&\"object\"==typeof c||(c={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==b?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&(!c.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(c.shiftKey){var d=this.get_node(a).id,e=this._data.core.last_clicked.id,f=this.get_node(this._data.core.last_clicked.parent).children,g=!1,h,i;for(h=0,i=f.length;i>h;h+=1)f[h]===d&&(g=!g),f[h]===e&&(g=!g),this.is_disabled(f[h])||!g&&f[h]!==d&&f[h]!==e?this.deselect_node(f[h],!0,c):this.is_hidden(f[h])||this.select_node(f[h],!0,!1,c);this.trigger(\"changed\",{action:\"select_node\",node:this.get_node(a),selected:this._data.core.selected,event:c})}else this.is_selected(a)?this.deselect_node(a,!1,c):this.select_node(a,!1,!1,c);else!this.settings.core.multiple&&(c.metaKey||c.ctrlKey||c.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,c):(this.deselect_all(!0),this.select_node(a,!1,!1,c),this._data.core.last_clicked=this.get_node(a));this.trigger(\"activate_node\",{node:this.get_node(a),event:c})},hover_node:function(a){if(a=this.get_node(a,!0),!a||!a.length||a.children(\".jstree-hovered\").length)return!1;var b=this.element.find(\".jstree-hovered\"),c=this.element;b&&b.length&&this.dehover_node(b),a.children(\".jstree-anchor\").addClass(\"jstree-hovered\"),this.trigger(\"hover_node\",{node:this.get_node(a)}),setTimeout(function(){c.attr(\"aria-activedescendant\",a[0].id)},0)},dehover_node:function(a){return a=this.get_node(a,!0),a&&a.length&&a.children(\".jstree-hovered\").length?(a.children(\".jstree-anchor\").removeClass(\"jstree-hovered\"),void this.trigger(\"dehover_node\",{node:this.get_node(a)})):!1},select_node:function(b,c,d,e){var f,g,h,i;if(a.isArray(b)){for(b=b.slice(),g=0,h=b.length;h>g;g++)this.select_node(b[g],c,d,e);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(f=this.get_node(b,!0),void(b.state.selected||(b.state.selected=!0,this._data.core.selected.push(b.id),d||(f=this._open_to(b)),f&&f.length&&f.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(\"jstree-clicked\"),this.trigger(\"select_node\",{node:b,selected:this._data.core.selected,event:e}),c||this.trigger(\"changed\",{action:\"select_node\",node:b,selected:this._data.core.selected,event:e})))):!1},deselect_node:function(b,c,d){var e,f,g;if(a.isArray(b)){for(b=b.slice(),e=0,f=b.length;f>e;e++)this.deselect_node(b[e],c,d);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(g=this.get_node(b,!0),void(b.state.selected&&(b.state.selected=!1,this._data.core.selected=a.vakata.array_remove_item(this._data.core.selected,b.id),g.length&&g.attr(\"aria-selected\",!1).children(\".jstree-anchor\").removeClass(\"jstree-clicked\"),this.trigger(\"deselect_node\",{node:b,selected:this._data.core.selected,event:d}),c||this.trigger(\"changed\",{action:\"deselect_node\",node:b,selected:this._data.core.selected,event:d})))):!1},select_all:function(b){var c=this._data.core.selected.concat([]),d,e;for(this._data.core.selected=this._model.data[a.jstree.root].children_d.concat(),d=0,e=this._data.core.selected.length;e>d;d++)this._model.data[this._data.core.selected[d]]&&(this._model.data[this._data.core.selected[d]].state.selected=!0);this.redraw(!0),this.trigger(\"select_all\",{selected:this._data.core.selected}),b||this.trigger(\"changed\",{action:\"select_all\",selected:this._data.core.selected,old_selection:c})},deselect_all:function(a){var b=this._data.core.selected.concat([]),c,d;for(c=0,d=this._data.core.selected.length;d>c;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[],this.element.find(\".jstree-clicked\").removeClass(\"jstree-clicked\").parent().attr(\"aria-selected\",!1),this.trigger(\"deselect_all\",{selected:this._data.core.selected,node:b}),a||this.trigger(\"changed\",{action:\"deselect_all\",selected:this._data.core.selected,old_selection:b})},is_selected:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.state.selected:!1},get_selected:function(b){return b?a.map(this._data.core.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(b){var c=this.get_selected(!0),d={},e,f,g,h;for(e=0,f=c.length;f>e;e++)d[c[e].id]=c[e];for(e=0,f=c.length;f>e;e++)for(g=0,h=c[e].children_d.length;h>g;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];c=[];for(e in d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,a.proxy(function(a){return this.get_node(a)},this)):c},get_bottom_selected:function(b){var c=this.get_selected(!0),d=[],e,f;for(e=0,f=c.length;f>e;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,a.proxy(function(a){return this.get_node(a)},this)):d},get_state:function(){var b={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},c;for(c in this._model.data)this._model.data.hasOwnProperty(c)&&c!==a.jstree.root&&(this._model.data[c].state.opened&&b.core.open.push(c),this._model.data[c].state.selected&&b.core.selected.push(c));return b},set_state:function(c,d){if(c){if(c.core){var e,f,g,h,i;if(c.core.open)return a.isArray(c.core.open)&&c.core.open.length?this._load_nodes(c.core.open,function(a){this.open_node(a,!1,0),delete c.core.open,this.set_state(c,d)},!0):(delete c.core.open,this.set_state(c,d)),!1;if(c.core.scroll)return c.core.scroll&&c.core.scroll.left!==b&&this.element.scrollLeft(c.core.scroll.left),c.core.scroll&&c.core.scroll.top!==b&&this.element.scrollTop(c.core.scroll.top),delete c.core.scroll,this.set_state(c,d),!1;if(c.core.selected)return h=this,this.deselect_all(),a.each(c.core.selected,function(a,b){h.select_node(b,!1,!0)}),delete c.core.selected,this.set_state(c,d),!1;for(i in c)c.hasOwnProperty(i)&&\"core\"!==i&&-1===a.inArray(i,this.settings.plugins)&&delete c[i];if(a.isEmptyObject(c.core))return delete c.core,this.set_state(c,d),!1}return a.isEmptyObject(c)?(c=null,d&&d.call(this),this.trigger(\"set_state\"),!1):!0}return!1},refresh:function(b,c){this._data.core.state=c===!0?{}:this.get_state(),c&&a.isFunction(c)&&(this._data.core.state=c.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[a.jstree.root]={id:a.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var d=this.get_container_ul()[0].className;b||(this.element.html(\"<ul class='\"+d+\"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j\"+this._id+\"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>\"+this.get_string(\"Loading ...\")+\"</a></li></ul>\"),this.element.attr(\"aria-activedescendant\",\"j\"+this._id+\"_loading\")),this.load_node(a.jstree.root,function(b,c){c&&(this.get_container_ul()[0].className=d,this._firstChild(this.get_container_ul()[0])&&this.element.attr(\"aria-activedescendant\",this._firstChild(this.get_container_ul()[0]).id),this.set_state(a.extend(!0,{},this._data.core.state),function(){this.trigger(\"refresh\")})),this._data.core.state=null})},refresh_node:function(b){if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;var c=[],d=[],e=this._data.core.selected.concat([]);d.push(b.id),b.state.opened===!0&&c.push(b.id),this.get_node(b,!0).find(\".jstree-open\").each(function(){d.push(this.id),c.push(this.id)}),this._load_nodes(d,a.proxy(function(a){this.open_node(c,!1,0),this.select_node(e),this.trigger(\"refresh_node\",{node:b,nodes:a})},this),!1,!0)},set_id:function(b,c){if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;var d,e,f=this._model.data,g=b.id;for(c=c.toString(),f[b.parent].children[a.inArray(b.id,f[b.parent].children)]=c,d=0,e=b.parents.length;e>d;d++)f[b.parents[d]].children_d[a.inArray(b.id,f[b.parents[d]].children_d)]=c;for(d=0,e=b.children.length;e>d;d++)f[b.children[d]].parent=c;for(d=0,e=b.children_d.length;e>d;d++)f[b.children_d[d]].parents[a.inArray(b.id,f[b.children_d[d]].parents)]=c;return d=a.inArray(b.id,this._data.core.selected),-1!==d&&(this._data.core.selected[d]=c),d=this.get_node(b.id,!0),d&&(d.attr(\"id\",c),this.element.attr(\"aria-activedescendant\")===b.id&&this.element.attr(\"aria-activedescendant\",c)),delete f[b.id],b.id=c,b.li_attr.id=c,f[c]=b,this.trigger(\"set_id\",{node:b,\"new\":b.id,old:g}),!0},get_text:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.text:!1},set_text:function(b,c){var d,e;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.set_text(b[d],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(b.text=c,this.get_node(b,!0).length&&this.redraw_node(b.id),this.trigger(\"set_text\",{obj:b,text:c}),!0):!1},get_json:function(b,c,d){if(b=this.get_node(b||a.jstree.root),!b)return!1;c&&c.flat&&!d&&(d=[]);var e={id:b.id,text:b.text,icon:this.get_icon(b),li_attr:a.extend(!0,{},b.li_attr),a_attr:a.extend(!0,{},b.a_attr),state:{},data:c&&c.no_data?!1:a.extend(!0,{},b.data)},f,g;if(c&&c.flat?e.parent=b.parent:e.children=[],!c||!c.no_state)for(f in b.state)b.state.hasOwnProperty(f)&&(e.state[f]=b.state[f]);if(c&&c.no_id&&(delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id),c&&c.flat&&b.id!==a.jstree.root&&d.push(e),!c||!c.no_children)for(f=0,g=b.children.length;g>f;f++)c&&c.flat?this.get_json(b.children[f],c,d):e.children.push(this.get_json(b.children[f],c));return c&&c.flat?d:b.id===a.jstree.root?e.children:e},create_node:function(c,d,e,f,g){if(null===c&&(c=a.jstree.root),c=this.get_node(c),!c)return!1;if(e=e===b?\"last\":e,!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(c))return this.load_node(c,function(){this.create_node(c,d,e,f,!0)});d||(d={text:this.get_string(\"New node\")}),\"string\"==typeof d&&(d={text:d}),d.text===b&&(d.text=this.get_string(\"New node\"));var h,i,j,k;switch(c.id===a.jstree.root&&(\"before\"===e&&(e=\"first\"),\"after\"===e&&(e=\"last\")),e){case\"before\":h=this.get_node(c.parent),e=a.inArray(c.id,h.children),c=h;break;case\"after\":h=this.get_node(c.parent),e=a.inArray(c.id,h.children)+1,c=h;break;case\"inside\":case\"first\":e=0;break;case\"last\":e=c.children.length;break;default:e||(e=0)}if(e>c.children.length&&(e=c.children.length),d.id||(d.id=!0),!this.check(\"create_node\",d,c,e))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(d.id===!0&&delete d.id,d=this._parse_model_from_json(d,c.id,c.parents.concat()),!d)return!1;for(h=this.get_node(d),i=[],i.push(d),i=i.concat(h.children_d),this.trigger(\"model\",{nodes:i,parent:c.id}),c.children_d=c.children_d.concat(i),j=0,k=c.parents.length;k>j;j++)this._model.data[c.parents[j]].children_d=this._model.data[c.parents[j]].children_d.concat(i);for(d=h,h=[],j=0,k=c.children.length;k>j;j++)h[j>=e?j+1:j]=c.children[j];return h[e]=d.id,c.children=h,this.redraw_node(c,!0),f&&f.call(this,this.get_node(d)),this.trigger(\"create_node\",{node:this.get_node(d),parent:c.id,position:e}),d.id},rename_node:function(b,c){var d,e,f;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.rename_node(b[d],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(f=b.text,this.check(\"rename_node\",b,this.get_parent(b),c)?(this.set_text(b,c),this.trigger(\"rename_node\",{node:b,text:c,old:f}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1)):!1},delete_node:function(b){var c,d,e,f,g,h,i,j,k,l,m,n;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.delete_node(b[c]);return!0}if(b=this.get_node(b),!b||b.id===a.jstree.root)return!1;if(e=this.get_node(b.parent),f=a.inArray(b.id,e.children),l=!1,!this.check(\"delete_node\",b,e,f))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==f&&(e.children=a.vakata.array_remove(e.children,f)),g=b.children_d.concat([]),g.push(b.id),h=0,i=b.parents.length;i>h;h++)this._model.data[b.parents[h]].children_d=a.vakata.array_filter(this._model.data[b.parents[h]].children_d,function(b){return-1===a.inArray(b,g)});for(j=0,k=g.length;k>j;j++)if(this._model.data[g[j]].state.selected){l=!0;break}for(l&&(this._data.core.selected=a.vakata.array_filter(this._data.core.selected,function(b){return-1===a.inArray(b,g)})),this.trigger(\"delete_node\",{node:b,parent:e.id}),l&&this.trigger(\"changed\",{action:\"delete_node\",node:b,selected:this._data.core.selected,parent:e.id}),j=0,k=g.length;k>j;j++)delete this._model.data[g[j]];return-1!==a.inArray(this._data.core.focused,g)&&(this._data.core.focused=null,m=this.element[0].scrollTop,n=this.element[0].scrollLeft,e.id===a.jstree.root?this._model.data[a.jstree.root].children[0]&&this.get_node(this._model.data[a.jstree.root].children[0],!0).children(\".jstree-anchor\").focus():this.get_node(e,!0).children(\".jstree-anchor\").focus(),this.element[0].scrollTop=m,this.element[0].scrollLeft=n),this.redraw_node(e,!0),!0},check:function(b,c,d,e,f){c=c&&c.id?c:this.get_node(c),d=d&&d.id?d:this.get_node(d);var g=b.match(/^move_node|copy_node|create_node$/i)?d:c,h=this.settings.core.check_callback;return\"move_node\"!==b||f&&f.is_multi||c.id!==d.id&&(\"move_node\"!==b||a.inArray(c.id,d.children)!==e)&&-1===a.inArray(d.id,c.children_d)?(g&&g.data&&(g=g.data),g&&g.functions&&(g.functions[b]===!1||g.functions[b]===!0)?(g.functions[b]===!1&&(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_02\",reason:\"Node data prevents function: \"+b,data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})}),g.functions[b]):h===!1||a.isFunction(h)&&h.call(this,b,c,d,e,f)===!1||h&&h[b]===!1?(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_03\",reason:\"User config for core.check_callback prevents function: \"+b,data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1):!0):(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_01\",reason:\"Moving parent inside child\",data:JSON.stringify({chk:b,pos:e,obj:c&&c.id?c.id:!1,par:d&&d.id?d.id:!1})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.move_node(c,d,e,f,!0,!1,i)});if(a.isArray(c)){if(1!==c.length){for(j=0,k=c.length;k>j;j++)(r=this.move_node(c[j],d,e,f,g,!1,i))&&(d=r,e=\"after\");return this.redraw(),!0}c=c[0]}if(c=c&&c.id?c:this.get_node(c),!c||c.id===a.jstree.root)return!1;if(l=(c.parent||a.jstree.root).toString(),n=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,o=i?i:this._model.data[c.id]?this:a.jstree.reference(c.id),p=!o||!o._id||this._id!==o._id,m=o&&o._id&&l&&o._model.data[l]&&o._model.data[l].children?a.inArray(c.id,o._model.data[l].children):-1,o&&o._id&&(c=o._model.data[c.id]),p)return(r=this.copy_node(c,d,e,f,g,!1,i))?(o&&o.delete_node(c),r):!1;switch(d.id===a.jstree.root&&(\"before\"===e&&(e=\"first\"),\"after\"===e&&(e=\"last\")),e){case\"before\":e=a.inArray(d.id,n.children);break;case\"after\":e=a.inArray(d.id,n.children)+1;break;case\"inside\":case\"first\":e=0;break;case\"last\":e=n.children.length;break;default:e||(e=0)}if(e>n.children.length&&(e=n.children.length),!this.check(\"move_node\",c,n,e,{core:!0,origin:i,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(c.parent===n.id){for(q=n.children.concat(),r=a.inArray(c.id,q),-1!==r&&(q=a.vakata.array_remove(q,r),e>r&&e--),r=[],s=0,t=q.length;t>s;s++)r[s>=e?s+1:s]=q[s];r[e]=c.id,n.children=r,this._node_changed(n.id),this.redraw(n.id===a.jstree.root)}else{for(r=c.children_d.concat(),r.push(c.id),s=0,t=c.parents.length;t>s;s++){for(q=[],w=o._model.data[c.parents[s]].children_d,u=0,v=w.length;v>u;u++)-1===a.inArray(w[u],r)&&q.push(w[u]);o._model.data[c.parents[s]].children_d=q}for(o._model.data[l].children=a.vakata.array_remove_item(o._model.data[l].children,c.id),s=0,t=n.parents.length;t>s;s++)this._model.data[n.parents[s]].children_d=this._model.data[n.parents[s]].children_d.concat(r);for(q=[],s=0,t=n.children.length;t>s;s++)q[s>=e?s+1:s]=n.children[s];for(q[e]=c.id,n.children=q,n.children_d.push(c.id),n.children_d=n.children_d.concat(c.children_d),c.parent=n.id,r=n.parents.concat(),r.unshift(n.id),w=c.parents.length,c.parents=r,r=r.concat(),s=0,t=c.children_d.length;t>s;s++)this._model.data[c.children_d[s]].parents=this._model.data[c.children_d[s]].parents.slice(0,-1*w),Array.prototype.push.apply(this._model.data[c.children_d[s]].parents,r);l!==a.jstree.root&&n.id!==a.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(n.id)),h||this.redraw()}return f&&f.call(this,c,n,e),this.trigger(\"move_node\",{node:c,parent:n.id,position:e,old_parent:l,old_position:m,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id,old_instance:o,new_instance:this}),c.id},copy_node:function(c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t;if(d=this.get_node(d),e=e===b?0:e,!d)return!1;if(!e.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(d))return this.load_node(d,function(){this.copy_node(c,d,e,f,!0,!1,i)});if(a.isArray(c)){if(1!==c.length){for(j=0,k=c.length;k>j;j++)(m=this.copy_node(c[j],d,e,f,g,!0,i))&&(d=m,e=\"after\");return this.redraw(),!0}c=c[0]}if(c=c&&c.id?c:this.get_node(c),!c||c.id===a.jstree.root)return!1;switch(q=(c.parent||a.jstree.root).toString(),r=e.toString().match(/^(before|after)$/)&&d.id!==a.jstree.root?this.get_node(d.parent):d,s=i?i:this._model.data[c.id]?this:a.jstree.reference(c.id),t=!s||!s._id||this._id!==s._id,s&&s._id&&(c=s._model.data[c.id]),d.id===a.jstree.root&&(\"before\"===e&&(e=\"first\"),\"after\"===e&&(e=\"last\")),e){case\"before\":e=a.inArray(d.id,r.children);break;case\"after\":e=a.inArray(d.id,r.children)+1;break;case\"inside\":case\"first\":e=0;break;case\"last\":e=r.children.length;break;default:e||(e=0)}if(e>r.children.length&&(e=r.children.length),!this.check(\"copy_node\",c,r,e,{core:!0,origin:i,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(p=s?s.get_json(c,{no_id:!0,no_data:!0,no_state:!0}):c,!p)return!1;if(p.id===!0&&delete p.id,p=this._parse_model_from_json(p,r.id,r.parents.concat()),!p)return!1;for(m=this.get_node(p),c&&c.state&&c.state.loaded===!1&&(m.state.loaded=!1),l=[],l.push(p),l=l.concat(m.children_d),this.trigger(\"model\",{nodes:l,parent:r.id}),n=0,o=r.parents.length;o>n;n++)this._model.data[r.parents[n]].children_d=this._model.data[r.parents[n]].children_d.concat(l);for(l=[],n=0,o=r.children.length;o>n;n++)l[n>=e?n+1:n]=r.children[n];return l[e]=m.id,r.children=l,r.children_d.push(m.id),r.children_d=r.children_d.concat(m.children_d),r.id===a.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(r.id),h||this.redraw(r.id===a.jstree.root),f&&f.call(this,m,r,e),this.trigger(\"copy_node\",{node:m,original:c,parent:r.id,position:e,old_parent:q,old_position:s&&s._id&&q&&s._model.data[q]&&s._model.data[q].children?a.inArray(c.id,s._model.data[q].children):-1,is_multi:s&&s._id&&s._id!==this._id,is_foreign:!s||!s._id,old_instance:s,new_instance:this}),m.id},cut:function(b){if(b||(b=this._data.core.selected.concat()),a.isArray(b)||(b=[b]),!b.length)return!1;var c=[],g,h,i;for(h=0,i=b.length;i>h;h++)g=this.get_node(b[h]),g&&g.id&&g.id!==a.jstree.root&&c.push(g);return c.length?(d=c,f=this,e=\"move_node\",void this.trigger(\"cut\",{node:b})):!1},copy:function(b){if(b||(b=this._data.core.selected.concat()),a.isArray(b)||(b=[b]),!b.length)return!1;var c=[],g,h,i;for(h=0,i=b.length;i>h;h++)g=this.get_node(b[h]),g&&g.id&&g.id!==a.jstree.root&&c.push(g);return c.length?(d=c,f=this,e=\"copy_node\",void this.trigger(\"copy\",{node:b})):!1},get_buffer:function(){return{mode:e,node:d,inst:f}},can_paste:function(){return e!==!1&&d!==!1},paste:function(a,b){return a=this.get_node(a),a&&e&&e.match(/^(copy_node|move_node)$/)&&d?(this[e](d,a,b,!1,!1,!1,f)&&this.trigger(\"paste\",{parent:a.id,node:d,mode:e}),d=!1,e=!1,void(f=!1)):!1},clear_buffer:function(){d=!1,e=!1,f=!1,this.trigger(\"clear_buffer\")},edit:function(b,c,d){var e,f,g,h,j,k,l,m,n,o=!1;return(b=this.get_node(b))?this.settings.core.check_callback===!1?(this._data.core.last_error={error:\"check\",plugin:\"core\",id:\"core_07\",reason:\"Could not edit node because of check_callback\"},this.settings.core.error.call(this,this._data.core.last_error),!1):(n=b,c=\"string\"==typeof c?c:b.text,this.set_text(b,\"\"),b=this._open_to(b),n.text=c,e=this._data.core.rtl,f=this.element.width(),this._data.core.focused=n.id,g=b.children(\".jstree-anchor\").focus(),h=a(\"<span>\"),j=c,k=a(\"<div />\",{css:{position:\"absolute\",top:\"-200px\",left:e?\"0px\":\"-1000px\",visibility:\"hidden\"}}).appendTo(\"body\"),l=a(\"<input />\",{value:j,\"class\":\"jstree-rename-input\",css:{padding:\"0\",border:\"1px solid silver\",\"box-sizing\":\"border-box\",display:\"inline-block\",height:this._data.core.li_height+\"px\",lineHeight:this._data.core.li_height+\"px\",width:\"150px\"},blur:a.proxy(function(c){c.stopImmediatePropagation(),c.preventDefault();var e=h.children(\".jstree-rename-input\"),f=e.val(),i=this.settings.core.force_text,m;\"\"===f&&(f=j),k.remove(),h.replaceWith(g),h.remove(),j=i?j:a(\"<div></div>\").append(a.parseHTML(j)).html(),this.set_text(b,j),m=!!this.rename_node(b,i?a(\"<div></div>\").text(f).text():a(\"<div></div>\").append(a.parseHTML(f)).html()),m||this.set_text(b,j),this._data.core.focused=n.id,setTimeout(a.proxy(function(){var a=this.get_node(n.id,!0);a.length&&(this._data.core.focused=n.id,a.children(\".jstree-anchor\").focus())},this),0),d&&d.call(this,n,m,o),l=null},this),keydown:function(a){var b=a.which;27===b&&(o=!0,this.value=j),27!==b&&13!==b&&37!==b&&38!==b&&39!==b&&40!==b&&32!==b||a.stopImmediatePropagation(),27!==b&&13!==b||(a.preventDefault(),this.blur())},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(k.text(\"pW\"+this.value).width(),f))},keypress:function(a){return 13===a.which?!1:void 0}}),m={fontFamily:g.css(\"fontFamily\")||\"\",fontSize:g.css(\"fontSize\")||\"\",fontWeight:g.css(\"fontWeight\")||\"\",fontStyle:g.css(\"fontStyle\")||\"\",fontStretch:g.css(\"fontStretch\")||\"\",fontVariant:g.css(\"fontVariant\")||\"\",letterSpacing:g.css(\"letterSpacing\")||\"\",wordSpacing:g.css(\"wordSpacing\")||\"\"},h.attr(\"class\",g.attr(\"class\")).append(g.contents().clone()).append(l),g.replaceWith(h),k.css(m),l.css(m).width(Math.min(k.text(\"pW\"+l[0].value).width(),f))[0].select(),void a(i).one(\"mousedown.jstree touchstart.jstree dnd_start.vakata\",function(b){\nl&&b.target!==l&&a(l).blur()})):!1},set_theme:function(b,c){if(!b)return!1;if(c===!0){var d=this.settings.core.themes.dir;d||(d=a.jstree.path+\"/themes\"),c=d+\"/\"+b+\"/style.css\"}c&&-1===a.inArray(c,g)&&(a(\"head\").append('<link rel=\"stylesheet\" href=\"'+c+'\" type=\"text/css\" />'),g.push(c)),this._data.core.themes.name&&this.element.removeClass(\"jstree-\"+this._data.core.themes.name),this._data.core.themes.name=b,this.element.addClass(\"jstree-\"+b),this.element[this.settings.core.themes.responsive?\"addClass\":\"removeClass\"](\"jstree-\"+b+\"-responsive\"),this.trigger(\"set_theme\",{theme:b})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass(\"jstree-\"+this._data.core.themes.name+\"-\"+this._data.core.themes.variant),this._data.core.themes.variant=a,a&&this.element.addClass(\"jstree-\"+this._data.core.themes.name+\"-\"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass(\"jstree-striped\")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass(\"jstree-striped\")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass(\"jstree-no-dots\")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass(\"jstree-no-dots\")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass(\"jstree-no-icons\")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass(\"jstree-no-icons\")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(c,d){var e,f,g,h;if(a.isArray(c)){for(c=c.slice(),e=0,f=c.length;f>e;e++)this.set_icon(c[e],d);return!0}return c=this.get_node(c),c&&c.id!==a.jstree.root?(h=c.icon,c.icon=d===!0||null===d||d===b||\"\"===d?!0:d,g=this.get_node(c,!0).children(\".jstree-anchor\").children(\".jstree-themeicon\"),d===!1?this.hide_icon(c):d===!0||null===d||d===b||\"\"===d?(g.removeClass(\"jstree-themeicon-custom \"+h).css(\"background\",\"\").removeAttr(\"rel\"),h===!1&&this.show_icon(c)):-1===d.indexOf(\"/\")&&-1===d.indexOf(\".\")?(g.removeClass(h).css(\"background\",\"\"),g.addClass(d+\" jstree-themeicon-custom\").attr(\"rel\",d),h===!1&&this.show_icon(c)):(g.removeClass(h).css(\"background\",\"\"),g.addClass(\"jstree-themeicon-custom\").css(\"background\",\"url('\"+d+\"') center center no-repeat\").attr(\"rel\",d),h===!1&&this.show_icon(c)),!0):!1},get_icon:function(b){return b=this.get_node(b),b&&b.id!==a.jstree.root?b.icon:!1},hide_icon:function(b){var c,d;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.hide_icon(b[c]);return!0}return b=this.get_node(b),b&&b!==a.jstree.root?(b.icon=!1,this.get_node(b,!0).children(\".jstree-anchor\").children(\".jstree-themeicon\").addClass(\"jstree-themeicon-hidden\"),!0):!1},show_icon:function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.show_icon(b[c]);return!0}return b=this.get_node(b),b&&b!==a.jstree.root?(e=this.get_node(b,!0),b.icon=e.length?e.children(\".jstree-anchor\").children(\".jstree-themeicon\").attr(\"rel\"):!0,b.icon||(b.icon=!0),e.children(\".jstree-anchor\").children(\".jstree-themeicon\").removeClass(\"jstree-themeicon-hidden\"),!0):!1}},a.vakata={},a.vakata.attributes=function(b,c){b=a(b)[0];var d=c?{}:[];return b&&b.attributes&&a.each(b.attributes,function(b,e){-1===a.inArray(e.name.toLowerCase(),[\"style\",\"contenteditable\",\"hasfocus\",\"tabindex\"])&&null!==e.value&&\"\"!==a.trim(e.value)&&(c?d[e.name]=e.value:d.push(e.name))}),d},a.vakata.array_unique=function(a){var c=[],d,e,f,g={};for(d=0,f=a.length;f>d;d++)g[a[d]]===b&&(c.push(a[d]),g[a[d]]=!0);return c},a.vakata.array_remove=function(a,b){return a.splice(b,1),a},a.vakata.array_remove_item=function(b,c){var d=a.inArray(c,b);return-1!==d?a.vakata.array_remove(b,d):b},a.vakata.array_filter=function(a,b,c,d,e){if(a.filter)return a.filter(b,c);d=[];for(e in a)~~e+\"\"==e+\"\"&&e>=0&&b.call(c,a[e],+e,a)&&d.push(a[e]);return d},a.jstree.plugins.changed=function(a,b){var c=[];this.trigger=function(a,d){var e,f;if(d||(d={}),\"changed\"===a.replace(\".jstree\",\"\")){d.changed={selected:[],deselected:[]};var g={};for(e=0,f=c.length;f>e;e++)g[c[e]]=1;for(e=0,f=d.selected.length;f>e;e++)g[d.selected[e]]?g[d.selected[e]]=2:d.changed.selected.push(d.selected[e]);for(e=0,f=c.length;f>e;e++)1===g[c[e]]&&d.changed.deselected.push(c[e]);c=d.selected.slice()}b.trigger.call(this,a,d)},this.refresh=function(a,d){return c=[],b.refresh.apply(this,arguments)}};var m=i.createElement(\"I\");m.className=\"jstree-icon jstree-checkbox\",m.setAttribute(\"role\",\"presentation\"),a.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:\"\",tie_selection:!0},a.jstree.plugins.checkbox=function(c,d){this.bind=function(){d.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade=\"up+down+undetermined\"),this.element.on(\"init.jstree\",a.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass(\"jstree-checkbox-no-clicked\"),this.settings.checkbox.tie_selection&&this.element.addClass(\"jstree-checkbox-selection\")},this)).on(\"loading.jstree\",a.proxy(function(){this[this._data.checkbox.visible?\"show_checkboxes\":\"hide_checkboxes\"]()},this)),-1!==this.settings.checkbox.cascade.indexOf(\"undetermined\")&&this.element.on(\"changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree\",a.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on(\"model.jstree\",a.proxy(function(a,b){var c=this._model.data,d=c[b.parent],e=b.nodes,f,g;for(f=0,g=e.length;g>f;f++)c[e[f]].state.checked=c[e[f]].state.checked||c[e[f]].original&&c[e[f]].original.state&&c[e[f]].original.state.checked,c[e[f]].state.checked&&this._data.checkbox.selected.push(e[f])},this)),-1===this.settings.checkbox.cascade.indexOf(\"up\")&&-1===this.settings.checkbox.cascade.indexOf(\"down\")||this.element.on(\"model.jstree\",a.proxy(function(b,c){var d=this._model.data,e=d[c.parent],f=c.nodes,g=[],h,i,j,k,l,m,n=this.settings.checkbox.cascade,o=this.settings.checkbox.tie_selection;if(-1!==n.indexOf(\"down\"))if(e.state[o?\"selected\":\"checked\"]){for(i=0,j=f.length;j>i;i++)d[f[i]].state[o?\"selected\":\"checked\"]=!0;this._data[o?\"core\":\"checkbox\"].selected=this._data[o?\"core\":\"checkbox\"].selected.concat(f)}else for(i=0,j=f.length;j>i;i++)if(d[f[i]].state[o?\"selected\":\"checked\"]){for(k=0,l=d[f[i]].children_d.length;l>k;k++)d[d[f[i]].children_d[k]].state[o?\"selected\":\"checked\"]=!0;this._data[o?\"core\":\"checkbox\"].selected=this._data[o?\"core\":\"checkbox\"].selected.concat(d[f[i]].children_d)}if(-1!==n.indexOf(\"up\")){for(i=0,j=e.children_d.length;j>i;i++)d[e.children_d[i]].children.length||g.push(d[e.children_d[i]].parent);for(g=a.vakata.array_unique(g),k=0,l=g.length;l>k;k++){e=d[g[k]];while(e&&e.id!==a.jstree.root){for(h=0,i=0,j=e.children.length;j>i;i++)h+=d[e.children[i]].state[o?\"selected\":\"checked\"];if(h!==j)break;e.state[o?\"selected\":\"checked\"]=!0,this._data[o?\"core\":\"checkbox\"].selected.push(e.id),m=this.get_node(e,!0),m&&m.length&&m.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(o?\"jstree-clicked\":\"jstree-checked\"),e=this.get_node(e.parent)}}}this._data[o?\"core\":\"checkbox\"].selected=a.vakata.array_unique(this._data[o?\"core\":\"checkbox\"].selected)},this)).on(this.settings.checkbox.tie_selection?\"select_node.jstree\":\"check_node.jstree\",a.proxy(function(b,c){var d=c.node,e=this._model.data,f=this.get_node(d.parent),g=this.get_node(d,!0),h,i,j,k,l=this.settings.checkbox.cascade,m=this.settings.checkbox.tie_selection,n={},o=this._data[m?\"core\":\"checkbox\"].selected;for(h=0,i=o.length;i>h;h++)n[o[h]]=!0;if(-1!==l.indexOf(\"down\"))for(h=0,i=d.children_d.length;i>h;h++)n[d.children_d[h]]=!0,k=e[d.children_d[h]],k.state[m?\"selected\":\"checked\"]=!0,k&&k.original&&k.original.state&&k.original.state.undetermined&&(k.original.state.undetermined=!1);if(-1!==l.indexOf(\"up\"))while(f&&f.id!==a.jstree.root){for(j=0,h=0,i=f.children.length;i>h;h++)j+=e[f.children[h]].state[m?\"selected\":\"checked\"];if(j!==i)break;f.state[m?\"selected\":\"checked\"]=!0,n[f.id]=!0,k=this.get_node(f,!0),k&&k.length&&k.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\"),f=this.get_node(f.parent)}o=[];for(h in n)n.hasOwnProperty(h)&&o.push(h);this._data[m?\"core\":\"checkbox\"].selected=o,-1!==l.indexOf(\"down\")&&g.length&&g.find(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\").parent().attr(\"aria-selected\",!0)},this)).on(this.settings.checkbox.tie_selection?\"deselect_all.jstree\":\"uncheck_all.jstree\",a.proxy(function(b,c){var d=this.get_node(a.jstree.root),e=this._model.data,f,g,h;for(f=0,g=d.children_d.length;g>f;f++)h=e[d.children_d[f]],h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?\"deselect_node.jstree\":\"uncheck_node.jstree\",a.proxy(function(b,c){var d=c.node,e=this.get_node(d,!0),f,g,h,i=this.settings.checkbox.cascade,j=this.settings.checkbox.tie_selection,k=this._data[j?\"core\":\"checkbox\"].selected,l={};if(d&&d.original&&d.original.state&&d.original.state.undetermined&&(d.original.state.undetermined=!1),-1!==i.indexOf(\"down\"))for(f=0,g=d.children_d.length;g>f;f++)h=this._model.data[d.children_d[f]],h.state[j?\"selected\":\"checked\"]=!1,h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1);if(-1!==i.indexOf(\"up\"))for(f=0,g=d.parents.length;g>f;f++)h=this._model.data[d.parents[f]],h.state[j?\"selected\":\"checked\"]=!1,h&&h.original&&h.original.state&&h.original.state.undetermined&&(h.original.state.undetermined=!1),h=this.get_node(d.parents[f],!0),h&&h.length&&h.attr(\"aria-selected\",!1).children(\".jstree-anchor\").removeClass(j?\"jstree-clicked\":\"jstree-checked\");for(l={},f=0,g=k.length;g>f;f++)-1!==i.indexOf(\"down\")&&-1!==a.inArray(k[f],d.children_d)||-1!==i.indexOf(\"up\")&&-1!==a.inArray(k[f],d.parents)||(l[k[f]]=!0);k=[];for(f in l)l.hasOwnProperty(f)&&k.push(f);this._data[j?\"core\":\"checkbox\"].selected=k,-1!==i.indexOf(\"down\")&&e.length&&e.find(\".jstree-anchor\").removeClass(j?\"jstree-clicked\":\"jstree-checked\").parent().attr(\"aria-selected\",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf(\"up\")&&this.element.on(\"delete_node.jstree\",a.proxy(function(b,c){var d=this.get_node(c.parent),e=this._model.data,f,g,h,i,j=this.settings.checkbox.tie_selection;while(d&&d.id!==a.jstree.root&&!d.state[j?\"selected\":\"checked\"]){for(h=0,f=0,g=d.children.length;g>f;f++)h+=e[d.children[f]].state[j?\"selected\":\"checked\"];if(!(g>0&&h===g))break;d.state[j?\"selected\":\"checked\"]=!0,this._data[j?\"core\":\"checkbox\"].selected.push(d.id),i=this.get_node(d,!0),i&&i.length&&i.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(j?\"jstree-clicked\":\"jstree-checked\"),d=this.get_node(d.parent)}},this)).on(\"move_node.jstree\",a.proxy(function(b,c){var d=c.is_multi,e=c.old_parent,f=this.get_node(c.parent),g=this._model.data,h,i,j,k,l,m=this.settings.checkbox.tie_selection;if(!d){h=this.get_node(e);while(h&&h.id!==a.jstree.root&&!h.state[m?\"selected\":\"checked\"]){for(i=0,j=0,k=h.children.length;k>j;j++)i+=g[h.children[j]].state[m?\"selected\":\"checked\"];if(!(k>0&&i===k))break;h.state[m?\"selected\":\"checked\"]=!0,this._data[m?\"core\":\"checkbox\"].selected.push(h.id),l=this.get_node(h,!0),l&&l.length&&l.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\"),h=this.get_node(h.parent)}}h=f;while(h&&h.id!==a.jstree.root){for(i=0,j=0,k=h.children.length;k>j;j++)i+=g[h.children[j]].state[m?\"selected\":\"checked\"];if(i===k)h.state[m?\"selected\":\"checked\"]||(h.state[m?\"selected\":\"checked\"]=!0,this._data[m?\"core\":\"checkbox\"].selected.push(h.id),l=this.get_node(h,!0),l&&l.length&&l.attr(\"aria-selected\",!0).children(\".jstree-anchor\").addClass(m?\"jstree-clicked\":\"jstree-checked\"));else{if(!h.state[m?\"selected\":\"checked\"])break;h.state[m?\"selected\":\"checked\"]=!1,this._data[m?\"core\":\"checkbox\"].selected=a.vakata.array_remove_item(this._data[m?\"core\":\"checkbox\"].selected,h.id),l=this.get_node(h,!0),l&&l.length&&l.attr(\"aria-selected\",!1).children(\".jstree-anchor\").removeClass(m?\"jstree-clicked\":\"jstree-checked\")}h=this.get_node(h.parent)}},this))},this._undetermined=function(){if(null!==this.element){var c,d,e,f,g={},h=this._model.data,i=this.settings.checkbox.tie_selection,j=this._data[i?\"core\":\"checkbox\"].selected,k=[],l=this;for(c=0,d=j.length;d>c;c++)if(h[j[c]]&&h[j[c]].parents)for(e=0,f=h[j[c]].parents.length;f>e;e++){if(g[h[j[c]].parents[e]]!==b)break;h[j[c]].parents[e]!==a.jstree.root&&(g[h[j[c]].parents[e]]=!0,k.push(h[j[c]].parents[e]))}for(this.element.find(\".jstree-closed\").not(\":has(.jstree-children)\").each(function(){var i=l.get_node(this),j;if(i.state.loaded){for(c=0,d=i.children_d.length;d>c;c++)if(j=h[i.children_d[c]],!j.state.loaded&&j.original&&j.original.state&&j.original.state.undetermined&&j.original.state.undetermined===!0)for(g[j.id]===b&&j.id!==a.jstree.root&&(g[j.id]=!0,k.push(j.id)),e=0,f=j.parents.length;f>e;e++)g[j.parents[e]]===b&&j.parents[e]!==a.jstree.root&&(g[j.parents[e]]=!0,k.push(j.parents[e]))}else if(i.original&&i.original.state&&i.original.state.undetermined&&i.original.state.undetermined===!0)for(g[i.id]===b&&i.id!==a.jstree.root&&(g[i.id]=!0,k.push(i.id)),e=0,f=i.parents.length;f>e;e++)g[i.parents[e]]===b&&i.parents[e]!==a.jstree.root&&(g[i.parents[e]]=!0,k.push(i.parents[e]))}),this.element.find(\".jstree-undetermined\").removeClass(\"jstree-undetermined\"),c=0,d=k.length;d>c;c++)h[k[c]].state[i?\"selected\":\"checked\"]||(j=this.get_node(k[c],!0),j&&j.length&&j.children(\".jstree-anchor\").children(\".jstree-checkbox\").addClass(\"jstree-undetermined\"))}},this.redraw_node=function(b,c,e,f){if(b=d.redraw_node.apply(this,arguments)){var g,h,i=null,j=null;for(g=0,h=b.childNodes.length;h>g;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf(\"jstree-anchor\")){i=b.childNodes[g];break}i&&(!this.settings.checkbox.tie_selection&&this._model.data[b.id].state.checked&&(i.className+=\" jstree-checked\"),j=m.cloneNode(!1),this._model.data[b.id].state.checkbox_disabled&&(j.className+=\" jstree-checkbox-disabled\"),i.insertBefore(j,i.childNodes[0]))}return e||-1===this.settings.checkbox.cascade.indexOf(\"undetermined\")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(a.proxy(this._undetermined,this),50)),b},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass(\"jstree-no-checkboxes\")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass(\"jstree-no-checkboxes\")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(b){b=this.get_node(b);var c=this.settings.checkbox.cascade,d,e,f=this.settings.checkbox.tie_selection,g=this._data[f?\"core\":\"checkbox\"].selected,h=this._model.data;if(!b||b.state[f?\"selected\":\"checked\"]===!0||-1===c.indexOf(\"undetermined\")||-1===c.indexOf(\"down\")&&-1===c.indexOf(\"up\"))return!1;if(!b.state.loaded&&b.original.state.undetermined===!0)return!0;for(d=0,e=b.children_d.length;e>d;d++)if(-1!==a.inArray(b.children_d[d],g)||!h[b.children_d[d]].state.loaded&&h[b.children_d[d]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.disable_checkbox(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(e=this.get_node(b,!0),void(b.state.checkbox_disabled||(b.state.checkbox_disabled=!0,e&&e.length&&e.children(\".jstree-anchor\").children(\".jstree-checkbox\").addClass(\"jstree-checkbox-disabled\"),this.trigger(\"disable_checkbox\",{node:b})))):!1},this.enable_checkbox=function(b){var c,d,e;if(a.isArray(b)){for(b=b.slice(),c=0,d=b.length;d>c;c++)this.enable_checkbox(b[c]);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(e=this.get_node(b,!0),void(b.state.checkbox_disabled&&(b.state.checkbox_disabled=!1,e&&e.length&&e.children(\".jstree-anchor\").children(\".jstree-checkbox\").removeClass(\"jstree-checkbox-disabled\"),this.trigger(\"enable_checkbox\",{node:b})))):!1},this.activate_node=function(b,c){return a(c.target).hasClass(\"jstree-checkbox-disabled\")?!1:(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||a(c.target).hasClass(\"jstree-checkbox\"))&&(c.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!a(c.target).hasClass(\"jstree-checkbox\")?d.activate_node.call(this,b,c):this.is_disabled(b)?!1:(this.is_checked(b)?this.uncheck_node(b,c):this.check_node(b,c),void this.trigger(\"activate_node\",{node:this.get_node(b)})))},this.check_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.select_node(b,!1,!0,c);var d,e,f,g;if(a.isArray(b)){for(b=b.slice(),e=0,f=b.length;f>e;e++)this.check_node(b[e],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(d=this.get_node(b,!0),void(b.state.checked||(b.state.checked=!0,this._data.checkbox.selected.push(b.id),d&&d.length&&d.children(\".jstree-anchor\").addClass(\"jstree-checked\"),this.trigger(\"check_node\",{node:b,selected:this._data.checkbox.selected,event:c})))):!1},this.uncheck_node=function(b,c){if(this.settings.checkbox.tie_selection)return this.deselect_node(b,!1,c);var d,e,f;if(a.isArray(b)){for(b=b.slice(),d=0,e=b.length;e>d;d++)this.uncheck_node(b[d],c);return!0}return b=this.get_node(b),b&&b.id!==a.jstree.root?(f=this.get_node(b,!0),void(b.state.checked&&(b.state.checked=!1,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,b.id),f.length&&f.children(\".jstree-anchor\").removeClass(\"jstree-checked\"),this.trigger(\"uncheck_node\",{node:b,selected:this._data.checkbox.selected,event:c})))):!1},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var b=this._data.checkbox.selected.concat([]),c,d;for(this._data.checkbox.selected=this._model.data[a.jstree.root].children_d.concat(),c=0,d=this._data.checkbox.selected.length;d>c;c++)this._model.data[this._data.checkbox.selected[c]]&&(this._model.data[this._data.checkbox.selected[c]].state.checked=!0);this.redraw(!0),this.trigger(\"check_all\",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var a=this._data.checkbox.selected.concat([]),b,c;for(b=0,c=this._data.checkbox.selected.length;c>b;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(\".jstree-checked\").removeClass(\"jstree-checked\"),this.trigger(\"uncheck_all\",{selected:this._data.checkbox.selected,node:a})},this.is_checked=function(b){return this.settings.checkbox.tie_selection?this.is_selected(b):(b=this.get_node(b),b&&b.id!==a.jstree.root?b.state.checked:!1)},this.get_checked=function(b){return this.settings.checkbox.tie_selection?this.get_selected(b):b?a.map(this._data.checkbox.selected,a.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected},this.get_top_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_top_selected(b);var c=this.get_checked(!0),d={},e,f,g,h;for(e=0,f=c.length;f>e;e++)d[c[e].id]=c[e];for(e=0,f=c.length;f>e;e++)for(g=0,h=c[e].children_d.length;h>g;g++)d[c[e].children_d[g]]&&delete d[c[e].children_d[g]];c=[];for(e in d)d.hasOwnProperty(e)&&c.push(e);return b?a.map(c,a.proxy(function(a){return this.get_node(a)},this)):c},this.get_bottom_checked=function(b){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(b);var c=this.get_checked(!0),d=[],e,f;for(e=0,f=c.length;f>e;e++)c[e].children.length||d.push(c[e].id);return b?a.map(d,a.proxy(function(a){return this.get_node(a)},this)):d},this.load_node=function(b,c){var e,f,g,h,i,j;if(!a.isArray(b)&&!this.settings.checkbox.tie_selection&&(j=this.get_node(b),j&&j.state.loaded))for(e=0,f=j.children_d.length;f>e;e++)this._model.data[j.children_d[e]].state.checked&&(i=!0,this._data.checkbox.selected=a.vakata.array_remove_item(this._data.checkbox.selected,j.children_d[e]));return d.load_node.apply(this,arguments)},this.get_state=function(){var a=d.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?a:(a.checkbox=this._data.checkbox.selected.slice(),a)},this.set_state=function(b,c){var e=d.set_state.apply(this,arguments);if(e&&b.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var f=this;a.each(b.checkbox,function(a,b){f.check_node(b)})}return delete b.checkbox,this.set_state(b,c),!1}return e},this.refresh=function(a,b){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),d.refresh.apply(this,arguments)}},a.jstree.defaults.conditionalselect=function(){return!0},a.jstree.plugins.conditionalselect=function(a,b){this.activate_node=function(a,c){this.settings.conditionalselect.call(this,this.get_node(a),c)&&b.activate_node.call(this,a,c)}},a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(b,c){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:\"Create\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.create_node(d,{},\"last\",function(a){setTimeout(function(){c.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:\"Rename\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.edit(d)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:\"Delete\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.delete_node(c.get_selected()):c.delete_node(d)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:\"Edit\",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:\"Cut\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.cut(c.get_top_selected()):c.cut(d)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:\"Copy\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.is_selected(d)?c.copy(c.get_top_selected()):c.copy(d)}},paste:{separator_before:!1,icon:!1,_disabled:function(b){return!a.jstree.reference(b.reference).can_paste()},separator_after:!1,label:\"Paste\",action:function(b){var c=a.jstree.reference(b.reference),d=c.get_node(b.reference);c.paste(d)}}}}}}},a.jstree.plugins.contextmenu=function(c,d){this.bind=function(){d.bind.call(this);var b=0,c=null,e,f;this.element.on(\"contextmenu.jstree\",\".jstree-anchor\",a.proxy(function(a,d){a.preventDefault(),b=a.ctrlKey?+new Date:0,(d||c)&&(b=+new Date+1e4),c&&clearTimeout(c),this.is_loading(a.currentTarget)||this.show_contextmenu(a.currentTarget,a.pageX,a.pageY,a)},this)).on(\"click.jstree\",\".jstree-anchor\",a.proxy(function(c){this._data.contextmenu.visible&&(!b||+new Date-b>250)&&a.vakata.context.hide(),b=0},this)).on(\"touchstart.jstree\",\".jstree-anchor\",function(b){b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(e=b.pageX,f=b.pageY,c=setTimeout(function(){a(b.currentTarget).trigger(\"contextmenu\",!0)},750))}).on(\"touchmove.vakata.jstree\",function(a){c&&a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(Math.abs(e-a.pageX)>50||Math.abs(f-a.pageY)>50)&&clearTimeout(c)}).on(\"touchend.vakata.jstree\",function(a){c&&clearTimeout(c)}),a(i).on(\"context_hide.vakata.jstree\",a.proxy(function(a,b){this._data.contextmenu.visible=!1,b.reference.removeClass(\"jstree-context\")},this))},this.teardown=function(){this._data.contextmenu.visible&&a.vakata.context.hide(),d.teardown.call(this)},this.show_contextmenu=function(c,d,e,f){if(c=this.get_node(c),!c||c.id===a.jstree.root)return!1;var g=this.settings.contextmenu,h=this.get_node(c,!0),i=h.children(\".jstree-anchor\"),j=!1,k=!1;(g.show_at_node||d===b||e===b)&&(j=i.offset(),d=j.left,e=j.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(c)&&this.activate_node(c,f),k=g.items,a.isFunction(k)&&(k=k.call(this,c,a.proxy(function(a){this._show_contextmenu(c,d,e,a)},this))),a.isPlainObject(k)&&this._show_contextmenu(c,d,e,k)},this._show_contextmenu=function(b,c,d,e){var f=this.get_node(b,!0),g=f.children(\".jstree-anchor\");a(i).one(\"context_show.vakata.jstree\",a.proxy(function(b,c){var d=\"jstree-contextmenu jstree-\"+this.get_theme()+\"-contextmenu\";a(c.element).addClass(d),g.addClass(\"jstree-context\")},this)),this._data.contextmenu.visible=!0,a.vakata.context.show(g,{x:c,y:d},e),this.trigger(\"show_contextmenu\",{node:b,x:c,y:d})}},function(a){var b=!1,c={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:\"\",is_visible:!1};a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(i).triggerHandler(\"context_\"+b+\".vakata\",{reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}})},_execute:function(b){return b=c.items[b],b&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:c.reference,element:c.element}))&&b.action?b.action.call(null,{item:b,reference:c.reference,element:c.element,position:{x:c.position_x,y:c.position_y}}):!1},_parse:function(b,d){if(!b)return!1;d||(c.html=\"\",c.items=[]);var e=\"\",f=!1,g;return d&&(e+=\"<ul>\"),a.each(b,function(b,d){return d?(c.items.push(d),!f&&d.separator_before&&(e+=\"<li class='vakata-context-separator'><a href='#' \"+(a.vakata.context.settings.icons?\"\":'style=\"margin-left:0px;\"')+\">&#160;</a></li>\"),f=!1,e+=\"<li class='\"+(d._class||\"\")+(d._disabled===!0||a.isFunction(d._disabled)&&d._disabled({item:d,reference:c.reference,element:c.element})?\" vakata-contextmenu-disabled \":\"\")+\"' \"+(d.shortcut?\" data-shortcut='\"+d.shortcut+\"' \":\"\")+\">\",e+=\"<a href='#' rel='\"+(c.items.length-1)+\"'>\",a.vakata.context.settings.icons&&(e+=\"<i \",d.icon&&(e+=-1!==d.icon.indexOf(\"/\")||-1!==d.icon.indexOf(\".\")?\" style='background:url(\\\"\"+d.icon+\"\\\") center center no-repeat' \":\" class='\"+d.icon+\"' \"),e+=\"></i><span class='vakata-contextmenu-sep'>&#160;</span>\"),e+=(a.isFunction(d.label)?d.label({item:b,reference:c.reference,element:c.element}):d.label)+(d.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+d.shortcut+'\">'+(d.shortcut_label||\"\")+\"</span>\":\"\")+\"</a>\",d.submenu&&(g=a.vakata.context._parse(d.submenu,!0),g&&(e+=g)),e+=\"</li>\",void(d.separator_after&&(e+=\"<li class='vakata-context-separator'><a href='#' \"+(a.vakata.context.settings.icons?\"\":'style=\"margin-left:0px;\"')+\">&#160;</a></li>\",f=!0))):!0}),e=e.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\"),d&&(e+=\"</ul>\"),d||(c.html=e,a.vakata.context._trigger(\"parse\")),e.length>10?e:!1},_show_submenu:function(c){if(c=a(c),c.length&&c.children(\"ul\").length){var d=c.children(\"ul\"),e=c.offset().left,f=e+c.outerWidth(),g=c.offset().top,h=d.width(),i=d.height(),j=a(window).width()+a(window).scrollLeft(),k=a(window).height()+a(window).scrollTop();b?c[f-(h+10+c.outerWidth())<0?\"addClass\":\"removeClass\"](\"vakata-context-left\"):c[f+h>j&&e>j-f?\"addClass\":\"removeClass\"](\"vakata-context-right\"),g+i+10>k&&d.css(\"bottom\",\"-1px\"),c.hasClass(\"vakata-context-right\")?h>e&&d.css(\"margin-right\",e-h):h>j-f&&d.css(\"margin-left\",j-f-h),d.show()}},show:function(d,e,f){var g,h,i,j,k,l,m,n,o=!0;switch(c.element&&c.element.length&&c.element.width(\"\"),o){case!e&&!d:return!1;case!!e&&!!d:c.reference=d,c.position_x=e.x,c.position_y=e.y;break;case!e&&!!d:c.reference=d,g=d.offset(),c.position_x=g.left+d.outerHeight(),c.position_y=g.top;break;case!!e&&!d:c.position_x=e.x,c.position_y=e.y}d&&!f&&a(d).data(\"vakata_contextmenu\")&&(f=a(d).data(\"vakata_contextmenu\")),a.vakata.context._parse(f)&&c.element.html(c.html),c.items.length&&(c.element.appendTo(\"body\"),h=c.element,i=c.position_x,j=c.position_y,k=h.width(),l=h.height(),m=a(window).width()+a(window).scrollLeft(),n=a(window).height()+a(window).scrollTop(),b&&(i-=h.outerWidth()-a(d).outerWidth(),i<a(window).scrollLeft()+20&&(i=a(window).scrollLeft()+20)),i+k+20>m&&(i=m-(k+20)),j+l+20>n&&(j=n-(l+20)),c.element.css({left:i,top:j}).show().find(\"a\").first().focus().parent().addClass(\"vakata-context-hover\"),c.is_visible=!0,a.vakata.context._trigger(\"show\"))},hide:function(){c.is_visible&&(c.element.hide().find(\"ul\").hide().end().find(\":focus\").blur().end().detach(),c.is_visible=!1,a.vakata.context._trigger(\"hide\"))}},a(function(){b=\"rtl\"===a(\"body\").css(\"direction\");var d=!1;c.element=a(\"<ul class='vakata-context'></ul>\"),c.element.on(\"mouseenter\",\"li\",function(b){b.stopImmediatePropagation(),a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.element.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end(),a(this).siblings().find(\"ul\").hide().end().end().parentsUntil(\".vakata-context\",\"li\").addBack().addClass(\"vakata-context-hover\"),a.vakata.context._show_submenu(this))}).on(\"mouseleave\",\"li\",function(b){a.contains(this,b.relatedTarget)||a(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\")}).on(\"mouseleave\",function(b){a(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\"),a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(b){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on(\"click\",\"a\",function(b){b.preventDefault(),a(this).blur().parent().hasClass(\"vakata-context-disabled\")||a.vakata.context._execute(a(this).attr(\"rel\"))===!1||a.vakata.context.hide()}).on(\"keydown\",\"a\",function(b){var d=null;switch(b.which){case 13:case 32:b.type=\"mouseup\",b.preventDefault(),a(b.currentTarget).trigger(b);break;case 37:c.is_visible&&(c.element.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:c.is_visible&&(d=c.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first(),d.length||(d=c.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last()),d.addClass(\"vakata-context-hover\").children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:c.is_visible&&(c.element.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:c.is_visible&&(d=c.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first(),d.length||(d=c.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first()),d.addClass(\"vakata-context-hover\").children(\"a\").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on(\"keydown\",function(a){a.preventDefault();var b=c.element.find(\".vakata-contextmenu-shortcut-\"+a.which).parent();b.parent().not(\".vakata-context-disabled\")&&b.click()}),a(i).on(\"mousedown.vakata.jstree\",function(b){c.is_visible&&!a.contains(c.element[0],b.target)&&a.vakata.context.hide();\n}).on(\"context_show.vakata.jstree\",function(a,d){c.element.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\"),b&&c.element.addClass(\"vakata-context-rtl\").css(\"direction\",\"rtl\"),c.element.find(\"ul\").hide().end()})})}(a),a.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var n,o;a.jstree.plugins.dnd=function(b,c){this.init=function(a,b){c.init.call(this,a,b),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&\"draggable\"in i.createElement(\"span\")},this.bind=function(){c.bind.call(this),this.element.on(this.settings.dnd.use_html5?\"dragstart.jstree\":\"mousedown.jstree touchstart.jstree\",this.settings.dnd.large_drag_target?\".jstree-node\":\".jstree-anchor\",a.proxy(function(b){if(this.settings.dnd.large_drag_target&&a(b.target).closest(\".jstree-node\")[0]!==b.currentTarget)return!0;if(\"touchstart\"===b.type&&(!this.settings.dnd.touch||\"selected\"===this.settings.dnd.touch&&!a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").hasClass(\"jstree-clicked\")))return!0;var c=this.get_node(b.target),d=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,e=d>1?d+\" \"+this.get_string(\"nodes\"):this.get_text(b.currentTarget);if(this.settings.core.force_text&&(e=a.vakata.html.escape(e)),c&&c.id&&c.id!==a.jstree.root&&(1===b.which||\"touchstart\"===b.type||\"dragstart\"===b.type)&&(this.settings.dnd.is_draggable===!0||a.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,d>1?this.get_top_selected(!0):[c],b))){if(n={jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:d>1?this.get_top_selected():[c.id]},o=b.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger(\"mousedown.jstree\"),a.vakata.dnd.start(b,n,'<div id=\"jstree-dnd\" class=\"jstree-'+this.get_theme()+\" jstree-\"+this.get_theme()+\"-\"+this.get_theme_variant()+\" \"+(this.settings.core.themes.responsive?\" jstree-dnd-responsive\":\"\")+'\"><i class=\"jstree-icon jstree-er\"></i>'+e+'<ins class=\"jstree-copy\" style=\"display:none;\">+</ins></div>');a.vakata.dnd._trigger(\"start\",b,{helper:a(),element:o,data:n})}},this)),this.settings.dnd.use_html5&&this.element.on(\"dragover.jstree\",function(b){return b.preventDefault(),a.vakata.dnd._trigger(\"move\",b,{helper:a(),element:o,data:n}),!1}).on(\"drop.jstree\",a.proxy(function(b){return b.preventDefault(),a.vakata.dnd._trigger(\"stop\",b,{helper:a(),element:o,data:n}),!1},this))},this.redraw_node=function(a,b,d,e){if(a=c.redraw_node.apply(this,arguments),a&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)a.setAttribute(\"draggable\",!0);else{var f,g,h=null;for(f=0,g=a.childNodes.length;g>f;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf(\"jstree-anchor\")){h=a.childNodes[f];break}h&&h.setAttribute(\"draggable\",!0)}return a}},a(function(){var c=!1,d=!1,e=!1,f=!1,g=a('<div id=\"jstree-marker\">&#160;</div>').hide();a(i).on(\"dnd_start.vakata.jstree\",function(a,b){c=!1,e=!1,b&&b.data&&b.data.jstree&&g.appendTo(\"body\")}).on(\"dnd_move.vakata.jstree\",function(h,i){if(f&&(i.event&&\"dragover\"===i.event.type&&i.event.target===e.target||clearTimeout(f)),i&&i.data&&i.data.jstree&&(!i.event.target.id||\"jstree-marker\"!==i.event.target.id)){e=i.event;var j=a.jstree.reference(i.event.target),k=!1,l=!1,m=!1,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(j&&j._data&&j._data.dnd)if(g.attr(\"class\",\"jstree-\"+j.get_theme()+(j.settings.core.themes.responsive?\" jstree-dnd-responsive\":\"\")),C=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey)),i.helper.children().attr(\"class\",\"jstree-\"+j.get_theme()+\" jstree-\"+j.get_theme()+\"-\"+j.get_theme_variant()+\" \"+(j.settings.core.themes.responsive?\" jstree-dnd-responsive\":\"\")).find(\".jstree-copy\").first()[C?\"show\":\"hide\"](),i.event.target!==j.element[0]&&i.event.target!==j.get_container_ul()[0]||0!==j.get_container_ul().children().length){if(k=j.settings.dnd.large_drop_target?a(i.event.target).closest(\".jstree-node\").children(\".jstree-anchor\"):a(i.event.target).closest(\".jstree-anchor\"),k&&k.length&&k.parent().is(\".jstree-closed, .jstree-open, .jstree-leaf\")&&(l=k.offset(),m=(i.event.pageY!==b?i.event.pageY:i.event.originalEvent.pageY)-l.top,q=k.outerHeight(),t=q/3>m?[\"b\",\"i\",\"a\"]:m>q-q/3?[\"a\",\"i\",\"b\"]:m>q/2?[\"i\",\"a\",\"b\"]:[\"i\",\"b\",\"a\"],a.each(t,function(b,e){switch(e){case\"b\":o=l.left-6,p=l.top,r=j.get_parent(k),s=k.parent().index();break;case\"i\":A=j.settings.dnd.inside_pos,B=j.get_node(k.parent()),o=l.left-2,p=l.top+q/2+1,r=B.id,s=\"first\"===A?0:\"last\"===A?B.children.length:Math.min(A,B.children.length);break;case\"a\":o=l.left-6,p=l.top+q,r=j.get_parent(k),s=k.parent().index()+1}for(u=!0,v=0,w=i.data.nodes.length;w>v;v++)if(x=i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?\"copy_node\":\"move_node\",y=s,\"move_node\"===x&&\"a\"===e&&i.data.origin&&i.data.origin===j&&r===j.get_parent(i.data.nodes[v])&&(z=j.get_node(r),y>a.inArray(i.data.nodes[v],z.children)&&(y-=1)),u=u&&(j&&j.settings&&j.settings.dnd&&j.settings.dnd.check_while_dragging===!1||j.check(x,i.data.origin&&i.data.origin!==j?i.data.origin.get_node(i.data.nodes[v]):i.data.nodes[v],r,y,{dnd:!0,ref:j.get_node(k.parent()),pos:e,origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==j,is_foreign:!i.data.origin})),!u){j&&j.last_error&&(d=j.last_error());break}return\"i\"===e&&k.parent().is(\".jstree-closed\")&&j.settings.dnd.open_timeout&&(f=setTimeout(function(a,b){return function(){a.open_node(b)}}(j,k),j.settings.dnd.open_timeout)),u?(c={ins:j,par:r,pos:\"i\"!==e||\"last\"!==A||0!==s||j.is_loaded(B)?s:\"last\"},g.css({left:o+\"px\",top:p+\"px\"}).show(),i.helper.find(\".jstree-icon\").first().removeClass(\"jstree-er\").addClass(\"jstree-ok\"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=C?\"copy\":\"move\"),d={},t=!0,!1):void 0}),t===!0))return}else{for(u=!0,v=0,w=i.data.nodes.length;w>v;v++)if(u=u&&j.check(i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?\"copy_node\":\"move_node\",i.data.origin&&i.data.origin!==j?i.data.origin.get_node(i.data.nodes[v]):i.data.nodes[v],a.jstree.root,\"last\",{dnd:!0,ref:j.get_node(a.jstree.root),pos:\"i\",origin:i.data.origin,is_multi:i.data.origin&&i.data.origin!==j,is_foreign:!i.data.origin}),!u)break;if(u)return c={ins:j,par:a.jstree.root,pos:\"last\"},g.hide(),i.helper.find(\".jstree-icon\").first().removeClass(\"jstree-er\").addClass(\"jstree-ok\"),void(i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=C?\"copy\":\"move\"))}c=!1,i.helper.find(\".jstree-icon\").removeClass(\"jstree-ok\").addClass(\"jstree-er\"),i.event.originalEvent&&i.event.originalEvent.dataTransfer&&(i.event.originalEvent.dataTransfer.dropEffect=\"none\"),g.hide()}}).on(\"dnd_scroll.vakata.jstree\",function(a,b){b&&b.data&&b.data.jstree&&(g.hide(),c=!1,e=!1,b.helper.find(\".jstree-icon\").first().removeClass(\"jstree-ok\").addClass(\"jstree-er\"))}).on(\"dnd_stop.vakata.jstree\",function(b,h){if(f&&clearTimeout(f),h&&h.data&&h.data.jstree){g.hide().detach();var i,j,k=[];if(c){for(i=0,j=h.data.nodes.length;j>i;i++)k[i]=h.data.origin?h.data.origin.get_node(h.data.nodes[i]):h.data.nodes[i];c.ins[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey))?\"copy_node\":\"move_node\"](k,c.par,c.pos,!1,!1,!1,h.data.origin)}else i=a(h.event.target).closest(\".jstree\"),i.length&&d&&d.error&&\"check\"===d.error&&(i=i.jstree(!0),i&&i.settings.core.error.call(this,d));e=!1,c=!1}}).on(\"keyup.jstree keydown.jstree\",function(b,h){h=a.vakata.dnd._get(),h&&h.data&&h.data.jstree&&(\"keyup\"===b.type&&27===b.which?(f&&clearTimeout(f),c=!1,d=!1,e=!1,f=!1,g.hide().detach(),a.vakata.dnd._clean()):(h.helper.find(\".jstree-copy\").first()[h.data.origin&&(h.data.origin.settings.dnd.always_copy||h.data.origin.settings.dnd.copy&&(b.metaKey||b.ctrlKey))?\"show\":\"hide\"](),e&&(e.metaKey=b.metaKey,e.ctrlKey=b.ctrlKey,a.vakata.dnd._trigger(\"move\",e))))})}),function(a){a.vakata.html={div:a(\"<div />\"),escape:function(b){return a.vakata.html.div.text(b).html()},strip:function(b){return a.vakata.html.div.empty().append(a.parseHTML(b)).text()}};var c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(c,d,e){e===b&&(e=a.vakata.dnd._get()),e.event=d,a(i).triggerHandler(\"dnd_\"+c+\".vakata\",e)},_get:function(){return{data:c.data,element:c.element,helper:c.helper}},_clean:function(){c.helper&&c.helper.remove(),c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),c={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},a(i).off(\"mousemove.vakata.jstree touchmove.vakata.jstree\",a.vakata.dnd.drag),a(i).off(\"mouseup.vakata.jstree touchend.vakata.jstree\",a.vakata.dnd.stop)},_scroll:function(b){if(!c.scroll_e||!c.scroll_l&&!c.scroll_t)return c.scroll_i&&(clearInterval(c.scroll_i),c.scroll_i=!1),!1;if(!c.scroll_i)return c.scroll_i=setInterval(a.vakata.dnd._scroll,100),!1;if(b===!0)return!1;var d=c.scroll_e.scrollTop(),e=c.scroll_e.scrollLeft();c.scroll_e.scrollTop(d+c.scroll_t*a.vakata.dnd.settings.scroll_speed),c.scroll_e.scrollLeft(e+c.scroll_l*a.vakata.dnd.settings.scroll_speed),d===c.scroll_e.scrollTop()&&e===c.scroll_e.scrollLeft()||a.vakata.dnd._trigger(\"scroll\",c.scroll_e)},start:function(b,d,e){\"touchstart\"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag&&a.vakata.dnd.stop({});try{b.currentTarget.unselectable=\"on\",b.currentTarget.onselectstart=function(){return!1},b.currentTarget.style&&(b.currentTarget.style.touchAction=\"none\",b.currentTarget.style.msTouchAction=\"none\",b.currentTarget.style.MozUserSelect=\"none\")}catch(f){}return c.init_x=b.pageX,c.init_y=b.pageY,c.data=d,c.is_down=!0,c.element=b.currentTarget,c.target=b.target,c.is_touch=\"touchstart\"===b.type,e!==!1&&(c.helper=a(\"<div id='vakata-dnd'></div>\").html(e).css({display:\"block\",margin:\"0\",padding:\"0\",position:\"absolute\",top:\"-2000px\",lineHeight:\"16px\",zIndex:\"10000\"})),a(i).on(\"mousemove.vakata.jstree touchmove.vakata.jstree\",a.vakata.dnd.drag),a(i).on(\"mouseup.vakata.jstree touchend.vakata.jstree\",a.vakata.dnd.stop),!1},drag:function(b){if(\"touchmove\"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_down){if(!c.is_drag){if(!(Math.abs(b.pageX-c.init_x)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-c.init_y)>(c.is_touch?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)))return;c.helper&&(c.helper.appendTo(\"body\"),c.helper_w=c.helper.outerWidth()),c.is_drag=!0,a.vakata.dnd._trigger(\"start\",b)}var d=!1,e=!1,f=!1,g=!1,h=!1,j=!1,k=!1,l=!1,m=!1,n=!1;return c.scroll_t=0,c.scroll_l=0,c.scroll_e=!1,a(a(b.target).parentsUntil(\"body\").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css(\"overflow\"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var d=a(this),e=d.offset();return this.scrollHeight>this.offsetHeight&&(e.top+d.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),b.pageY-e.top<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(e.left+d.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),b.pageX-e.left<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1)),c.scroll_t||c.scroll_l?(c.scroll_e=a(this),!1):void 0}),c.scroll_e||(d=a(i),e=a(window),f=d.height(),g=e.height(),h=d.width(),j=e.width(),k=d.scrollTop(),l=d.scrollLeft(),f>g&&b.pageY-k<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=-1),f>g&&g-(b.pageY-k)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_t=1),h>j&&b.pageX-l<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=-1),h>j&&j-(b.pageX-l)<a.vakata.dnd.settings.scroll_proximity&&(c.scroll_l=1),(c.scroll_t||c.scroll_l)&&(c.scroll_e=d)),c.scroll_e&&a.vakata.dnd._scroll(!0),c.helper&&(m=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),n=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),f&&m+25>f&&(m=f-50),h&&n+c.helper_w>h&&(n=h-(c.helper_w+2)),c.helper.css({left:n+\"px\",top:m+\"px\"})),a.vakata.dnd._trigger(\"move\",b),!1}},stop:function(b){if(\"touchend\"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=i.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset)),c.is_drag)a.vakata.dnd._trigger(\"stop\",b);else if(\"touchend\"===b.type&&b.target===c.target){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one(\"click\",function(){d&&clearTimeout(d)})}return a.vakata.dnd._clean(),!1}}}(a),a.jstree.defaults.massload=null,a.jstree.plugins.massload=function(b,c){this.init=function(a,b){this._data.massload={},c.init.call(this,a,b)},this._load_nodes=function(b,d,e,f){var g=this.settings.massload,h=JSON.stringify(b),i=[],j=this._model.data,k,l,m;if(!e){for(k=0,l=b.length;l>k;k++)j[b[k]]&&(j[b[k]].state.loaded||j[b[k]].state.failed)&&!f||(i.push(b[k]),m=this.get_node(b[k],!0),m&&m.length&&m.addClass(\"jstree-loading\").attr(\"aria-busy\",!0));if(this._data.massload={},i.length){if(a.isFunction(g))return g.call(this,i,a.proxy(function(a){var g,h;if(a)for(g in a)a.hasOwnProperty(g)&&(this._data.massload[g]=a[g]);for(g=0,h=b.length;h>g;g++)m=this.get_node(b[g],!0),m&&m.length&&m.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1);c._load_nodes.call(this,b,d,e,f)},this));if(\"object\"==typeof g&&g&&g.url)return g=a.extend(!0,{},g),a.isFunction(g.url)&&(g.url=g.url.call(this,i)),a.isFunction(g.data)&&(g.data=g.data.call(this,i)),a.ajax(g).done(a.proxy(function(a,g,h){var i,j;if(a)for(i in a)a.hasOwnProperty(i)&&(this._data.massload[i]=a[i]);for(i=0,j=b.length;j>i;i++)m=this.get_node(b[i],!0),m&&m.length&&m.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1);c._load_nodes.call(this,b,d,e,f)},this)).fail(a.proxy(function(a){c._load_nodes.call(this,b,d,e,f)},this))}}return c._load_nodes.call(this,b,d,e,f)},this._load_node=function(b,d){var e=this._data.massload[b.id],f=null,g;return e?(f=this[\"string\"==typeof e?\"_append_html_data\":\"_append_json_data\"](b,\"string\"==typeof e?a(a.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(a){d.call(this,a)}),g=this.get_node(b.id,!0),g&&g.length&&g.removeClass(\"jstree-loading\").attr(\"aria-busy\",!1),delete this._data.massload[b.id],f):c._load_node.call(this,b,d)}},a.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},a.jstree.plugins.search=function(c,d){this.bind=function(){d.bind.call(this),this._data.search.str=\"\",this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on(\"search.jstree\",a.proxy(function(b,c){if(this._data.search.som&&c.res.length){var d=this._model.data,e,f,g=[],h,i;for(e=0,f=c.res.length;f>e;e++)if(d[c.res[e]]&&!d[c.res[e]].state.hidden&&(g.push(c.res[e]),g=g.concat(d[c.res[e]].parents),this._data.search.smc))for(h=0,i=d[c.res[e]].children_d.length;i>h;h++)d[d[c.res[e]].children_d[h]]&&!d[d[c.res[e]].children_d[h]].state.hidden&&g.push(d[c.res[e]].children_d[h]);g=a.vakata.array_remove_item(a.vakata.array_unique(g),a.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(g,!0),this.redraw(!0)}},this)).on(\"clear_search.jstree\",a.proxy(function(a,b){this._data.search.som&&b.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(c,d,e,f,g,h){if(c===!1||\"\"===a.trim(c.toString()))return this.clear_search();f=this.get_node(f),f=f&&f.id?f.id:null,c=c.toString();var i=this.settings.search,j=i.ajax?i.ajax:!1,k=this._model.data,l=null,m=[],n=[],o,p;if(this._data.search.res.length&&!g&&this.clear_search(),e===b&&(e=i.show_only_matches),h===b&&(h=i.show_only_matches_children),!d&&j!==!1)return a.isFunction(j)?j.call(this,c,a.proxy(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.isArray(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g)})},this),f):(j=a.extend({},j),j.data||(j.data={}),j.data.str=c,f&&(j.data.inside=f),a.ajax(j).fail(a.proxy(function(){this._data.core.last_error={error:\"ajax\",plugin:\"search\",id:\"search_01\",reason:\"Could not load search parents\",data:JSON.stringify(j)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(a.proxy(function(b){b&&b.d&&(b=b.d),this._load_nodes(a.isArray(b)?a.vakata.array_unique(b):[],function(){this.search(c,!0,e,f,g)})},this)));if(g||(this._data.search.str=c,this._data.search.dom=a(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=e,this._data.search.smc=h),l=new a.vakata.search(c,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),a.each(k[f?f:a.jstree.root].children_d,function(a,b){var d=k[b];d.text&&!d.state.hidden&&(!i.search_leaves_only||d.state.loaded&&0===d.children.length)&&(i.search_callback&&i.search_callback.call(this,c,d)||!i.search_callback&&l.search(d.text).isMatch)&&(m.push(b),n=n.concat(d.parents))}),m.length){for(n=a.vakata.array_unique(n),o=0,p=n.length;p>o;o++)n[o]!==a.jstree.root&&k[n[o]]&&this.open_node(n[o],null,0)===!0&&this._data.search.opn.push(n[o]);g?(this._data.search.dom=this._data.search.dom.add(a(this.element[0].querySelectorAll(\"#\"+a.map(m,function(b){return-1!==\"0123456789\".indexOf(b[0])?\"\\\\3\"+b[0]+\" \"+b.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):b.replace(a.jstree.idregex,\"\\\\$&\")}).join(\", #\")))),this._data.search.res=a.vakata.array_unique(this._data.search.res.concat(m))):(this._data.search.dom=a(this.element[0].querySelectorAll(\"#\"+a.map(m,function(b){return-1!==\"0123456789\".indexOf(b[0])?\"\\\\3\"+b[0]+\" \"+b.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):b.replace(a.jstree.idregex,\"\\\\$&\")}).join(\", #\"))),this._data.search.res=m),this._data.search.dom.children(\".jstree-anchor\").addClass(\"jstree-search\")}this.trigger(\"search\",{nodes:this._data.search.dom,str:c,res:this._data.search.res,show_only_matches:e})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger(\"clear_search\",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=a(this.element[0].querySelectorAll(\"#\"+a.map(this._data.search.res,function(b){return-1!==\"0123456789\".indexOf(b[0])?\"\\\\3\"+b[0]+\" \"+b.substr(1).replace(a.jstree.idregex,\"\\\\$&\"):b.replace(a.jstree.idregex,\"\\\\$&\")}).join(\", #\"))),this._data.search.dom.children(\".jstree-anchor\").removeClass(\"jstree-search\")),this._data.search.str=\"\",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=a()},this.redraw_node=function(b,c,e,f){if(b=d.redraw_node.apply(this,arguments),b&&-1!==a.inArray(b.id,this._data.search.res)){var g,h,i=null;for(g=0,h=b.childNodes.length;h>g;g++)if(b.childNodes[g]&&b.childNodes[g].className&&-1!==b.childNodes[g].className.indexOf(\"jstree-anchor\")){i=b.childNodes[g];break}i&&(i.className+=\" jstree-search\")}return b}},function(a){a.vakata.search=function(b,c,d){d=d||{},d=a.extend({},a.vakata.search.defaults,d),d.fuzzy!==!1&&(d.fuzzy=!0),b=d.caseSensitive?b:b.toLowerCase();var e=d.location,f=d.distance,g=d.threshold,h=b.length,i,j,k,l;return h>32&&(d.fuzzy=!1),d.fuzzy&&(i=1<<h-1,j=function(){var a={},c=0;for(c=0;h>c;c++)a[b.charAt(c)]=0;for(c=0;h>c;c++)a[b.charAt(c)]|=1<<h-c-1;return a}(),k=function(a,b){var c=a/h,d=Math.abs(e-b);return f?c+d/f:d?1:c}),l=function(a){if(a=d.caseSensitive?a:a.toLowerCase(),b===a||-1!==a.indexOf(b))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var c,f,l=a.length,m=g,n=a.indexOf(b,e),o,p,q=h+l,r,s,t,u,v,w=1,x=[];for(-1!==n&&(m=Math.min(k(0,n),m),n=a.lastIndexOf(b,e+h),-1!==n&&(m=Math.min(k(0,n),m))),n=-1,c=0;h>c;c++){o=0,p=q;while(p>o)k(c,e+p)<=m?o=p:q=p,p=Math.floor((q-o)/2+o);for(q=p,s=Math.max(1,e-p+1),t=Math.min(e+p,l)+h,u=new Array(t+2),u[t+1]=(1<<c)-1,f=t;f>=s;f--)if(v=j[a.charAt(f-1)],0===c?u[f]=(u[f+1]<<1|1)&v:u[f]=(u[f+1]<<1|1)&v|((r[f+1]|r[f])<<1|1)|r[f+1],u[f]&i&&(w=k(c,f-1),m>=w)){if(m=w,n=f-1,x.push(n),!(n>e))break;s=Math.max(1,2*e-n)}if(k(c+1,e)>m)break;r=u}return{isMatch:n>=0,score:w}},c===!0?{search:l}:l(c)},a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(a),a.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},a.jstree.plugins.sort=function(b,c){this.bind=function(){c.bind.call(this),this.element.on(\"model.jstree\",a.proxy(function(a,b){this.sort(b.parent,!0)},this)).on(\"rename_node.jstree create_node.jstree\",a.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1),this.redraw_node(b.parent||b.node.parent,!0)},this)).on(\"move_node.jstree copy_node.jstree\",a.proxy(function(a,b){this.sort(b.parent,!1),this.redraw_node(b.parent,!0)},this))},this.sort=function(b,c){var d,e;if(b=this.get_node(b),b&&b.children&&b.children.length&&(b.children.sort(a.proxy(this.settings.sort,this)),c))for(d=0,e=b.children_d.length;e>d;d++)this.sort(b.children_d[d],!1)}};var p=!1;a.jstree.defaults.state={key:\"jstree\",events:\"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree\",ttl:!1,filter:!1},a.jstree.plugins.state=function(b,c){this.bind=function(){c.bind.call(this);var b=a.proxy(function(){this.element.on(this.settings.state.events,a.proxy(function(){p&&clearTimeout(p),p=setTimeout(a.proxy(function(){this.save_state()},this),100)},this)),this.trigger(\"state_ready\")},this);this.element.on(\"ready.jstree\",a.proxy(function(a,c){this.element.one(\"restore_state.jstree\",b),this.restore_state()||b()},this))},this.save_state=function(){var b={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};a.vakata.storage.set(this.settings.state.key,JSON.stringify(b))},this.restore_state=function(){var b=a.vakata.storage.get(this.settings.state.key);if(b)try{b=JSON.parse(b)}catch(c){return!1}return b&&b.ttl&&b.sec&&+new Date-b.sec>b.ttl?!1:(b&&b.state&&(b=b.state),b&&a.isFunction(this.settings.state.filter)&&(b=this.settings.state.filter.call(this,b)),b?(this.element.one(\"set_state.jstree\",function(c,d){d.instance.trigger(\"restore_state\",{state:a.extend(!0,{},b)})}),this.set_state(b),!0):!1)},this.clear_state=function(){return a.vakata.storage.del(this.settings.state.key)}},function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}}(a),a.jstree.defaults.types={\"default\":{}},a.jstree.defaults.types[a.jstree.root]={},a.jstree.plugins.types=function(c,d){this.init=function(c,e){var f,g;if(e&&e.types&&e.types[\"default\"])for(f in e.types)if(\"default\"!==f&&f!==a.jstree.root&&e.types.hasOwnProperty(f))for(g in e.types[\"default\"])e.types[\"default\"].hasOwnProperty(g)&&e.types[f][g]===b&&(e.types[f][g]=e.types[\"default\"][g]);d.init.call(this,c,e),this._model.data[a.jstree.root].type=a.jstree.root},this.refresh=function(b,c){d.refresh.call(this,b,c),this._model.data[a.jstree.root].type=a.jstree.root},this.bind=function(){this.element.on(\"model.jstree\",a.proxy(function(c,d){var e=this._model.data,f=d.nodes,g=this.settings.types,h,i,j=\"default\",k;for(h=0,i=f.length;i>h;h++){if(j=\"default\",e[f[h]].original&&e[f[h]].original.type&&g[e[f[h]].original.type]&&(j=e[f[h]].original.type),e[f[h]].data&&e[f[h]].data.jstree&&e[f[h]].data.jstree.type&&g[e[f[h]].data.jstree.type]&&(j=e[f[h]].data.jstree.type),e[f[h]].type=j,e[f[h]].icon===!0&&g[j].icon!==b&&(e[f[h]].icon=g[j].icon),g[j].li_attr!==b&&\"object\"==typeof g[j].li_attr)for(k in g[j].li_attr)if(g[j].li_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[f[h]].li_attr[k]===b?e[f[h]].li_attr[k]=g[j].li_attr[k]:\"class\"===k&&(e[f[h]].li_attr[\"class\"]=g[j].li_attr[\"class\"]+\" \"+e[f[h]].li_attr[\"class\"])}if(g[j].a_attr!==b&&\"object\"==typeof g[j].a_attr)for(k in g[j].a_attr)if(g[j].a_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[f[h]].a_attr[k]===b?e[f[h]].a_attr[k]=g[j].a_attr[k]:\"href\"===k&&\"#\"===e[f[h]].a_attr[k]?e[f[h]].a_attr.href=g[j].a_attr.href:\"class\"===k&&(e[f[h]].a_attr[\"class\"]=g[j].a_attr[\"class\"]+\" \"+e[f[h]].a_attr[\"class\"])}}e[a.jstree.root].type=a.jstree.root},this)),d.bind.call(this)},this.get_json=function(b,c,e){var f,g,h=this._model.data,i=c?a.extend(!0,{},c,{no_id:!1}):{},j=d.get_json.call(this,b,i,e);if(j===!1)return!1;if(a.isArray(j))for(f=0,g=j.length;g>f;f++)j[f].type=j[f].id&&h[j[f].id]&&h[j[f].id].type?h[j[f].id].type:\"default\",c&&c.no_id&&(delete j[f].id,j[f].li_attr&&j[f].li_attr.id&&delete j[f].li_attr.id,j[f].a_attr&&j[f].a_attr.id&&delete j[f].a_attr.id);else j.type=j.id&&h[j.id]&&h[j.id].type?h[j.id].type:\"default\",c&&c.no_id&&(j=this._delete_ids(j));return j},this._delete_ids=function(b){if(a.isArray(b)){for(var c=0,d=b.length;d>c;c++)b[c]=this._delete_ids(b[c]);return b}return delete b.id,b.li_attr&&b.li_attr.id&&delete b.li_attr.id,b.a_attr&&b.a_attr.id&&delete b.a_attr.id,b.children&&a.isArray(b.children)&&(b.children=this._delete_ids(b.children)),b},this.check=function(c,e,f,g,h){if(d.check.call(this,c,e,f,g,h)===!1)return!1;e=e&&e.id?e:this.get_node(e),f=f&&f.id?f:this.get_node(f);var i=e&&e.id?h&&h.origin?h.origin:a.jstree.reference(e.id):null,j,k,l,m;switch(i=i&&i._model&&i._model.data?i._model.data:null,c){case\"create_node\":case\"move_node\":case\"copy_node\":if(\"move_node\"!==c||-1===a.inArray(e.id,f.children)){if(j=this.get_rules(f),j.max_children!==b&&-1!==j.max_children&&j.max_children===f.children.length)return this._data.core.last_error={error:\"check\",plugin:\"types\",id:\"types_01\",reason:\"max_children prevents function: \"+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(j.valid_children!==b&&-1!==j.valid_children&&-1===a.inArray(e.type||\"default\",j.valid_children))return this._data.core.last_error={error:\"check\",plugin:\"types\",id:\"types_02\",reason:\"valid_children prevents function: \"+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;if(i&&e.children_d&&e.parents){for(k=0,l=0,m=e.children_d.length;m>l;l++)k=Math.max(k,i[e.children_d[l]].parents.length);k=k-e.parents.length+1}(0>=k||k===b)&&(k=1);do{if(j.max_depth!==b&&-1!==j.max_depth&&j.max_depth<k)return this._data.core.last_error={error:\"check\",plugin:\"types\",id:\"types_03\",reason:\"max_depth prevents function: \"+c,data:JSON.stringify({chk:c,pos:g,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent),j=this.get_rules(f),k++}while(f)}}return!0},this.get_rules=function(a){if(a=this.get_node(a),!a)return!1;var c=this.get_type(a,!0);return c.max_depth===b&&(c.max_depth=-1),c.max_children===b&&(c.max_children=-1),c.valid_children===b&&(c.valid_children=-1),c},this.get_type=function(b,c){return b=this.get_node(b),b?c?a.extend({type:b.type},this.settings.types[b.type]):b.type:!1},this.set_type=function(c,d){var e=this._model.data,f,g,h,i,j,k,l,m;if(a.isArray(c)){for(c=c.slice(),g=0,h=c.length;h>g;g++)this.set_type(c[g],d);return!0}if(f=this.settings.types,c=this.get_node(c),!f[d]||!c)return!1;if(l=this.get_node(c,!0),l&&l.length&&(m=l.children(\".jstree-anchor\")),i=c.type,j=this.get_icon(c),c.type=d,(j===!0||f[i]&&f[i].icon!==b&&j===f[i].icon)&&this.set_icon(c,f[d].icon!==b?f[d].icon:!0),f[i].li_attr!==b&&\"object\"==typeof f[i].li_attr)for(k in f[i].li_attr)if(f[i].li_attr.hasOwnProperty(k)){if(\"id\"===k)continue;\"class\"===k?(e[c.id].li_attr[\"class\"]=(e[c.id].li_attr[\"class\"]||\"\").replace(f[i].li_attr[k],\"\"),l&&l.removeClass(f[i].li_attr[k])):e[c.id].li_attr[k]===f[i].li_attr[k]&&(e[c.id].li_attr[k]=null,l&&l.removeAttr(k))}if(f[i].a_attr!==b&&\"object\"==typeof f[i].a_attr)for(k in f[i].a_attr)if(f[i].a_attr.hasOwnProperty(k)){if(\"id\"===k)continue;\"class\"===k?(e[c.id].a_attr[\"class\"]=(e[c.id].a_attr[\"class\"]||\"\").replace(f[i].a_attr[k],\"\"),m&&m.removeClass(f[i].a_attr[k])):e[c.id].a_attr[k]===f[i].a_attr[k]&&(\"href\"===k?(e[c.id].a_attr[k]=\"#\",m&&m.attr(\"href\",\"#\")):(delete e[c.id].a_attr[k],m&&m.removeAttr(k)))}if(f[d].li_attr!==b&&\"object\"==typeof f[d].li_attr)for(k in f[d].li_attr)if(f[d].li_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[c.id].li_attr[k]===b?(e[c.id].li_attr[k]=f[d].li_attr[k],l&&(\"class\"===k?l.addClass(f[d].li_attr[k]):l.attr(k,f[d].li_attr[k]))):\"class\"===k&&(e[c.id].li_attr[\"class\"]=f[d].li_attr[k]+\" \"+e[c.id].li_attr[\"class\"],l&&l.addClass(f[d].li_attr[k]))}if(f[d].a_attr!==b&&\"object\"==typeof f[d].a_attr)for(k in f[d].a_attr)if(f[d].a_attr.hasOwnProperty(k)){if(\"id\"===k)continue;e[c.id].a_attr[k]===b?(e[c.id].a_attr[k]=f[d].a_attr[k],m&&(\"class\"===k?m.addClass(f[d].a_attr[k]):m.attr(k,f[d].a_attr[k]))):\"href\"===k&&\"#\"===e[c.id].a_attr[k]?(e[c.id].a_attr.href=f[d].a_attr.href,m&&m.attr(\"href\",f[d].a_attr.href)):\"class\"===k&&(e[c.id].a_attr[\"class\"]=f[d].a_attr[\"class\"]+\" \"+e[c.id].a_attr[\"class\"],m&&m.addClass(f[d].a_attr[k]))}return!0}},a.jstree.defaults.unique={case_sensitive:!1,duplicate:function(a,b){return a+\" (\"+b+\")\"}},a.jstree.plugins.unique=function(c,d){this.check=function(b,c,e,f,g){if(d.check.call(this,b,c,e,f,g)===!1)return!1;if(c=c&&c.id?c:this.get_node(c),e=e&&e.id?e:this.get_node(e),!e||!e.children)return!0;var h=\"rename_node\"===b?f:c.text,i=[],j=this.settings.unique.case_sensitive,k=this._model.data,l,m;for(l=0,m=e.children.length;m>l;l++)i.push(j?k[e.children[l]].text:k[e.children[l]].text.toLowerCase());switch(j||(h=h.toLowerCase()),b){case\"delete_node\":return!0;case\"rename_node\":return l=-1===a.inArray(h,i)||c.text&&c.text[j?\"toString\":\"toLowerCase\"]()===h,l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_01\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l;case\"create_node\":return l=-1===a.inArray(h,i),l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_04\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l;case\"copy_node\":return l=-1===a.inArray(h,i),l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_02\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l;case\"move_node\":return l=c.parent===e.id&&(!g||!g.is_multi)||-1===a.inArray(h,i),l||(this._data.core.last_error={error:\"check\",plugin:\"unique\",id:\"unique_03\",reason:\"Child with name \"+h+\" already exists. Preventing: \"+b,data:JSON.stringify({chk:b,pos:f,obj:c&&c.id?c.id:!1,par:e&&e.id?e.id:!1})}),l}return!0},this.create_node=function(c,e,f,g,h){if(!e||e.text===b){if(null===c&&(c=a.jstree.root),c=this.get_node(c),!c)return d.create_node.call(this,c,e,f,g,h);if(f=f===b?\"last\":f,!f.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(c))return d.create_node.call(this,c,e,f,g,h);\ne||(e={});var i,j,k,l,m,n=this._model.data,o=this.settings.unique.case_sensitive,p=this.settings.unique.duplicate;for(j=i=this.get_string(\"New node\"),k=[],l=0,m=c.children.length;m>l;l++)k.push(o?n[c.children[l]].text:n[c.children[l]].text.toLowerCase());l=1;while(-1!==a.inArray(o?j:j.toLowerCase(),k))j=p.call(this,i,++l).toString();e.text=j}return d.create_node.call(this,c,e,f,g,h)}};var q=i.createElement(\"DIV\");if(q.setAttribute(\"unselectable\",\"on\"),q.setAttribute(\"role\",\"presentation\"),q.className=\"jstree-wholerow\",q.innerHTML=\"&#160;\",a.jstree.plugins.wholerow=function(b,c){this.bind=function(){c.bind.call(this),this.element.on(\"ready.jstree set_state.jstree\",a.proxy(function(){this.hide_dots()},this)).on(\"init.jstree loading.jstree ready.jstree\",a.proxy(function(){this.get_container_ul().addClass(\"jstree-wholerow-ul\")},this)).on(\"deselect_all.jstree\",a.proxy(function(a,b){this.element.find(\".jstree-wholerow-clicked\").removeClass(\"jstree-wholerow-clicked\")},this)).on(\"changed.jstree\",a.proxy(function(a,b){this.element.find(\".jstree-wholerow-clicked\").removeClass(\"jstree-wholerow-clicked\");var c=!1,d,e;for(d=0,e=b.selected.length;e>d;d++)c=this.get_node(b.selected[d],!0),c&&c.length&&c.children(\".jstree-wholerow\").addClass(\"jstree-wholerow-clicked\")},this)).on(\"open_node.jstree\",a.proxy(function(a,b){this.get_node(b.node,!0).find(\".jstree-clicked\").parent().children(\".jstree-wholerow\").addClass(\"jstree-wholerow-clicked\")},this)).on(\"hover_node.jstree dehover_node.jstree\",a.proxy(function(a,b){\"hover_node\"===a.type&&this.is_disabled(b.node)||this.get_node(b.node,!0).children(\".jstree-wholerow\")[\"hover_node\"===a.type?\"addClass\":\"removeClass\"](\"jstree-wholerow-hovered\")},this)).on(\"contextmenu.jstree\",\".jstree-wholerow\",a.proxy(function(b){if(this._data.contextmenu){b.preventDefault();var c=a.Event(\"contextmenu\",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,pageX:b.pageX,pageY:b.pageY});a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").first().trigger(c)}},this)).on(\"click.jstree\",\".jstree-wholerow\",function(b){b.stopImmediatePropagation();var c=a.Event(\"click\",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").first().trigger(c).focus()}).on(\"click.jstree\",\".jstree-leaf > .jstree-ocl\",a.proxy(function(b){b.stopImmediatePropagation();var c=a.Event(\"click\",{metaKey:b.metaKey,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey});a(b.currentTarget).closest(\".jstree-node\").children(\".jstree-anchor\").first().trigger(c).focus()},this)).on(\"mouseover.jstree\",\".jstree-wholerow, .jstree-icon\",a.proxy(function(a){return a.stopImmediatePropagation(),this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget),!1},this)).on(\"mouseleave.jstree\",\".jstree-node\",a.proxy(function(a){this.dehover_node(a.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(\".jstree-wholerow\").remove(),c.teardown.call(this)},this.redraw_node=function(b,d,e,f){if(b=c.redraw_node.apply(this,arguments)){var g=q.cloneNode(!0);-1!==a.inArray(b.id,this._data.core.selected)&&(g.className+=\" jstree-wholerow-clicked\"),this._data.core.focused&&this._data.core.focused===b.id&&(g.className+=\" jstree-wholerow-hovered\"),b.insertBefore(g,b.childNodes[0])}return b}},i.registerElement&&Object&&Object.create){var r=Object.create(HTMLElement.prototype);r.createdCallback=function(){var b={core:{},plugins:[]},c;for(c in a.jstree.plugins)a.jstree.plugins.hasOwnProperty(c)&&this.attributes[c]&&(b.plugins.push(c),this.getAttribute(c)&&JSON.parse(this.getAttribute(c))&&(b[c]=JSON.parse(this.getAttribute(c))));for(c in a.jstree.defaults.core)a.jstree.defaults.core.hasOwnProperty(c)&&this.attributes[c]&&(b.core[c]=JSON.parse(this.getAttribute(c))||this.getAttribute(c));a(this).jstree(b)};try{i.registerElement(\"vakata-jstree\",{prototype:r})}catch(s){}}}});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9jbXMvc3RhdGljL2Ntcy9qcy9saWJzL2pzdHJlZS9qc3RyZWUubWluLmpzPzg1YWMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBUSElTIEZJTEUgSEFTIEJFRU4gTUFOVUFMTFkgUEFUQ0hFRCBUTyBBTExPVyBDT1BZSU5HIElOVE8gU0VMRi9DSElMRFJFTlxuICogaHR0cHM6Ly9naXRodWIuY29tL0ZpbmFsQW5nZWwvanN0cmVlXG4gKi9cbi8qISBqc1RyZWUgLSB2My4zLjAgLSAyMDE2LTA0LTI1IC0gKE1JVCkgKi9cbiFmdW5jdGlvbihhKXtcInVzZSBzdHJpY3RcIjtcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKFtcImpxdWVyeVwiXSxhKTpcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1hKHJlcXVpcmUoXCJqcXVlcnlcIikpOmEoalF1ZXJ5KX0oZnVuY3Rpb24oYSxiKXtcInVzZSBzdHJpY3RcIjtpZighYS5qc3RyZWUpe3ZhciBjPTAsZD0hMSxlPSExLGY9ITEsZz1bXSxoPWEoXCJzY3JpcHQ6bGFzdFwiKS5hdHRyKFwic3JjXCIpLGk9d2luZG93LmRvY3VtZW50LGo9aS5jcmVhdGVFbGVtZW50KFwiTElcIiksayxsO2ouc2V0QXR0cmlidXRlKFwicm9sZVwiLFwidHJlZWl0ZW1cIiksaz1pLmNyZWF0ZUVsZW1lbnQoXCJJXCIpLGsuY2xhc3NOYW1lPVwianN0cmVlLWljb24ganN0cmVlLW9jbFwiLGsuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGouYXBwZW5kQ2hpbGQoayksaz1pLmNyZWF0ZUVsZW1lbnQoXCJBXCIpLGsuY2xhc3NOYW1lPVwianN0cmVlLWFuY2hvclwiLGsuc2V0QXR0cmlidXRlKFwiaHJlZlwiLFwiI1wiKSxrLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsXCItMVwiKSxsPWkuY3JlYXRlRWxlbWVudChcIklcIiksbC5jbGFzc05hbWU9XCJqc3RyZWUtaWNvbiBqc3RyZWUtdGhlbWVpY29uXCIsbC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJwcmVzZW50YXRpb25cIiksay5hcHBlbmRDaGlsZChsKSxqLmFwcGVuZENoaWxkKGspLGs9bD1udWxsLGEuanN0cmVlPXt2ZXJzaW9uOlwie3tWRVJTSU9OfX1cIixkZWZhdWx0czp7cGx1Z2luczpbXX0scGx1Z2luczp7fSxwYXRoOmgmJi0xIT09aC5pbmRleE9mKFwiL1wiKT9oLnJlcGxhY2UoL1xcL1teXFwvXSskLyxcIlwiKTpcIlwiLGlkcmVnZXg6L1tcXFxcOiYhXnwoKVxcW1xcXTw+QConK34jXCI7Liw9XFwtIFxcLyR7fSU/YF0vZyxyb290OlwiI1wifSxhLmpzdHJlZS5jcmVhdGU9ZnVuY3Rpb24oYixkKXt2YXIgZT1uZXcgYS5qc3RyZWUuY29yZSgrK2MpLGY9ZDtyZXR1cm4gZD1hLmV4dGVuZCghMCx7fSxhLmpzdHJlZS5kZWZhdWx0cyxkKSxmJiZmLnBsdWdpbnMmJihkLnBsdWdpbnM9Zi5wbHVnaW5zKSxhLmVhY2goZC5wbHVnaW5zLGZ1bmN0aW9uKGEsYil7XCJjb3JlXCIhPT1hJiYoZT1lLnBsdWdpbihiLGRbYl0pKX0pLGEoYikuZGF0YShcImpzdHJlZVwiLGUpLGUuaW5pdChiLGQpLGV9LGEuanN0cmVlLmRlc3Ryb3k9ZnVuY3Rpb24oKXthKFwiLmpzdHJlZTpqc3RyZWVcIikuanN0cmVlKFwiZGVzdHJveVwiKSxhKGkpLm9mZihcIi5qc3RyZWVcIil9LGEuanN0cmVlLmNvcmU9ZnVuY3Rpb24oYSl7dGhpcy5faWQ9YSx0aGlzLl9jbnQ9MCx0aGlzLl93cms9bnVsbCx0aGlzLl9kYXRhPXtjb3JlOnt0aGVtZXM6e25hbWU6ITEsZG90czohMSxpY29uczohMX0sc2VsZWN0ZWQ6W10sbGFzdF9lcnJvcjp7fSx3b3JraW5nOiExLHdvcmtlcl9xdWV1ZTpbXSxmb2N1c2VkOm51bGx9fX0sYS5qc3RyZWUucmVmZXJlbmNlPWZ1bmN0aW9uKGIpe3ZhciBjPW51bGwsZD1udWxsO2lmKCFifHwhYi5pZHx8Yi50YWdOYW1lJiZiLm5vZGVUeXBlfHwoYj1iLmlkKSwhZHx8IWQubGVuZ3RoKXRyeXtkPWEoYil9Y2F0Y2goZSl7fWlmKCFkfHwhZC5sZW5ndGgpdHJ5e2Q9YShcIiNcIitiLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSl9Y2F0Y2goZSl7fXJldHVybiBkJiZkLmxlbmd0aCYmKGQ9ZC5jbG9zZXN0KFwiLmpzdHJlZVwiKSkubGVuZ3RoJiYoZD1kLmRhdGEoXCJqc3RyZWVcIikpP2M9ZDphKFwiLmpzdHJlZVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKS5kYXRhKFwianN0cmVlXCIpO3JldHVybiBkJiZkLl9tb2RlbC5kYXRhW2JdPyhjPWQsITEpOnZvaWQgMH0pLGN9LGEuZm4uanN0cmVlPWZ1bmN0aW9uKGMpe3ZhciBkPVwic3RyaW5nXCI9PXR5cGVvZiBjLGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLGY9bnVsbDtyZXR1cm4gYyE9PSEwfHx0aGlzLmxlbmd0aD8odGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGc9YS5qc3RyZWUucmVmZXJlbmNlKHRoaXMpLGg9ZCYmZz9nW2NdOm51bGw7cmV0dXJuIGY9ZCYmaD9oLmFwcGx5KGcsZSk6bnVsbCxnfHxkfHxjIT09YiYmIWEuaXNQbGFpbk9iamVjdChjKXx8YS5qc3RyZWUuY3JlYXRlKHRoaXMsYyksKGcmJiFkfHxjPT09ITApJiYoZj1nfHwhMSksbnVsbCE9PWYmJmYhPT1iPyExOnZvaWQgMH0pLG51bGwhPT1mJiZmIT09Yj9mOnRoaXMpOiExfSxhLmV4cHJbXCI6XCJdLmpzdHJlZT1hLmV4cHIuY3JlYXRlUHNldWRvKGZ1bmN0aW9uKGMpe3JldHVybiBmdW5jdGlvbihjKXtyZXR1cm4gYShjKS5oYXNDbGFzcyhcImpzdHJlZVwiKSYmYShjKS5kYXRhKFwianN0cmVlXCIpIT09Yn19KSxhLmpzdHJlZS5kZWZhdWx0cy5jb3JlPXtkYXRhOiExLHN0cmluZ3M6ITEsY2hlY2tfY2FsbGJhY2s6ITEsZXJyb3I6YS5ub29wLGFuaW1hdGlvbjoyMDAsbXVsdGlwbGU6ITAsdGhlbWVzOntuYW1lOiExLHVybDohMSxkaXI6ITEsZG90czohMCxpY29uczohMCxzdHJpcGVzOiExLHZhcmlhbnQ6ITEscmVzcG9uc2l2ZTohMX0sZXhwYW5kX3NlbGVjdGVkX29ubG9hZDohMCx3b3JrZXI6ITAsZm9yY2VfdGV4dDohMSxkYmxjbGlja190b2dnbGU6ITB9LGEuanN0cmVlLmNvcmUucHJvdG90eXBlPXtwbHVnaW46ZnVuY3Rpb24oYixjKXt2YXIgZD1hLmpzdHJlZS5wbHVnaW5zW2JdO3JldHVybiBkPyh0aGlzLl9kYXRhW2JdPXt9LGQucHJvdG90eXBlPXRoaXMsbmV3IGQoYyx0aGlzKSk6dGhpc30saW5pdDpmdW5jdGlvbihiLGMpe3RoaXMuX21vZGVsPXtkYXRhOnt9LGNoYW5nZWQ6W10sZm9yY2VfZnVsbF9yZWRyYXc6ITEscmVkcmF3X3RpbWVvdXQ6ITEsZGVmYXVsdF9zdGF0ZTp7bG9hZGVkOiEwLG9wZW5lZDohMSxzZWxlY3RlZDohMSxkaXNhYmxlZDohMX19LHRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF09e2lkOmEuanN0cmVlLnJvb3QscGFyZW50Om51bGwscGFyZW50czpbXSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLHN0YXRlOntsb2FkZWQ6ITF9fSx0aGlzLmVsZW1lbnQ9YShiKS5hZGRDbGFzcyhcImpzdHJlZSBqc3RyZWUtXCIrdGhpcy5faWQpLHRoaXMuc2V0dGluZ3M9Yyx0aGlzLl9kYXRhLmNvcmUucmVhZHk9ITEsdGhpcy5fZGF0YS5jb3JlLmxvYWRlZD0hMSx0aGlzLl9kYXRhLmNvcmUucnRsPVwicnRsXCI9PT10aGlzLmVsZW1lbnQuY3NzKFwiZGlyZWN0aW9uXCIpLHRoaXMuZWxlbWVudFt0aGlzLl9kYXRhLmNvcmUucnRsP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwianN0cmVlLXJ0bFwiKSx0aGlzLmVsZW1lbnQuYXR0cihcInJvbGVcIixcInRyZWVcIiksdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiZ0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtbXVsdGlzZWxlY3RhYmxlXCIsITApLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIil8fHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIjBcIiksdGhpcy5iaW5kKCksdGhpcy50cmlnZ2VyKFwiaW5pdFwiKSx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWw9dGhpcy5lbGVtZW50LmZpbmQoXCIgPiB1bCA+IGxpXCIpLmNsb25lKCEwKSx0aGlzLl9kYXRhLmNvcmUub3JpZ2luYWxfY29udGFpbmVyX2h0bWwuZmluZChcImxpXCIpLmFkZEJhY2soKS5jb250ZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiAzPT09dGhpcy5ub2RlVHlwZSYmKCF0aGlzLm5vZGVWYWx1ZXx8L15cXHMrJC8udGVzdCh0aGlzLm5vZGVWYWx1ZSkpfSkucmVtb3ZlKCksdGhpcy5lbGVtZW50Lmh0bWwoXCI8dWwgY2xhc3M9J2pzdHJlZS1jb250YWluZXItdWwganN0cmVlLWNoaWxkcmVuJyByb2xlPSdncm91cCc+PGxpIGlkPSdqXCIrdGhpcy5faWQrXCJfbG9hZGluZycgY2xhc3M9J2pzdHJlZS1pbml0aWFsLW5vZGUganN0cmVlLWxvYWRpbmcganN0cmVlLWxlYWYganN0cmVlLWxhc3QnIHJvbGU9J3RyZWUtaXRlbSc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS1vY2wnPjwvaT48YSBjbGFzcz0nanN0cmVlLWFuY2hvcicgaHJlZj0nIyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb24taGlkZGVuJz48L2k+XCIrdGhpcy5nZXRfc3RyaW5nKFwiTG9hZGluZyAuLi5cIikrXCI8L2E+PC9saT48L3VsPlwiKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFwialwiK3RoaXMuX2lkK1wiX2xvYWRpbmdcIiksdGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodD10aGlzLmdldF9jb250YWluZXJfdWwoKS5jaGlsZHJlbihcImxpXCIpLmZpcnN0KCkuaGVpZ2h0KCl8fDI0LHRoaXMudHJpZ2dlcihcImxvYWRpbmdcIiksdGhpcy5sb2FkX25vZGUoYS5qc3RyZWUucm9vdCl9LGRlc3Ryb3k6ZnVuY3Rpb24oYSl7aWYodGhpcy5fd3JrKXRyeXt3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLl93cmspLHRoaXMuX3dyaz1udWxsfWNhdGNoKGIpe31hfHx0aGlzLmVsZW1lbnQuZW1wdHkoKSx0aGlzLnRlYXJkb3duKCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7dGhpcy51bmJpbmQoKSx0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJqc3RyZWVcIikucmVtb3ZlRGF0YShcImpzdHJlZVwiKS5maW5kKFwiW2NsYXNzXj0nanN0cmVlJ11cIikuYWRkQmFjaygpLmF0dHIoXCJjbGFzc1wiLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2xhc3NOYW1lLnJlcGxhY2UoL2pzdHJlZVteIF0qfCQvZ2ksXCJcIil9KSx0aGlzLmVsZW1lbnQ9bnVsbH0sYmluZDpmdW5jdGlvbigpe3ZhciBiPVwiXCIsYz1udWxsLGQ9MDt0aGlzLmVsZW1lbnQub24oXCJkYmxjbGljay5qc3RyZWVcIixmdW5jdGlvbihhKXtpZihhLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1hLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aWYoaS5zZWxlY3Rpb24mJmkuc2VsZWN0aW9uLmVtcHR5KWkuc2VsZWN0aW9uLmVtcHR5KCk7ZWxzZSBpZih3aW5kb3cuZ2V0U2VsZWN0aW9uKXt2YXIgYj13aW5kb3cuZ2V0U2VsZWN0aW9uKCk7dHJ5e2IucmVtb3ZlQWxsUmFuZ2VzKCksYi5jb2xsYXBzZSgpfWNhdGNoKGMpe319fSkub24oXCJtb3VzZWRvd24uanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhKXthLnRhcmdldD09PXRoaXMuZWxlbWVudFswXSYmKGEucHJldmVudERlZmF1bHQoKSxkPStuZXcgRGF0ZSl9LHRoaXMpKS5vbihcIm1vdXNlZG93bi5qc3RyZWVcIixcIi5qc3RyZWUtb2NsXCIsZnVuY3Rpb24oYSl7YS5wcmV2ZW50RGVmYXVsdCgpfSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtb2NsXCIsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLnRvZ2dsZV9ub2RlKGEudGFyZ2V0KX0sdGhpcykpLm9uKFwiZGJsY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIGEudGFyZ2V0LnRhZ05hbWUmJlwiaW5wdXRcIj09PWEudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKT8hMDp2b2lkKHRoaXMuc2V0dGluZ3MuY29yZS5kYmxjbGlja190b2dnbGUmJnRoaXMudG9nZ2xlX25vZGUoYS50YXJnZXQpKX0sdGhpcykpLm9uKFwiY2xpY2suanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpLGIuY3VycmVudFRhcmdldCE9PWkuYWN0aXZlRWxlbWVudCYmYShiLmN1cnJlbnRUYXJnZXQpLmZvY3VzKCksdGhpcy5hY3RpdmF0ZV9ub2RlKGIuY3VycmVudFRhcmdldCxiKX0sdGhpcykpLm9uKFwia2V5ZG93bi5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXtpZihiLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1iLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7aWYoMzIhPT1iLndoaWNoJiYxMyE9PWIud2hpY2gmJihiLnNoaWZ0S2V5fHxiLmN0cmxLZXl8fGIuYWx0S2V5fHxiLm1ldGFLZXkpKXJldHVybiEwO3ZhciBjPW51bGw7c3dpdGNoKHRoaXMuX2RhdGEuY29yZS5ydGwmJigzNz09PWIud2hpY2g/Yi53aGljaD0zOTozOT09PWIud2hpY2gmJihiLndoaWNoPTM3KSksYi53aGljaCl7Y2FzZSAzMjpiLmN0cmxLZXkmJihiLnR5cGU9XCJjbGlja1wiLGEoYi5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKGIpKTticmVhaztjYXNlIDEzOmIudHlwZT1cImNsaWNrXCIsYShiLmN1cnJlbnRUYXJnZXQpLnRyaWdnZXIoYik7YnJlYWs7Y2FzZSAzNzpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5pc19vcGVuKGIuY3VycmVudFRhcmdldCk/dGhpcy5jbG9zZV9ub2RlKGIuY3VycmVudFRhcmdldCk6KGM9dGhpcy5nZXRfcGFyZW50KGIuY3VycmVudFRhcmdldCksYyYmYy5pZCE9PWEuanN0cmVlLnJvb3QmJnRoaXMuZ2V0X25vZGUoYywhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpKTticmVhaztjYXNlIDM4OmIucHJldmVudERlZmF1bHQoKSxjPXRoaXMuZ2V0X3ByZXZfZG9tKGIuY3VycmVudFRhcmdldCksYyYmYy5sZW5ndGgmJmMuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpO2JyZWFrO2Nhc2UgMzk6Yi5wcmV2ZW50RGVmYXVsdCgpLHRoaXMuaXNfY2xvc2VkKGIuY3VycmVudFRhcmdldCk/dGhpcy5vcGVuX25vZGUoYi5jdXJyZW50VGFyZ2V0LGZ1bmN0aW9uKGEpe3RoaXMuZ2V0X25vZGUoYSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpfSk6dGhpcy5pc19vcGVuKGIuY3VycmVudFRhcmdldCkmJihjPXRoaXMuZ2V0X25vZGUoYi5jdXJyZW50VGFyZ2V0LCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIilbMF0sYyYmYSh0aGlzLl9maXJzdENoaWxkKGMpKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpO2JyZWFrO2Nhc2UgNDA6Yi5wcmV2ZW50RGVmYXVsdCgpLGM9dGhpcy5nZXRfbmV4dF9kb20oYi5jdXJyZW50VGFyZ2V0KSxjJiZjLmxlbmd0aCYmYy5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAxMDY6dGhpcy5vcGVuX2FsbCgpO2JyZWFrO2Nhc2UgMzY6Yi5wcmV2ZW50RGVmYXVsdCgpLGM9dGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSksYyYmYShjKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLmZvY3VzKCk7YnJlYWs7Y2FzZSAzNTpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5maWx0ZXIoXCI6dmlzaWJsZVwiKS5sYXN0KCkuZm9jdXMoKTticmVhaztjYXNlIDExMzpiLnByZXZlbnREZWZhdWx0KCksdGhpcy5lZGl0KGIuY3VycmVudFRhcmdldCl9fSx0aGlzKSkub24oXCJsb2FkX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe2Muc3RhdHVzJiYoYy5ub2RlLmlkIT09YS5qc3RyZWUucm9vdHx8dGhpcy5fZGF0YS5jb3JlLmxvYWRlZHx8KHRoaXMuX2RhdGEuY29yZS5sb2FkZWQ9ITAsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkuaWQpLHRoaXMudHJpZ2dlcihcImxvYWRlZFwiKSksdGhpcy5fZGF0YS5jb3JlLnJlYWR5fHxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXtpZih0aGlzLmVsZW1lbnQmJiF0aGlzLmdldF9jb250YWluZXJfdWwoKS5maW5kKFwiLmpzdHJlZS1sb2FkaW5nXCIpLmxlbmd0aCl7aWYodGhpcy5fZGF0YS5jb3JlLnJlYWR5PSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGgpe2lmKHRoaXMuc2V0dGluZ3MuY29yZS5leHBhbmRfc2VsZWN0ZWRfb25sb2FkKXt2YXIgYj1bXSxjLGQ7Zm9yKGM9MCxkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGg7ZD5jO2MrKyliPWIuY29uY2F0KHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2NdXS5wYXJlbnRzKTtmb3IoYj1hLnZha2F0YS5hcnJheV91bmlxdWUoYiksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLm9wZW5fbm9kZShiW2NdLCExLDApfXRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwicmVhZHlcIixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KX10aGlzLnRyaWdnZXIoXCJyZWFkeVwiKX19LHRoaXMpLDApKX0sdGhpcykpLm9uKFwia2V5cHJlc3MuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihkKXtpZihkLnRhcmdldC50YWdOYW1lJiZcImlucHV0XCI9PT1kLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpcmV0dXJuITA7YyYmY2xlYXJUaW1lb3V0KGMpLGM9c2V0VGltZW91dChmdW5jdGlvbigpe2I9XCJcIn0sNTAwKTt2YXIgZT1TdHJpbmcuZnJvbUNoYXJDb2RlKGQud2hpY2gpLnRvTG93ZXJDYXNlKCksZj10aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtYW5jaG9yXCIpLmZpbHRlcihcIjp2aXNpYmxlXCIpLGc9Zi5pbmRleChpLmFjdGl2ZUVsZW1lbnQpfHwwLGg9ITE7aWYoYis9ZSxiLmxlbmd0aD4xKXtpZihmLnNsaWNlKGcpLmVhY2goYS5wcm94eShmdW5jdGlvbihjLGQpe3JldHVybiAwPT09YShkKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGIpPyhhKGQpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm47aWYoZi5zbGljZSgwLGcpLmVhY2goYS5wcm94eShmdW5jdGlvbihjLGQpe3JldHVybiAwPT09YShkKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGIpPyhhKGQpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm59aWYobmV3IFJlZ0V4cChcIl5cIitlLnJlcGxhY2UoL1stXFwvXFxcXF4kKis/LigpfFtcXF17fV0vZyxcIlxcXFwkJlwiKStcIiskXCIpLnRlc3QoYikpe2lmKGYuc2xpY2UoZysxKS5lYWNoKGEucHJveHkoZnVuY3Rpb24oYixjKXtyZXR1cm4gYShjKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCk9PT1lPyhhKGMpLmZvY3VzKCksaD0hMCwhMSk6dm9pZCAwfSx0aGlzKSksaClyZXR1cm47aWYoZi5zbGljZSgwLGcrMSkuZWFjaChhLnByb3h5KGZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEoYykudGV4dCgpLnRvTG93ZXJDYXNlKCkuY2hhckF0KDApPT09ZT8oYShjKS5mb2N1cygpLGg9ITAsITEpOnZvaWQgMH0sdGhpcykpLGgpcmV0dXJufX0sdGhpcykpLm9uKFwiaW5pdC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lczt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM9YS5kb3RzLHRoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz1hLnN0cmlwZXMsdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz1hLmljb25zLHRoaXMuc2V0X3RoZW1lKGEubmFtZXx8XCJkZWZhdWx0XCIsYS51cmwpLHRoaXMuc2V0X3RoZW1lX3ZhcmlhbnQoYS52YXJpYW50KX0sdGhpcykpLm9uKFwibG9hZGluZy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7dGhpc1t0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmRvdHM/XCJzaG93X2RvdHNcIjpcImhpZGVfZG90c1wiXSgpLHRoaXNbdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz9cInNob3dfaWNvbnNcIjpcImhpZGVfaWNvbnNcIl0oKSx0aGlzW3RoaXMuX2RhdGEuY29yZS50aGVtZXMuc3RyaXBlcz9cInNob3dfc3RyaXBlc1wiOlwiaGlkZV9zdHJpcGVzXCJdKCl9LHRoaXMpKS5vbihcImJsdXIuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGEucHJveHkoZnVuY3Rpb24oYil7dGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCxhKGIuY3VycmVudFRhcmdldCkuZmlsdGVyKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLm1vdXNlbGVhdmUoKSx0aGlzLmVsZW1lbnQuYXR0cihcInRhYmluZGV4XCIsXCIwXCIpfSx0aGlzKSkub24oXCJmb2N1cy5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihiKXt2YXIgYz10aGlzLmdldF9ub2RlKGIuY3VycmVudFRhcmdldCk7YyYmYy5pZCYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPWMuaWQpLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLm5vdChiLmN1cnJlbnRUYXJnZXQpLm1vdXNlbGVhdmUoKSxhKGIuY3VycmVudFRhcmdldCkubW91c2VlbnRlcigpLHRoaXMuZWxlbWVudC5hdHRyKFwidGFiaW5kZXhcIixcIi0xXCIpfSx0aGlzKSkub24oXCJmb2N1cy5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKCl7aWYoK25ldyBEYXRlLWQ+NTAwJiYhdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQpe2Q9MDt2YXIgYT10aGlzLmdldF9ub2RlKHRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIpLCEwKTthJiZhLmZpbmQoXCI+IC5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCl9fSx0aGlzKSkub24oXCJtb3VzZWVudGVyLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuaG92ZXJfbm9kZShhLmN1cnJlbnRUYXJnZXQpfSx0aGlzKSkub24oXCJtb3VzZWxlYXZlLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuZGVob3Zlcl9ub2RlKGEuY3VycmVudFRhcmdldCl9LHRoaXMpKX0sdW5iaW5kOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9mZihcIi5qc3RyZWVcIiksYShpKS5vZmYoXCIuanN0cmVlLVwiK3RoaXMuX2lkKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe2J8fChiPXt9KSxiLmluc3RhbmNlPXRoaXMsdGhpcy5lbGVtZW50LnRyaWdnZXJIYW5kbGVyKGEucmVwbGFjZShcIi5qc3RyZWVcIixcIlwiKStcIi5qc3RyZWVcIixiKX0sZ2V0X2NvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LGdldF9jb250YWluZXJfdWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50LmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5maXJzdCgpfSxnZXRfc3RyaW5nOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuc2V0dGluZ3MuY29yZS5zdHJpbmdzO3JldHVybiBhLmlzRnVuY3Rpb24oYyk/Yy5jYWxsKHRoaXMsYik6YyYmY1tiXT9jW2JdOmJ9LF9maXJzdENoaWxkOmZ1bmN0aW9uKGEpe2E9YT9hLmZpcnN0Q2hpbGQ6bnVsbDt3aGlsZShudWxsIT09YSYmMSE9PWEubm9kZVR5cGUpYT1hLm5leHRTaWJsaW5nO3JldHVybiBhfSxfbmV4dFNpYmxpbmc6ZnVuY3Rpb24oYSl7YT1hP2EubmV4dFNpYmxpbmc6bnVsbDt3aGlsZShudWxsIT09YSYmMSE9PWEubm9kZVR5cGUpYT1hLm5leHRTaWJsaW5nO3JldHVybiBhfSxfcHJldmlvdXNTaWJsaW5nOmZ1bmN0aW9uKGEpe2E9YT9hLnByZXZpb3VzU2libGluZzpudWxsO3doaWxlKG51bGwhPT1hJiYxIT09YS5ub2RlVHlwZSlhPWEucHJldmlvdXNTaWJsaW5nO3JldHVybiBhfSxnZXRfbm9kZTpmdW5jdGlvbihiLGMpe2ImJmIuaWQmJihiPWIuaWQpO3ZhciBkO3RyeXtpZih0aGlzLl9tb2RlbC5kYXRhW2JdKWI9dGhpcy5fbW9kZWwuZGF0YVtiXTtlbHNlIGlmKFwic3RyaW5nXCI9PXR5cGVvZiBiJiZ0aGlzLl9tb2RlbC5kYXRhW2IucmVwbGFjZSgvXiMvLFwiXCIpXSliPXRoaXMuX21vZGVsLmRhdGFbYi5yZXBsYWNlKC9eIy8sXCJcIildO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJihkPWEoXCIjXCIrYi5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KSkubGVuZ3RoJiZ0aGlzLl9tb2RlbC5kYXRhW2QuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildKWI9dGhpcy5fbW9kZWwuZGF0YVtkLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuYXR0cihcImlkXCIpXTtlbHNlIGlmKChkPWEoYix0aGlzLmVsZW1lbnQpKS5sZW5ndGgmJnRoaXMuX21vZGVsLmRhdGFbZC5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmF0dHIoXCJpZFwiKV0pYj10aGlzLl9tb2RlbC5kYXRhW2QuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5hdHRyKFwiaWRcIildO2Vsc2V7aWYoIShkPWEoYix0aGlzLmVsZW1lbnQpKS5sZW5ndGh8fCFkLmhhc0NsYXNzKFwianN0cmVlXCIpKXJldHVybiExO2I9dGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XX1yZXR1cm4gYyYmKGI9Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5lbGVtZW50OmEoXCIjXCIrYi5pZC5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KSksYn1jYXRjaChlKXtyZXR1cm4hMX19LGdldF9wYXRoOmZ1bmN0aW9uKGIsYyxkKXtpZihiPWIucGFyZW50cz9iOnRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290fHwhYi5wYXJlbnRzKXJldHVybiExO3ZhciBlLGYsZz1bXTtmb3IoZy5wdXNoKGQ/Yi5pZDpiLnRleHQpLGU9MCxmPWIucGFyZW50cy5sZW5ndGg7Zj5lO2UrKylnLnB1c2goZD9iLnBhcmVudHNbZV06dGhpcy5nZXRfdGV4dChiLnBhcmVudHNbZV0pKTtyZXR1cm4gZz1nLnJldmVyc2UoKS5zbGljZSgxKSxjP2cuam9pbihjKTpnfSxnZXRfbmV4dF9kb206ZnVuY3Rpb24oYixjKXt2YXIgZDtpZihiPXRoaXMuZ2V0X25vZGUoYiwhMCksYlswXT09PXRoaXMuZWxlbWVudFswXSl7ZD10aGlzLl9maXJzdENoaWxkKHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpWzBdKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpZD10aGlzLl9uZXh0U2libGluZyhkKTtyZXR1cm4gZD9hKGQpOiExfWlmKCFifHwhYi5sZW5ndGgpcmV0dXJuITE7aWYoYyl7ZD1iWzBdO2RvIGQ9dGhpcy5fbmV4dFNpYmxpbmcoZCk7d2hpbGUoZCYmMD09PWQub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gZD9hKGQpOiExfWlmKGIuaGFzQ2xhc3MoXCJqc3RyZWUtb3BlblwiKSl7ZD10aGlzLl9maXJzdENoaWxkKGIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpZD10aGlzLl9uZXh0U2libGluZyhkKTtpZihudWxsIT09ZClyZXR1cm4gYShkKX1kPWJbMF07ZG8gZD10aGlzLl9uZXh0U2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO3JldHVybiBudWxsIT09ZD9hKGQpOmIucGFyZW50c1VudGlsKFwiLmpzdHJlZVwiLFwiLmpzdHJlZS1ub2RlXCIpLm5leHRBbGwoXCIuanN0cmVlLW5vZGU6dmlzaWJsZVwiKS5maXJzdCgpfSxnZXRfcHJldl9kb206ZnVuY3Rpb24oYixjKXt2YXIgZDtpZihiPXRoaXMuZ2V0X25vZGUoYiwhMCksYlswXT09PXRoaXMuZWxlbWVudFswXSl7ZD10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5sYXN0Q2hpbGQ7d2hpbGUoZCYmMD09PWQub2Zmc2V0SGVpZ2h0KWQ9dGhpcy5fcHJldmlvdXNTaWJsaW5nKGQpO3JldHVybiBkP2EoZCk6ITF9aWYoIWJ8fCFiLmxlbmd0aClyZXR1cm4hMTtpZihjKXtkPWJbMF07ZG8gZD10aGlzLl9wcmV2aW91c1NpYmxpbmcoZCk7d2hpbGUoZCYmMD09PWQub2Zmc2V0SGVpZ2h0KTtyZXR1cm4gZD9hKGQpOiExfWQ9YlswXTtkbyBkPXRoaXMuX3ByZXZpb3VzU2libGluZyhkKTt3aGlsZShkJiYwPT09ZC5vZmZzZXRIZWlnaHQpO2lmKG51bGwhPT1kKXtiPWEoZCk7d2hpbGUoYi5oYXNDbGFzcyhcImpzdHJlZS1vcGVuXCIpKWI9Yi5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuZmlyc3QoKS5jaGlsZHJlbihcIi5qc3RyZWUtbm9kZTp2aXNpYmxlOmxhc3RcIik7cmV0dXJuIGJ9cmV0dXJuIGQ9YlswXS5wYXJlbnROb2RlLnBhcmVudE5vZGUsZCYmZC5jbGFzc05hbWUmJi0xIT09ZC5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1ub2RlXCIpP2EoZCk6ITF9LGdldF9wYXJlbnQ6ZnVuY3Rpb24oYil7cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD9iLnBhcmVudDohMX0sZ2V0X2NoaWxkcmVuX2RvbTpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEsITApLGFbMF09PT10aGlzLmVsZW1lbnRbMF0/dGhpcy5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oXCIuanN0cmVlLW5vZGVcIik6YSYmYS5sZW5ndGg/YS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuY2hpbGRyZW4oXCIuanN0cmVlLW5vZGVcIik6ITF9LGlzX3BhcmVudDpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJihhLnN0YXRlLmxvYWRlZD09PSExfHxhLmNoaWxkcmVuLmxlbmd0aD4wKX0saXNfbG9hZGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmYS5zdGF0ZS5sb2FkZWR9LGlzX2xvYWRpbmc6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZhLnN0YXRlJiZhLnN0YXRlLmxvYWRpbmd9LGlzX29wZW46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhKSxhJiZhLnN0YXRlLm9wZW5lZH0saXNfY2xvc2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYSYmdGhpcy5pc19wYXJlbnQoYSkmJiFhLnN0YXRlLm9wZW5lZH0saXNfbGVhZjpmdW5jdGlvbihhKXtyZXR1cm4hdGhpcy5pc19wYXJlbnQoYSl9LGxvYWRfbm9kZTpmdW5jdGlvbihiLGMpe3ZhciBkLGUsZixnLGg7aWYoYS5pc0FycmF5KGIpKXJldHVybiB0aGlzLl9sb2FkX25vZGVzKGIuc2xpY2UoKSxjKSwhMDtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWIpcmV0dXJuIGMmJmMuY2FsbCh0aGlzLGIsITEpLCExO2lmKGIuc3RhdGUubG9hZGVkKXtmb3IoYi5zdGF0ZS5sb2FkZWQ9ITEsZj0wLGc9Yi5wYXJlbnRzLmxlbmd0aDtnPmY7ZisrKXRoaXMuX21vZGVsLmRhdGFbYi5wYXJlbnRzW2ZdXS5jaGlsZHJlbl9kPWEudmFrYXRhLmFycmF5X2ZpbHRlcih0aGlzLl9tb2RlbC5kYXRhW2IucGFyZW50c1tmXV0uY2hpbGRyZW5fZCxmdW5jdGlvbihjKXtyZXR1cm4tMT09PWEuaW5BcnJheShjLGIuY2hpbGRyZW5fZCl9KTtmb3IoZD0wLGU9Yi5jaGlsZHJlbl9kLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2RdXS5zdGF0ZS5zZWxlY3RlZCYmKGg9ITApLGRlbGV0ZSB0aGlzLl9tb2RlbC5kYXRhW2IuY2hpbGRyZW5fZFtkXV07aCYmKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9maWx0ZXIodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGZ1bmN0aW9uKGMpe3JldHVybi0xPT09YS5pbkFycmF5KGMsYi5jaGlsZHJlbl9kKX0pKSxiLmNoaWxkcmVuPVtdLGIuY2hpbGRyZW5fZD1bXSxoJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImxvYWRfbm9kZVwiLG5vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWR9KX1yZXR1cm4gYi5zdGF0ZS5mYWlsZWQ9ITEsYi5zdGF0ZS5sb2FkaW5nPSEwLHRoaXMuZ2V0X25vZGUoYiwhMCkuYWRkQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITApLHRoaXMuX2xvYWRfbm9kZShiLGEucHJveHkoZnVuY3Rpb24oYSl7Yj10aGlzLl9tb2RlbC5kYXRhW2IuaWRdLGIuc3RhdGUubG9hZGluZz0hMSxiLnN0YXRlLmxvYWRlZD1hLGIuc3RhdGUuZmFpbGVkPSFiLnN0YXRlLmxvYWRlZDt2YXIgZD10aGlzLmdldF9ub2RlKGIsITApLGU9MCxmPTAsZz10aGlzLl9tb2RlbC5kYXRhLGg9ITE7Zm9yKGU9MCxmPWIuY2hpbGRyZW4ubGVuZ3RoO2Y+ZTtlKyspaWYoZ1tiLmNoaWxkcmVuW2VdXSYmIWdbYi5jaGlsZHJlbltlXV0uc3RhdGUuaGlkZGVuKXtoPSEwO2JyZWFrfWIuc3RhdGUubG9hZGVkJiZkJiZkLmxlbmd0aCYmKGQucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xvc2VkIGpzdHJlZS1vcGVuIGpzdHJlZS1sZWFmXCIpLGg/XCIjXCIhPT1iLmlkJiZkLmFkZENsYXNzKGIuc3RhdGUub3BlbmVkP1wianN0cmVlLW9wZW5cIjpcImpzdHJlZS1jbG9zZWRcIik6ZC5hZGRDbGFzcyhcImpzdHJlZS1sZWFmXCIpKSxkLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKSx0aGlzLnRyaWdnZXIoXCJsb2FkX25vZGVcIix7bm9kZTpiLHN0YXR1czphfSksYyYmYy5jYWxsKHRoaXMsYixhKX0sdGhpcykpLCEwfSxfbG9hZF9ub2RlczpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT0hMCxmPWZ1bmN0aW9uKCl7dGhpcy5fbG9hZF9ub2RlcyhhLGIsITApfSxnPXRoaXMuX21vZGVsLmRhdGEsaCxpLGo9W107Zm9yKGg9MCxpPWEubGVuZ3RoO2k+aDtoKyspZ1thW2hdXSYmKCFnW2FbaF1dLnN0YXRlLmxvYWRlZCYmIWdbYVtoXV0uc3RhdGUuZmFpbGVkfHwhYyYmZCkmJih0aGlzLmlzX2xvYWRpbmcoYVtoXSl8fHRoaXMubG9hZF9ub2RlKGFbaF0sZiksZT0hMSk7aWYoZSl7Zm9yKGg9MCxpPWEubGVuZ3RoO2k+aDtoKyspZ1thW2hdXSYmZ1thW2hdXS5zdGF0ZS5sb2FkZWQmJmoucHVzaChhW2hdKTtiJiYhYi5kb25lJiYoYi5jYWxsKHRoaXMsaiksYi5kb25lPSEwKX19LGxvYWRfYWxsOmZ1bmN0aW9uKGIsYyl7aWYoYnx8KGI9YS5qc3RyZWUucm9vdCksYj10aGlzLmdldF9ub2RlKGIpLCFiKXJldHVybiExO3ZhciBkPVtdLGU9dGhpcy5fbW9kZWwuZGF0YSxmPWVbYi5pZF0uY2hpbGRyZW5fZCxnLGg7Zm9yKGIuc3RhdGUmJiFiLnN0YXRlLmxvYWRlZCYmZC5wdXNoKGIuaWQpLGc9MCxoPWYubGVuZ3RoO2g+ZztnKyspZVtmW2ddXSYmZVtmW2ddXS5zdGF0ZSYmIWVbZltnXV0uc3RhdGUubG9hZGVkJiZkLnB1c2goZltnXSk7ZC5sZW5ndGg/dGhpcy5fbG9hZF9ub2RlcyhkLGZ1bmN0aW9uKCl7dGhpcy5sb2FkX2FsbChiLGMpfSk6KGMmJmMuY2FsbCh0aGlzLGIpLHRoaXMudHJpZ2dlcihcImxvYWRfYWxsXCIse25vZGU6Yn0pKX0sX2xvYWRfbm9kZTpmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuc2V0dGluZ3MuY29yZS5kYXRhLGU7cmV0dXJuIGQ/YS5pc0Z1bmN0aW9uKGQpP2QuY2FsbCh0aGlzLGIsYS5wcm94eShmdW5jdGlvbihkKXtkPT09ITE/Yy5jYWxsKHRoaXMsITEpOnRoaXNbXCJzdHJpbmdcIj09dHlwZW9mIGQ/XCJfYXBwZW5kX2h0bWxfZGF0YVwiOlwiX2FwcGVuZF9qc29uX2RhdGFcIl0oYixcInN0cmluZ1wiPT10eXBlb2YgZD9hKGEucGFyc2VIVE1MKGQpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KTpkLGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLGEpfSl9LHRoaXMpKTpcIm9iamVjdFwiPT10eXBlb2YgZD9kLnVybD8oZD1hLmV4dGVuZCghMCx7fSxkKSxhLmlzRnVuY3Rpb24oZC51cmwpJiYoZC51cmw9ZC51cmwuY2FsbCh0aGlzLGIpKSxhLmlzRnVuY3Rpb24oZC5kYXRhKSYmKGQuZGF0YT1kLmRhdGEuY2FsbCh0aGlzLGIpKSxhLmFqYXgoZCkuZG9uZShhLnByb3h5KGZ1bmN0aW9uKGQsZSxmKXt2YXIgZz1mLmdldFJlc3BvbnNlSGVhZGVyKFwiQ29udGVudC1UeXBlXCIpO3JldHVybiBnJiYtMSE9PWcuaW5kZXhPZihcImpzb25cIil8fFwib2JqZWN0XCI9PXR5cGVvZiBkP3RoaXMuX2FwcGVuZF9qc29uX2RhdGEoYixkLGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLGEpfSk6ZyYmLTEhPT1nLmluZGV4T2YoXCJodG1sXCIpfHxcInN0cmluZ1wiPT10eXBlb2YgZD90aGlzLl9hcHBlbmRfaHRtbF9kYXRhKGIsYShhLnBhcnNlSFRNTChkKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIDMhPT10aGlzLm5vZGVUeXBlfSksZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiYWpheFwiLHBsdWdpbjpcImNvcmVcIixpZDpcImNvcmVfMDRcIixyZWFzb246XCJDb3VsZCBub3QgbG9hZCBub2RlXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7aWQ6Yi5pZCx4aHI6Zn0pfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSxjLmNhbGwodGhpcywhMSkpfSx0aGlzKSkuZmFpbChhLnByb3h5KGZ1bmN0aW9uKGEpe2MuY2FsbCh0aGlzLCExKSx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJhamF4XCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNFwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDpiLmlkLHhocjphfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpfSx0aGlzKSkpOihlPWEuaXNBcnJheShkKXx8YS5pc1BsYWluT2JqZWN0KGQpP0pTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZCkpOmQsYi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2pzb25fZGF0YShiLGUsZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KToodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwibm9kYXRhXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wNVwiLHJlYXNvbjpcIkNvdWxkIG5vdCBsb2FkIG5vZGVcIixkYXRhOkpTT04uc3RyaW5naWZ5KHtpZDpiLmlkfSl9LHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLGMuY2FsbCh0aGlzLCExKSkpOlwic3RyaW5nXCI9PXR5cGVvZiBkP2IuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuX2FwcGVuZF9odG1sX2RhdGEoYixhKGEucGFyc2VIVE1MKGQpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KSxmdW5jdGlvbihhKXtjLmNhbGwodGhpcyxhKX0pOih0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJub2RhdGFcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzA2XCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgbm9kZVwiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2lkOmIuaWR9KX0sdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksYy5jYWxsKHRoaXMsITEpKTpjLmNhbGwodGhpcywhMSk6Yi5pZD09PWEuanN0cmVlLnJvb3Q/dGhpcy5fYXBwZW5kX2h0bWxfZGF0YShiLHRoaXMuX2RhdGEuY29yZS5vcmlnaW5hbF9jb250YWluZXJfaHRtbC5jbG9uZSghMCksZnVuY3Rpb24oYSl7Yy5jYWxsKHRoaXMsYSl9KTpjLmNhbGwodGhpcywhMSl9LF9ub2RlX2NoYW5nZWQ6ZnVuY3Rpb24oYSl7YT10aGlzLmdldF9ub2RlKGEpLGEmJnRoaXMuX21vZGVsLmNoYW5nZWQucHVzaChhLmlkKX0sX2FwcGVuZF9odG1sX2RhdGE6ZnVuY3Rpb24oYixjLGQpe2I9dGhpcy5nZXRfbm9kZShiKSxiLmNoaWxkcmVuPVtdLGIuY2hpbGRyZW5fZD1bXTt2YXIgZT1jLmlzKFwidWxcIik/Yy5jaGlsZHJlbigpOmMsZj1iLmlkLGc9W10saD1bXSxpPXRoaXMuX21vZGVsLmRhdGEsaj1pW2ZdLGs9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCxsLG0sbjtmb3IoZS5lYWNoKGEucHJveHkoZnVuY3Rpb24oYixjKXtsPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21faHRtbChhKGMpLGYsai5wYXJlbnRzLmNvbmNhdCgpKSxsJiYoZy5wdXNoKGwpLGgucHVzaChsKSxpW2xdLmNoaWxkcmVuX2QubGVuZ3RoJiYoaD1oLmNvbmNhdChpW2xdLmNoaWxkcmVuX2QpKSl9LHRoaXMpKSxqLmNoaWxkcmVuPWcsai5jaGlsZHJlbl9kPWgsbT0wLG49ai5wYXJlbnRzLmxlbmd0aDtuPm07bSsrKWlbai5wYXJlbnRzW21dXS5jaGlsZHJlbl9kPWlbai5wYXJlbnRzW21dXS5jaGlsZHJlbl9kLmNvbmNhdChoKTt0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpoLHBhcmVudDpmfSksZiE9PWEuanN0cmVlLnJvb3Q/KHRoaXMuX25vZGVfY2hhbmdlZChmKSx0aGlzLnJlZHJhdygpKToodGhpcy5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oXCIuanN0cmVlLWluaXRpYWwtbm9kZVwiKS5yZW1vdmUoKSx0aGlzLnJlZHJhdyghMCkpLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5sZW5ndGghPT1rJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcIm1vZGVsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksZC5jYWxsKHRoaXMsITApfSxfYXBwZW5kX2pzb25fZGF0YTpmdW5jdGlvbihiLGMsZCxlKXtpZihudWxsIT09dGhpcy5lbGVtZW50KXtiPXRoaXMuZ2V0X25vZGUoYiksYi5jaGlsZHJlbj1bXSxiLmNoaWxkcmVuX2Q9W10sYy5kJiYoYz1jLmQsXCJzdHJpbmdcIj09dHlwZW9mIGMmJihjPUpTT04ucGFyc2UoYykpKSxhLmlzQXJyYXkoYyl8fChjPVtjXSk7dmFyIGY9bnVsbCxnPXtkZjp0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLGRhdDpjLHBhcjpiLmlkLG06dGhpcy5fbW9kZWwuZGF0YSx0X2lkOnRoaXMuX2lkLHRfY250OnRoaXMuX2NudCxzZWw6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSxoPWZ1bmN0aW9uKGEsYil7YS5kYXRhJiYoYT1hLmRhdGEpO3ZhciBjPWEuZGF0LGQ9YS5wYXIsZT1bXSxmPVtdLGc9W10saD1hLmRmLGk9YS50X2lkLGo9YS50X2NudCxrPWEubSxsPWtbZF0sbT1hLnNlbCxuLG8scCxxLHI9ZnVuY3Rpb24oYSxjLGQpe2Q9ZD9kLmNvbmNhdCgpOltdLGMmJmQudW5zaGlmdChjKTt2YXIgZT1hLmlkLnRvU3RyaW5nKCksZixpLGosbCxtPXtpZDplLHRleHQ6YS50ZXh0fHxcIlwiLGljb246YS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOmEuY2hpbGRyZW58fFtdLGNoaWxkcmVuX2Q6YS5jaGlsZHJlbl9kfHxbXSxkYXRhOmEuZGF0YSxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKGYgaW4gaCloLmhhc093blByb3BlcnR5KGYpJiYobS5zdGF0ZVtmXT1oW2ZdKTtpZihhJiZhLmRhdGEmJmEuZGF0YS5qc3RyZWUmJmEuZGF0YS5qc3RyZWUuaWNvbiYmKG0uaWNvbj1hLmRhdGEuanN0cmVlLmljb24pLG0uaWNvbiE9PWImJm51bGwhPT1tLmljb24mJlwiXCIhPT1tLmljb258fChtLmljb249ITApLGEmJmEuZGF0YSYmKG0uZGF0YT1hLmRhdGEsYS5kYXRhLmpzdHJlZSkpZm9yKGYgaW4gYS5kYXRhLmpzdHJlZSlhLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGYpJiYobS5zdGF0ZVtmXT1hLmRhdGEuanN0cmVlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5zdGF0ZSlmb3IoZiBpbiBhLnN0YXRlKWEuc3RhdGUuaGFzT3duUHJvcGVydHkoZikmJihtLnN0YXRlW2ZdPWEuc3RhdGVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmxpX2F0dHIpZm9yKGYgaW4gYS5saV9hdHRyKWEubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKG0ubGlfYXR0cltmXT1hLmxpX2F0dHJbZl0pO2lmKG0ubGlfYXR0ci5pZHx8KG0ubGlfYXR0ci5pZD1lKSxhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5hX2F0dHIpZm9yKGYgaW4gYS5hX2F0dHIpYS5hX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihtLmFfYXR0cltmXT1hLmFfYXR0cltmXSk7Zm9yKGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKG0uc3RhdGUubG9hZGVkPSExLG0uY2hpbGRyZW49W10sbS5jaGlsZHJlbl9kPVtdKSxrW20uaWRdPW0sZj0wLGk9bS5jaGlsZHJlbi5sZW5ndGg7aT5mO2YrKylqPXIoa1ttLmNoaWxkcmVuW2ZdXSxtLmlkLGQpLGw9a1tqXSxtLmNoaWxkcmVuX2QucHVzaChqKSxsLmNoaWxkcmVuX2QubGVuZ3RoJiYobS5jaGlsZHJlbl9kPW0uY2hpbGRyZW5fZC5jb25jYXQobC5jaGlsZHJlbl9kKSk7cmV0dXJuIGRlbGV0ZSBhLmRhdGEsZGVsZXRlIGEuY2hpbGRyZW4sa1ttLmlkXS5vcmlnaW5hbD1hLG0uc3RhdGUuc2VsZWN0ZWQmJmcucHVzaChtLmlkKSxtLmlkfSxzPWZ1bmN0aW9uKGEsYyxkKXtkPWQ/ZC5jb25jYXQoKTpbXSxjJiZkLnVuc2hpZnQoYyk7dmFyIGU9ITEsZixsLG0sbixvO2RvIGU9XCJqXCIraStcIl9cIisgKytqO3doaWxlKGtbZV0pO289e2lkOiExLHRleHQ6XCJzdHJpbmdcIj09dHlwZW9mIGE/YTpcIlwiLGljb246XCJvYmplY3RcIj09dHlwZW9mIGEmJmEuaWNvbiE9PWI/YS5pY29uOiEwLHBhcmVudDpjLHBhcmVudHM6ZCxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKGYgaW4gaCloLmhhc093blByb3BlcnR5KGYpJiYoby5zdGF0ZVtmXT1oW2ZdKTtpZihhJiZhLmlkJiYoby5pZD1hLmlkLnRvU3RyaW5nKCkpLGEmJmEudGV4dCYmKG8udGV4dD1hLnRleHQpLGEmJmEuZGF0YSYmYS5kYXRhLmpzdHJlZSYmYS5kYXRhLmpzdHJlZS5pY29uJiYoby5pY29uPWEuZGF0YS5qc3RyZWUuaWNvbiksby5pY29uIT09YiYmbnVsbCE9PW8uaWNvbiYmXCJcIiE9PW8uaWNvbnx8KG8uaWNvbj0hMCksYSYmYS5kYXRhJiYoby5kYXRhPWEuZGF0YSxhLmRhdGEuanN0cmVlKSlmb3IoZiBpbiBhLmRhdGEuanN0cmVlKWEuZGF0YS5qc3RyZWUuaGFzT3duUHJvcGVydHkoZikmJihvLnN0YXRlW2ZdPWEuZGF0YS5qc3RyZWVbZl0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLnN0YXRlKWZvcihmIGluIGEuc3RhdGUpYS5zdGF0ZS5oYXNPd25Qcm9wZXJ0eShmKSYmKG8uc3RhdGVbZl09YS5zdGF0ZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEubGlfYXR0cilmb3IoZiBpbiBhLmxpX2F0dHIpYS5saV9hdHRyLmhhc093blByb3BlcnR5KGYpJiYoby5saV9hdHRyW2ZdPWEubGlfYXR0cltmXSk7aWYoby5saV9hdHRyLmlkJiYhby5pZCYmKG8uaWQ9by5saV9hdHRyLmlkLnRvU3RyaW5nKCkpLG8uaWR8fChvLmlkPWUpLG8ubGlfYXR0ci5pZHx8KG8ubGlfYXR0ci5pZD1vLmlkKSxhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5hX2F0dHIpZm9yKGYgaW4gYS5hX2F0dHIpYS5hX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihvLmFfYXR0cltmXT1hLmFfYXR0cltmXSk7aWYoYSYmYS5jaGlsZHJlbiYmYS5jaGlsZHJlbi5sZW5ndGgpe2ZvcihmPTAsbD1hLmNoaWxkcmVuLmxlbmd0aDtsPmY7ZisrKW09cyhhLmNoaWxkcmVuW2ZdLG8uaWQsZCksbj1rW21dLG8uY2hpbGRyZW4ucHVzaChtKSxuLmNoaWxkcmVuX2QubGVuZ3RoJiYoby5jaGlsZHJlbl9kPW8uY2hpbGRyZW5fZC5jb25jYXQobi5jaGlsZHJlbl9kKSk7by5jaGlsZHJlbl9kPW8uY2hpbGRyZW5fZC5jb25jYXQoby5jaGlsZHJlbil9cmV0dXJuIGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKG8uc3RhdGUubG9hZGVkPSExLG8uY2hpbGRyZW49W10sby5jaGlsZHJlbl9kPVtdKSxkZWxldGUgYS5kYXRhLGRlbGV0ZSBhLmNoaWxkcmVuLG8ub3JpZ2luYWw9YSxrW28uaWRdPW8sby5zdGF0ZS5zZWxlY3RlZCYmZy5wdXNoKG8uaWQpLG8uaWR9O2lmKGMubGVuZ3RoJiZjWzBdLmlkIT09YiYmY1swXS5wYXJlbnQhPT1iKXtmb3Iobz0wLHA9Yy5sZW5ndGg7cD5vO28rKyljW29dLmNoaWxkcmVufHwoY1tvXS5jaGlsZHJlbj1bXSksa1tjW29dLmlkLnRvU3RyaW5nKCldPWNbb107Zm9yKG89MCxwPWMubGVuZ3RoO3A+bztvKyspa1tjW29dLnBhcmVudC50b1N0cmluZygpXS5jaGlsZHJlbi5wdXNoKGNbb10uaWQudG9TdHJpbmcoKSksbC5jaGlsZHJlbl9kLnB1c2goY1tvXS5pZC50b1N0cmluZygpKTtmb3Iobz0wLHA9bC5jaGlsZHJlbi5sZW5ndGg7cD5vO28rKyluPXIoa1tsLmNoaWxkcmVuW29dXSxkLGwucGFyZW50cy5jb25jYXQoKSksZi5wdXNoKG4pLGtbbl0uY2hpbGRyZW5fZC5sZW5ndGgmJihmPWYuY29uY2F0KGtbbl0uY2hpbGRyZW5fZCkpO2ZvcihvPTAscD1sLnBhcmVudHMubGVuZ3RoO3A+bztvKyspa1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2Q9a1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2QuY29uY2F0KGYpO3E9e2NudDpqLG1vZDprLHNlbDptLHBhcjpkLGRwYzpmLGFkZDpnfX1lbHNle2ZvcihvPTAscD1jLmxlbmd0aDtwPm87bysrKW49cyhjW29dLGQsbC5wYXJlbnRzLmNvbmNhdCgpKSxuJiYoZS5wdXNoKG4pLGYucHVzaChuKSxrW25dLmNoaWxkcmVuX2QubGVuZ3RoJiYoZj1mLmNvbmNhdChrW25dLmNoaWxkcmVuX2QpKSk7Zm9yKGwuY2hpbGRyZW49ZSxsLmNoaWxkcmVuX2Q9ZixvPTAscD1sLnBhcmVudHMubGVuZ3RoO3A+bztvKyspa1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2Q9a1tsLnBhcmVudHNbb11dLmNoaWxkcmVuX2QuY29uY2F0KGYpO3E9e2NudDpqLG1vZDprLHNlbDptLHBhcjpkLGRwYzpmLGFkZDpnfX1yZXR1cm5cInVuZGVmaW5lZFwiIT10eXBlb2Ygd2luZG93JiZcInVuZGVmaW5lZFwiIT10eXBlb2Ygd2luZG93LmRvY3VtZW50P3E6dm9pZCBwb3N0TWVzc2FnZShxKX0saT1mdW5jdGlvbihiLGMpe2lmKG51bGwhPT10aGlzLmVsZW1lbnQpe3RoaXMuX2NudD1iLmNudDt2YXIgZSxmPXRoaXMuX21vZGVsLmRhdGE7Zm9yKGUgaW4gZilmLmhhc093blByb3BlcnR5KGUpJiZmW2VdLnN0YXRlJiZmW2VdLnN0YXRlLmxvYWRpbmcmJmIubW9kW2VdJiYoYi5tb2RbZV0uc3RhdGUubG9hZGluZz0hMCk7aWYodGhpcy5fbW9kZWwuZGF0YT1iLm1vZCxjKXt2YXIgZyxoPWIuYWRkLGk9Yi5zZWwsaj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuc2xpY2UoKTtpZihmPXRoaXMuX21vZGVsLmRhdGEsaS5sZW5ndGghPT1qLmxlbmd0aHx8YS52YWthdGEuYXJyYXlfdW5pcXVlKGkuY29uY2F0KGopKS5sZW5ndGghPT1pLmxlbmd0aCl7Zm9yKGU9MCxnPWkubGVuZ3RoO2c+ZTtlKyspLTE9PT1hLmluQXJyYXkoaVtlXSxoKSYmLTE9PT1hLmluQXJyYXkoaVtlXSxqKSYmKGZbaVtlXV0uc3RhdGUuc2VsZWN0ZWQ9ITEpO2ZvcihlPTAsZz1qLmxlbmd0aDtnPmU7ZSsrKS0xPT09YS5pbkFycmF5KGpbZV0saSkmJihmW2pbZV1dLnN0YXRlLnNlbGVjdGVkPSEwKX19Yi5hZGQubGVuZ3RoJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPXRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5jb25jYXQoYi5hZGQpKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpiLmRwYyxwYXJlbnQ6Yi5wYXJ9KSxiLnBhciE9PWEuanN0cmVlLnJvb3Q/KHRoaXMuX25vZGVfY2hhbmdlZChiLnBhciksdGhpcy5yZWRyYXcoKSk6dGhpcy5yZWRyYXcoITApLGIuYWRkLmxlbmd0aCYmdGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJtb2RlbFwiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZH0pLGQuY2FsbCh0aGlzLCEwKX19O2lmKHRoaXMuc2V0dGluZ3MuY29yZS53b3JrZXImJndpbmRvdy5CbG9iJiZ3aW5kb3cuVVJMJiZ3aW5kb3cuV29ya2VyKXRyeXtudWxsPT09dGhpcy5fd3JrJiYodGhpcy5fd3JrPXdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyB3aW5kb3cuQmxvYihbXCJzZWxmLm9ubWVzc2FnZSA9IFwiK2gudG9TdHJpbmcoKV0se3R5cGU6XCJ0ZXh0L2phdmFzY3JpcHRcIn0pKSksIXRoaXMuX2RhdGEuY29yZS53b3JraW5nfHxlPyh0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMCxmPW5ldyB3aW5kb3cuV29ya2VyKHRoaXMuX3dyayksZi5vbm1lc3NhZ2U9YS5wcm94eShmdW5jdGlvbihhKXtpLmNhbGwodGhpcyxhLmRhdGEsITApO3RyeXtmLnRlcm1pbmF0ZSgpLGY9bnVsbH1jYXRjaChiKXt9dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5sZW5ndGg/dGhpcy5fYXBwZW5kX2pzb25fZGF0YS5hcHBseSh0aGlzLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUuc2hpZnQoKSk6dGhpcy5fZGF0YS5jb3JlLndvcmtpbmc9ITF9LHRoaXMpLGcucGFyP2YucG9zdE1lc3NhZ2UoZyk6dGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5sZW5ndGg/dGhpcy5fYXBwZW5kX2pzb25fZGF0YS5hcHBseSh0aGlzLHRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUuc2hpZnQoKSk6dGhpcy5fZGF0YS5jb3JlLndvcmtpbmc9ITEpOnRoaXMuX2RhdGEuY29yZS53b3JrZXJfcXVldWUucHVzaChbYixjLGQsITBdKX1jYXRjaChqKXtpLmNhbGwodGhpcyxoKGcpLCExKSx0aGlzLl9kYXRhLmNvcmUud29ya2VyX3F1ZXVlLmxlbmd0aD90aGlzLl9hcHBlbmRfanNvbl9kYXRhLmFwcGx5KHRoaXMsdGhpcy5fZGF0YS5jb3JlLndvcmtlcl9xdWV1ZS5zaGlmdCgpKTp0aGlzLl9kYXRhLmNvcmUud29ya2luZz0hMX1lbHNlIGkuY2FsbCh0aGlzLGgoZyksITEpfX0sX3BhcnNlX21vZGVsX2Zyb21faHRtbDpmdW5jdGlvbihjLGQsZSl7ZT1lP1tdLmNvbmNhdChlKTpbXSxkJiZlLnVuc2hpZnQoZCk7dmFyIGYsZyxoPXRoaXMuX21vZGVsLmRhdGEsaT17aWQ6ITEsdGV4dDohMSxpY29uOiEwLHBhcmVudDpkLHBhcmVudHM6ZSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLGRhdGE6bnVsbCxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX0saixrLGw7Zm9yKGogaW4gdGhpcy5fbW9kZWwuZGVmYXVsdF9zdGF0ZSl0aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLmhhc093blByb3BlcnR5KGopJiYoaS5zdGF0ZVtqXT10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlW2pdKTtpZihrPWEudmFrYXRhLmF0dHJpYnV0ZXMoYywhMCksYS5lYWNoKGssZnVuY3Rpb24oYixjKXtyZXR1cm4gYz1hLnRyaW0oYyksYy5sZW5ndGg/KGkubGlfYXR0cltiXT1jLHZvaWQoXCJpZFwiPT09YiYmKGkuaWQ9Yy50b1N0cmluZygpKSkpOiEwfSksaz1jLmNoaWxkcmVuKFwiYVwiKS5maXJzdCgpLGsubGVuZ3RoJiYoaz1hLnZha2F0YS5hdHRyaWJ1dGVzKGssITApLGEuZWFjaChrLGZ1bmN0aW9uKGIsYyl7Yz1hLnRyaW0oYyksYy5sZW5ndGgmJihpLmFfYXR0cltiXT1jKX0pKSxrPWMuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCkubGVuZ3RoP2MuY2hpbGRyZW4oXCJhXCIpLmZpcnN0KCkuY2xvbmUoKTpjLmNsb25lKCksay5jaGlsZHJlbihcImlucywgaSwgdWxcIikucmVtb3ZlKCksaz1rLmh0bWwoKSxrPWEoXCI8ZGl2IC8+XCIpLmh0bWwoayksaS50ZXh0PXRoaXMuc2V0dGluZ3MuY29yZS5mb3JjZV90ZXh0P2sudGV4dCgpOmsuaHRtbCgpLGs9Yy5kYXRhKCksaS5kYXRhPWs/YS5leHRlbmQoITAse30sayk6bnVsbCxpLnN0YXRlLm9wZW5lZD1jLmhhc0NsYXNzKFwianN0cmVlLW9wZW5cIiksaS5zdGF0ZS5zZWxlY3RlZD1jLmNoaWxkcmVuKFwiYVwiKS5oYXNDbGFzcyhcImpzdHJlZS1jbGlja2VkXCIpLGkuc3RhdGUuZGlzYWJsZWQ9Yy5jaGlsZHJlbihcImFcIikuaGFzQ2xhc3MoXCJqc3RyZWUtZGlzYWJsZWRcIiksaS5kYXRhJiZpLmRhdGEuanN0cmVlKWZvcihqIGluIGkuZGF0YS5qc3RyZWUpaS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShqKSYmKGkuc3RhdGVbal09aS5kYXRhLmpzdHJlZVtqXSk7az1jLmNoaWxkcmVuKFwiYVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLGsubGVuZ3RoJiYoaS5pY29uPWsuaGFzQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKT8hMTprLmF0dHIoXCJyZWxcIikpLGkuc3RhdGUuaWNvbiE9PWImJihpLmljb249aS5zdGF0ZS5pY29uKSxpLmljb24hPT1iJiZudWxsIT09aS5pY29uJiZcIlwiIT09aS5pY29ufHwoaS5pY29uPSEwKSxrPWMuY2hpbGRyZW4oXCJ1bFwiKS5jaGlsZHJlbihcImxpXCIpO2RvIGw9XCJqXCIrdGhpcy5faWQrXCJfXCIrICsrdGhpcy5fY250O3doaWxlKGhbbF0pO3JldHVybiBpLmlkPWkubGlfYXR0ci5pZD9pLmxpX2F0dHIuaWQudG9TdHJpbmcoKTpsLGsubGVuZ3RoPyhrLmVhY2goYS5wcm94eShmdW5jdGlvbihiLGMpe2Y9dGhpcy5fcGFyc2VfbW9kZWxfZnJvbV9odG1sKGEoYyksaS5pZCxlKSxnPXRoaXMuX21vZGVsLmRhdGFbZl0saS5jaGlsZHJlbi5wdXNoKGYpLGcuY2hpbGRyZW5fZC5sZW5ndGgmJihpLmNoaWxkcmVuX2Q9aS5jaGlsZHJlbl9kLmNvbmNhdChnLmNoaWxkcmVuX2QpKX0sdGhpcykpLGkuY2hpbGRyZW5fZD1pLmNoaWxkcmVuX2QuY29uY2F0KGkuY2hpbGRyZW4pKTpjLmhhc0NsYXNzKFwianN0cmVlLWNsb3NlZFwiKSYmKGkuc3RhdGUubG9hZGVkPSExKSxpLmxpX2F0dHJbXCJjbGFzc1wiXSYmKGkubGlfYXR0cltcImNsYXNzXCJdPWkubGlfYXR0cltcImNsYXNzXCJdLnJlcGxhY2UoXCJqc3RyZWUtY2xvc2VkXCIsXCJcIikucmVwbGFjZShcImpzdHJlZS1vcGVuXCIsXCJcIikpLGkuYV9hdHRyW1wiY2xhc3NcIl0mJihpLmFfYXR0cltcImNsYXNzXCJdPWkuYV9hdHRyW1wiY2xhc3NcIl0ucmVwbGFjZShcImpzdHJlZS1jbGlja2VkXCIsXCJcIikucmVwbGFjZShcImpzdHJlZS1kaXNhYmxlZFwiLFwiXCIpKSxoW2kuaWRdPWksaS5zdGF0ZS5zZWxlY3RlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLnB1c2goaS5pZCksaS5pZH0sX3BhcnNlX21vZGVsX2Zyb21fZmxhdF9qc29uOmZ1bmN0aW9uKGEsYyxkKXtkPWQ/ZC5jb25jYXQoKTpbXSxjJiZkLnVuc2hpZnQoYyk7dmFyIGU9YS5pZC50b1N0cmluZygpLGY9dGhpcy5fbW9kZWwuZGF0YSxnPXRoaXMuX21vZGVsLmRlZmF1bHRfc3RhdGUsaCxpLGosayxsPXtpZDplLHRleHQ6YS50ZXh0fHxcIlwiLGljb246YS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOmEuY2hpbGRyZW58fFtdLGNoaWxkcmVuX2Q6YS5jaGlsZHJlbl9kfHxbXSxkYXRhOmEuZGF0YSxzdGF0ZTp7fSxsaV9hdHRyOntpZDohMX0sYV9hdHRyOntocmVmOlwiI1wifSxvcmlnaW5hbDohMX07Zm9yKGggaW4gZylnLmhhc093blByb3BlcnR5KGgpJiYobC5zdGF0ZVtoXT1nW2hdKTtpZihhJiZhLmRhdGEmJmEuZGF0YS5qc3RyZWUmJmEuZGF0YS5qc3RyZWUuaWNvbiYmKGwuaWNvbj1hLmRhdGEuanN0cmVlLmljb24pLGwuaWNvbiE9PWImJm51bGwhPT1sLmljb24mJlwiXCIhPT1sLmljb258fChsLmljb249ITApLGEmJmEuZGF0YSYmKGwuZGF0YT1hLmRhdGEsYS5kYXRhLmpzdHJlZSkpZm9yKGggaW4gYS5kYXRhLmpzdHJlZSlhLmRhdGEuanN0cmVlLmhhc093blByb3BlcnR5KGgpJiYobC5zdGF0ZVtoXT1hLmRhdGEuanN0cmVlW2hdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5zdGF0ZSlmb3IoaCBpbiBhLnN0YXRlKWEuc3RhdGUuaGFzT3duUHJvcGVydHkoaCkmJihsLnN0YXRlW2hdPWEuc3RhdGVbaF0pO2lmKGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmxpX2F0dHIpZm9yKGggaW4gYS5saV9hdHRyKWEubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShoKSYmKGwubGlfYXR0cltoXT1hLmxpX2F0dHJbaF0pO2lmKGwubGlfYXR0ci5pZHx8KGwubGlfYXR0ci5pZD1lKSxhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5hX2F0dHIpZm9yKGggaW4gYS5hX2F0dHIpYS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaCkmJihsLmFfYXR0cltoXT1hLmFfYXR0cltoXSk7Zm9yKGEmJmEuY2hpbGRyZW4mJmEuY2hpbGRyZW49PT0hMCYmKGwuc3RhdGUubG9hZGVkPSExLGwuY2hpbGRyZW49W10sbC5jaGlsZHJlbl9kPVtdKSxmW2wuaWRdPWwsaD0wLGk9bC5jaGlsZHJlbi5sZW5ndGg7aT5oO2grKylqPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fZmxhdF9qc29uKGZbbC5jaGlsZHJlbltoXV0sbC5pZCxkKSxrPWZbal0sbC5jaGlsZHJlbl9kLnB1c2goaiksay5jaGlsZHJlbl9kLmxlbmd0aCYmKGwuY2hpbGRyZW5fZD1sLmNoaWxkcmVuX2QuY29uY2F0KGsuY2hpbGRyZW5fZCkpO3JldHVybiBkZWxldGUgYS5kYXRhLGRlbGV0ZSBhLmNoaWxkcmVuLGZbbC5pZF0ub3JpZ2luYWw9YSxsLnN0YXRlLnNlbGVjdGVkJiZ0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQucHVzaChsLmlkKSxsLmlkfSxfcGFyc2VfbW9kZWxfZnJvbV9qc29uOmZ1bmN0aW9uKGEsYyxkKXtkPWQ/ZC5jb25jYXQoKTpbXSxjJiZkLnVuc2hpZnQoYyk7dmFyIGU9ITEsZixnLGgsaSxqPXRoaXMuX21vZGVsLmRhdGEsaz10aGlzLl9tb2RlbC5kZWZhdWx0X3N0YXRlLGw7ZG8gZT1cImpcIit0aGlzLl9pZCtcIl9cIisgKyt0aGlzLl9jbnQ7d2hpbGUoaltlXSk7bD17aWQ6ITEsdGV4dDpcInN0cmluZ1wiPT10eXBlb2YgYT9hOlwiXCIsaWNvbjpcIm9iamVjdFwiPT10eXBlb2YgYSYmYS5pY29uIT09Yj9hLmljb246ITAscGFyZW50OmMscGFyZW50czpkLGNoaWxkcmVuOltdLGNoaWxkcmVuX2Q6W10sZGF0YTpudWxsLHN0YXRlOnt9LGxpX2F0dHI6e2lkOiExfSxhX2F0dHI6e2hyZWY6XCIjXCJ9LG9yaWdpbmFsOiExfTtmb3IoZiBpbiBrKWsuaGFzT3duUHJvcGVydHkoZikmJihsLnN0YXRlW2ZdPWtbZl0pO2lmKGEmJmEuaWQmJihsLmlkPWEuaWQudG9TdHJpbmcoKSksYSYmYS50ZXh0JiYobC50ZXh0PWEudGV4dCksYSYmYS5kYXRhJiZhLmRhdGEuanN0cmVlJiZhLmRhdGEuanN0cmVlLmljb24mJihsLmljb249YS5kYXRhLmpzdHJlZS5pY29uKSxsLmljb24hPT1iJiZudWxsIT09bC5pY29uJiZcIlwiIT09bC5pY29ufHwobC5pY29uPSEwKSxhJiZhLmRhdGEmJihsLmRhdGE9YS5kYXRhLGEuZGF0YS5qc3RyZWUpKWZvcihmIGluIGEuZGF0YS5qc3RyZWUpYS5kYXRhLmpzdHJlZS5oYXNPd25Qcm9wZXJ0eShmKSYmKGwuc3RhdGVbZl09YS5kYXRhLmpzdHJlZVtmXSk7aWYoYSYmXCJvYmplY3RcIj09dHlwZW9mIGEuc3RhdGUpZm9yKGYgaW4gYS5zdGF0ZSlhLnN0YXRlLmhhc093blByb3BlcnR5KGYpJiYobC5zdGF0ZVtmXT1hLnN0YXRlW2ZdKTtpZihhJiZcIm9iamVjdFwiPT10eXBlb2YgYS5saV9hdHRyKWZvcihmIGluIGEubGlfYXR0cilhLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoZikmJihsLmxpX2F0dHJbZl09YS5saV9hdHRyW2ZdKTtpZihsLmxpX2F0dHIuaWQmJiFsLmlkJiYobC5pZD1sLmxpX2F0dHIuaWQudG9TdHJpbmcoKSksbC5pZHx8KGwuaWQ9ZSksbC5saV9hdHRyLmlkfHwobC5saV9hdHRyLmlkPWwuaWQpLGEmJlwib2JqZWN0XCI9PXR5cGVvZiBhLmFfYXR0cilmb3IoZiBpbiBhLmFfYXR0cilhLmFfYXR0ci5oYXNPd25Qcm9wZXJ0eShmKSYmKGwuYV9hdHRyW2ZdPWEuYV9hdHRyW2ZdKTtpZihhJiZhLmNoaWxkcmVuJiZhLmNoaWxkcmVuLmxlbmd0aCl7Zm9yKGY9MCxnPWEuY2hpbGRyZW4ubGVuZ3RoO2c+ZjtmKyspaD10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24oYS5jaGlsZHJlbltmXSxsLmlkLGQpLGk9altoXSxsLmNoaWxkcmVuLnB1c2goaCksaS5jaGlsZHJlbl9kLmxlbmd0aCYmKGwuY2hpbGRyZW5fZD1sLmNoaWxkcmVuX2QuY29uY2F0KGkuY2hpbGRyZW5fZCkpO2wuY2hpbGRyZW5fZD1sLmNoaWxkcmVuX2QuY29uY2F0KGwuY2hpbGRyZW4pfXJldHVybiBhJiZhLmNoaWxkcmVuJiZhLmNoaWxkcmVuPT09ITAmJihsLnN0YXRlLmxvYWRlZD0hMSxsLmNoaWxkcmVuPVtdLGwuY2hpbGRyZW5fZD1bXSksZGVsZXRlIGEuZGF0YSxkZWxldGUgYS5jaGlsZHJlbixsLm9yaWdpbmFsPWEsaltsLmlkXT1sLGwuc3RhdGUuc2VsZWN0ZWQmJnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGwuaWQpLGwuaWR9LF9yZWRyYXc6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz90aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuLmNvbmNhdChbXSk6dGhpcy5fbW9kZWwuY2hhbmdlZC5jb25jYXQoW10pLGM9aS5jcmVhdGVFbGVtZW50KFwiVUxcIiksZCxlLGYsZz10aGlzLl9kYXRhLmNvcmUuZm9jdXNlZDtmb3IoZT0wLGY9Yi5sZW5ndGg7Zj5lO2UrKylkPXRoaXMucmVkcmF3X25vZGUoYltlXSwhMCx0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdyksZCYmdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXcmJmMuYXBwZW5kQ2hpbGQoZCk7dGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXcmJihjLmNsYXNzTmFtZT10aGlzLmdldF9jb250YWluZXJfdWwoKVswXS5jbGFzc05hbWUsYy5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSx0aGlzLmVsZW1lbnQuZW1wdHkoKS5hcHBlbmQoYykpLG51bGwhPT1nJiYoZD10aGlzLmdldF9ub2RlKGcsITApLGQmJmQubGVuZ3RoJiZkLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIilbMF0hPT1pLmFjdGl2ZUVsZW1lbnQ/ZC5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCk6dGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bnVsbCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITEsdGhpcy5fbW9kZWwuY2hhbmdlZD1bXSx0aGlzLnRyaWdnZXIoXCJyZWRyYXdcIix7bm9kZXM6Yn0pfSxyZWRyYXc6ZnVuY3Rpb24oYSl7YSYmKHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3PSEwKSx0aGlzLl9yZWRyYXcoKX0sZHJhd19jaGlsZHJlbjpmdW5jdGlvbihiKXt2YXIgYz10aGlzLmdldF9ub2RlKGIpLGQ9ITEsZT0hMSxmPSExLGc9aTtpZighYylyZXR1cm4hMTtpZihjLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4gdGhpcy5yZWRyYXcoITApO2lmKGI9dGhpcy5nZXRfbm9kZShiLCEwKSwhYnx8IWIubGVuZ3RoKXJldHVybiExO2lmKGIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnJlbW92ZSgpLGI9YlswXSxjLmNoaWxkcmVuLmxlbmd0aCYmYy5zdGF0ZS5sb2FkZWQpe2ZvcihmPWcuY3JlYXRlRWxlbWVudChcIlVMXCIpLGYuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiZ3JvdXBcIiksZi5jbGFzc05hbWU9XCJqc3RyZWUtY2hpbGRyZW5cIixkPTAsZT1jLmNoaWxkcmVuLmxlbmd0aDtlPmQ7ZCsrKWYuYXBwZW5kQ2hpbGQodGhpcy5yZWRyYXdfbm9kZShjLmNoaWxkcmVuW2RdLCEwLCEwKSk7Yi5hcHBlbmRDaGlsZChmKX19LHJlZHJhd19ub2RlOmZ1bmN0aW9uKGIsYyxkLGUpe3ZhciBmPXRoaXMuZ2V0X25vZGUoYiksZz0hMSxoPSExLGs9ITEsbD0hMSxtPSExLG49ITEsbz1cIlwiLHA9aSxxPXRoaXMuX21vZGVsLmRhdGEscj0hMSxzPSExLHQ9bnVsbCx1PTAsdj0wLHc9ITEseD0hMTtpZighZilyZXR1cm4hMTtpZihmLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4gdGhpcy5yZWRyYXcoITApO2lmKGM9Y3x8MD09PWYuY2hpbGRyZW4ubGVuZ3RoLGI9aS5xdWVyeVNlbGVjdG9yP3RoaXMuZWxlbWVudFswXS5xdWVyeVNlbGVjdG9yKFwiI1wiKygtMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoZi5pZFswXSk/XCJcXFxcM1wiK2YuaWRbMF0rXCIgXCIrZi5pZC5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmYuaWQucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpKSk6aS5nZXRFbGVtZW50QnlJZChmLmlkKSliPWEoYiksXG5kfHwoZz1iLnBhcmVudCgpLnBhcmVudCgpWzBdLGc9PT10aGlzLmVsZW1lbnRbMF0mJihnPW51bGwpLGg9Yi5pbmRleCgpKSxjfHwhZi5jaGlsZHJlbi5sZW5ndGh8fGIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmxlbmd0aHx8KGM9ITApLGN8fChrPWIuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKSxyPWIuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKVswXT09PWkuYWN0aXZlRWxlbWVudCxiLnJlbW92ZSgpO2Vsc2UgaWYoYz0hMCwhZCl7aWYoZz1mLnBhcmVudCE9PWEuanN0cmVlLnJvb3Q/YShcIiNcIitmLnBhcmVudC5yZXBsYWNlKGEuanN0cmVlLmlkcmVnZXgsXCJcXFxcJCZcIiksdGhpcy5lbGVtZW50KVswXTpudWxsLCEobnVsbD09PWd8fGcmJnFbZi5wYXJlbnRdLnN0YXRlLm9wZW5lZCkpcmV0dXJuITE7aD1hLmluQXJyYXkoZi5pZCxudWxsPT09Zz9xW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuOnFbZi5wYXJlbnRdLmNoaWxkcmVuKX1iPWouY2xvbmVOb2RlKCEwKSxvPVwianN0cmVlLW5vZGUgXCI7Zm9yKGwgaW4gZi5saV9hdHRyKWlmKGYubGlfYXR0ci5oYXNPd25Qcm9wZXJ0eShsKSl7aWYoXCJpZFwiPT09bCljb250aW51ZTtcImNsYXNzXCIhPT1sP2Iuc2V0QXR0cmlidXRlKGwsZi5saV9hdHRyW2xdKTpvKz1mLmxpX2F0dHJbbF19Zm9yKGYuYV9hdHRyLmlkfHwoZi5hX2F0dHIuaWQ9Zi5pZCtcIl9hbmNob3JcIiksYi5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNlbGVjdGVkXCIsISFmLnN0YXRlLnNlbGVjdGVkKSxiLnNldEF0dHJpYnV0ZShcImFyaWEtbGV2ZWxcIixmLnBhcmVudHMubGVuZ3RoKSxiLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxsZWRieVwiLGYuYV9hdHRyLmlkKSxmLnN0YXRlLmRpc2FibGVkJiZiLnNldEF0dHJpYnV0ZShcImFyaWEtZGlzYWJsZWRcIiwhMCksbD0wLG09Zi5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKylpZighcVtmLmNoaWxkcmVuW2xdXS5zdGF0ZS5oaWRkZW4pe3c9ITA7YnJlYWt9aWYobnVsbCE9PWYucGFyZW50JiZxW2YucGFyZW50XSYmIWYuc3RhdGUuaGlkZGVuJiYobD1hLmluQXJyYXkoZi5pZCxxW2YucGFyZW50XS5jaGlsZHJlbikseD1mLmlkLC0xIT09bCkpZm9yKGwrKyxtPXFbZi5wYXJlbnRdLmNoaWxkcmVuLmxlbmd0aDttPmw7bCsrKWlmKHFbcVtmLnBhcmVudF0uY2hpbGRyZW5bbF1dLnN0YXRlLmhpZGRlbnx8KHg9cVtmLnBhcmVudF0uY2hpbGRyZW5bbF0pLHghPT1mLmlkKWJyZWFrO2Yuc3RhdGUuaGlkZGVuJiYobys9XCIganN0cmVlLWhpZGRlblwiKSxmLnN0YXRlLmxvYWRlZCYmIXc/bys9XCIganN0cmVlLWxlYWZcIjoobys9Zi5zdGF0ZS5vcGVuZWQmJmYuc3RhdGUubG9hZGVkP1wiIGpzdHJlZS1vcGVuXCI6XCIganN0cmVlLWNsb3NlZFwiLGIuc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLGYuc3RhdGUub3BlbmVkJiZmLnN0YXRlLmxvYWRlZCkpLHg9PT1mLmlkJiYobys9XCIganN0cmVlLWxhc3RcIiksYi5pZD1mLmlkLGIuY2xhc3NOYW1lPW8sbz0oZi5zdGF0ZS5zZWxlY3RlZD9cIiBqc3RyZWUtY2xpY2tlZFwiOlwiXCIpKyhmLnN0YXRlLmRpc2FibGVkP1wiIGpzdHJlZS1kaXNhYmxlZFwiOlwiXCIpO2ZvcihtIGluIGYuYV9hdHRyKWlmKGYuYV9hdHRyLmhhc093blByb3BlcnR5KG0pKXtpZihcImhyZWZcIj09PW0mJlwiI1wiPT09Zi5hX2F0dHJbbV0pY29udGludWU7XCJjbGFzc1wiIT09bT9iLmNoaWxkTm9kZXNbMV0uc2V0QXR0cmlidXRlKG0sZi5hX2F0dHJbbV0pOm8rPVwiIFwiK2YuYV9hdHRyW21dfWlmKG8ubGVuZ3RoJiYoYi5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZT1cImpzdHJlZS1hbmNob3IgXCIrbyksKGYuaWNvbiYmZi5pY29uIT09ITB8fGYuaWNvbj09PSExKSYmKGYuaWNvbj09PSExP2IuY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLmNsYXNzTmFtZSs9XCIganN0cmVlLXRoZW1laWNvbi1oaWRkZW5cIjotMT09PWYuaWNvbi5pbmRleE9mKFwiL1wiKSYmLTE9PT1mLmljb24uaW5kZXhPZihcIi5cIik/Yi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBcIitmLmljb24rXCIganN0cmVlLXRoZW1laWNvbi1jdXN0b21cIjooYi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZEltYWdlPSd1cmwoXCInK2YuaWNvbisnXCIpJyxiLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb249XCJjZW50ZXIgY2VudGVyXCIsYi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFNpemU9XCJhdXRvXCIsYi5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lKz1cIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKSksdGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQ/Yi5jaGlsZE5vZGVzWzFdLmFwcGVuZENoaWxkKHAuY3JlYXRlVGV4dE5vZGUoZi50ZXh0KSk6Yi5jaGlsZE5vZGVzWzFdLmlubmVySFRNTCs9Zi50ZXh0LGMmJmYuY2hpbGRyZW4ubGVuZ3RoJiYoZi5zdGF0ZS5vcGVuZWR8fGUpJiZmLnN0YXRlLmxvYWRlZCl7Zm9yKG49cC5jcmVhdGVFbGVtZW50KFwiVUxcIiksbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJncm91cFwiKSxuLmNsYXNzTmFtZT1cImpzdHJlZS1jaGlsZHJlblwiLGw9MCxtPWYuY2hpbGRyZW4ubGVuZ3RoO20+bDtsKyspbi5hcHBlbmRDaGlsZCh0aGlzLnJlZHJhd19ub2RlKGYuY2hpbGRyZW5bbF0sYywhMCkpO2IuYXBwZW5kQ2hpbGQobil9aWYoayYmYi5hcHBlbmRDaGlsZChrKSwhZCl7Zm9yKGd8fChnPXRoaXMuZWxlbWVudFswXSksbD0wLG09Zy5jaGlsZE5vZGVzLmxlbmd0aDttPmw7bCsrKWlmKGcuY2hpbGROb2Rlc1tsXSYmZy5jaGlsZE5vZGVzW2xdLmNsYXNzTmFtZSYmLTEhPT1nLmNoaWxkTm9kZXNbbF0uY2xhc3NOYW1lLmluZGV4T2YoXCJqc3RyZWUtY2hpbGRyZW5cIikpe3Q9Zy5jaGlsZE5vZGVzW2xdO2JyZWFrfXR8fCh0PXAuY3JlYXRlRWxlbWVudChcIlVMXCIpLHQuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiZ3JvdXBcIiksdC5jbGFzc05hbWU9XCJqc3RyZWUtY2hpbGRyZW5cIixnLmFwcGVuZENoaWxkKHQpKSxnPXQsaDxnLmNoaWxkTm9kZXMubGVuZ3RoP2cuaW5zZXJ0QmVmb3JlKGIsZy5jaGlsZE5vZGVzW2hdKTpnLmFwcGVuZENoaWxkKGIpLHImJih1PXRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3Asdj10aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdCxiLmNoaWxkTm9kZXNbMV0uZm9jdXMoKSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsVG9wPXUsdGhpcy5lbGVtZW50WzBdLnNjcm9sbExlZnQ9dil9cmV0dXJuIGYuc3RhdGUub3BlbmVkJiYhZi5zdGF0ZS5sb2FkZWQmJihmLnN0YXRlLm9wZW5lZD0hMSxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLm9wZW5fbm9kZShmLmlkLCExLDApfSx0aGlzKSwwKSksYn0sb3Blbl9ub2RlOmZ1bmN0aW9uKGMsZCxlKXt2YXIgZixnLGgsaTtpZihhLmlzQXJyYXkoYykpe2ZvcihjPWMuc2xpY2UoKSxmPTAsZz1jLmxlbmd0aDtnPmY7ZisrKXRoaXMub3Blbl9ub2RlKGNbZl0sZCxlKTtyZXR1cm4hMH1yZXR1cm4gYz10aGlzLmdldF9ub2RlKGMpLGMmJmMuaWQhPT1hLmpzdHJlZS5yb290PyhlPWU9PT1iP3RoaXMuc2V0dGluZ3MuY29yZS5hbmltYXRpb246ZSx0aGlzLmlzX2Nsb3NlZChjKT90aGlzLmlzX2xvYWRlZChjKT8oaD10aGlzLmdldF9ub2RlKGMsITApLGk9dGhpcyxoLmxlbmd0aCYmKGUmJmguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmxlbmd0aCYmaC5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikuc3RvcCghMCwhMCksYy5jaGlsZHJlbi5sZW5ndGgmJiF0aGlzLl9maXJzdENoaWxkKGguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpWzBdKSYmdGhpcy5kcmF3X2NoaWxkcmVuKGMpLGU/KHRoaXMudHJpZ2dlcihcImJlZm9yZV9vcGVuXCIse25vZGU6Y30pLGguY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmNzcyhcImRpc3BsYXlcIixcIm5vbmVcIikuZW5kKCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpLmFkZENsYXNzKFwianN0cmVlLW9wZW5cIikuYXR0cihcImFyaWEtZXhwYW5kZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLnN0b3AoITAsITApLnNsaWRlRG93bihlLGZ1bmN0aW9uKCl7dGhpcy5zdHlsZS5kaXNwbGF5PVwiXCIsaS50cmlnZ2VyKFwiYWZ0ZXJfb3BlblwiLHtub2RlOmN9KX0pKToodGhpcy50cmlnZ2VyKFwiYmVmb3JlX29wZW5cIix7bm9kZTpjfSksaFswXS5jbGFzc05hbWU9aFswXS5jbGFzc05hbWUucmVwbGFjZShcImpzdHJlZS1jbG9zZWRcIixcImpzdHJlZS1vcGVuXCIpLGhbMF0uc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLCEwKSkpLGMuc3RhdGUub3BlbmVkPSEwLGQmJmQuY2FsbCh0aGlzLGMsITApLGgubGVuZ3RofHx0aGlzLnRyaWdnZXIoXCJiZWZvcmVfb3BlblwiLHtub2RlOmN9KSx0aGlzLnRyaWdnZXIoXCJvcGVuX25vZGVcIix7bm9kZTpjfSksZSYmaC5sZW5ndGh8fHRoaXMudHJpZ2dlcihcImFmdGVyX29wZW5cIix7bm9kZTpjfSksITApOnRoaXMuaXNfbG9hZGluZyhjKT9zZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLm9wZW5fbm9kZShjLGQsZSl9LHRoaXMpLDUwMCk6dm9pZCB0aGlzLmxvYWRfbm9kZShjLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGI/dGhpcy5vcGVuX25vZGUoYSxkLGUpOmQ/ZC5jYWxsKHRoaXMsYSwhMSk6ITF9KTooZCYmZC5jYWxsKHRoaXMsYywhMSksITEpKTohMX0sX29wZW5fdG86ZnVuY3Rpb24oYil7aWYoYj10aGlzLmdldF9ub2RlKGIpLCFifHxiLmlkPT09YS5qc3RyZWUucm9vdClyZXR1cm4hMTt2YXIgYyxkLGU9Yi5wYXJlbnRzO2ZvcihjPTAsZD1lLmxlbmd0aDtkPmM7Yys9MSljIT09YS5qc3RyZWUucm9vdCYmdGhpcy5vcGVuX25vZGUoZVtjXSwhMSwwKTtyZXR1cm4gYShcIiNcIitiLmlkLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKSx0aGlzLmVsZW1lbnQpfSxjbG9zZV9ub2RlOmZ1bmN0aW9uKGMsZCl7dmFyIGUsZixnLGg7aWYoYS5pc0FycmF5KGMpKXtmb3IoYz1jLnNsaWNlKCksZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyl0aGlzLmNsb3NlX25vZGUoY1tlXSxkKTtyZXR1cm4hMH1yZXR1cm4gYz10aGlzLmdldF9ub2RlKGMpLGMmJmMuaWQhPT1hLmpzdHJlZS5yb290P3RoaXMuaXNfY2xvc2VkKGMpPyExOihkPWQ9PT1iP3RoaXMuc2V0dGluZ3MuY29yZS5hbmltYXRpb246ZCxnPXRoaXMsaD10aGlzLmdldF9ub2RlKGMsITApLGMuc3RhdGUub3BlbmVkPSExLHRoaXMudHJpZ2dlcihcImNsb3NlX25vZGVcIix7bm9kZTpjfSksdm9pZChoLmxlbmd0aD9kP2guY2hpbGRyZW4oXCIuanN0cmVlLWNoaWxkcmVuXCIpLmF0dHIoXCJzdHlsZVwiLFwiZGlzcGxheTpibG9jayAhaW1wb3J0YW50XCIpLmVuZCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW9wZW5cIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xvc2VkXCIpLmF0dHIoXCJhcmlhLWV4cGFuZGVkXCIsITEpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5zdG9wKCEwLCEwKS5zbGlkZVVwKGQsZnVuY3Rpb24oKXt0aGlzLnN0eWxlLmRpc3BsYXk9XCJcIixoLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGlsZHJlblwiKS5yZW1vdmUoKSxnLnRyaWdnZXIoXCJhZnRlcl9jbG9zZVwiLHtub2RlOmN9KX0pOihoWzBdLmNsYXNzTmFtZT1oWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFwianN0cmVlLW9wZW5cIixcImpzdHJlZS1jbG9zZWRcIiksaC5hdHRyKFwiYXJpYS1leHBhbmRlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hpbGRyZW5cIikucmVtb3ZlKCksdGhpcy50cmlnZ2VyKFwiYWZ0ZXJfY2xvc2VcIix7bm9kZTpjfSkpOnRoaXMudHJpZ2dlcihcImFmdGVyX2Nsb3NlXCIse25vZGU6Y30pKSk6ITF9LHRvZ2dsZV9ub2RlOmZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLnRvZ2dsZV9ub2RlKGJbY10pO3JldHVybiEwfXJldHVybiB0aGlzLmlzX2Nsb3NlZChiKT90aGlzLm9wZW5fbm9kZShiKTp0aGlzLmlzX29wZW4oYik/dGhpcy5jbG9zZV9ub2RlKGIpOnZvaWQgMH0sb3Blbl9hbGw6ZnVuY3Rpb24oYixjLGQpe2lmKGJ8fChiPWEuanN0cmVlLnJvb3QpLGI9dGhpcy5nZXRfbm9kZShiKSwhYilyZXR1cm4hMTt2YXIgZT1iLmlkPT09YS5qc3RyZWUucm9vdD90aGlzLmdldF9jb250YWluZXJfdWwoKTp0aGlzLmdldF9ub2RlKGIsITApLGYsZyxoO2lmKCFlLmxlbmd0aCl7Zm9yKGY9MCxnPWIuY2hpbGRyZW5fZC5sZW5ndGg7Zz5mO2YrKyl0aGlzLmlzX2Nsb3NlZCh0aGlzLl9tb2RlbC5kYXRhW2IuY2hpbGRyZW5fZFtmXV0pJiYodGhpcy5fbW9kZWwuZGF0YVtiLmNoaWxkcmVuX2RbZl1dLnN0YXRlLm9wZW5lZD0hMCk7cmV0dXJuIHRoaXMudHJpZ2dlcihcIm9wZW5fYWxsXCIse25vZGU6Yn0pfWQ9ZHx8ZSxoPXRoaXMsZT10aGlzLmlzX2Nsb3NlZChiKT9lLmZpbmQoXCIuanN0cmVlLWNsb3NlZFwiKS5hZGRCYWNrKCk6ZS5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIiksZS5lYWNoKGZ1bmN0aW9uKCl7aC5vcGVuX25vZGUodGhpcyxmdW5jdGlvbihhLGIpe2ImJnRoaXMuaXNfcGFyZW50KGEpJiZ0aGlzLm9wZW5fYWxsKGEsYyxkKX0sY3x8MCl9KSwwPT09ZC5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIikubGVuZ3RoJiZ0aGlzLnRyaWdnZXIoXCJvcGVuX2FsbFwiLHtub2RlOnRoaXMuZ2V0X25vZGUoZCl9KX0sY2xvc2VfYWxsOmZ1bmN0aW9uKGIsYyl7aWYoYnx8KGI9YS5qc3RyZWUucm9vdCksYj10aGlzLmdldF9ub2RlKGIpLCFiKXJldHVybiExO3ZhciBkPWIuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X2NvbnRhaW5lcl91bCgpOnRoaXMuZ2V0X25vZGUoYiwhMCksZT10aGlzLGYsZztmb3IoZC5sZW5ndGgmJihkPXRoaXMuaXNfb3BlbihiKT9kLmZpbmQoXCIuanN0cmVlLW9wZW5cIikuYWRkQmFjaygpOmQuZmluZChcIi5qc3RyZWUtb3BlblwiKSxhKGQuZ2V0KCkucmV2ZXJzZSgpKS5lYWNoKGZ1bmN0aW9uKCl7ZS5jbG9zZV9ub2RlKHRoaXMsY3x8MCl9KSksZj0wLGc9Yi5jaGlsZHJlbl9kLmxlbmd0aDtnPmY7ZisrKXRoaXMuX21vZGVsLmRhdGFbYi5jaGlsZHJlbl9kW2ZdXS5zdGF0ZS5vcGVuZWQ9ITE7dGhpcy50cmlnZ2VyKFwiY2xvc2VfYWxsXCIse25vZGU6Yn0pfSxpc19kaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmEuc3RhdGUmJmEuc3RhdGUuZGlzYWJsZWR9LGVuYWJsZV9ub2RlOmZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmVuYWJsZV9ub2RlKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGIuc3RhdGUuZGlzYWJsZWQ9ITEsdGhpcy5nZXRfbm9kZShiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWRpc2FibGVkXCIpLmF0dHIoXCJhcmlhLWRpc2FibGVkXCIsITEpLHZvaWQgdGhpcy50cmlnZ2VyKFwiZW5hYmxlX25vZGVcIix7bm9kZTpifSkpOiExfSxkaXNhYmxlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZDtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZGlzYWJsZV9ub2RlKGJbY10pO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGIuc3RhdGUuZGlzYWJsZWQ9ITAsdGhpcy5nZXRfbm9kZShiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLWRpc2FibGVkXCIpLmF0dHIoXCJhcmlhLWRpc2FibGVkXCIsITApLHZvaWQgdGhpcy50cmlnZ2VyKFwiZGlzYWJsZV9ub2RlXCIse25vZGU6Yn0pKTohMX0saXNfaGlkZGVuOmZ1bmN0aW9uKGEpe3JldHVybiBhPXRoaXMuZ2V0X25vZGUoYSksYS5zdGF0ZS5oaWRkZW49PT0hMH0saGlkZV9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuaGlkZV9ub2RlKGJbZF0sITApO3JldHVybiBjfHx0aGlzLnJlZHJhdygpLCEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/dm9pZChiLnN0YXRlLmhpZGRlbnx8KGIuc3RhdGUuaGlkZGVuPSEwLHRoaXMuX25vZGVfY2hhbmdlZChiLnBhcmVudCksY3x8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJoaWRlX25vZGVcIix7bm9kZTpifSkpKTohMX0sc2hvd19ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuc2hvd19ub2RlKGJbZF0sITApO3JldHVybiBjfHx0aGlzLnJlZHJhdygpLCEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/dm9pZChiLnN0YXRlLmhpZGRlbiYmKGIuc3RhdGUuaGlkZGVuPSExLHRoaXMuX25vZGVfY2hhbmdlZChiLnBhcmVudCksY3x8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJzaG93X25vZGVcIix7bm9kZTpifSkpKTohMX0saGlkZV9hbGw6ZnVuY3Rpb24oYil7dmFyIGMsZD10aGlzLl9tb2RlbC5kYXRhLGU9W107Zm9yKGMgaW4gZClkLmhhc093blByb3BlcnR5KGMpJiZjIT09YS5qc3RyZWUucm9vdCYmIWRbY10uc3RhdGUuaGlkZGVuJiYoZFtjXS5zdGF0ZS5oaWRkZW49ITAsZS5wdXNoKGMpKTtyZXR1cm4gdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITAsYnx8dGhpcy5yZWRyYXcoKSx0aGlzLnRyaWdnZXIoXCJoaWRlX2FsbFwiLHtub2RlczplfSksZX0sc2hvd19hbGw6ZnVuY3Rpb24oYil7dmFyIGMsZD10aGlzLl9tb2RlbC5kYXRhLGU9W107Zm9yKGMgaW4gZClkLmhhc093blByb3BlcnR5KGMpJiZjIT09YS5qc3RyZWUucm9vdCYmZFtjXS5zdGF0ZS5oaWRkZW4mJihkW2NdLnN0YXRlLmhpZGRlbj0hMSxlLnB1c2goYykpO3JldHVybiB0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCxifHx0aGlzLnJlZHJhdygpLHRoaXMudHJpZ2dlcihcInNob3dfYWxsXCIse25vZGVzOmV9KSxlfSxhY3RpdmF0ZV9ub2RlOmZ1bmN0aW9uKGEsYyl7aWYodGhpcy5pc19kaXNhYmxlZChhKSlyZXR1cm4hMTtpZihjJiZcIm9iamVjdFwiPT10eXBlb2YgY3x8KGM9e30pLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5pZCE9PWI/dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLmlkKTpudWxsLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQmJiF0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkLnN0YXRlLnNlbGVjdGVkJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD1udWxsKSwhdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZCYmdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aCYmKHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5nZXRfbm9kZSh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aC0xXSkpLHRoaXMuc2V0dGluZ3MuY29yZS5tdWx0aXBsZSYmKGMubWV0YUtleXx8Yy5jdHJsS2V5fHxjLnNoaWZ0S2V5KSYmKCFjLnNoaWZ0S2V5fHx0aGlzLl9kYXRhLmNvcmUubGFzdF9jbGlja2VkJiZ0aGlzLmdldF9wYXJlbnQoYSkmJnRoaXMuZ2V0X3BhcmVudChhKT09PXRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQucGFyZW50KSlpZihjLnNoaWZ0S2V5KXt2YXIgZD10aGlzLmdldF9ub2RlKGEpLmlkLGU9dGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5pZCxmPXRoaXMuZ2V0X25vZGUodGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZC5wYXJlbnQpLmNoaWxkcmVuLGc9ITEsaCxpO2ZvcihoPTAsaT1mLmxlbmd0aDtpPmg7aCs9MSlmW2hdPT09ZCYmKGc9IWcpLGZbaF09PT1lJiYoZz0hZyksdGhpcy5pc19kaXNhYmxlZChmW2hdKXx8IWcmJmZbaF0hPT1kJiZmW2hdIT09ZT90aGlzLmRlc2VsZWN0X25vZGUoZltoXSwhMCxjKTp0aGlzLmlzX2hpZGRlbihmW2hdKXx8dGhpcy5zZWxlY3Rfbm9kZShmW2hdLCEwLCExLGMpO3RoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwic2VsZWN0X25vZGVcIixub2RlOnRoaXMuZ2V0X25vZGUoYSksc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmN9KX1lbHNlIHRoaXMuaXNfc2VsZWN0ZWQoYSk/dGhpcy5kZXNlbGVjdF9ub2RlKGEsITEsYyk6dGhpcy5zZWxlY3Rfbm9kZShhLCExLCExLGMpO2Vsc2UhdGhpcy5zZXR0aW5ncy5jb3JlLm11bHRpcGxlJiYoYy5tZXRhS2V5fHxjLmN0cmxLZXl8fGMuc2hpZnRLZXkpJiZ0aGlzLmlzX3NlbGVjdGVkKGEpP3RoaXMuZGVzZWxlY3Rfbm9kZShhLCExLGMpOih0aGlzLmRlc2VsZWN0X2FsbCghMCksdGhpcy5zZWxlY3Rfbm9kZShhLCExLCExLGMpLHRoaXMuX2RhdGEuY29yZS5sYXN0X2NsaWNrZWQ9dGhpcy5nZXRfbm9kZShhKSk7dGhpcy50cmlnZ2VyKFwiYWN0aXZhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoYSksZXZlbnQ6Y30pfSxob3Zlcl9ub2RlOmZ1bmN0aW9uKGEpe2lmKGE9dGhpcy5nZXRfbm9kZShhLCEwKSwhYXx8IWEubGVuZ3RofHxhLmNoaWxkcmVuKFwiLmpzdHJlZS1ob3ZlcmVkXCIpLmxlbmd0aClyZXR1cm4hMTt2YXIgYj10aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtaG92ZXJlZFwiKSxjPXRoaXMuZWxlbWVudDtiJiZiLmxlbmd0aCYmdGhpcy5kZWhvdmVyX25vZGUoYiksYS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKFwianN0cmVlLWhvdmVyZWRcIiksdGhpcy50cmlnZ2VyKFwiaG92ZXJfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoYSl9KSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsYVswXS5pZCl9LDApfSxkZWhvdmVyX25vZGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9dGhpcy5nZXRfbm9kZShhLCEwKSxhJiZhLmxlbmd0aCYmYS5jaGlsZHJlbihcIi5qc3RyZWUtaG92ZXJlZFwiKS5sZW5ndGg/KGEuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1ob3ZlcmVkXCIpLHZvaWQgdGhpcy50cmlnZ2VyKFwiZGVob3Zlcl9ub2RlXCIse25vZGU6dGhpcy5nZXRfbm9kZShhKX0pKTohMX0sc2VsZWN0X25vZGU6ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGYsZyxoLGk7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZz0wLGg9Yi5sZW5ndGg7aD5nO2crKyl0aGlzLnNlbGVjdF9ub2RlKGJbZ10sYyxkLGUpO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGY9dGhpcy5nZXRfbm9kZShiLCEwKSx2b2lkKGIuc3RhdGUuc2VsZWN0ZWR8fChiLnN0YXRlLnNlbGVjdGVkPSEwLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5wdXNoKGIuaWQpLGR8fChmPXRoaXMuX29wZW5fdG8oYikpLGYmJmYubGVuZ3RoJiZmLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJzZWxlY3Rfbm9kZVwiLHtub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmV9KSxjfHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcInNlbGVjdF9ub2RlXCIsbm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxldmVudDplfSkpKSk6ITF9LGRlc2VsZWN0X25vZGU6ZnVuY3Rpb24oYixjLGQpe3ZhciBlLGYsZztpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxlPTAsZj1iLmxlbmd0aDtmPmU7ZSsrKXRoaXMuZGVzZWxlY3Rfbm9kZShiW2VdLGMsZCk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZz10aGlzLmdldF9ub2RlKGIsITApLHZvaWQoYi5zdGF0ZS5zZWxlY3RlZCYmKGIuc3RhdGUuc2VsZWN0ZWQ9ITEsdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X3JlbW92ZV9pdGVtKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxiLmlkKSxnLmxlbmd0aCYmZy5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNsaWNrZWRcIiksdGhpcy50cmlnZ2VyKFwiZGVzZWxlY3Rfbm9kZVwiLHtub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmR9KSxjfHx0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImRlc2VsZWN0X25vZGVcIixub2RlOmIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLGV2ZW50OmR9KSkpKTohMX0sc2VsZWN0X2FsbDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKSxkLGU7Zm9yKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZD10aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLmNoaWxkcmVuX2QuY29uY2F0KCksZD0wLGU9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmxlbmd0aDtlPmQ7ZCsrKXRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2RdXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkW2RdXS5zdGF0ZS5zZWxlY3RlZD0hMCk7dGhpcy5yZWRyYXcoITApLHRoaXMudHJpZ2dlcihcInNlbGVjdF9hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkfSksYnx8dGhpcy50cmlnZ2VyKFwiY2hhbmdlZFwiLHthY3Rpb246XCJzZWxlY3RfYWxsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG9sZF9zZWxlY3Rpb246Y30pfSxkZXNlbGVjdF9hbGw6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdChbXSksYyxkO2ZvcihjPTAsZD10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQubGVuZ3RoO2Q+YztjKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbY11dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWRbY11dLnN0YXRlLnNlbGVjdGVkPSExKTt0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9W10sdGhpcy5lbGVtZW50LmZpbmQoXCIuanN0cmVlLWNsaWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKS5wYXJlbnQoKS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCExKSx0aGlzLnRyaWdnZXIoXCJkZXNlbGVjdF9hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG5vZGU6Yn0pLGF8fHRoaXMudHJpZ2dlcihcImNoYW5nZWRcIix7YWN0aW9uOlwiZGVzZWxlY3RfYWxsXCIsc2VsZWN0ZWQ6dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLG9sZF9zZWxlY3Rpb246Yn0pfSxpc19zZWxlY3RlZDpmdW5jdGlvbihiKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2Iuc3RhdGUuc2VsZWN0ZWQ6ITF9LGdldF9zZWxlY3RlZDpmdW5jdGlvbihiKXtyZXR1cm4gYj9hLm1hcCh0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZC5zbGljZSgpfSxnZXRfdG9wX3NlbGVjdGVkOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMuZ2V0X3NlbGVjdGVkKCEwKSxkPXt9LGUsZixnLGg7Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZFtjW2VdLmlkXT1jW2VdO2ZvcihlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKWZvcihnPTAsaD1jW2VdLmNoaWxkcmVuX2QubGVuZ3RoO2g+ZztnKyspZFtjW2VdLmNoaWxkcmVuX2RbZ11dJiZkZWxldGUgZFtjW2VdLmNoaWxkcmVuX2RbZ11dO2M9W107Zm9yKGUgaW4gZClkLmhhc093blByb3BlcnR5KGUpJiZjLnB1c2goZSk7cmV0dXJuIGI/YS5tYXAoYyxhLnByb3h5KGZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmdldF9ub2RlKGEpfSx0aGlzKSk6Y30sZ2V0X2JvdHRvbV9zZWxlY3RlZDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLmdldF9zZWxlY3RlZCghMCksZD1bXSxlLGY7Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspY1tlXS5jaGlsZHJlbi5sZW5ndGh8fGQucHVzaChjW2VdLmlkKTtyZXR1cm4gYj9hLm1hcChkLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoYSl9LHRoaXMpKTpkfSxnZXRfc3RhdGU6ZnVuY3Rpb24oKXt2YXIgYj17Y29yZTp7b3BlbjpbXSxzY3JvbGw6e2xlZnQ6dGhpcy5lbGVtZW50LnNjcm9sbExlZnQoKSx0b3A6dGhpcy5lbGVtZW50LnNjcm9sbFRvcCgpfSxzZWxlY3RlZDpbXX19LGM7Zm9yKGMgaW4gdGhpcy5fbW9kZWwuZGF0YSl0aGlzLl9tb2RlbC5kYXRhLmhhc093blByb3BlcnR5KGMpJiZjIT09YS5qc3RyZWUucm9vdCYmKHRoaXMuX21vZGVsLmRhdGFbY10uc3RhdGUub3BlbmVkJiZiLmNvcmUub3Blbi5wdXNoKGMpLHRoaXMuX21vZGVsLmRhdGFbY10uc3RhdGUuc2VsZWN0ZWQmJmIuY29yZS5zZWxlY3RlZC5wdXNoKGMpKTtyZXR1cm4gYn0sc2V0X3N0YXRlOmZ1bmN0aW9uKGMsZCl7aWYoYyl7aWYoYy5jb3JlKXt2YXIgZSxmLGcsaCxpO2lmKGMuY29yZS5vcGVuKXJldHVybiBhLmlzQXJyYXkoYy5jb3JlLm9wZW4pJiZjLmNvcmUub3Blbi5sZW5ndGg/dGhpcy5fbG9hZF9ub2RlcyhjLmNvcmUub3BlbixmdW5jdGlvbihhKXt0aGlzLm9wZW5fbm9kZShhLCExLDApLGRlbGV0ZSBjLmNvcmUub3Blbix0aGlzLnNldF9zdGF0ZShjLGQpfSwhMCk6KGRlbGV0ZSBjLmNvcmUub3Blbix0aGlzLnNldF9zdGF0ZShjLGQpKSwhMTtpZihjLmNvcmUuc2Nyb2xsKXJldHVybiBjLmNvcmUuc2Nyb2xsJiZjLmNvcmUuc2Nyb2xsLmxlZnQhPT1iJiZ0aGlzLmVsZW1lbnQuc2Nyb2xsTGVmdChjLmNvcmUuc2Nyb2xsLmxlZnQpLGMuY29yZS5zY3JvbGwmJmMuY29yZS5zY3JvbGwudG9wIT09YiYmdGhpcy5lbGVtZW50LnNjcm9sbFRvcChjLmNvcmUuc2Nyb2xsLnRvcCksZGVsZXRlIGMuY29yZS5zY3JvbGwsdGhpcy5zZXRfc3RhdGUoYyxkKSwhMTtpZihjLmNvcmUuc2VsZWN0ZWQpcmV0dXJuIGg9dGhpcyx0aGlzLmRlc2VsZWN0X2FsbCgpLGEuZWFjaChjLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oYSxiKXtoLnNlbGVjdF9ub2RlKGIsITEsITApfSksZGVsZXRlIGMuY29yZS5zZWxlY3RlZCx0aGlzLnNldF9zdGF0ZShjLGQpLCExO2ZvcihpIGluIGMpYy5oYXNPd25Qcm9wZXJ0eShpKSYmXCJjb3JlXCIhPT1pJiYtMT09PWEuaW5BcnJheShpLHRoaXMuc2V0dGluZ3MucGx1Z2lucykmJmRlbGV0ZSBjW2ldO2lmKGEuaXNFbXB0eU9iamVjdChjLmNvcmUpKXJldHVybiBkZWxldGUgYy5jb3JlLHRoaXMuc2V0X3N0YXRlKGMsZCksITF9cmV0dXJuIGEuaXNFbXB0eU9iamVjdChjKT8oYz1udWxsLGQmJmQuY2FsbCh0aGlzKSx0aGlzLnRyaWdnZXIoXCJzZXRfc3RhdGVcIiksITEpOiEwfXJldHVybiExfSxyZWZyZXNoOmZ1bmN0aW9uKGIsYyl7dGhpcy5fZGF0YS5jb3JlLnN0YXRlPWM9PT0hMD97fTp0aGlzLmdldF9zdGF0ZSgpLGMmJmEuaXNGdW5jdGlvbihjKSYmKHRoaXMuX2RhdGEuY29yZS5zdGF0ZT1jLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUuc3RhdGUpKSx0aGlzLl9jbnQ9MCx0aGlzLl9tb2RlbC5kYXRhPXt9LHRoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF09e2lkOmEuanN0cmVlLnJvb3QscGFyZW50Om51bGwscGFyZW50czpbXSxjaGlsZHJlbjpbXSxjaGlsZHJlbl9kOltdLHN0YXRlOntsb2FkZWQ6ITF9fSx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQ9W10sdGhpcy5fZGF0YS5jb3JlLmxhc3RfY2xpY2tlZD1udWxsLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW51bGw7dmFyIGQ9dGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0uY2xhc3NOYW1lO2J8fCh0aGlzLmVsZW1lbnQuaHRtbChcIjx1bCBjbGFzcz0nXCIrZCtcIicgcm9sZT0nZ3JvdXAnPjxsaSBjbGFzcz0nanN0cmVlLWluaXRpYWwtbm9kZSBqc3RyZWUtbG9hZGluZyBqc3RyZWUtbGVhZiBqc3RyZWUtbGFzdCcgcm9sZT0ndHJlZWl0ZW0nIGlkPSdqXCIrdGhpcy5faWQrXCJfbG9hZGluZyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS1vY2wnPjwvaT48YSBjbGFzcz0nanN0cmVlLWFuY2hvcicgaHJlZj0nIyc+PGkgY2xhc3M9J2pzdHJlZS1pY29uIGpzdHJlZS10aGVtZWljb24taGlkZGVuJz48L2k+XCIrdGhpcy5nZXRfc3RyaW5nKFwiTG9hZGluZyAuLi5cIikrXCI8L2E+PC9saT48L3VsPlwiKSx0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLFwialwiK3RoaXMuX2lkK1wiX2xvYWRpbmdcIikpLHRoaXMubG9hZF9ub2RlKGEuanN0cmVlLnJvb3QsZnVuY3Rpb24oYixjKXtjJiYodGhpcy5nZXRfY29udGFpbmVyX3VsKClbMF0uY2xhc3NOYW1lPWQsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkmJnRoaXMuZWxlbWVudC5hdHRyKFwiYXJpYS1hY3RpdmVkZXNjZW5kYW50XCIsdGhpcy5fZmlyc3RDaGlsZCh0aGlzLmdldF9jb250YWluZXJfdWwoKVswXSkuaWQpLHRoaXMuc2V0X3N0YXRlKGEuZXh0ZW5kKCEwLHt9LHRoaXMuX2RhdGEuY29yZS5zdGF0ZSksZnVuY3Rpb24oKXt0aGlzLnRyaWdnZXIoXCJyZWZyZXNoXCIpfSkpLHRoaXMuX2RhdGEuY29yZS5zdGF0ZT1udWxsfSl9LHJlZnJlc2hfbm9kZTpmdW5jdGlvbihiKXtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBjPVtdLGQ9W10sZT10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KFtdKTtkLnB1c2goYi5pZCksYi5zdGF0ZS5vcGVuZWQ9PT0hMCYmYy5wdXNoKGIuaWQpLHRoaXMuZ2V0X25vZGUoYiwhMCkuZmluZChcIi5qc3RyZWUtb3BlblwiKS5lYWNoKGZ1bmN0aW9uKCl7ZC5wdXNoKHRoaXMuaWQpLGMucHVzaCh0aGlzLmlkKX0pLHRoaXMuX2xvYWRfbm9kZXMoZCxhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMub3Blbl9ub2RlKGMsITEsMCksdGhpcy5zZWxlY3Rfbm9kZShlKSx0aGlzLnRyaWdnZXIoXCJyZWZyZXNoX25vZGVcIix7bm9kZTpiLG5vZGVzOmF9KX0sdGhpcyksITEsITApfSxzZXRfaWQ6ZnVuY3Rpb24oYixjKXtpZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO3ZhciBkLGUsZj10aGlzLl9tb2RlbC5kYXRhLGc9Yi5pZDtmb3IoYz1jLnRvU3RyaW5nKCksZltiLnBhcmVudF0uY2hpbGRyZW5bYS5pbkFycmF5KGIuaWQsZltiLnBhcmVudF0uY2hpbGRyZW4pXT1jLGQ9MCxlPWIucGFyZW50cy5sZW5ndGg7ZT5kO2QrKylmW2IucGFyZW50c1tkXV0uY2hpbGRyZW5fZFthLmluQXJyYXkoYi5pZCxmW2IucGFyZW50c1tkXV0uY2hpbGRyZW5fZCldPWM7Zm9yKGQ9MCxlPWIuY2hpbGRyZW4ubGVuZ3RoO2U+ZDtkKyspZltiLmNoaWxkcmVuW2RdXS5wYXJlbnQ9Yztmb3IoZD0wLGU9Yi5jaGlsZHJlbl9kLmxlbmd0aDtlPmQ7ZCsrKWZbYi5jaGlsZHJlbl9kW2RdXS5wYXJlbnRzW2EuaW5BcnJheShiLmlkLGZbYi5jaGlsZHJlbl9kW2RdXS5wYXJlbnRzKV09YztyZXR1cm4gZD1hLmluQXJyYXkoYi5pZCx0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQpLC0xIT09ZCYmKHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZFtkXT1jKSxkPXRoaXMuZ2V0X25vZGUoYi5pZCwhMCksZCYmKGQuYXR0cihcImlkXCIsYyksdGhpcy5lbGVtZW50LmF0dHIoXCJhcmlhLWFjdGl2ZWRlc2NlbmRhbnRcIik9PT1iLmlkJiZ0aGlzLmVsZW1lbnQuYXR0cihcImFyaWEtYWN0aXZlZGVzY2VuZGFudFwiLGMpKSxkZWxldGUgZltiLmlkXSxiLmlkPWMsYi5saV9hdHRyLmlkPWMsZltjXT1iLHRoaXMudHJpZ2dlcihcInNldF9pZFwiLHtub2RlOmIsXCJuZXdcIjpiLmlkLG9sZDpnfSksITB9LGdldF90ZXh0OmZ1bmN0aW9uKGIpe3JldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/Yi50ZXh0OiExfSxzZXRfdGV4dDpmdW5jdGlvbihiLGMpe3ZhciBkLGU7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrKyl0aGlzLnNldF90ZXh0KGJbZF0sYyk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oYi50ZXh0PWMsdGhpcy5nZXRfbm9kZShiLCEwKS5sZW5ndGgmJnRoaXMucmVkcmF3X25vZGUoYi5pZCksdGhpcy50cmlnZ2VyKFwic2V0X3RleHRcIix7b2JqOmIsdGV4dDpjfSksITApOiExfSxnZXRfanNvbjpmdW5jdGlvbihiLGMsZCl7aWYoYj10aGlzLmdldF9ub2RlKGJ8fGEuanN0cmVlLnJvb3QpLCFiKXJldHVybiExO2MmJmMuZmxhdCYmIWQmJihkPVtdKTt2YXIgZT17aWQ6Yi5pZCx0ZXh0OmIudGV4dCxpY29uOnRoaXMuZ2V0X2ljb24oYiksbGlfYXR0cjphLmV4dGVuZCghMCx7fSxiLmxpX2F0dHIpLGFfYXR0cjphLmV4dGVuZCghMCx7fSxiLmFfYXR0ciksc3RhdGU6e30sZGF0YTpjJiZjLm5vX2RhdGE/ITE6YS5leHRlbmQoITAse30sYi5kYXRhKX0sZixnO2lmKGMmJmMuZmxhdD9lLnBhcmVudD1iLnBhcmVudDplLmNoaWxkcmVuPVtdLCFjfHwhYy5ub19zdGF0ZSlmb3IoZiBpbiBiLnN0YXRlKWIuc3RhdGUuaGFzT3duUHJvcGVydHkoZikmJihlLnN0YXRlW2ZdPWIuc3RhdGVbZl0pO2lmKGMmJmMubm9faWQmJihkZWxldGUgZS5pZCxlLmxpX2F0dHImJmUubGlfYXR0ci5pZCYmZGVsZXRlIGUubGlfYXR0ci5pZCxlLmFfYXR0ciYmZS5hX2F0dHIuaWQmJmRlbGV0ZSBlLmFfYXR0ci5pZCksYyYmYy5mbGF0JiZiLmlkIT09YS5qc3RyZWUucm9vdCYmZC5wdXNoKGUpLCFjfHwhYy5ub19jaGlsZHJlbilmb3IoZj0wLGc9Yi5jaGlsZHJlbi5sZW5ndGg7Zz5mO2YrKyljJiZjLmZsYXQ/dGhpcy5nZXRfanNvbihiLmNoaWxkcmVuW2ZdLGMsZCk6ZS5jaGlsZHJlbi5wdXNoKHRoaXMuZ2V0X2pzb24oYi5jaGlsZHJlbltmXSxjKSk7cmV0dXJuIGMmJmMuZmxhdD9kOmIuaWQ9PT1hLmpzdHJlZS5yb290P2UuY2hpbGRyZW46ZX0sY3JlYXRlX25vZGU6ZnVuY3Rpb24oYyxkLGUsZixnKXtpZihudWxsPT09YyYmKGM9YS5qc3RyZWUucm9vdCksYz10aGlzLmdldF9ub2RlKGMpLCFjKXJldHVybiExO2lmKGU9ZT09PWI/XCJsYXN0XCI6ZSwhZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJiFnJiYhdGhpcy5pc19sb2FkZWQoYykpcmV0dXJuIHRoaXMubG9hZF9ub2RlKGMsZnVuY3Rpb24oKXt0aGlzLmNyZWF0ZV9ub2RlKGMsZCxlLGYsITApfSk7ZHx8KGQ9e3RleHQ6dGhpcy5nZXRfc3RyaW5nKFwiTmV3IG5vZGVcIil9KSxcInN0cmluZ1wiPT10eXBlb2YgZCYmKGQ9e3RleHQ6ZH0pLGQudGV4dD09PWImJihkLnRleHQ9dGhpcy5nZXRfc3RyaW5nKFwiTmV3IG5vZGVcIikpO3ZhciBoLGksaixrO3N3aXRjaChjLmlkPT09YS5qc3RyZWUucm9vdCYmKFwiYmVmb3JlXCI9PT1lJiYoZT1cImZpcnN0XCIpLFwiYWZ0ZXJcIj09PWUmJihlPVwibGFzdFwiKSksZSl7Y2FzZVwiYmVmb3JlXCI6aD10aGlzLmdldF9ub2RlKGMucGFyZW50KSxlPWEuaW5BcnJheShjLmlkLGguY2hpbGRyZW4pLGM9aDticmVhaztjYXNlXCJhZnRlclwiOmg9dGhpcy5nZXRfbm9kZShjLnBhcmVudCksZT1hLmluQXJyYXkoYy5pZCxoLmNoaWxkcmVuKSsxLGM9aDticmVhaztjYXNlXCJpbnNpZGVcIjpjYXNlXCJmaXJzdFwiOmU9MDticmVhaztjYXNlXCJsYXN0XCI6ZT1jLmNoaWxkcmVuLmxlbmd0aDticmVhaztkZWZhdWx0OmV8fChlPTApfWlmKGU+Yy5jaGlsZHJlbi5sZW5ndGgmJihlPWMuY2hpbGRyZW4ubGVuZ3RoKSxkLmlkfHwoZC5pZD0hMCksIXRoaXMuY2hlY2soXCJjcmVhdGVfbm9kZVwiLGQsYyxlKSlyZXR1cm4gdGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITE7aWYoZC5pZD09PSEwJiZkZWxldGUgZC5pZCxkPXRoaXMuX3BhcnNlX21vZGVsX2Zyb21fanNvbihkLGMuaWQsYy5wYXJlbnRzLmNvbmNhdCgpKSwhZClyZXR1cm4hMTtmb3IoaD10aGlzLmdldF9ub2RlKGQpLGk9W10saS5wdXNoKGQpLGk9aS5jb25jYXQoaC5jaGlsZHJlbl9kKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczppLHBhcmVudDpjLmlkfSksYy5jaGlsZHJlbl9kPWMuY2hpbGRyZW5fZC5jb25jYXQoaSksaj0wLGs9Yy5wYXJlbnRzLmxlbmd0aDtrPmo7aisrKXRoaXMuX21vZGVsLmRhdGFbYy5wYXJlbnRzW2pdXS5jaGlsZHJlbl9kPXRoaXMuX21vZGVsLmRhdGFbYy5wYXJlbnRzW2pdXS5jaGlsZHJlbl9kLmNvbmNhdChpKTtmb3IoZD1oLGg9W10saj0wLGs9Yy5jaGlsZHJlbi5sZW5ndGg7az5qO2orKyloW2o+PWU/aisxOmpdPWMuY2hpbGRyZW5bal07cmV0dXJuIGhbZV09ZC5pZCxjLmNoaWxkcmVuPWgsdGhpcy5yZWRyYXdfbm9kZShjLCEwKSxmJiZmLmNhbGwodGhpcyx0aGlzLmdldF9ub2RlKGQpKSx0aGlzLnRyaWdnZXIoXCJjcmVhdGVfbm9kZVwiLHtub2RlOnRoaXMuZ2V0X25vZGUoZCkscGFyZW50OmMuaWQscG9zaXRpb246ZX0pLGQuaWR9LHJlbmFtZV9ub2RlOmZ1bmN0aW9uKGIsYyl7dmFyIGQsZSxmO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspdGhpcy5yZW5hbWVfbm9kZShiW2RdLGMpO3JldHVybiEwfXJldHVybiBiPXRoaXMuZ2V0X25vZGUoYiksYiYmYi5pZCE9PWEuanN0cmVlLnJvb3Q/KGY9Yi50ZXh0LHRoaXMuY2hlY2soXCJyZW5hbWVfbm9kZVwiLGIsdGhpcy5nZXRfcGFyZW50KGIpLGMpPyh0aGlzLnNldF90ZXh0KGIsYyksdGhpcy50cmlnZ2VyKFwicmVuYW1lX25vZGVcIix7bm9kZTpiLHRleHQ6YyxvbGQ6Zn0pLCEwKToodGhpcy5zZXR0aW5ncy5jb3JlLmVycm9yLmNhbGwodGhpcyx0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvciksITEpKTohMX0sZGVsZXRlX25vZGU6ZnVuY3Rpb24oYil7dmFyIGMsZCxlLGYsZyxoLGksaixrLGwsbSxuO2lmKGEuaXNBcnJheShiKSl7Zm9yKGI9Yi5zbGljZSgpLGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspdGhpcy5kZWxldGVfbm9kZShiW2NdKTtyZXR1cm4hMH1pZihiPXRoaXMuZ2V0X25vZGUoYiksIWJ8fGIuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO2lmKGU9dGhpcy5nZXRfbm9kZShiLnBhcmVudCksZj1hLmluQXJyYXkoYi5pZCxlLmNoaWxkcmVuKSxsPSExLCF0aGlzLmNoZWNrKFwiZGVsZXRlX25vZGVcIixiLGUsZikpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2ZvcigtMSE9PWYmJihlLmNoaWxkcmVuPWEudmFrYXRhLmFycmF5X3JlbW92ZShlLmNoaWxkcmVuLGYpKSxnPWIuY2hpbGRyZW5fZC5jb25jYXQoW10pLGcucHVzaChiLmlkKSxoPTAsaT1iLnBhcmVudHMubGVuZ3RoO2k+aDtoKyspdGhpcy5fbW9kZWwuZGF0YVtiLnBhcmVudHNbaF1dLmNoaWxkcmVuX2Q9YS52YWthdGEuYXJyYXlfZmlsdGVyKHRoaXMuX21vZGVsLmRhdGFbYi5wYXJlbnRzW2hdXS5jaGlsZHJlbl9kLGZ1bmN0aW9uKGIpe3JldHVybi0xPT09YS5pbkFycmF5KGIsZyl9KTtmb3Ioaj0wLGs9Zy5sZW5ndGg7az5qO2orKylpZih0aGlzLl9tb2RlbC5kYXRhW2dbal1dLnN0YXRlLnNlbGVjdGVkKXtsPSEwO2JyZWFrfWZvcihsJiYodGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X2ZpbHRlcih0aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQsZnVuY3Rpb24oYil7cmV0dXJuLTE9PT1hLmluQXJyYXkoYixnKX0pKSx0aGlzLnRyaWdnZXIoXCJkZWxldGVfbm9kZVwiLHtub2RlOmIscGFyZW50OmUuaWR9KSxsJiZ0aGlzLnRyaWdnZXIoXCJjaGFuZ2VkXCIse2FjdGlvbjpcImRlbGV0ZV9ub2RlXCIsbm9kZTpiLHNlbGVjdGVkOnRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCxwYXJlbnQ6ZS5pZH0pLGo9MCxrPWcubGVuZ3RoO2s+ajtqKyspZGVsZXRlIHRoaXMuX21vZGVsLmRhdGFbZ1tqXV07cmV0dXJuLTEhPT1hLmluQXJyYXkodGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQsZykmJih0aGlzLl9kYXRhLmNvcmUuZm9jdXNlZD1udWxsLG09dGhpcy5lbGVtZW50WzBdLnNjcm9sbFRvcCxuPXRoaXMuZWxlbWVudFswXS5zY3JvbGxMZWZ0LGUuaWQ9PT1hLmpzdHJlZS5yb290P3RoaXMuX21vZGVsLmRhdGFbYS5qc3RyZWUucm9vdF0uY2hpbGRyZW5bMF0mJnRoaXMuZ2V0X25vZGUodGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS5jaGlsZHJlblswXSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpOnRoaXMuZ2V0X25vZGUoZSwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpLHRoaXMuZWxlbWVudFswXS5zY3JvbGxUb3A9bSx0aGlzLmVsZW1lbnRbMF0uc2Nyb2xsTGVmdD1uKSx0aGlzLnJlZHJhd19ub2RlKGUsITApLCEwfSxjaGVjazpmdW5jdGlvbihiLGMsZCxlLGYpe2M9YyYmYy5pZD9jOnRoaXMuZ2V0X25vZGUoYyksZD1kJiZkLmlkP2Q6dGhpcy5nZXRfbm9kZShkKTt2YXIgZz1iLm1hdGNoKC9ebW92ZV9ub2RlfGNvcHlfbm9kZXxjcmVhdGVfbm9kZSQvaSk/ZDpjLGg9dGhpcy5zZXR0aW5ncy5jb3JlLmNoZWNrX2NhbGxiYWNrO3JldHVyblwibW92ZV9ub2RlXCIhPT1ifHxmJiZmLmlzX211bHRpfHxjLmlkIT09ZC5pZCYmKFwibW92ZV9ub2RlXCIhPT1ifHxhLmluQXJyYXkoYy5pZCxkLmNoaWxkcmVuKSE9PWUpJiYtMT09PWEuaW5BcnJheShkLmlkLGMuY2hpbGRyZW5fZCk/KGcmJmcuZGF0YSYmKGc9Zy5kYXRhKSxnJiZnLmZ1bmN0aW9ucyYmKGcuZnVuY3Rpb25zW2JdPT09ITF8fGcuZnVuY3Rpb25zW2JdPT09ITApPyhnLmZ1bmN0aW9uc1tiXT09PSExJiYodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAyXCIscmVhc29uOlwiTm9kZSBkYXRhIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpiLHBvczplLG9iajpjJiZjLmlkP2MuaWQ6ITEscGFyOmQmJmQuaWQ/ZC5pZDohMX0pfSksZy5mdW5jdGlvbnNbYl0pOmg9PT0hMXx8YS5pc0Z1bmN0aW9uKGgpJiZoLmNhbGwodGhpcyxiLGMsZCxlLGYpPT09ITF8fGgmJmhbYl09PT0hMT8odGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJjb3JlXCIsaWQ6XCJjb3JlXzAzXCIscmVhc29uOlwiVXNlciBjb25maWcgZm9yIGNvcmUuY2hlY2tfY2FsbGJhY2sgcHJldmVudHMgZnVuY3Rpb246IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmUsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZCYmZC5pZD9kLmlkOiExfSl9LCExKTohMCk6KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wMVwiLHJlYXNvbjpcIk1vdmluZyBwYXJlbnQgaW5zaWRlIGNoaWxkXCIsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmUsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZCYmZC5pZD9kLmlkOiExfSl9LCExKX0sbGFzdF9lcnJvcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcn0sbW92ZV9ub2RlOmZ1bmN0aW9uKGMsZCxlLGYsZyxoLGkpe3ZhciBqLGssbCxtLG4sbyxwLHEscixzLHQsdSx2LHc7aWYoZD10aGlzLmdldF9ub2RlKGQpLGU9ZT09PWI/MDplLCFkKXJldHVybiExO2lmKCFlLnRvU3RyaW5nKCkubWF0Y2goL14oYmVmb3JlfGFmdGVyKSQvKSYmIWcmJiF0aGlzLmlzX2xvYWRlZChkKSlyZXR1cm4gdGhpcy5sb2FkX25vZGUoZCxmdW5jdGlvbigpe3RoaXMubW92ZV9ub2RlKGMsZCxlLGYsITAsITEsaSl9KTtpZihhLmlzQXJyYXkoYykpe2lmKDEhPT1jLmxlbmd0aCl7Zm9yKGo9MCxrPWMubGVuZ3RoO2s+ajtqKyspKHI9dGhpcy5tb3ZlX25vZGUoY1tqXSxkLGUsZixnLCExLGkpKSYmKGQ9cixlPVwiYWZ0ZXJcIik7cmV0dXJuIHRoaXMucmVkcmF3KCksITB9Yz1jWzBdfWlmKGM9YyYmYy5pZD9jOnRoaXMuZ2V0X25vZGUoYyksIWN8fGMuaWQ9PT1hLmpzdHJlZS5yb290KXJldHVybiExO2lmKGw9KGMucGFyZW50fHxhLmpzdHJlZS5yb290KS50b1N0cmluZygpLG49ZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJmQuaWQhPT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X25vZGUoZC5wYXJlbnQpOmQsbz1pP2k6dGhpcy5fbW9kZWwuZGF0YVtjLmlkXT90aGlzOmEuanN0cmVlLnJlZmVyZW5jZShjLmlkKSxwPSFvfHwhby5faWR8fHRoaXMuX2lkIT09by5faWQsbT1vJiZvLl9pZCYmbCYmby5fbW9kZWwuZGF0YVtsXSYmby5fbW9kZWwuZGF0YVtsXS5jaGlsZHJlbj9hLmluQXJyYXkoYy5pZCxvLl9tb2RlbC5kYXRhW2xdLmNoaWxkcmVuKTotMSxvJiZvLl9pZCYmKGM9by5fbW9kZWwuZGF0YVtjLmlkXSkscClyZXR1cm4ocj10aGlzLmNvcHlfbm9kZShjLGQsZSxmLGcsITEsaSkpPyhvJiZvLmRlbGV0ZV9ub2RlKGMpLHIpOiExO3N3aXRjaChkLmlkPT09YS5qc3RyZWUucm9vdCYmKFwiYmVmb3JlXCI9PT1lJiYoZT1cImZpcnN0XCIpLFwiYWZ0ZXJcIj09PWUmJihlPVwibGFzdFwiKSksZSl7Y2FzZVwiYmVmb3JlXCI6ZT1hLmluQXJyYXkoZC5pZCxuLmNoaWxkcmVuKTticmVhaztjYXNlXCJhZnRlclwiOmU9YS5pbkFycmF5KGQuaWQsbi5jaGlsZHJlbikrMTticmVhaztjYXNlXCJpbnNpZGVcIjpjYXNlXCJmaXJzdFwiOmU9MDticmVhaztjYXNlXCJsYXN0XCI6ZT1uLmNoaWxkcmVuLmxlbmd0aDticmVhaztkZWZhdWx0OmV8fChlPTApfWlmKGU+bi5jaGlsZHJlbi5sZW5ndGgmJihlPW4uY2hpbGRyZW4ubGVuZ3RoKSwhdGhpcy5jaGVjayhcIm1vdmVfbm9kZVwiLGMsbixlLHtjb3JlOiEwLG9yaWdpbjppLGlzX211bHRpOm8mJm8uX2lkJiZvLl9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IW98fCFvLl9pZH0pKXJldHVybiB0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMTtpZihjLnBhcmVudD09PW4uaWQpe2ZvcihxPW4uY2hpbGRyZW4uY29uY2F0KCkscj1hLmluQXJyYXkoYy5pZCxxKSwtMSE9PXImJihxPWEudmFrYXRhLmFycmF5X3JlbW92ZShxLHIpLGU+ciYmZS0tKSxyPVtdLHM9MCx0PXEubGVuZ3RoO3Q+cztzKyspcltzPj1lP3MrMTpzXT1xW3NdO3JbZV09Yy5pZCxuLmNoaWxkcmVuPXIsdGhpcy5fbm9kZV9jaGFuZ2VkKG4uaWQpLHRoaXMucmVkcmF3KG4uaWQ9PT1hLmpzdHJlZS5yb290KX1lbHNle2ZvcihyPWMuY2hpbGRyZW5fZC5jb25jYXQoKSxyLnB1c2goYy5pZCkscz0wLHQ9Yy5wYXJlbnRzLmxlbmd0aDt0PnM7cysrKXtmb3IocT1bXSx3PW8uX21vZGVsLmRhdGFbYy5wYXJlbnRzW3NdXS5jaGlsZHJlbl9kLHU9MCx2PXcubGVuZ3RoO3Y+dTt1KyspLTE9PT1hLmluQXJyYXkod1t1XSxyKSYmcS5wdXNoKHdbdV0pO28uX21vZGVsLmRhdGFbYy5wYXJlbnRzW3NdXS5jaGlsZHJlbl9kPXF9Zm9yKG8uX21vZGVsLmRhdGFbbF0uY2hpbGRyZW49YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0oby5fbW9kZWwuZGF0YVtsXS5jaGlsZHJlbixjLmlkKSxzPTAsdD1uLnBhcmVudHMubGVuZ3RoO3Q+cztzKyspdGhpcy5fbW9kZWwuZGF0YVtuLnBhcmVudHNbc11dLmNoaWxkcmVuX2Q9dGhpcy5fbW9kZWwuZGF0YVtuLnBhcmVudHNbc11dLmNoaWxkcmVuX2QuY29uY2F0KHIpO2ZvcihxPVtdLHM9MCx0PW4uY2hpbGRyZW4ubGVuZ3RoO3Q+cztzKyspcVtzPj1lP3MrMTpzXT1uLmNoaWxkcmVuW3NdO2ZvcihxW2VdPWMuaWQsbi5jaGlsZHJlbj1xLG4uY2hpbGRyZW5fZC5wdXNoKGMuaWQpLG4uY2hpbGRyZW5fZD1uLmNoaWxkcmVuX2QuY29uY2F0KGMuY2hpbGRyZW5fZCksYy5wYXJlbnQ9bi5pZCxyPW4ucGFyZW50cy5jb25jYXQoKSxyLnVuc2hpZnQobi5pZCksdz1jLnBhcmVudHMubGVuZ3RoLGMucGFyZW50cz1yLHI9ci5jb25jYXQoKSxzPTAsdD1jLmNoaWxkcmVuX2QubGVuZ3RoO3Q+cztzKyspdGhpcy5fbW9kZWwuZGF0YVtjLmNoaWxkcmVuX2Rbc11dLnBhcmVudHM9dGhpcy5fbW9kZWwuZGF0YVtjLmNoaWxkcmVuX2Rbc11dLnBhcmVudHMuc2xpY2UoMCwtMSp3KSxBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSh0aGlzLl9tb2RlbC5kYXRhW2MuY2hpbGRyZW5fZFtzXV0ucGFyZW50cyxyKTtsIT09YS5qc3RyZWUucm9vdCYmbi5pZCE9PWEuanN0cmVlLnJvb3R8fCh0aGlzLl9tb2RlbC5mb3JjZV9mdWxsX3JlZHJhdz0hMCksdGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXd8fCh0aGlzLl9ub2RlX2NoYW5nZWQobCksdGhpcy5fbm9kZV9jaGFuZ2VkKG4uaWQpKSxofHx0aGlzLnJlZHJhdygpfXJldHVybiBmJiZmLmNhbGwodGhpcyxjLG4sZSksdGhpcy50cmlnZ2VyKFwibW92ZV9ub2RlXCIse25vZGU6YyxwYXJlbnQ6bi5pZCxwb3NpdGlvbjplLG9sZF9wYXJlbnQ6bCxvbGRfcG9zaXRpb246bSxpc19tdWx0aTpvJiZvLl9pZCYmby5faWQhPT10aGlzLl9pZCxpc19mb3JlaWduOiFvfHwhby5faWQsb2xkX2luc3RhbmNlOm8sbmV3X2luc3RhbmNlOnRoaXN9KSxjLmlkfSxjb3B5X25vZGU6ZnVuY3Rpb24oYyxkLGUsZixnLGgsaSl7dmFyIGosayxsLG0sbixvLHAscSxyLHMsdDtpZihkPXRoaXMuZ2V0X25vZGUoZCksZT1lPT09Yj8wOmUsIWQpcmV0dXJuITE7aWYoIWUudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhZyYmIXRoaXMuaXNfbG9hZGVkKGQpKXJldHVybiB0aGlzLmxvYWRfbm9kZShkLGZ1bmN0aW9uKCl7dGhpcy5jb3B5X25vZGUoYyxkLGUsZiwhMCwhMSxpKX0pO2lmKGEuaXNBcnJheShjKSl7aWYoMSE9PWMubGVuZ3RoKXtmb3Ioaj0wLGs9Yy5sZW5ndGg7az5qO2orKykobT10aGlzLmNvcHlfbm9kZShjW2pdLGQsZSxmLGcsITAsaSkpJiYoZD1tLGU9XCJhZnRlclwiKTtyZXR1cm4gdGhpcy5yZWRyYXcoKSwhMH1jPWNbMF19aWYoYz1jJiZjLmlkP2M6dGhpcy5nZXRfbm9kZShjKSwhY3x8Yy5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7c3dpdGNoKHE9KGMucGFyZW50fHxhLmpzdHJlZS5yb290KS50b1N0cmluZygpLHI9ZS50b1N0cmluZygpLm1hdGNoKC9eKGJlZm9yZXxhZnRlcikkLykmJmQuaWQhPT1hLmpzdHJlZS5yb290P3RoaXMuZ2V0X25vZGUoZC5wYXJlbnQpOmQscz1pP2k6dGhpcy5fbW9kZWwuZGF0YVtjLmlkXT90aGlzOmEuanN0cmVlLnJlZmVyZW5jZShjLmlkKSx0PSFzfHwhcy5faWR8fHRoaXMuX2lkIT09cy5faWQscyYmcy5faWQmJihjPXMuX21vZGVsLmRhdGFbYy5pZF0pLGQuaWQ9PT1hLmpzdHJlZS5yb290JiYoXCJiZWZvcmVcIj09PWUmJihlPVwiZmlyc3RcIiksXCJhZnRlclwiPT09ZSYmKGU9XCJsYXN0XCIpKSxlKXtjYXNlXCJiZWZvcmVcIjplPWEuaW5BcnJheShkLmlkLHIuY2hpbGRyZW4pO2JyZWFrO2Nhc2VcImFmdGVyXCI6ZT1hLmluQXJyYXkoZC5pZCxyLmNoaWxkcmVuKSsxO2JyZWFrO2Nhc2VcImluc2lkZVwiOmNhc2VcImZpcnN0XCI6ZT0wO2JyZWFrO2Nhc2VcImxhc3RcIjplPXIuY2hpbGRyZW4ubGVuZ3RoO2JyZWFrO2RlZmF1bHQ6ZXx8KGU9MCl9aWYoZT5yLmNoaWxkcmVuLmxlbmd0aCYmKGU9ci5jaGlsZHJlbi5sZW5ndGgpLCF0aGlzLmNoZWNrKFwiY29weV9ub2RlXCIsYyxyLGUse2NvcmU6ITAsb3JpZ2luOmksaXNfbXVsdGk6cyYmcy5faWQmJnMuX2lkIT09dGhpcy5faWQsaXNfZm9yZWlnbjohc3x8IXMuX2lkfSkpcmV0dXJuIHRoaXMuc2V0dGluZ3MuY29yZS5lcnJvci5jYWxsKHRoaXMsdGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3IpLCExO2lmKHA9cz9zLmdldF9qc29uKGMse25vX2lkOiEwLG5vX2RhdGE6ITAsbm9fc3RhdGU6ITB9KTpjLCFwKXJldHVybiExO2lmKHAuaWQ9PT0hMCYmZGVsZXRlIHAuaWQscD10aGlzLl9wYXJzZV9tb2RlbF9mcm9tX2pzb24ocCxyLmlkLHIucGFyZW50cy5jb25jYXQoKSksIXApcmV0dXJuITE7Zm9yKG09dGhpcy5nZXRfbm9kZShwKSxjJiZjLnN0YXRlJiZjLnN0YXRlLmxvYWRlZD09PSExJiYobS5zdGF0ZS5sb2FkZWQ9ITEpLGw9W10sbC5wdXNoKHApLGw9bC5jb25jYXQobS5jaGlsZHJlbl9kKSx0aGlzLnRyaWdnZXIoXCJtb2RlbFwiLHtub2RlczpsLHBhcmVudDpyLmlkfSksbj0wLG89ci5wYXJlbnRzLmxlbmd0aDtvPm47bisrKXRoaXMuX21vZGVsLmRhdGFbci5wYXJlbnRzW25dXS5jaGlsZHJlbl9kPXRoaXMuX21vZGVsLmRhdGFbci5wYXJlbnRzW25dXS5jaGlsZHJlbl9kLmNvbmNhdChsKTtmb3IobD1bXSxuPTAsbz1yLmNoaWxkcmVuLmxlbmd0aDtvPm47bisrKWxbbj49ZT9uKzE6bl09ci5jaGlsZHJlbltuXTtyZXR1cm4gbFtlXT1tLmlkLHIuY2hpbGRyZW49bCxyLmNoaWxkcmVuX2QucHVzaChtLmlkKSxyLmNoaWxkcmVuX2Q9ci5jaGlsZHJlbl9kLmNvbmNhdChtLmNoaWxkcmVuX2QpLHIuaWQ9PT1hLmpzdHJlZS5yb290JiYodGhpcy5fbW9kZWwuZm9yY2VfZnVsbF9yZWRyYXc9ITApLHRoaXMuX21vZGVsLmZvcmNlX2Z1bGxfcmVkcmF3fHx0aGlzLl9ub2RlX2NoYW5nZWQoci5pZCksaHx8dGhpcy5yZWRyYXcoci5pZD09PWEuanN0cmVlLnJvb3QpLGYmJmYuY2FsbCh0aGlzLG0scixlKSx0aGlzLnRyaWdnZXIoXCJjb3B5X25vZGVcIix7bm9kZTptLG9yaWdpbmFsOmMscGFyZW50OnIuaWQscG9zaXRpb246ZSxvbGRfcGFyZW50OnEsb2xkX3Bvc2l0aW9uOnMmJnMuX2lkJiZxJiZzLl9tb2RlbC5kYXRhW3FdJiZzLl9tb2RlbC5kYXRhW3FdLmNoaWxkcmVuP2EuaW5BcnJheShjLmlkLHMuX21vZGVsLmRhdGFbcV0uY2hpbGRyZW4pOi0xLGlzX211bHRpOnMmJnMuX2lkJiZzLl9pZCE9PXRoaXMuX2lkLGlzX2ZvcmVpZ246IXN8fCFzLl9pZCxvbGRfaW5zdGFuY2U6cyxuZXdfaW5zdGFuY2U6dGhpc30pLG0uaWR9LGN1dDpmdW5jdGlvbihiKXtpZihifHwoYj10aGlzLl9kYXRhLmNvcmUuc2VsZWN0ZWQuY29uY2F0KCkpLGEuaXNBcnJheShiKXx8KGI9W2JdKSwhYi5sZW5ndGgpcmV0dXJuITE7dmFyIGM9W10sZyxoLGk7Zm9yKGg9MCxpPWIubGVuZ3RoO2k+aDtoKyspZz10aGlzLmdldF9ub2RlKGJbaF0pLGcmJmcuaWQmJmcuaWQhPT1hLmpzdHJlZS5yb290JiZjLnB1c2goZyk7cmV0dXJuIGMubGVuZ3RoPyhkPWMsZj10aGlzLGU9XCJtb3ZlX25vZGVcIix2b2lkIHRoaXMudHJpZ2dlcihcImN1dFwiLHtub2RlOmJ9KSk6ITF9LGNvcHk6ZnVuY3Rpb24oYil7aWYoYnx8KGI9dGhpcy5fZGF0YS5jb3JlLnNlbGVjdGVkLmNvbmNhdCgpKSxhLmlzQXJyYXkoYil8fChiPVtiXSksIWIubGVuZ3RoKXJldHVybiExO3ZhciBjPVtdLGcsaCxpO2ZvcihoPTAsaT1iLmxlbmd0aDtpPmg7aCsrKWc9dGhpcy5nZXRfbm9kZShiW2hdKSxnJiZnLmlkJiZnLmlkIT09YS5qc3RyZWUucm9vdCYmYy5wdXNoKGcpO3JldHVybiBjLmxlbmd0aD8oZD1jLGY9dGhpcyxlPVwiY29weV9ub2RlXCIsdm9pZCB0aGlzLnRyaWdnZXIoXCJjb3B5XCIse25vZGU6Yn0pKTohMX0sZ2V0X2J1ZmZlcjpmdW5jdGlvbigpe3JldHVybnttb2RlOmUsbm9kZTpkLGluc3Q6Zn19LGNhbl9wYXN0ZTpmdW5jdGlvbigpe3JldHVybiBlIT09ITEmJmQhPT0hMX0scGFzdGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYT10aGlzLmdldF9ub2RlKGEpLGEmJmUmJmUubWF0Y2goL14oY29weV9ub2RlfG1vdmVfbm9kZSkkLykmJmQ/KHRoaXNbZV0oZCxhLGIsITEsITEsITEsZikmJnRoaXMudHJpZ2dlcihcInBhc3RlXCIse3BhcmVudDphLmlkLG5vZGU6ZCxtb2RlOmV9KSxkPSExLGU9ITEsdm9pZChmPSExKSk6ITF9LGNsZWFyX2J1ZmZlcjpmdW5jdGlvbigpe2Q9ITEsZT0hMSxmPSExLHRoaXMudHJpZ2dlcihcImNsZWFyX2J1ZmZlclwiKX0sZWRpdDpmdW5jdGlvbihiLGMsZCl7dmFyIGUsZixnLGgsaixrLGwsbSxuLG89ITE7cmV0dXJuKGI9dGhpcy5nZXRfbm9kZShiKSk/dGhpcy5zZXR0aW5ncy5jb3JlLmNoZWNrX2NhbGxiYWNrPT09ITE/KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwiY29yZVwiLGlkOlwiY29yZV8wN1wiLHJlYXNvbjpcIkNvdWxkIG5vdCBlZGl0IG5vZGUgYmVjYXVzZSBvZiBjaGVja19jYWxsYmFja1wifSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKSwhMSk6KG49YixjPVwic3RyaW5nXCI9PXR5cGVvZiBjP2M6Yi50ZXh0LHRoaXMuc2V0X3RleHQoYixcIlwiKSxiPXRoaXMuX29wZW5fdG8oYiksbi50ZXh0PWMsZT10aGlzLl9kYXRhLmNvcmUucnRsLGY9dGhpcy5lbGVtZW50LndpZHRoKCksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQ9bi5pZCxnPWIuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5mb2N1cygpLGg9YShcIjxzcGFuPlwiKSxqPWMsaz1hKFwiPGRpdiAvPlwiLHtjc3M6e3Bvc2l0aW9uOlwiYWJzb2x1dGVcIix0b3A6XCItMjAwcHhcIixsZWZ0OmU/XCIwcHhcIjpcIi0xMDAwcHhcIix2aXNpYmlsaXR5OlwiaGlkZGVuXCJ9fSkuYXBwZW5kVG8oXCJib2R5XCIpLGw9YShcIjxpbnB1dCAvPlwiLHt2YWx1ZTpqLFwiY2xhc3NcIjpcImpzdHJlZS1yZW5hbWUtaW5wdXRcIixjc3M6e3BhZGRpbmc6XCIwXCIsYm9yZGVyOlwiMXB4IHNvbGlkIHNpbHZlclwiLFwiYm94LXNpemluZ1wiOlwiYm9yZGVyLWJveFwiLGRpc3BsYXk6XCJpbmxpbmUtYmxvY2tcIixoZWlnaHQ6dGhpcy5fZGF0YS5jb3JlLmxpX2hlaWdodCtcInB4XCIsbGluZUhlaWdodDp0aGlzLl9kYXRhLmNvcmUubGlfaGVpZ2h0K1wicHhcIix3aWR0aDpcIjE1MHB4XCJ9LGJsdXI6YS5wcm94eShmdW5jdGlvbihjKXtjLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGMucHJldmVudERlZmF1bHQoKTt2YXIgZT1oLmNoaWxkcmVuKFwiLmpzdHJlZS1yZW5hbWUtaW5wdXRcIiksZj1lLnZhbCgpLGk9dGhpcy5zZXR0aW5ncy5jb3JlLmZvcmNlX3RleHQsbTtcIlwiPT09ZiYmKGY9aiksay5yZW1vdmUoKSxoLnJlcGxhY2VXaXRoKGcpLGgucmVtb3ZlKCksaj1pP2o6YShcIjxkaXY+PC9kaXY+XCIpLmFwcGVuZChhLnBhcnNlSFRNTChqKSkuaHRtbCgpLHRoaXMuc2V0X3RleHQoYixqKSxtPSEhdGhpcy5yZW5hbWVfbm9kZShiLGk/YShcIjxkaXY+PC9kaXY+XCIpLnRleHQoZikudGV4dCgpOmEoXCI8ZGl2PjwvZGl2PlwiKS5hcHBlbmQoYS5wYXJzZUhUTUwoZikpLmh0bWwoKSksbXx8dGhpcy5zZXRfdGV4dChiLGopLHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW4uaWQsc2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5nZXRfbm9kZShuLmlkLCEwKTthLmxlbmd0aCYmKHRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPW4uaWQsYS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmZvY3VzKCkpfSx0aGlzKSwwKSxkJiZkLmNhbGwodGhpcyxuLG0sbyksbD1udWxsfSx0aGlzKSxrZXlkb3duOmZ1bmN0aW9uKGEpe3ZhciBiPWEud2hpY2g7Mjc9PT1iJiYobz0hMCx0aGlzLnZhbHVlPWopLDI3IT09YiYmMTMhPT1iJiYzNyE9PWImJjM4IT09YiYmMzkhPT1iJiY0MCE9PWImJjMyIT09Ynx8YS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSwyNyE9PWImJjEzIT09Ynx8KGEucHJldmVudERlZmF1bHQoKSx0aGlzLmJsdXIoKSl9LGNsaWNrOmZ1bmN0aW9uKGEpe2Euc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCl9LG1vdXNlZG93bjpmdW5jdGlvbihhKXthLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpfSxrZXl1cDpmdW5jdGlvbihhKXtsLndpZHRoKE1hdGgubWluKGsudGV4dChcInBXXCIrdGhpcy52YWx1ZSkud2lkdGgoKSxmKSl9LGtleXByZXNzOmZ1bmN0aW9uKGEpe3JldHVybiAxMz09PWEud2hpY2g/ITE6dm9pZCAwfX0pLG09e2ZvbnRGYW1pbHk6Zy5jc3MoXCJmb250RmFtaWx5XCIpfHxcIlwiLGZvbnRTaXplOmcuY3NzKFwiZm9udFNpemVcIil8fFwiXCIsZm9udFdlaWdodDpnLmNzcyhcImZvbnRXZWlnaHRcIil8fFwiXCIsZm9udFN0eWxlOmcuY3NzKFwiZm9udFN0eWxlXCIpfHxcIlwiLGZvbnRTdHJldGNoOmcuY3NzKFwiZm9udFN0cmV0Y2hcIil8fFwiXCIsZm9udFZhcmlhbnQ6Zy5jc3MoXCJmb250VmFyaWFudFwiKXx8XCJcIixsZXR0ZXJTcGFjaW5nOmcuY3NzKFwibGV0dGVyU3BhY2luZ1wiKXx8XCJcIix3b3JkU3BhY2luZzpnLmNzcyhcIndvcmRTcGFjaW5nXCIpfHxcIlwifSxoLmF0dHIoXCJjbGFzc1wiLGcuYXR0cihcImNsYXNzXCIpKS5hcHBlbmQoZy5jb250ZW50cygpLmNsb25lKCkpLmFwcGVuZChsKSxnLnJlcGxhY2VXaXRoKGgpLGsuY3NzKG0pLGwuY3NzKG0pLndpZHRoKE1hdGgubWluKGsudGV4dChcInBXXCIrbFswXS52YWx1ZSkud2lkdGgoKSxmKSlbMF0uc2VsZWN0KCksdm9pZCBhKGkpLm9uZShcIm1vdXNlZG93bi5qc3RyZWUgdG91Y2hzdGFydC5qc3RyZWUgZG5kX3N0YXJ0LnZha2F0YVwiLGZ1bmN0aW9uKGIpe1xubCYmYi50YXJnZXQhPT1sJiZhKGwpLmJsdXIoKX0pKTohMX0sc2V0X3RoZW1lOmZ1bmN0aW9uKGIsYyl7aWYoIWIpcmV0dXJuITE7aWYoYz09PSEwKXt2YXIgZD10aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLmRpcjtkfHwoZD1hLmpzdHJlZS5wYXRoK1wiL3RoZW1lc1wiKSxjPWQrXCIvXCIrYitcIi9zdHlsZS5jc3NcIn1jJiYtMT09PWEuaW5BcnJheShjLGcpJiYoYShcImhlYWRcIikuYXBwZW5kKCc8bGluayByZWw9XCJzdHlsZXNoZWV0XCIgaHJlZj1cIicrYysnXCIgdHlwZT1cInRleHQvY3NzXCIgLz4nKSxnLnB1c2goYykpLHRoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZSYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZSksdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5uYW1lPWIsdGhpcy5lbGVtZW50LmFkZENsYXNzKFwianN0cmVlLVwiK2IpLHRoaXMuZWxlbWVudFt0aGlzLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJqc3RyZWUtXCIrYitcIi1yZXNwb25zaXZlXCIpLHRoaXMudHJpZ2dlcihcInNldF90aGVtZVwiLHt0aGVtZTpifSl9LGdldF90aGVtZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWV9LHNldF90aGVtZV92YXJpYW50OmZ1bmN0aW9uKGEpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudCYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwianN0cmVlLVwiK3RoaXMuX2RhdGEuY29yZS50aGVtZXMubmFtZStcIi1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnZhcmlhbnQpLHRoaXMuX2RhdGEuY29yZS50aGVtZXMudmFyaWFudD1hLGEmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1cIit0aGlzLl9kYXRhLmNvcmUudGhlbWVzLm5hbWUrXCItXCIrdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50KX0sZ2V0X3RoZW1lX3ZhcmlhbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YS5jb3JlLnRoZW1lcy52YXJpYW50fSxzaG93X3N0cmlwZXM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLnN0cmlwZXM9ITAsdGhpcy5nZXRfY29udGFpbmVyX3VsKCkuYWRkQ2xhc3MoXCJqc3RyZWUtc3RyaXBlZFwiKX0saGlkZV9zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzPSExLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLXN0cmlwZWRcIil9LHRvZ2dsZV9zdHJpcGVzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5zdHJpcGVzP3RoaXMuaGlkZV9zdHJpcGVzKCk6dGhpcy5zaG93X3N0cmlwZXMoKX0sc2hvd19kb3RzOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5kb3RzPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWRvdHNcIil9LGhpZGVfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1kb3RzXCIpfSx0b2dnbGVfZG90czpmdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuZG90cz90aGlzLmhpZGVfZG90cygpOnRoaXMuc2hvd19kb3RzKCl9LHNob3dfaWNvbnM6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvcmUudGhlbWVzLmljb25zPSEwLHRoaXMuZ2V0X2NvbnRhaW5lcl91bCgpLnJlbW92ZUNsYXNzKFwianN0cmVlLW5vLWljb25zXCIpfSxoaWRlX2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1pY29uc1wiKX0sdG9nZ2xlX2ljb25zOmZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5pY29ucz90aGlzLmhpZGVfaWNvbnMoKTp0aGlzLnNob3dfaWNvbnMoKX0sc2V0X2ljb246ZnVuY3Rpb24oYyxkKXt2YXIgZSxmLGcsaDtpZihhLmlzQXJyYXkoYykpe2ZvcihjPWMuc2xpY2UoKSxlPTAsZj1jLmxlbmd0aDtmPmU7ZSsrKXRoaXMuc2V0X2ljb24oY1tlXSxkKTtyZXR1cm4hMH1yZXR1cm4gYz10aGlzLmdldF9ub2RlKGMpLGMmJmMuaWQhPT1hLmpzdHJlZS5yb290PyhoPWMuaWNvbixjLmljb249ZD09PSEwfHxudWxsPT09ZHx8ZD09PWJ8fFwiXCI9PT1kPyEwOmQsZz10aGlzLmdldF9ub2RlKGMsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKSxkPT09ITE/dGhpcy5oaWRlX2ljb24oYyk6ZD09PSEwfHxudWxsPT09ZHx8ZD09PWJ8fFwiXCI9PT1kPyhnLnJlbW92ZUNsYXNzKFwianN0cmVlLXRoZW1laWNvbi1jdXN0b20gXCIraCkuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLnJlbW92ZUF0dHIoXCJyZWxcIiksaD09PSExJiZ0aGlzLnNob3dfaWNvbihjKSk6LTE9PT1kLmluZGV4T2YoXCIvXCIpJiYtMT09PWQuaW5kZXhPZihcIi5cIik/KGcucmVtb3ZlQ2xhc3MoaCkuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLGcuYWRkQ2xhc3MoZCtcIiBqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKS5hdHRyKFwicmVsXCIsZCksaD09PSExJiZ0aGlzLnNob3dfaWNvbihjKSk6KGcucmVtb3ZlQ2xhc3MoaCkuY3NzKFwiYmFja2dyb3VuZFwiLFwiXCIpLGcuYWRkQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWN1c3RvbVwiKS5jc3MoXCJiYWNrZ3JvdW5kXCIsXCJ1cmwoJ1wiK2QrXCInKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdFwiKS5hdHRyKFwicmVsXCIsZCksaD09PSExJiZ0aGlzLnNob3dfaWNvbihjKSksITApOiExfSxnZXRfaWNvbjpmdW5jdGlvbihiKXtyZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2IuaWNvbjohMX0saGlkZV9pY29uOmZ1bmN0aW9uKGIpe3ZhciBjLGQ7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmhpZGVfaWNvbihiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIhPT1hLmpzdHJlZS5yb290PyhiLmljb249ITEsdGhpcy5nZXRfbm9kZShiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS10aGVtZWljb25cIikuYWRkQ2xhc3MoXCJqc3RyZWUtdGhlbWVpY29uLWhpZGRlblwiKSwhMCk6ITF9LHNob3dfaWNvbjpmdW5jdGlvbihiKXt2YXIgYyxkLGU7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLnNob3dfaWNvbihiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIhPT1hLmpzdHJlZS5yb290PyhlPXRoaXMuZ2V0X25vZGUoYiwhMCksYi5pY29uPWUubGVuZ3RoP2UuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtdGhlbWVpY29uXCIpLmF0dHIoXCJyZWxcIik6ITAsYi5pY29ufHwoYi5pY29uPSEwKSxlLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuY2hpbGRyZW4oXCIuanN0cmVlLXRoZW1laWNvblwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS10aGVtZWljb24taGlkZGVuXCIpLCEwKTohMX19LGEudmFrYXRhPXt9LGEudmFrYXRhLmF0dHJpYnV0ZXM9ZnVuY3Rpb24oYixjKXtiPWEoYilbMF07dmFyIGQ9Yz97fTpbXTtyZXR1cm4gYiYmYi5hdHRyaWJ1dGVzJiZhLmVhY2goYi5hdHRyaWJ1dGVzLGZ1bmN0aW9uKGIsZSl7LTE9PT1hLmluQXJyYXkoZS5uYW1lLnRvTG93ZXJDYXNlKCksW1wic3R5bGVcIixcImNvbnRlbnRlZGl0YWJsZVwiLFwiaGFzZm9jdXNcIixcInRhYmluZGV4XCJdKSYmbnVsbCE9PWUudmFsdWUmJlwiXCIhPT1hLnRyaW0oZS52YWx1ZSkmJihjP2RbZS5uYW1lXT1lLnZhbHVlOmQucHVzaChlLm5hbWUpKX0pLGR9LGEudmFrYXRhLmFycmF5X3VuaXF1ZT1mdW5jdGlvbihhKXt2YXIgYz1bXSxkLGUsZixnPXt9O2ZvcihkPTAsZj1hLmxlbmd0aDtmPmQ7ZCsrKWdbYVtkXV09PT1iJiYoYy5wdXNoKGFbZF0pLGdbYVtkXV09ITApO3JldHVybiBjfSxhLnZha2F0YS5hcnJheV9yZW1vdmU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5zcGxpY2UoYiwxKSxhfSxhLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbT1mdW5jdGlvbihiLGMpe3ZhciBkPWEuaW5BcnJheShjLGIpO3JldHVybi0xIT09ZD9hLnZha2F0YS5hcnJheV9yZW1vdmUoYixkKTpifSxhLnZha2F0YS5hcnJheV9maWx0ZXI9ZnVuY3Rpb24oYSxiLGMsZCxlKXtpZihhLmZpbHRlcilyZXR1cm4gYS5maWx0ZXIoYixjKTtkPVtdO2ZvcihlIGluIGEpfn5lK1wiXCI9PWUrXCJcIiYmZT49MCYmYi5jYWxsKGMsYVtlXSwrZSxhKSYmZC5wdXNoKGFbZV0pO3JldHVybiBkfSxhLmpzdHJlZS5wbHVnaW5zLmNoYW5nZWQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTt0aGlzLnRyaWdnZXI9ZnVuY3Rpb24oYSxkKXt2YXIgZSxmO2lmKGR8fChkPXt9KSxcImNoYW5nZWRcIj09PWEucmVwbGFjZShcIi5qc3RyZWVcIixcIlwiKSl7ZC5jaGFuZ2VkPXtzZWxlY3RlZDpbXSxkZXNlbGVjdGVkOltdfTt2YXIgZz17fTtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylnW2NbZV1dPTE7Zm9yKGU9MCxmPWQuc2VsZWN0ZWQubGVuZ3RoO2Y+ZTtlKyspZ1tkLnNlbGVjdGVkW2VdXT9nW2Quc2VsZWN0ZWRbZV1dPTI6ZC5jaGFuZ2VkLnNlbGVjdGVkLnB1c2goZC5zZWxlY3RlZFtlXSk7Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspMT09PWdbY1tlXV0mJmQuY2hhbmdlZC5kZXNlbGVjdGVkLnB1c2goY1tlXSk7Yz1kLnNlbGVjdGVkLnNsaWNlKCl9Yi50cmlnZ2VyLmNhbGwodGhpcyxhLGQpfSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oYSxkKXtyZXR1cm4gYz1bXSxiLnJlZnJlc2guYXBwbHkodGhpcyxhcmd1bWVudHMpfX07dmFyIG09aS5jcmVhdGVFbGVtZW50KFwiSVwiKTttLmNsYXNzTmFtZT1cImpzdHJlZS1pY29uIGpzdHJlZS1jaGVja2JveFwiLG0uc2V0QXR0cmlidXRlKFwicm9sZVwiLFwicHJlc2VudGF0aW9uXCIpLGEuanN0cmVlLmRlZmF1bHRzLmNoZWNrYm94PXt2aXNpYmxlOiEwLHRocmVlX3N0YXRlOiEwLHdob2xlX25vZGU6ITAsa2VlcF9zZWxlY3RlZF9zdHlsZTohMCxjYXNjYWRlOlwiXCIsdGllX3NlbGVjdGlvbjohMH0sYS5qc3RyZWUucGx1Z2lucy5jaGVja2JveD1mdW5jdGlvbihjLGQpe3RoaXMuYmluZD1mdW5jdGlvbigpe2QuYmluZC5jYWxsKHRoaXMpLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPSExLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9W10sdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aHJlZV9zdGF0ZSYmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZT1cInVwK2Rvd24rdW5kZXRlcm1pbmVkXCIpLHRoaXMuZWxlbWVudC5vbihcImluaXQuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuX2RhdGEuY2hlY2tib3gudmlzaWJsZT10aGlzLnNldHRpbmdzLmNoZWNrYm94LnZpc2libGUsdGhpcy5zZXR0aW5ncy5jaGVja2JveC5rZWVwX3NlbGVjdGVkX3N0eWxlfHx0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tib3gtbm8tY2xpY2tlZFwiKSx0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1zZWxlY3Rpb25cIil9LHRoaXMpKS5vbihcImxvYWRpbmcuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXNbdGhpcy5fZGF0YS5jaGVja2JveC52aXNpYmxlP1wic2hvd19jaGVja2JveGVzXCI6XCJoaWRlX2NoZWNrYm94ZXNcIl0oKX0sdGhpcykpLC0xIT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1bmRldGVybWluZWRcIikmJnRoaXMuZWxlbWVudC5vbihcImNoYW5nZWQuanN0cmVlIHVuY2hlY2tfbm9kZS5qc3RyZWUgY2hlY2tfbm9kZS5qc3RyZWUgdW5jaGVja19hbGwuanN0cmVlIGNoZWNrX2FsbC5qc3RyZWUgbW92ZV9ub2RlLmpzdHJlZSBjb3B5X25vZGUuanN0cmVlIHJlZHJhdy5qc3RyZWUgb3Blbl9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNoZWNrYm94LnV0byYmY2xlYXJUaW1lb3V0KHRoaXMuX2RhdGEuY2hlY2tib3gudXRvKSx0aGlzLl9kYXRhLmNoZWNrYm94LnV0bz1zZXRUaW1lb3V0KGEucHJveHkodGhpcy5fdW5kZXRlcm1pbmVkLHRoaXMpLDUwKX0sdGhpcykpLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbnx8dGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX21vZGVsLmRhdGEsZD1jW2IucGFyZW50XSxlPWIubm9kZXMsZixnO2ZvcihmPTAsZz1lLmxlbmd0aDtnPmY7ZisrKWNbZVtmXV0uc3RhdGUuY2hlY2tlZD1jW2VbZl1dLnN0YXRlLmNoZWNrZWR8fGNbZVtmXV0ub3JpZ2luYWwmJmNbZVtmXV0ub3JpZ2luYWwuc3RhdGUmJmNbZVtmXV0ub3JpZ2luYWwuc3RhdGUuY2hlY2tlZCxjW2VbZl1dLnN0YXRlLmNoZWNrZWQmJnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQucHVzaChlW2ZdKX0sdGhpcykpLC0xPT09dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLmluZGV4T2YoXCJ1cFwiKSYmLTE9PT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcImRvd25cIil8fHRoaXMuZWxlbWVudC5vbihcIm1vZGVsLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzLl9tb2RlbC5kYXRhLGU9ZFtjLnBhcmVudF0sZj1jLm5vZGVzLGc9W10saCxpLGosayxsLG0sbj10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUsbz10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247aWYoLTEhPT1uLmluZGV4T2YoXCJkb3duXCIpKWlmKGUuc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdKXtmb3IoaT0wLGo9Zi5sZW5ndGg7aj5pO2krKylkW2ZbaV1dLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMDt0aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD10aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5jb25jYXQoZil9ZWxzZSBmb3IoaT0wLGo9Zi5sZW5ndGg7aj5pO2krKylpZihkW2ZbaV1dLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGs9MCxsPWRbZltpXV0uY2hpbGRyZW5fZC5sZW5ndGg7bD5rO2srKylkW2RbZltpXV0uY2hpbGRyZW5fZFtrXV0uc3RhdGVbbz9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwO3RoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPXRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkLmNvbmNhdChkW2ZbaV1dLmNoaWxkcmVuX2QpfWlmKC0xIT09bi5pbmRleE9mKFwidXBcIikpe2ZvcihpPTAsaj1lLmNoaWxkcmVuX2QubGVuZ3RoO2o+aTtpKyspZFtlLmNoaWxkcmVuX2RbaV1dLmNoaWxkcmVuLmxlbmd0aHx8Zy5wdXNoKGRbZS5jaGlsZHJlbl9kW2ldXS5wYXJlbnQpO2ZvcihnPWEudmFrYXRhLmFycmF5X3VuaXF1ZShnKSxrPTAsbD1nLmxlbmd0aDtsPms7aysrKXtlPWRbZ1trXV07d2hpbGUoZSYmZS5pZCE9PWEuanN0cmVlLnJvb3Qpe2ZvcihoPTAsaT0wLGo9ZS5jaGlsZHJlbi5sZW5ndGg7aj5pO2krKyloKz1kW2UuY2hpbGRyZW5baV1dLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXTtpZihoIT09ailicmVhaztlLnN0YXRlW28/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMCx0aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZC5wdXNoKGUuaWQpLG09dGhpcy5nZXRfbm9kZShlLCEwKSxtJiZtLmxlbmd0aCYmbS5hdHRyKFwiYXJpYS1zZWxlY3RlZFwiLCEwKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmFkZENsYXNzKG8/XCJqc3RyZWUtY2xpY2tlZFwiOlwianN0cmVlLWNoZWNrZWRcIiksZT10aGlzLmdldF9ub2RlKGUucGFyZW50KX19fXRoaXMuX2RhdGFbbz9cImNvcmVcIjpcImNoZWNrYm94XCJdLnNlbGVjdGVkPWEudmFrYXRhLmFycmF5X3VuaXF1ZSh0aGlzLl9kYXRhW28/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJzZWxlY3Rfbm9kZS5qc3RyZWVcIjpcImNoZWNrX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPWMubm9kZSxlPXRoaXMuX21vZGVsLmRhdGEsZj10aGlzLmdldF9ub2RlKGQucGFyZW50KSxnPXRoaXMuZ2V0X25vZGUoZCwhMCksaCxpLGosayxsPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxtPXRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbixuPXt9LG89dGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ7Zm9yKGg9MCxpPW8ubGVuZ3RoO2k+aDtoKyspbltvW2hdXT0hMDtpZigtMSE9PWwuaW5kZXhPZihcImRvd25cIikpZm9yKGg9MCxpPWQuY2hpbGRyZW5fZC5sZW5ndGg7aT5oO2grKyluW2QuY2hpbGRyZW5fZFtoXV09ITAsaz1lW2QuY2hpbGRyZW5fZFtoXV0say5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsayYmay5vcmlnaW5hbCYmay5vcmlnaW5hbC5zdGF0ZSYmay5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihrLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSk7aWYoLTEhPT1sLmluZGV4T2YoXCJ1cFwiKSl3aGlsZShmJiZmLmlkIT09YS5qc3RyZWUucm9vdCl7Zm9yKGo9MCxoPTAsaT1mLmNoaWxkcmVuLmxlbmd0aDtpPmg7aCsrKWorPWVbZi5jaGlsZHJlbltoXV0uc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKGohPT1pKWJyZWFrO2Yuc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPSEwLG5bZi5pZF09ITAsaz10aGlzLmdldF9ub2RlKGYsITApLGsmJmsubGVuZ3RoJiZrLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MobT9cImpzdHJlZS1jbGlja2VkXCI6XCJqc3RyZWUtY2hlY2tlZFwiKSxmPXRoaXMuZ2V0X25vZGUoZi5wYXJlbnQpfW89W107Zm9yKGggaW4gbiluLmhhc093blByb3BlcnR5KGgpJiZvLnB1c2goaCk7dGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9bywtMSE9PWwuaW5kZXhPZihcImRvd25cIikmJmcubGVuZ3RoJiZnLmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITApfSx0aGlzKSkub24odGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP1wiZGVzZWxlY3RfYWxsLmpzdHJlZVwiOlwidW5jaGVja19hbGwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuZ2V0X25vZGUoYS5qc3RyZWUucm9vdCksZT10aGlzLl9tb2RlbC5kYXRhLGYsZyxoO2ZvcihmPTAsZz1kLmNoaWxkcmVuX2QubGVuZ3RoO2c+ZjtmKyspaD1lW2QuY2hpbGRyZW5fZFtmXV0saCYmaC5vcmlnaW5hbCYmaC5vcmlnaW5hbC5zdGF0ZSYmaC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSl9LHRoaXMpKS5vbih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/XCJkZXNlbGVjdF9ub2RlLmpzdHJlZVwiOlwidW5jaGVja19ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXt2YXIgZD1jLm5vZGUsZT10aGlzLmdldF9ub2RlKGQsITApLGYsZyxoLGk9dGhpcy5zZXR0aW5ncy5jaGVja2JveC5jYXNjYWRlLGo9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLGs9dGhpcy5fZGF0YVtqP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQsbD17fTtpZihkJiZkLm9yaWdpbmFsJiZkLm9yaWdpbmFsLnN0YXRlJiZkLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGQub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKSwtMSE9PWkuaW5kZXhPZihcImRvd25cIikpZm9yKGY9MCxnPWQuY2hpbGRyZW5fZC5sZW5ndGg7Zz5mO2YrKyloPXRoaXMuX21vZGVsLmRhdGFbZC5jaGlsZHJlbl9kW2ZdXSxoLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSxoJiZoLm9yaWdpbmFsJiZoLm9yaWdpbmFsLnN0YXRlJiZoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmKGgub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPSExKTtpZigtMSE9PWkuaW5kZXhPZihcInVwXCIpKWZvcihmPTAsZz1kLnBhcmVudHMubGVuZ3RoO2c+ZjtmKyspaD10aGlzLl9tb2RlbC5kYXRhW2QucGFyZW50c1tmXV0saC5zdGF0ZVtqP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITEsaCYmaC5vcmlnaW5hbCYmaC5vcmlnaW5hbC5zdGF0ZSYmaC5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJihoLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD0hMSksaD10aGlzLmdldF9ub2RlKGQucGFyZW50c1tmXSwhMCksaCYmaC5sZW5ndGgmJmguYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhqP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpO2ZvcihsPXt9LGY9MCxnPWsubGVuZ3RoO2c+ZjtmKyspLTEhPT1pLmluZGV4T2YoXCJkb3duXCIpJiYtMSE9PWEuaW5BcnJheShrW2ZdLGQuY2hpbGRyZW5fZCl8fC0xIT09aS5pbmRleE9mKFwidXBcIikmJi0xIT09YS5pbkFycmF5KGtbZl0sZC5wYXJlbnRzKXx8KGxba1tmXV09ITApO2s9W107Zm9yKGYgaW4gbClsLmhhc093blByb3BlcnR5KGYpJiZrLnB1c2goZik7dGhpcy5fZGF0YVtqP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQ9aywtMSE9PWkuaW5kZXhPZihcImRvd25cIikmJmUubGVuZ3RoJiZlLmZpbmQoXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhqP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLnBhcmVudCgpLmF0dHIoXCJhcmlhLXNlbGVjdGVkXCIsITEpfSx0aGlzKSksLTEhPT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVwXCIpJiZ0aGlzLmVsZW1lbnQub24oXCJkZWxldGVfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5nZXRfbm9kZShjLnBhcmVudCksZT10aGlzLl9tb2RlbC5kYXRhLGYsZyxoLGksaj10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb247d2hpbGUoZCYmZC5pZCE9PWEuanN0cmVlLnJvb3QmJiFkLnN0YXRlW2o/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGg9MCxmPTAsZz1kLmNoaWxkcmVuLmxlbmd0aDtnPmY7ZisrKWgrPWVbZC5jaGlsZHJlbltmXV0uc3RhdGVbaj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKCEoZz4wJiZoPT09ZykpYnJlYWs7ZC5zdGF0ZVtqP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVtqP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChkLmlkKSxpPXRoaXMuZ2V0X25vZGUoZCwhMCksaSYmaS5sZW5ndGgmJmkuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhqP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGQ9dGhpcy5nZXRfbm9kZShkLnBhcmVudCl9fSx0aGlzKSkub24oXCJtb3ZlX25vZGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPWMuaXNfbXVsdGksZT1jLm9sZF9wYXJlbnQsZj10aGlzLmdldF9ub2RlKGMucGFyZW50KSxnPXRoaXMuX21vZGVsLmRhdGEsaCxpLGosayxsLG09dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uO2lmKCFkKXtoPXRoaXMuZ2V0X25vZGUoZSk7d2hpbGUoaCYmaC5pZCE9PWEuanN0cmVlLnJvb3QmJiFoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSl7Zm9yKGk9MCxqPTAsaz1oLmNoaWxkcmVuLmxlbmd0aDtrPmo7aisrKWkrPWdbaC5jaGlsZHJlbltqXV0uc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKCEoaz4wJiZpPT09aykpYnJlYWs7aC5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChoLmlkKSxsPXRoaXMuZ2V0X25vZGUoaCwhMCksbCYmbC5sZW5ndGgmJmwuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpLGg9dGhpcy5nZXRfbm9kZShoLnBhcmVudCl9fWg9Zjt3aGlsZShoJiZoLmlkIT09YS5qc3RyZWUucm9vdCl7Zm9yKGk9MCxqPTAsaz1oLmNoaWxkcmVuLmxlbmd0aDtrPmo7aisrKWkrPWdbaC5jaGlsZHJlbltqXV0uc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdO2lmKGk9PT1rKWguc3RhdGVbbT9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdfHwoaC5zdGF0ZVttP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl09ITAsdGhpcy5fZGF0YVttP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQucHVzaChoLmlkKSxsPXRoaXMuZ2V0X25vZGUoaCwhMCksbCYmbC5sZW5ndGgmJmwuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMCkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpKTtlbHNle2lmKCFoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXSlicmVhaztoLnN0YXRlW20/XCJzZWxlY3RlZFwiOlwiY2hlY2tlZFwiXT0hMSx0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZD1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbSh0aGlzLl9kYXRhW20/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxoLmlkKSxsPXRoaXMuZ2V0X25vZGUoaCwhMCksbCYmbC5sZW5ndGgmJmwuYXR0cihcImFyaWEtc2VsZWN0ZWRcIiwhMSkuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhtP1wianN0cmVlLWNsaWNrZWRcIjpcImpzdHJlZS1jaGVja2VkXCIpfWg9dGhpcy5nZXRfbm9kZShoLnBhcmVudCl9fSx0aGlzKSl9LHRoaXMuX3VuZGV0ZXJtaW5lZD1mdW5jdGlvbigpe2lmKG51bGwhPT10aGlzLmVsZW1lbnQpe3ZhciBjLGQsZSxmLGc9e30saD10aGlzLl9tb2RlbC5kYXRhLGk9dGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uLGo9dGhpcy5fZGF0YVtpP1wiY29yZVwiOlwiY2hlY2tib3hcIl0uc2VsZWN0ZWQsaz1bXSxsPXRoaXM7Zm9yKGM9MCxkPWoubGVuZ3RoO2Q+YztjKyspaWYoaFtqW2NdXSYmaFtqW2NdXS5wYXJlbnRzKWZvcihlPTAsZj1oW2pbY11dLnBhcmVudHMubGVuZ3RoO2Y+ZTtlKyspe2lmKGdbaFtqW2NdXS5wYXJlbnRzW2VdXSE9PWIpYnJlYWs7aFtqW2NdXS5wYXJlbnRzW2VdIT09YS5qc3RyZWUucm9vdCYmKGdbaFtqW2NdXS5wYXJlbnRzW2VdXT0hMCxrLnB1c2goaFtqW2NdXS5wYXJlbnRzW2VdKSl9Zm9yKHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1jbG9zZWRcIikubm90KFwiOmhhcyguanN0cmVlLWNoaWxkcmVuKVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9bC5nZXRfbm9kZSh0aGlzKSxqO2lmKGkuc3RhdGUubG9hZGVkKXtmb3IoYz0wLGQ9aS5jaGlsZHJlbl9kLmxlbmd0aDtkPmM7YysrKWlmKGo9aFtpLmNoaWxkcmVuX2RbY11dLCFqLnN0YXRlLmxvYWRlZCYmai5vcmlnaW5hbCYmai5vcmlnaW5hbC5zdGF0ZSYmai5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQmJmoub3JpZ2luYWwuc3RhdGUudW5kZXRlcm1pbmVkPT09ITApZm9yKGdbai5pZF09PT1iJiZqLmlkIT09YS5qc3RyZWUucm9vdCYmKGdbai5pZF09ITAsay5wdXNoKGouaWQpKSxlPTAsZj1qLnBhcmVudHMubGVuZ3RoO2Y+ZTtlKyspZ1tqLnBhcmVudHNbZV1dPT09YiYmai5wYXJlbnRzW2VdIT09YS5qc3RyZWUucm9vdCYmKGdbai5wYXJlbnRzW2VdXT0hMCxrLnB1c2goai5wYXJlbnRzW2VdKSl9ZWxzZSBpZihpLm9yaWdpbmFsJiZpLm9yaWdpbmFsLnN0YXRlJiZpLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZCYmaS5vcmlnaW5hbC5zdGF0ZS51bmRldGVybWluZWQ9PT0hMClmb3IoZ1tpLmlkXT09PWImJmkuaWQhPT1hLmpzdHJlZS5yb290JiYoZ1tpLmlkXT0hMCxrLnB1c2goaS5pZCkpLGU9MCxmPWkucGFyZW50cy5sZW5ndGg7Zj5lO2UrKylnW2kucGFyZW50c1tlXV09PT1iJiZpLnBhcmVudHNbZV0hPT1hLmpzdHJlZS5yb290JiYoZ1tpLnBhcmVudHNbZV1dPSEwLGsucHVzaChpLnBhcmVudHNbZV0pKX0pLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS11bmRldGVybWluZWRcIikucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtdW5kZXRlcm1pbmVkXCIpLGM9MCxkPWsubGVuZ3RoO2Q+YztjKyspaFtrW2NdXS5zdGF0ZVtpP1wic2VsZWN0ZWRcIjpcImNoZWNrZWRcIl18fChqPXRoaXMuZ2V0X25vZGUoa1tjXSwhMCksaiYmai5sZW5ndGgmJmouY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5jaGlsZHJlbihcIi5qc3RyZWUtY2hlY2tib3hcIikuYWRkQ2xhc3MoXCJqc3RyZWUtdW5kZXRlcm1pbmVkXCIpKX19LHRoaXMucmVkcmF3X25vZGU9ZnVuY3Rpb24oYixjLGUsZil7aWYoYj1kLnJlZHJhd19ub2RlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl7dmFyIGcsaCxpPW51bGwsaj1udWxsO2ZvcihnPTAsaD1iLmNoaWxkTm9kZXMubGVuZ3RoO2g+ZztnKyspaWYoYi5jaGlsZE5vZGVzW2ddJiZiLmNoaWxkTm9kZXNbZ10uY2xhc3NOYW1lJiYtMSE9PWIuY2hpbGROb2Rlc1tnXS5jbGFzc05hbWUuaW5kZXhPZihcImpzdHJlZS1hbmNob3JcIikpe2k9Yi5jaGlsZE5vZGVzW2ddO2JyZWFrfWkmJighdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uJiZ0aGlzLl9tb2RlbC5kYXRhW2IuaWRdLnN0YXRlLmNoZWNrZWQmJihpLmNsYXNzTmFtZSs9XCIganN0cmVlLWNoZWNrZWRcIiksaj1tLmNsb25lTm9kZSghMSksdGhpcy5fbW9kZWwuZGF0YVtiLmlkXS5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZCYmKGouY2xhc3NOYW1lKz1cIiBqc3RyZWUtY2hlY2tib3gtZGlzYWJsZWRcIiksaS5pbnNlcnRCZWZvcmUoaixpLmNoaWxkTm9kZXNbMF0pKX1yZXR1cm4gZXx8LTE9PT10aGlzLnNldHRpbmdzLmNoZWNrYm94LmNhc2NhZGUuaW5kZXhPZihcInVuZGV0ZXJtaW5lZFwiKXx8KHRoaXMuX2RhdGEuY2hlY2tib3gudXRvJiZjbGVhclRpbWVvdXQodGhpcy5fZGF0YS5jaGVja2JveC51dG8pLHRoaXMuX2RhdGEuY2hlY2tib3gudXRvPXNldFRpbWVvdXQoYS5wcm94eSh0aGlzLl91bmRldGVybWluZWQsdGhpcyksNTApKSxifSx0aGlzLnNob3dfY2hlY2tib3hlcz1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuY2hlY2tib3hlcz0hMCx0aGlzLmdldF9jb250YWluZXJfdWwoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1uby1jaGVja2JveGVzXCIpfSx0aGlzLmhpZGVfY2hlY2tib3hlcz1mdW5jdGlvbigpe3RoaXMuX2RhdGEuY29yZS50aGVtZXMuY2hlY2tib3hlcz0hMSx0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS1uby1jaGVja2JveGVzXCIpfSx0aGlzLnRvZ2dsZV9jaGVja2JveGVzPWZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLnRoZW1lcy5jaGVja2JveGVzP3RoaXMuaGlkZV9jaGVja2JveGVzKCk6dGhpcy5zaG93X2NoZWNrYm94ZXMoKX0sdGhpcy5pc191bmRldGVybWluZWQ9ZnVuY3Rpb24oYil7Yj10aGlzLmdldF9ub2RlKGIpO3ZhciBjPXRoaXMuc2V0dGluZ3MuY2hlY2tib3guY2FzY2FkZSxkLGUsZj10aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24sZz10aGlzLl9kYXRhW2Y/XCJjb3JlXCI6XCJjaGVja2JveFwiXS5zZWxlY3RlZCxoPXRoaXMuX21vZGVsLmRhdGE7aWYoIWJ8fGIuc3RhdGVbZj9cInNlbGVjdGVkXCI6XCJjaGVja2VkXCJdPT09ITB8fC0xPT09Yy5pbmRleE9mKFwidW5kZXRlcm1pbmVkXCIpfHwtMT09PWMuaW5kZXhPZihcImRvd25cIikmJi0xPT09Yy5pbmRleE9mKFwidXBcIikpcmV0dXJuITE7aWYoIWIuc3RhdGUubG9hZGVkJiZiLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZD09PSEwKXJldHVybiEwO2ZvcihkPTAsZT1iLmNoaWxkcmVuX2QubGVuZ3RoO2U+ZDtkKyspaWYoLTEhPT1hLmluQXJyYXkoYi5jaGlsZHJlbl9kW2RdLGcpfHwhaFtiLmNoaWxkcmVuX2RbZF1dLnN0YXRlLmxvYWRlZCYmaFtiLmNoaWxkcmVuX2RbZF1dLm9yaWdpbmFsLnN0YXRlLnVuZGV0ZXJtaW5lZClyZXR1cm4hMDtyZXR1cm4hMX0sdGhpcy5kaXNhYmxlX2NoZWNrYm94PWZ1bmN0aW9uKGIpe3ZhciBjLGQsZTtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxjPTAsZD1iLmxlbmd0aDtkPmM7YysrKXRoaXMuZGlzYWJsZV9jaGVja2JveChiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhlPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkfHwoYi5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZD0hMCxlJiZlLmxlbmd0aCYmZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5hZGRDbGFzcyhcImpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSx0aGlzLnRyaWdnZXIoXCJkaXNhYmxlX2NoZWNrYm94XCIse25vZGU6Yn0pKSkpOiExfSx0aGlzLmVuYWJsZV9jaGVja2JveD1mdW5jdGlvbihiKXt2YXIgYyxkLGU7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksYz0wLGQ9Yi5sZW5ndGg7ZD5jO2MrKyl0aGlzLmVuYWJsZV9jaGVja2JveChiW2NdKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhlPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrYm94X2Rpc2FibGVkJiYoYi5zdGF0ZS5jaGVja2JveF9kaXNhYmxlZD0hMSxlJiZlLmxlbmd0aCYmZS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1jaGVja2JveFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKSx0aGlzLnRyaWdnZXIoXCJlbmFibGVfY2hlY2tib3hcIix7bm9kZTpifSkpKSk6ITF9LHRoaXMuYWN0aXZhdGVfbm9kZT1mdW5jdGlvbihiLGMpe3JldHVybiBhKGMudGFyZ2V0KS5oYXNDbGFzcyhcImpzdHJlZS1jaGVja2JveC1kaXNhYmxlZFwiKT8hMToodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uJiYodGhpcy5zZXR0aW5ncy5jaGVja2JveC53aG9sZV9ub2RlfHxhKGMudGFyZ2V0KS5oYXNDbGFzcyhcImpzdHJlZS1jaGVja2JveFwiKSkmJihjLmN0cmxLZXk9ITApLHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbnx8IXRoaXMuc2V0dGluZ3MuY2hlY2tib3gud2hvbGVfbm9kZSYmIWEoYy50YXJnZXQpLmhhc0NsYXNzKFwianN0cmVlLWNoZWNrYm94XCIpP2QuYWN0aXZhdGVfbm9kZS5jYWxsKHRoaXMsYixjKTp0aGlzLmlzX2Rpc2FibGVkKGIpPyExOih0aGlzLmlzX2NoZWNrZWQoYik/dGhpcy51bmNoZWNrX25vZGUoYixjKTp0aGlzLmNoZWNrX25vZGUoYixjKSx2b2lkIHRoaXMudHJpZ2dlcihcImFjdGl2YXRlX25vZGVcIix7bm9kZTp0aGlzLmdldF9ub2RlKGIpfSkpKX0sdGhpcy5jaGVja19ub2RlPWZ1bmN0aW9uKGIsYyl7aWYodGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXJldHVybiB0aGlzLnNlbGVjdF9ub2RlKGIsITEsITAsYyk7dmFyIGQsZSxmLGc7aWYoYS5pc0FycmF5KGIpKXtmb3IoYj1iLnNsaWNlKCksZT0wLGY9Yi5sZW5ndGg7Zj5lO2UrKyl0aGlzLmNoZWNrX25vZGUoYltlXSxjKTtyZXR1cm4hMH1yZXR1cm4gYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290PyhkPXRoaXMuZ2V0X25vZGUoYiwhMCksdm9pZChiLnN0YXRlLmNoZWNrZWR8fChiLnN0YXRlLmNoZWNrZWQ9ITAsdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5wdXNoKGIuaWQpLGQmJmQubGVuZ3RoJiZkLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuYWRkQ2xhc3MoXCJqc3RyZWUtY2hlY2tlZFwiKSx0aGlzLnRyaWdnZXIoXCJjaGVja19ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGV2ZW50OmN9KSkpKTohMX0sdGhpcy51bmNoZWNrX25vZGU9ZnVuY3Rpb24oYixjKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZGVzZWxlY3Rfbm9kZShiLCExLGMpO3ZhciBkLGUsZjtpZihhLmlzQXJyYXkoYikpe2ZvcihiPWIuc2xpY2UoKSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKXRoaXMudW5jaGVja19ub2RlKGJbZF0sYyk7cmV0dXJuITB9cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmlkIT09YS5qc3RyZWUucm9vdD8oZj10aGlzLmdldF9ub2RlKGIsITApLHZvaWQoYi5zdGF0ZS5jaGVja2VkJiYoYi5zdGF0ZS5jaGVja2VkPSExLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxiLmlkKSxmLmxlbmd0aCYmZi5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrZWRcIiksdGhpcy50cmlnZ2VyKFwidW5jaGVja19ub2RlXCIse25vZGU6YixzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkLGV2ZW50OmN9KSkpKTohMX0sdGhpcy5jaGVja19hbGw9ZnVuY3Rpb24oKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuc2VsZWN0X2FsbCgpO3ZhciBiPXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQuY29uY2F0KFtdKSxjLGQ7Zm9yKHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9dGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS5jaGlsZHJlbl9kLmNvbmNhdCgpLGM9MCxkPXRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQubGVuZ3RoO2Q+YztjKyspdGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2NdXSYmKHRoaXMuX21vZGVsLmRhdGFbdGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZFtjXV0uc3RhdGUuY2hlY2tlZD0hMCk7dGhpcy5yZWRyYXcoITApLHRoaXMudHJpZ2dlcihcImNoZWNrX2FsbFwiLHtzZWxlY3RlZDp0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkfSl9LHRoaXMudW5jaGVja19hbGw9ZnVuY3Rpb24oKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZGVzZWxlY3RfYWxsKCk7dmFyIGE9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5jb25jYXQoW10pLGIsYztmb3IoYj0wLGM9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5sZW5ndGg7Yz5iO2IrKyl0aGlzLl9tb2RlbC5kYXRhW3RoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWRbYl1dJiYodGhpcy5fbW9kZWwuZGF0YVt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkW2JdXS5zdGF0ZS5jaGVja2VkPSExKTt0aGlzLl9kYXRhLmNoZWNrYm94LnNlbGVjdGVkPVtdLHRoaXMuZWxlbWVudC5maW5kKFwiLmpzdHJlZS1jaGVja2VkXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLWNoZWNrZWRcIiksdGhpcy50cmlnZ2VyKFwidW5jaGVja19hbGxcIix7c2VsZWN0ZWQ6dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxub2RlOmF9KX0sdGhpcy5pc19jaGVja2VkPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24/dGhpcy5pc19zZWxlY3RlZChiKTooYj10aGlzLmdldF9ub2RlKGIpLGImJmIuaWQhPT1hLmpzdHJlZS5yb290P2Iuc3RhdGUuY2hlY2tlZDohMSl9LHRoaXMuZ2V0X2NoZWNrZWQ9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbj90aGlzLmdldF9zZWxlY3RlZChiKTpiP2EubWFwKHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOnRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWR9LHRoaXMuZ2V0X3RvcF9jaGVja2VkPWZ1bmN0aW9uKGIpe2lmKHRoaXMuc2V0dGluZ3MuY2hlY2tib3gudGllX3NlbGVjdGlvbilyZXR1cm4gdGhpcy5nZXRfdG9wX3NlbGVjdGVkKGIpO3ZhciBjPXRoaXMuZ2V0X2NoZWNrZWQoITApLGQ9e30sZSxmLGcsaDtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKylkW2NbZV0uaWRdPWNbZV07Zm9yKGU9MCxmPWMubGVuZ3RoO2Y+ZTtlKyspZm9yKGc9MCxoPWNbZV0uY2hpbGRyZW5fZC5sZW5ndGg7aD5nO2crKylkW2NbZV0uY2hpbGRyZW5fZFtnXV0mJmRlbGV0ZSBkW2NbZV0uY2hpbGRyZW5fZFtnXV07Yz1bXTtmb3IoZSBpbiBkKWQuaGFzT3duUHJvcGVydHkoZSkmJmMucHVzaChlKTtyZXR1cm4gYj9hLm1hcChjLGEucHJveHkoZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZ2V0X25vZGUoYSl9LHRoaXMpKTpjfSx0aGlzLmdldF9ib3R0b21fY2hlY2tlZD1mdW5jdGlvbihiKXtpZih0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24pcmV0dXJuIHRoaXMuZ2V0X2JvdHRvbV9zZWxlY3RlZChiKTt2YXIgYz10aGlzLmdldF9jaGVja2VkKCEwKSxkPVtdLGUsZjtmb3IoZT0wLGY9Yy5sZW5ndGg7Zj5lO2UrKyljW2VdLmNoaWxkcmVuLmxlbmd0aHx8ZC5wdXNoKGNbZV0uaWQpO3JldHVybiBiP2EubWFwKGQsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5nZXRfbm9kZShhKX0sdGhpcykpOmR9LHRoaXMubG9hZF9ub2RlPWZ1bmN0aW9uKGIsYyl7dmFyIGUsZixnLGgsaSxqO2lmKCFhLmlzQXJyYXkoYikmJiF0aGlzLnNldHRpbmdzLmNoZWNrYm94LnRpZV9zZWxlY3Rpb24mJihqPXRoaXMuZ2V0X25vZGUoYiksaiYmai5zdGF0ZS5sb2FkZWQpKWZvcihlPTAsZj1qLmNoaWxkcmVuX2QubGVuZ3RoO2Y+ZTtlKyspdGhpcy5fbW9kZWwuZGF0YVtqLmNoaWxkcmVuX2RbZV1dLnN0YXRlLmNoZWNrZWQmJihpPSEwLHRoaXMuX2RhdGEuY2hlY2tib3guc2VsZWN0ZWQ9YS52YWthdGEuYXJyYXlfcmVtb3ZlX2l0ZW0odGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZCxqLmNoaWxkcmVuX2RbZV0pKTtyZXR1cm4gZC5sb2FkX25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx0aGlzLmdldF9zdGF0ZT1mdW5jdGlvbigpe3ZhciBhPWQuZ2V0X3N0YXRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uP2E6KGEuY2hlY2tib3g9dGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZC5zbGljZSgpLGEpfSx0aGlzLnNldF9zdGF0ZT1mdW5jdGlvbihiLGMpe3ZhciBlPWQuc2V0X3N0YXRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihlJiZiLmNoZWNrYm94KXtpZighdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9uKXt0aGlzLnVuY2hlY2tfYWxsKCk7dmFyIGY9dGhpczthLmVhY2goYi5jaGVja2JveCxmdW5jdGlvbihhLGIpe2YuY2hlY2tfbm9kZShiKX0pfXJldHVybiBkZWxldGUgYi5jaGVja2JveCx0aGlzLnNldF9zdGF0ZShiLGMpLCExfXJldHVybiBlfSx0aGlzLnJlZnJlc2g9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5zZXR0aW5ncy5jaGVja2JveC50aWVfc2VsZWN0aW9ufHwodGhpcy5fZGF0YS5jaGVja2JveC5zZWxlY3RlZD1bXSksZC5yZWZyZXNoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX19LGEuanN0cmVlLmRlZmF1bHRzLmNvbmRpdGlvbmFsc2VsZWN0PWZ1bmN0aW9uKCl7cmV0dXJuITB9LGEuanN0cmVlLnBsdWdpbnMuY29uZGl0aW9uYWxzZWxlY3Q9ZnVuY3Rpb24oYSxiKXt0aGlzLmFjdGl2YXRlX25vZGU9ZnVuY3Rpb24oYSxjKXt0aGlzLnNldHRpbmdzLmNvbmRpdGlvbmFsc2VsZWN0LmNhbGwodGhpcyx0aGlzLmdldF9ub2RlKGEpLGMpJiZiLmFjdGl2YXRlX25vZGUuY2FsbCh0aGlzLGEsYyl9fSxhLmpzdHJlZS5kZWZhdWx0cy5jb250ZXh0bWVudT17c2VsZWN0X25vZGU6ITAsc2hvd19hdF9ub2RlOiEwLGl0ZW1zOmZ1bmN0aW9uKGIsYyl7cmV0dXJue2NyZWF0ZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxzZXBhcmF0b3JfYWZ0ZXI6ITAsX2Rpc2FibGVkOiExLGxhYmVsOlwiQ3JlYXRlXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmNyZWF0ZV9ub2RlKGQse30sXCJsYXN0XCIsZnVuY3Rpb24oYSl7c2V0VGltZW91dChmdW5jdGlvbigpe2MuZWRpdChhKX0sMCl9KX19LHJlbmFtZTp7c2VwYXJhdG9yX2JlZm9yZTohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsX2Rpc2FibGVkOiExLGxhYmVsOlwiUmVuYW1lXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmVkaXQoZCl9fSxyZW1vdmU6e3NlcGFyYXRvcl9iZWZvcmU6ITEsaWNvbjohMSxzZXBhcmF0b3JfYWZ0ZXI6ITEsX2Rpc2FibGVkOiExLGxhYmVsOlwiRGVsZXRlXCIsYWN0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPWEuanN0cmVlLnJlZmVyZW5jZShiLnJlZmVyZW5jZSksZD1jLmdldF9ub2RlKGIucmVmZXJlbmNlKTtjLmlzX3NlbGVjdGVkKGQpP2MuZGVsZXRlX25vZGUoYy5nZXRfc2VsZWN0ZWQoKSk6Yy5kZWxldGVfbm9kZShkKX19LGNjcDp7c2VwYXJhdG9yX2JlZm9yZTohMCxpY29uOiExLHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIkVkaXRcIixhY3Rpb246ITEsc3VibWVudTp7Y3V0OntzZXBhcmF0b3JfYmVmb3JlOiExLHNlcGFyYXRvcl9hZnRlcjohMSxsYWJlbDpcIkN1dFwiLGFjdGlvbjpmdW5jdGlvbihiKXt2YXIgYz1hLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLGQ9Yy5nZXRfbm9kZShiLnJlZmVyZW5jZSk7Yy5pc19zZWxlY3RlZChkKT9jLmN1dChjLmdldF90b3Bfc2VsZWN0ZWQoKSk6Yy5jdXQoZCl9fSxjb3B5OntzZXBhcmF0b3JfYmVmb3JlOiExLGljb246ITEsc2VwYXJhdG9yX2FmdGVyOiExLGxhYmVsOlwiQ29weVwiLGFjdGlvbjpmdW5jdGlvbihiKXt2YXIgYz1hLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLGQ9Yy5nZXRfbm9kZShiLnJlZmVyZW5jZSk7Yy5pc19zZWxlY3RlZChkKT9jLmNvcHkoYy5nZXRfdG9wX3NlbGVjdGVkKCkpOmMuY29weShkKX19LHBhc3RlOntzZXBhcmF0b3JfYmVmb3JlOiExLGljb246ITEsX2Rpc2FibGVkOmZ1bmN0aW9uKGIpe3JldHVybiFhLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLmNhbl9wYXN0ZSgpfSxzZXBhcmF0b3JfYWZ0ZXI6ITEsbGFiZWw6XCJQYXN0ZVwiLGFjdGlvbjpmdW5jdGlvbihiKXt2YXIgYz1hLmpzdHJlZS5yZWZlcmVuY2UoYi5yZWZlcmVuY2UpLGQ9Yy5nZXRfbm9kZShiLnJlZmVyZW5jZSk7Yy5wYXN0ZShkKX19fX19fX0sYS5qc3RyZWUucGx1Z2lucy5jb250ZXh0bWVudT1mdW5jdGlvbihjLGQpe3RoaXMuYmluZD1mdW5jdGlvbigpe2QuYmluZC5jYWxsKHRoaXMpO3ZhciBiPTAsYz1udWxsLGUsZjt0aGlzLmVsZW1lbnQub24oXCJjb250ZXh0bWVudS5qc3RyZWVcIixcIi5qc3RyZWUtYW5jaG9yXCIsYS5wcm94eShmdW5jdGlvbihhLGQpe2EucHJldmVudERlZmF1bHQoKSxiPWEuY3RybEtleT8rbmV3IERhdGU6MCwoZHx8YykmJihiPStuZXcgRGF0ZSsxZTQpLGMmJmNsZWFyVGltZW91dChjKSx0aGlzLmlzX2xvYWRpbmcoYS5jdXJyZW50VGFyZ2V0KXx8dGhpcy5zaG93X2NvbnRleHRtZW51KGEuY3VycmVudFRhcmdldCxhLnBhZ2VYLGEucGFnZVksYSl9LHRoaXMpKS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGMpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZSYmKCFifHwrbmV3IERhdGUtYj4yNTApJiZhLnZha2F0YS5jb250ZXh0LmhpZGUoKSxiPTB9LHRoaXMpKS5vbihcInRvdWNoc3RhcnQuanN0cmVlXCIsXCIuanN0cmVlLWFuY2hvclwiLGZ1bmN0aW9uKGIpe2Iub3JpZ2luYWxFdmVudCYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihlPWIucGFnZVgsZj1iLnBhZ2VZLGM9c2V0VGltZW91dChmdW5jdGlvbigpe2EoYi5jdXJyZW50VGFyZ2V0KS50cmlnZ2VyKFwiY29udGV4dG1lbnVcIiwhMCl9LDc1MCkpfSkub24oXCJ0b3VjaG1vdmUudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEpe2MmJmEub3JpZ2luYWxFdmVudCYmYS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZhLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihNYXRoLmFicyhlLWEucGFnZVgpPjUwfHxNYXRoLmFicyhmLWEucGFnZVkpPjUwKSYmY2xlYXJUaW1lb3V0KGMpfSkub24oXCJ0b3VjaGVuZC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYSl7YyYmY2xlYXJUaW1lb3V0KGMpfSksYShpKS5vbihcImNvbnRleHRfaGlkZS52YWthdGEuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGIpe3RoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZT0hMSxiLnJlZmVyZW5jZS5yZW1vdmVDbGFzcyhcImpzdHJlZS1jb250ZXh0XCIpfSx0aGlzKSl9LHRoaXMudGVhcmRvd249ZnVuY3Rpb24oKXt0aGlzLl9kYXRhLmNvbnRleHRtZW51LnZpc2libGUmJmEudmFrYXRhLmNvbnRleHQuaGlkZSgpLGQudGVhcmRvd24uY2FsbCh0aGlzKX0sdGhpcy5zaG93X2NvbnRleHRtZW51PWZ1bmN0aW9uKGMsZCxlLGYpe2lmKGM9dGhpcy5nZXRfbm9kZShjKSwhY3x8Yy5pZD09PWEuanN0cmVlLnJvb3QpcmV0dXJuITE7dmFyIGc9dGhpcy5zZXR0aW5ncy5jb250ZXh0bWVudSxoPXRoaXMuZ2V0X25vZGUoYywhMCksaT1oLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIiksaj0hMSxrPSExOyhnLnNob3dfYXRfbm9kZXx8ZD09PWJ8fGU9PT1iKSYmKGo9aS5vZmZzZXQoKSxkPWoubGVmdCxlPWoudG9wK3RoaXMuX2RhdGEuY29yZS5saV9oZWlnaHQpLHRoaXMuc2V0dGluZ3MuY29udGV4dG1lbnUuc2VsZWN0X25vZGUmJiF0aGlzLmlzX3NlbGVjdGVkKGMpJiZ0aGlzLmFjdGl2YXRlX25vZGUoYyxmKSxrPWcuaXRlbXMsYS5pc0Z1bmN0aW9uKGspJiYoaz1rLmNhbGwodGhpcyxjLGEucHJveHkoZnVuY3Rpb24oYSl7dGhpcy5fc2hvd19jb250ZXh0bWVudShjLGQsZSxhKX0sdGhpcykpKSxhLmlzUGxhaW5PYmplY3QoaykmJnRoaXMuX3Nob3dfY29udGV4dG1lbnUoYyxkLGUsayl9LHRoaXMuX3Nob3dfY29udGV4dG1lbnU9ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGY9dGhpcy5nZXRfbm9kZShiLCEwKSxnPWYuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKTthKGkpLm9uZShcImNvbnRleHRfc2hvdy52YWthdGEuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiLGMpe3ZhciBkPVwianN0cmVlLWNvbnRleHRtZW51IGpzdHJlZS1cIit0aGlzLmdldF90aGVtZSgpK1wiLWNvbnRleHRtZW51XCI7YShjLmVsZW1lbnQpLmFkZENsYXNzKGQpLGcuYWRkQ2xhc3MoXCJqc3RyZWUtY29udGV4dFwiKX0sdGhpcykpLHRoaXMuX2RhdGEuY29udGV4dG1lbnUudmlzaWJsZT0hMCxhLnZha2F0YS5jb250ZXh0LnNob3coZyx7eDpjLHk6ZH0sZSksdGhpcy50cmlnZ2VyKFwic2hvd19jb250ZXh0bWVudVwiLHtub2RlOmIseDpjLHk6ZH0pfX0sZnVuY3Rpb24oYSl7dmFyIGI9ITEsYz17ZWxlbWVudDohMSxyZWZlcmVuY2U6ITEscG9zaXRpb25feDowLHBvc2l0aW9uX3k6MCxpdGVtczpbXSxodG1sOlwiXCIsaXNfdmlzaWJsZTohMX07YS52YWthdGEuY29udGV4dD17c2V0dGluZ3M6e2hpZGVfb25tb3VzZWxlYXZlOjAsaWNvbnM6ITB9LF90cmlnZ2VyOmZ1bmN0aW9uKGIpe2EoaSkudHJpZ2dlckhhbmRsZXIoXCJjb250ZXh0X1wiK2IrXCIudmFrYXRhXCIse3JlZmVyZW5jZTpjLnJlZmVyZW5jZSxlbGVtZW50OmMuZWxlbWVudCxwb3NpdGlvbjp7eDpjLnBvc2l0aW9uX3gseTpjLnBvc2l0aW9uX3l9fSl9LF9leGVjdXRlOmZ1bmN0aW9uKGIpe3JldHVybiBiPWMuaXRlbXNbYl0sYiYmKCFiLl9kaXNhYmxlZHx8YS5pc0Z1bmN0aW9uKGIuX2Rpc2FibGVkKSYmIWIuX2Rpc2FibGVkKHtpdGVtOmIscmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50fSkpJiZiLmFjdGlvbj9iLmFjdGlvbi5jYWxsKG51bGwse2l0ZW06YixyZWZlcmVuY2U6Yy5yZWZlcmVuY2UsZWxlbWVudDpjLmVsZW1lbnQscG9zaXRpb246e3g6Yy5wb3NpdGlvbl94LHk6Yy5wb3NpdGlvbl95fX0pOiExfSxfcGFyc2U6ZnVuY3Rpb24oYixkKXtpZighYilyZXR1cm4hMTtkfHwoYy5odG1sPVwiXCIsYy5pdGVtcz1bXSk7dmFyIGU9XCJcIixmPSExLGc7cmV0dXJuIGQmJihlKz1cIjx1bD5cIiksYS5lYWNoKGIsZnVuY3Rpb24oYixkKXtyZXR1cm4gZD8oYy5pdGVtcy5wdXNoKGQpLCFmJiZkLnNlcGFyYXRvcl9iZWZvcmUmJihlKz1cIjxsaSBjbGFzcz0ndmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yJz48YSBocmVmPScjJyBcIisoYS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5pY29ucz9cIlwiOidzdHlsZT1cIm1hcmdpbi1sZWZ0OjBweDtcIicpK1wiPiYjMTYwOzwvYT48L2xpPlwiKSxmPSExLGUrPVwiPGxpIGNsYXNzPSdcIisoZC5fY2xhc3N8fFwiXCIpKyhkLl9kaXNhYmxlZD09PSEwfHxhLmlzRnVuY3Rpb24oZC5fZGlzYWJsZWQpJiZkLl9kaXNhYmxlZCh7aXRlbTpkLHJlZmVyZW5jZTpjLnJlZmVyZW5jZSxlbGVtZW50OmMuZWxlbWVudH0pP1wiIHZha2F0YS1jb250ZXh0bWVudS1kaXNhYmxlZCBcIjpcIlwiKStcIicgXCIrKGQuc2hvcnRjdXQ/XCIgZGF0YS1zaG9ydGN1dD0nXCIrZC5zaG9ydGN1dCtcIicgXCI6XCJcIikrXCI+XCIsZSs9XCI8YSBocmVmPScjJyByZWw9J1wiKyhjLml0ZW1zLmxlbmd0aC0xKStcIic+XCIsYS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5pY29ucyYmKGUrPVwiPGkgXCIsZC5pY29uJiYoZSs9LTEhPT1kLmljb24uaW5kZXhPZihcIi9cIil8fC0xIT09ZC5pY29uLmluZGV4T2YoXCIuXCIpP1wiIHN0eWxlPSdiYWNrZ3JvdW5kOnVybChcXFwiXCIrZC5pY29uK1wiXFxcIikgY2VudGVyIGNlbnRlciBuby1yZXBlYXQnIFwiOlwiIGNsYXNzPSdcIitkLmljb24rXCInIFwiKSxlKz1cIj48L2k+PHNwYW4gY2xhc3M9J3Zha2F0YS1jb250ZXh0bWVudS1zZXAnPiYjMTYwOzwvc3Bhbj5cIiksZSs9KGEuaXNGdW5jdGlvbihkLmxhYmVsKT9kLmxhYmVsKHtpdGVtOmIscmVmZXJlbmNlOmMucmVmZXJlbmNlLGVsZW1lbnQ6Yy5lbGVtZW50fSk6ZC5sYWJlbCkrKGQuc2hvcnRjdXQ/JyA8c3BhbiBjbGFzcz1cInZha2F0YS1jb250ZXh0bWVudS1zaG9ydGN1dCB2YWthdGEtY29udGV4dG1lbnUtc2hvcnRjdXQtJytkLnNob3J0Y3V0KydcIj4nKyhkLnNob3J0Y3V0X2xhYmVsfHxcIlwiKStcIjwvc3Bhbj5cIjpcIlwiKStcIjwvYT5cIixkLnN1Ym1lbnUmJihnPWEudmFrYXRhLmNvbnRleHQuX3BhcnNlKGQuc3VibWVudSwhMCksZyYmKGUrPWcpKSxlKz1cIjwvbGk+XCIsdm9pZChkLnNlcGFyYXRvcl9hZnRlciYmKGUrPVwiPGxpIGNsYXNzPSd2YWthdGEtY29udGV4dC1zZXBhcmF0b3InPjxhIGhyZWY9JyMnIFwiKyhhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmljb25zP1wiXCI6J3N0eWxlPVwibWFyZ2luLWxlZnQ6MHB4O1wiJykrXCI+JiMxNjA7PC9hPjwvbGk+XCIsZj0hMCkpKTohMH0pLGU9ZS5yZXBsYWNlKC88bGkgY2xhc3NcXD0ndmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yJ1xcPjxcXC9saVxcPiQvLFwiXCIpLGQmJihlKz1cIjwvdWw+XCIpLGR8fChjLmh0bWw9ZSxhLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwicGFyc2VcIikpLGUubGVuZ3RoPjEwP2U6ITF9LF9zaG93X3N1Ym1lbnU6ZnVuY3Rpb24oYyl7aWYoYz1hKGMpLGMubGVuZ3RoJiZjLmNoaWxkcmVuKFwidWxcIikubGVuZ3RoKXt2YXIgZD1jLmNoaWxkcmVuKFwidWxcIiksZT1jLm9mZnNldCgpLmxlZnQsZj1lK2Mub3V0ZXJXaWR0aCgpLGc9Yy5vZmZzZXQoKS50b3AsaD1kLndpZHRoKCksaT1kLmhlaWdodCgpLGo9YSh3aW5kb3cpLndpZHRoKCkrYSh3aW5kb3cpLnNjcm9sbExlZnQoKSxrPWEod2luZG93KS5oZWlnaHQoKSthKHdpbmRvdykuc2Nyb2xsVG9wKCk7Yj9jW2YtKGgrMTArYy5vdXRlcldpZHRoKCkpPDA/XCJhZGRDbGFzc1wiOlwicmVtb3ZlQ2xhc3NcIl0oXCJ2YWthdGEtY29udGV4dC1sZWZ0XCIpOmNbZitoPmomJmU+ai1mP1wiYWRkQ2xhc3NcIjpcInJlbW92ZUNsYXNzXCJdKFwidmFrYXRhLWNvbnRleHQtcmlnaHRcIiksZytpKzEwPmsmJmQuY3NzKFwiYm90dG9tXCIsXCItMXB4XCIpLGMuaGFzQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1yaWdodFwiKT9oPmUmJmQuY3NzKFwibWFyZ2luLXJpZ2h0XCIsZS1oKTpoPmotZiYmZC5jc3MoXCJtYXJnaW4tbGVmdFwiLGotZi1oKSxkLnNob3coKX19LHNob3c6ZnVuY3Rpb24oZCxlLGYpe3ZhciBnLGgsaSxqLGssbCxtLG4sbz0hMDtzd2l0Y2goYy5lbGVtZW50JiZjLmVsZW1lbnQubGVuZ3RoJiZjLmVsZW1lbnQud2lkdGgoXCJcIiksbyl7Y2FzZSFlJiYhZDpyZXR1cm4hMTtjYXNlISFlJiYhIWQ6Yy5yZWZlcmVuY2U9ZCxjLnBvc2l0aW9uX3g9ZS54LGMucG9zaXRpb25feT1lLnk7YnJlYWs7Y2FzZSFlJiYhIWQ6Yy5yZWZlcmVuY2U9ZCxnPWQub2Zmc2V0KCksYy5wb3NpdGlvbl94PWcubGVmdCtkLm91dGVySGVpZ2h0KCksYy5wb3NpdGlvbl95PWcudG9wO2JyZWFrO2Nhc2UhIWUmJiFkOmMucG9zaXRpb25feD1lLngsYy5wb3NpdGlvbl95PWUueX1kJiYhZiYmYShkKS5kYXRhKFwidmFrYXRhX2NvbnRleHRtZW51XCIpJiYoZj1hKGQpLmRhdGEoXCJ2YWthdGFfY29udGV4dG1lbnVcIikpLGEudmFrYXRhLmNvbnRleHQuX3BhcnNlKGYpJiZjLmVsZW1lbnQuaHRtbChjLmh0bWwpLGMuaXRlbXMubGVuZ3RoJiYoYy5lbGVtZW50LmFwcGVuZFRvKFwiYm9keVwiKSxoPWMuZWxlbWVudCxpPWMucG9zaXRpb25feCxqPWMucG9zaXRpb25feSxrPWgud2lkdGgoKSxsPWguaGVpZ2h0KCksbT1hKHdpbmRvdykud2lkdGgoKSthKHdpbmRvdykuc2Nyb2xsTGVmdCgpLG49YSh3aW5kb3cpLmhlaWdodCgpK2Eod2luZG93KS5zY3JvbGxUb3AoKSxiJiYoaS09aC5vdXRlcldpZHRoKCktYShkKS5vdXRlcldpZHRoKCksaTxhKHdpbmRvdykuc2Nyb2xsTGVmdCgpKzIwJiYoaT1hKHdpbmRvdykuc2Nyb2xsTGVmdCgpKzIwKSksaStrKzIwPm0mJihpPW0tKGsrMjApKSxqK2wrMjA+biYmKGo9bi0obCsyMCkpLGMuZWxlbWVudC5jc3Moe2xlZnQ6aSx0b3A6an0pLnNob3coKS5maW5kKFwiYVwiKS5maXJzdCgpLmZvY3VzKCkucGFyZW50KCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxjLmlzX3Zpc2libGU9ITAsYS52YWthdGEuY29udGV4dC5fdHJpZ2dlcihcInNob3dcIikpfSxoaWRlOmZ1bmN0aW9uKCl7Yy5pc192aXNpYmxlJiYoYy5lbGVtZW50LmhpZGUoKS5maW5kKFwidWxcIikuaGlkZSgpLmVuZCgpLmZpbmQoXCI6Zm9jdXNcIikuYmx1cigpLmVuZCgpLmRldGFjaCgpLGMuaXNfdmlzaWJsZT0hMSxhLnZha2F0YS5jb250ZXh0Ll90cmlnZ2VyKFwiaGlkZVwiKSl9fSxhKGZ1bmN0aW9uKCl7Yj1cInJ0bFwiPT09YShcImJvZHlcIikuY3NzKFwiZGlyZWN0aW9uXCIpO3ZhciBkPSExO2MuZWxlbWVudD1hKFwiPHVsIGNsYXNzPSd2YWthdGEtY29udGV4dCc+PC91bD5cIiksYy5lbGVtZW50Lm9uKFwibW91c2VlbnRlclwiLFwibGlcIixmdW5jdGlvbihiKXtiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGEuY29udGFpbnModGhpcyxiLnJlbGF0ZWRUYXJnZXQpfHwoZCYmY2xlYXJUaW1lb3V0KGQpLGMuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuZW5kKCksYSh0aGlzKS5zaWJsaW5ncygpLmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCkuZW5kKCkucGFyZW50c1VudGlsKFwiLnZha2F0YS1jb250ZXh0XCIsXCJsaVwiKS5hZGRCYWNrKCkuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxhLnZha2F0YS5jb250ZXh0Ll9zaG93X3N1Ym1lbnUodGhpcykpfSkub24oXCJtb3VzZWxlYXZlXCIsXCJsaVwiLGZ1bmN0aW9uKGIpe2EuY29udGFpbnModGhpcyxiLnJlbGF0ZWRUYXJnZXQpfHxhKHRoaXMpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikuYWRkQmFjaygpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIil9KS5vbihcIm1vdXNlbGVhdmVcIixmdW5jdGlvbihiKXthKHRoaXMpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKSxhLnZha2F0YS5jb250ZXh0LnNldHRpbmdzLmhpZGVfb25tb3VzZWxlYXZlJiYoZD1zZXRUaW1lb3V0KGZ1bmN0aW9uKGIpe3JldHVybiBmdW5jdGlvbigpe2EudmFrYXRhLmNvbnRleHQuaGlkZSgpfX0odGhpcyksYS52YWthdGEuY29udGV4dC5zZXR0aW5ncy5oaWRlX29ubW91c2VsZWF2ZSkpfSkub24oXCJjbGlja1wiLFwiYVwiLGZ1bmN0aW9uKGIpe2IucHJldmVudERlZmF1bHQoKSxhKHRoaXMpLmJsdXIoKS5wYXJlbnQoKS5oYXNDbGFzcyhcInZha2F0YS1jb250ZXh0LWRpc2FibGVkXCIpfHxhLnZha2F0YS5jb250ZXh0Ll9leGVjdXRlKGEodGhpcykuYXR0cihcInJlbFwiKSk9PT0hMXx8YS52YWthdGEuY29udGV4dC5oaWRlKCl9KS5vbihcImtleWRvd25cIixcImFcIixmdW5jdGlvbihiKXt2YXIgZD1udWxsO3N3aXRjaChiLndoaWNoKXtjYXNlIDEzOmNhc2UgMzI6Yi50eXBlPVwibW91c2V1cFwiLGIucHJldmVudERlZmF1bHQoKSxhKGIuY3VycmVudFRhcmdldCkudHJpZ2dlcihiKTticmVhaztjYXNlIDM3OmMuaXNfdmlzaWJsZSYmKGMuZWxlbWVudC5maW5kKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmxhc3QoKS5jbG9zZXN0KFwibGlcIikuZmlyc3QoKS5maW5kKFwidWxcIikuaGlkZSgpLmZpbmQoXCIudmFrYXRhLWNvbnRleHQtaG92ZXJcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5lbmQoKS5lbmQoKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSxiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGIucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSAzODpjLmlzX3Zpc2libGUmJihkPWMuZWxlbWVudC5maW5kKFwidWw6dmlzaWJsZVwiKS5hZGRCYWNrKCkubGFzdCgpLmNoaWxkcmVuKFwiLnZha2F0YS1jb250ZXh0LWhvdmVyXCIpLnJlbW92ZUNsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikucHJldkFsbChcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5maXJzdCgpLGQubGVuZ3RofHwoZD1jLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcImxpOm5vdCgudmFrYXRhLWNvbnRleHQtc2VwYXJhdG9yKVwiKS5sYXN0KCkpLGQuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5jaGlsZHJlbihcImFcIikuZm9jdXMoKSxiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGIucHJldmVudERlZmF1bHQoKSk7YnJlYWs7Y2FzZSAzOTpjLmlzX3Zpc2libGUmJihjLmVsZW1lbnQuZmluZChcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5sYXN0KCkuY2hpbGRyZW4oXCJ1bFwiKS5zaG93KCkuY2hpbGRyZW4oXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikucmVtb3ZlQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ob3ZlclwiKS5maXJzdCgpLmFkZENsYXNzKFwidmFrYXRhLWNvbnRleHQtaG92ZXJcIikuY2hpbGRyZW4oXCJhXCIpLmZvY3VzKCksYi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSxiLnByZXZlbnREZWZhdWx0KCkpO2JyZWFrO2Nhc2UgNDA6Yy5pc192aXNpYmxlJiYoZD1jLmVsZW1lbnQuZmluZChcInVsOnZpc2libGVcIikuYWRkQmFjaygpLmxhc3QoKS5jaGlsZHJlbihcIi52YWthdGEtY29udGV4dC1ob3ZlclwiKS5yZW1vdmVDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLm5leHRBbGwoXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikuZmlyc3QoKSxkLmxlbmd0aHx8KGQ9Yy5lbGVtZW50LmZpbmQoXCJ1bDp2aXNpYmxlXCIpLmFkZEJhY2soKS5sYXN0KCkuY2hpbGRyZW4oXCJsaTpub3QoLnZha2F0YS1jb250ZXh0LXNlcGFyYXRvcilcIikuZmlyc3QoKSksZC5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LWhvdmVyXCIpLmNoaWxkcmVuKFwiYVwiKS5mb2N1cygpLGIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYi5wcmV2ZW50RGVmYXVsdCgpKTticmVhaztjYXNlIDI3OmEudmFrYXRhLmNvbnRleHQuaGlkZSgpLGIucHJldmVudERlZmF1bHQoKX19KS5vbihcImtleWRvd25cIixmdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCk7dmFyIGI9Yy5lbGVtZW50LmZpbmQoXCIudmFrYXRhLWNvbnRleHRtZW51LXNob3J0Y3V0LVwiK2Eud2hpY2gpLnBhcmVudCgpO2IucGFyZW50KCkubm90KFwiLnZha2F0YS1jb250ZXh0LWRpc2FibGVkXCIpJiZiLmNsaWNrKCl9KSxhKGkpLm9uKFwibW91c2Vkb3duLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihiKXtjLmlzX3Zpc2libGUmJiFhLmNvbnRhaW5zKGMuZWxlbWVudFswXSxiLnRhcmdldCkmJmEudmFrYXRhLmNvbnRleHQuaGlkZSgpO1xufSkub24oXCJjb250ZXh0X3Nob3cudmFrYXRhLmpzdHJlZVwiLGZ1bmN0aW9uKGEsZCl7Yy5lbGVtZW50LmZpbmQoXCJsaTpoYXModWwpXCIpLmNoaWxkcmVuKFwiYVwiKS5hZGRDbGFzcyhcInZha2F0YS1jb250ZXh0LXBhcmVudFwiKSxiJiZjLmVsZW1lbnQuYWRkQ2xhc3MoXCJ2YWthdGEtY29udGV4dC1ydGxcIikuY3NzKFwiZGlyZWN0aW9uXCIsXCJydGxcIiksYy5lbGVtZW50LmZpbmQoXCJ1bFwiKS5oaWRlKCkuZW5kKCl9KX0pfShhKSxhLmpzdHJlZS5kZWZhdWx0cy5kbmQ9e2NvcHk6ITAsb3Blbl90aW1lb3V0OjUwMCxpc19kcmFnZ2FibGU6ITAsY2hlY2tfd2hpbGVfZHJhZ2dpbmc6ITAsYWx3YXlzX2NvcHk6ITEsaW5zaWRlX3BvczowLGRyYWdfc2VsZWN0aW9uOiEwLHRvdWNoOiEwLGxhcmdlX2Ryb3BfdGFyZ2V0OiExLGxhcmdlX2RyYWdfdGFyZ2V0OiExLHVzZV9odG1sNTohMX07dmFyIG4sbzthLmpzdHJlZS5wbHVnaW5zLmRuZD1mdW5jdGlvbihiLGMpe3RoaXMuaW5pdD1mdW5jdGlvbihhLGIpe2MuaW5pdC5jYWxsKHRoaXMsYSxiKSx0aGlzLnNldHRpbmdzLmRuZC51c2VfaHRtbDU9dGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1JiZcImRyYWdnYWJsZVwiaW4gaS5jcmVhdGVFbGVtZW50KFwic3BhblwiKX0sdGhpcy5iaW5kPWZ1bmN0aW9uKCl7Yy5iaW5kLmNhbGwodGhpcyksdGhpcy5lbGVtZW50Lm9uKHRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNT9cImRyYWdzdGFydC5qc3RyZWVcIjpcIm1vdXNlZG93bi5qc3RyZWUgdG91Y2hzdGFydC5qc3RyZWVcIix0aGlzLnNldHRpbmdzLmRuZC5sYXJnZV9kcmFnX3RhcmdldD9cIi5qc3RyZWUtbm9kZVwiOlwiLmpzdHJlZS1hbmNob3JcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2lmKHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0JiZhKGIudGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpWzBdIT09Yi5jdXJyZW50VGFyZ2V0KXJldHVybiEwO2lmKFwidG91Y2hzdGFydFwiPT09Yi50eXBlJiYoIXRoaXMuc2V0dGluZ3MuZG5kLnRvdWNofHxcInNlbGVjdGVkXCI9PT10aGlzLnNldHRpbmdzLmRuZC50b3VjaCYmIWEoYi5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuaGFzQ2xhc3MoXCJqc3RyZWUtY2xpY2tlZFwiKSkpcmV0dXJuITA7dmFyIGM9dGhpcy5nZXRfbm9kZShiLnRhcmdldCksZD10aGlzLmlzX3NlbGVjdGVkKGMpJiZ0aGlzLnNldHRpbmdzLmRuZC5kcmFnX3NlbGVjdGlvbj90aGlzLmdldF90b3Bfc2VsZWN0ZWQoKS5sZW5ndGg6MSxlPWQ+MT9kK1wiIFwiK3RoaXMuZ2V0X3N0cmluZyhcIm5vZGVzXCIpOnRoaXMuZ2V0X3RleHQoYi5jdXJyZW50VGFyZ2V0KTtpZih0aGlzLnNldHRpbmdzLmNvcmUuZm9yY2VfdGV4dCYmKGU9YS52YWthdGEuaHRtbC5lc2NhcGUoZSkpLGMmJmMuaWQmJmMuaWQhPT1hLmpzdHJlZS5yb290JiYoMT09PWIud2hpY2h8fFwidG91Y2hzdGFydFwiPT09Yi50eXBlfHxcImRyYWdzdGFydFwiPT09Yi50eXBlKSYmKHRoaXMuc2V0dGluZ3MuZG5kLmlzX2RyYWdnYWJsZT09PSEwfHxhLmlzRnVuY3Rpb24odGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlKSYmdGhpcy5zZXR0aW5ncy5kbmQuaXNfZHJhZ2dhYmxlLmNhbGwodGhpcyxkPjE/dGhpcy5nZXRfdG9wX3NlbGVjdGVkKCEwKTpbY10sYikpKXtpZihuPXtqc3RyZWU6ITAsb3JpZ2luOnRoaXMsb2JqOnRoaXMuZ2V0X25vZGUoYywhMCksbm9kZXM6ZD4xP3RoaXMuZ2V0X3RvcF9zZWxlY3RlZCgpOltjLmlkXX0sbz1iLmN1cnJlbnRUYXJnZXQsIXRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNSlyZXR1cm4gdGhpcy5lbGVtZW50LnRyaWdnZXIoXCJtb3VzZWRvd24uanN0cmVlXCIpLGEudmFrYXRhLmRuZC5zdGFydChiLG4sJzxkaXYgaWQ9XCJqc3RyZWUtZG5kXCIgY2xhc3M9XCJqc3RyZWUtJyt0aGlzLmdldF90aGVtZSgpK1wiIGpzdHJlZS1cIit0aGlzLmdldF90aGVtZSgpK1wiLVwiK3RoaXMuZ2V0X3RoZW1lX3ZhcmlhbnQoKStcIiBcIisodGhpcy5zZXR0aW5ncy5jb3JlLnRoZW1lcy5yZXNwb25zaXZlP1wiIGpzdHJlZS1kbmQtcmVzcG9uc2l2ZVwiOlwiXCIpKydcIj48aSBjbGFzcz1cImpzdHJlZS1pY29uIGpzdHJlZS1lclwiPjwvaT4nK2UrJzxpbnMgY2xhc3M9XCJqc3RyZWUtY29weVwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPis8L2lucz48L2Rpdj4nKTthLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJzdGFydFwiLGIse2hlbHBlcjphKCksZWxlbWVudDpvLGRhdGE6bn0pfX0sdGhpcykpLHRoaXMuc2V0dGluZ3MuZG5kLnVzZV9odG1sNSYmdGhpcy5lbGVtZW50Lm9uKFwiZHJhZ292ZXIuanN0cmVlXCIsZnVuY3Rpb24oYil7cmV0dXJuIGIucHJldmVudERlZmF1bHQoKSxhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsYix7aGVscGVyOmEoKSxlbGVtZW50Om8sZGF0YTpufSksITF9KS5vbihcImRyb3AuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihiKXtyZXR1cm4gYi5wcmV2ZW50RGVmYXVsdCgpLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0b3BcIixiLHtoZWxwZXI6YSgpLGVsZW1lbnQ6byxkYXRhOm59KSwhMX0sdGhpcykpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGEsYixkLGUpe2lmKGE9Yy5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYSYmdGhpcy5zZXR0aW5ncy5kbmQudXNlX2h0bWw1KWlmKHRoaXMuc2V0dGluZ3MuZG5kLmxhcmdlX2RyYWdfdGFyZ2V0KWEuc2V0QXR0cmlidXRlKFwiZHJhZ2dhYmxlXCIsITApO2Vsc2V7dmFyIGYsZyxoPW51bGw7Zm9yKGY9MCxnPWEuY2hpbGROb2Rlcy5sZW5ndGg7Zz5mO2YrKylpZihhLmNoaWxkTm9kZXNbZl0mJmEuY2hpbGROb2Rlc1tmXS5jbGFzc05hbWUmJi0xIT09YS5jaGlsZE5vZGVzW2ZdLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7aD1hLmNoaWxkTm9kZXNbZl07YnJlYWt9aCYmaC5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwhMCl9cmV0dXJuIGF9fSxhKGZ1bmN0aW9uKCl7dmFyIGM9ITEsZD0hMSxlPSExLGY9ITEsZz1hKCc8ZGl2IGlkPVwianN0cmVlLW1hcmtlclwiPiYjMTYwOzwvZGl2PicpLmhpZGUoKTthKGkpLm9uKFwiZG5kX3N0YXJ0LnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhLGIpe2M9ITEsZT0hMSxiJiZiLmRhdGEmJmIuZGF0YS5qc3RyZWUmJmcuYXBwZW5kVG8oXCJib2R5XCIpfSkub24oXCJkbmRfbW92ZS52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oaCxpKXtpZihmJiYoaS5ldmVudCYmXCJkcmFnb3ZlclwiPT09aS5ldmVudC50eXBlJiZpLmV2ZW50LnRhcmdldD09PWUudGFyZ2V0fHxjbGVhclRpbWVvdXQoZikpLGkmJmkuZGF0YSYmaS5kYXRhLmpzdHJlZSYmKCFpLmV2ZW50LnRhcmdldC5pZHx8XCJqc3RyZWUtbWFya2VyXCIhPT1pLmV2ZW50LnRhcmdldC5pZCkpe2U9aS5ldmVudDt2YXIgaj1hLmpzdHJlZS5yZWZlcmVuY2UoaS5ldmVudC50YXJnZXQpLGs9ITEsbD0hMSxtPSExLG4sbyxwLHEscixzLHQsdSx2LHcseCx5LHosQSxCLEM7aWYoaiYmai5fZGF0YSYmai5fZGF0YS5kbmQpaWYoZy5hdHRyKFwiY2xhc3NcIixcImpzdHJlZS1cIitqLmdldF90aGVtZSgpKyhqLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikpLEM9aS5kYXRhLm9yaWdpbiYmKGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoaS5ldmVudC5tZXRhS2V5fHxpLmV2ZW50LmN0cmxLZXkpKSxpLmhlbHBlci5jaGlsZHJlbigpLmF0dHIoXCJjbGFzc1wiLFwianN0cmVlLVwiK2ouZ2V0X3RoZW1lKCkrXCIganN0cmVlLVwiK2ouZ2V0X3RoZW1lKCkrXCItXCIrai5nZXRfdGhlbWVfdmFyaWFudCgpK1wiIFwiKyhqLnNldHRpbmdzLmNvcmUudGhlbWVzLnJlc3BvbnNpdmU/XCIganN0cmVlLWRuZC1yZXNwb25zaXZlXCI6XCJcIikpLmZpbmQoXCIuanN0cmVlLWNvcHlcIikuZmlyc3QoKVtDP1wic2hvd1wiOlwiaGlkZVwiXSgpLGkuZXZlbnQudGFyZ2V0IT09ai5lbGVtZW50WzBdJiZpLmV2ZW50LnRhcmdldCE9PWouZ2V0X2NvbnRhaW5lcl91bCgpWzBdfHwwIT09ai5nZXRfY29udGFpbmVyX3VsKCkuY2hpbGRyZW4oKS5sZW5ndGgpe2lmKGs9ai5zZXR0aW5ncy5kbmQubGFyZ2VfZHJvcF90YXJnZXQ/YShpLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWUtbm9kZVwiKS5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpOmEoaS5ldmVudC50YXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLWFuY2hvclwiKSxrJiZrLmxlbmd0aCYmay5wYXJlbnQoKS5pcyhcIi5qc3RyZWUtY2xvc2VkLCAuanN0cmVlLW9wZW4sIC5qc3RyZWUtbGVhZlwiKSYmKGw9ay5vZmZzZXQoKSxtPShpLmV2ZW50LnBhZ2VZIT09Yj9pLmV2ZW50LnBhZ2VZOmkuZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSktbC50b3AscT1rLm91dGVySGVpZ2h0KCksdD1xLzM+bT9bXCJiXCIsXCJpXCIsXCJhXCJdOm0+cS1xLzM/W1wiYVwiLFwiaVwiLFwiYlwiXTptPnEvMj9bXCJpXCIsXCJhXCIsXCJiXCJdOltcImlcIixcImJcIixcImFcIl0sYS5lYWNoKHQsZnVuY3Rpb24oYixlKXtzd2l0Y2goZSl7Y2FzZVwiYlwiOm89bC5sZWZ0LTYscD1sLnRvcCxyPWouZ2V0X3BhcmVudChrKSxzPWsucGFyZW50KCkuaW5kZXgoKTticmVhaztjYXNlXCJpXCI6QT1qLnNldHRpbmdzLmRuZC5pbnNpZGVfcG9zLEI9ai5nZXRfbm9kZShrLnBhcmVudCgpKSxvPWwubGVmdC0yLHA9bC50b3ArcS8yKzEscj1CLmlkLHM9XCJmaXJzdFwiPT09QT8wOlwibGFzdFwiPT09QT9CLmNoaWxkcmVuLmxlbmd0aDpNYXRoLm1pbihBLEIuY2hpbGRyZW4ubGVuZ3RoKTticmVhaztjYXNlXCJhXCI6bz1sLmxlZnQtNixwPWwudG9wK3Escj1qLmdldF9wYXJlbnQoaykscz1rLnBhcmVudCgpLmluZGV4KCkrMX1mb3IodT0hMCx2PTAsdz1pLmRhdGEubm9kZXMubGVuZ3RoO3c+djt2KyspaWYoeD1pLmRhdGEub3JpZ2luJiYoaS5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihpLmV2ZW50Lm1ldGFLZXl8fGkuZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIix5PXMsXCJtb3ZlX25vZGVcIj09PXgmJlwiYVwiPT09ZSYmaS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbj09PWomJnI9PT1qLmdldF9wYXJlbnQoaS5kYXRhLm5vZGVzW3ZdKSYmKHo9ai5nZXRfbm9kZShyKSx5PmEuaW5BcnJheShpLmRhdGEubm9kZXNbdl0sei5jaGlsZHJlbikmJih5LT0xKSksdT11JiYoaiYmai5zZXR0aW5ncyYmai5zZXR0aW5ncy5kbmQmJmouc2V0dGluZ3MuZG5kLmNoZWNrX3doaWxlX2RyYWdnaW5nPT09ITF8fGouY2hlY2soeCxpLmRhdGEub3JpZ2luJiZpLmRhdGEub3JpZ2luIT09aj9pLmRhdGEub3JpZ2luLmdldF9ub2RlKGkuZGF0YS5ub2Rlc1t2XSk6aS5kYXRhLm5vZGVzW3ZdLHIseSx7ZG5kOiEwLHJlZjpqLmdldF9ub2RlKGsucGFyZW50KCkpLHBvczplLG9yaWdpbjppLmRhdGEub3JpZ2luLGlzX211bHRpOmkuZGF0YS5vcmlnaW4mJmkuZGF0YS5vcmlnaW4hPT1qLGlzX2ZvcmVpZ246IWkuZGF0YS5vcmlnaW59KSksIXUpe2omJmoubGFzdF9lcnJvciYmKGQ9ai5sYXN0X2Vycm9yKCkpO2JyZWFrfXJldHVyblwiaVwiPT09ZSYmay5wYXJlbnQoKS5pcyhcIi5qc3RyZWUtY2xvc2VkXCIpJiZqLnNldHRpbmdzLmRuZC5vcGVuX3RpbWVvdXQmJihmPXNldFRpbWVvdXQoZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oKXthLm9wZW5fbm9kZShiKX19KGosayksai5zZXR0aW5ncy5kbmQub3Blbl90aW1lb3V0KSksdT8oYz17aW5zOmoscGFyOnIscG9zOlwiaVwiIT09ZXx8XCJsYXN0XCIhPT1BfHwwIT09c3x8ai5pc19sb2FkZWQoQik/czpcImxhc3RcIn0sZy5jc3Moe2xlZnQ6bytcInB4XCIsdG9wOnArXCJweFwifSkuc2hvdygpLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1lclwiKS5hZGRDbGFzcyhcImpzdHJlZS1va1wiKSxpLmV2ZW50Lm9yaWdpbmFsRXZlbnQmJmkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXImJihpLmV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3Q9Qz9cImNvcHlcIjpcIm1vdmVcIiksZD17fSx0PSEwLCExKTp2b2lkIDB9KSx0PT09ITApKXJldHVybn1lbHNle2Zvcih1PSEwLHY9MCx3PWkuZGF0YS5ub2Rlcy5sZW5ndGg7dz52O3YrKylpZih1PXUmJmouY2hlY2soaS5kYXRhLm9yaWdpbiYmKGkuZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmFsd2F5c19jb3B5fHxpLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5jb3B5JiYoaS5ldmVudC5tZXRhS2V5fHxpLmV2ZW50LmN0cmxLZXkpKT9cImNvcHlfbm9kZVwiOlwibW92ZV9ub2RlXCIsaS5kYXRhLm9yaWdpbiYmaS5kYXRhLm9yaWdpbiE9PWo/aS5kYXRhLm9yaWdpbi5nZXRfbm9kZShpLmRhdGEubm9kZXNbdl0pOmkuZGF0YS5ub2Rlc1t2XSxhLmpzdHJlZS5yb290LFwibGFzdFwiLHtkbmQ6ITAscmVmOmouZ2V0X25vZGUoYS5qc3RyZWUucm9vdCkscG9zOlwiaVwiLG9yaWdpbjppLmRhdGEub3JpZ2luLGlzX211bHRpOmkuZGF0YS5vcmlnaW4mJmkuZGF0YS5vcmlnaW4hPT1qLGlzX2ZvcmVpZ246IWkuZGF0YS5vcmlnaW59KSwhdSlicmVhaztpZih1KXJldHVybiBjPXtpbnM6aixwYXI6YS5qc3RyZWUucm9vdCxwb3M6XCJsYXN0XCJ9LGcuaGlkZSgpLGkuaGVscGVyLmZpbmQoXCIuanN0cmVlLWljb25cIikuZmlyc3QoKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1lclwiKS5hZGRDbGFzcyhcImpzdHJlZS1va1wiKSx2b2lkKGkuZXZlbnQub3JpZ2luYWxFdmVudCYmaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciYmKGkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdD1DP1wiY29weVwiOlwibW92ZVwiKSl9Yz0hMSxpLmhlbHBlci5maW5kKFwiLmpzdHJlZS1pY29uXCIpLnJlbW92ZUNsYXNzKFwianN0cmVlLW9rXCIpLmFkZENsYXNzKFwianN0cmVlLWVyXCIpLGkuZXZlbnQub3JpZ2luYWxFdmVudCYmaS5ldmVudC5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciYmKGkuZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdD1cIm5vbmVcIiksZy5oaWRlKCl9fSkub24oXCJkbmRfc2Nyb2xsLnZha2F0YS5qc3RyZWVcIixmdW5jdGlvbihhLGIpe2ImJmIuZGF0YSYmYi5kYXRhLmpzdHJlZSYmKGcuaGlkZSgpLGM9ITEsZT0hMSxiLmhlbHBlci5maW5kKFwiLmpzdHJlZS1pY29uXCIpLmZpcnN0KCkucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtb2tcIikuYWRkQ2xhc3MoXCJqc3RyZWUtZXJcIikpfSkub24oXCJkbmRfc3RvcC52YWthdGEuanN0cmVlXCIsZnVuY3Rpb24oYixoKXtpZihmJiZjbGVhclRpbWVvdXQoZiksaCYmaC5kYXRhJiZoLmRhdGEuanN0cmVlKXtnLmhpZGUoKS5kZXRhY2goKTt2YXIgaSxqLGs9W107aWYoYyl7Zm9yKGk9MCxqPWguZGF0YS5ub2Rlcy5sZW5ndGg7aj5pO2krKylrW2ldPWguZGF0YS5vcmlnaW4/aC5kYXRhLm9yaWdpbi5nZXRfbm9kZShoLmRhdGEubm9kZXNbaV0pOmguZGF0YS5ub2Rlc1tpXTtjLmluc1toLmRhdGEub3JpZ2luJiYoaC5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuYWx3YXlzX2NvcHl8fGguZGF0YS5vcmlnaW4uc2V0dGluZ3MuZG5kLmNvcHkmJihoLmV2ZW50Lm1ldGFLZXl8fGguZXZlbnQuY3RybEtleSkpP1wiY29weV9ub2RlXCI6XCJtb3ZlX25vZGVcIl0oayxjLnBhcixjLnBvcywhMSwhMSwhMSxoLmRhdGEub3JpZ2luKX1lbHNlIGk9YShoLmV2ZW50LnRhcmdldCkuY2xvc2VzdChcIi5qc3RyZWVcIiksaS5sZW5ndGgmJmQmJmQuZXJyb3ImJlwiY2hlY2tcIj09PWQuZXJyb3ImJihpPWkuanN0cmVlKCEwKSxpJiZpLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLGQpKTtlPSExLGM9ITF9fSkub24oXCJrZXl1cC5qc3RyZWUga2V5ZG93bi5qc3RyZWVcIixmdW5jdGlvbihiLGgpe2g9YS52YWthdGEuZG5kLl9nZXQoKSxoJiZoLmRhdGEmJmguZGF0YS5qc3RyZWUmJihcImtleXVwXCI9PT1iLnR5cGUmJjI3PT09Yi53aGljaD8oZiYmY2xlYXJUaW1lb3V0KGYpLGM9ITEsZD0hMSxlPSExLGY9ITEsZy5oaWRlKCkuZGV0YWNoKCksYS52YWthdGEuZG5kLl9jbGVhbigpKTooaC5oZWxwZXIuZmluZChcIi5qc3RyZWUtY29weVwiKS5maXJzdCgpW2guZGF0YS5vcmlnaW4mJihoLmRhdGEub3JpZ2luLnNldHRpbmdzLmRuZC5hbHdheXNfY29weXx8aC5kYXRhLm9yaWdpbi5zZXR0aW5ncy5kbmQuY29weSYmKGIubWV0YUtleXx8Yi5jdHJsS2V5KSk/XCJzaG93XCI6XCJoaWRlXCJdKCksZSYmKGUubWV0YUtleT1iLm1ldGFLZXksZS5jdHJsS2V5PWIuY3RybEtleSxhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsZSkpKSl9KX0pLGZ1bmN0aW9uKGEpe2EudmFrYXRhLmh0bWw9e2RpdjphKFwiPGRpdiAvPlwiKSxlc2NhcGU6ZnVuY3Rpb24oYil7cmV0dXJuIGEudmFrYXRhLmh0bWwuZGl2LnRleHQoYikuaHRtbCgpfSxzdHJpcDpmdW5jdGlvbihiKXtyZXR1cm4gYS52YWthdGEuaHRtbC5kaXYuZW1wdHkoKS5hcHBlbmQoYS5wYXJzZUhUTUwoYikpLnRleHQoKX19O3ZhciBjPXtlbGVtZW50OiExLHRhcmdldDohMSxpc19kb3duOiExLGlzX2RyYWc6ITEsaGVscGVyOiExLGhlbHBlcl93OjAsZGF0YTohMSxpbml0X3g6MCxpbml0X3k6MCxzY3JvbGxfbDowLHNjcm9sbF90OjAsc2Nyb2xsX2U6ITEsc2Nyb2xsX2k6ITEsaXNfdG91Y2g6ITF9O2EudmFrYXRhLmRuZD17c2V0dGluZ3M6e3Njcm9sbF9zcGVlZDoxMCxzY3JvbGxfcHJveGltaXR5OjIwLGhlbHBlcl9sZWZ0OjUsaGVscGVyX3RvcDoxMCx0aHJlc2hvbGQ6NSx0aHJlc2hvbGRfdG91Y2g6NTB9LF90cmlnZ2VyOmZ1bmN0aW9uKGMsZCxlKXtlPT09YiYmKGU9YS52YWthdGEuZG5kLl9nZXQoKSksZS5ldmVudD1kLGEoaSkudHJpZ2dlckhhbmRsZXIoXCJkbmRfXCIrYytcIi52YWthdGFcIixlKX0sX2dldDpmdW5jdGlvbigpe3JldHVybntkYXRhOmMuZGF0YSxlbGVtZW50OmMuZWxlbWVudCxoZWxwZXI6Yy5oZWxwZXJ9fSxfY2xlYW46ZnVuY3Rpb24oKXtjLmhlbHBlciYmYy5oZWxwZXIucmVtb3ZlKCksYy5zY3JvbGxfaSYmKGNsZWFySW50ZXJ2YWwoYy5zY3JvbGxfaSksYy5zY3JvbGxfaT0hMSksYz17ZWxlbWVudDohMSx0YXJnZXQ6ITEsaXNfZG93bjohMSxpc19kcmFnOiExLGhlbHBlcjohMSxoZWxwZXJfdzowLGRhdGE6ITEsaW5pdF94OjAsaW5pdF95OjAsc2Nyb2xsX2w6MCxzY3JvbGxfdDowLHNjcm9sbF9lOiExLHNjcm9sbF9pOiExLGlzX3RvdWNoOiExfSxhKGkpLm9mZihcIm1vdXNlbW92ZS52YWthdGEuanN0cmVlIHRvdWNobW92ZS52YWthdGEuanN0cmVlXCIsYS52YWthdGEuZG5kLmRyYWcpLGEoaSkub2ZmKFwibW91c2V1cC52YWthdGEuanN0cmVlIHRvdWNoZW5kLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuc3RvcCl9LF9zY3JvbGw6ZnVuY3Rpb24oYil7aWYoIWMuc2Nyb2xsX2V8fCFjLnNjcm9sbF9sJiYhYy5zY3JvbGxfdClyZXR1cm4gYy5zY3JvbGxfaSYmKGNsZWFySW50ZXJ2YWwoYy5zY3JvbGxfaSksYy5zY3JvbGxfaT0hMSksITE7aWYoIWMuc2Nyb2xsX2kpcmV0dXJuIGMuc2Nyb2xsX2k9c2V0SW50ZXJ2YWwoYS52YWthdGEuZG5kLl9zY3JvbGwsMTAwKSwhMTtpZihiPT09ITApcmV0dXJuITE7dmFyIGQ9Yy5zY3JvbGxfZS5zY3JvbGxUb3AoKSxlPWMuc2Nyb2xsX2Uuc2Nyb2xsTGVmdCgpO2Muc2Nyb2xsX2Uuc2Nyb2xsVG9wKGQrYy5zY3JvbGxfdCphLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3NwZWVkKSxjLnNjcm9sbF9lLnNjcm9sbExlZnQoZStjLnNjcm9sbF9sKmEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfc3BlZWQpLGQ9PT1jLnNjcm9sbF9lLnNjcm9sbFRvcCgpJiZlPT09Yy5zY3JvbGxfZS5zY3JvbGxMZWZ0KCl8fGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcInNjcm9sbFwiLGMuc2Nyb2xsX2UpfSxzdGFydDpmdW5jdGlvbihiLGQsZSl7XCJ0b3VjaHN0YXJ0XCI9PT1iLnR5cGUmJmIub3JpZ2luYWxFdmVudCYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihiLnBhZ2VYPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxiLnBhZ2VZPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxiLnRhcmdldD1pLmVsZW1lbnRGcm9tUG9pbnQoYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLXdpbmRvdy5wYWdlWE9mZnNldCxiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVktd2luZG93LnBhZ2VZT2Zmc2V0KSksYy5pc19kcmFnJiZhLnZha2F0YS5kbmQuc3RvcCh7fSk7dHJ5e2IuY3VycmVudFRhcmdldC51bnNlbGVjdGFibGU9XCJvblwiLGIuY3VycmVudFRhcmdldC5vbnNlbGVjdHN0YXJ0PWZ1bmN0aW9uKCl7cmV0dXJuITF9LGIuY3VycmVudFRhcmdldC5zdHlsZSYmKGIuY3VycmVudFRhcmdldC5zdHlsZS50b3VjaEFjdGlvbj1cIm5vbmVcIixiLmN1cnJlbnRUYXJnZXQuc3R5bGUubXNUb3VjaEFjdGlvbj1cIm5vbmVcIixiLmN1cnJlbnRUYXJnZXQuc3R5bGUuTW96VXNlclNlbGVjdD1cIm5vbmVcIil9Y2F0Y2goZil7fXJldHVybiBjLmluaXRfeD1iLnBhZ2VYLGMuaW5pdF95PWIucGFnZVksYy5kYXRhPWQsYy5pc19kb3duPSEwLGMuZWxlbWVudD1iLmN1cnJlbnRUYXJnZXQsYy50YXJnZXQ9Yi50YXJnZXQsYy5pc190b3VjaD1cInRvdWNoc3RhcnRcIj09PWIudHlwZSxlIT09ITEmJihjLmhlbHBlcj1hKFwiPGRpdiBpZD0ndmFrYXRhLWRuZCc+PC9kaXY+XCIpLmh0bWwoZSkuY3NzKHtkaXNwbGF5OlwiYmxvY2tcIixtYXJnaW46XCIwXCIscGFkZGluZzpcIjBcIixwb3NpdGlvbjpcImFic29sdXRlXCIsdG9wOlwiLTIwMDBweFwiLGxpbmVIZWlnaHQ6XCIxNnB4XCIsekluZGV4OlwiMTAwMDBcIn0pKSxhKGkpLm9uKFwibW91c2Vtb3ZlLnZha2F0YS5qc3RyZWUgdG91Y2htb3ZlLnZha2F0YS5qc3RyZWVcIixhLnZha2F0YS5kbmQuZHJhZyksYShpKS5vbihcIm1vdXNldXAudmFrYXRhLmpzdHJlZSB0b3VjaGVuZC52YWthdGEuanN0cmVlXCIsYS52YWthdGEuZG5kLnN0b3ApLCExfSxkcmFnOmZ1bmN0aW9uKGIpe2lmKFwidG91Y2htb3ZlXCI9PT1iLnR5cGUmJmIub3JpZ2luYWxFdmVudCYmYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzJiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0mJihiLnBhZ2VYPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCxiLnBhZ2VZPWIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSxiLnRhcmdldD1pLmVsZW1lbnRGcm9tUG9pbnQoYi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLXdpbmRvdy5wYWdlWE9mZnNldCxiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVktd2luZG93LnBhZ2VZT2Zmc2V0KSksYy5pc19kb3duKXtpZighYy5pc19kcmFnKXtpZighKE1hdGguYWJzKGIucGFnZVgtYy5pbml0X3gpPihjLmlzX3RvdWNoP2EudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGRfdG91Y2g6YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZCl8fE1hdGguYWJzKGIucGFnZVktYy5pbml0X3kpPihjLmlzX3RvdWNoP2EudmFrYXRhLmRuZC5zZXR0aW5ncy50aHJlc2hvbGRfdG91Y2g6YS52YWthdGEuZG5kLnNldHRpbmdzLnRocmVzaG9sZCkpKXJldHVybjtjLmhlbHBlciYmKGMuaGVscGVyLmFwcGVuZFRvKFwiYm9keVwiKSxjLmhlbHBlcl93PWMuaGVscGVyLm91dGVyV2lkdGgoKSksYy5pc19kcmFnPSEwLGEudmFrYXRhLmRuZC5fdHJpZ2dlcihcInN0YXJ0XCIsYil9dmFyIGQ9ITEsZT0hMSxmPSExLGc9ITEsaD0hMSxqPSExLGs9ITEsbD0hMSxtPSExLG49ITE7cmV0dXJuIGMuc2Nyb2xsX3Q9MCxjLnNjcm9sbF9sPTAsYy5zY3JvbGxfZT0hMSxhKGEoYi50YXJnZXQpLnBhcmVudHNVbnRpbChcImJvZHlcIikuYWRkQmFjaygpLmdldCgpLnJldmVyc2UoKSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuL15hdXRvfHNjcm9sbCQvLnRlc3QoYSh0aGlzKS5jc3MoXCJvdmVyZmxvd1wiKSkmJih0aGlzLnNjcm9sbEhlaWdodD50aGlzLm9mZnNldEhlaWdodHx8dGhpcy5zY3JvbGxXaWR0aD50aGlzLm9mZnNldFdpZHRoKX0pLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5vZmZzZXQoKTtyZXR1cm4gdGhpcy5zY3JvbGxIZWlnaHQ+dGhpcy5vZmZzZXRIZWlnaHQmJihlLnRvcCtkLmhlaWdodCgpLWIucGFnZVk8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF90PTEpLGIucGFnZVktZS50b3A8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF90PS0xKSksdGhpcy5zY3JvbGxXaWR0aD50aGlzLm9mZnNldFdpZHRoJiYoZS5sZWZ0K2Qud2lkdGgoKS1iLnBhZ2VYPGEudmFrYXRhLmRuZC5zZXR0aW5ncy5zY3JvbGxfcHJveGltaXR5JiYoYy5zY3JvbGxfbD0xKSxiLnBhZ2VYLWUubGVmdDxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX2w9LTEpKSxjLnNjcm9sbF90fHxjLnNjcm9sbF9sPyhjLnNjcm9sbF9lPWEodGhpcyksITEpOnZvaWQgMH0pLGMuc2Nyb2xsX2V8fChkPWEoaSksZT1hKHdpbmRvdyksZj1kLmhlaWdodCgpLGc9ZS5oZWlnaHQoKSxoPWQud2lkdGgoKSxqPWUud2lkdGgoKSxrPWQuc2Nyb2xsVG9wKCksbD1kLnNjcm9sbExlZnQoKSxmPmcmJmIucGFnZVktazxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9LTEpLGY+ZyYmZy0oYi5wYWdlWS1rKTxhLnZha2F0YS5kbmQuc2V0dGluZ3Muc2Nyb2xsX3Byb3hpbWl0eSYmKGMuc2Nyb2xsX3Q9MSksaD5qJiZiLnBhZ2VYLWw8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF9sPS0xKSxoPmomJmotKGIucGFnZVgtbCk8YS52YWthdGEuZG5kLnNldHRpbmdzLnNjcm9sbF9wcm94aW1pdHkmJihjLnNjcm9sbF9sPTEpLChjLnNjcm9sbF90fHxjLnNjcm9sbF9sKSYmKGMuc2Nyb2xsX2U9ZCkpLGMuc2Nyb2xsX2UmJmEudmFrYXRhLmRuZC5fc2Nyb2xsKCEwKSxjLmhlbHBlciYmKG09cGFyc2VJbnQoYi5wYWdlWSthLnZha2F0YS5kbmQuc2V0dGluZ3MuaGVscGVyX3RvcCwxMCksbj1wYXJzZUludChiLnBhZ2VYK2EudmFrYXRhLmRuZC5zZXR0aW5ncy5oZWxwZXJfbGVmdCwxMCksZiYmbSsyNT5mJiYobT1mLTUwKSxoJiZuK2MuaGVscGVyX3c+aCYmKG49aC0oYy5oZWxwZXJfdysyKSksYy5oZWxwZXIuY3NzKHtsZWZ0Om4rXCJweFwiLHRvcDptK1wicHhcIn0pKSxhLnZha2F0YS5kbmQuX3RyaWdnZXIoXCJtb3ZlXCIsYiksITF9fSxzdG9wOmZ1bmN0aW9uKGIpe2lmKFwidG91Y2hlbmRcIj09PWIudHlwZSYmYi5vcmlnaW5hbEV2ZW50JiZiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMmJmIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSYmKGIucGFnZVg9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLGIucGFnZVk9Yi5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZLGIudGFyZ2V0PWkuZWxlbWVudEZyb21Qb2ludChiLm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgtd2luZG93LnBhZ2VYT2Zmc2V0LGIub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWS13aW5kb3cucGFnZVlPZmZzZXQpKSxjLmlzX2RyYWcpYS52YWthdGEuZG5kLl90cmlnZ2VyKFwic3RvcFwiLGIpO2Vsc2UgaWYoXCJ0b3VjaGVuZFwiPT09Yi50eXBlJiZiLnRhcmdldD09PWMudGFyZ2V0KXt2YXIgZD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YShiLnRhcmdldCkuY2xpY2soKX0sMTAwKTthKGIudGFyZ2V0KS5vbmUoXCJjbGlja1wiLGZ1bmN0aW9uKCl7ZCYmY2xlYXJUaW1lb3V0KGQpfSl9cmV0dXJuIGEudmFrYXRhLmRuZC5fY2xlYW4oKSwhMX19fShhKSxhLmpzdHJlZS5kZWZhdWx0cy5tYXNzbG9hZD1udWxsLGEuanN0cmVlLnBsdWdpbnMubWFzc2xvYWQ9ZnVuY3Rpb24oYixjKXt0aGlzLmluaXQ9ZnVuY3Rpb24oYSxiKXt0aGlzLl9kYXRhLm1hc3Nsb2FkPXt9LGMuaW5pdC5jYWxsKHRoaXMsYSxiKX0sdGhpcy5fbG9hZF9ub2Rlcz1mdW5jdGlvbihiLGQsZSxmKXt2YXIgZz10aGlzLnNldHRpbmdzLm1hc3Nsb2FkLGg9SlNPTi5zdHJpbmdpZnkoYiksaT1bXSxqPXRoaXMuX21vZGVsLmRhdGEsayxsLG07aWYoIWUpe2ZvcihrPTAsbD1iLmxlbmd0aDtsPms7aysrKWpbYltrXV0mJihqW2Jba11dLnN0YXRlLmxvYWRlZHx8altiW2tdXS5zdGF0ZS5mYWlsZWQpJiYhZnx8KGkucHVzaChiW2tdKSxtPXRoaXMuZ2V0X25vZGUoYltrXSwhMCksbSYmbS5sZW5ndGgmJm0uYWRkQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITApKTtpZih0aGlzLl9kYXRhLm1hc3Nsb2FkPXt9LGkubGVuZ3RoKXtpZihhLmlzRnVuY3Rpb24oZykpcmV0dXJuIGcuY2FsbCh0aGlzLGksYS5wcm94eShmdW5jdGlvbihhKXt2YXIgZyxoO2lmKGEpZm9yKGcgaW4gYSlhLmhhc093blByb3BlcnR5KGcpJiYodGhpcy5fZGF0YS5tYXNzbG9hZFtnXT1hW2ddKTtmb3IoZz0wLGg9Yi5sZW5ndGg7aD5nO2crKyltPXRoaXMuZ2V0X25vZGUoYltnXSwhMCksbSYmbS5sZW5ndGgmJm0ucmVtb3ZlQ2xhc3MoXCJqc3RyZWUtbG9hZGluZ1wiKS5hdHRyKFwiYXJpYS1idXN5XCIsITEpO2MuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLGIsZCxlLGYpfSx0aGlzKSk7aWYoXCJvYmplY3RcIj09dHlwZW9mIGcmJmcmJmcudXJsKXJldHVybiBnPWEuZXh0ZW5kKCEwLHt9LGcpLGEuaXNGdW5jdGlvbihnLnVybCkmJihnLnVybD1nLnVybC5jYWxsKHRoaXMsaSkpLGEuaXNGdW5jdGlvbihnLmRhdGEpJiYoZy5kYXRhPWcuZGF0YS5jYWxsKHRoaXMsaSkpLGEuYWpheChnKS5kb25lKGEucHJveHkoZnVuY3Rpb24oYSxnLGgpe3ZhciBpLGo7aWYoYSlmb3IoaSBpbiBhKWEuaGFzT3duUHJvcGVydHkoaSkmJih0aGlzLl9kYXRhLm1hc3Nsb2FkW2ldPWFbaV0pO2ZvcihpPTAsaj1iLmxlbmd0aDtqPmk7aSsrKW09dGhpcy5nZXRfbm9kZShiW2ldLCEwKSxtJiZtLmxlbmd0aCYmbS5yZW1vdmVDbGFzcyhcImpzdHJlZS1sb2FkaW5nXCIpLmF0dHIoXCJhcmlhLWJ1c3lcIiwhMSk7Yy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMpKS5mYWlsKGEucHJveHkoZnVuY3Rpb24oYSl7Yy5fbG9hZF9ub2Rlcy5jYWxsKHRoaXMsYixkLGUsZil9LHRoaXMpKX19cmV0dXJuIGMuX2xvYWRfbm9kZXMuY2FsbCh0aGlzLGIsZCxlLGYpfSx0aGlzLl9sb2FkX25vZGU9ZnVuY3Rpb24oYixkKXt2YXIgZT10aGlzLl9kYXRhLm1hc3Nsb2FkW2IuaWRdLGY9bnVsbCxnO3JldHVybiBlPyhmPXRoaXNbXCJzdHJpbmdcIj09dHlwZW9mIGU/XCJfYXBwZW5kX2h0bWxfZGF0YVwiOlwiX2FwcGVuZF9qc29uX2RhdGFcIl0oYixcInN0cmluZ1wiPT10eXBlb2YgZT9hKGEucGFyc2VIVE1MKGUpKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gMyE9PXRoaXMubm9kZVR5cGV9KTplLGZ1bmN0aW9uKGEpe2QuY2FsbCh0aGlzLGEpfSksZz10aGlzLmdldF9ub2RlKGIuaWQsITApLGcmJmcubGVuZ3RoJiZnLnJlbW92ZUNsYXNzKFwianN0cmVlLWxvYWRpbmdcIikuYXR0cihcImFyaWEtYnVzeVwiLCExKSxkZWxldGUgdGhpcy5fZGF0YS5tYXNzbG9hZFtiLmlkXSxmKTpjLl9sb2FkX25vZGUuY2FsbCh0aGlzLGIsZCl9fSxhLmpzdHJlZS5kZWZhdWx0cy5zZWFyY2g9e2FqYXg6ITEsZnV6enk6ITEsY2FzZV9zZW5zaXRpdmU6ITEsc2hvd19vbmx5X21hdGNoZXM6ITEsc2hvd19vbmx5X21hdGNoZXNfY2hpbGRyZW46ITEsY2xvc2Vfb3BlbmVkX29uY2xlYXI6ITAsc2VhcmNoX2xlYXZlc19vbmx5OiExLHNlYXJjaF9jYWxsYmFjazohMX0sYS5qc3RyZWUucGx1Z2lucy5zZWFyY2g9ZnVuY3Rpb24oYyxkKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtkLmJpbmQuY2FsbCh0aGlzKSx0aGlzLl9kYXRhLnNlYXJjaC5zdHI9XCJcIix0aGlzLl9kYXRhLnNlYXJjaC5kb209YSgpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guc29tPSExLHRoaXMuX2RhdGEuc2VhcmNoLnNtYz0hMSx0aGlzLl9kYXRhLnNlYXJjaC5oZG49W10sdGhpcy5lbGVtZW50Lm9uKFwic2VhcmNoLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYixjKXtpZih0aGlzLl9kYXRhLnNlYXJjaC5zb20mJmMucmVzLmxlbmd0aCl7dmFyIGQ9dGhpcy5fbW9kZWwuZGF0YSxlLGYsZz1bXSxoLGk7Zm9yKGU9MCxmPWMucmVzLmxlbmd0aDtmPmU7ZSsrKWlmKGRbYy5yZXNbZV1dJiYhZFtjLnJlc1tlXV0uc3RhdGUuaGlkZGVuJiYoZy5wdXNoKGMucmVzW2VdKSxnPWcuY29uY2F0KGRbYy5yZXNbZV1dLnBhcmVudHMpLHRoaXMuX2RhdGEuc2VhcmNoLnNtYykpZm9yKGg9MCxpPWRbYy5yZXNbZV1dLmNoaWxkcmVuX2QubGVuZ3RoO2k+aDtoKyspZFtkW2MucmVzW2VdXS5jaGlsZHJlbl9kW2hdXSYmIWRbZFtjLnJlc1tlXV0uY2hpbGRyZW5fZFtoXV0uc3RhdGUuaGlkZGVuJiZnLnB1c2goZFtjLnJlc1tlXV0uY2hpbGRyZW5fZFtoXSk7Zz1hLnZha2F0YS5hcnJheV9yZW1vdmVfaXRlbShhLnZha2F0YS5hcnJheV91bmlxdWUoZyksYS5qc3RyZWUucm9vdCksdGhpcy5fZGF0YS5zZWFyY2guaGRuPXRoaXMuaGlkZV9hbGwoITApLHRoaXMuc2hvd19ub2RlKGcsITApLHRoaXMucmVkcmF3KCEwKX19LHRoaXMpKS5vbihcImNsZWFyX3NlYXJjaC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5fZGF0YS5zZWFyY2guc29tJiZiLnJlcy5sZW5ndGgmJih0aGlzLnNob3dfbm9kZSh0aGlzLl9kYXRhLnNlYXJjaC5oZG4sITApLHRoaXMucmVkcmF3KCEwKSl9LHRoaXMpKX0sdGhpcy5zZWFyY2g9ZnVuY3Rpb24oYyxkLGUsZixnLGgpe2lmKGM9PT0hMXx8XCJcIj09PWEudHJpbShjLnRvU3RyaW5nKCkpKXJldHVybiB0aGlzLmNsZWFyX3NlYXJjaCgpO2Y9dGhpcy5nZXRfbm9kZShmKSxmPWYmJmYuaWQ/Zi5pZDpudWxsLGM9Yy50b1N0cmluZygpO3ZhciBpPXRoaXMuc2V0dGluZ3Muc2VhcmNoLGo9aS5hamF4P2kuYWpheDohMSxrPXRoaXMuX21vZGVsLmRhdGEsbD1udWxsLG09W10sbj1bXSxvLHA7aWYodGhpcy5fZGF0YS5zZWFyY2gucmVzLmxlbmd0aCYmIWcmJnRoaXMuY2xlYXJfc2VhcmNoKCksZT09PWImJihlPWkuc2hvd19vbmx5X21hdGNoZXMpLGg9PT1iJiYoaD1pLnNob3dfb25seV9tYXRjaGVzX2NoaWxkcmVuKSwhZCYmaiE9PSExKXJldHVybiBhLmlzRnVuY3Rpb24oaik/ai5jYWxsKHRoaXMsYyxhLnByb3h5KGZ1bmN0aW9uKGIpe2ImJmIuZCYmKGI9Yi5kKSx0aGlzLl9sb2FkX25vZGVzKGEuaXNBcnJheShiKT9hLnZha2F0YS5hcnJheV91bmlxdWUoYik6W10sZnVuY3Rpb24oKXt0aGlzLnNlYXJjaChjLCEwLGUsZixnKX0pfSx0aGlzKSxmKTooaj1hLmV4dGVuZCh7fSxqKSxqLmRhdGF8fChqLmRhdGE9e30pLGouZGF0YS5zdHI9YyxmJiYoai5kYXRhLmluc2lkZT1mKSxhLmFqYXgoaikuZmFpbChhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiYWpheFwiLHBsdWdpbjpcInNlYXJjaFwiLGlkOlwic2VhcmNoXzAxXCIscmVhc29uOlwiQ291bGQgbm90IGxvYWQgc2VhcmNoIHBhcmVudHNcIixkYXRhOkpTT04uc3RyaW5naWZ5KGopfSx0aGlzLnNldHRpbmdzLmNvcmUuZXJyb3IuY2FsbCh0aGlzLHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yKX0sdGhpcykpLmRvbmUoYS5wcm94eShmdW5jdGlvbihiKXtiJiZiLmQmJihiPWIuZCksdGhpcy5fbG9hZF9ub2RlcyhhLmlzQXJyYXkoYik/YS52YWthdGEuYXJyYXlfdW5pcXVlKGIpOltdLGZ1bmN0aW9uKCl7dGhpcy5zZWFyY2goYywhMCxlLGYsZyl9KX0sdGhpcykpKTtpZihnfHwodGhpcy5fZGF0YS5zZWFyY2guc3RyPWMsdGhpcy5fZGF0YS5zZWFyY2guZG9tPWEoKSx0aGlzLl9kYXRhLnNlYXJjaC5yZXM9W10sdGhpcy5fZGF0YS5zZWFyY2gub3BuPVtdLHRoaXMuX2RhdGEuc2VhcmNoLnNvbT1lLHRoaXMuX2RhdGEuc2VhcmNoLnNtYz1oKSxsPW5ldyBhLnZha2F0YS5zZWFyY2goYywhMCx7Y2FzZVNlbnNpdGl2ZTppLmNhc2Vfc2Vuc2l0aXZlLGZ1enp5OmkuZnV6enl9KSxhLmVhY2goa1tmP2Y6YS5qc3RyZWUucm9vdF0uY2hpbGRyZW5fZCxmdW5jdGlvbihhLGIpe3ZhciBkPWtbYl07ZC50ZXh0JiYhZC5zdGF0ZS5oaWRkZW4mJighaS5zZWFyY2hfbGVhdmVzX29ubHl8fGQuc3RhdGUubG9hZGVkJiYwPT09ZC5jaGlsZHJlbi5sZW5ndGgpJiYoaS5zZWFyY2hfY2FsbGJhY2smJmkuc2VhcmNoX2NhbGxiYWNrLmNhbGwodGhpcyxjLGQpfHwhaS5zZWFyY2hfY2FsbGJhY2smJmwuc2VhcmNoKGQudGV4dCkuaXNNYXRjaCkmJihtLnB1c2goYiksbj1uLmNvbmNhdChkLnBhcmVudHMpKX0pLG0ubGVuZ3RoKXtmb3Iobj1hLnZha2F0YS5hcnJheV91bmlxdWUobiksbz0wLHA9bi5sZW5ndGg7cD5vO28rKyluW29dIT09YS5qc3RyZWUucm9vdCYma1tuW29dXSYmdGhpcy5vcGVuX25vZGUobltvXSxudWxsLDApPT09ITAmJnRoaXMuX2RhdGEuc2VhcmNoLm9wbi5wdXNoKG5bb10pO2c/KHRoaXMuX2RhdGEuc2VhcmNoLmRvbT10aGlzLl9kYXRhLnNlYXJjaC5kb20uYWRkKGEodGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjXCIrYS5tYXAobSxmdW5jdGlvbihiKXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoYlswXSk/XCJcXFxcM1wiK2JbMF0rXCIgXCIrYi5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmIucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpKSx0aGlzLl9kYXRhLnNlYXJjaC5yZXM9YS52YWthdGEuYXJyYXlfdW5pcXVlKHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5jb25jYXQobSkpKToodGhpcy5fZGF0YS5zZWFyY2guZG9tPWEodGhpcy5lbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjXCIrYS5tYXAobSxmdW5jdGlvbihiKXtyZXR1cm4tMSE9PVwiMDEyMzQ1Njc4OVwiLmluZGV4T2YoYlswXSk/XCJcXFxcM1wiK2JbMF0rXCIgXCIrYi5zdWJzdHIoMSkucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpOmIucmVwbGFjZShhLmpzdHJlZS5pZHJlZ2V4LFwiXFxcXCQmXCIpfSkuam9pbihcIiwgI1wiKSkpLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1tKSx0aGlzLl9kYXRhLnNlYXJjaC5kb20uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5hZGRDbGFzcyhcImpzdHJlZS1zZWFyY2hcIil9dGhpcy50cmlnZ2VyKFwic2VhcmNoXCIse25vZGVzOnRoaXMuX2RhdGEuc2VhcmNoLmRvbSxzdHI6YyxyZXM6dGhpcy5fZGF0YS5zZWFyY2gucmVzLHNob3dfb25seV9tYXRjaGVzOmV9KX0sdGhpcy5jbGVhcl9zZWFyY2g9ZnVuY3Rpb24oKXt0aGlzLnNldHRpbmdzLnNlYXJjaC5jbG9zZV9vcGVuZWRfb25jbGVhciYmdGhpcy5jbG9zZV9ub2RlKHRoaXMuX2RhdGEuc2VhcmNoLm9wbiwwKSx0aGlzLnRyaWdnZXIoXCJjbGVhcl9zZWFyY2hcIix7bm9kZXM6dGhpcy5fZGF0YS5zZWFyY2guZG9tLHN0cjp0aGlzLl9kYXRhLnNlYXJjaC5zdHIscmVzOnRoaXMuX2RhdGEuc2VhcmNoLnJlc30pLHRoaXMuX2RhdGEuc2VhcmNoLnJlcy5sZW5ndGgmJih0aGlzLl9kYXRhLnNlYXJjaC5kb209YSh0aGlzLmVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvckFsbChcIiNcIithLm1hcCh0aGlzLl9kYXRhLnNlYXJjaC5yZXMsZnVuY3Rpb24oYil7cmV0dXJuLTEhPT1cIjAxMjM0NTY3ODlcIi5pbmRleE9mKGJbMF0pP1wiXFxcXDNcIitiWzBdK1wiIFwiK2Iuc3Vic3RyKDEpLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKTpiLnJlcGxhY2UoYS5qc3RyZWUuaWRyZWdleCxcIlxcXFwkJlwiKX0pLmpvaW4oXCIsICNcIikpKSx0aGlzLl9kYXRhLnNlYXJjaC5kb20uY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS1zZWFyY2hcIikpLHRoaXMuX2RhdGEuc2VhcmNoLnN0cj1cIlwiLHRoaXMuX2RhdGEuc2VhcmNoLnJlcz1bXSx0aGlzLl9kYXRhLnNlYXJjaC5vcG49W10sdGhpcy5fZGF0YS5zZWFyY2guZG9tPWEoKX0sdGhpcy5yZWRyYXdfbm9kZT1mdW5jdGlvbihiLGMsZSxmKXtpZihiPWQucmVkcmF3X25vZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpLGImJi0xIT09YS5pbkFycmF5KGIuaWQsdGhpcy5fZGF0YS5zZWFyY2gucmVzKSl7dmFyIGcsaCxpPW51bGw7Zm9yKGc9MCxoPWIuY2hpbGROb2Rlcy5sZW5ndGg7aD5nO2crKylpZihiLmNoaWxkTm9kZXNbZ10mJmIuY2hpbGROb2Rlc1tnXS5jbGFzc05hbWUmJi0xIT09Yi5jaGlsZE5vZGVzW2ddLmNsYXNzTmFtZS5pbmRleE9mKFwianN0cmVlLWFuY2hvclwiKSl7aT1iLmNoaWxkTm9kZXNbZ107YnJlYWt9aSYmKGkuY2xhc3NOYW1lKz1cIiBqc3RyZWUtc2VhcmNoXCIpfXJldHVybiBifX0sZnVuY3Rpb24oYSl7YS52YWthdGEuc2VhcmNoPWZ1bmN0aW9uKGIsYyxkKXtkPWR8fHt9LGQ9YS5leHRlbmQoe30sYS52YWthdGEuc2VhcmNoLmRlZmF1bHRzLGQpLGQuZnV6enkhPT0hMSYmKGQuZnV6enk9ITApLGI9ZC5jYXNlU2Vuc2l0aXZlP2I6Yi50b0xvd2VyQ2FzZSgpO3ZhciBlPWQubG9jYXRpb24sZj1kLmRpc3RhbmNlLGc9ZC50aHJlc2hvbGQsaD1iLmxlbmd0aCxpLGosayxsO3JldHVybiBoPjMyJiYoZC5mdXp6eT0hMSksZC5mdXp6eSYmKGk9MTw8aC0xLGo9ZnVuY3Rpb24oKXt2YXIgYT17fSxjPTA7Zm9yKGM9MDtoPmM7YysrKWFbYi5jaGFyQXQoYyldPTA7Zm9yKGM9MDtoPmM7YysrKWFbYi5jaGFyQXQoYyldfD0xPDxoLWMtMTtyZXR1cm4gYX0oKSxrPWZ1bmN0aW9uKGEsYil7dmFyIGM9YS9oLGQ9TWF0aC5hYnMoZS1iKTtyZXR1cm4gZj9jK2QvZjpkPzE6Y30pLGw9ZnVuY3Rpb24oYSl7aWYoYT1kLmNhc2VTZW5zaXRpdmU/YTphLnRvTG93ZXJDYXNlKCksYj09PWF8fC0xIT09YS5pbmRleE9mKGIpKXJldHVybntpc01hdGNoOiEwLHNjb3JlOjB9O2lmKCFkLmZ1enp5KXJldHVybntpc01hdGNoOiExLHNjb3JlOjF9O3ZhciBjLGYsbD1hLmxlbmd0aCxtPWcsbj1hLmluZGV4T2YoYixlKSxvLHAscT1oK2wscixzLHQsdSx2LHc9MSx4PVtdO2ZvcigtMSE9PW4mJihtPU1hdGgubWluKGsoMCxuKSxtKSxuPWEubGFzdEluZGV4T2YoYixlK2gpLC0xIT09biYmKG09TWF0aC5taW4oaygwLG4pLG0pKSksbj0tMSxjPTA7aD5jO2MrKyl7bz0wLHA9cTt3aGlsZShwPm8payhjLGUrcCk8PW0/bz1wOnE9cCxwPU1hdGguZmxvb3IoKHEtbykvMitvKTtmb3IocT1wLHM9TWF0aC5tYXgoMSxlLXArMSksdD1NYXRoLm1pbihlK3AsbCkraCx1PW5ldyBBcnJheSh0KzIpLHVbdCsxXT0oMTw8YyktMSxmPXQ7Zj49cztmLS0paWYodj1qW2EuY2hhckF0KGYtMSldLDA9PT1jP3VbZl09KHVbZisxXTw8MXwxKSZ2OnVbZl09KHVbZisxXTw8MXwxKSZ2fCgocltmKzFdfHJbZl0pPDwxfDEpfHJbZisxXSx1W2ZdJmkmJih3PWsoYyxmLTEpLG0+PXcpKXtpZihtPXcsbj1mLTEseC5wdXNoKG4pLCEobj5lKSlicmVhaztzPU1hdGgubWF4KDEsMiplLW4pfWlmKGsoYysxLGUpPm0pYnJlYWs7cj11fXJldHVybntpc01hdGNoOm4+PTAsc2NvcmU6d319LGM9PT0hMD97c2VhcmNoOmx9OmwoYyl9LGEudmFrYXRhLnNlYXJjaC5kZWZhdWx0cz17bG9jYXRpb246MCxkaXN0YW5jZToxMDAsdGhyZXNob2xkOi42LGZ1enp5OiExLGNhc2VTZW5zaXRpdmU6ITF9fShhKSxhLmpzdHJlZS5kZWZhdWx0cy5zb3J0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZ2V0X3RleHQoYSk+dGhpcy5nZXRfdGV4dChiKT8xOi0xfSxhLmpzdHJlZS5wbHVnaW5zLnNvcnQ9ZnVuY3Rpb24oYixjKXt0aGlzLmJpbmQ9ZnVuY3Rpb24oKXtjLmJpbmQuY2FsbCh0aGlzKSx0aGlzLmVsZW1lbnQub24oXCJtb2RlbC5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5zb3J0KGIucGFyZW50LCEwKX0sdGhpcykpLm9uKFwicmVuYW1lX25vZGUuanN0cmVlIGNyZWF0ZV9ub2RlLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLnNvcnQoYi5wYXJlbnR8fGIubm9kZS5wYXJlbnQsITEpLHRoaXMucmVkcmF3X25vZGUoYi5wYXJlbnR8fGIubm9kZS5wYXJlbnQsITApfSx0aGlzKSkub24oXCJtb3ZlX25vZGUuanN0cmVlIGNvcHlfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5zb3J0KGIucGFyZW50LCExKSx0aGlzLnJlZHJhd19ub2RlKGIucGFyZW50LCEwKX0sdGhpcykpfSx0aGlzLnNvcnQ9ZnVuY3Rpb24oYixjKXt2YXIgZCxlO2lmKGI9dGhpcy5nZXRfbm9kZShiKSxiJiZiLmNoaWxkcmVuJiZiLmNoaWxkcmVuLmxlbmd0aCYmKGIuY2hpbGRyZW4uc29ydChhLnByb3h5KHRoaXMuc2V0dGluZ3Muc29ydCx0aGlzKSksYykpZm9yKGQ9MCxlPWIuY2hpbGRyZW5fZC5sZW5ndGg7ZT5kO2QrKyl0aGlzLnNvcnQoYi5jaGlsZHJlbl9kW2RdLCExKX19O3ZhciBwPSExO2EuanN0cmVlLmRlZmF1bHRzLnN0YXRlPXtrZXk6XCJqc3RyZWVcIixldmVudHM6XCJjaGFuZ2VkLmpzdHJlZSBvcGVuX25vZGUuanN0cmVlIGNsb3NlX25vZGUuanN0cmVlIGNoZWNrX25vZGUuanN0cmVlIHVuY2hlY2tfbm9kZS5qc3RyZWVcIix0dGw6ITEsZmlsdGVyOiExfSxhLmpzdHJlZS5wbHVnaW5zLnN0YXRlPWZ1bmN0aW9uKGIsYyl7dGhpcy5iaW5kPWZ1bmN0aW9uKCl7Yy5iaW5kLmNhbGwodGhpcyk7dmFyIGI9YS5wcm94eShmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5vbih0aGlzLnNldHRpbmdzLnN0YXRlLmV2ZW50cyxhLnByb3h5KGZ1bmN0aW9uKCl7cCYmY2xlYXJUaW1lb3V0KHApLHA9c2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy5zYXZlX3N0YXRlKCl9LHRoaXMpLDEwMCl9LHRoaXMpKSx0aGlzLnRyaWdnZXIoXCJzdGF0ZV9yZWFkeVwiKX0sdGhpcyk7dGhpcy5lbGVtZW50Lm9uKFwicmVhZHkuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihhLGMpe3RoaXMuZWxlbWVudC5vbmUoXCJyZXN0b3JlX3N0YXRlLmpzdHJlZVwiLGIpLHRoaXMucmVzdG9yZV9zdGF0ZSgpfHxiKCl9LHRoaXMpKX0sdGhpcy5zYXZlX3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGI9e3N0YXRlOnRoaXMuZ2V0X3N0YXRlKCksdHRsOnRoaXMuc2V0dGluZ3Muc3RhdGUudHRsLHNlYzorbmV3IERhdGV9O2EudmFrYXRhLnN0b3JhZ2Uuc2V0KHRoaXMuc2V0dGluZ3Muc3RhdGUua2V5LEpTT04uc3RyaW5naWZ5KGIpKX0sdGhpcy5yZXN0b3JlX3N0YXRlPWZ1bmN0aW9uKCl7dmFyIGI9YS52YWthdGEuc3RvcmFnZS5nZXQodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXkpO2lmKGIpdHJ5e2I9SlNPTi5wYXJzZShiKX1jYXRjaChjKXtyZXR1cm4hMX1yZXR1cm4gYiYmYi50dGwmJmIuc2VjJiYrbmV3IERhdGUtYi5zZWM+Yi50dGw/ITE6KGImJmIuc3RhdGUmJihiPWIuc3RhdGUpLGImJmEuaXNGdW5jdGlvbih0aGlzLnNldHRpbmdzLnN0YXRlLmZpbHRlcikmJihiPXRoaXMuc2V0dGluZ3Muc3RhdGUuZmlsdGVyLmNhbGwodGhpcyxiKSksYj8odGhpcy5lbGVtZW50Lm9uZShcInNldF9zdGF0ZS5qc3RyZWVcIixmdW5jdGlvbihjLGQpe2QuaW5zdGFuY2UudHJpZ2dlcihcInJlc3RvcmVfc3RhdGVcIix7c3RhdGU6YS5leHRlbmQoITAse30sYil9KX0pLHRoaXMuc2V0X3N0YXRlKGIpLCEwKTohMSl9LHRoaXMuY2xlYXJfc3RhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gYS52YWthdGEuc3RvcmFnZS5kZWwodGhpcy5zZXR0aW5ncy5zdGF0ZS5rZXkpfX0sZnVuY3Rpb24oYSxiKXthLnZha2F0YS5zdG9yYWdlPXtzZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGEsYil9LGdldDpmdW5jdGlvbihhKXtyZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGEpfSxkZWw6ZnVuY3Rpb24oYSl7cmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShhKX19fShhKSxhLmpzdHJlZS5kZWZhdWx0cy50eXBlcz17XCJkZWZhdWx0XCI6e319LGEuanN0cmVlLmRlZmF1bHRzLnR5cGVzW2EuanN0cmVlLnJvb3RdPXt9LGEuanN0cmVlLnBsdWdpbnMudHlwZXM9ZnVuY3Rpb24oYyxkKXt0aGlzLmluaXQ9ZnVuY3Rpb24oYyxlKXt2YXIgZixnO2lmKGUmJmUudHlwZXMmJmUudHlwZXNbXCJkZWZhdWx0XCJdKWZvcihmIGluIGUudHlwZXMpaWYoXCJkZWZhdWx0XCIhPT1mJiZmIT09YS5qc3RyZWUucm9vdCYmZS50eXBlcy5oYXNPd25Qcm9wZXJ0eShmKSlmb3IoZyBpbiBlLnR5cGVzW1wiZGVmYXVsdFwiXSllLnR5cGVzW1wiZGVmYXVsdFwiXS5oYXNPd25Qcm9wZXJ0eShnKSYmZS50eXBlc1tmXVtnXT09PWImJihlLnR5cGVzW2ZdW2ddPWUudHlwZXNbXCJkZWZhdWx0XCJdW2ddKTtkLmluaXQuY2FsbCh0aGlzLGMsZSksdGhpcy5fbW9kZWwuZGF0YVthLmpzdHJlZS5yb290XS50eXBlPWEuanN0cmVlLnJvb3R9LHRoaXMucmVmcmVzaD1mdW5jdGlvbihiLGMpe2QucmVmcmVzaC5jYWxsKHRoaXMsYixjKSx0aGlzLl9tb2RlbC5kYXRhW2EuanN0cmVlLnJvb3RdLnR5cGU9YS5qc3RyZWUucm9vdH0sdGhpcy5iaW5kPWZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50Lm9uKFwibW9kZWwuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbihjLGQpe3ZhciBlPXRoaXMuX21vZGVsLmRhdGEsZj1kLm5vZGVzLGc9dGhpcy5zZXR0aW5ncy50eXBlcyxoLGksaj1cImRlZmF1bHRcIixrO2ZvcihoPTAsaT1mLmxlbmd0aDtpPmg7aCsrKXtpZihqPVwiZGVmYXVsdFwiLGVbZltoXV0ub3JpZ2luYWwmJmVbZltoXV0ub3JpZ2luYWwudHlwZSYmZ1tlW2ZbaF1dLm9yaWdpbmFsLnR5cGVdJiYoaj1lW2ZbaF1dLm9yaWdpbmFsLnR5cGUpLGVbZltoXV0uZGF0YSYmZVtmW2hdXS5kYXRhLmpzdHJlZSYmZVtmW2hdXS5kYXRhLmpzdHJlZS50eXBlJiZnW2VbZltoXV0uZGF0YS5qc3RyZWUudHlwZV0mJihqPWVbZltoXV0uZGF0YS5qc3RyZWUudHlwZSksZVtmW2hdXS50eXBlPWosZVtmW2hdXS5pY29uPT09ITAmJmdbal0uaWNvbiE9PWImJihlW2ZbaF1dLmljb249Z1tqXS5pY29uKSxnW2pdLmxpX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZ1tqXS5saV9hdHRyKWZvcihrIGluIGdbal0ubGlfYXR0cilpZihnW2pdLmxpX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtmW2hdXS5saV9hdHRyW2tdPT09Yj9lW2ZbaF1dLmxpX2F0dHJba109Z1tqXS5saV9hdHRyW2tdOlwiY2xhc3NcIj09PWsmJihlW2ZbaF1dLmxpX2F0dHJbXCJjbGFzc1wiXT1nW2pdLmxpX2F0dHJbXCJjbGFzc1wiXStcIiBcIitlW2ZbaF1dLmxpX2F0dHJbXCJjbGFzc1wiXSl9aWYoZ1tqXS5hX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZ1tqXS5hX2F0dHIpZm9yKGsgaW4gZ1tqXS5hX2F0dHIpaWYoZ1tqXS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtmW2hdXS5hX2F0dHJba109PT1iP2VbZltoXV0uYV9hdHRyW2tdPWdbal0uYV9hdHRyW2tdOlwiaHJlZlwiPT09ayYmXCIjXCI9PT1lW2ZbaF1dLmFfYXR0cltrXT9lW2ZbaF1dLmFfYXR0ci5ocmVmPWdbal0uYV9hdHRyLmhyZWY6XCJjbGFzc1wiPT09ayYmKGVbZltoXV0uYV9hdHRyW1wiY2xhc3NcIl09Z1tqXS5hX2F0dHJbXCJjbGFzc1wiXStcIiBcIitlW2ZbaF1dLmFfYXR0cltcImNsYXNzXCJdKX19ZVthLmpzdHJlZS5yb290XS50eXBlPWEuanN0cmVlLnJvb3R9LHRoaXMpKSxkLmJpbmQuY2FsbCh0aGlzKX0sdGhpcy5nZXRfanNvbj1mdW5jdGlvbihiLGMsZSl7dmFyIGYsZyxoPXRoaXMuX21vZGVsLmRhdGEsaT1jP2EuZXh0ZW5kKCEwLHt9LGMse25vX2lkOiExfSk6e30saj1kLmdldF9qc29uLmNhbGwodGhpcyxiLGksZSk7aWYoaj09PSExKXJldHVybiExO2lmKGEuaXNBcnJheShqKSlmb3IoZj0wLGc9ai5sZW5ndGg7Zz5mO2YrKylqW2ZdLnR5cGU9altmXS5pZCYmaFtqW2ZdLmlkXSYmaFtqW2ZdLmlkXS50eXBlP2hbaltmXS5pZF0udHlwZTpcImRlZmF1bHRcIixjJiZjLm5vX2lkJiYoZGVsZXRlIGpbZl0uaWQsaltmXS5saV9hdHRyJiZqW2ZdLmxpX2F0dHIuaWQmJmRlbGV0ZSBqW2ZdLmxpX2F0dHIuaWQsaltmXS5hX2F0dHImJmpbZl0uYV9hdHRyLmlkJiZkZWxldGUgaltmXS5hX2F0dHIuaWQpO2Vsc2Ugai50eXBlPWouaWQmJmhbai5pZF0mJmhbai5pZF0udHlwZT9oW2ouaWRdLnR5cGU6XCJkZWZhdWx0XCIsYyYmYy5ub19pZCYmKGo9dGhpcy5fZGVsZXRlX2lkcyhqKSk7cmV0dXJuIGp9LHRoaXMuX2RlbGV0ZV9pZHM9ZnVuY3Rpb24oYil7aWYoYS5pc0FycmF5KGIpKXtmb3IodmFyIGM9MCxkPWIubGVuZ3RoO2Q+YztjKyspYltjXT10aGlzLl9kZWxldGVfaWRzKGJbY10pO3JldHVybiBifXJldHVybiBkZWxldGUgYi5pZCxiLmxpX2F0dHImJmIubGlfYXR0ci5pZCYmZGVsZXRlIGIubGlfYXR0ci5pZCxiLmFfYXR0ciYmYi5hX2F0dHIuaWQmJmRlbGV0ZSBiLmFfYXR0ci5pZCxiLmNoaWxkcmVuJiZhLmlzQXJyYXkoYi5jaGlsZHJlbikmJihiLmNoaWxkcmVuPXRoaXMuX2RlbGV0ZV9pZHMoYi5jaGlsZHJlbikpLGJ9LHRoaXMuY2hlY2s9ZnVuY3Rpb24oYyxlLGYsZyxoKXtpZihkLmNoZWNrLmNhbGwodGhpcyxjLGUsZixnLGgpPT09ITEpcmV0dXJuITE7ZT1lJiZlLmlkP2U6dGhpcy5nZXRfbm9kZShlKSxmPWYmJmYuaWQ/Zjp0aGlzLmdldF9ub2RlKGYpO3ZhciBpPWUmJmUuaWQ/aCYmaC5vcmlnaW4/aC5vcmlnaW46YS5qc3RyZWUucmVmZXJlbmNlKGUuaWQpOm51bGwsaixrLGwsbTtzd2l0Y2goaT1pJiZpLl9tb2RlbCYmaS5fbW9kZWwuZGF0YT9pLl9tb2RlbC5kYXRhOm51bGwsYyl7Y2FzZVwiY3JlYXRlX25vZGVcIjpjYXNlXCJtb3ZlX25vZGVcIjpjYXNlXCJjb3B5X25vZGVcIjppZihcIm1vdmVfbm9kZVwiIT09Y3x8LTE9PT1hLmluQXJyYXkoZS5pZCxmLmNoaWxkcmVuKSl7aWYoaj10aGlzLmdldF9ydWxlcyhmKSxqLm1heF9jaGlsZHJlbiE9PWImJi0xIT09ai5tYXhfY2hpbGRyZW4mJmoubWF4X2NoaWxkcmVuPT09Zi5jaGlsZHJlbi5sZW5ndGgpcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAxXCIscmVhc29uOlwibWF4X2NoaWxkcmVuIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitjLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpjLHBvczpnLG9iajplJiZlLmlkP2UuaWQ6ITEscGFyOmYmJmYuaWQ/Zi5pZDohMX0pfSwhMTtpZihqLnZhbGlkX2NoaWxkcmVuIT09YiYmLTEhPT1qLnZhbGlkX2NoaWxkcmVuJiYtMT09PWEuaW5BcnJheShlLnR5cGV8fFwiZGVmYXVsdFwiLGoudmFsaWRfY2hpbGRyZW4pKXJldHVybiB0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInR5cGVzXCIsaWQ6XCJ0eXBlc18wMlwiLHJlYXNvbjpcInZhbGlkX2NoaWxkcmVuIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitjLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpjLHBvczpnLG9iajplJiZlLmlkP2UuaWQ6ITEscGFyOmYmJmYuaWQ/Zi5pZDohMX0pfSwhMTtpZihpJiZlLmNoaWxkcmVuX2QmJmUucGFyZW50cyl7Zm9yKGs9MCxsPTAsbT1lLmNoaWxkcmVuX2QubGVuZ3RoO20+bDtsKyspaz1NYXRoLm1heChrLGlbZS5jaGlsZHJlbl9kW2xdXS5wYXJlbnRzLmxlbmd0aCk7az1rLWUucGFyZW50cy5sZW5ndGgrMX0oMD49a3x8az09PWIpJiYoaz0xKTtkb3tpZihqLm1heF9kZXB0aCE9PWImJi0xIT09ai5tYXhfZGVwdGgmJmoubWF4X2RlcHRoPGspcmV0dXJuIHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidHlwZXNcIixpZDpcInR5cGVzXzAzXCIscmVhc29uOlwibWF4X2RlcHRoIHByZXZlbnRzIGZ1bmN0aW9uOiBcIitjLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpjLHBvczpnLG9iajplJiZlLmlkP2UuaWQ6ITEscGFyOmYmJmYuaWQ/Zi5pZDohMX0pfSwhMTtmPXRoaXMuZ2V0X25vZGUoZi5wYXJlbnQpLGo9dGhpcy5nZXRfcnVsZXMoZiksaysrfXdoaWxlKGYpfX1yZXR1cm4hMH0sdGhpcy5nZXRfcnVsZXM9ZnVuY3Rpb24oYSl7aWYoYT10aGlzLmdldF9ub2RlKGEpLCFhKXJldHVybiExO3ZhciBjPXRoaXMuZ2V0X3R5cGUoYSwhMCk7cmV0dXJuIGMubWF4X2RlcHRoPT09YiYmKGMubWF4X2RlcHRoPS0xKSxjLm1heF9jaGlsZHJlbj09PWImJihjLm1heF9jaGlsZHJlbj0tMSksYy52YWxpZF9jaGlsZHJlbj09PWImJihjLnZhbGlkX2NoaWxkcmVuPS0xKSxjfSx0aGlzLmdldF90eXBlPWZ1bmN0aW9uKGIsYyl7cmV0dXJuIGI9dGhpcy5nZXRfbm9kZShiKSxiP2M/YS5leHRlbmQoe3R5cGU6Yi50eXBlfSx0aGlzLnNldHRpbmdzLnR5cGVzW2IudHlwZV0pOmIudHlwZTohMX0sdGhpcy5zZXRfdHlwZT1mdW5jdGlvbihjLGQpe3ZhciBlPXRoaXMuX21vZGVsLmRhdGEsZixnLGgsaSxqLGssbCxtO2lmKGEuaXNBcnJheShjKSl7Zm9yKGM9Yy5zbGljZSgpLGc9MCxoPWMubGVuZ3RoO2g+ZztnKyspdGhpcy5zZXRfdHlwZShjW2ddLGQpO3JldHVybiEwfWlmKGY9dGhpcy5zZXR0aW5ncy50eXBlcyxjPXRoaXMuZ2V0X25vZGUoYyksIWZbZF18fCFjKXJldHVybiExO2lmKGw9dGhpcy5nZXRfbm9kZShjLCEwKSxsJiZsLmxlbmd0aCYmKG09bC5jaGlsZHJlbihcIi5qc3RyZWUtYW5jaG9yXCIpKSxpPWMudHlwZSxqPXRoaXMuZ2V0X2ljb24oYyksYy50eXBlPWQsKGo9PT0hMHx8ZltpXSYmZltpXS5pY29uIT09YiYmaj09PWZbaV0uaWNvbikmJnRoaXMuc2V0X2ljb24oYyxmW2RdLmljb24hPT1iP2ZbZF0uaWNvbjohMCksZltpXS5saV9hdHRyIT09YiYmXCJvYmplY3RcIj09dHlwZW9mIGZbaV0ubGlfYXR0cilmb3IoayBpbiBmW2ldLmxpX2F0dHIpaWYoZltpXS5saV9hdHRyLmhhc093blByb3BlcnR5KGspKXtpZihcImlkXCI9PT1rKWNvbnRpbnVlO1wiY2xhc3NcIj09PWs/KGVbYy5pZF0ubGlfYXR0cltcImNsYXNzXCJdPShlW2MuaWRdLmxpX2F0dHJbXCJjbGFzc1wiXXx8XCJcIikucmVwbGFjZShmW2ldLmxpX2F0dHJba10sXCJcIiksbCYmbC5yZW1vdmVDbGFzcyhmW2ldLmxpX2F0dHJba10pKTplW2MuaWRdLmxpX2F0dHJba109PT1mW2ldLmxpX2F0dHJba10mJihlW2MuaWRdLmxpX2F0dHJba109bnVsbCxsJiZsLnJlbW92ZUF0dHIoaykpfWlmKGZbaV0uYV9hdHRyIT09YiYmXCJvYmplY3RcIj09dHlwZW9mIGZbaV0uYV9hdHRyKWZvcihrIGluIGZbaV0uYV9hdHRyKWlmKGZbaV0uYV9hdHRyLmhhc093blByb3BlcnR5KGspKXtpZihcImlkXCI9PT1rKWNvbnRpbnVlO1wiY2xhc3NcIj09PWs/KGVbYy5pZF0uYV9hdHRyW1wiY2xhc3NcIl09KGVbYy5pZF0uYV9hdHRyW1wiY2xhc3NcIl18fFwiXCIpLnJlcGxhY2UoZltpXS5hX2F0dHJba10sXCJcIiksbSYmbS5yZW1vdmVDbGFzcyhmW2ldLmFfYXR0cltrXSkpOmVbYy5pZF0uYV9hdHRyW2tdPT09ZltpXS5hX2F0dHJba10mJihcImhyZWZcIj09PWs/KGVbYy5pZF0uYV9hdHRyW2tdPVwiI1wiLG0mJm0uYXR0cihcImhyZWZcIixcIiNcIikpOihkZWxldGUgZVtjLmlkXS5hX2F0dHJba10sbSYmbS5yZW1vdmVBdHRyKGspKSl9aWYoZltkXS5saV9hdHRyIT09YiYmXCJvYmplY3RcIj09dHlwZW9mIGZbZF0ubGlfYXR0cilmb3IoayBpbiBmW2RdLmxpX2F0dHIpaWYoZltkXS5saV9hdHRyLmhhc093blByb3BlcnR5KGspKXtpZihcImlkXCI9PT1rKWNvbnRpbnVlO2VbYy5pZF0ubGlfYXR0cltrXT09PWI/KGVbYy5pZF0ubGlfYXR0cltrXT1mW2RdLmxpX2F0dHJba10sbCYmKFwiY2xhc3NcIj09PWs/bC5hZGRDbGFzcyhmW2RdLmxpX2F0dHJba10pOmwuYXR0cihrLGZbZF0ubGlfYXR0cltrXSkpKTpcImNsYXNzXCI9PT1rJiYoZVtjLmlkXS5saV9hdHRyW1wiY2xhc3NcIl09ZltkXS5saV9hdHRyW2tdK1wiIFwiK2VbYy5pZF0ubGlfYXR0cltcImNsYXNzXCJdLGwmJmwuYWRkQ2xhc3MoZltkXS5saV9hdHRyW2tdKSl9aWYoZltkXS5hX2F0dHIhPT1iJiZcIm9iamVjdFwiPT10eXBlb2YgZltkXS5hX2F0dHIpZm9yKGsgaW4gZltkXS5hX2F0dHIpaWYoZltkXS5hX2F0dHIuaGFzT3duUHJvcGVydHkoaykpe2lmKFwiaWRcIj09PWspY29udGludWU7ZVtjLmlkXS5hX2F0dHJba109PT1iPyhlW2MuaWRdLmFfYXR0cltrXT1mW2RdLmFfYXR0cltrXSxtJiYoXCJjbGFzc1wiPT09az9tLmFkZENsYXNzKGZbZF0uYV9hdHRyW2tdKTptLmF0dHIoayxmW2RdLmFfYXR0cltrXSkpKTpcImhyZWZcIj09PWsmJlwiI1wiPT09ZVtjLmlkXS5hX2F0dHJba10/KGVbYy5pZF0uYV9hdHRyLmhyZWY9ZltkXS5hX2F0dHIuaHJlZixtJiZtLmF0dHIoXCJocmVmXCIsZltkXS5hX2F0dHIuaHJlZikpOlwiY2xhc3NcIj09PWsmJihlW2MuaWRdLmFfYXR0cltcImNsYXNzXCJdPWZbZF0uYV9hdHRyW1wiY2xhc3NcIl0rXCIgXCIrZVtjLmlkXS5hX2F0dHJbXCJjbGFzc1wiXSxtJiZtLmFkZENsYXNzKGZbZF0uYV9hdHRyW2tdKSl9cmV0dXJuITB9fSxhLmpzdHJlZS5kZWZhdWx0cy51bmlxdWU9e2Nhc2Vfc2Vuc2l0aXZlOiExLGR1cGxpY2F0ZTpmdW5jdGlvbihhLGIpe3JldHVybiBhK1wiIChcIitiK1wiKVwifX0sYS5qc3RyZWUucGx1Z2lucy51bmlxdWU9ZnVuY3Rpb24oYyxkKXt0aGlzLmNoZWNrPWZ1bmN0aW9uKGIsYyxlLGYsZyl7aWYoZC5jaGVjay5jYWxsKHRoaXMsYixjLGUsZixnKT09PSExKXJldHVybiExO2lmKGM9YyYmYy5pZD9jOnRoaXMuZ2V0X25vZGUoYyksZT1lJiZlLmlkP2U6dGhpcy5nZXRfbm9kZShlKSwhZXx8IWUuY2hpbGRyZW4pcmV0dXJuITA7dmFyIGg9XCJyZW5hbWVfbm9kZVwiPT09Yj9mOmMudGV4dCxpPVtdLGo9dGhpcy5zZXR0aW5ncy51bmlxdWUuY2FzZV9zZW5zaXRpdmUsaz10aGlzLl9tb2RlbC5kYXRhLGwsbTtmb3IobD0wLG09ZS5jaGlsZHJlbi5sZW5ndGg7bT5sO2wrKylpLnB1c2goaj9rW2UuY2hpbGRyZW5bbF1dLnRleHQ6a1tlLmNoaWxkcmVuW2xdXS50ZXh0LnRvTG93ZXJDYXNlKCkpO3N3aXRjaChqfHwoaD1oLnRvTG93ZXJDYXNlKCkpLGIpe2Nhc2VcImRlbGV0ZV9ub2RlXCI6cmV0dXJuITA7Y2FzZVwicmVuYW1lX25vZGVcIjpyZXR1cm4gbD0tMT09PWEuaW5BcnJheShoLGkpfHxjLnRleHQmJmMudGV4dFtqP1widG9TdHJpbmdcIjpcInRvTG93ZXJDYXNlXCJdKCk9PT1oLGx8fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzAxXCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2grXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmYsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZSYmZS5pZD9lLmlkOiExfSl9KSxsO2Nhc2VcImNyZWF0ZV9ub2RlXCI6cmV0dXJuIGw9LTE9PT1hLmluQXJyYXkoaCxpKSxsfHwodGhpcy5fZGF0YS5jb3JlLmxhc3RfZXJyb3I9e2Vycm9yOlwiY2hlY2tcIixwbHVnaW46XCJ1bmlxdWVcIixpZDpcInVuaXF1ZV8wNFwiLHJlYXNvbjpcIkNoaWxkIHdpdGggbmFtZSBcIitoK1wiIGFscmVhZHkgZXhpc3RzLiBQcmV2ZW50aW5nOiBcIitiLGRhdGE6SlNPTi5zdHJpbmdpZnkoe2NoazpiLHBvczpmLG9iajpjJiZjLmlkP2MuaWQ6ITEscGFyOmUmJmUuaWQ/ZS5pZDohMX0pfSksbDtjYXNlXCJjb3B5X25vZGVcIjpyZXR1cm4gbD0tMT09PWEuaW5BcnJheShoLGkpLGx8fCh0aGlzLl9kYXRhLmNvcmUubGFzdF9lcnJvcj17ZXJyb3I6XCJjaGVja1wiLHBsdWdpbjpcInVuaXF1ZVwiLGlkOlwidW5pcXVlXzAyXCIscmVhc29uOlwiQ2hpbGQgd2l0aCBuYW1lIFwiK2grXCIgYWxyZWFkeSBleGlzdHMuIFByZXZlbnRpbmc6IFwiK2IsZGF0YTpKU09OLnN0cmluZ2lmeSh7Y2hrOmIscG9zOmYsb2JqOmMmJmMuaWQ/Yy5pZDohMSxwYXI6ZSYmZS5pZD9lLmlkOiExfSl9KSxsO2Nhc2VcIm1vdmVfbm9kZVwiOnJldHVybiBsPWMucGFyZW50PT09ZS5pZCYmKCFnfHwhZy5pc19tdWx0aSl8fC0xPT09YS5pbkFycmF5KGgsaSksbHx8KHRoaXMuX2RhdGEuY29yZS5sYXN0X2Vycm9yPXtlcnJvcjpcImNoZWNrXCIscGx1Z2luOlwidW5pcXVlXCIsaWQ6XCJ1bmlxdWVfMDNcIixyZWFzb246XCJDaGlsZCB3aXRoIG5hbWUgXCIraCtcIiBhbHJlYWR5IGV4aXN0cy4gUHJldmVudGluZzogXCIrYixkYXRhOkpTT04uc3RyaW5naWZ5KHtjaGs6Yixwb3M6ZixvYmo6YyYmYy5pZD9jLmlkOiExLHBhcjplJiZlLmlkP2UuaWQ6ITF9KX0pLGx9cmV0dXJuITB9LHRoaXMuY3JlYXRlX25vZGU9ZnVuY3Rpb24oYyxlLGYsZyxoKXtpZighZXx8ZS50ZXh0PT09Yil7aWYobnVsbD09PWMmJihjPWEuanN0cmVlLnJvb3QpLGM9dGhpcy5nZXRfbm9kZShjKSwhYylyZXR1cm4gZC5jcmVhdGVfbm9kZS5jYWxsKHRoaXMsYyxlLGYsZyxoKTtpZihmPWY9PT1iP1wibGFzdFwiOmYsIWYudG9TdHJpbmcoKS5tYXRjaCgvXihiZWZvcmV8YWZ0ZXIpJC8pJiYhaCYmIXRoaXMuaXNfbG9hZGVkKGMpKXJldHVybiBkLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxjLGUsZixnLGgpO1xuZXx8KGU9e30pO3ZhciBpLGosayxsLG0sbj10aGlzLl9tb2RlbC5kYXRhLG89dGhpcy5zZXR0aW5ncy51bmlxdWUuY2FzZV9zZW5zaXRpdmUscD10aGlzLnNldHRpbmdzLnVuaXF1ZS5kdXBsaWNhdGU7Zm9yKGo9aT10aGlzLmdldF9zdHJpbmcoXCJOZXcgbm9kZVwiKSxrPVtdLGw9MCxtPWMuY2hpbGRyZW4ubGVuZ3RoO20+bDtsKyspay5wdXNoKG8/bltjLmNoaWxkcmVuW2xdXS50ZXh0Om5bYy5jaGlsZHJlbltsXV0udGV4dC50b0xvd2VyQ2FzZSgpKTtsPTE7d2hpbGUoLTEhPT1hLmluQXJyYXkobz9qOmoudG9Mb3dlckNhc2UoKSxrKSlqPXAuY2FsbCh0aGlzLGksKytsKS50b1N0cmluZygpO2UudGV4dD1qfXJldHVybiBkLmNyZWF0ZV9ub2RlLmNhbGwodGhpcyxjLGUsZixnLGgpfX07dmFyIHE9aS5jcmVhdGVFbGVtZW50KFwiRElWXCIpO2lmKHEuc2V0QXR0cmlidXRlKFwidW5zZWxlY3RhYmxlXCIsXCJvblwiKSxxLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxxLmNsYXNzTmFtZT1cImpzdHJlZS13aG9sZXJvd1wiLHEuaW5uZXJIVE1MPVwiJiMxNjA7XCIsYS5qc3RyZWUucGx1Z2lucy53aG9sZXJvdz1mdW5jdGlvbihiLGMpe3RoaXMuYmluZD1mdW5jdGlvbigpe2MuYmluZC5jYWxsKHRoaXMpLHRoaXMuZWxlbWVudC5vbihcInJlYWR5LmpzdHJlZSBzZXRfc3RhdGUuanN0cmVlXCIsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuaGlkZV9kb3RzKCl9LHRoaXMpKS5vbihcImluaXQuanN0cmVlIGxvYWRpbmcuanN0cmVlIHJlYWR5LmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oKXt0aGlzLmdldF9jb250YWluZXJfdWwoKS5hZGRDbGFzcyhcImpzdHJlZS13aG9sZXJvdy11bFwiKX0sdGhpcykpLm9uKFwiZGVzZWxlY3RfYWxsLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpfSx0aGlzKSkub24oXCJjaGFuZ2VkLmpzdHJlZVwiLGEucHJveHkoZnVuY3Rpb24oYSxiKXt0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3ctY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImpzdHJlZS13aG9sZXJvdy1jbGlja2VkXCIpO3ZhciBjPSExLGQsZTtmb3IoZD0wLGU9Yi5zZWxlY3RlZC5sZW5ndGg7ZT5kO2QrKyljPXRoaXMuZ2V0X25vZGUoYi5zZWxlY3RlZFtkXSwhMCksYyYmYy5sZW5ndGgmJmMuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcIm9wZW5fbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7dGhpcy5nZXRfbm9kZShiLm5vZGUsITApLmZpbmQoXCIuanN0cmVlLWNsaWNrZWRcIikucGFyZW50KCkuY2hpbGRyZW4oXCIuanN0cmVlLXdob2xlcm93XCIpLmFkZENsYXNzKFwianN0cmVlLXdob2xlcm93LWNsaWNrZWRcIil9LHRoaXMpKS5vbihcImhvdmVyX25vZGUuanN0cmVlIGRlaG92ZXJfbm9kZS5qc3RyZWVcIixhLnByb3h5KGZ1bmN0aW9uKGEsYil7XCJob3Zlcl9ub2RlXCI9PT1hLnR5cGUmJnRoaXMuaXNfZGlzYWJsZWQoYi5ub2RlKXx8dGhpcy5nZXRfbm9kZShiLm5vZGUsITApLmNoaWxkcmVuKFwiLmpzdHJlZS13aG9sZXJvd1wiKVtcImhvdmVyX25vZGVcIj09PWEudHlwZT9cImFkZENsYXNzXCI6XCJyZW1vdmVDbGFzc1wiXShcImpzdHJlZS13aG9sZXJvdy1ob3ZlcmVkXCIpfSx0aGlzKSkub24oXCJjb250ZXh0bWVudS5qc3RyZWVcIixcIi5qc3RyZWUtd2hvbGVyb3dcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2lmKHRoaXMuX2RhdGEuY29udGV4dG1lbnUpe2IucHJldmVudERlZmF1bHQoKTt2YXIgYz1hLkV2ZW50KFwiY29udGV4dG1lbnVcIix7bWV0YUtleTpiLm1ldGFLZXksY3RybEtleTpiLmN0cmxLZXksYWx0S2V5OmIuYWx0S2V5LHNoaWZ0S2V5OmIuc2hpZnRLZXkscGFnZVg6Yi5wYWdlWCxwYWdlWTpiLnBhZ2VZfSk7YShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoYyl9fSx0aGlzKSkub24oXCJjbGljay5qc3RyZWVcIixcIi5qc3RyZWUtd2hvbGVyb3dcIixmdW5jdGlvbihiKXtiLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO3ZhciBjPWEuRXZlbnQoXCJjbGlja1wiLHttZXRhS2V5OmIubWV0YUtleSxjdHJsS2V5OmIuY3RybEtleSxhbHRLZXk6Yi5hbHRLZXksc2hpZnRLZXk6Yi5zaGlmdEtleX0pO2EoYi5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFwiLmpzdHJlZS1ub2RlXCIpLmNoaWxkcmVuKFwiLmpzdHJlZS1hbmNob3JcIikuZmlyc3QoKS50cmlnZ2VyKGMpLmZvY3VzKCl9KS5vbihcImNsaWNrLmpzdHJlZVwiLFwiLmpzdHJlZS1sZWFmID4gLmpzdHJlZS1vY2xcIixhLnByb3h5KGZ1bmN0aW9uKGIpe2Iuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7dmFyIGM9YS5FdmVudChcImNsaWNrXCIse21ldGFLZXk6Yi5tZXRhS2V5LGN0cmxLZXk6Yi5jdHJsS2V5LGFsdEtleTpiLmFsdEtleSxzaGlmdEtleTpiLnNoaWZ0S2V5fSk7YShiLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXCIuanN0cmVlLW5vZGVcIikuY2hpbGRyZW4oXCIuanN0cmVlLWFuY2hvclwiKS5maXJzdCgpLnRyaWdnZXIoYykuZm9jdXMoKX0sdGhpcykpLm9uKFwibW91c2VvdmVyLmpzdHJlZVwiLFwiLmpzdHJlZS13aG9sZXJvdywgLmpzdHJlZS1pY29uXCIsYS5wcm94eShmdW5jdGlvbihhKXtyZXR1cm4gYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSx0aGlzLmlzX2Rpc2FibGVkKGEuY3VycmVudFRhcmdldCl8fHRoaXMuaG92ZXJfbm9kZShhLmN1cnJlbnRUYXJnZXQpLCExfSx0aGlzKSkub24oXCJtb3VzZWxlYXZlLmpzdHJlZVwiLFwiLmpzdHJlZS1ub2RlXCIsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLmRlaG92ZXJfbm9kZShhLmN1cnJlbnRUYXJnZXQpfSx0aGlzKSl9LHRoaXMudGVhcmRvd249ZnVuY3Rpb24oKXt0aGlzLnNldHRpbmdzLndob2xlcm93JiZ0aGlzLmVsZW1lbnQuZmluZChcIi5qc3RyZWUtd2hvbGVyb3dcIikucmVtb3ZlKCksYy50ZWFyZG93bi5jYWxsKHRoaXMpfSx0aGlzLnJlZHJhd19ub2RlPWZ1bmN0aW9uKGIsZCxlLGYpe2lmKGI9Yy5yZWRyYXdfbm9kZS5hcHBseSh0aGlzLGFyZ3VtZW50cykpe3ZhciBnPXEuY2xvbmVOb2RlKCEwKTstMSE9PWEuaW5BcnJheShiLmlkLHRoaXMuX2RhdGEuY29yZS5zZWxlY3RlZCkmJihnLmNsYXNzTmFtZSs9XCIganN0cmVlLXdob2xlcm93LWNsaWNrZWRcIiksdGhpcy5fZGF0YS5jb3JlLmZvY3VzZWQmJnRoaXMuX2RhdGEuY29yZS5mb2N1c2VkPT09Yi5pZCYmKGcuY2xhc3NOYW1lKz1cIiBqc3RyZWUtd2hvbGVyb3ctaG92ZXJlZFwiKSxiLmluc2VydEJlZm9yZShnLGIuY2hpbGROb2Rlc1swXSl9cmV0dXJuIGJ9fSxpLnJlZ2lzdGVyRWxlbWVudCYmT2JqZWN0JiZPYmplY3QuY3JlYXRlKXt2YXIgcj1PYmplY3QuY3JlYXRlKEhUTUxFbGVtZW50LnByb3RvdHlwZSk7ci5jcmVhdGVkQ2FsbGJhY2s9ZnVuY3Rpb24oKXt2YXIgYj17Y29yZTp7fSxwbHVnaW5zOltdfSxjO2ZvcihjIGluIGEuanN0cmVlLnBsdWdpbnMpYS5qc3RyZWUucGx1Z2lucy5oYXNPd25Qcm9wZXJ0eShjKSYmdGhpcy5hdHRyaWJ1dGVzW2NdJiYoYi5wbHVnaW5zLnB1c2goYyksdGhpcy5nZXRBdHRyaWJ1dGUoYykmJkpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoYykpJiYoYltjXT1KU09OLnBhcnNlKHRoaXMuZ2V0QXR0cmlidXRlKGMpKSkpO2ZvcihjIGluIGEuanN0cmVlLmRlZmF1bHRzLmNvcmUpYS5qc3RyZWUuZGVmYXVsdHMuY29yZS5oYXNPd25Qcm9wZXJ0eShjKSYmdGhpcy5hdHRyaWJ1dGVzW2NdJiYoYi5jb3JlW2NdPUpTT04ucGFyc2UodGhpcy5nZXRBdHRyaWJ1dGUoYykpfHx0aGlzLmdldEF0dHJpYnV0ZShjKSk7YSh0aGlzKS5qc3RyZWUoYil9O3RyeXtpLnJlZ2lzdGVyRWxlbWVudChcInZha2F0YS1qc3RyZWVcIix7cHJvdG90eXBlOnJ9KX1jYXRjaChzKXt9fX19KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY21zL3N0YXRpYy9jbXMvanMvbGlicy9qc3RyZWUvanN0cmVlLm1pbi5qc1xuLy8gbW9kdWxlIGlkID0gODZcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ })

},[111]);
>>>>>>> 88e39eb... lodash, refactoring
=======
cmsWebpackJsonp([1],{120:function(e,t,i){var r=i(0);i(92),i(126);var s=i(4),n=i(1).default.API.Helpers,a=i(1).default.KEYS,o=i(130),d=i(131),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){r(i.element).parent().removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);if(i.parent().hasClass("active"))return!1;e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar");_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},200),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"!==e.id&&"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},126:function(e,t,i){var r,s,n;!function(a){s=[i(0),i(92)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e){var t,i,r,s,n=/^\s*$/g,a=function(e){return(e||"").replace(/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,"\\$&")},o=!1,d=function(e,t){return e.find("div[data-jstreegrid='"+t+"']")},l=!1,c=null,h=0,_=0;r=/<\/?[^>]+>/gi,i=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||24,n.detach(),r.remove(),i._gridSettings.indent=a),a},s=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:s(e,r[r.length-1])},t=function(e,t,i){var s,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];s="",a.title&&("_DATA_"===a.title?s=i.get_text(t):t.attr(a.title)&&(s=t.attr(a.title))),(s=s.replace(r,""))&&n.attr("title",s)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,u){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},d=a.columns,l=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){l=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=l,this.rootid=s.attr("id");if(/msie/.test(navigator.userAgent.toLowerCase())){parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<d.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+l+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){u.init.call(this,e,t),this._initialize()},this.bind=function(){u.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)d(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&d(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,d(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)d(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&d(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),u.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?d(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,u=this._gridSettings,g=u.columns||[],f=u.columnWidth,p=u.resizable||!1,m=u.isThemeroller,v=m?"themeroller":"regular",j=!1,y=this.gridparent,k=u.defaultConf,x=0,b=0;for(this.parent=y,t=0;t<g.length;t++)s=g[t].headerClass||"",n=g[t].columnClass||"",a=g[t].header||"",a&&(j=!0),r=g[t].width||f,x=m?7:10,"auto"!==r&&"string"!=typeof r&&(r-=x),o=0===t?3:0,i=this.midWrapper.children("div.jstree-grid-column-"+t),d=e("<div></div>").css(k).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(m?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+v+" "+s+" "+n).html(a),d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+v),d.prependTo(i),b+=d.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+v+(m?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),i.width(r),i.css("min-width",r),i.css("max-width",r);d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+v),void 0===g[g.length-1].width&&(b-=r,i.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?u.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&p&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(l){for(o=c.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=c.parent().children("div.jstree-grid-column"),s=[],isNaN(0)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),l=!1,c=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:0===t},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(l){_=e.pageX;var t,i,r,s=_-h;0!==s&&(t=c.width(),i=parseFloat(c.css("width")),i||(i=c.innerWidth()),s=s<0?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(c.width(r),c.css("min-width",r),c.css("max-width",r),h=_))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return l=!0,h=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=i<0?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,r){return e=u.redraw_node.call(this,e,t,i,r),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),u.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)d(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,o=e(),d=t.children||[];for(n=0;n<d.length;n++)s="jsgrid_"+a(d[n])+"_col"+i,r[s]&&t.state.opened&&(o=o.add(r[s]).add(this.getHoldingCells(this.get_node(d[n]),i,r)));return o},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(i){var o,l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L=this._gridSettings,H=L.treeClass,z=this,M=L.columns||[],W=L.isThemeroller,K=this.element,q=this.rootid,$=W?"themeroller":"regular",F=this.get_node(i),U=L.columnWidth,Y=L.defaultConf,X=this.midWrapper,J=F.id,B=this.get_node(F.parent).children,V=e.inArray(J,B),R=this.holdingCells,G=!1;if(o=e(i),p=o.children("a"),1===p.length){for(!F.state.opened,b="jsgrid_"+a(J)+"_col",w="#"===F.parent?null:F.parent,p.addClass(H),t(p,o,z),m=p,h=0;h<M.length;h++)this.treecol!==h&&(E=M[h],D=X.children("div:eq("+h+")"),u=E.cellClass||"",g=E.wideCellClass||"",f=E.columnClass||"",D.addClass(f),_=void 0!==E.value&&null!==E.value?"function"==typeof E.value?E.value(F):null!==F.data&&void 0!==F.data&&void 0!==F.data[E.value]?F.data[E.value]:"":"","function"==typeof E.format&&(_=E.format(_)),E.images?(c=E.images[_]||E.images.default)&&(I="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">'):I=_,(void 0===I||null===I||n.test(I))&&(I="&nbsp;"),v=E.valueClass&&null!==F.data&&void 0!==F.data?F.data[E.valueClass]||"":"",v&&E.valueClassPrefix&&""!==E.valueClassPrefix&&(v=E.valueClassPrefix+v),j=E.wideValueClass&&null!==F.data&&void 0!==F.data?F.data[E.wideValueClass]||"":"",j&&E.wideValueClassPrefix&&""!==E.wideValueClassPrefix&&(j=E.wideValueClassPrefix+j),x=E.title&&null!==F.data&&void 0!==F.data?F.data[E.title]||"":"",x=x.replace(r,""),k=7,l=E.width||U,"auto"!==l&&(l-=k),m=D.children("div#"+b+h),(!m||m.length<1)&&(m=e("<div></div>"),e("<span></span>").appendTo(m),m.attr("id",b+h),m.addClass(b),m.attr("data-jstreegrid",J)),T=V<=0?F.parent:s(this,B[V-1]),S=d(D,T),A=V>=B.length-1?"NULL":B[V+1],N=d(D,A),P=F.children&&F.children.length>0?F.children[0]:"NULL",O=d(D,P),C=d(D,w),w?(C&&C.length>0?(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.insertAfter(C),G=!0):G=!1,R[b+h]=m):(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.appendTo(D),G=!0),G&&m.after(this.getHoldingCells(F,h,R)),y=m.children("span"),y.addClass(u+" "+v).html(I),m=m.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+q+" jstree-grid-cell-"+$+" "+g+" "+j+(W?" ui-state-default":"")).addClass("jstree-grid-col-"+h),m.click(function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}}(K,o,_,E)),m.on("contextmenu",function(t,i,r,s,n){return function(t){L.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);z._edit(r,s,t.target)}}}))}}(0,o,0,E,this)),m.hover(function(e,t){return function(){t.hover_node(e)}}(o,this),function(e,t){return function(){t.dehover_node(e)}}(o,this)),x&&y.attr("title",x));m.addClass("jstree-grid-cell-last"+(W?" ui-state-default":"")),void 0===M[M.length-1].width&&m.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},129:function(e,t,i){i(18),i(19);var r=i(1).default;window.CMS=r,r.PageTree=i(120).default},130:function(e,t,i){var r=i(0),s=i(4),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);if(i.hasClass(this.options.openCls))return t.removeClass(this.options.openCls),!1;t.removeClass(this.options.openCls),i.addClass(this.options.openCls),this._loadContent(i)},_loadContent:function(e){var t=e.data();if(!t.lazyUrl||t.loaded)return!1;var i=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},200);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(i)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},131:function(e,t,i){var r=i(0),s=i(4),n=i(1).default.API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a},92:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(0)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||!0===i)&&(n=a||!1),(null===n||n===t)&&void 0}),null!==n&&n!==t?n:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,r){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){!1===r?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(s=this._parse_model_from_html(e(i),d,_.parents.concat()))&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do{l="j"+_+"_"+ ++u}while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&void 0!==window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=!d.hasClass("jstree-themeicon-hidden")&&d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)(t=this.redraw_node(s[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):!!r&&r.call(this,e,!1)}):(r&&r.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),!0===e.state.hidden},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))))},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,s,n)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return!!(m=this.copy_node(i,r,s,n,a,!1,d))&&(g&&g.delete_node(i),m);switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,m.id,m.parents.concat())))return!1;for(_=this.get_node(f),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1))},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=i.icon,i.icon=!0===r||null===r||r===t||""===r||r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===r?this.hide_icon(i):!0===r||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),!1===o&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),!1===o&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),!1===o&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)(n=o[a.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[r],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(s=0,n=a.children_d.length;n>s;s++)this._model.data[a.children_d[s]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0))&&(n+=s),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"))&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})))){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),!0===g))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}));p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0))&&d.settings.core.error.call(this,r);s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==s&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),(d=this.get_node(t[a],!0))&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)(d=this.get_node(t[a],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)(d=this.get_node(t[l],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(!1===i||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=!!c.ajax&&c.ajax,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&!0===this.open_node(f[d],null,0)&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=r.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),!1!==r.fuzzy&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),-1!==(y=e.lastIndexOf(t,d+h))&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],p[o]=0===i?(p[o+1]<<1|1)&m:(p[o+1]<<1|1)&m|(u[o+1]|u[o])<<1|1|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},!0===i?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types.default)s.types.default.hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types.default[a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,!0===o[d[s]].icon&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr.class=l[c].li_attr.class+" "+o[d[s]].li_attr.class)}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr.class=l[c].a_attr.class+" "+o[d[s]].a_attr.class)}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(!1===l)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(!1===r.check.call(this,i,s,n,a,o))return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(!0===d||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon===t||s[r].icon),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr.class=s[r].li_attr[l]+" "+_[i.id].li_attr.class,c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr.class=s[r].a_attr.class+" "+_[i.id].a_attr.class,h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(!1===r.check.call(this,t,i,s,n,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}})}},[129]);
>>>>>>> 73f3d4a... performance improvement
=======
cmsWebpackJsonp([1],{121:function(e,t,i){var r=i(0);i(93),i(126);var s=i(4),n=i(1).default.API.Helpers,a=i(1).default.KEYS,o=i(130),d=i(131),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){r(i.element).parent().removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);if(i.parent().hasClass("active"))return!1;e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar");_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},200),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"!==e.id&&"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},126:function(e,t,i){var r,s,n;!function(a){s=[i(0),i(93)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e){var t,i,r,s,n=/^\s*$/g,a=function(e){return(e||"").replace(/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,"\\$&")},o=!1,d=function(e,t){return e.find("div[data-jstreegrid='"+t+"']")},l=!1,c=null,h=0,_=0;r=/<\/?[^>]+>/gi,i=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||24,n.detach(),r.remove(),i._gridSettings.indent=a),a},s=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:s(e,r[r.length-1])},t=function(e,t,i){var s,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];s="",a.title&&("_DATA_"===a.title?s=i.get_text(t):t.attr(a.title)&&(s=t.attr(a.title))),(s=s.replace(r,""))&&n.attr("title",s)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,u){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},d=a.columns,l=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){l=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=l,this.rootid=s.attr("id");if(/msie/.test(navigator.userAgent.toLowerCase())){parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<d.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+l+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){u.init.call(this,e,t),this._initialize()},this.bind=function(){u.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)d(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&d(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,d(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)d(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&d(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),u.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?d(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,u=this._gridSettings,g=u.columns||[],f=u.columnWidth,p=u.resizable||!1,m=u.isThemeroller,v=m?"themeroller":"regular",j=!1,y=this.gridparent,k=u.defaultConf,x=0,b=0;for(this.parent=y,t=0;t<g.length;t++)s=g[t].headerClass||"",n=g[t].columnClass||"",a=g[t].header||"",a&&(j=!0),r=g[t].width||f,x=m?7:10,"auto"!==r&&"string"!=typeof r&&(r-=x),o=0===t?3:0,i=this.midWrapper.children("div.jstree-grid-column-"+t),d=e("<div></div>").css(k).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(m?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+v+" "+s+" "+n).html(a),d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+v),d.prependTo(i),b+=d.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+v+(m?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),i.width(r),i.css("min-width",r),i.css("max-width",r);d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+v),void 0===g[g.length-1].width&&(b-=r,i.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?u.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&p&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(l){for(o=c.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=c.parent().children("div.jstree-grid-column"),s=[],isNaN(0)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),l=!1,c=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:0===t},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(l){_=e.pageX;var t,i,r,s=_-h;0!==s&&(t=c.width(),i=parseFloat(c.css("width")),i||(i=c.innerWidth()),s=s<0?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(c.width(r),c.css("min-width",r),c.css("max-width",r),h=_))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return l=!0,h=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=i<0?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,r){return e=u.redraw_node.call(this,e,t,i,r),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),u.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)d(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,o=e(),d=t.children||[];for(n=0;n<d.length;n++)s="jsgrid_"+a(d[n])+"_col"+i,r[s]&&t.state.opened&&(o=o.add(r[s]).add(this.getHoldingCells(this.get_node(d[n]),i,r)));return o},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(i){var o,l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L=this._gridSettings,H=L.treeClass,z=this,M=L.columns||[],W=L.isThemeroller,K=this.element,q=this.rootid,$=W?"themeroller":"regular",F=this.get_node(i),U=L.columnWidth,Y=L.defaultConf,X=this.midWrapper,J=F.id,B=this.get_node(F.parent).children,V=e.inArray(J,B),R=this.holdingCells,G=!1;if(o=e(i),p=o.children("a"),1===p.length){for(!F.state.opened,b="jsgrid_"+a(J)+"_col",w="#"===F.parent?null:F.parent,p.addClass(H),t(p,o,z),m=p,h=0;h<M.length;h++)this.treecol!==h&&(E=M[h],D=X.children("div:eq("+h+")"),u=E.cellClass||"",g=E.wideCellClass||"",f=E.columnClass||"",D.addClass(f),_=void 0!==E.value&&null!==E.value?"function"==typeof E.value?E.value(F):null!==F.data&&void 0!==F.data&&void 0!==F.data[E.value]?F.data[E.value]:"":"","function"==typeof E.format&&(_=E.format(_)),E.images?(c=E.images[_]||E.images.default)&&(I="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">'):I=_,(void 0===I||null===I||n.test(I))&&(I="&nbsp;"),v=E.valueClass&&null!==F.data&&void 0!==F.data?F.data[E.valueClass]||"":"",v&&E.valueClassPrefix&&""!==E.valueClassPrefix&&(v=E.valueClassPrefix+v),j=E.wideValueClass&&null!==F.data&&void 0!==F.data?F.data[E.wideValueClass]||"":"",j&&E.wideValueClassPrefix&&""!==E.wideValueClassPrefix&&(j=E.wideValueClassPrefix+j),x=E.title&&null!==F.data&&void 0!==F.data?F.data[E.title]||"":"",x=x.replace(r,""),k=7,l=E.width||U,"auto"!==l&&(l-=k),m=D.children("div#"+b+h),(!m||m.length<1)&&(m=e("<div></div>"),e("<span></span>").appendTo(m),m.attr("id",b+h),m.addClass(b),m.attr("data-jstreegrid",J)),T=V<=0?F.parent:s(this,B[V-1]),S=d(D,T),A=V>=B.length-1?"NULL":B[V+1],N=d(D,A),P=F.children&&F.children.length>0?F.children[0]:"NULL",O=d(D,P),C=d(D,w),w?(C&&C.length>0?(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.insertAfter(C),G=!0):G=!1,R[b+h]=m):(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.appendTo(D),G=!0),G&&m.after(this.getHoldingCells(F,h,R)),y=m.children("span"),y.addClass(u+" "+v).html(I),m=m.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+q+" jstree-grid-cell-"+$+" "+g+" "+j+(W?" ui-state-default":"")).addClass("jstree-grid-col-"+h),m.click(function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}}(K,o,_,E)),m.on("contextmenu",function(t,i,r,s,n){return function(t){L.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);z._edit(r,s,t.target)}}}))}}(0,o,0,E,this)),m.hover(function(e,t){return function(){t.hover_node(e)}}(o,this),function(e,t){return function(){t.dehover_node(e)}}(o,this)),x&&y.attr("title",x));m.addClass("jstree-grid-cell-last"+(W?" ui-state-default":"")),void 0===M[M.length-1].width&&m.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},129:function(e,t,i){i(18),i(19);var r=i(1).default;window.CMS=r,r.PageTree=i(121).default},130:function(e,t,i){var r=i(0),s=i(4),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);if(i.hasClass(this.options.openCls))return t.removeClass(this.options.openCls),!1;t.removeClass(this.options.openCls),i.addClass(this.options.openCls),this._loadContent(i)},_loadContent:function(e){var t=e.data();if(!t.lazyUrl||t.loaded)return!1;var i=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},200);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(i)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},131:function(e,t,i){var r=i(0),s=i(4),n=i(1).default.API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a},93:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(0)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||!0===i)&&(n=a||!1),(null===n||n===t)&&void 0}),null!==n&&n!==t?n:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,r){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){!1===r?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(s=this._parse_model_from_html(e(i),d,_.parents.concat()))&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do{l="j"+_+"_"+ ++u}while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&void 0!==window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=!d.hasClass("jstree-themeicon-hidden")&&d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)(t=this.redraw_node(s[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):!!r&&r.call(this,e,!1)}):(r&&r.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),!0===e.state.hidden},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))))},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,s,n)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return!!(m=this.copy_node(i,r,s,n,a,!1,d))&&(g&&g.delete_node(i),m);switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,m.id,m.parents.concat())))return!1;for(_=this.get_node(f),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1))},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=i.icon,i.icon=!0===r||null===r||r===t||""===r||r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===r?this.hide_icon(i):!0===r||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),!1===o&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),!1===o&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),!1===o&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)(n=o[a.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[r],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(s=0,n=a.children_d.length;n>s;s++)this._model.data[a.children_d[s]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0))&&(n+=s),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"))&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})))){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),!0===g))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}));p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0))&&d.settings.core.error.call(this,r);s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==s&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),(d=this.get_node(t[a],!0))&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)(d=this.get_node(t[a],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)(d=this.get_node(t[l],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(!1===i||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=!!c.ajax&&c.ajax,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&!0===this.open_node(f[d],null,0)&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=r.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),!1!==r.fuzzy&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),-1!==(y=e.lastIndexOf(t,d+h))&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],p[o]=0===i?(p[o+1]<<1|1)&m:(p[o+1]<<1|1)&m|(u[o+1]|u[o])<<1|1|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},!0===i?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types.default)s.types.default.hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types.default[a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,!0===o[d[s]].icon&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr.class=l[c].li_attr.class+" "+o[d[s]].li_attr.class)}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr.class=l[c].a_attr.class+" "+o[d[s]].a_attr.class)}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(!1===l)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(!1===r.check.call(this,i,s,n,a,o))return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(!0===d||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon===t||s[r].icon),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr.class=s[r].li_attr[l]+" "+_[i.id].li_attr.class,c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr.class=s[r].a_attr.class+" "+_[i.id].a_attr.class,h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(!1===r.check.call(this,t,i,s,n,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}})}},[129]);
>>>>>>> 8eebd81... handle ckeditor plugin
=======
cmsWebpackJsonp([1],{122:function(e,t,i){var r=i(0);i(93),i(127);var s=i(4),n=i(1).default.API.Helpers,a=i(1).default.KEYS,o=i(131),d=i(132),l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){r(i.element).parent().removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);if(i.parent().hasClass("active"))return!1;e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar");_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},200),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"!==e.id&&"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),e.exports=l},127:function(e,t,i){var r,s,n;!function(a){s=[i(0),i(93)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e){var t,i,r,s,n=/^\s*$/g,a=function(e){return(e||"").replace(/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,"\\$&")},o=!1,d=function(e,t){return e.find("div[data-jstreegrid='"+t+"']")},l=!1,c=null,h=0,_=0;r=/<\/?[^>]+>/gi,i=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||24,n.detach(),r.remove(),i._gridSettings.indent=a),a},s=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:s(e,r[r.length-1])},t=function(e,t,i){var s,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];s="",a.title&&("_DATA_"===a.title?s=i.get_text(t):t.attr(a.title)&&(s=t.attr(a.title))),(s=s.replace(r,""))&&n.attr("title",s)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,u){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},d=a.columns,l=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){l=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=l,this.rootid=s.attr("id");if(/msie/.test(navigator.userAgent.toLowerCase())){parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<d.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+l+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){u.init.call(this,e,t),this._initialize()},this.bind=function(){u.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)d(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&d(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,d(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)d(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&d(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),u.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?d(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,u=this._gridSettings,g=u.columns||[],f=u.columnWidth,p=u.resizable||!1,m=u.isThemeroller,v=m?"themeroller":"regular",j=!1,y=this.gridparent,k=u.defaultConf,x=0,b=0;for(this.parent=y,t=0;t<g.length;t++)s=g[t].headerClass||"",n=g[t].columnClass||"",a=g[t].header||"",a&&(j=!0),r=g[t].width||f,x=m?7:10,"auto"!==r&&"string"!=typeof r&&(r-=x),o=0===t?3:0,i=this.midWrapper.children("div.jstree-grid-column-"+t),d=e("<div></div>").css(k).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(m?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+v+" "+s+" "+n).html(a),d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+v),d.prependTo(i),b+=d.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+v+(m?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),i.width(r),i.css("min-width",r),i.css("max-width",r);d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+v),void 0===g[g.length-1].width&&(b-=r,i.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?u.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&p&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(l){for(o=c.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=c.parent().children("div.jstree-grid-column"),s=[],isNaN(0)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),l=!1,c=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:0===t},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(l){_=e.pageX;var t,i,r,s=_-h;0!==s&&(t=c.width(),i=parseFloat(c.css("width")),i||(i=c.innerWidth()),s=s<0?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(c.width(r),c.css("min-width",r),c.css("max-width",r),h=_))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return l=!0,h=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=i<0?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,r){return e=u.redraw_node.call(this,e,t,i,r),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),u.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)d(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,o=e(),d=t.children||[];for(n=0;n<d.length;n++)s="jsgrid_"+a(d[n])+"_col"+i,r[s]&&t.state.opened&&(o=o.add(r[s]).add(this.getHoldingCells(this.get_node(d[n]),i,r)));return o},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(i){var o,l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L=this._gridSettings,H=L.treeClass,z=this,M=L.columns||[],W=L.isThemeroller,K=this.element,q=this.rootid,$=W?"themeroller":"regular",F=this.get_node(i),U=L.columnWidth,Y=L.defaultConf,X=this.midWrapper,J=F.id,B=this.get_node(F.parent).children,V=e.inArray(J,B),R=this.holdingCells,G=!1;if(o=e(i),p=o.children("a"),1===p.length){for(!F.state.opened,b="jsgrid_"+a(J)+"_col",w="#"===F.parent?null:F.parent,p.addClass(H),t(p,o,z),m=p,h=0;h<M.length;h++)this.treecol!==h&&(E=M[h],D=X.children("div:eq("+h+")"),u=E.cellClass||"",g=E.wideCellClass||"",f=E.columnClass||"",D.addClass(f),_=void 0!==E.value&&null!==E.value?"function"==typeof E.value?E.value(F):null!==F.data&&void 0!==F.data&&void 0!==F.data[E.value]?F.data[E.value]:"":"","function"==typeof E.format&&(_=E.format(_)),E.images?(c=E.images[_]||E.images.default)&&(I="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">'):I=_,(void 0===I||null===I||n.test(I))&&(I="&nbsp;"),v=E.valueClass&&null!==F.data&&void 0!==F.data?F.data[E.valueClass]||"":"",v&&E.valueClassPrefix&&""!==E.valueClassPrefix&&(v=E.valueClassPrefix+v),j=E.wideValueClass&&null!==F.data&&void 0!==F.data?F.data[E.wideValueClass]||"":"",j&&E.wideValueClassPrefix&&""!==E.wideValueClassPrefix&&(j=E.wideValueClassPrefix+j),x=E.title&&null!==F.data&&void 0!==F.data?F.data[E.title]||"":"",x=x.replace(r,""),k=7,l=E.width||U,"auto"!==l&&(l-=k),m=D.children("div#"+b+h),(!m||m.length<1)&&(m=e("<div></div>"),e("<span></span>").appendTo(m),m.attr("id",b+h),m.addClass(b),m.attr("data-jstreegrid",J)),T=V<=0?F.parent:s(this,B[V-1]),S=d(D,T),A=V>=B.length-1?"NULL":B[V+1],N=d(D,A),P=F.children&&F.children.length>0?F.children[0]:"NULL",O=d(D,P),C=d(D,w),w?(C&&C.length>0?(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.insertAfter(C),G=!0):G=!1,R[b+h]=m):(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.appendTo(D),G=!0),G&&m.after(this.getHoldingCells(F,h,R)),y=m.children("span"),y.addClass(u+" "+v).html(I),m=m.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+q+" jstree-grid-cell-"+$+" "+g+" "+j+(W?" ui-state-default":"")).addClass("jstree-grid-col-"+h),m.click(function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}}(K,o,_,E)),m.on("contextmenu",function(t,i,r,s,n){return function(t){L.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);z._edit(r,s,t.target)}}}))}}(0,o,0,E,this)),m.hover(function(e,t){return function(){t.hover_node(e)}}(o,this),function(e,t){return function(){t.dehover_node(e)}}(o,this)),x&&y.attr("title",x));m.addClass("jstree-grid-cell-last"+(W?" ui-state-default":"")),void 0===M[M.length-1].width&&m.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},130:function(e,t,i){i(18),i(19);var r=i(1).default;window.CMS=r,r.PageTree=i(122).default},131:function(e,t,i){var r=i(0),s=i(4),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);if(i.hasClass(this.options.openCls))return t.removeClass(this.options.openCls),!1;t.removeClass(this.options.openCls),i.addClass(this.options.openCls),this._loadContent(i)},_loadContent:function(e){var t=e.data();if(!t.lazyUrl||t.loaded)return!1;var i=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},200);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(i)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});e.exports=n},132:function(e,t,i){var r=i(0),s=i(4),n=i(1).default.API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});e.exports=a},93:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(0)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||!0===i)&&(n=a||!1),(null===n||n===t)&&void 0}),null!==n&&n!==t?n:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,r){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){!1===r?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(s=this._parse_model_from_html(e(i),d,_.parents.concat()))&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do{l="j"+_+"_"+ ++u}while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&void 0!==window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=!d.hasClass("jstree-themeicon-hidden")&&d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)(t=this.redraw_node(s[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):!!r&&r.call(this,e,!1)}):(r&&r.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),!0===e.state.hidden},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))))},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,s,n)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return!!(m=this.copy_node(i,r,s,n,a,!1,d))&&(g&&g.delete_node(i),m);switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,m.id,m.parents.concat())))return!1;for(_=this.get_node(f),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1))},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=i.icon,i.icon=!0===r||null===r||r===t||""===r||r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===r?this.hide_icon(i):!0===r||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),!1===o&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),!1===o&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),!1===o&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)(n=o[a.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[r],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(s=0,n=a.children_d.length;n>s;s++)this._model.data[a.children_d[s]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0))&&(n+=s),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"))&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})))){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),!0===g))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}));p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0))&&d.settings.core.error.call(this,r);s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==s&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),(d=this.get_node(t[a],!0))&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)(d=this.get_node(t[a],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)(d=this.get_node(t[l],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(!1===i||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=!!c.ajax&&c.ajax,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&!0===this.open_node(f[d],null,0)&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=r.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),!1!==r.fuzzy&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),-1!==(y=e.lastIndexOf(t,d+h))&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],p[o]=0===i?(p[o+1]<<1|1)&m:(p[o+1]<<1|1)&m|(u[o+1]|u[o])<<1|1|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},!0===i?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types.default)s.types.default.hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types.default[a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,!0===o[d[s]].icon&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr.class=l[c].li_attr.class+" "+o[d[s]].li_attr.class)}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr.class=l[c].a_attr.class+" "+o[d[s]].a_attr.class)}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(!1===l)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(!1===r.check.call(this,i,s,n,a,o))return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(!0===d||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon===t||s[r].icon),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr.class=s[r].li_attr[l]+" "+_[i.id].li_attr.class,c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr.class=s[r].a_attr.class+" "+_[i.id].a_attr.class,h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(!1===r.check.call(this,t,i,s,n,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}})}},[130]);
>>>>>>> 8ceba59... reload the toolbar itself
=======
cmsWebpackJsonp([1],{122:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0);i(93),i(127);var s=i(4),n=i(1).default.API.Helpers,a=i(1).default.KEYS,o=i(131).default,d=i(132).default,l=new s({options:{pasteSelector:".js-cms-tree-item-paste"},initialize:function(e){var t=r(".js-cms-pagetree").data("json");this.options=r.extend(!0,{},this.options,t,e),this.click="click.cms.pagetree",this.clipboard={id:null,origin:null,type:""},this.successTimer=1e3,this._setupUI(),this._events(),r.isEmptyObject(t)||this._setup()},_setupUI:function(){var e=r(".cms-pagetree");this.ui={container:e,document:r(document),tree:e.find(".js-cms-pagetree"),dialog:r(".js-cms-tree-dialog"),siteForm:r(".js-cms-pagetree-site-form")}},_setup:function(){var e=this,t=[],i={language:this.options.lang.code,openNodes:[]},s=!1;n.csrf(this.options.csrf),r.each(this.options.columns,function(e,i){""===i.key?t.push({header:i.title,width:i.width||"1%",wideCellClass:i.cls}):t.push({header:i.title,value:function(e){return e.data?e.data["col"+i.key.replace("-","")]:""},width:i.width||"1%",wideCellClass:i.cls})}),this.options.filtered||(s={url:this.options.urls.tree,cache:!1,data:function(t){return"#"===t.id?i.pageId=null:i.pageId=e._storeNodeId(t.data.id),i.openNodes=e._getStoredNodeIds(),i.site=e.options.site,i}}),this.ui.tree.jstree({core:{animation:0,check_callback:function(t,i,s,n,a){return("move_node"===t||"copy_node"===t)&&a&&a.pos&&("i"===a.pos?r("#jstree-marker").addClass("jstree-marker-child"):r("#jstree-marker").removeClass("jstree-marker-child")),e._hasPermission(s,"add")},data:s,strings:{"Loading ...":this.options.lang.loading,"New node":this.options.lang.newNode,nodes:this.options.lang.nodes},error:function(t){var i=JSON.parse(t.data);"check"===t.error&&i&&"move_node"===i.chk||e.showError(t.reason)},themes:{name:"django-cms"},multiple:!1},plugins:["dnd","search","grid"],dnd:{inside_pos:"last",drag_selection:!1,is_draggable:function(t){return e._hasPermission(t[0],"move")&&!e.options.filtered},large_drop_target:!0,copy:!0},grid:{width:"100%",columns:t}})},_events:function(){var e=this;this.ui.tree.on("after_close.jstree",function(t,i){e._removeNodeId(i.node.data.id)}),this.ui.tree.on("after_open.jstree",function(t,i){e._storeNodeId(i.node.data.id),this.clipboard&&!this.clipboard.isPasting&&e._updatePasteHelpersState()}),this.ui.document.on("keydown.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.addClass("cms-pagetree-alt-mode")}),this.ui.document.on("keyup.pagetree.alt-mode",function(t){t.keyCode===a.SHIFT&&e.ui.container.removeClass("cms-pagetree-alt-mode")}),this.ui.document.on("dnd_start.vakata",function(t,i){var s=r(i.element),n=s.parent();e._dropdowns.closeAllDropdowns(),n.addClass("jstree-is-dragging"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").addClass("jstree-is-dragging")})}),n.hasClass("jstree-leaf")||i.helper.addClass("is-stacked")});var t=!1;this.ui.document.on("dnd_move.vakata",function(e,i){i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(i.event.metaKey||i.event.ctrlKey))?t||(r(".jstree-is-dragging").addClass("jstree-is-dragging-copy"),t=!0):t&&(r(".jstree-is-dragging").removeClass("jstree-is-dragging-copy"),t=!1)}),this.ui.document.on("dnd_stop.vakata",function(t,i){r(i.element).parent().removeClass("jstree-is-dragging jstree-is-dragging-copy"),i.data.nodes.forEach(function(t){[t].concat(e._getDescendantsIds(t)).forEach(function(e){r(".jsgrid_"+e+"_col").removeClass("jstree-is-dragging jstree-is-dragging-copy")})})}),this.ui.tree.on("move_node.jstree copy_node.jstree",function(t,i){!e.clipboard.type&&"copy_node"!==t.type||"cut"===e.clipboard.type?e._moveNode(e._getNodePosition(i)).done(function(){var t=e.ui.tree.jstree(!0);t._hide_grid(t.get_node(i.parent)),"#"===i.parent?t.refresh():t.refresh_node(i.parent)}):e._copyNode(i),e.ui.tree.jstree("open_node",i.parent)}),this.ui.container.on(this.click,".js-cms-tree-item-cut",function(t){t.preventDefault(),e._cutOrCopy({type:"cut",element:r(this)})}),this.ui.container.on(this.click,".js-cms-tree-item-copy",function(t){t.preventDefault(),e._cutOrCopy({type:"copy",element:r(this)})}),this.ui.container.on(this.click,this.options.pasteSelector,function(t){t.preventDefault(),r(this).hasClass("cms-pagetree-dropdown-item-disabled")||e._paste(t)}),this.ui.container.on(this.click,".js-cms-tree-advanced-settings",function(e){if(e.shiftKey){e.preventDefault();var t=r(this);t.data("url")&&(window.location.href=t.data("url"))}}),this.ui.document.on(this.click,".messagelist .cms-tree-reload",function(t){t.preventDefault(),e._reloadHelper()}),this.ui.container.find(".js-cms-pagetree-site-trigger").on(this.click,function(t){t.preventDefault();var i=r(this);if(i.parent().hasClass("active"))return!1;e.ui.siteForm.find("select").val(i.data().id).end().submit()}),this._setupDropdowns(),this._setupSearch(),this._setAjaxPost(".js-cms-tree-item-menu a"),this._setAjaxPost(".js-cms-tree-lang-trigger"),this._setupPageView(),e._setupStickyHeader()},_cutOrCopy:function(e){if("copy"===e.type&&e.element.data().apphook)return this.showError(this.options.lang.apphook),!1;var t=this._getNodeId(e.element.closest(".jstree-grid-cell"));this.clipboard.type===e.type&&t===this.clipboard.id?(this.clipboard.type=null,this.clipboard.id=null,this.clipboard.origin=null,this._disablePaste()):(this.clipboard.origin=e.element,this.clipboard.type=e.type,this.clipboard.id=t,this._updatePasteHelpersState())},_paste:function(e){this._disablePaste();var t=this._getNodeId(this.clipboard.origin),i=this._getNodeId(r(e.currentTarget));"cut"===this.clipboard.type?this.ui.tree.jstree("cut",t):this.ui.tree.jstree("copy",t),this.clipboard.isPasting=!0,this.ui.tree.jstree("paste",i,"last"),this.clipboard.id=null,this.clipboard.type=null,this.clipboard.origin=null,this.clipboard.isPasting=!1},_getStoredNodeIds:function(){return CMS.settings.pagetree||[]},_storeNodeId:function(e){var t=e,i=this._getStoredNodeIds();return-1===i.indexOf(t)&&i.push(t),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_removeNodeId:function(e){var t=e,i=this._getStoredNodeIds(),r=i.indexOf(t);return-1!==r&&i.splice(r,1),CMS.settings.pagetree=i,n.setSettings(CMS.settings),t},_moveNode:function(e){var t=this;return e.site=t.options.site,r.ajax({method:"post",url:t.options.urls.move.replace("{id}",e.id),data:e}).done(function(){t._showSuccess(e.id)}).fail(function(e){t.showError(e.statusText)})},_copyNode:function(e){var t=this,i=t._getNodePosition(e),s={site:this.options.site,id:e.original.data.id,position:i.position};i.target&&(s.target=i.target),t.options.permission?(r.ajax({method:"post",url:t.options.urls.copyPermission.replace("{id}",s.id),data:s}).done(function(e){t.ui.dialog.append(e)}).fail(function(e){t.showError(e.statusText)}),this.ui.dialog.off(this.click,".cancel").on(this.click,".cancel",function(i){i.preventDefault(),t.ui.tree.jstree("delete_node",e.node.id),r(".js-cms-dialog").remove(),r(".js-cms-dialog-dimmer").remove()}).off(this.click,".submit").on(this.click,".submit",function(e){e.preventDefault();var i=r(this),n=i.closest("form").serialize().split("&");i.prop("disabled",!0);for(var a=0;a<n.length;a++)s[n[a].split("=")[0]]=n[a].split("=")[1];t._saveCopiedNode(s)})):this._saveCopiedNode(s)},_saveCopiedNode:function(e){var t=this;return r.ajax({method:"post",url:t.options.urls.copy.replace("{id}",e.id),data:e}).done(function(){t._reloadHelper()}).fail(function(e){t.showError(e.statusText)})},_getNodeId:function(e){var t=e.closest(".jstree-grid-cell").attr("class");return t?t.replace(/.*jsgrid_(.+?)_col.*/,"$1"):"#"},_getNodePosition:function(e){var t={},i=this.ui.tree.jstree("get_node",e.node.parent);return t.position=e.position,"#"!==e.parent&&(t.target=i.data.id),e.node&&e.node.data&&(t.id=e.node.data.id),t},_setupDropdowns:function(){this._dropdowns=new o({container:this.ui.container})},_setupPageView:function(){var e=n._getWindow(),t=e.parent?e.parent:e;this.ui.container.on(this.click,".js-cms-pagetree-page-view",function(){t.CMS.API.Helpers.setSettings(r.extend(!0,{},CMS.settings,{sideframe:{url:null,hidden:!0}}))})},_setupStickyHeader:function(){var e=this;e.ui.tree.on("ready.jstree",function(){e.header=new d({container:e.ui.container})})},_setAjaxPost:function(e){var t=this;this.ui.container.on(this.click,e,function(e){e.preventDefault(),r.ajax({method:"post",url:r(this).attr("href")}).done(function(){if(window.self===window.top)t._reloadHelper();else{var e=window.parent?window.parent:window,i={model:"cms.page",pk:e.CMS.config.request.page_id};n.reloadBrowser("REFRESH_PAGE",!1,!0,i)}}).fail(function(e){t.showError(e.statusText)})})},_setupSearch:function(){var e=this,t=this.click+".search",i=!1,s=this.ui.container.find(".js-cms-pagetree-header-filter-trigger"),n=this.ui.container.find(".js-cms-pagetree-header-filter-container"),a=n.find(".js-cms-pagetree-header-search-close"),o="cms-pagetree-header-filter-active",d=r(".cms-pagetree-header"),l=this.ui.container.find(".js-cms-pagetree-header-search"),c=this.ui.container.find(".js-cms-pagetree-header-search-copy form"),h=this.ui.container.find(".cms-pagetree-header-filter"),_=h.find("#field-searchbar");_.on("focus",function(e){e.stopImmediatePropagation(),d.addClass(o)}),_.on("blur",function(r){r.stopImmediatePropagation(),setTimeout(function(){i||d.removeClass(o)},200),e.ui.document.off(t)}),s.add(a).on(t,function(r){r.preventDefault(),r.stopImmediatePropagation(),i?(n.hide(),d.removeClass(o),e.ui.document.off(t),i=!1):(n.show(),d.addClass(o),e.ui.document.on(t,function(){i=!0,s.trigger(t)}),i=!0)}),n.on("click",function(e){e.stopImmediatePropagation()}),l.append(c.find('input[type="hidden"]'))},_enablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).removeClass("cms-pagetree-dropdown-item-disabled");var s={};"cut"===this.clipboard.type?s.has_cut=!0:s.has_copy=!0,r(i).data("lazyUrlData",s)},_disablePaste:function(e){var t=void 0===e?this.options.pasteSelector:e+" "+this.options.pasteSelector,i=".js-cms-pagetree-actions-dropdown";void 0!==e&&(i=e+" .js-cms-pagetree-actions-dropdown"),r(t).addClass("cms-pagetree-dropdown-item-disabled"),r(i).removeData("lazyUrlData")},_updatePasteHelpersState:function(){var e=this;if(this.clipboard.type&&this.clipboard.id&&this._enablePaste(),"cut"===this.clipboard.type&&this.clipboard.origin){var t=this._getDescendantsIds(this.clipboard.id),i=[this.clipboard.id];t&&t.length&&(i=i.concat(t)),i.forEach(function(t){e._disablePaste(".jsgrid_"+t+"_col")})}},_showSuccess:function(e){var t=this.ui.tree.find('li[data-id="'+e+'"]');t.addClass("cms-tree-node-success"),setTimeout(function(){t.removeClass("cms-tree-node-success")},this.successTimer),this._disablePaste(),this.clipboard.id=null},_reloadHelper:function(){window.self===window.top?n.reloadBrowser():window.location.reload()},showError:function(e){var t=r(".messagelist"),i=r(".breadcrumbs"),s=this.options.lang.reload,n='<ul class="messagelist">   <li class="error">       {msg}        <a href="#reload" class="cms-tree-reload"> '+s+" </a>   </li></ul>",a=n.replace("{msg}","<strong>"+this.options.lang.error+"</strong> "+e);t.length?t.replaceWith(a):i.after(a)},_getDescendantsIds:function(e){return this.ui.tree.jstree(!0).get_node(e).children_d},_hasPermission:function(e,t){return"#"===e.id&&"add"===t?this.options.hasAddRootPermission:"#"!==e.id&&"true"===e.li_attr["data-"+t+"-permission"]}});r(function(){window.CMS.config={settings:{toolbar:"expanded"},urls:{settings:r(".js-cms-pagetree").data("settings-url")}},window.CMS.settings=n.getSettings(),new l}),t.default=l},127:function(e,t,i){var r,s,n;!function(a){s=[i(0),i(93)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e){var t,i,r,s,n=/^\s*$/g,a=function(e){return(e||"").replace(/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,"\\$&")},o=!1,d=function(e,t){return e.find("div[data-jstreegrid='"+t+"']")},l=!1,c=null,h=0,_=0;r=/<\/?[^>]+>/gi,i=function(t,i){var r,s,n,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),n=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),n.appendTo(r),r.appendTo(e("body")),a=s.width()||24,n.detach(),r.remove(),i._gridSettings.indent=a),a},s=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:s(e,r[r.length-1])},t=function(e,t,i){var s,n="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=i.settings.grid.columns[0];s="",a.title&&("_DATA_"===a.title?s=i.get_text(t):t.attr(a.title)&&(s=t.attr(a.title))),(s=s.replace(r,""))&&n.attr("title",s)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(i,u){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,n=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},d=a.columns,l=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){l=i;break}this.uniq=Math.ceil(1e3*Math.random()),this.treecol=l,this.rootid=s.attr("id");if(/msie/.test(navigator.userAgent.toLowerCase())){parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {width: 100%; overflow-x: auto;}",".jstree-grid-midwrapper {display: table-row; overflow: visible;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(n),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),r.width&&this.gridWrapper.width(r.width),i=0;i<d.length;i++)e("<div></div>").addClass("jstree-grid-column jstree-grid-column-"+i+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+l+")").append(s),s.addClass("jstree-grid-cell"),this._initialized=!0}},this.init=function(e,t){u.init.call(this,e,t),this._initialize()},this.bind=function(){u.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)d(r,s[i]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&d(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=r,d(this.gridWrapper,r).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;d(this.gridWrapper,r).removeClass("jstree-hovered")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)d(this.gridWrapper,s[r]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell:not(:first)").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&d(i,r).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),u.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?d(i,t).remove():i.find("div.jstree-grid-cell:not(:first)").remove()},this._prepare_headers=function(){var t,i,r,s,n,a,o,d,u=this._gridSettings,g=u.columns||[],f=u.columnWidth,p=u.resizable||!1,m=u.isThemeroller,v=m?"themeroller":"regular",j=!1,y=this.gridparent,k=u.defaultConf,x=0,b=0;for(this.parent=y,t=0;t<g.length;t++)s=g[t].headerClass||"",n=g[t].columnClass||"",a=g[t].header||"",a&&(j=!0),r=g[t].width||f,x=m?7:10,"auto"!==r&&"string"!=typeof r&&(r-=x),o=0===t?3:0,i=this.midWrapper.children("div.jstree-grid-column-"+t),d=e("<div></div>").css(k).css({"margin-left":o}).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(m?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+v+" "+s+" "+n).html(a),d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+v),d.prependTo(i),b+=d.outerWidth(),e("<div class='jstree-grid-separator jstree-grid-separator-"+v+(m?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(d),i.width(r),i.css("min-width",r),i.css("max-width",r);d.addClass((m?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+v),void 0===g[g.length-1].width&&(b-=r,i.css({width:"auto"}),d.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?u.header=void 0:e("div.jstree-grid-header").hide(),!this.bound&&p&&(this.bound=!0,e(document).mouseup(function(){var t,i,r,s,n,a,o;if(l){for(o=c.closest(".jstree-grid-wrapper").find(".jstree"),i=e.jstree.reference(o),r=i.settings.grid.columns,n=c.parent().children("div.jstree-grid-column"),s=[],isNaN(0)&&(i._gridSettings.treeWidthDiff=o.find("ins:eq(0)").width()+o.find("a:eq(0)").width()-i._gridSettings.columns[0].width),l=!1,c=null,t=0;t<r.length;t++)a=parseFloat(n[t].style.width),s[t]={w:a,r:0===t},i._gridSettings.columns[t].width=a;o.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(l){_=e.pageX;var t,i,r,s=_-h;0!==s&&(t=c.width(),i=parseFloat(c.css("width")),i||(i=c.innerWidth()),s=s<0?Math.max(s,-t):s,r=i+s+"px",(s>0||t>0)&&(c.width(r),c.css("min-width",r),c.css("max-width",r),h=_))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return l=!0,h=t.pageX,c=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var i,r,s=e(this),n=s.closest("div.jstree-grid-column"),a=parseFloat(n.css("width")),o=0,d=n.width();n.find(".jstree-grid-cell").each(function(){var t,i=e(this);i.css("position","absolute"),i.css("width","auto"),t=i.outerWidth(),i.css("position","relative"),t>o&&(o=t)}),i=o-a,i=i<0?Math.max(i,-d):i,r=a+i+"px",n.width(r),n.css("min-width",r),n.css("max-width",r)}))},this.redraw_node=function(e,t,i,r){return e=u.redraw_node.call(this,e,t,i,r),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),u.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=e&&e.children_d?e.children_d:[];for(t=0;t<i.length;t++)d(this.gridWrapper,i[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,n,o=e(),d=t.children||[];for(n=0;n<d.length;n++)s="jsgrid_"+a(d[n])+"_col"+i,r[s]&&t.state.opened&&(o=o.add(r[s]).add(this.getHoldingCells(this.get_node(d[n]),i,r)));return o},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var s=this._data.core.rtl,n=this.element.width(),a=t.data[i.value],o=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:a,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=d.val();""===e||e===a?e=a:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:a}),this._prepare_grid(this.get_node(t,!0))),d.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=a),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(o.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(d),d.css(l).width(Math.min(o.text("pW"+d[0].value).width(),n))[0].select()},this._prepare_grid=function(i){var o,l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w,C,S,T,N,A,O,P,E,I,D,L=this._gridSettings,M=L.treeClass,H=this,z=L.columns||[],W=L.isThemeroller,K=this.element,q=this.rootid,$=W?"themeroller":"regular",F=this.get_node(i),U=L.columnWidth,Y=L.defaultConf,X=this.midWrapper,J=F.id,B=this.get_node(F.parent).children,V=e.inArray(J,B),R=this.holdingCells,G=!1;if(o=e(i),p=o.children("a"),1===p.length){for(!F.state.opened,b="jsgrid_"+a(J)+"_col",w="#"===F.parent?null:F.parent,p.addClass(M),t(p,o,H),m=p,h=0;h<z.length;h++)this.treecol!==h&&(E=z[h],D=X.children("div:eq("+h+")"),u=E.cellClass||"",g=E.wideCellClass||"",f=E.columnClass||"",D.addClass(f),_=void 0!==E.value&&null!==E.value?"function"==typeof E.value?E.value(F):null!==F.data&&void 0!==F.data&&void 0!==F.data[E.value]?F.data[E.value]:"":"","function"==typeof E.format&&(_=E.format(_)),E.images?(c=E.images[_]||E.images.default)&&(I="*"===c[0]?'<span class="'+c.substr(1)+'"></span>':'<img src="'+c+'">'):I=_,(void 0===I||null===I||n.test(I))&&(I="&nbsp;"),v=E.valueClass&&null!==F.data&&void 0!==F.data?F.data[E.valueClass]||"":"",v&&E.valueClassPrefix&&""!==E.valueClassPrefix&&(v=E.valueClassPrefix+v),j=E.wideValueClass&&null!==F.data&&void 0!==F.data?F.data[E.wideValueClass]||"":"",j&&E.wideValueClassPrefix&&""!==E.wideValueClassPrefix&&(j=E.wideValueClassPrefix+j),x=E.title&&null!==F.data&&void 0!==F.data?F.data[E.title]||"":"",x=x.replace(r,""),k=7,l=E.width||U,"auto"!==l&&(l-=k),m=D.children("div#"+b+h),(!m||m.length<1)&&(m=e("<div></div>"),e("<span></span>").appendTo(m),m.attr("id",b+h),m.addClass(b),m.attr("data-jstreegrid",J)),T=V<=0?F.parent:s(this,B[V-1]),S=d(D,T),A=V>=B.length-1?"NULL":B[V+1],N=d(D,A),P=F.children&&F.children.length>0?F.children[0]:"NULL",O=d(D,P),C=d(D,w),w?(C&&C.length>0?(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.insertAfter(C),G=!0):G=!1,R[b+h]=m):(S&&S.length>0?m.insertAfter(S):O&&O.length>0?m.insertBefore(O):N&&N.length>0?m.insertBefore(N):m.appendTo(D),G=!0),G&&m.after(this.getHoldingCells(F,h,R)),y=m.children("span"),y.addClass(u+" "+v).html(I),m=m.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+q+" jstree-grid-cell-"+$+" "+g+" "+j+(W?" ui-state-default":"")).addClass("jstree-grid-col-"+h),m.click(function(t,i,r,s,n){return function(n){i.children(".jstree-anchor").trigger("click.jstree",n),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}}(K,o,_,E)),m.on("contextmenu",function(t,i,r,s,n){return function(t){L.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=n.get_node(i);H._edit(r,s,t.target)}}}))}}(0,o,0,E,this)),m.hover(function(e,t){return function(){t.hover_node(e)}}(o,this),function(e,t){return function(){t.dehover_node(e)}}(o,this)),x&&y.attr("title",x));m.addClass("jstree-grid-cell-last"+(W?" ui-state-default":"")),void 0===z[z.length-1].width&&m.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}})},130:function(e,t,i){i(18),i(19);var r=i(1).default;window.CMS=r,r.PageTree=i(122).default},131:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),s=i(4),n=new s({options:{dropdownSelector:".js-cms-pagetree-dropdown",triggerSelector:".js-cms-pagetree-dropdown-trigger",menuSelector:".js-cms-pagetree-dropdown-menu",openCls:"cms-pagetree-dropdown-menu-open"},initialize:function(e){this.options=r.extend(!0,{},this.options,e),this.click="click.cms.pagetree.dropdown",this._setupUI(),this._events()},_setupUI:function(){this.ui={container:this.options.container,document:r(document)}},_events:function(){var e=this;this.ui.container.on(this.click,this.options.triggerSelector,function(t){t.preventDefault(),t.stopImmediatePropagation(),e._toggleDropdown(this)}),this.ui.container.on(this.click,e.options.menuSelector,function(e){e.stopImmediatePropagation()}),this.ui.container.on(this.click,e.options.menuSelector+" a",function(){e.closeAllDropdowns()}),this.ui.document.on(this.click,function(){e.closeAllDropdowns()})},_toggleDropdown:function(e){var t=r(this.options.dropdownSelector),i=r(e).closest(this.options.dropdownSelector);if(i.hasClass(this.options.openCls))return t.removeClass(this.options.openCls),!1;t.removeClass(this.options.openCls),i.addClass(this.options.openCls),this._loadContent(i)},_loadContent:function(e){var t=e.data();if(!t.lazyUrl||t.loaded)return!1;var i=setTimeout(function(){e.find(".js-cms-pagetree-dropdown-loader").addClass("cms-loader")},200);r.ajax({url:t.lazyUrl,data:t.lazyUrlData}).done(function(t){e.find(".js-cms-pagetree-dropdown-menu").html(t),e.data("loaded",!0),clearTimeout(i)})},closeAllDropdowns:function(){r(this.options.dropdownSelector).removeClass(this.options.openCls)}});t.default=n},132:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),s=i(4),n=i(1).default.API.Helpers,a=new s({initialize:function(e){var t=this;t.options=r.extend(!0,{},t.options,e),t.resize="resize.cms.pagetree.header",t.scroll="scroll.cms.pagetree.header",t.areClonesInDOM=!1,t._setupUI(),t._saveSizes(),t._events()},_setupUI:function(){var e=this.options.container,t=e.find(".jstree-grid-header");this.ui={container:e,window:r(window),headers:t,columns:e.find(".jstree-grid-column").toArray().map(function(e){return r(e)}),clones:t.clone().toArray().map(function(e){return r(e)})}},_saveSizes:function(){if(this.headersTopOffset=this.ui.headers.offset().top,this.toolbarHeight=0,this._isInSideframe()){this.toolbarHeight=CMS.API.Helpers._getWindow().parent.CMS.$(".cms-toolbar").height();var e=n._getWindow().parent.CMS.$(".cms-debug-bar");e.length&&(this.toolbarHeight+=e.outerHeight())}else this.toolbarHeight=r("#branding").height()},_isInSideframe:function(){var e=n._getWindow();return!(!e||!e.parent||e.parent===e)},_events:function(){this.ui.window.on([this.resize,this.scroll].join(" "),this._handleResizeOrScroll.bind(this))},_handleResizeOrScroll:function(){var e=this,t=e.ui.window.scrollTop(),i=e.ui.window.scrollLeft();e._shouldStick(t)?e._stickHeader(t,i):e._unstickHeader()},_shouldStick:function(e){return e+this.toolbarHeight>=this.headersTopOffset},_stickHeader:function(e,t){var i=this;i._insertClones(),i.ui.headers.each(function(e){var s=r(this),n=i.ui.clones[e].css("width"),a=i.ui.clones[e].offset().left;s.css({width:n,left:a-t})}),i.ui.headers.addClass("jstree-grid-header-fixed").css({top:i.toolbarHeight})},_unstickHeader:function(){var e=this;e._detachClones(),e.ui.headers.removeClass("jstree-grid-header-fixed").css({top:0,width:"auto",left:"auto"})},_insertClones:function(){var e=this;e.areClonesInDOM||(e.ui.columns.forEach(function(t,i){t.prepend(e.ui.clones[i])}),e.areClonesInDOM=!0)},_detachClones:function(){var e=this;e.areClonesInDOM&&(e.ui.clones.forEach(function(e){e.detach()}),e.areClonesInDOM=!1)}});t.default=a},93:function(e,t,i){var r,s,n;!function(a){"use strict";s=[i(0)],r=a,void 0!==(n="function"==typeof r?r.apply(t,s):r)&&(e.exports=n)}(function(e,t){"use strict";if(!e.jstree){var i,r,s=0,n=!1,a=!1,o=!1,d=[],l=e("script:last").attr("src"),c=window.document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",i.setAttribute("role","presentation"),h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),i.setAttribute("tabindex","-1"),r=c.createElement("I"),r.className="jstree-icon jstree-themeicon",r.setAttribute("role","presentation"),i.appendChild(r),h.appendChild(i),i=r=null,e.jstree={version:"{{VERSION}}",defaults:{plugins:[]},plugins:{},path:l&&-1!==l.indexOf("/")?l.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},e.jstree.create=function(t,i){var r=new e.jstree.core(++s),n=i;return i=e.extend(!0,{},e.jstree.defaults,i),n&&n.plugins&&(i.plugins=n.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))}),e(t).data("jstree",r),r.init(t,i),r},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(c).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var i=null,r=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!r||!r.length)try{r=e(t)}catch(e){}if(!r||!r.length)try{r=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return r&&r.length&&(r=r.closest(".jstree")).length&&(r=r.data("jstree"))?i=r:e(".jstree").each(function(){var r=e(this).data("jstree");return r&&r._model.data[t]?(i=r,!1):void 0}),i},e.fn.jstree=function(i){var r="string"==typeof i,s=Array.prototype.slice.call(arguments,1),n=null;return!(!0===i&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),o=r&&a?a[i]:null;return n=r&&o?o.apply(a,s):null,a||r||i!==t&&!e.isPlainObject(i)||e.jstree.create(this,i),(a&&!r||!0===i)&&(n=a||!1),(null===n||n===t)&&void 0}),null!==n&&n!==t?n:this)},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,i){var r=e.jstree.plugins[t];return r?(this._data[t]={},r.prototype=this,new r(i,this)):this},init:function(t,i){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",i=null,r=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(c.selection&&c.selection.empty)c.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),r=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){return!(!e.target.tagName||"input"!==e.target.tagName.toLowerCase())||void(this.settings.core.dblclick_toggle&&this.toggle_node(e.target))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==c.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var i=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_parent(t.currentTarget))&&i.id!==e.jstree.root&&this.get_node(i,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(i=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(i)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(i=this._firstChild(this.get_container_ul()[0]))&&e(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus();break;case 113:t.preventDefault(),this.edit(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){i.status&&(i.node.id!==e.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,i,r=[];for(t=0,i=this._data.core.selected.length;i>t;t++)r=r.concat(this._model.data[this._data.core.selected[t]].parents);for(r=e.vakata.array_unique(r),t=0,i=r.length;i>t;t++)this.open_node(r[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(r){if(r.target.tagName&&"input"===r.target.tagName.toLowerCase())return!0;i&&clearTimeout(i),i=setTimeout(function(){t=""},500);var s=String.fromCharCode(r.which).toLowerCase(),n=this.element.find(".jstree-anchor").filter(":visible"),a=n.index(c.activeElement)||0,o=!1;if(t+=s,t.length>1){if(n.slice(a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a).each(e.proxy(function(i,r){return 0===e(r).text().toLowerCase().indexOf(t)?(e(r).focus(),o=!0,!1):void 0},this)),o)return}if(new RegExp("^"+s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(n.slice(a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return;if(n.slice(0,a+1).each(e.proxy(function(t,i){return e(i).text().toLowerCase().charAt(0)===s?(e(i).focus(),o=!0,!1):void 0},this)),o)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.currentTarget);i&&i.id&&(this._data.core.focused=i.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-r>500&&!this._data.core.focused){r=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(c).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var r;try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(r=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=e(t,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])t=this._model.data[r.closest(".jstree-node").attr("id")];else{if(!(r=e(t,this.element)).length||!r.hasClass("jstree"))return!1;t=this._model.data[e.jstree.root]}return i&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,i,r){if(!(t=t.parents?t:this.get_node(t))||t.id===e.jstree.root||!t.parents)return!1;var s,n,a=[];for(a.push(r?t.id:t.text),s=0,n=t.parents.length;n>s;s++)a.push(r?t.parents[s]:this.get_text(t.parents[s]));return a=a.reverse().slice(1),i?a.join(i):a},get_next_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}if(t.hasClass("jstree-open")){for(r=this._firstChild(t.children(".jstree-children")[0]);r&&0===r.offsetHeight;)r=this._nextSibling(r);if(null!==r)return e(r)}r=t[0];do{r=this._nextSibling(r)}while(r&&0===r.offsetHeight);return null!==r?e(r):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,i){var r;if(t=this.get_node(t,!0),t[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&0===r.offsetHeight;)r=this._previousSibling(r);return!!r&&e(r)}if(!t||!t.length)return!1;if(i){r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);return!!r&&e(r)}r=t[0];do{r=this._previousSibling(r)}while(r&&0===r.offsetHeight);if(null!==r){for(t=e(r);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(r=t[0].parentNode.parentNode)||!r.className||-1===r.className.indexOf("jstree-node"))&&e(r)},get_parent:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var r,s,n,a,o;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,n=0,a=t.parents.length;a>n;n++)this._model.data[t.parents[n]].children_d=e.vakata.array_filter(this._model.data[t.parents[n]].children_d,function(i){return-1===e.inArray(i,t.children_d)});for(r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.selected&&(o=!0),delete this._model.data[t.children_d[r]];o&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(i){return-1===e.inArray(i,t.children_d)})),t.children=[],t.children_d=[],o&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var r=this.get_node(t,!0),s=0,n=0,a=this._model.data,o=!1;for(s=0,n=t.children.length;n>s;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){o=!0;break}t.state.loaded&&r&&r.length&&(r.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==t.id&&r.addClass(t.state.opened?"jstree-open":"jstree-closed"):r.addClass("jstree-leaf")),r.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i,r){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,l=[];for(s=0,n=e.length;n>s;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);if(a){for(s=0,n=e.length;n>s;s++)d[e[s]]&&d[e[s]].state.loaded&&l.push(e[s]);t&&!t.done&&(t.call(this,l),t.done=!0)}},load_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=[],a=this._model.data,o=a[t.id].children_d;for(t.state&&!t.state.loaded&&n.push(t.id),r=0,s=o.length;s>r;r++)a[o[r]]&&a[o[r]].state&&!a[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(t,i)}):(i&&i.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(t,i){var r,s=this.settings.core.data;return s?e.isFunction(s)?s.call(this,t,e.proxy(function(r){!1===r?i.call(this,!1):this["string"==typeof r?"_append_html_data":"_append_json_data"](t,"string"==typeof r?e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}):r,function(e){i.call(this,e)})},this)):"object"==typeof s?s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(r,s,n){var a=n.getResponseHeader("Content-Type");return a&&-1!==a.indexOf("json")||"object"==typeof r?this._append_json_data(t,r,function(e){i.call(this,e)}):a&&-1!==a.indexOf("html")||"string"==typeof r?this._append_html_data(t,e(e.parseHTML(r)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:n})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(r=e.isArray(s)||e.isPlainObject(s)?JSON.parse(JSON.stringify(s)):s,t.id===e.jstree.root?this._append_json_data(t,r,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof s?t.id===e.jstree.root?this._append_html_data(t,e(e.parseHTML(s)).filter(function(){return 3!==this.nodeType}),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):t.id===e.jstree.root?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,r){t=this.get_node(t),t.children=[],t.children_d=[];var s,n,a,o=i.is("ul")?i.children():i,d=t.id,l=[],c=[],h=this._model.data,_=h[d],u=this._data.core.selected.length;for(o.each(e.proxy(function(t,i){(s=this._parse_model_from_html(e(i),d,_.parents.concat()))&&(l.push(s),c.push(s),h[s].children_d.length&&(c=c.concat(h[s].children_d)))},this)),_.children=l,_.children_d=c,n=0,a=_.parents.length;a>n;n++)h[_.parents[n]].children_d=h[_.parents[n]].children_d.concat(c);this.trigger("model",{nodes:c,parent:d}),d!==e.jstree.root?(this._node_changed(d),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==u&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)},_append_json_data:function(t,i,r,s){if(null!==this.element){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,r,s,n,a=e.dat,o=e.par,d=[],l=[],c=[],h=e.df,_=e.t_id,u=e.t_cnt,g=e.m,f=g[o],p=e.sel,m=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(l.state[s]=h[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(l.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(l.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(l.li_attr[s]=e.li_attr[s]);if(l.li_attr.id||(l.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(l.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),g[l.id]=l,s=0,n=l.children.length;n>s;s++)a=m(g[l.children[s]],l.id,r),o=g[a],l.children_d.push(a),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d));return delete e.data,delete e.children,g[l.id].original=e,l.state.selected&&c.push(l.id),l.id},v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1;do{l="j"+_+"_"+ ++u}while(g[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=v(e.children[s],d.id,r),o=g[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,g[d.id]=d,d.state.selected&&c.push(d.id),d.id};if(a.length&&a[0].id!==t&&a[0].parent!==t){for(r=0,s=a.length;s>r;r++)a[r].children||(a[r].children=[]),g[a[r].id.toString()]=a[r];for(r=0,s=a.length;s>r;r++)g[a[r].parent.toString()].children.push(a[r].id.toString()),f.children_d.push(a[r].id.toString());for(r=0,s=f.children.length;s>r;r++)i=m(g[f.children[r]],o,f.parents.concat()),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d));for(r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}else{for(r=0,s=a.length;s>r;r++)(i=v(a[r],o,f.parents.concat()))&&(d.push(i),l.push(i),g[i].children_d.length&&(l=l.concat(g[i].children_d)));for(f.children=d,f.children_d=l,r=0,s=f.parents.length;s>r;r++)g[f.parents[r]].children_d=g[f.parents[r]].children_d.concat(l);n={cnt:u,mod:g,sel:p,par:o,dpc:l,add:c}}return"undefined"!=typeof window&&void 0!==window.document?n:void postMessage(n)},d=function(t,i){if(null!==this.element){this._cnt=t.cnt;var s,n=this._model.data;for(s in n)n.hasOwnProperty(s)&&n[s].state&&n[s].state.loading&&t.mod[s]&&(t.mod[s].state.loading=!0);if(this._model.data=t.mod,i){var a,o=t.add,d=t.sel,l=this._data.core.selected.slice();if(n=this._model.data,d.length!==l.length||e.vakata.array_unique(d.concat(l)).length!==d.length){for(s=0,a=d.length;a>s;s++)-1===e.inArray(d[s],o)&&-1===e.inArray(d[s],l)&&(n[d[s]].state.selected=!1);for(s=0,a=l.length;a>s;s++)-1===e.inArray(l[s],d)&&(n[l[s]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),t.par!==e.jstree.root?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),r.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||s?(this._data.core.working=!0,n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){d.call(this,e.data,!0);try{n.terminate(),n=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),a.par?n.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,i,r,!0])}catch(e){d.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else d.call(this,o(a),!1)}},_parse_model_from_html:function(i,r,s){s=s?[].concat(s):[],r&&s.unshift(r);var n,a,o,d,l,c=this._model.data,h={id:!1,text:!1,icon:!0,parent:r,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(h.state[o]=this._model.default_state[o]);if(d=e.vakata.attributes(i,!0),e.each(d,function(t,i){return i=e.trim(i),!i.length||(h.li_attr[t]=i,void("id"===t&&(h.id=i.toString())))}),d=i.children("a").first(),d.length&&(d=e.vakata.attributes(d,!0),e.each(d,function(t,i){i=e.trim(i),i.length&&(h.a_attr[t]=i)})),d=i.children("a").first().length?i.children("a").first().clone():i.clone(),d.children("ins, i, ul").remove(),d=d.html(),d=e("<div />").html(d),h.text=this.settings.core.force_text?d.text():d.html(),d=i.data(),h.data=d?e.extend(!0,{},d):null,h.state.opened=i.hasClass("jstree-open"),h.state.selected=i.children("a").hasClass("jstree-clicked"),h.state.disabled=i.children("a").hasClass("jstree-disabled"),h.data&&h.data.jstree)for(o in h.data.jstree)h.data.jstree.hasOwnProperty(o)&&(h.state[o]=h.data.jstree[o]);d=i.children("a").children(".jstree-themeicon"),d.length&&(h.icon=!d.hasClass("jstree-themeicon-hidden")&&d.attr("rel")),h.state.icon!==t&&(h.icon=h.state.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),d=i.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return h.id=h.li_attr.id?h.li_attr.id.toString():l,d.length?(d.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),h.id,s),a=this._model.data[n],h.children.push(n),a.children_d.length&&(h.children_d=h.children_d.concat(a.children_d))},this)),h.children_d=h.children_d.concat(h.children)):i.hasClass("jstree-closed")&&(h.state.loaded=!1),h.li_attr.class&&(h.li_attr.class=h.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),h.a_attr.class&&(h.a_attr.class=h.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[h.id]=h,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_flat_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d=e.id.toString(),l=this._model.data,c=this._model.default_state,h={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(h.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),h.icon!==t&&null!==h.icon&&""!==h.icon||(h.icon=!0),e&&e.data&&(h.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(h.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(h.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=e.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),l[h.id]=h,s=0,n=h.children.length;n>s;s++)a=this._parse_model_from_flat_json(l[h.children[s]],h.id,r),o=l[a],h.children_d.push(a),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete e.data,delete e.children,l[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,n,a,o,d,l=!1,c=this._model.data,h=this._model.default_state;do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(e&&e.id&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&(d.id=d.li_attr.id.toString()),d.id||(d.id=l),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,n=e.children.length;n>s;s++)a=this._parse_model_from_json(e.children[s],d.id,r),o=c[a],d.children.push(a),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var t,i,r,s=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),n=c.createElement("UL"),a=this._data.core.focused;for(i=0,r=s.length;r>i;i++)(t=this.redraw_node(s[i],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(t);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==a&&(t=this.get_node(a,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==c.activeElement?t.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var i=this.get_node(t),r=!1,s=!1,n=!1,a=c;if(!i)return!1;if(i.id===e.jstree.root)return this.redraw(!0);if(!(t=this.get_node(t,!0))||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],i.children.length&&i.state.loaded){for(n=a.createElement("UL"),n.setAttribute("role","group"),n.className="jstree-children",r=0,s=i.children.length;s>r;r++)n.appendChild(this.redraw_node(i.children[r],!0,!0));t.appendChild(n)}},redraw_node:function(t,i,r,s){var n=this.get_node(t),a=!1,o=!1,d=!1,l=!1,_=!1,u=!1,g="",f=c,p=this._model.data,m=!1,v=null,j=0,y=0,k=!1,x=!1;if(!n)return!1;if(n.id===e.jstree.root)return this.redraw(!0);if(i=i||0===n.children.length,t=c.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):c.getElementById(n.id))t=e(t),r||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(d=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===c.activeElement,t.remove();else if(i=!0,!r){if(!(null===(a=n.parent!==e.jstree.root?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?p[e.jstree.root].children:p[n.parent].children)}t=h.cloneNode(!0),g="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):g+=n.li_attr[l]}for(n.a_attr.id||(n.a_attr.id=n.id+"_anchor"),t.setAttribute("aria-selected",!!n.state.selected),t.setAttribute("aria-level",n.parents.length),t.setAttribute("aria-labelledby",n.a_attr.id),n.state.disabled&&t.setAttribute("aria-disabled",!0),l=0,_=n.children.length;_>l;l++)if(!p[n.children[l]].state.hidden){k=!0;break}if(null!==n.parent&&p[n.parent]&&!n.state.hidden&&(l=e.inArray(n.id,p[n.parent].children),x=n.id,-1!==l))for(l++,_=p[n.parent].children.length;_>l&&(p[p[n.parent].children[l]].state.hidden||(x=p[n.parent].children[l]),x===n.id);l++);n.state.hidden&&(g+=" jstree-hidden"),n.state.loaded&&!k?g+=" jstree-leaf":(g+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),x===n.id&&(g+=" jstree-last"),t.id=n.id,t.className=g,g=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(_ in n.a_attr)if(n.a_attr.hasOwnProperty(_)){if("href"===_&&"#"===n.a_attr[_])continue;"class"!==_?t.childNodes[1].setAttribute(_,n.a_attr[_]):g+=" "+n.a_attr[_]}if(g.length&&(t.childNodes[1].className="jstree-anchor "+g),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage='url("'+n.icon+'")',t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&(n.state.opened||s)&&n.state.loaded){for(u=f.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children",l=0,_=n.children.length;_>l;l++)u.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(u)}if(d&&t.appendChild(d),!r){for(a||(a=this.element[0]),l=0,_=a.childNodes.length;_>l;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){v=a.childNodes[l];break}v||(v=f.createElement("UL"),v.setAttribute("role","group"),v.className="jstree-children",a.appendChild(v)),a=v,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),m&&(j=this.element[0].scrollTop,y=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=j,this.element[0].scrollLeft=y)}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,r,s){var n,a,o,d;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.open_node(i[n],r,s);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(s=s===t?this.settings.core.animation:s,this.is_closed(i)?this.is_loaded(i)?(o=this.get_node(i,!0),d=this,o.length&&(s&&o.children(".jstree-children").length&&o.children(".jstree-children").stop(!0,!0),i.children.length&&!this._firstChild(o.children(".jstree-children")[0])&&this.draw_children(i),s?(this.trigger("before_open",{node:i}),o.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(s,function(){this.style.display="",d.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),o[0].className=o[0].className.replace("jstree-closed","jstree-open"),o[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,r&&r.call(this,i,!0),o.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),s&&o.length||this.trigger("after_open",{node:i}),!0):this.is_loading(i)?setTimeout(e.proxy(function(){this.open_node(i,r,s)},this),500):void this.load_node(i,function(e,t){return t?this.open_node(e,r,s):!!r&&r.call(this,e,!1)}):(r&&r.call(this,i,!1),!1))},_open_to:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i,r,s=t.parents;for(i=0,r=s.length;r>i;i+=1)i!==e.jstree.root&&this.open_node(s[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.close_node(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(!this.is_closed(i)&&(r=r===t?this.settings.core.animation:r,a=this,o=this.get_node(i,!0),i.state.opened=!1,this.trigger("close_node",{node:i}),void(o.length?r?o.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="",o.children(".jstree-children").remove(),a.trigger("after_close",{node:i})}):(o[0].className=o[0].className.replace("jstree-open","jstree-closed"),o.attr("aria-expanded",!1).children(".jstree-children").remove(),this.trigger("after_close",{node:i})):this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(t,i,r){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var s,n,a,o=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(s=0,n=t.children_d.length;n>s;s++)this.is_closed(this._model.data[t.children_d[s]])&&(this._model.data[t.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:t})}r=r||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,r)},i||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,i){if(t||(t=e.jstree.root),!(t=this.get_node(t)))return!1;var r,s,n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this;for(n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)})),r=0,s=t.children_d.length;s>r;r++)this._model.data[t.children_d[r]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),void this.trigger("enable_node",{node:t}))},disable_node:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_node(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),void this.trigger("disable_node",{node:t}))},is_hidden:function(e){return e=this.get_node(e),!0===e.state.hidden},hide_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.hide_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),i||this.redraw(),this.trigger("hide_node",{node:t})))},show_node:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.show_node(t[r],!0);return i||this.redraw(),!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&void(t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),i||this.redraw(),this.trigger("show_node",{node:t})))},hide_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&!r[i].state.hidden&&(r[i].state.hidden=!0,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(t){var i,r=this._model.data,s=[];for(i in r)r.hasOwnProperty(i)&&i!==e.jstree.root&&r[i].state.hidden&&(r[i].state.hidden=!1,s.push(i));return this._model.force_full_redraw=!0,t||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,n=this.get_node(e).id,a=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;s>r;r+=1)o[r]===n&&(d=!d),o[r]===a&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==n&&o[r]!==a?this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:i})}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){return!!((e=this.get_node(e,!0))&&e.length&&e.children(".jstree-hovered").length)&&(e.children(".jstree-anchor").removeClass("jstree-hovered"),void this.trigger("dehover_node",{node:this.get_node(e)}))},select_node:function(t,i,r,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),a=0,o=t.length;o>a;a++)this.select_node(t[a],i,r,s);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),r||(n=this._open_to(t)),n&&n.length&&n.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:s}))))},deselect_node:function(t,i,r){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.deselect_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(a=this.get_node(t,!0),void(t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:r}))))},select_all:function(t){var i,r,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[e.jstree.root].children_d.concat(),i=0,r=this._data.core.selected.length;r>i;i++)this._model.data[this._data.core.selected[i]]&&(this._model.data[this._data.core.selected[i]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;i>t;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,r,s,n,a=this.get_selected(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_bottom_selected:function(t){var i,r,s=this.get_selected(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},get_state:function(){var t,i={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.opened&&i.core.open.push(t),this._model.data[t].state.selected&&i.core.selected.push(t));return i},set_state:function(i,r){if(i){if(i.core){var s,n;if(i.core.open)return e.isArray(i.core.open)&&i.core.open.length?this._load_nodes(i.core.open,function(e){this.open_node(e,!1,0),delete i.core.open,this.set_state(i,r)},!0):(delete i.core.open,this.set_state(i,r)),!1;if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,r),!1;if(i.core.selected)return s=this,this.deselect_all(),e.each(i.core.selected,function(e,t){s.select_node(t,!1,!0)}),delete i.core.selected,this.set_state(i,r),!1;for(n in i)i.hasOwnProperty(n)&&"core"!==n&&-1===e.inArray(n,this.settings.plugins)&&delete i[n];if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,r),!1}return!e.isEmptyObject(i)||(i=null,r&&r.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var r=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(t,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var i=[],r=[],s=this._data.core.selected.concat([]);r.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id),i.push(this.id)}),this._load_nodes(r,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(s),this.trigger("refresh_node",{node:t,nodes:e})},this),!1,!0)},set_id:function(t,i){if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;var r,s,n=this._model.data,a=t.id;for(i=i.toString(),n[t.parent].children[e.inArray(t.id,n[t.parent].children)]=i,r=0,s=t.parents.length;s>r;r++)n[t.parents[r]].children_d[e.inArray(t.id,n[t.parents[r]].children_d)]=i;for(r=0,s=t.children.length;s>r;r++)n[t.children[r]].parent=i;for(r=0,s=t.children_d.length;s>r;r++)n[t.children_d[r]].parents[e.inArray(t.id,n[t.children_d[r]].parents)]=i;return r=e.inArray(t.id,this._data.core.selected),-1!==r&&(this._data.core.selected[r]=i),r=this.get_node(t.id,!0),r&&(r.attr("id",i),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",i)),delete n[t.id],t.id=i,t.li_attr.id=i,n[i]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.text},set_text:function(t,i){var r,s;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.set_text(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(t,i,r){if(!(t=this.get_node(t||e.jstree.root)))return!1;i&&i.flat&&!r&&(r=[]);var s,n,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!i||!i.no_data)&&e.extend(!0,{},t.data)};if(i&&i.flat?a.parent=t.parent:a.children=[],!i||!i.no_state)for(s in t.state)t.state.hasOwnProperty(s)&&(a.state[s]=t.state[s]);if(i&&i.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),i&&i.flat&&t.id!==e.jstree.root&&r.push(a),!i||!i.no_children)for(s=0,n=t.children.length;n>s;s++)i&&i.flat?this.get_json(t.children[s],i,r):a.children.push(this.get_json(t.children[s],i));return i&&i.flat?r:t.id===e.jstree.root?a.children:a},create_node:function(i,r,s,n,a){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return!1;if(s=s===t?"last":s,!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,r,s,n,!0)});r||(r={text:this.get_string("New node")}),"string"==typeof r&&(r={text:r}),r.text===t&&(r.text=this.get_string("New node"));var o,d,l,c;switch(i.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":o=this.get_node(i.parent),s=e.inArray(i.id,o.children),i=o;break;case"after":o=this.get_node(i.parent),s=e.inArray(i.id,o.children)+1,i=o;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0)}if(s>i.children.length&&(s=i.children.length),r.id||(r.id=!0),!this.check("create_node",r,i,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===r.id&&delete r.id,!(r=this._parse_model_from_json(r,i.id,i.parents.concat())))return!1;for(o=this.get_node(r),d=[],d.push(r),d=d.concat(o.children_d),this.trigger("model",{nodes:d,parent:i.id}),i.children_d=i.children_d.concat(d),l=0,c=i.parents.length;c>l;l++)this._model.data[i.parents[l]].children_d=this._model.data[i.parents[l]].children_d.concat(d);for(r=o,o=[],l=0,c=i.children.length;c>l;l++)o[l>=s?l+1:l]=i.children[l];return o[s]=r.id,i.children=o,this.redraw_node(i,!0),n&&n.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:i.id,position:s}),r.id},rename_node:function(t,i){var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.rename_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:n}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,r,s,n,a,o,d,l,c,h,_,u;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||t.id===e.jstree.root)return!1;if(s=this.get_node(t.parent),n=e.inArray(t.id,s.children),h=!1,!this.check("delete_node",t,s,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==n&&(s.children=e.vakata.array_remove(s.children,n)),a=t.children_d.concat([]),a.push(t.id),o=0,d=t.parents.length;d>o;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(t){return-1===e.inArray(t,a)});for(l=0,c=a.length;c>l;l++)if(this._model.data[a[l]].state.selected){h=!0;break}for(h&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return-1===e.inArray(t,a)})),this.trigger("delete_node",{node:t,parent:s.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:s.id}),l=0,c=a.length;c>l;l++)delete this._model.data[a[l]];return-1!==e.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,_=this.element[0].scrollTop,u=this.element[0].scrollLeft,s.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(s,!0).children(".jstree-anchor").focus(),this.element[0].scrollTop=_,this.element[0].scrollLeft=u),this.redraw_node(s,!0),!0},check:function(t,i,r,s,n){i=i&&i.id?i:this.get_node(i),r=r&&r.id?r:this.get_node(r);var a=t.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return"move_node"!==t||n&&n.is_multi||i.id!==r.id&&("move_node"!==t||e.inArray(i.id,r.children)!==s)&&-1===e.inArray(r.id,i.children_d)?(a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[t]||!0===a.functions[t])?(!1===a.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})}),a.functions[t]):!(!1===o||e.isFunction(o)&&!1===o.call(this,t,i,r,s,n)||o&&!1===o[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:s,obj:!(!i||!i.id)&&i.id,par:!(!r||!r.id)&&r.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v,j,y,k,x;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(m=this.move_node(i[l],r,s,n,a,!1,d))&&(r=m,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;if(h=(i.parent||e.jstree.root).toString(),u=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,g=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),f=!g||!g._id||this._id!==g._id,_=g&&g._id&&h&&g._model.data[h]&&g._model.data[h].children?e.inArray(i.id,g._model.data[h].children):-1,g&&g._id&&(i=g._model.data[i.id]),f)return!!(m=this.copy_node(i,r,s,n,a,!1,d))&&(g&&g.delete_node(i),m);switch(r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,u.children);break;case"after":s=e.inArray(r.id,u.children)+1;break;case"inside":case"first":s=0;break;case"last":s=u.children.length;break;default:s||(s=0)}if(s>u.children.length&&(s=u.children.length),!this.check("move_node",i,u,s,{core:!0,origin:d,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===u.id){for(p=u.children.concat(),m=e.inArray(i.id,p),-1!==m&&(p=e.vakata.array_remove(p,m),s>m&&s--),m=[],v=0,j=p.length;j>v;v++)m[v>=s?v+1:v]=p[v];m[s]=i.id,u.children=m,this._node_changed(u.id),this.redraw(u.id===e.jstree.root)}else{for(m=i.children_d.concat(),m.push(i.id),v=0,j=i.parents.length;j>v;v++){for(p=[],x=g._model.data[i.parents[v]].children_d,y=0,k=x.length;k>y;y++)-1===e.inArray(x[y],m)&&p.push(x[y]);g._model.data[i.parents[v]].children_d=p}for(g._model.data[h].children=e.vakata.array_remove_item(g._model.data[h].children,i.id),v=0,j=u.parents.length;j>v;v++)this._model.data[u.parents[v]].children_d=this._model.data[u.parents[v]].children_d.concat(m);for(p=[],v=0,j=u.children.length;j>v;v++)p[v>=s?v+1:v]=u.children[v];for(p[s]=i.id,u.children=p,u.children_d.push(i.id),u.children_d=u.children_d.concat(i.children_d),i.parent=u.id,m=u.parents.concat(),m.unshift(u.id),x=i.parents.length,i.parents=m,m=m.concat(),v=0,j=i.children_d.length;j>v;v++)this._model.data[i.children_d[v]].parents=this._model.data[i.children_d[v]].parents.slice(0,-1*x),Array.prototype.push.apply(this._model.data[i.children_d[v]].parents,m);h!==e.jstree.root&&u.id!==e.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(h),this._node_changed(u.id)),o||this.redraw()}return n&&n.call(this,i,u,s),this.trigger("move_node",{node:i,parent:u.id,position:s,old_parent:h,old_position:_,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),i.id},copy_node:function(i,r,s,n,a,o,d){var l,c,h,_,u,g,f,p,m,v;if(r=this.get_node(r),s=s===t?0:s,!r)return!1;if(!s.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(i,r,s,n,!0,!1,d)});if(e.isArray(i)){if(1!==i.length){for(l=0,c=i.length;c>l;l++)(_=this.copy_node(i[l],r,s,n,a,!0,d))&&(r=_,s="after");return this.redraw(),!0}i=i[0]}if(!(i=i&&i.id?i:this.get_node(i))||i.id===e.jstree.root)return!1;switch(p=(i.parent||e.jstree.root).toString(),m=s.toString().match(/^(before|after)$/)&&r.id!==e.jstree.root?this.get_node(r.parent):r,v=d||(this._model.data[i.id]?this:e.jstree.reference(i.id)),!v||!v._id||this._id!==v._id,v&&v._id&&(i=v._model.data[i.id]),r.id===e.jstree.root&&("before"===s&&(s="first"),"after"===s&&(s="last")),s){case"before":s=e.inArray(r.id,m.children);break;case"after":s=e.inArray(r.id,m.children)+1;break;case"inside":case"first":s=0;break;case"last":s=m.children.length;break;default:s||(s=0)}if(s>m.children.length&&(s=m.children.length),!this.check("copy_node",i,m,s,{core:!0,origin:d,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=v?v.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,m.id,m.parents.concat())))return!1;for(_=this.get_node(f),i&&i.state&&!1===i.state.loaded&&(_.state.loaded=!1),h=[],h.push(f),h=h.concat(_.children_d),this.trigger("model",{nodes:h,parent:m.id}),u=0,g=m.parents.length;g>u;u++)this._model.data[m.parents[u]].children_d=this._model.data[m.parents[u]].children_d.concat(h);for(h=[],u=0,g=m.children.length;g>u;u++)h[u>=s?u+1:u]=m.children[u];return h[s]=_.id,m.children=h,m.children_d.push(_.id),m.children_d=m.children_d.concat(_.children_d),m.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),o||this.redraw(m.id===e.jstree.root),n&&n.call(this,_,m,s),this.trigger("copy_node",{node:_,original:i,parent:m.id,position:s,old_parent:p,old_position:v&&v._id&&p&&v._model.data[p]&&v._model.data[p].children?e.inArray(i.id,v._model.data[p].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),_.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="move_node",void this.trigger("cut",{node:t}))},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,r,s,d=[];for(r=0,s=t.length;s>r;r++)(i=this.get_node(t[r]))&&i.id&&i.id!==e.jstree.root&&d.push(i);return!!d.length&&(n=d,o=this,a="copy_node",void this.trigger("copy",{node:t}))},get_buffer:function(){return{mode:a,node:n,inst:o}},can_paste:function(){return!1!==a&&!1!==n},paste:function(e,t){return!!((e=this.get_node(e))&&a&&a.match(/^(copy_node|move_node)$/)&&n)&&(this[a](n,e,t,!1,!1,!1,o)&&this.trigger("paste",{parent:e.id,node:n,mode:a}),n=!1,a=!1,void(o=!1))},clear_buffer:function(){n=!1,a=!1,o=!1,this.trigger("clear_buffer")},edit:function(t,i,r){var s,n,a,o,d,l,h,_,u,g=!1;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t),u.text=i,s=this._data.core.rtl,n=this.element.width(),this._data.core.focused=u.id,a=t.children(".jstree-anchor").focus(),o=e("<span>"),d=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(i){i.stopImmediatePropagation(),i.preventDefault();var s,n=o.children(".jstree-rename-input"),c=n.val(),_=this.settings.core.force_text;""===c&&(c=d),l.remove(),o.replaceWith(a),o.remove(),d=_?d:e("<div></div>").append(e.parseHTML(d)).html(),this.set_text(t,d),s=!!this.rename_node(t,_?e("<div></div>").text(c).text():e("<div></div>").append(e.parseHTML(c)).html()),s||this.set_text(t,d),this._data.core.focused=u.id,setTimeout(e.proxy(function(){var e=this.get_node(u.id,!0);e.length&&(this._data.core.focused=u.id,e.children(".jstree-anchor").focus())},this),0),r&&r.call(this,u,s,g),h=null},this),keydown:function(e){var t=e.which;27===t&&(g=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){return 13!==e.which&&void 0}}),_={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},o.attr("class",a.attr("class")).append(a.contents().clone()).append(h),a.replaceWith(o),l.css(_),h.css(_).width(Math.min(l.text("pW"+h[0].value).width(),n))[0].select(),void e(c).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){h&&t.target!==h&&e(h).blur()})))},set_theme:function(t,i){if(!t)return!1;if(!0===i){var r=this.settings.core.themes.dir;r||(r=e.jstree.path+"/themes"),i=r+"/"+t+"/style.css"}i&&-1===e.inArray(i,d)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),d.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(i,r){var s,n,a,o;if(e.isArray(i)){for(i=i.slice(),s=0,n=i.length;n>s;s++)this.set_icon(i[s],r);return!0}return!(!(i=this.get_node(i))||i.id===e.jstree.root)&&(o=i.icon,i.icon=!0===r||null===r||r===t||""===r||r,a=this.get_node(i,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===r?this.hide_icon(i):!0===r||null===r||r===t||""===r?(a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),!1===o&&this.show_icon(i)):-1===r.indexOf("/")&&-1===r.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(r+" jstree-themeicon-custom").attr("rel",r),!1===o&&this.show_icon(i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+r+"') center center no-repeat").attr("rel",r),!1===o&&this.show_icon(i)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var r=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,s){-1===e.inArray(s.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==s.value&&""!==e.trim(s.value)&&(i?r[s.name]=s.value:r.push(s.name))}),r},e.vakata.array_unique=function(e){var i,r,s=[],n={};for(i=0,r=e.length;r>i;i++)n[e[i]]===t&&(s.push(e[i]),n[e[i]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,i){var r=e.inArray(i,t);return-1!==r?e.vakata.array_remove(t,r):t},e.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);r=[];for(s in e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},e.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,n;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var a={};for(s=0,n=i.length;n>s;s++)a[i[s]]=1;for(s=0,n=r.selected.length;n>s;s++)a[r.selected[s]]?a[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,n=i.length;n>s;s++)1===a[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var _=c.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(i,r){this.bind=function(){r.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,r,s=this._model.data,n=(s[t.parent],t.nodes);for(i=0,r=n.length;r>i;i++)s[n[i]].state.checked=s[n[i]].state.checked||s[n[i]].original&&s[n[i]].original.state&&s[n[i]].original.state.checked,s[n[i]].state.checked&&this._data.checkbox.selected.push(n[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var r,s,n,a,o,d,l=this._model.data,c=l[i.parent],h=i.nodes,_=[],u=this.settings.checkbox.cascade,g=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))if(c.state[g?"selected":"checked"]){for(s=0,n=h.length;n>s;s++)l[h[s]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(h)}else for(s=0,n=h.length;n>s;s++)if(l[h[s]].state[g?"selected":"checked"]){for(a=0,o=l[h[s]].children_d.length;o>a;a++)l[l[h[s]].children_d[a]].state[g?"selected":"checked"]=!0;this._data[g?"core":"checkbox"].selected=this._data[g?"core":"checkbox"].selected.concat(l[h[s]].children_d)}if(-1!==u.indexOf("up")){for(s=0,n=c.children_d.length;n>s;s++)l[c.children_d[s]].children.length||_.push(l[c.children_d[s]].parent);for(_=e.vakata.array_unique(_),a=0,o=_.length;o>a;a++)for(c=l[_[a]];c&&c.id!==e.jstree.root;){for(r=0,s=0,n=c.children.length;n>s;s++)r+=l[c.children[s]].state[g?"selected":"checked"];if(r!==n)break;c.state[g?"selected":"checked"]=!0,this._data[g?"core":"checkbox"].selected.push(c.id),d=this.get_node(c,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(g?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[g?"core":"checkbox"].selected=e.vakata.array_unique(this._data[g?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var r,s,n,a,o=i.node,d=this._model.data,l=this.get_node(o.parent),c=this.get_node(o,!0),h=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection,u={},g=this._data[_?"core":"checkbox"].selected;for(r=0,s=g.length;s>r;r++)u[g[r]]=!0;if(-1!==h.indexOf("down"))for(r=0,s=o.children_d.length;s>r;r++)u[o.children_d[r]]=!0,a=d[o.children_d[r]],a.state[_?"selected":"checked"]=!0,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;l&&l.id!==e.jstree.root;){for(n=0,r=0,s=l.children.length;s>r;r++)n+=d[l.children[r]].state[_?"selected":"checked"];if(n!==s)break;l.state[_?"selected":"checked"]=!0,u[l.id]=!0,a=this.get_node(l,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),l=this.get_node(l.parent)}g=[];for(r in u)u.hasOwnProperty(r)&&g.push(r);this._data[_?"core":"checkbox"].selected=g,-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(t,i){var r,s,n,a=this.get_node(e.jstree.root),o=this._model.data;for(r=0,s=a.children_d.length;s>r;r++)(n=o[a.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var r,s,n,a=i.node,o=this.get_node(a,!0),d=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,c=this._data[l?"core":"checkbox"].selected,h={};if(a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),-1!==d.indexOf("down"))for(r=0,s=a.children_d.length;s>r;r++)n=this._model.data[a.children_d[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);if(-1!==d.indexOf("up"))for(r=0,s=a.parents.length;s>r;r++)n=this._model.data[a.parents[r]],n.state[l?"selected":"checked"]=!1,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1),(n=this.get_node(a.parents[r],!0))&&n.length&&n.attr("aria-selected",!1).children(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked");for(h={},r=0,s=c.length;s>r;r++)-1!==d.indexOf("down")&&-1!==e.inArray(c[r],a.children_d)||-1!==d.indexOf("up")&&-1!==e.inArray(c[r],a.parents)||(h[c[r]]=!0);c=[];for(r in h)h.hasOwnProperty(r)&&c.push(r);this._data[l?"core":"checkbox"].selected=c,-1!==d.indexOf("down")&&o.length&&o.find(".jstree-anchor").removeClass(l?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(t,i){for(var r,s,n,a,o=this.get_node(i.parent),d=this._model.data,l=this.settings.checkbox.tie_selection;o&&o.id!==e.jstree.root&&!o.state[l?"selected":"checked"];){for(n=0,r=0,s=o.children.length;s>r;r++)n+=d[o.children[r]].state[l?"selected":"checked"];if(!(s>0&&n===s))break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),a=this.get_node(o,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var r,s,n,a,o,d=i.is_multi,l=i.old_parent,c=this.get_node(i.parent),h=this._model.data,_=this.settings.checkbox.tie_selection;if(!d)for(r=this.get_node(l);r&&r.id!==e.jstree.root&&!r.state[_?"selected":"checked"];){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(!(a>0&&s===a))break;r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),o=this.get_node(r,!0),o&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),r=this.get_node(r.parent)}for(r=c;r&&r.id!==e.jstree.root;){for(s=0,n=0,a=r.children.length;a>n;n++)s+=h[r.children[n]].state[_?"selected":"checked"];if(s===a)r.state[_?"selected":"checked"]||(r.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"));else{if(!r.state[_?"selected":"checked"])break;r.state[_?"selected":"checked"]=!1,this._data[_?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[_?"core":"checkbox"].selected,r.id),(o=this.get_node(r,!0))&&o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass(_?"jstree-clicked":"jstree-checked")}r=this.get_node(r.parent)}},this))},this._undetermined=function(){if(null!==this.element){var i,r,s,n,a={},o=this._model.data,d=this.settings.checkbox.tie_selection,l=this._data[d?"core":"checkbox"].selected,c=[],h=this;for(i=0,r=l.length;r>i;i++)if(o[l[i]]&&o[l[i]].parents)for(s=0,n=o[l[i]].parents.length;n>s&&a[o[l[i]].parents[s]]===t;s++)o[l[i]].parents[s]!==e.jstree.root&&(a[o[l[i]].parents[s]]=!0,c.push(o[l[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var d,l=h.get_node(this);if(l.state.loaded){for(i=0,r=l.children_d.length;r>i;i++)if(d=o[l.children_d[i]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(a[d.id]===t&&d.id!==e.jstree.root&&(a[d.id]=!0,c.push(d.id)),s=0,n=d.parents.length;n>s;s++)a[d.parents[s]]===t&&d.parents[s]!==e.jstree.root&&(a[d.parents[s]]=!0,c.push(d.parents[s]))}else if(l.original&&l.original.state&&l.original.state.undetermined&&!0===l.original.state.undetermined)for(a[l.id]===t&&l.id!==e.jstree.root&&(a[l.id]=!0,c.push(l.id)),s=0,n=l.parents.length;n>s;s++)a[l.parents[s]]===t&&l.parents[s]!==e.jstree.root&&(a[l.parents[s]]=!0,c.push(l.parents[s]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),i=0,r=c.length;r>i;i++)o[c[i]].state[d?"selected":"checked"]||(l=this.get_node(c[i],!0))&&l.length&&l.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,i,s,n){if(t=r.redraw_node.apply(this,arguments)){var a,o,d=null,l=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(d.className+=" jstree-checked"),l=_.cloneNode(!1),this._model.data[t.id].state.checkbox_disabled&&(l.className+=" jstree-checkbox-disabled"),d.insertBefore(l,d.childNodes[0]))}return s||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,r,s=this.settings.checkbox.cascade,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=this._model.data;if(!t||!0===t.state[n?"selected":"checked"]||-1===s.indexOf("undetermined")||-1===s.indexOf("down")&&-1===s.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,r=t.children_d.length;r>i;i++)if(-1!==e.inArray(t.children_d[i],a)||!o[t.children_d[i]].state.loaded&&o[t.children_d[i]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.disable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))))},this.enable_checkbox=function(t){var i,r,s;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;r>i;i++)this.enable_checkbox(t[i]);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(s=this.get_node(t,!0),void(t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))))},this.activate_node=function(t,i){return!e(i.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox")?r.activate_node.call(this,t,i):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),void this.trigger("activate_node",{node:this.get_node(t)})))},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;n>s;s++)this.check_node(t[s],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(r=this.get_node(t,!0),void(t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var r,s,n;if(e.isArray(t)){for(t=t.slice(),r=0,s=t.length;s>r;r++)this.uncheck_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===e.jstree.root)&&(n=this.get_node(t,!0),void(t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),n.length&&n.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,i;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat(),t=0,i=this._data.checkbox.selected.length;i>t;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;t>e;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,r,s,n,a=this.get_checked(!0),o={};for(i=0,r=a.length;r>i;i++)o[a[i].id]=a[i];for(i=0,r=a.length;r>i;i++)for(s=0,n=a[i].children_d.length;n>s;s++)o[a[i].children_d[s]]&&delete o[a[i].children_d[s]];a=[];for(i in o)o.hasOwnProperty(i)&&a.push(i);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,r,s=this.get_checked(!0),n=[];for(i=0,r=s.length;r>i;i++)s[i].children.length||n.push(s[i].id);return t?e.map(n,e.proxy(function(e){return this.get_node(e)},this)):n},this.load_node=function(t,i){var s,n,a;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(t))&&a.state.loaded)for(s=0,n=a.children_d.length;n>s;s++)this._model.data[a.children_d[s]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[s]));return r.load_node.apply(this,arguments)},this.get_state=function(){var e=r.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,i){var s=r.set_state.apply(this,arguments);if(s&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var n=this;e.each(t.checkbox,function(e,t){n.check_node(t)})}return delete t.checkbox,this.set_state(t,i),!1}return s},this.refresh=function(e,t){return this.settings.checkbox.tie_selection||(this._data.checkbox.selected=[]),r.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){this.settings.conditionalselect.call(this,this.get_node(e),i)&&t.activate_node.call(this,e,i)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.create_node(r,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.cut(i.get_top_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.is_selected(r)?i.copy(i.get_top_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),r=i.get_node(t.reference);i.paste(r)}}}}}}},e.jstree.plugins.contextmenu=function(i,r){this.bind=function(){r.bind.call(this);var t,i,s=0,n=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),s=e.ctrlKey?+new Date:0,(t||n)&&(s=+new Date+1e4),n&&clearTimeout(n),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!s||+new Date-s>250)&&e.vakata.context.hide(),s=0},this)).on("touchstart.jstree",".jstree-anchor",function(r){r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(t=r.pageX,i=r.pageY,n=setTimeout(function(){e(r.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){n&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(i-e.pageY)>50)&&clearTimeout(n)}).on("touchend.vakata.jstree",function(e){n&&clearTimeout(n)}),e(c).on("context_hide.vakata.jstree",e.proxy(function(e,t){this._data.contextmenu.visible=!1,t.reference.removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),r.teardown.call(this)},this.show_contextmenu=function(i,r,s,n){if(!(i=this.get_node(i))||i.id===e.jstree.root)return!1;var a=this.settings.contextmenu,o=this.get_node(i,!0),d=o.children(".jstree-anchor"),l=!1,c=!1;(a.show_at_node||r===t||s===t)&&(l=d.offset(),r=l.left,s=l.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,n),c=a.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,r,s,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,r,s,c)},this._show_contextmenu=function(t,i,r,s){var n=this.get_node(t,!0),a=n.children(".jstree-anchor");e(c).one("context_show.vakata.jstree",e.proxy(function(t,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(r),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(a,{x:i,y:r},s),this.trigger("show_contextmenu",{node:t,x:i,y:r})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(c).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,r){if(!t)return!1;r||(i.html="",i.items=[]);var s,n="",a=!1;return r&&(n+="<ul>"),e.each(t,function(t,r){return!r||(i.items.push(r),!a&&r.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),a=!1,n+="<li class='"+(r._class||"")+(!0===r._disabled||e.isFunction(r._disabled)&&r._disabled({item:r,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">",n+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(n+="<i ",r.icon&&(n+=-1!==r.icon.indexOf("/")||-1!==r.icon.indexOf(".")?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(e.isFunction(r.label)?r.label({item:t,reference:i.reference,element:i.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"</span>":"")+"</a>",r.submenu&&(s=e.vakata.context._parse(r.submenu,!0))&&(n+=s),n+="</li>",void(r.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",a=!0)))}),n=n.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(n+="</ul>"),r||(i.html=n,e.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var r=i.children("ul"),s=i.offset().left,n=s+i.outerWidth(),a=i.offset().top,o=r.width(),d=r.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o>l&&s>l-n?"addClass":"removeClass"]("vakata-context-right"),a+d+10>c&&r.css("bottom","-1px"),i.hasClass("vakata-context-right")?o>s&&r.css("margin-right",s-o):o>l-n&&r.css("margin-left",l-n-o),r.show()}},show:function(r,s,n){var a,o,d,l,c,h,_,u;switch(i.element&&i.element.length&&i.element.width(""),!0){case!s&&!r:return!1;case!!s&&!!r:i.reference=r,i.position_x=s.x,i.position_y=s.y;break;case!s&&!!r:i.reference=r,a=r.offset(),i.position_x=a.left+r.outerHeight(),i.position_y=a.top;break;case!!s&&!r:i.position_x=s.x,i.position_y=s.y}r&&!n&&e(r).data("vakata_contextmenu")&&(n=e(r).data("vakata_contextmenu")),e.vakata.context._parse(n)&&i.element.html(i.html),i.items.length&&(i.element.appendTo("body"),o=i.element,d=i.position_x,l=i.position_y,c=o.width(),h=o.height(),_=e(window).width()+e(window).scrollLeft(),u=e(window).height()+e(window).scrollTop(),t&&(d-=o.outerWidth()-e(r).outerWidth())<e(window).scrollLeft()+20&&(d=e(window).scrollLeft()+20),d+c+20>_&&(d=_-(c+20)),l+h+20>u&&(l=u-(h+20)),i.element.css({left:d,top:l}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var r=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(r&&clearTimeout(r),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var r=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(r=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(c).on("mousedown.vakata.jstree",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,r){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var u,g;e.jstree.plugins.dnd=function(t,i){this.init=function(e,t){i.init.call(this,e,t),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in c.createElement("span")},this.bind=function(){i.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var i=this.get_node(t.target),r=this.is_selected(i)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,s=r>1?r+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(s=e.vakata.html.escape(s)),i&&i.id&&i.id!==e.jstree.root&&(1===t.which||"touchstart"===t.type||"dragstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_top_selected(!0):[i],t))){if(u={jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_top_selected():[i.id]},g=t.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,u,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+s+'<ins class="jstree-copy" style="display:none;">+</ins></div>');e.vakata.dnd._trigger("start",t,{helper:e(),element:g,data:u})}},this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:g,data:u}),!1}).on("drop.jstree",e.proxy(function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:g,data:u}),!1},this))},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,a,o=null;for(n=0,a=e.childNodes.length;a>n;n++)if(e.childNodes[n]&&e.childNodes[n].className&&-1!==e.childNodes[n].className.indexOf("jstree-anchor")){o=e.childNodes[n];break}o&&o.setAttribute("draggable",!0)}return e}},e(function(){var i=!1,r=!1,s=!1,n=!1,a=e('<div id="jstree-marker">&#160;</div>').hide();e(c).on("dnd_start.vakata.jstree",function(e,t){i=!1,s=!1,t&&t.data&&t.data.jstree&&a.appendTo("body")}).on("dnd_move.vakata.jstree",function(o,d){if(n&&(d.event&&"dragover"===d.event.type&&d.event.target===s.target||clearTimeout(n)),d&&d.data&&d.data.jstree&&(!d.event.target.id||"jstree-marker"!==d.event.target.id)){s=d.event;var l,c,h,_,u,g,f,p,m,v,j,y,k,x,b,w=e.jstree.reference(d.event.target),C=!1,S=!1,T=!1;if(w&&w._data&&w._data.dnd)if(a.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),b=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey)),d.helper.children().attr("class","jstree-"+w.get_theme()+" jstree-"+w.get_theme()+"-"+w.get_theme_variant()+" "+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[b?"show":"hide"](),d.event.target!==w.element[0]&&d.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((C=w.settings.dnd.large_drop_target?e(d.event.target).closest(".jstree-node").children(".jstree-anchor"):e(d.event.target).closest(".jstree-anchor"))&&C.length&&C.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(S=C.offset(),T=(d.event.pageY!==t?d.event.pageY:d.event.originalEvent.pageY)-S.top,h=C.outerHeight(),g=h/3>T?["b","i","a"]:T>h-h/3?["a","i","b"]:T>h/2?["i","a","b"]:["i","b","a"],e.each(g,function(t,s){switch(s){case"b":l=S.left-6,c=S.top,_=w.get_parent(C),u=C.parent().index();break;case"i":k=w.settings.dnd.inside_pos,x=w.get_node(C.parent()),l=S.left-2,c=S.top+h/2+1,_=x.id,u="first"===k?0:"last"===k?x.children.length:Math.min(k,x.children.length);break;case"a":l=S.left-6,c=S.top+h,_=w.get_parent(C),u=C.parent().index()+1}for(f=!0,p=0,m=d.data.nodes.length;m>p;p++)if(v=d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===s&&d.data.origin&&d.data.origin===w&&_===w.get_parent(d.data.nodes[p])&&(y=w.get_node(_),j>e.inArray(d.data.nodes[p],y.children)&&(j-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(v,d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],_,j,{dnd:!0,ref:w.get_node(C.parent()),pos:s,origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin})))){w&&w.last_error&&(r=w.last_error());break}return"i"===s&&C.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(n=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,C),w.settings.dnd.open_timeout)),f?(i={ins:w,par:_,pos:"i"!==s||"last"!==k||0!==u||w.is_loaded(x)?u:"last"},a.css({left:l+"px",top:c+"px"}).show(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"),r={},g=!0,!1):void 0}),!0===g))return}else{for(f=!0,p=0,m=d.data.nodes.length;m>p&&(f=f&&w.check(d.data.origin&&(d.data.origin.settings.dnd.always_copy||d.data.origin.settings.dnd.copy&&(d.event.metaKey||d.event.ctrlKey))?"copy_node":"move_node",d.data.origin&&d.data.origin!==w?d.data.origin.get_node(d.data.nodes[p]):d.data.nodes[p],e.jstree.root,"last",{dnd:!0,ref:w.get_node(e.jstree.root),pos:"i",origin:d.data.origin,is_multi:d.data.origin&&d.data.origin!==w,is_foreign:!d.data.origin}));p++);if(f)return i={ins:w,par:e.jstree.root,pos:"last"},a.hide(),d.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect=b?"copy":"move"))}i=!1,d.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),d.event.originalEvent&&d.event.originalEvent.dataTransfer&&(d.event.originalEvent.dataTransfer.dropEffect="none"),a.hide()}}).on("dnd_scroll.vakata.jstree",function(e,t){t&&t.data&&t.data.jstree&&(a.hide(),i=!1,s=!1,t.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(t,o){if(n&&clearTimeout(n),o&&o.data&&o.data.jstree){a.hide().detach();var d,l,c=[];if(i){for(d=0,l=o.data.nodes.length;l>d;d++)c[d]=o.data.origin?o.data.origin.get_node(o.data.nodes[d]):o.data.nodes[d];i.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,i.par,i.pos,!1,!1,!1,o.data.origin)}else d=e(o.event.target).closest(".jstree"),d.length&&r&&r.error&&"check"===r.error&&(d=d.jstree(!0))&&d.settings.core.error.call(this,r);s=!1,i=!1}}).on("keyup.jstree keydown.jstree",function(t,o){(o=e.vakata.dnd._get())&&o.data&&o.data.jstree&&("keyup"===t.type&&27===t.which?(n&&clearTimeout(n),i=!1,r=!1,s=!1,n=!1,a.hide().detach(),e.vakata.dnd._clean()):(o.helper.find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"](),s&&(s.metaKey=t.metaKey,s.ctrlKey=t.ctrlKey,e.vakata.dnd._trigger("move",s))))})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(i,r,s){s===t&&(s=e.vakata.dnd._get()),s.event=r,e(c).triggerHandler("dnd_"+i+".vakata",s)},_get:function(){return{data:i.data,element:i.element,helper:i.helper}},_clean:function(){i.helper&&i.helper.remove(),i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),i={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(c).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(t){if(!i.scroll_e||!i.scroll_l&&!i.scroll_t)return i.scroll_i&&(clearInterval(i.scroll_i),i.scroll_i=!1),!1;if(!i.scroll_i)return i.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===t)return!1;var r=i.scroll_e.scrollTop(),s=i.scroll_e.scrollLeft();i.scroll_e.scrollTop(r+i.scroll_t*e.vakata.dnd.settings.scroll_speed),i.scroll_e.scrollLeft(s+i.scroll_l*e.vakata.dnd.settings.scroll_speed),r===i.scroll_e.scrollTop()&&s===i.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",i.scroll_e)},start:function(t,r,s){"touchstart"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag&&e.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return i.init_x=t.pageX,i.init_y=t.pageY,i.data=r,i.is_down=!0,i.element=t.currentTarget,i.target=t.target,i.is_touch="touchstart"===t.type,!1!==s&&(i.helper=e("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(c).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(c).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(t){if("touchmove"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_down){if(!i.is_drag){if(!(Math.abs(t.pageX-i.init_x)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(t.pageY-i.init_y)>(i.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;i.helper&&(i.helper.appendTo("body"),i.helper_w=i.helper.outerWidth()),i.is_drag=!0,e.vakata.dnd._trigger("start",t)}var r=!1,s=!1,n=!1,a=!1,o=!1,d=!1,l=!1,h=!1,_=!1,u=!1;return i.scroll_t=0,i.scroll_l=0,i.scroll_e=!1,e(e(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var r=e(this),s=r.offset();return this.scrollHeight>this.offsetHeight&&(s.top+r.height()-t.pageY<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),t.pageY-s.top<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(s.left+r.width()-t.pageX<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),t.pageX-s.left<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1)),i.scroll_t||i.scroll_l?(i.scroll_e=e(this),!1):void 0}),i.scroll_e||(r=e(c),s=e(window),n=r.height(),a=s.height(),o=r.width(),d=s.width(),l=r.scrollTop(),h=r.scrollLeft(),n>a&&t.pageY-l<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=-1),n>a&&a-(t.pageY-l)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_t=1),o>d&&t.pageX-h<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=-1),o>d&&d-(t.pageX-h)<e.vakata.dnd.settings.scroll_proximity&&(i.scroll_l=1),(i.scroll_t||i.scroll_l)&&(i.scroll_e=r)),i.scroll_e&&e.vakata.dnd._scroll(!0),i.helper&&(_=parseInt(t.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(t.pageX+e.vakata.dnd.settings.helper_left,10),n&&_+25>n&&(_=n-50),o&&u+i.helper_w>o&&(u=o-(i.helper_w+2)),i.helper.css({left:u+"px",top:_+"px"})),e.vakata.dnd._trigger("move",t),!1}},stop:function(t){if("touchend"===t.type&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=c.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),i.is_drag)e.vakata.dnd._trigger("stop",t);else if("touchend"===t.type&&t.target===i.target){var r=setTimeout(function(){e(t.target).click()},100);e(t.target).one("click",function(){r&&clearTimeout(r)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,i){this.init=function(e,t){this._data.massload={},i.init.call(this,e,t)},this._load_nodes=function(t,r,s,n){var a,o,d,l=this.settings.massload,c=(JSON.stringify(t),[]),h=this._model.data;if(!s){for(a=0,o=t.length;o>a;a++)h[t[a]]&&(h[t[a]].state.loaded||h[t[a]].state.failed)&&!n||(c.push(t[a]),(d=this.get_node(t[a],!0))&&d.length&&d.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if(e.isFunction(l))return l.call(this,c,e.proxy(function(e){var a,o;if(e)for(a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);for(a=0,o=t.length;o>a;a++)(d=this.get_node(t[a],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this));if("object"==typeof l&&l&&l.url)return l=e.extend(!0,{},l),e.isFunction(l.url)&&(l.url=l.url.call(this,c)),e.isFunction(l.data)&&(l.data=l.data.call(this,c)),e.ajax(l).done(e.proxy(function(e,a,o){var l,c;if(e)for(l in e)e.hasOwnProperty(l)&&(this._data.massload[l]=e[l]);for(l=0,c=t.length;c>l;l++)(d=this.get_node(t[l],!0))&&d.length&&d.removeClass("jstree-loading").attr("aria-busy",!1);i._load_nodes.call(this,t,r,s,n)},this)).fail(e.proxy(function(e){i._load_nodes.call(this,t,r,s,n)},this))}}return i._load_nodes.call(this,t,r,s,n)},this._load_node=function(t,r){var s,n=this._data.massload[t.id],a=null;return n?(a=this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){r.call(this,e)}),s=this.get_node(t.id,!0),s&&s.length&&s.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],a):i._load_node.call(this,t,r)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(i,r){this.bind=function(){r.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",e.proxy(function(t,i){if(this._data.search.som&&i.res.length){var r,s,n,a,o=this._model.data,d=[];for(r=0,s=i.res.length;s>r;r++)if(o[i.res[r]]&&!o[i.res[r]].state.hidden&&(d.push(i.res[r]),d=d.concat(o[i.res[r]].parents),this._data.search.smc))for(n=0,a=o[i.res[r]].children_d.length;a>n;n++)o[o[i.res[r]].children_d[n]]&&!o[o[i.res[r]].children_d[n]].state.hidden&&d.push(o[i.res[r]].children_d[n]);d=e.vakata.array_remove_item(e.vakata.array_unique(d),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(d,!0),this.redraw(!0)}},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))},this.search=function(i,r,s,n,a,o){if(!1===i||""===e.trim(i.toString()))return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,i=i.toString();var d,l,c=this.settings.search,h=!!c.ajax&&c.ajax,_=this._model.data,u=null,g=[],f=[];if(this._data.search.res.length&&!a&&this.clear_search(),s===t&&(s=c.show_only_matches),o===t&&(o=c.show_only_matches_children),!r&&!1!==h)return e.isFunction(h)?h.call(this,i,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this),n):(h=e.extend({},h),h.data||(h.data={}),h.data.str=i,n&&(h.data.inside=n),e.ajax(h).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(h)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(i,!0,s,n,a)})},this)));if(a||(this._data.search.str=i,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=s,this._data.search.smc=o),u=new e.vakata.search(i,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(_[n||e.jstree.root].children_d,function(e,t){var r=_[t];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,i,r)||!c.search_callback&&u.search(r.text).isMatch)&&(g.push(t),f=f.concat(r.parents))}),g.length){for(f=e.vakata.array_unique(f),d=0,l=f.length;l>d;d++)f[d]!==e.jstree.root&&_[f[d]]&&!0===this.open_node(f[d],null,0)&&this._data.search.opn.push(f[d]);a?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(g))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(g,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=g),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:i,res:this._data.search.res,show_only_matches:s})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t,i,s,n){if((t=r.redraw_node.apply(this,arguments))&&-1!==e.inArray(t.id,this._data.search.res)){var a,o,d=null;for(a=0,o=t.childNodes.length;o>a;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){d=t.childNodes[a];break}d&&(d.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(t,i,r){r=r||{},r=e.extend({},e.vakata.search.defaults,r),!1!==r.fuzzy&&(r.fuzzy=!0),t=r.caseSensitive?t:t.toLowerCase();var s,n,a,o,d=r.location,l=r.distance,c=r.threshold,h=t.length;return h>32&&(r.fuzzy=!1),r.fuzzy&&(s=1<<h-1,n=function(){var e={},i=0;for(i=0;h>i;i++)e[t.charAt(i)]=0;for(i=0;h>i;i++)e[t.charAt(i)]|=1<<h-i-1;return e}(),a=function(e,t){var i=e/h,r=Math.abs(d-t);return l?i+r/l:r?1:i}),o=function(e){if(e=r.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!r.fuzzy)return{isMatch:!1,score:1};var i,o,l,_,u,g,f,p,m,v=e.length,j=c,y=e.indexOf(t,d),k=h+v,x=1,b=[];for(-1!==y&&(j=Math.min(a(0,y),j),-1!==(y=e.lastIndexOf(t,d+h))&&(j=Math.min(a(0,y),j))),y=-1,i=0;h>i;i++){for(l=0,_=k;_>l;)a(i,d+_)<=j?l=_:k=_,_=Math.floor((k-l)/2+l);for(k=_,g=Math.max(1,d-_+1),f=Math.min(d+_,v)+h,p=new Array(f+2),p[f+1]=(1<<i)-1,o=f;o>=g;o--)if(m=n[e.charAt(o-1)],p[o]=0===i?(p[o+1]<<1|1)&m:(p[o+1]<<1|1)&m|(u[o+1]|u[o])<<1|1|u[o+1],p[o]&s&&(x=a(i,o-1),j>=x)){if(j=x,y=o-1,b.push(y),!(y>d))break;g=Math.max(1,2*d-y)}if(a(i+1,d)>j)break;u=p}return{isMatch:y>=0,score:x}},!0===i?{search:o}:o(i)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var r,s;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(r=0,s=t.children_d.length;s>r;r++)this.sort(t.children_d[r],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(i,r){this.init=function(i,s){var n,a;if(s&&s.types&&s.types.default)for(n in s.types)if("default"!==n&&n!==e.jstree.root&&s.types.hasOwnProperty(n))for(a in s.types.default)s.types.default.hasOwnProperty(a)&&s.types[n][a]===t&&(s.types[n][a]=s.types.default[a]);r.init.call(this,i,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,i){r.refresh.call(this,t,i),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",e.proxy(function(i,r){var s,n,a,o=this._model.data,d=r.nodes,l=this.settings.types,c="default";for(s=0,n=d.length;n>s;s++){if(c="default",o[d[s]].original&&o[d[s]].original.type&&l[o[d[s]].original.type]&&(c=o[d[s]].original.type),o[d[s]].data&&o[d[s]].data.jstree&&o[d[s]].data.jstree.type&&l[o[d[s]].data.jstree.type]&&(c=o[d[s]].data.jstree.type),o[d[s]].type=c,!0===o[d[s]].icon&&l[c].icon!==t&&(o[d[s]].icon=l[c].icon),l[c].li_attr!==t&&"object"==typeof l[c].li_attr)for(a in l[c].li_attr)if(l[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].li_attr[a]===t?o[d[s]].li_attr[a]=l[c].li_attr[a]:"class"===a&&(o[d[s]].li_attr.class=l[c].li_attr.class+" "+o[d[s]].li_attr.class)}if(l[c].a_attr!==t&&"object"==typeof l[c].a_attr)for(a in l[c].a_attr)if(l[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;o[d[s]].a_attr[a]===t?o[d[s]].a_attr[a]=l[c].a_attr[a]:"href"===a&&"#"===o[d[s]].a_attr[a]?o[d[s]].a_attr.href=l[c].a_attr.href:"class"===a&&(o[d[s]].a_attr.class=l[c].a_attr.class+" "+o[d[s]].a_attr.class)}}o[e.jstree.root].type=e.jstree.root},this)),r.bind.call(this)},this.get_json=function(t,i,s){var n,a,o=this._model.data,d=i?e.extend(!0,{},i,{no_id:!1}):{},l=r.get_json.call(this,t,d,s);if(!1===l)return!1;if(e.isArray(l))for(n=0,a=l.length;a>n;n++)l[n].type=l[n].id&&o[l[n].id]&&o[l[n].id].type?o[l[n].id].type:"default",i&&i.no_id&&(delete l[n].id,l[n].li_attr&&l[n].li_attr.id&&delete l[n].li_attr.id,l[n].a_attr&&l[n].a_attr.id&&delete l[n].a_attr.id);else l.type=l.id&&o[l.id]&&o[l.id].type?o[l.id].type:"default",i&&i.no_id&&(l=this._delete_ids(l));return l},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,r=t.length;r>i;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,s,n,a,o){if(!1===r.check.call(this,i,s,n,a,o))return!1;s=s&&s.id?s:this.get_node(s),n=n&&n.id?n:this.get_node(n);var d,l,c,h,_=s&&s.id?o&&o.origin?o.origin:e.jstree.reference(s.id):null;switch(_=_&&_._model&&_._model.data?_._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(s.id,n.children)){if(d=this.get_rules(n),d.max_children!==t&&-1!==d.max_children&&d.max_children===n.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(d.valid_children!==t&&-1!==d.valid_children&&-1===e.inArray(s.type||"default",d.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;if(_&&s.children_d&&s.parents){for(l=0,c=0,h=s.children_d.length;h>c;c++)l=Math.max(l,_[s.children_d[c]].parents.length);l=l-s.parents.length+1}(0>=l||l===t)&&(l=1);do{if(d.max_depth!==t&&-1!==d.max_depth&&d.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:a,obj:!(!s||!s.id)&&s.id,par:!(!n||!n.id)&&n.id})},!1;n=this.get_node(n.parent),d=this.get_rules(n),l++}while(n)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,r){var s,n,a,o,d,l,c,h,_=this._model.data;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;a>n;n++)this.set_type(i[n],r);return!0}if(s=this.settings.types,i=this.get_node(i),!s[r]||!i)return!1;if(c=this.get_node(i,!0),c&&c.length&&(h=c.children(".jstree-anchor")),o=i.type,d=this.get_icon(i),i.type=r,(!0===d||s[o]&&s[o].icon!==t&&d===s[o].icon)&&this.set_icon(i,s[r].icon===t||s[r].icon),s[o].li_attr!==t&&"object"==typeof s[o].li_attr)for(l in s[o].li_attr)if(s[o].li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].li_attr.class=(_[i.id].li_attr.class||"").replace(s[o].li_attr[l],""),c&&c.removeClass(s[o].li_attr[l])):_[i.id].li_attr[l]===s[o].li_attr[l]&&(_[i.id].li_attr[l]=null,c&&c.removeAttr(l))}if(s[o].a_attr!==t&&"object"==typeof s[o].a_attr)for(l in s[o].a_attr)if(s[o].a_attr.hasOwnProperty(l)){if("id"===l)continue;"class"===l?(_[i.id].a_attr.class=(_[i.id].a_attr.class||"").replace(s[o].a_attr[l],""),h&&h.removeClass(s[o].a_attr[l])):_[i.id].a_attr[l]===s[o].a_attr[l]&&("href"===l?(_[i.id].a_attr[l]="#",h&&h.attr("href","#")):(delete _[i.id].a_attr[l],h&&h.removeAttr(l)))}if(s[r].li_attr!==t&&"object"==typeof s[r].li_attr)for(l in s[r].li_attr)if(s[r].li_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].li_attr[l]===t?(_[i.id].li_attr[l]=s[r].li_attr[l],c&&("class"===l?c.addClass(s[r].li_attr[l]):c.attr(l,s[r].li_attr[l]))):"class"===l&&(_[i.id].li_attr.class=s[r].li_attr[l]+" "+_[i.id].li_attr.class,c&&c.addClass(s[r].li_attr[l]))}if(s[r].a_attr!==t&&"object"==typeof s[r].a_attr)for(l in s[r].a_attr)if(s[r].a_attr.hasOwnProperty(l)){if("id"===l)continue;_[i.id].a_attr[l]===t?(_[i.id].a_attr[l]=s[r].a_attr[l],h&&("class"===l?h.addClass(s[r].a_attr[l]):h.attr(l,s[r].a_attr[l]))):"href"===l&&"#"===_[i.id].a_attr[l]?(_[i.id].a_attr.href=s[r].a_attr.href,h&&h.attr("href",s[r].a_attr.href)):"class"===l&&(_[i.id].a_attr.class=s[r].a_attr.class+" "+_[i.id].a_attr.class,h&&h.addClass(s[r].a_attr[l]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,r){this.check=function(t,i,s,n,a){if(!1===r.check.call(this,t,i,s,n,a))return!1;if(i=i&&i.id?i:this.get_node(i),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,l="rename_node"===t?n:i.text,c=[],h=this.settings.unique.case_sensitive,_=this._model.data;for(o=0,d=s.children.length;d>o;o++)c.push(h?_[s.children[o]].text:_[s.children[o]].text.toLowerCase());switch(h||(l=l.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return o=-1===e.inArray(l,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===l,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return o=-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return o=i.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(l,c),o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+l+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,s,n,a,o){if(!s||s.text===t){if(null===i&&(i=e.jstree.root),!(i=this.get_node(i)))return r.create_node.call(this,i,s,n,a,o);if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return r.create_node.call(this,i,s,n,a,o);s||(s={});var d,l,c,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(l=d=this.get_string("New node"),c=[],h=0,_=i.children.length;_>h;h++)c.push(g?u[i.children[h]].text:u[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(g?l:l.toLowerCase(),c);)l=f.call(this,d,++h).toString();s.text=l}return r.create_node.call(this,i,s,n,a,o)}};var p=c.createElement("DIV");if(p.setAttribute("unselectable","on"),p.setAttribute("role","presentation"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;r>i;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){if(this._data.contextmenu){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)}},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,r,s,n){if(t=i.redraw_node.apply(this,arguments)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(a.className+=" jstree-wholerow-hovered"),t.insertBefore(a,t.childNodes[0])}return t}},c.registerElement&&Object&&Object.create){var m=Object.create(HTMLElement.prototype);m.createdCallback=function(){var t,i={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(i.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(i[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(i.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(i)};try{c.registerElement("vakata-jstree",{prototype:m})}catch(e){}}}})}},[130]);
>>>>>>> 8b12009... fix things
