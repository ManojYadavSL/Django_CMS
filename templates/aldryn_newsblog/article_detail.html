{% extends "aldryn_newsblog/fullwidth.html" %}
{% load i18n thumbnail cms_tags apphooks_config_tags %}

{% block title %}{{ article.title }} - {{ block.super }}{% endblock %}
{% block breadcrumb %}{% endblock %}

{% block meta_description %}
    {% if article.meta_title %}
        <meta name="title" content="{{ article.meta_title|default:article.title }}" />
        <meta itemprop="name" content="{{ article.meta_title|default:article.title }}">
        <meta name="twitter:title" content="{{ article.meta_title|default:article.title }}" />
        <meta property="og:title" content="{{ article.meta_title|default:article.title }}" />
    {% else %}
        <meta name="title" content="{{ article.title }}">
    {% endif %}

    {% if article.meta_description %}
        <meta name="twitter:description" content="{{ article.meta_description|default:article.lead_in|striptags }} /">
        <meta name="description" content="{{ article.meta_description|default:article.lead_in|striptags }} /">
        <meta property="og:description" content="{{ article.meta_description|striptags|default:article.lead_in|striptags }}" />
    {% else %}
        <meta name="description" content="{{ article.lead_in|striptags }}">
    {% endif %}


    <meta property="og:url" content="http{% if request.is_secure %}s{% endif %}://{{ request.get_host }}{% if article %}{{ article.get_absolute_url }}{% else %}{% page_url request.current_page %}{% endif %}">
    <meta name="twitter:url" content="http{% if request.is_secure %}s{% endif %}://{{ request.get_host }}{% if article %}{{ article.get_absolute_url }}{% else %}{% page_url request.current_page %}{% endif %}">
    <meta property="og:type" content="blog">

    <meta property="og:locale" content="{{ LANGUAGE_CODE }}">
    <meta name="twitter:card" content="summary_large_image">

    {% if article.tags.exists %}
    <meta name="keywords" content="{% for tag in article.tags.all %}{{ tag }}{% if not forloop.last %}, {% endif %}{% endfor %}">
    {% endif %}
{% endblock %}

{% block feature %}
<div class="page-header">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-8 offset-md-2 text-center mb-5">
                <ul class="breadcrumb justify-content-center">
                    <li class="breadcrumb-item"><a href="{% namespace_url "article-list" namespace=instance.app_config.namespace default='' %}">Divio blog</a></li>
                </ul>
                <h2>{% render_model article "title" %}{% if not article.published %}<span class="badge badge-primary" style="position: absolute; margin-top: -3px;">Unpublished</span>{% endif %}</h2>
                {% if article.categories %}
                    <ul class="breadcrumb justify-content-center">
                        {% for category in article.categories.all %}
                            <li class="breadcrumb-item">
                                <a href="{% namespace_url 'article-list-by-category' category.slug namespace=namespace default='' %}">{{ category.name }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block newsblog_content %}
    <div class="aldryn-newsblog-detail mt--7">
        {% if article.featured_image_id %}
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8 text-center">
                    <img src="{% thumbnail article.featured_image 800x450 crop subject_location=article.featured_image.subject_location %}" alt="{{ article.featured_image.alt }}" class="img-fluid mb-5">
                </div>
            </div>
        {% endif %}

        <div class="row justify-content-center">
            <div class="col-12 col-md-9 col-lg-7">
                {% if article.lead_in %}
                <div class="lead mb-3">
                    {% render_model article "lead_in" %}
                </div>
                {% endif %}

                <div class="text-block">
                    {% render_placeholder article.content language placeholder_language %}
                </div>
                {% comment %}
                I talked to Mathias and he said that since we have categories
                and there can be multiple of them per article then we don't
                really need the tags. No one really uses them for articles anyway at the moment
                <p class="tags mb-5">
                    {% for tag in article.tags.all %}
                        <a class="badge mb-1 badge-pill badge-secondary" href="{% namespace_url 'article-list-by-tag' tag=tag.slug namespace=namespace default='' %}">{{ tag.name }}</a>
                    {% endfor %}
                </p>
                {% endcomment %}
            </div>
        </div>

        {% if article.author %}
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8 mt-5">
                <a href="{% namespace_url "article-list-by-author" article.author.slug namespace=namespace default='' %}" class="aldryn-newsblog-detail-author">
                    <div class="media">
                        {% if article.author.visual %}
                            {% thumbnail article.author.visual "50x50" crop upscale subject_location=article.author.visual.subject_location as author_image %}
                            <img class="rounded-circle img-fluid mr-4" src="{{ author_image.url }}" alt="{{ author }}">
                        {% endif %}

                        <div class="media-body">
                            <p class="h5">{{ article.author }}</p>
                            {% if article.author.function %}
                                <p class="text-secondary">{{ article.author.function }}</p>
                            {% endif %}
                            {% if article.author.description %}
                                <div class="aldryn-newsblog-detail-author-description">
                                    {{ article.author.description }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </a>
            </div>
        </div>
        {% endif %}
    </div>

{% endblock %}

{% block newsblog_footer %}
    <div class="pb-4">
        {% static_placeholder "newsblog_comments" %}
        {% static_placeholder "Newsblog article footer" %}
    </div>
{% endblock %}
